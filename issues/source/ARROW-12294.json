{
    "expand": "operations,versionedRepresentations,editmeta,changelog,renderedFields",
    "id": "13370343",
    "self": "https://issues.apache.org/jira/rest/api/2/issue/13370343",
    "key": "ARROW-12294",
    "fields": {
        "fixVersions": [
            {
                "self": "https://issues.apache.org/jira/rest/api/2/version/12349493",
                "id": "12349493",
                "description": "",
                "name": "4.0.0",
                "archived": false,
                "released": true,
                "releaseDate": "2021-04-26"
            }
        ],
        "resolution": {
            "self": "https://issues.apache.org/jira/rest/api/2/resolution/1",
            "id": "1",
            "description": "A fix for this issue is checked into the tree and tested.",
            "name": "Fixed"
        },
        "customfield_12312322": null,
        "customfield_12312323": null,
        "customfield_12312320": null,
        "customfield_12310420": "9223372036854775807",
        "customfield_12312321": null,
        "customfield_12312328": null,
        "customfield_12312329": null,
        "customfield_12312326": null,
        "customfield_12310300": null,
        "customfield_12312327": null,
        "customfield_12312324": null,
        "customfield_12312720": null,
        "customfield_12312325": null,
        "lastViewed": null,
        "priority": {
            "self": "https://issues.apache.org/jira/rest/api/2/priority/3",
            "iconUrl": "https://issues.apache.org/jira/images/icons/priorities/major.svg",
            "name": "Major",
            "id": "3"
        },
        "labels": [
            "pull-request-available"
        ],
        "customfield_12312333": null,
        "customfield_12312334": null,
        "customfield_12313422": "false",
        "customfield_12310310": "0.0",
        "customfield_12312331": null,
        "customfield_12312332": null,
        "aggregatetimeoriginalestimate": null,
        "timeestimate": 0,
        "customfield_12312330": null,
        "versions": [],
        "customfield_12311120": null,
        "customfield_12313826": null,
        "customfield_12312339": null,
        "issuelinks": [],
        "customfield_12313825": null,
        "assignee": {
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=ch-sc",
            "name": "ch-sc",
            "key": "ch-sc",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
            },
            "displayName": "Christoph Schulze",
            "active": true,
            "timeZone": "Etc/UTC"
        },
        "customfield_12312337": null,
        "customfield_12313823": null,
        "customfield_12312338": null,
        "customfield_12311920": null,
        "customfield_12313822": null,
        "customfield_12312335": null,
        "customfield_12313821": null,
        "customfield_12312336": null,
        "customfield_12313820": null,
        "status": {
            "self": "https://issues.apache.org/jira/rest/api/2/status/5",
            "description": "A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.",
            "iconUrl": "https://issues.apache.org/jira/images/icons/statuses/resolved.png",
            "name": "Resolved",
            "id": "5",
            "statusCategory": {
                "self": "https://issues.apache.org/jira/rest/api/2/statuscategory/3",
                "id": 3,
                "key": "done",
                "colorName": "green",
                "name": "Done"
            }
        },
        "components": [
            {
                "self": "https://issues.apache.org/jira/rest/api/2/component/12333773",
                "id": "12333773",
                "name": "Rust"
            },
            {
                "self": "https://issues.apache.org/jira/rest/api/2/component/12335005",
                "id": "12335005",
                "name": "Rust - DataFusion"
            }
        ],
        "customfield_12312026": null,
        "customfield_12312023": null,
        "customfield_12312024": null,
        "aggregatetimeestimate": 0,
        "customfield_12312022": null,
        "customfield_12310921": null,
        "customfield_12310920": "9223372036854775807",
        "customfield_12312823": null,
        "creator": {
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=ch-sc",
            "name": "ch-sc",
            "key": "ch-sc",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
            },
            "displayName": "Christoph Schulze",
            "active": true,
            "timeZone": "Etc/UTC"
        },
        "subtasks": [],
        "reporter": {
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=ch-sc",
            "name": "ch-sc",
            "key": "ch-sc",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
            },
            "displayName": "Christoph Schulze",
            "active": true,
            "timeZone": "Etc/UTC"
        },
        "aggregateprogress": {
            "progress": 7800,
            "total": 7800,
            "percent": 100
        },
        "customfield_12313520": null,
        "customfield_12310250": null,
        "progress": {
            "progress": 7800,
            "total": 7800,
            "percent": 100
        },
        "customfield_12313924": null,
        "votes": {
            "self": "https://issues.apache.org/jira/rest/api/2/issue/ARROW-12294/votes",
            "votes": 0,
            "hasVoted": false
        },
        "worklog": {
            "startAt": 0,
            "maxResults": 20,
            "total": 13,
            "worklogs": [
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13370343/worklog/579865",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "github-actions[bot] commented on pull request #9965:\nURL: https://github.com/apache/arrow/pull/9965#issuecomment-816558393\n\n\n   https://issues.apache.org/jira/browse/ARROW-12294\n\n\n-- \nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2021-04-09T09:38:12.754+0000",
                    "updated": "2021-04-09T09:38:12.754+0000",
                    "started": "2021-04-09T09:38:12.753+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "579865",
                    "issueId": "13370343"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13370343/worklog/579879",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "codecov-io commented on pull request #9965:\nURL: https://github.com/apache/arrow/pull/9965#issuecomment-816583148\n\n\n   # [Codecov](https://codecov.io/gh/apache/arrow/pull/9965?src=pr&el=h1) Report\n   > Merging [#9965](https://codecov.io/gh/apache/arrow/pull/9965?src=pr&el=desc) (362b986) into [master](https://codecov.io/gh/apache/arrow/commit/81f652102737ea89c30de0cec1e94414b8740666?el=desc) (81f6521) will **decrease** coverage by `3.94%`.\n   > The diff coverage is `2.02%`.\n   \n   [![Impacted file tree graph](https://codecov.io/gh/apache/arrow/pull/9965/graphs/tree.svg?width=650&height=150&src=pr&token=LpTCFbqVT1)](https://codecov.io/gh/apache/arrow/pull/9965?src=pr&el=tree)\n   \n   ```diff\n   @@            Coverage Diff             @@\n   ##           master    #9965      +/-   ##\n   ==========================================\n   - Coverage   82.70%   78.76%   -3.95%     \n   ==========================================\n     Files         257      281      +24     \n     Lines       60486    63637    +3151     \n   ==========================================\n   + Hits        50027    50125      +98     \n   - Misses      10459    13512    +3053     \n   ```\n   \n   \n   | [Impacted Files](https://codecov.io/gh/apache/arrow/pull/9965?src=pr&el=tree) | Coverage \u0394 | |\n   |---|---|---|\n   | [rust/ballista/rust/client/src/columnar\\_batch.rs](https://codecov.io/gh/apache/arrow/pull/9965/diff?src=pr&el=tree#diff-cnVzdC9iYWxsaXN0YS9ydXN0L2NsaWVudC9zcmMvY29sdW1uYXJfYmF0Y2gucnM=) | `0.00% <0.00%> (\u00f8)` | |\n   | [rust/ballista/rust/client/src/context.rs](https://codecov.io/gh/apache/arrow/pull/9965/diff?src=pr&el=tree#diff-cnVzdC9iYWxsaXN0YS9ydXN0L2NsaWVudC9zcmMvY29udGV4dC5ycw==) | `0.00% <0.00%> (\u00f8)` | |\n   | [rust/ballista/rust/core/src/client.rs](https://codecov.io/gh/apache/arrow/pull/9965/diff?src=pr&el=tree#diff-cnVzdC9iYWxsaXN0YS9ydXN0L2NvcmUvc3JjL2NsaWVudC5ycw==) | `0.00% <0.00%> (\u00f8)` | |\n   | [rust/ballista/rust/core/src/datasource.rs](https://codecov.io/gh/apache/arrow/pull/9965/diff?src=pr&el=tree#diff-cnVzdC9iYWxsaXN0YS9ydXN0L2NvcmUvc3JjL2RhdGFzb3VyY2UucnM=) | `0.00% <0.00%> (\u00f8)` | |\n   | [rust/ballista/rust/core/src/error.rs](https://codecov.io/gh/apache/arrow/pull/9965/diff?src=pr&el=tree#diff-cnVzdC9iYWxsaXN0YS9ydXN0L2NvcmUvc3JjL2Vycm9yLnJz) | `0.00% <0.00%> (\u00f8)` | |\n   | [...lista/rust/core/src/execution\\_plans/query\\_stage.rs](https://codecov.io/gh/apache/arrow/pull/9965/diff?src=pr&el=tree#diff-cnVzdC9iYWxsaXN0YS9ydXN0L2NvcmUvc3JjL2V4ZWN1dGlvbl9wbGFucy9xdWVyeV9zdGFnZS5ycw==) | `0.00% <0.00%> (\u00f8)` | |\n   | [...ta/rust/core/src/execution\\_plans/shuffle\\_reader.rs](https://codecov.io/gh/apache/arrow/pull/9965/diff?src=pr&el=tree#diff-cnVzdC9iYWxsaXN0YS9ydXN0L2NvcmUvc3JjL2V4ZWN1dGlvbl9wbGFucy9zaHVmZmxlX3JlYWRlci5ycw==) | `0.00% <0.00%> (\u00f8)` | |\n   | [...ust/core/src/execution\\_plans/unresolved\\_shuffle.rs](https://codecov.io/gh/apache/arrow/pull/9965/diff?src=pr&el=tree#diff-cnVzdC9iYWxsaXN0YS9ydXN0L2NvcmUvc3JjL2V4ZWN1dGlvbl9wbGFucy91bnJlc29sdmVkX3NodWZmbGUucnM=) | `0.00% <0.00%> (\u00f8)` | |\n   | [rust/ballista/rust/core/src/memory\\_stream.rs](https://codecov.io/gh/apache/arrow/pull/9965/diff?src=pr&el=tree#diff-cnVzdC9iYWxsaXN0YS9ydXN0L2NvcmUvc3JjL21lbW9yeV9zdHJlYW0ucnM=) | `0.00% <0.00%> (\u00f8)` | |\n   | [...sta/rust/core/src/serde/logical\\_plan/from\\_proto.rs](https://codecov.io/gh/apache/arrow/pull/9965/diff?src=pr&el=tree#diff-cnVzdC9iYWxsaXN0YS9ydXN0L2NvcmUvc3JjL3NlcmRlL2xvZ2ljYWxfcGxhbi9mcm9tX3Byb3RvLnJz) | `0.00% <0.00%> (\u00f8)` | |\n   | ... and [48 more](https://codecov.io/gh/apache/arrow/pull/9965/diff?src=pr&el=tree-more) | |\n   \n   ------\n   \n   [Continue to review full report at Codecov](https://codecov.io/gh/apache/arrow/pull/9965?src=pr&el=continue).\n   > **Legend** - [Click here to learn more](https://docs.codecov.io/docs/codecov-delta)\n   > `\u0394 = absolute <relative> (impact)`, `\u00f8 = not affected`, `? = missing data`\n   > Powered by [Codecov](https://codecov.io/gh/apache/arrow/pull/9965?src=pr&el=footer). Last update [24da9fa...362b986](https://codecov.io/gh/apache/arrow/pull/9965?src=pr&el=lastupdated). Read the [comment docs](https://docs.codecov.io/docs/pull-request-comments).\n   \n\n\n-- \nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2021-04-09T10:21:33.788+0000",
                    "updated": "2021-04-09T10:21:33.788+0000",
                    "started": "2021-04-09T10:21:33.788+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "579879",
                    "issueId": "13370343"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13370343/worklog/579880",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "alamb commented on a change in pull request #9965:\nURL: https://github.com/apache/arrow/pull/9965#discussion_r610515184\n\n\n\n##########\nFile path: rust/arrow/src/compute/kernels/boolean.rs\n##########\n@@ -52,37 +51,16 @@ where\n \n     // length and offset of boolean array is measured in bits\n     let len = left.len();\n-    let left_offset = left.offset();\n-    let right_offset = right.offset();\n-\n-    let left_buffer = left.values();\n-    let right_buffer = right.values();\n-\n-    // If we do not have a validity bitmap, we just use an empty buffer\n-    let (left_validity, left_validity_len) = left.data_ref().null_buffer().map_or_else(\n-        || (Buffer::from_iter(iter::empty::<bool>()), 0),\n-        |buffer| (buffer.clone(), len),\n-    );\n-    let (right_validity, right_validity_len) =\n-        right.data_ref().null_buffer().map_or_else(\n-            || (Buffer::from_iter(iter::empty::<bool>()), 0),\n-            |buffer| (buffer.clone(), len),\n-        );\n-\n-    let left_chunks = left_buffer.bit_chunks(left_offset, len);\n-    let left_valid_chunks = left_validity.bit_chunks(left_offset, left_validity_len);\n-    let right_chunks = right_buffer.bit_chunks(right_offset, len);\n-    let right_valid_chunks = right_validity.bit_chunks(right_offset, right_validity_len);\n \n     // result length measured in bytes (incl. remainder)\n     let mut result_len = round_upto_multiple_of_64(len) / 8;\n-    // if remainder is absent, the kleene_op code would always resize the result buffers,\n-    // which is both unnecessary and expensive. We can prevent the resizing by always\n-    // adding 8 additional bytes to the length of both buffers. All bits of these 8 bytes\n-    // will always be 0 though.\n-    if left_chunks.remainder_len().is_zero() {\n+    // if remainder is absent, the kleene_op code would resize the result buffers, which\n+    // is both unnecessary and expensive. We can prevent the resizing by adding 8 bytes\n+    // to the length of both buffers. All bits of these 8 bytes will be always 0 though.\n\nReview comment:\n       ```suggestion\r\n       // prevent the resizing by adding 8 bytes\r\n       // to the length of both buffers. All bits of these 8 bytes will be always 0 though.\r\n   ```\r\n   \r\n   As a stylistic suggestion I find comments that refer to some past state of the code to be more confusing than adding value (as readers are typically trying to understand the current state of the code, and often do not have any understanding of the past versions)\n\n##########\nFile path: rust/arrow/src/compute/kernels/boolean.rs\n##########\n@@ -628,6 +642,16 @@ mod tests {\n         }\n     }\n \n+    #[test]\n+    fn test_boolean_array_kleene_no_remainder() {\n+        let n = 1024;\n+        let a = BooleanArray::from(vec![true; n]);\n+        let b = BooleanArray::from(vec![None; n]);\n+        let result = or_kleene(&a, &b).unwrap();\n\nReview comment:\n       What do you  think about a test that covers some more cases on the remainder word? Something like\r\n   \r\n   ```\r\n   let a = BooleanArray::from(vec![Some(true), Some(false), None, Some(true), Some(false), None, Some(true), Some(false), None, Some(true), Some(false), None])\r\n   ```\r\n   \r\n   along with some corresponding pattern for `b`?\n\n\n\n\n-- \nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2021-04-09T10:25:35.362+0000",
                    "updated": "2021-04-09T10:25:35.362+0000",
                    "started": "2021-04-09T10:25:35.362+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "579880",
                    "issueId": "13370343"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13370343/worklog/579958",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "ch-sc commented on a change in pull request #9965:\nURL: https://github.com/apache/arrow/pull/9965#discussion_r610591851\n\n\n\n##########\nFile path: rust/arrow/src/compute/kernels/boolean.rs\n##########\n@@ -52,37 +51,16 @@ where\n \n     // length and offset of boolean array is measured in bits\n     let len = left.len();\n-    let left_offset = left.offset();\n-    let right_offset = right.offset();\n-\n-    let left_buffer = left.values();\n-    let right_buffer = right.values();\n-\n-    // If we do not have a validity bitmap, we just use an empty buffer\n-    let (left_validity, left_validity_len) = left.data_ref().null_buffer().map_or_else(\n-        || (Buffer::from_iter(iter::empty::<bool>()), 0),\n-        |buffer| (buffer.clone(), len),\n-    );\n-    let (right_validity, right_validity_len) =\n-        right.data_ref().null_buffer().map_or_else(\n-            || (Buffer::from_iter(iter::empty::<bool>()), 0),\n-            |buffer| (buffer.clone(), len),\n-        );\n-\n-    let left_chunks = left_buffer.bit_chunks(left_offset, len);\n-    let left_valid_chunks = left_validity.bit_chunks(left_offset, left_validity_len);\n-    let right_chunks = right_buffer.bit_chunks(right_offset, len);\n-    let right_valid_chunks = right_validity.bit_chunks(right_offset, right_validity_len);\n \n     // result length measured in bytes (incl. remainder)\n     let mut result_len = round_upto_multiple_of_64(len) / 8;\n-    // if remainder is absent, the kleene_op code would always resize the result buffers,\n-    // which is both unnecessary and expensive. We can prevent the resizing by always\n-    // adding 8 additional bytes to the length of both buffers. All bits of these 8 bytes\n-    // will always be 0 though.\n-    if left_chunks.remainder_len().is_zero() {\n+    // if remainder is absent, the kleene_op code would resize the result buffers, which\n+    // is both unnecessary and expensive. We can prevent the resizing by adding 8 bytes\n+    // to the length of both buffers. All bits of these 8 bytes will be always 0 though.\n\nReview comment:\n       Thanks @alamb. The comment refers to what is happening in the `kleene_op` closure and is not related to the bug. I just had the feeling the comment needs some refrasing.\n\n\n\n\n-- \nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2021-04-09T12:38:17.373+0000",
                    "updated": "2021-04-09T12:38:17.373+0000",
                    "started": "2021-04-09T12:38:17.373+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "579958",
                    "issueId": "13370343"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13370343/worklog/579960",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "ch-sc commented on a change in pull request #9965:\nURL: https://github.com/apache/arrow/pull/9965#discussion_r610595476\n\n\n\n##########\nFile path: rust/arrow/src/compute/kernels/boolean.rs\n##########\n@@ -628,6 +642,16 @@ mod tests {\n         }\n     }\n \n+    #[test]\n+    fn test_boolean_array_kleene_no_remainder() {\n+        let n = 1024;\n+        let a = BooleanArray::from(vec![true; n]);\n+        let b = BooleanArray::from(vec![None; n]);\n+        let result = or_kleene(&a, &b).unwrap();\n\nReview comment:\n       This test aims to reproduce the bug. There are a number of unit tests (`test_bool_array_and_kleene_nulls`, `test_bool_array_or_kleene_nulls`, `test_binary_boolean_kleene_kernel`) that cover different cases of bits in the remainder word. Note that if `batch size < 64` all bits are stored in the remainder chunk.\n\n\n\n\n-- \nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2021-04-09T12:44:11.920+0000",
                    "updated": "2021-04-09T12:44:11.920+0000",
                    "started": "2021-04-09T12:44:11.920+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "579960",
                    "issueId": "13370343"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13370343/worklog/579962",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "ch-sc commented on a change in pull request #9965:\nURL: https://github.com/apache/arrow/pull/9965#discussion_r610595476\n\n\n\n##########\nFile path: rust/arrow/src/compute/kernels/boolean.rs\n##########\n@@ -628,6 +642,16 @@ mod tests {\n         }\n     }\n \n+    #[test]\n+    fn test_boolean_array_kleene_no_remainder() {\n+        let n = 1024;\n+        let a = BooleanArray::from(vec![true; n]);\n+        let b = BooleanArray::from(vec![None; n]);\n+        let result = or_kleene(&a, &b).unwrap();\n\nReview comment:\n       This test aims to reproduce the bug, which only occurs when there is no remainder. There are a number of unit tests (`test_bool_array_and_kleene_nulls`, `test_bool_array_or_kleene_nulls`, `test_binary_boolean_kleene_kernel`) that cover different cases of bits in the remainder word. Note that if `batch size < 64` all bits are stored in the remainder chunk.\n\n\n\n\n-- \nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2021-04-09T12:48:50.633+0000",
                    "updated": "2021-04-09T12:48:50.633+0000",
                    "started": "2021-04-09T12:48:50.633+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "579962",
                    "issueId": "13370343"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13370343/worklog/580138",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "jhorstmann commented on a change in pull request #9965:\nURL: https://github.com/apache/arrow/pull/9965#discussion_r610775158\n\n\n\n##########\nFile path: rust/arrow/src/compute/kernels/boolean.rs\n##########\n@@ -52,37 +51,16 @@ where\n \n     // length and offset of boolean array is measured in bits\n     let len = left.len();\n-    let left_offset = left.offset();\n-    let right_offset = right.offset();\n-\n-    let left_buffer = left.values();\n-    let right_buffer = right.values();\n-\n-    // If we do not have a validity bitmap, we just use an empty buffer\n-    let (left_validity, left_validity_len) = left.data_ref().null_buffer().map_or_else(\n-        || (Buffer::from_iter(iter::empty::<bool>()), 0),\n-        |buffer| (buffer.clone(), len),\n-    );\n-    let (right_validity, right_validity_len) =\n-        right.data_ref().null_buffer().map_or_else(\n-            || (Buffer::from_iter(iter::empty::<bool>()), 0),\n-            |buffer| (buffer.clone(), len),\n-        );\n-\n-    let left_chunks = left_buffer.bit_chunks(left_offset, len);\n-    let left_valid_chunks = left_validity.bit_chunks(left_offset, left_validity_len);\n-    let right_chunks = right_buffer.bit_chunks(right_offset, len);\n-    let right_valid_chunks = right_validity.bit_chunks(right_offset, right_validity_len);\n \n     // result length measured in bytes (incl. remainder)\n     let mut result_len = round_upto_multiple_of_64(len) / 8;\n-    // if remainder is absent, the kleene_op code would always resize the result buffers,\n-    // which is both unnecessary and expensive. We can prevent the resizing by always\n-    // adding 8 additional bytes to the length of both buffers. All bits of these 8 bytes\n-    // will always be 0 though.\n-    if left_chunks.remainder_len().is_zero() {\n+    // if remainder is absent, the kleene_op code would resize the result buffers, which\n+    // is both unnecessary and expensive. We can prevent the resizing by adding 8 bytes\n+    // to the length of both buffers. All bits of these 8 bytes will be always 0 though.\n\nReview comment:\n       We could probably rephrase it and make more clear why we are adding the length.\r\n   \r\n   We are avoiding an edge case later by always appending the and/or of the remainder bits, even there is no actual remainder. In that case the remainder bits will all be zero, but it means we need to allocate 8 bytes more than strictly necessary.\n\n\n\n\n-- \nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2021-04-09T16:53:40.404+0000",
                    "updated": "2021-04-09T16:53:40.404+0000",
                    "started": "2021-04-09T16:53:40.403+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "580138",
                    "issueId": "13370343"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13370343/worklog/580139",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "jhorstmann commented on pull request #9965:\nURL: https://github.com/apache/arrow/pull/9965#issuecomment-816817732\n\n\n   Thanks for the quick review @alamb. Chris and me actually paired on most of the implementation, so this gets a :+1: from me :)\n\n\n-- \nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2021-04-09T16:55:25.868+0000",
                    "updated": "2021-04-09T16:55:25.868+0000",
                    "started": "2021-04-09T16:55:25.868+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "580139",
                    "issueId": "13370343"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13370343/worklog/580276",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "jorgecarleitao commented on a change in pull request #9965:\nURL: https://github.com/apache/arrow/pull/9965#discussion_r610862801\n\n\n\n##########\nFile path: rust/arrow/src/compute/kernels/boolean.rs\n##########\n@@ -102,41 +80,77 @@ where\n         valid_buffer.extend_from_slice(&[valid]);\n     };\n \n-    // To get rid off the additional remainder logic we would need an iterator\n-    // which contains a possible remainder word.\n-    let remainder = (\n-        (\n-            left_chunks.remainder_bits(),\n-            left_valid_chunks.remainder_bits(),\n-        ),\n-        (\n-            right_chunks.remainder_bits(),\n-            right_valid_chunks.remainder_bits(),\n-        ),\n-    );\n+    let left_offset = left.offset();\n+    let right_offset = right.offset();\n \n-    let base_iter = left_chunks\n-        .iter()\n-        .zip(left_valid_chunks.iter())\n-        .zip(right_chunks.iter().zip(right_valid_chunks.iter()))\n-        .chain(iter::once(remainder));\n+    let left_buffer = left.values();\n+    let right_buffer = right.values();\n+\n+    let left_chunks = left_buffer.bit_chunks(left_offset, len);\n+    let right_chunks = right_buffer.bit_chunks(right_offset, len);\n+\n+    let left_rem = left_chunks.remainder_bits();\n+    let right_rem = right_chunks.remainder_bits();\n+\n+    let opt_left_valid_chunks_and_rem = left\n+        .data_ref()\n+        .null_buffer()\n+        .map(|b| b.bit_chunks(left_offset, len))\n+        .map(|chunks| (chunks.iter(), chunks.remainder_bits()));\n+    let opt_right_valid_chunks_and_rem = right\n+        .data_ref()\n+        .null_buffer()\n+        .map(|b| b.bit_chunks(right_offset, len))\n+        .map(|chunks| (chunks.iter(), chunks.remainder_bits()));\n \n     match (\n-        left.data_ref().null_buffer().is_some(),\n-        right.data_ref().null_buffer().is_some(),\n+        opt_left_valid_chunks_and_rem,\n+        opt_right_valid_chunks_and_rem,\n     ) {\n-        (true, true) => base_iter.for_each(kleene_op),\n-        (true, false) => base_iter\n-            .map(|(left, (right_data, _))| (left, (right_data, u64::MAX)))\n-            .for_each(kleene_op),\n-        (false, true) => base_iter\n-            .map(|((left_data, _), right)| ((left_data, u64::MAX), right))\n-            .for_each(kleene_op),\n-        (false, false) => base_iter\n-            .map(|((left_data, _), (right_data, _))| {\n-                ((left_data, u64::MAX), (right_data, u64::MAX))\n-            })\n-            .for_each(kleene_op),\n+        (\n+            Some((left_valid_chunks, left_valid_rem)),\n+            Some((right_valid_chunks, right_valid_rem)),\n+        ) => {\n+            left_chunks\n\nReview comment:\n       this is just of a curiosity / knowledge sharing.\r\n   \r\n   I ported this to arrow2 recently and my conclusion there is that the abstractions needed for the kleene logic are a binary, ternary and quaternary bitmap operators (e.g. [here](https://github.com/jorgecarleitao/arrow2/blob/main/src/compute/boolean_kleene.rs#L125)), as each of these branches is one of these operations on the validity.\r\n   \r\n   Another optimization is that we can use `lhs.values() & rhs.values()` regardless of the validity instead of a more complex logic on the values, since the mask will nullify values accordingly.\r\n   \n\n\n\n\n-- \nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2021-04-09T19:37:24.487+0000",
                    "updated": "2021-04-09T19:37:24.487+0000",
                    "started": "2021-04-09T19:37:24.487+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "580276",
                    "issueId": "13370343"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13370343/worklog/581732",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "ch-sc commented on pull request #9965:\nURL: https://github.com/apache/arrow/pull/9965#issuecomment-818701411\n\n\n   @alamb I updated the comment. Can you take another look and merge if you think it's ok?\n\n\n-- \nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2021-04-13T12:37:21.326+0000",
                    "updated": "2021-04-13T12:37:21.326+0000",
                    "started": "2021-04-13T12:37:21.325+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "581732",
                    "issueId": "13370343"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13370343/worklog/581745",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "ch-sc commented on a change in pull request #9965:\nURL: https://github.com/apache/arrow/pull/9965#discussion_r612417270\n\n\n\n##########\nFile path: rust/arrow/src/compute/kernels/boolean.rs\n##########\n@@ -102,41 +80,77 @@ where\n         valid_buffer.extend_from_slice(&[valid]);\n     };\n \n-    // To get rid off the additional remainder logic we would need an iterator\n-    // which contains a possible remainder word.\n-    let remainder = (\n-        (\n-            left_chunks.remainder_bits(),\n-            left_valid_chunks.remainder_bits(),\n-        ),\n-        (\n-            right_chunks.remainder_bits(),\n-            right_valid_chunks.remainder_bits(),\n-        ),\n-    );\n+    let left_offset = left.offset();\n+    let right_offset = right.offset();\n \n-    let base_iter = left_chunks\n-        .iter()\n-        .zip(left_valid_chunks.iter())\n-        .zip(right_chunks.iter().zip(right_valid_chunks.iter()))\n-        .chain(iter::once(remainder));\n+    let left_buffer = left.values();\n+    let right_buffer = right.values();\n+\n+    let left_chunks = left_buffer.bit_chunks(left_offset, len);\n+    let right_chunks = right_buffer.bit_chunks(right_offset, len);\n+\n+    let left_rem = left_chunks.remainder_bits();\n+    let right_rem = right_chunks.remainder_bits();\n+\n+    let opt_left_valid_chunks_and_rem = left\n+        .data_ref()\n+        .null_buffer()\n+        .map(|b| b.bit_chunks(left_offset, len))\n+        .map(|chunks| (chunks.iter(), chunks.remainder_bits()));\n+    let opt_right_valid_chunks_and_rem = right\n+        .data_ref()\n+        .null_buffer()\n+        .map(|b| b.bit_chunks(right_offset, len))\n+        .map(|chunks| (chunks.iter(), chunks.remainder_bits()));\n \n     match (\n-        left.data_ref().null_buffer().is_some(),\n-        right.data_ref().null_buffer().is_some(),\n+        opt_left_valid_chunks_and_rem,\n+        opt_right_valid_chunks_and_rem,\n     ) {\n-        (true, true) => base_iter.for_each(kleene_op),\n-        (true, false) => base_iter\n-            .map(|(left, (right_data, _))| (left, (right_data, u64::MAX)))\n-            .for_each(kleene_op),\n-        (false, true) => base_iter\n-            .map(|((left_data, _), right)| ((left_data, u64::MAX), right))\n-            .for_each(kleene_op),\n-        (false, false) => base_iter\n-            .map(|((left_data, _), (right_data, _))| {\n-                ((left_data, u64::MAX), (right_data, u64::MAX))\n-            })\n-            .for_each(kleene_op),\n+        (\n+            Some((left_valid_chunks, left_valid_rem)),\n+            Some((right_valid_chunks, right_valid_rem)),\n+        ) => {\n+            left_chunks\n\nReview comment:\n       Great approach. Nicely done! :)\n\n\n\n\n-- \nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2021-04-13T12:52:45.997+0000",
                    "updated": "2021-04-13T12:52:45.997+0000",
                    "started": "2021-04-13T12:52:45.996+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "581745",
                    "issueId": "13370343"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13370343/worklog/582086",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "alamb commented on pull request #9965:\nURL: https://github.com/apache/arrow/pull/9965#issuecomment-819085158\n\n\n   Looks good @ch-sc  -- I'll plan to merge this PR tomorrow (once CI has passed -- github is a bit backed up at this moment)\n\n\n-- \nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2021-04-13T22:08:40.506+0000",
                    "updated": "2021-04-13T22:08:40.506+0000",
                    "started": "2021-04-13T22:08:40.506+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "582086",
                    "issueId": "13370343"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13370343/worklog/582385",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "alamb closed pull request #9965:\nURL: https://github.com/apache/arrow/pull/9965\n\n\n   \n\n\n-- \nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2021-04-14T11:08:19.093+0000",
                    "updated": "2021-04-14T11:08:19.093+0000",
                    "started": "2021-04-14T11:08:19.093+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "582385",
                    "issueId": "13370343"
                }
            ]
        },
        "customfield_12313920": null,
        "issuetype": {
            "self": "https://issues.apache.org/jira/rest/api/2/issuetype/1",
            "id": "1",
            "description": "A problem which impairs or prevents the functions of the product.",
            "iconUrl": "https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype",
            "name": "Bug",
            "subtask": false,
            "avatarId": 21133
        },
        "timespent": 7800,
        "customfield_12314020": "{summaryBean=com.atlassian.jira.plugin.devstatus.rest.SummaryBean@50170e07[summary={pullrequest=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@633da152[overall=PullRequestOverallBean{stateCount=0, state='OPEN', details=PullRequestOverallDetails{openCount=0, mergedCount=0, declinedCount=0}},byInstanceType={}], build=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@f037209[overall=com.atlassian.jira.plugin.devstatus.summary.beans.BuildOverallBean@1ba758a[failedBuildCount=0,successfulBuildCount=0,unknownBuildCount=0,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], review=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@153f73b4[overall=com.atlassian.jira.plugin.devstatus.summary.beans.ReviewsOverallBean@13cb74ad[stateCount=0,state=<null>,dueDate=<null>,overDue=false,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], deployment-environment=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@74ccfe7[overall=com.atlassian.jira.plugin.devstatus.summary.beans.DeploymentOverallBean@5508eca1[topEnvironments=[],showProjects=false,successfulCount=0,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], repository=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@3b448767[overall=com.atlassian.jira.plugin.devstatus.summary.beans.CommitOverallBean@73e2f2be[count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], branch=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@123028d2[overall=com.atlassian.jira.plugin.devstatus.summary.beans.BranchOverallBean@cfa3d1[count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}]},errors=[],configErrors=[]], devSummaryJson={\"cachedValue\":{\"errors\":[],\"configErrors\":[],\"summary\":{\"pullrequest\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"stateCount\":0,\"state\":\"OPEN\",\"details\":{\"openCount\":0,\"mergedCount\":0,\"declinedCount\":0,\"total\":0},\"open\":true},\"byInstanceType\":{}},\"build\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"failedBuildCount\":0,\"successfulBuildCount\":0,\"unknownBuildCount\":0},\"byInstanceType\":{}},\"review\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"stateCount\":0,\"state\":null,\"dueDate\":null,\"overDue\":false,\"completed\":false},\"byInstanceType\":{}},\"deployment-environment\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"topEnvironments\":[],\"showProjects\":false,\"successfulCount\":0},\"byInstanceType\":{}},\"repository\":{\"overall\":{\"count\":0,\"lastUpdated\":null},\"byInstanceType\":{}},\"branch\":{\"overall\":{\"count\":0,\"lastUpdated\":null},\"byInstanceType\":{}}}},\"isStale\":false}}",
        "customfield_12314141": null,
        "customfield_12314140": null,
        "project": {
            "self": "https://issues.apache.org/jira/rest/api/2/project/12319525",
            "id": "12319525",
            "key": "ARROW",
            "name": "Apache Arrow",
            "projectTypeKey": "software",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/projectavatar?pid=12319525&avatarId=10011",
                "24x24": "https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12319525&avatarId=10011",
                "16x16": "https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12319525&avatarId=10011",
                "32x32": "https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12319525&avatarId=10011"
            },
            "projectCategory": {
                "self": "https://issues.apache.org/jira/rest/api/2/projectCategory/13960",
                "id": "13960",
                "description": "Apache Arrow",
                "name": "Arrow"
            }
        },
        "aggregatetimespent": 7800,
        "customfield_12312520": null,
        "customfield_12312521": "Wed Apr 14 11:08:15 UTC 2021",
        "customfield_12314422": null,
        "customfield_12314421": null,
        "customfield_12314146": null,
        "customfield_12314420": null,
        "customfield_12314145": null,
        "customfield_12314144": null,
        "customfield_12314143": null,
        "resolutiondate": "2021-04-14T11:08:15.000+0000",
        "workratio": -1,
        "customfield_12312923": null,
        "customfield_12312920": null,
        "customfield_12312921": null,
        "watches": {
            "self": "https://issues.apache.org/jira/rest/api/2/issue/ARROW-12294/watchers",
            "watchCount": 1,
            "isWatching": false
        },
        "created": "2021-04-08T10:08:31.000+0000",
        "updated": "2021-04-14T11:08:20.000+0000",
        "timeoriginalestimate": null,
        "description": "With -ARROW-11973-\u00a0a bug got introduced which causes the boolean kleene kernels (or_kleene and and_kleene) to not iterate over the entire batch, but only the remainder bits.\r\n\r\nThe scenario can be reproduces with batch sizes that are multiples of 64 (no remainder) and present validity bitmaps.\u00a0",
        "customfield_10010": null,
        "timetracking": {
            "remainingEstimate": "0h",
            "timeSpent": "2h 10m",
            "remainingEstimateSeconds": 0,
            "timeSpentSeconds": 7800
        },
        "customfield_12314523": null,
        "customfield_12314127": null,
        "customfield_12314522": null,
        "customfield_12314126": null,
        "customfield_12314521": null,
        "customfield_12314125": null,
        "customfield_12314520": null,
        "customfield_12314124": null,
        "attachment": [],
        "customfield_12312340": null,
        "customfield_12314123": null,
        "customfield_12312341": null,
        "customfield_12312220": null,
        "customfield_12314122": null,
        "customfield_12314121": null,
        "customfield_12314120": null,
        "customfield_12314129": null,
        "customfield_12314524": null,
        "customfield_12314128": null,
        "summary": "[Rust] Fix Boolean Kleene Kernels with no Remainder",
        "customfield_12314130": null,
        "customfield_12310291": null,
        "customfield_12310290": null,
        "customfield_12314138": null,
        "customfield_12314137": null,
        "environment": null,
        "customfield_12314136": null,
        "customfield_12314135": null,
        "customfield_12311020": null,
        "customfield_12314134": null,
        "duedate": null,
        "customfield_12314132": null,
        "customfield_12314131": null,
        "comment": {
            "comments": [
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13370343/comment/17320910",
                    "id": "17320910",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=alamb",
                        "name": "alamb",
                        "key": "alamb",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=alamb&avatarId=43364",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=alamb&avatarId=43364",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=alamb&avatarId=43364",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=alamb&avatarId=43364"
                        },
                        "displayName": "Andrew Lamb",
                        "active": true,
                        "timeZone": "America/New_York"
                    },
                    "body": "Issue resolved by pull request 9965\n[https://github.com/apache/arrow/pull/9965]",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=alamb",
                        "name": "alamb",
                        "key": "alamb",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=alamb&avatarId=43364",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=alamb&avatarId=43364",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=alamb&avatarId=43364",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=alamb&avatarId=43364"
                        },
                        "displayName": "Andrew Lamb",
                        "active": true,
                        "timeZone": "America/New_York"
                    },
                    "created": "2021-04-14T11:08:15.371+0000",
                    "updated": "2021-04-14T11:08:15.371+0000"
                }
            ],
            "maxResults": 1,
            "total": 1,
            "startAt": 0
        },
        "customfield_12311820": "0|z0pnwg:",
        "customfield_12314139": null
    }
}