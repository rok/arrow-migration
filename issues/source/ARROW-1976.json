{
    "expand": "operations,versionedRepresentations,editmeta,changelog,renderedFields",
    "id": "13129122",
    "self": "https://issues.apache.org/jira/rest/api/2/issue/13129122",
    "key": "ARROW-1976",
    "fields": {
        "fixVersions": [
            {
                "self": "https://issues.apache.org/jira/rest/api/2/version/12341707",
                "id": "12341707",
                "description": "",
                "name": "0.9.0",
                "archived": false,
                "released": true,
                "releaseDate": "2018-03-19"
            }
        ],
        "resolution": {
            "self": "https://issues.apache.org/jira/rest/api/2/resolution/1",
            "id": "1",
            "description": "A fix for this issue is checked into the tree and tested.",
            "name": "Fixed"
        },
        "customfield_12312322": null,
        "customfield_12312323": null,
        "customfield_12312320": null,
        "customfield_12310420": "9223372036854775807",
        "customfield_12312321": null,
        "customfield_12312328": null,
        "customfield_12312329": null,
        "customfield_12312326": null,
        "customfield_12310300": null,
        "customfield_12312327": null,
        "customfield_12312324": null,
        "customfield_12312720": null,
        "customfield_12312325": null,
        "lastViewed": null,
        "priority": {
            "self": "https://issues.apache.org/jira/rest/api/2/priority/3",
            "iconUrl": "https://issues.apache.org/jira/images/icons/priorities/major.svg",
            "name": "Major",
            "id": "3"
        },
        "labels": [
            "pull-request-available"
        ],
        "customfield_12312333": null,
        "customfield_12312334": null,
        "customfield_12313422": "false",
        "customfield_12310310": "0.0",
        "customfield_12312331": null,
        "customfield_12312332": null,
        "aggregatetimeoriginalestimate": null,
        "timeestimate": null,
        "customfield_12312330": null,
        "versions": [
            {
                "self": "https://issues.apache.org/jira/rest/api/2/version/12341352",
                "id": "12341352",
                "name": "0.8.0",
                "archived": false,
                "released": true,
                "releaseDate": "2017-12-18"
            }
        ],
        "customfield_12311120": null,
        "customfield_12313826": null,
        "customfield_12312339": null,
        "issuelinks": [
            {
                "id": "12524256",
                "self": "https://issues.apache.org/jira/rest/api/2/issueLink/12524256",
                "type": {
                    "id": "12310000",
                    "name": "Duplicate",
                    "inward": "is duplicated by",
                    "outward": "duplicates",
                    "self": "https://issues.apache.org/jira/rest/api/2/issueLinkType/12310000"
                },
                "inwardIssue": {
                    "id": "13129808",
                    "key": "ARROW-1981",
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13129808",
                    "fields": {
                        "summary": "UnicodeEncodeError for column name in pandas_compat.py",
                        "status": {
                            "self": "https://issues.apache.org/jira/rest/api/2/status/6",
                            "description": "The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.",
                            "iconUrl": "https://issues.apache.org/jira/images/icons/statuses/closed.png",
                            "name": "Closed",
                            "id": "6",
                            "statusCategory": {
                                "self": "https://issues.apache.org/jira/rest/api/2/statuscategory/3",
                                "id": 3,
                                "key": "done",
                                "colorName": "green",
                                "name": "Done"
                            }
                        },
                        "priority": {
                            "self": "https://issues.apache.org/jira/rest/api/2/priority/4",
                            "iconUrl": "https://issues.apache.org/jira/images/icons/priorities/minor.svg",
                            "name": "Minor",
                            "id": "4"
                        },
                        "issuetype": {
                            "self": "https://issues.apache.org/jira/rest/api/2/issuetype/1",
                            "id": "1",
                            "description": "A problem which impairs or prevents the functions of the product.",
                            "iconUrl": "https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype",
                            "name": "Bug",
                            "subtask": false,
                            "avatarId": 21133
                        }
                    }
                }
            }
        ],
        "customfield_12313825": null,
        "assignee": {
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=Licht-T",
            "name": "Licht-T",
            "key": "licht-t",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=licht-t&avatarId=33236",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=licht-t&avatarId=33236",
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=licht-t&avatarId=33236",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=licht-t&avatarId=33236"
            },
            "displayName": "Licht Takeuchi",
            "active": true,
            "timeZone": "Asia/Tokyo"
        },
        "customfield_12312337": null,
        "customfield_12313823": null,
        "customfield_12312338": null,
        "customfield_12311920": null,
        "customfield_12313822": null,
        "customfield_12312335": null,
        "customfield_12313821": null,
        "customfield_12312336": null,
        "customfield_12313820": null,
        "status": {
            "self": "https://issues.apache.org/jira/rest/api/2/status/5",
            "description": "A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.",
            "iconUrl": "https://issues.apache.org/jira/images/icons/statuses/resolved.png",
            "name": "Resolved",
            "id": "5",
            "statusCategory": {
                "self": "https://issues.apache.org/jira/rest/api/2/statuscategory/3",
                "id": 3,
                "key": "done",
                "colorName": "green",
                "name": "Done"
            }
        },
        "components": [
            {
                "self": "https://issues.apache.org/jira/rest/api/2/component/12328936",
                "id": "12328936",
                "name": "Python"
            }
        ],
        "customfield_12312026": null,
        "customfield_12312023": null,
        "customfield_12312024": null,
        "aggregatetimeestimate": null,
        "customfield_12312022": null,
        "customfield_12310921": null,
        "customfield_12310920": "9223372036854775807",
        "customfield_12312823": null,
        "creator": {
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=simbanyatsanga",
            "name": "simbanyatsanga",
            "key": "simbanyatsanga",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=simbanyatsanga&avatarId=33891",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=simbanyatsanga&avatarId=33891",
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=simbanyatsanga&avatarId=33891",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=simbanyatsanga&avatarId=33891"
            },
            "displayName": "Simbarashe Nyatsanga",
            "active": true,
            "timeZone": "Etc/UTC"
        },
        "subtasks": [],
        "reporter": {
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=simbanyatsanga",
            "name": "simbanyatsanga",
            "key": "simbanyatsanga",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=simbanyatsanga&avatarId=33891",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=simbanyatsanga&avatarId=33891",
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=simbanyatsanga&avatarId=33891",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=simbanyatsanga&avatarId=33891"
            },
            "displayName": "Simbarashe Nyatsanga",
            "active": true,
            "timeZone": "Etc/UTC"
        },
        "aggregateprogress": {
            "progress": 0,
            "total": 0
        },
        "customfield_12313520": null,
        "customfield_12310250": null,
        "progress": {
            "progress": 0,
            "total": 0
        },
        "customfield_12313924": null,
        "votes": {
            "self": "https://issues.apache.org/jira/rest/api/2/issue/ARROW-1976/votes",
            "votes": 1,
            "hasVoted": false
        },
        "worklog": {
            "startAt": 0,
            "maxResults": 20,
            "total": 0,
            "worklogs": []
        },
        "customfield_12313920": null,
        "issuetype": {
            "self": "https://issues.apache.org/jira/rest/api/2/issuetype/1",
            "id": "1",
            "description": "A problem which impairs or prevents the functions of the product.",
            "iconUrl": "https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype",
            "name": "Bug",
            "subtask": false,
            "avatarId": 21133
        },
        "timespent": null,
        "customfield_12314020": "{summaryBean=com.atlassian.jira.plugin.devstatus.rest.SummaryBean@7f2297c9[summary={pullrequest=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@54759513[overall=PullRequestOverallBean{stateCount=0, state='OPEN', details=PullRequestOverallDetails{openCount=0, mergedCount=0, declinedCount=0}},byInstanceType={}], build=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@1a2fe5d3[overall=com.atlassian.jira.plugin.devstatus.summary.beans.BuildOverallBean@620a2688[failedBuildCount=0,successfulBuildCount=0,unknownBuildCount=0,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], review=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@7182bea0[overall=com.atlassian.jira.plugin.devstatus.summary.beans.ReviewsOverallBean@452977a6[stateCount=0,state=<null>,dueDate=<null>,overDue=false,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], deployment-environment=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@20cd13ad[overall=com.atlassian.jira.plugin.devstatus.summary.beans.DeploymentOverallBean@13c04f5a[topEnvironments=[],showProjects=false,successfulCount=0,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], repository=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@77d3843c[overall=com.atlassian.jira.plugin.devstatus.summary.beans.CommitOverallBean@79c95927[count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], branch=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@31d16dc8[overall=com.atlassian.jira.plugin.devstatus.summary.beans.BranchOverallBean@207a5e37[count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}]},errors=[],configErrors=[]], devSummaryJson={\"cachedValue\":{\"errors\":[],\"configErrors\":[],\"summary\":{\"pullrequest\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"stateCount\":0,\"state\":\"OPEN\",\"details\":{\"openCount\":0,\"mergedCount\":0,\"declinedCount\":0,\"total\":0},\"open\":true},\"byInstanceType\":{}},\"build\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"failedBuildCount\":0,\"successfulBuildCount\":0,\"unknownBuildCount\":0},\"byInstanceType\":{}},\"review\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"stateCount\":0,\"state\":null,\"dueDate\":null,\"overDue\":false,\"completed\":false},\"byInstanceType\":{}},\"deployment-environment\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"topEnvironments\":[],\"showProjects\":false,\"successfulCount\":0},\"byInstanceType\":{}},\"repository\":{\"overall\":{\"count\":0,\"lastUpdated\":null},\"byInstanceType\":{}},\"branch\":{\"overall\":{\"count\":0,\"lastUpdated\":null},\"byInstanceType\":{}}}},\"isStale\":false}}",
        "customfield_12314141": null,
        "customfield_12314140": null,
        "project": {
            "self": "https://issues.apache.org/jira/rest/api/2/project/12319525",
            "id": "12319525",
            "key": "ARROW",
            "name": "Apache Arrow",
            "projectTypeKey": "software",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/projectavatar?pid=12319525&avatarId=10011",
                "24x24": "https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12319525&avatarId=10011",
                "16x16": "https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12319525&avatarId=10011",
                "32x32": "https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12319525&avatarId=10011"
            },
            "projectCategory": {
                "self": "https://issues.apache.org/jira/rest/api/2/projectCategory/13960",
                "id": "13960",
                "description": "Apache Arrow",
                "name": "Arrow"
            }
        },
        "aggregatetimespent": null,
        "customfield_12312520": null,
        "customfield_12312521": "Tue Feb 06 19:02:48 UTC 2018",
        "customfield_12314422": null,
        "customfield_12314421": null,
        "customfield_12314146": null,
        "customfield_12314420": null,
        "customfield_12314145": null,
        "customfield_12314144": null,
        "customfield_12314143": null,
        "resolutiondate": "2018-02-06T00:27:48.000+0000",
        "workratio": -1,
        "customfield_12312923": null,
        "customfield_12312920": null,
        "customfield_12312921": null,
        "watches": {
            "self": "https://issues.apache.org/jira/rest/api/2/issue/ARROW-1976/watchers",
            "watchCount": 5,
            "isWatching": false
        },
        "created": "2018-01-07T22:06:37.000+0000",
        "updated": "2018-02-06T19:02:48.000+0000",
        "timeoriginalestimate": null,
        "description": "Unicode columns in pandas DataFrames aren't being handled correctly for some datasets when reading a parquet file into a pandas DataFrame, leading to the common Python ASCII encoding error.\r\n \r\nThe dataset used to get the error is here: https://catalog.data.gov/dataset/college-scorecard\r\n\r\n{code}\r\nimport numpy as np\r\nimport pandas as pd\r\nimport pyarrow as pa\r\nimport pyarrow.parquet as pq\r\n\r\ndf = pd.read_csv('college_data.csv')\r\n{code}\r\n\r\nFor verification, the DataFrame's columns are indeed unicode\r\n{code}\r\ndf.columns\r\n> Index([u'\ufeffUNITID', u'OPEID', u'OPEID6', u'INSTNM', u'CITY', u'STABBR',\r\n       u'INSTURL', u'NPCURL', u'HCM2', u'PREDDEG',\r\n       ...\r\n       u'RET_PTL4', u'PCTFLOAN', u'UG25ABV', u'MD_EARN_WNE_P10', u'GT_25K_P6',\r\n       u'GRAD_DEBT_MDN_SUPP', u'GRAD_DEBT_MDN10YR_SUPP', u'RPY_3YR_RT_SUPP',\r\n       u'C150_L4_POOLED_SUPP', u'C150_4_POOLED_SUPP'],\r\n      dtype='object', length=123)\r\n{code}\r\n\r\nThe DataFrame can be saved into a parquet file\r\n{code}\r\narrow_table = pa.Table.from_pandas(df)\r\npq.write_table(arrow_table, 'college_data.parquet')\r\n{code}\r\n\r\nBut trying to read the parquet file immediately afterwards results in the following\r\n{code}\r\ndf = pq.read_table('college_data.parquet').to_pandas()\r\n\r\n> ---------------------------------------------------------------------------\r\nUnicodeEncodeError                        Traceback (most recent call last)\r\n<ipython-input-29-23906ea1efe3> in <module>()\r\n----> 2 df = pq.read_table('college_data.parquet').to_pandas()\r\n\r\n/Users/anaconda/envs/env/lib/python2.7/site-packages/pyarrow/table.pxi in pyarrow.lib.Table.to_pandas (/Users/travis/build/BryanCutler/arrow-dist/arrow/python/build/temp.macosx-10.6-intel-2.7/lib.cxx:46331)()\r\n   1041         if nthreads is None:\r\n   1042             nthreads = cpu_count()\r\n-> 1043         mgr = pdcompat.table_to_blockmanager(options, self, memory_pool,\r\n   1044                                              nthreads)\r\n   1045         return pd.DataFrame(mgr)\r\n\r\n/Users/anaconda/envs/env/lib/python2.7/site-packages/pyarrow/pandas_compat.pyc in table_to_blockmanager(options, table, memory_pool, nthreads, categoricals)\r\n    539     if columns:\r\n    540         columns_name_dict = {\r\n--> 541             c.get('field_name', str(c['name'])): c['name'] for c in columns\r\n    542         }\r\n    543         columns_values = [\r\n\r\n/Users/anaconda/envs/env/lib/python2.7/site-packages/pyarrow/pandas_compat.pyc in <dictcomp>((c,))\r\n    539     if columns:\r\n    540         columns_name_dict = {\r\n--> 541             c.get('field_name', str(c['name'])): c['name'] for c in columns\r\n    542         }\r\n    543         columns_values = [\r\n\r\nUnicodeEncodeError: 'ascii' codec can't encode character u'\\ufeff' in position 0: ordinal not in range(128)\r\n{code}\r\n\r\nLooking at the stacktrace , it looks like this line, which is using str which by default will try to do ascii encoding: https://github.com/apache/arrow/blob/master/python/pyarrow/pandas_compat.py#L541",
        "customfield_10010": null,
        "timetracking": {},
        "customfield_12314523": null,
        "customfield_12314127": null,
        "customfield_12314522": null,
        "customfield_12314126": null,
        "customfield_12314521": null,
        "customfield_12314125": null,
        "customfield_12314520": null,
        "customfield_12314124": null,
        "attachment": [],
        "customfield_12312340": null,
        "customfield_12314123": null,
        "customfield_12312341": null,
        "customfield_12312220": null,
        "customfield_12314122": null,
        "customfield_12314121": null,
        "customfield_12314120": null,
        "customfield_12314129": null,
        "customfield_12314524": null,
        "customfield_12314128": null,
        "summary": "[Python] Handling unicode pandas columns on parquet.read_table",
        "customfield_12314130": null,
        "customfield_12310291": null,
        "customfield_12310290": null,
        "customfield_12314138": null,
        "customfield_12314137": null,
        "environment": null,
        "customfield_12314136": null,
        "customfield_12314135": null,
        "customfield_12311020": null,
        "customfield_12314134": null,
        "duedate": null,
        "customfield_12314132": null,
        "customfield_12314131": null,
        "comment": {
            "comments": [
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13129122/comment/16318720",
                    "id": "16318720",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=cpcloud",
                        "name": "cpcloud",
                        "key": "cpcloud",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=cpcloud&avatarId=31265",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=cpcloud&avatarId=31265",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=cpcloud&avatarId=31265",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=cpcloud&avatarId=31265"
                        },
                        "displayName": "Phillip Cloud",
                        "active": true,
                        "timeZone": "America/New_York"
                    },
                    "body": "Note this is python 2 specific. You won't run into issues like this if you don't use python 2.\r\n\r\nIf there's no restriction on the version of Python you need to use please use python 3.\r\n\r\nThat said, since we have to support python 2, this is a bug.\r\n\r\nHow is it possible to read in Unicode from a CSV file without specifying an encoding to {{read_csv}}? Pandas must make an assumption about the encoding or choose a default.\r\n\r\nI've also submitted a data issue to data.gov to request that they include the encoding in the metadata.\r\n\r\nhttps://www.data.gov/issue/request-id/635154",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=cpcloud",
                        "name": "cpcloud",
                        "key": "cpcloud",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=cpcloud&avatarId=31265",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=cpcloud&avatarId=31265",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=cpcloud&avatarId=31265",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=cpcloud&avatarId=31265"
                        },
                        "displayName": "Phillip Cloud",
                        "active": true,
                        "timeZone": "America/New_York"
                    },
                    "created": "2018-01-09T16:44:46.252+0000",
                    "updated": "2018-01-09T16:44:46.252+0000"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13129122/comment/16320364",
                    "id": "16320364",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=simbanyatsanga",
                        "name": "simbanyatsanga",
                        "key": "simbanyatsanga",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=simbanyatsanga&avatarId=33891",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=simbanyatsanga&avatarId=33891",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=simbanyatsanga&avatarId=33891",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=simbanyatsanga&avatarId=33891"
                        },
                        "displayName": "Simbarashe Nyatsanga",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "body": "Thanks [~cpcloud] . As far as I can tell in the Pandas code base, the *read_csv* is using *utf-8* by default. Unfortunately it's not possible to upgrade to python3 at this time. I would be keen to pick up and fix this issue but I have been having trouble building pyarrow for python 2.7.",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=simbanyatsanga",
                        "name": "simbanyatsanga",
                        "key": "simbanyatsanga",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=simbanyatsanga&avatarId=33891",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=simbanyatsanga&avatarId=33891",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=simbanyatsanga&avatarId=33891",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=simbanyatsanga&avatarId=33891"
                        },
                        "displayName": "Simbarashe Nyatsanga",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "created": "2018-01-10T14:51:53.707+0000",
                    "updated": "2018-01-10T15:55:16.889+0000"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13129122/comment/16325088",
                    "id": "16325088",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=uwe",
                        "name": "uwe",
                        "key": "xhochy",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=xhochy&avatarId=30652",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=xhochy&avatarId=30652",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=xhochy&avatarId=30652",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=xhochy&avatarId=30652"
                        },
                        "displayName": "Uwe Korn",
                        "active": true,
                        "timeZone": "Europe/Berlin"
                    },
                    "body": "I think this should be simply solved by using {{six.text_type}} here. Not sure about the exact Pandas internals but I have the feeling that it is common with Pandas+Python 2.7 that the columns are {{unicode}}.\r\n\r\n[~simbanyatsanga] Do you want to make this change? What are your build issues? (You might also reach out for support on your build issues on the mailing list dev@arrow.apache.org or on Slack (signup at https://apachearrowslackin.herokuapp.com/ ))",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=uwe",
                        "name": "uwe",
                        "key": "xhochy",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=xhochy&avatarId=30652",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=xhochy&avatarId=30652",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=xhochy&avatarId=30652",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=xhochy&avatarId=30652"
                        },
                        "displayName": "Uwe Korn",
                        "active": true,
                        "timeZone": "Europe/Berlin"
                    },
                    "created": "2018-01-13T11:23:28.657+0000",
                    "updated": "2018-01-13T11:23:28.657+0000"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13129122/comment/16325561",
                    "id": "16325561",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "body": "Licht-T opened a new pull request #1476: ARROW-1976: [Python] Fix Pandas data SerDe with Unicode column names in Python 2.7\nURL: https://github.com/apache/arrow/pull/1476\n \n \n   This closes https://issues.apache.org/jira/browse/ARROW-1976.\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "created": "2018-01-14T13:00:39.471+0000",
                    "updated": "2018-01-14T13:00:39.471+0000"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13129122/comment/16325564",
                    "id": "16325564",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "body": "xhochy commented on a change in pull request #1476: ARROW-1976: [Python] Fix Pandas data SerDe with Unicode column names in Python 2.7\nURL: https://github.com/apache/arrow/pull/1476#discussion_r161396905\n \n \n\n ##########\n File path: python/pyarrow/pandas_compat.py\n ##########\n @@ -544,9 +547,14 @@ def table_to_blockmanager(options, table, memory_pool, nthreads=1,\n \n     column_strings = [x.name for x in block_table.itercolumns()]\n     if columns:\n-        columns_name_dict = {\n-            c.get('field_name', str(c['name'])): c['name'] for c in columns\n-        }\n+        columns_name_dict = {}\n+        for c in columns:\n+            column_name = c['name']\n+            if not isinstance(column_name, six.text_type):\n+                column_name = str(column_name)\n \n Review comment:\n   This should also be `six.text_type` so that we get `unicode` in Python 2. Probably, using `.decode('utf-8')` might also be the better option.\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "created": "2018-01-14T13:03:12.938+0000",
                    "updated": "2018-01-14T13:03:12.938+0000"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13129122/comment/16329053",
                    "id": "16329053",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "body": "wesm commented on a change in pull request #1476: ARROW-1976: [Python] Fix Pandas data SerDe with Unicode column names in Python 2.7\nURL: https://github.com/apache/arrow/pull/1476#discussion_r162120769\n \n \n\n ##########\n File path: python/pyarrow/pandas_compat.py\n ##########\n @@ -544,9 +547,14 @@ def table_to_blockmanager(options, table, memory_pool, nthreads=1,\n \n     column_strings = [x.name for x in block_table.itercolumns()]\n     if columns:\n-        columns_name_dict = {\n-            c.get('field_name', str(c['name'])): c['name'] for c in columns\n-        }\n+        columns_name_dict = {}\n+        for c in columns:\n+            column_name = c['name']\n+            if not isinstance(column_name, six.text_type):\n+                column_name = str(column_name)\n \n Review comment:\n   There is also `frombytes` in `pyarrow.compat`\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "created": "2018-01-17T17:24:02.908+0000",
                    "updated": "2018-01-17T17:24:02.908+0000"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13129122/comment/16338469",
                    "id": "16338469",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "body": "Licht-T commented on issue #1476: ARROW-1976: [Python] Fix Pandas data SerDe with Unicode column names in Python 2.7\nURL: https://github.com/apache/arrow/pull/1476#issuecomment-360318842\n \n \n   Thanks @xhochy, fixed!\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "created": "2018-01-25T00:18:57.906+0000",
                    "updated": "2018-01-25T00:18:57.906+0000"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13129122/comment/16340213",
                    "id": "16340213",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "body": "xhochy commented on a change in pull request #1476: ARROW-1976: [Python] Fix Pandas data SerDe with Unicode column names in Python 2.7\nURL: https://github.com/apache/arrow/pull/1476#discussion_r163988326\n \n \n\n ##########\n File path: python/pyarrow/pandas_compat.py\n ##########\n @@ -544,9 +547,14 @@ def table_to_blockmanager(options, table, memory_pool, nthreads=1,\n \n     column_strings = [x.name for x in block_table.itercolumns()]\n     if columns:\n-        columns_name_dict = {\n-            c.get('field_name', str(c['name'])): c['name'] for c in columns\n-        }\n+        columns_name_dict = {}\n+        for c in columns:\n+            column_name = c['name']\n+            if not isinstance(column_name, six.text_type):\n+                column_name = frombytes(str(column_name))\n \n Review comment:\n   `frombytes` works only on `bytes`. Thus the above code is valid in Python 2 but breaks the unittests for Python 3. Removing the `str` should fix this.\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "created": "2018-01-25T22:33:11.087+0000",
                    "updated": "2018-01-25T22:33:11.087+0000"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13129122/comment/16345713",
                    "id": "16345713",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "body": "wesm commented on issue #1476: ARROW-1976: [Python] Fix Pandas data SerDe with Unicode column names in Python 2.7\nURL: https://github.com/apache/arrow/pull/1476#issuecomment-361717583\n \n \n   I'm looking at this patch to get it passing\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "created": "2018-01-30T20:04:58.581+0000",
                    "updated": "2018-01-30T20:04:58.581+0000"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13129122/comment/16345732",
                    "id": "16345732",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "body": "Licht-T commented on issue #1476: ARROW-1976: [Python] Fix Pandas data SerDe with Unicode column names in Python 2.7\nURL: https://github.com/apache/arrow/pull/1476#issuecomment-361720427\n \n \n   Sorry @wesm! Ths totally slipped my mind!\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "created": "2018-01-30T20:15:28.912+0000",
                    "updated": "2018-01-30T20:15:28.912+0000"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13129122/comment/16348612",
                    "id": "16348612",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "body": "wesm commented on issue #1476: ARROW-1976: [Python] Fix Pandas data SerDe with Unicode column names in Python 2.7\nURL: https://github.com/apache/arrow/pull/1476#issuecomment-362272962\n \n \n   Can someone look at getting this ready to merge? I'm drowning trying to get on top of the PR queue and e-mail firehose. @cpcloud @xhochy \n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "created": "2018-02-01T13:57:02.491+0000",
                    "updated": "2018-02-01T13:57:02.491+0000"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13129122/comment/16348651",
                    "id": "16348651",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "body": "ylogx commented on issue #1476: ARROW-1976: [Python] Fix Pandas data SerDe with Unicode column names in Python 2.7\nURL: https://github.com/apache/arrow/pull/1476#issuecomment-362284536\n \n \n   I'd like to help. If it's fine with @Licht-T, I can pull his branch and create a new PR to add the required changes there.\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "created": "2018-02-01T14:37:33.544+0000",
                    "updated": "2018-02-01T14:37:33.544+0000"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13129122/comment/16348712",
                    "id": "16348712",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "body": "simnyatsanga commented on issue #1476: ARROW-1976: [Python] Fix Pandas data SerDe with Unicode column names in Python 2.7\nURL: https://github.com/apache/arrow/pull/1476#issuecomment-362295825\n \n \n   @Licht-T @wesm @ylogx I made a PR with the requested feedback in this main PR here: https://github.com/Licht-T/arrow/pull/1 . Hopefully this is ok.\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "created": "2018-02-01T15:13:51.610+0000",
                    "updated": "2018-02-01T15:13:51.610+0000"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13129122/comment/16349033",
                    "id": "16349033",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "body": "xhochy commented on issue #1476: ARROW-1976: [Python] Fix Pandas data SerDe with Unicode column names in Python 2.7\nURL: https://github.com/apache/arrow/pull/1476#issuecomment-362354539\n \n \n   Together with the changes from @simnyatsanga this is good to go.\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "created": "2018-02-01T18:16:08.082+0000",
                    "updated": "2018-02-01T18:16:08.082+0000"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13129122/comment/16349391",
                    "id": "16349391",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "body": "wesm commented on issue #1476: ARROW-1976: [Python] Fix Pandas data SerDe with Unicode column names in Python 2.7\nURL: https://github.com/apache/arrow/pull/1476#issuecomment-362423668\n \n \n   Cool, I just merged the changes, will await the CI to run\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "created": "2018-02-01T22:29:06.743+0000",
                    "updated": "2018-02-01T22:29:06.743+0000"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13129122/comment/16349803",
                    "id": "16349803",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "body": "wesm commented on issue #1476: ARROW-1976: [Python] Fix Pandas data SerDe with Unicode column names in Python 2.7\nURL: https://github.com/apache/arrow/pull/1476#issuecomment-362488751\n \n \n   This is still failing\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "created": "2018-02-02T05:14:52.932+0000",
                    "updated": "2018-02-02T05:14:52.932+0000"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13129122/comment/16350401",
                    "id": "16350401",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "body": "simnyatsanga commented on issue #1476: ARROW-1976: [Python] Fix Pandas data SerDe with Unicode column names in Python 2.7\nURL: https://github.com/apache/arrow/pull/1476#issuecomment-362601973\n \n \n   I'm looking at getting the failing tests to pass. Specifically one of the failing  tests looks like this\r\n   https://github.com/apache/arrow/blob/master/python/pyarrow/tests/test_convert_pandas.py#L141\r\n   ```\r\n   def test_multiindex_columns(self):\r\n           columns = pd.MultiIndex.from_arrays([\r\n               ['one', 'two'], ['X', 'Y']\r\n           ])\r\n           df = pd.DataFrame([(1, 'a'), (2, 'b'), (3, 'c')], columns=columns)\r\n           _check_pandas_roundtrip(df, preserve_index=True)\r\n   ```\r\n   The pandas roundtrip is failing in this branch on this line: https://github.com/apache/arrow/blob/master/python/pyarrow/pandas_compat.py#L166\r\n   Because the `column_name` (which is part of a MultiIndex) is coming in as a tuple instead of a string. On master the `column_name` is indeed coming in as a string. I'm trying to figure out, what changes on this branch would cause this.\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "created": "2018-02-02T14:32:37.464+0000",
                    "updated": "2018-02-02T14:32:37.464+0000"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13129122/comment/16350697",
                    "id": "16350697",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "body": "cpcloud commented on issue #1476: ARROW-1976: [Python] Fix Pandas data SerDe with Unicode column names in Python 2.7\nURL: https://github.com/apache/arrow/pull/1476#issuecomment-362650823\n \n \n   @Licht-T @wesm @simnyatsanga I'm taking a look at this now.\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "created": "2018-02-02T17:30:09.603+0000",
                    "updated": "2018-02-02T17:30:09.603+0000"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13129122/comment/16350760",
                    "id": "16350760",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "body": "cpcloud commented on issue #1476: ARROW-1976: [Python] Fix Pandas data SerDe with Unicode column names in Python 2.7\nURL: https://github.com/apache/arrow/pull/1476#issuecomment-362663240\n \n \n   This is failing because of an assumption about the behavior of `frombytes`. Pushing up a fix shortly.\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "created": "2018-02-02T18:17:58.073+0000",
                    "updated": "2018-02-02T18:17:58.073+0000"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13129122/comment/16351176",
                    "id": "16351176",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "body": "cpcloud commented on issue #1476: ARROW-1976: [Python] Handling unicode pandas columns on parquet.read_table\nURL: https://github.com/apache/arrow/pull/1476#issuecomment-362762284\n \n \n   @Licht-T closing in favor of #1553\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "created": "2018-02-03T01:39:20.057+0000",
                    "updated": "2018-02-03T01:39:20.057+0000"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13129122/comment/16351177",
                    "id": "16351177",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "body": "cpcloud closed pull request #1476: ARROW-1976: [Python] Handling unicode pandas columns on parquet.read_table\nURL: https://github.com/apache/arrow/pull/1476\n \n \n   \n\nThis is a PR merged from a forked repository.\nAs GitHub hides the original diff on merge, it is displayed below for\nthe sake of provenance:\n\nAs this is a foreign pull request (from a fork), the diff is supplied\nbelow (as it won't show otherwise due to GitHub magic):\n\ndiff --git a/python/pyarrow/pandas_compat.py b/python/pyarrow/pandas_compat.py\nindex 4a30fb3b4..610eecdfd 100644\n--- a/python/pyarrow/pandas_compat.py\n+++ b/python/pyarrow/pandas_compat.py\n@@ -27,7 +27,7 @@\n import six\n \n import pyarrow as pa\n-from pyarrow.compat import PY2, zip_longest  # noqa\n+from pyarrow.compat import PY2, zip_longest, frombytes  # noqa\n \n \n def infer_dtype(column):\n@@ -170,9 +170,12 @@ def get_column_metadata(column, name, arrow_type, field_name):\n             )\n         )\n \n+    if not isinstance(field_name, six.string_types):\n+        field_name = frombytes(field_name)\n+\n     return {\n         'name': name,\n-        'field_name': str(field_name),\n+        'field_name': field_name,\n         'pandas_type': logical_type,\n         'numpy_type': string_dtype,\n         'metadata': extra_metadata,\n@@ -316,7 +319,7 @@ def dataframe_to_arrays(df, schema, preserve_index, nthreads=1):\n         if not isinstance(name, six.string_types):\n             name = _column_name_to_strings(name)\n             if name is not None:\n-                name = str(name)\n+                name = frombytes(name)\n \n         if schema is not None:\n             field = schema.field_by_name(name)\n@@ -543,9 +546,14 @@ def table_to_blockmanager(options, table, memory_pool, nthreads=1,\n \n     column_strings = [x.name for x in block_table.itercolumns()]\n     if columns:\n-        columns_name_dict = {\n-            c.get('field_name', str(c['name'])): c['name'] for c in columns\n-        }\n+        columns_name_dict = {}\n+        for c in columns:\n+            column_name = c['name']\n+            if not isinstance(column_name, six.text_type):\n+                column_name = frombytes(column_name)\n+\n+            columns_name_dict[c.get('field_name', column_name)] = c['name']\n+\n         columns_values = [\n             columns_name_dict.get(name, name) for name in column_strings\n         ]\ndiff --git a/python/pyarrow/tests/test_convert_pandas.py b/python/pyarrow/tests/test_convert_pandas.py\nindex ca2f1e361..5b16bd7ff 100644\n--- a/python/pyarrow/tests/test_convert_pandas.py\n+++ b/python/pyarrow/tests/test_convert_pandas.py\n@@ -518,6 +518,11 @@ def test_unicode(self):\n \n         _check_pandas_roundtrip(df, expected_schema=schema)\n \n+    def test_unicode_with_unicode_column_and_index(self):\n+        df = pd.DataFrame({u'\u3042': [u'\u3044']}, index=[u'\u3046'])\n+\n+        _check_pandas_roundtrip(df, preserve_index=True)\n+\n     def test_bytes_to_binary(self):\n         values = [u('qux'), b'foo', None, 'bar', 'qux', np.nan]\n         df = pd.DataFrame({'strings': values})\n\n\n \n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "created": "2018-02-03T01:39:25.655+0000",
                    "updated": "2018-02-03T01:39:25.655+0000"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13129122/comment/16351364",
                    "id": "16351364",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "body": "jorisvandenbossche commented on a change in pull request #1553: ARROW-1976: [Python] Handling unicode pandas columns on parquet.read_table\nURL: https://github.com/apache/arrow/pull/1553#discussion_r165811921\n \n \n\n ##########\n File path: python/pyarrow/pandas_compat.py\n ##########\n @@ -172,7 +172,10 @@ def get_column_metadata(column, name, arrow_type, field_name):\n \n     return {\n         'name': name,\n-        'field_name': str(field_name),\n+        'field_name': (\n+            'None' if field_name is None\n+            else _column_name_to_strings(field_name)\n \n Review comment:\n   Is this call to `_column_name_to_strings` necessary? I would think that was already done for field_name when you end up here\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "created": "2018-02-03T11:11:05.944+0000",
                    "updated": "2018-02-03T11:11:05.944+0000"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13129122/comment/16351593",
                    "id": "16351593",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "body": "wesm commented on issue #1553: ARROW-1976: [Python] Handling unicode pandas columns on parquet.read_table\nURL: https://github.com/apache/arrow/pull/1553#issuecomment-362870812\n \n \n   Any chance anyone has time to look at getting our CI rehabilitated so we can get a passing CI build? https://github.com/apache/arrow/pull/1548 still has some Windows issues\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "created": "2018-02-04T01:03:47.138+0000",
                    "updated": "2018-02-04T01:03:47.138+0000"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13129122/comment/16351596",
                    "id": "16351596",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "body": "cpcloud commented on issue #1553: ARROW-1976: [Python] Handling unicode pandas columns on parquet.read_table\nURL: https://github.com/apache/arrow/pull/1553#issuecomment-362871857\n \n \n   @wesm Looking now.\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "created": "2018-02-04T01:24:08.092+0000",
                    "updated": "2018-02-04T01:24:08.092+0000"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13129122/comment/16351605",
                    "id": "16351605",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "body": "cpcloud commented on a change in pull request #1553: ARROW-1976: [Python] Handling unicode pandas columns on parquet.read_table\nURL: https://github.com/apache/arrow/pull/1553#discussion_r165831215\n \n \n\n ##########\n File path: python/pyarrow/pandas_compat.py\n ##########\n @@ -172,7 +172,10 @@ def get_column_metadata(column, name, arrow_type, field_name):\n \n     return {\n         'name': name,\n-        'field_name': str(field_name),\n+        'field_name': (\n+            'None' if field_name is None\n+            else _column_name_to_strings(field_name)\n \n Review comment:\n   Nope, removed it.\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "created": "2018-02-04T02:07:26.741+0000",
                    "updated": "2018-02-04T02:07:26.741+0000"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13129122/comment/16353083",
                    "id": "16353083",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "body": "wesm commented on issue #1553: ARROW-1976: [Python] Handling unicode pandas columns on parquet.read_table\nURL: https://github.com/apache/arrow/pull/1553#issuecomment-363255300\n \n \n   Appveyor build is running here: https://ci.appveyor.com/project/cpcloud/arrow/build/1.0.516. Will merge once that is looking good\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "created": "2018-02-05T23:21:29.921+0000",
                    "updated": "2018-02-05T23:21:29.921+0000"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13129122/comment/16353145",
                    "id": "16353145",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=wesm",
                        "name": "wesm",
                        "key": "wesmckinn",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=wesmckinn&avatarId=29931",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=wesmckinn&avatarId=29931",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=wesmckinn&avatarId=29931",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=wesmckinn&avatarId=29931"
                        },
                        "displayName": "Wes McKinney",
                        "active": true,
                        "timeZone": "America/New_York"
                    },
                    "body": "Issue resolved by pull request 1553\n[https://github.com/apache/arrow/pull/1553]",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=wesm",
                        "name": "wesm",
                        "key": "wesmckinn",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=wesmckinn&avatarId=29931",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=wesmckinn&avatarId=29931",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=wesmckinn&avatarId=29931",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=wesmckinn&avatarId=29931"
                        },
                        "displayName": "Wes McKinney",
                        "active": true,
                        "timeZone": "America/New_York"
                    },
                    "created": "2018-02-06T00:27:48.597+0000",
                    "updated": "2018-02-06T00:27:48.597+0000"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13129122/comment/16353146",
                    "id": "16353146",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "body": "wesm closed pull request #1553: ARROW-1976: [Python] Handling unicode pandas columns on parquet.read_table\nURL: https://github.com/apache/arrow/pull/1553\n \n \n   \n\nThis is a PR merged from a forked repository.\nAs GitHub hides the original diff on merge, it is displayed below for\nthe sake of provenance:\n\nAs this is a foreign pull request (from a fork), the diff is supplied\nbelow (as it won't show otherwise due to GitHub magic):\n\ndiff --git a/.gitignore b/.gitignore\nindex e6dfe19bb..c38694e1f 100644\n--- a/.gitignore\n+++ b/.gitignore\n@@ -29,3 +29,4 @@ cpp/.idea/\n python/.eggs/\n .vscode\n .idea/\n+.pytest_cache/\ndiff --git a/python/pyarrow/pandas_compat.py b/python/pyarrow/pandas_compat.py\nindex 240cccdaf..987bb7555 100644\n--- a/python/pyarrow/pandas_compat.py\n+++ b/python/pyarrow/pandas_compat.py\n@@ -170,9 +170,11 @@ def get_column_metadata(column, name, arrow_type, field_name):\n             )\n         )\n \n+    assert field_name is None or isinstance(field_name, six.string_types), \\\n+        str(type(field_name))\n     return {\n         'name': name,\n-        'field_name': str(field_name),\n+        'field_name': 'None' if field_name is None else field_name,\n         'pandas_type': logical_type,\n         'numpy_type': string_dtype,\n         'metadata': extra_metadata,\n@@ -279,8 +281,11 @@ def _column_name_to_strings(name):\n     \"\"\"\n     if isinstance(name, six.string_types):\n         return name\n+    elif isinstance(name, six.binary_type):\n+        # XXX: should we assume that bytes in Python 3 are UTF-8?\n+        return name.decode('utf8')\n     elif isinstance(name, tuple):\n-        return tuple(map(_column_name_to_strings, name))\n+        return str(tuple(map(_column_name_to_strings, name)))\n     elif isinstance(name, collections.Sequence):\n         raise TypeError(\"Unsupported type for MultiIndex level\")\n     elif name is None:\n@@ -327,10 +332,7 @@ def dataframe_to_arrays(df, schema, preserve_index, nthreads=1):\n \n     for name in df.columns:\n         col = df[name]\n-        if not isinstance(name, six.string_types):\n-            name = _column_name_to_strings(name)\n-            if name is not None:\n-                name = str(name)\n+        name = _column_name_to_strings(name)\n \n         if schema is not None:\n             field = schema.field_by_name(name)\n@@ -561,7 +563,8 @@ def table_to_blockmanager(options, table, memory_pool, nthreads=1,\n     column_strings = [x.name for x in block_table.itercolumns()]\n     if columns:\n         columns_name_dict = {\n-            c.get('field_name', str(c['name'])): c['name'] for c in columns\n+            c.get('field_name', _column_name_to_strings(c['name'])): c['name']\n+            for c in columns\n         }\n         columns_values = [\n             columns_name_dict.get(name, name) for name in column_strings\ndiff --git a/python/pyarrow/parquet.py b/python/pyarrow/parquet.py\nindex 8820b6b4a..494e65ebb 100644\n--- a/python/pyarrow/parquet.py\n+++ b/python/pyarrow/parquet.py\n@@ -939,7 +939,7 @@ def write_table(table, where, row_group_size=None, version='1.0',\n                 coerce_timestamps=None,\n                 flavor=None, **kwargs):\n     row_group_size = kwargs.pop('chunk_size', row_group_size)\n-\n+    use_int96 = use_deprecated_int96_timestamps\n     try:\n         with ParquetWriter(\n                 where, table.schema,\n@@ -948,7 +948,7 @@ def write_table(table, where, row_group_size=None, version='1.0',\n                 use_dictionary=use_dictionary,\n                 coerce_timestamps=coerce_timestamps,\n                 compression=compression,\n-                use_deprecated_int96_timestamps= use_deprecated_int96_timestamps, # noqa\n+                use_deprecated_int96_timestamps=use_int96,\n                 **kwargs) as writer:\n             writer.write_table(table, row_group_size=row_group_size)\n     except Exception:\ndiff --git a/python/pyarrow/tests/test_convert_pandas.py b/python/pyarrow/tests/test_convert_pandas.py\nindex 31099072f..4f0a68729 100644\n--- a/python/pyarrow/tests/test_convert_pandas.py\n+++ b/python/pyarrow/tests/test_convert_pandas.py\n@@ -156,6 +156,11 @@ def test_multiindex_columns_with_dtypes(self):\n         df = pd.DataFrame([(1, 'a'), (2, 'b'), (3, 'c')], columns=columns)\n         _check_pandas_roundtrip(df, preserve_index=True)\n \n+    def test_multiindex_columns_unicode(self):\n+        columns = pd.MultiIndex.from_arrays([[u'\u3042', u'\u3044'], ['X', 'Y']])\n+        df = pd.DataFrame([(1, 'a'), (2, 'b'), (3, 'c')], columns=columns)\n+        _check_pandas_roundtrip(df, preserve_index=True)\n+\n     def test_integer_index_column(self):\n         df = pd.DataFrame([(1, 'a'), (2, 'b'), (3, 'c')])\n         _check_pandas_roundtrip(df, preserve_index=True)\n@@ -519,6 +524,31 @@ def test_unicode(self):\n \n         _check_pandas_roundtrip(df, expected_schema=schema)\n \n+    def test_unicode_with_unicode_column_and_index(self):\n+        df = pd.DataFrame({u'\u3042': [u'\u3044']}, index=[u'\u3046'])\n+\n+        _check_pandas_roundtrip(df, preserve_index=True)\n+\n+    def test_mixed_unicode_column_names(self):\n+        df = pd.DataFrame({u'\u3042': [u'\u3044'], b'a': 1}, index=[u'\u3046'])\n+\n+        # TODO(phillipc): Should this raise?\n+        with pytest.raises(AssertionError):\n+            _check_pandas_roundtrip(df, preserve_index=True)\n+\n+    def test_binary_column_name(self):\n+        column_data = [u'\u3044']\n+        data = {u'\u3042'.encode('utf8'): column_data}\n+        df = pd.DataFrame(data)\n+\n+        # we can't use _check_pandas_roundtrip here because our metdata\n+        # is always decoded as utf8: even if binary goes in, utf8 comes out\n+        t = pa.Table.from_pandas(df, preserve_index=True)\n+        df2 = t.to_pandas()\n+        assert df.values[0] == df2.values[0]\n+        assert df.index.values[0] == df2.index.values[0]\n+        assert df.columns[0] == df2.columns[0].encode('utf8')\n+\n     def test_bytes_to_binary(self):\n         values = [u('qux'), b'foo', None, 'bar', 'qux', np.nan]\n         df = pd.DataFrame({'strings': values})\n\n\n \n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "created": "2018-02-06T00:27:51.610+0000",
                    "updated": "2018-02-06T00:27:51.610+0000"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13129122/comment/16354351",
                    "id": "16354351",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "body": "simnyatsanga commented on issue #1553: ARROW-1976: [Python] Handling unicode pandas columns on parquet.read_table\nURL: https://github.com/apache/arrow/pull/1553#issuecomment-363529182\n \n \n   @wesm @cpcloud Thanks so much for resolving this issue!\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "created": "2018-02-06T19:02:48.914+0000",
                    "updated": "2018-02-06T19:02:48.914+0000"
                }
            ],
            "maxResults": 29,
            "total": 29,
            "startAt": 0
        },
        "customfield_12311820": "0|i3om6n:",
        "customfield_12314139": null
    }
}