{
    "expand": "operations,versionedRepresentations,editmeta,changelog,renderedFields",
    "id": "13360856",
    "self": "https://issues.apache.org/jira/rest/api/2/issue/13360856",
    "key": "ARROW-11776",
    "fields": {
        "fixVersions": [
            {
                "self": "https://issues.apache.org/jira/rest/api/2/version/12352360",
                "id": "12352360",
                "description": "",
                "name": "11.0.0",
                "archived": false,
                "released": false
            }
        ],
        "resolution": {
            "self": "https://issues.apache.org/jira/rest/api/2/resolution/1",
            "id": "1",
            "description": "A fix for this issue is checked into the tree and tested.",
            "name": "Fixed"
        },
        "customfield_12312322": null,
        "customfield_12312323": null,
        "customfield_12312320": null,
        "customfield_12310420": "9223372036854775807",
        "customfield_12312321": null,
        "customfield_12312328": null,
        "customfield_12312329": null,
        "customfield_12312326": null,
        "customfield_12310300": null,
        "customfield_12312327": null,
        "customfield_12312324": null,
        "customfield_12312720": null,
        "customfield_12312325": null,
        "lastViewed": null,
        "priority": {
            "self": "https://issues.apache.org/jira/rest/api/2/priority/3",
            "iconUrl": "https://issues.apache.org/jira/images/icons/priorities/major.svg",
            "name": "Major",
            "id": "3"
        },
        "labels": [
            "pull-request-available"
        ],
        "customfield_12312333": null,
        "customfield_12312334": null,
        "customfield_12313422": "false",
        "customfield_12310310": "0.0",
        "customfield_12312331": null,
        "customfield_12312332": null,
        "aggregatetimeoriginalestimate": null,
        "timeestimate": 0,
        "customfield_12312330": null,
        "versions": [],
        "customfield_12311120": null,
        "customfield_12313826": null,
        "customfield_12312339": null,
        "issuelinks": [
            {
                "id": "12647723",
                "self": "https://issues.apache.org/jira/rest/api/2/issueLink/12647723",
                "type": {
                    "id": "12310000",
                    "name": "Duplicate",
                    "inward": "is duplicated by",
                    "outward": "duplicates",
                    "self": "https://issues.apache.org/jira/rest/api/2/issueLinkType/12310000"
                },
                "inwardIssue": {
                    "id": "13481815",
                    "key": "ARROW-17752",
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13481815",
                    "fields": {
                        "summary": "Support JNI-based parquet write to write datasets into files",
                        "status": {
                            "self": "https://issues.apache.org/jira/rest/api/2/status/6",
                            "description": "The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.",
                            "iconUrl": "https://issues.apache.org/jira/images/icons/statuses/closed.png",
                            "name": "Closed",
                            "id": "6",
                            "statusCategory": {
                                "self": "https://issues.apache.org/jira/rest/api/2/statuscategory/3",
                                "id": 3,
                                "key": "done",
                                "colorName": "green",
                                "name": "Done"
                            }
                        },
                        "priority": {
                            "self": "https://issues.apache.org/jira/rest/api/2/priority/3",
                            "iconUrl": "https://issues.apache.org/jira/images/icons/priorities/major.svg",
                            "name": "Major",
                            "id": "3"
                        },
                        "issuetype": {
                            "self": "https://issues.apache.org/jira/rest/api/2/issuetype/2",
                            "id": "2",
                            "description": "A new feature of the product, which has yet to be developed.",
                            "iconUrl": "https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21141&avatarType=issuetype",
                            "name": "New Feature",
                            "subtask": false,
                            "avatarId": 21141
                        }
                    }
                }
            },
            {
                "id": "12616754",
                "self": "https://issues.apache.org/jira/rest/api/2/issueLink/12616754",
                "type": {
                    "id": "12310010",
                    "name": "Incorporates",
                    "inward": "is part of",
                    "outward": "incorporates",
                    "self": "https://issues.apache.org/jira/rest/api/2/issueLinkType/12310010"
                },
                "inwardIssue": {
                    "id": "13259171",
                    "key": "ARROW-6720",
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13259171",
                    "fields": {
                        "summary": "[JAVA][C++]Support Parquet Read and Write in Java",
                        "status": {
                            "self": "https://issues.apache.org/jira/rest/api/2/status/4",
                            "description": "This issue was once resolved, but the resolution was deemed incorrect. From here issues are either marked assigned or resolved.",
                            "iconUrl": "https://issues.apache.org/jira/images/icons/statuses/reopened.png",
                            "name": "Reopened",
                            "id": "4",
                            "statusCategory": {
                                "self": "https://issues.apache.org/jira/rest/api/2/statuscategory/2",
                                "id": 2,
                                "key": "new",
                                "colorName": "blue-gray",
                                "name": "To Do"
                            }
                        },
                        "priority": {
                            "self": "https://issues.apache.org/jira/rest/api/2/priority/3",
                            "iconUrl": "https://issues.apache.org/jira/images/icons/priorities/major.svg",
                            "name": "Major",
                            "id": "3"
                        },
                        "issuetype": {
                            "self": "https://issues.apache.org/jira/rest/api/2/issuetype/2",
                            "id": "2",
                            "description": "A new feature of the product, which has yet to be developed.",
                            "iconUrl": "https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21141&avatarType=issuetype",
                            "name": "New Feature",
                            "subtask": false,
                            "avatarId": 21141
                        }
                    }
                }
            }
        ],
        "customfield_12313825": null,
        "assignee": {
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=Jk_Self",
            "name": "Jk_Self",
            "key": "jk_self",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
            },
            "displayName": "Ke Jia",
            "active": true,
            "timeZone": "Etc/UTC"
        },
        "customfield_12312337": null,
        "customfield_12313823": null,
        "customfield_12312338": null,
        "customfield_12311920": null,
        "customfield_12313822": null,
        "customfield_12312335": null,
        "customfield_12313821": null,
        "customfield_12312336": null,
        "customfield_12313820": null,
        "status": {
            "self": "https://issues.apache.org/jira/rest/api/2/status/5",
            "description": "A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.",
            "iconUrl": "https://issues.apache.org/jira/images/icons/statuses/resolved.png",
            "name": "Resolved",
            "id": "5",
            "statusCategory": {
                "self": "https://issues.apache.org/jira/rest/api/2/statuscategory/3",
                "id": 3,
                "key": "done",
                "colorName": "green",
                "name": "Done"
            }
        },
        "components": [
            {
                "self": "https://issues.apache.org/jira/rest/api/2/component/12328933",
                "id": "12328933",
                "name": "Java"
            }
        ],
        "customfield_12312026": null,
        "customfield_12312023": null,
        "customfield_12312024": null,
        "aggregatetimeestimate": 0,
        "customfield_12312022": null,
        "customfield_12310921": null,
        "customfield_12310920": "9223372036854775807",
        "customfield_12312823": null,
        "creator": {
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=zhztheplayer",
            "name": "zhztheplayer",
            "key": "zhztheplayer",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
            },
            "displayName": "Hongze Zhang",
            "active": true,
            "timeZone": "Etc/UTC"
        },
        "subtasks": [],
        "reporter": {
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=zhztheplayer",
            "name": "zhztheplayer",
            "key": "zhztheplayer",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
            },
            "displayName": "Hongze Zhang",
            "active": true,
            "timeZone": "Etc/UTC"
        },
        "aggregateprogress": {
            "progress": 45600,
            "total": 45600,
            "percent": 100
        },
        "customfield_12313520": null,
        "customfield_12310250": null,
        "progress": {
            "progress": 45600,
            "total": 45600,
            "percent": 100
        },
        "customfield_12313924": null,
        "votes": {
            "self": "https://issues.apache.org/jira/rest/api/2/issue/ARROW-11776/votes",
            "votes": 1,
            "hasVoted": false
        },
        "worklog": {
            "startAt": 0,
            "maxResults": 20,
            "total": 76,
            "worklogs": [
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13360856/worklog/585630",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "zhztheplayer opened a new pull request #10108:\nURL: https://github.com/apache/arrow/pull/10108\n\n\n   \n\n\n-- \nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2021-04-20T07:51:38.797+0000",
                    "updated": "2021-04-20T07:51:38.797+0000",
                    "started": "2021-04-20T07:51:38.797+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "585630",
                    "issueId": "13360856"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13360856/worklog/585631",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "github-actions[bot] commented on pull request #10108:\nURL: https://github.com/apache/arrow/pull/10108#issuecomment-823061085\n\n\n   <!--\n     Licensed to the Apache Software Foundation (ASF) under one\n     or more contributor license agreements.  See the NOTICE file\n     distributed with this work for additional information\n     regarding copyright ownership.  The ASF licenses this file\n     to you under the Apache License, Version 2.0 (the\n     \"License\"); you may not use this file except in compliance\n     with the License.  You may obtain a copy of the License at\n   \n       http://www.apache.org/licenses/LICENSE-2.0\n   \n     Unless required by applicable law or agreed to in writing,\n     software distributed under the License is distributed on an\n     \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n     KIND, either express or implied.  See the License for the\n     specific language governing permissions and limitations\n     under the License.\n   -->\n   \n   Thanks for opening a pull request!\n   \n   If this is not a [minor PR](https://github.com/apache/arrow/blob/master/CONTRIBUTING.md#Minor-Fixes). Could you open an issue for this pull request on JIRA? https://issues.apache.org/jira/browse/ARROW\n   \n   Opening JIRAs ahead of time contributes to the [Openness](http://theapacheway.com/open/#:~:text=Openness%20allows%20new%20users%20the,must%20happen%20in%20the%20open.) of the Apache Arrow project.\n   \n   Then could you also rename pull request title in the following format?\n   \n       ARROW-${JIRA_ID}: [${COMPONENT}] ${SUMMARY}\n   \n   or\n   \n       MINOR: [${COMPONENT}] ${SUMMARY}\n   \n   See also:\n   \n     * [Other pull requests](https://github.com/apache/arrow/pulls/)\n     * [Contribution Guidelines - How to contribute patches](https://arrow.apache.org/docs/developers/contributing.html#how-to-contribute-patches)\n   \n\n\n-- \nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2021-04-20T07:52:12.550+0000",
                    "updated": "2021-04-20T07:52:12.550+0000",
                    "started": "2021-04-20T07:52:12.550+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "585631",
                    "issueId": "13360856"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13360856/worklog/588607",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "emkornfield commented on a change in pull request #10108:\nURL: https://github.com/apache/arrow/pull/10108#discussion_r619886485\n\n\n\n##########\nFile path: cpp/src/jni/dataset/jni_util.cc\n##########\n@@ -211,32 +234,140 @@ std::vector<std::string> ToStringVector(JNIEnv* env, jobjectArray& str_array) {\n   return vector;\n }\n \n-arrow::Result<jbyteArray> ToSchemaByteArray(JNIEnv* env,\n-                                            std::shared_ptr<arrow::Schema> schema) {\n-  ARROW_ASSIGN_OR_RAISE(\n-      std::shared_ptr<arrow::Buffer> buffer,\n-      arrow::ipc::SerializeSchema(*schema, arrow::default_memory_pool()))\n+Result<jbyteArray> ToSchemaByteArray(JNIEnv* env, std::shared_ptr<Schema> schema) {\n+  ARROW_ASSIGN_OR_RAISE(std::shared_ptr<Buffer> buffer,\n+                        ipc::SerializeSchema(*schema, default_memory_pool()))\n \n   jbyteArray out = env->NewByteArray(buffer->size());\n   auto src = reinterpret_cast<const jbyte*>(buffer->data());\n   env->SetByteArrayRegion(out, 0, buffer->size(), src);\n   return out;\n }\n \n-arrow::Result<std::shared_ptr<arrow::Schema>> FromSchemaByteArray(\n-    JNIEnv* env, jbyteArray schemaBytes) {\n-  arrow::ipc::DictionaryMemo in_memo;\n+Result<std::shared_ptr<Schema>> FromSchemaByteArray(JNIEnv* env, jbyteArray schemaBytes) {\n+  ipc::DictionaryMemo in_memo;\n   int schemaBytes_len = env->GetArrayLength(schemaBytes);\n   jbyte* schemaBytes_data = env->GetByteArrayElements(schemaBytes, nullptr);\n-  auto serialized_schema = std::make_shared<arrow::Buffer>(\n+  auto serialized_schema = std::make_shared<Buffer>(\n       reinterpret_cast<uint8_t*>(schemaBytes_data), schemaBytes_len);\n-  arrow::io::BufferReader buf_reader(serialized_schema);\n-  ARROW_ASSIGN_OR_RAISE(std::shared_ptr<arrow::Schema> schema,\n-                        arrow::ipc::ReadSchema(&buf_reader, &in_memo))\n+  io::BufferReader buf_reader(serialized_schema);\n+  ARROW_ASSIGN_OR_RAISE(std::shared_ptr<Schema> schema,\n+                        ipc::ReadSchema(&buf_reader, &in_memo))\n   env->ReleaseByteArrayElements(schemaBytes, schemaBytes_data, JNI_ABORT);\n   return schema;\n }\n \n+Status SetSingleField(std::shared_ptr<ArrayData> array_data,\n+                      UnsafeNativeManagedRecordBatchProto& batch_proto) {\n+  FieldProto* field_adder = batch_proto.add_fields();\n+  field_adder->set_length(array_data->length);\n+  field_adder->set_nullcount(array_data->null_count);\n+\n+  std::vector<std::shared_ptr<Buffer>> buffers;\n+  for (const auto& buffer : array_data->buffers) {\n+    buffers.push_back(buffer);\n+  }\n\nReview comment:\n       seems like this loop and the loop below could be combinded.\n\n\n\n\n-- \nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2021-04-25T22:09:41.050+0000",
                    "updated": "2021-04-25T22:09:41.050+0000",
                    "started": "2021-04-25T22:09:41.050+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "588607",
                    "issueId": "13360856"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13360856/worklog/588608",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "emkornfield commented on a change in pull request #10108:\nURL: https://github.com/apache/arrow/pull/10108#discussion_r619886562\n\n\n\n##########\nFile path: cpp/src/jni/dataset/jni_util.cc\n##########\n@@ -117,26 +118,48 @@ class ReservationListenableMemoryPool::Impl {\n   std::shared_ptr<ReservationListener> get_listener() { return listener_; }\n \n  private:\n-  arrow::MemoryPool* pool_;\n+  MemoryPool* pool_;\n   std::shared_ptr<ReservationListener> listener_;\n   int64_t block_size_;\n   int64_t blocks_reserved_;\n   int64_t bytes_reserved_;\n   std::mutex mutex_;\n };\n \n+/// \\brief Buffer implementation that binds to a\n+/// Java buffer reference. Java buffer's release\n+/// method will be called once when being destructed.\n+class JavaAllocatedBuffer : public Buffer {\n+ public:\n+  JavaAllocatedBuffer(JNIEnv* env, jobject cleaner_ref, jmethodID cleaner_method_ref,\n+                      uint8_t* buffer, int32_t len)\n+      : Buffer(buffer, len),\n+        env_(env),\n+        cleaner_ref_(cleaner_ref),\n+        cleaner_method_ref_(cleaner_method_ref) {}\n+\n+  ~JavaAllocatedBuffer() override {\n+    env_->CallVoidMethod(cleaner_ref_, cleaner_method_ref_);\n+    env_->DeleteGlobalRef(cleaner_ref_);\n+  }\n+\n+ private:\n+  JNIEnv* env_;\n+  jobject cleaner_ref_;\n+  jmethodID cleaner_method_ref_;\n+};\n+\n ReservationListenableMemoryPool::ReservationListenableMemoryPool(\n     MemoryPool* pool, std::shared_ptr<ReservationListener> listener, int64_t block_size) {\n   impl_.reset(new Impl(pool, listener, block_size));\n }\n \n-arrow::Status ReservationListenableMemoryPool::Allocate(int64_t size, uint8_t** out) {\n+Status ReservationListenableMemoryPool::Allocate(int64_t size, uint8_t** out) {\n\nReview comment:\n       mixing style changes like this with new code makes reviews harder, please try to avoid large scale changes like this in the future.\n\n\n\n\n-- \nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2021-04-25T22:10:14.415+0000",
                    "updated": "2021-04-25T22:10:14.415+0000",
                    "started": "2021-04-25T22:10:14.415+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "588608",
                    "issueId": "13360856"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13360856/worklog/588610",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "emkornfield commented on a change in pull request #10108:\nURL: https://github.com/apache/arrow/pull/10108#discussion_r619886762\n\n\n\n##########\nFile path: cpp/src/jni/dataset/proto/record_batch.proto\n##########\n@@ -0,0 +1,55 @@\n+// Licensed to the Apache Software Foundation (ASF) under one\n\nReview comment:\n       why are we using protos for this information?\n\n\n\n\n-- \nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2021-04-25T22:11:51.459+0000",
                    "updated": "2021-04-25T22:11:51.459+0000",
                    "started": "2021-04-25T22:11:51.459+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "588610",
                    "issueId": "13360856"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13360856/worklog/588612",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "emkornfield commented on a change in pull request #10108:\nURL: https://github.com/apache/arrow/pull/10108#discussion_r619887124\n\n\n\n##########\nFile path: java/dataset/src/test/java/org/apache/arrow/dataset/file/TestFileSystemDataset.java\n##########\n@@ -126,6 +128,7 @@ public void testParquetBatchSize() throws Exception {\n     checkParquetReadResult(schema, writeSupport.getWrittenRecords(), datum);\n \n     AutoCloseables.close(datum);\n+    AutoCloseables.close(factory);\n\nReview comment:\n       combine this line with the previous?  close can take multiple parameters i believe.\n\n\n\n\n-- \nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2021-04-25T22:14:59.655+0000",
                    "updated": "2021-04-25T22:14:59.655+0000",
                    "started": "2021-04-25T22:14:59.654+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "588612",
                    "issueId": "13360856"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13360856/worklog/588613",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "emkornfield commented on a change in pull request #10108:\nURL: https://github.com/apache/arrow/pull/10108#discussion_r619887946\n\n\n\n##########\nFile path: cpp/src/jni/dataset/proto/record_batch.proto\n##########\n@@ -0,0 +1,55 @@\n+// Licensed to the Apache Software Foundation (ASF) under one\n\nReview comment:\n       In particular this for the most part looks like it replicates data already defined in flatbuffers.\n\n\n\n\n-- \nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2021-04-25T22:21:33.893+0000",
                    "updated": "2021-04-25T22:21:33.893+0000",
                    "started": "2021-04-25T22:21:33.893+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "588613",
                    "issueId": "13360856"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13360856/worklog/588922",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "emkornfield commented on a change in pull request #10108:\nURL: https://github.com/apache/arrow/pull/10108#discussion_r619886485\n\n\n\n##########\nFile path: cpp/src/jni/dataset/jni_util.cc\n##########\n@@ -211,32 +234,140 @@ std::vector<std::string> ToStringVector(JNIEnv* env, jobjectArray& str_array) {\n   return vector;\n }\n \n-arrow::Result<jbyteArray> ToSchemaByteArray(JNIEnv* env,\n-                                            std::shared_ptr<arrow::Schema> schema) {\n-  ARROW_ASSIGN_OR_RAISE(\n-      std::shared_ptr<arrow::Buffer> buffer,\n-      arrow::ipc::SerializeSchema(*schema, arrow::default_memory_pool()))\n+Result<jbyteArray> ToSchemaByteArray(JNIEnv* env, std::shared_ptr<Schema> schema) {\n+  ARROW_ASSIGN_OR_RAISE(std::shared_ptr<Buffer> buffer,\n+                        ipc::SerializeSchema(*schema, default_memory_pool()))\n \n   jbyteArray out = env->NewByteArray(buffer->size());\n   auto src = reinterpret_cast<const jbyte*>(buffer->data());\n   env->SetByteArrayRegion(out, 0, buffer->size(), src);\n   return out;\n }\n \n-arrow::Result<std::shared_ptr<arrow::Schema>> FromSchemaByteArray(\n-    JNIEnv* env, jbyteArray schemaBytes) {\n-  arrow::ipc::DictionaryMemo in_memo;\n+Result<std::shared_ptr<Schema>> FromSchemaByteArray(JNIEnv* env, jbyteArray schemaBytes) {\n+  ipc::DictionaryMemo in_memo;\n   int schemaBytes_len = env->GetArrayLength(schemaBytes);\n   jbyte* schemaBytes_data = env->GetByteArrayElements(schemaBytes, nullptr);\n-  auto serialized_schema = std::make_shared<arrow::Buffer>(\n+  auto serialized_schema = std::make_shared<Buffer>(\n       reinterpret_cast<uint8_t*>(schemaBytes_data), schemaBytes_len);\n-  arrow::io::BufferReader buf_reader(serialized_schema);\n-  ARROW_ASSIGN_OR_RAISE(std::shared_ptr<arrow::Schema> schema,\n-                        arrow::ipc::ReadSchema(&buf_reader, &in_memo))\n+  io::BufferReader buf_reader(serialized_schema);\n+  ARROW_ASSIGN_OR_RAISE(std::shared_ptr<Schema> schema,\n+                        ipc::ReadSchema(&buf_reader, &in_memo))\n   env->ReleaseByteArrayElements(schemaBytes, schemaBytes_data, JNI_ABORT);\n   return schema;\n }\n \n+Status SetSingleField(std::shared_ptr<ArrayData> array_data,\n+                      UnsafeNativeManagedRecordBatchProto& batch_proto) {\n+  FieldProto* field_adder = batch_proto.add_fields();\n+  field_adder->set_length(array_data->length);\n+  field_adder->set_nullcount(array_data->null_count);\n+\n+  std::vector<std::shared_ptr<Buffer>> buffers;\n+  for (const auto& buffer : array_data->buffers) {\n+    buffers.push_back(buffer);\n+  }\n\nReview comment:\n       seems like this loop and the loop below could be combinded.\n\n##########\nFile path: cpp/src/jni/dataset/jni_util.cc\n##########\n@@ -117,26 +118,48 @@ class ReservationListenableMemoryPool::Impl {\n   std::shared_ptr<ReservationListener> get_listener() { return listener_; }\n \n  private:\n-  arrow::MemoryPool* pool_;\n+  MemoryPool* pool_;\n   std::shared_ptr<ReservationListener> listener_;\n   int64_t block_size_;\n   int64_t blocks_reserved_;\n   int64_t bytes_reserved_;\n   std::mutex mutex_;\n };\n \n+/// \\brief Buffer implementation that binds to a\n+/// Java buffer reference. Java buffer's release\n+/// method will be called once when being destructed.\n+class JavaAllocatedBuffer : public Buffer {\n+ public:\n+  JavaAllocatedBuffer(JNIEnv* env, jobject cleaner_ref, jmethodID cleaner_method_ref,\n+                      uint8_t* buffer, int32_t len)\n+      : Buffer(buffer, len),\n+        env_(env),\n+        cleaner_ref_(cleaner_ref),\n+        cleaner_method_ref_(cleaner_method_ref) {}\n+\n+  ~JavaAllocatedBuffer() override {\n+    env_->CallVoidMethod(cleaner_ref_, cleaner_method_ref_);\n+    env_->DeleteGlobalRef(cleaner_ref_);\n+  }\n+\n+ private:\n+  JNIEnv* env_;\n+  jobject cleaner_ref_;\n+  jmethodID cleaner_method_ref_;\n+};\n+\n ReservationListenableMemoryPool::ReservationListenableMemoryPool(\n     MemoryPool* pool, std::shared_ptr<ReservationListener> listener, int64_t block_size) {\n   impl_.reset(new Impl(pool, listener, block_size));\n }\n \n-arrow::Status ReservationListenableMemoryPool::Allocate(int64_t size, uint8_t** out) {\n+Status ReservationListenableMemoryPool::Allocate(int64_t size, uint8_t** out) {\n\nReview comment:\n       mixing style changes like this with new code makes reviews harder, please try to avoid large scale changes like this in the future.\n\n##########\nFile path: cpp/src/jni/dataset/proto/record_batch.proto\n##########\n@@ -0,0 +1,55 @@\n+// Licensed to the Apache Software Foundation (ASF) under one\n\nReview comment:\n       why are we using protos for this information?\n\n##########\nFile path: java/dataset/src/test/java/org/apache/arrow/dataset/file/TestFileSystemDataset.java\n##########\n@@ -126,6 +128,7 @@ public void testParquetBatchSize() throws Exception {\n     checkParquetReadResult(schema, writeSupport.getWrittenRecords(), datum);\n \n     AutoCloseables.close(datum);\n+    AutoCloseables.close(factory);\n\nReview comment:\n       combine this line with the previous?  close can take multiple parameters i believe.\n\n##########\nFile path: cpp/src/jni/dataset/proto/record_batch.proto\n##########\n@@ -0,0 +1,55 @@\n+// Licensed to the Apache Software Foundation (ASF) under one\n\nReview comment:\n       In particular this for the most part looks like it replicates data already defined in flatbuffers.\n\n\n\n\n-- \nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2021-04-26T07:02:32.417+0000",
                    "updated": "2021-04-26T07:02:32.417+0000",
                    "started": "2021-04-26T07:02:32.417+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "588922",
                    "issueId": "13360856"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13360856/worklog/591110",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "zhztheplayer closed pull request #10108:\nURL: https://github.com/apache/arrow/pull/10108\n\n\n   \n\n\n-- \nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2021-04-29T16:30:36.854+0000",
                    "updated": "2021-04-29T16:30:36.854+0000",
                    "started": "2021-04-29T16:30:36.854+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "591110",
                    "issueId": "13360856"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13360856/worklog/591116",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "zhztheplayer opened a new pull request #10201:\nURL: https://github.com/apache/arrow/pull/10201\n\n\n   \n\n\n-- \nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2021-04-29T16:39:31.476+0000",
                    "updated": "2021-04-29T16:39:31.476+0000",
                    "started": "2021-04-29T16:39:31.476+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "591116",
                    "issueId": "13360856"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13360856/worklog/591117",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "zhztheplayer commented on pull request #10108:\nURL: https://github.com/apache/arrow/pull/10108#issuecomment-829417203\n\n\n   Hi @emkornfield (and anyone who has been reviewing), sorry I made a mistake of deleting the original branch and the PR is now not able to reopen. Now I can only open a new PR: #10201. Sorry again for that.\r\n   \n\n\n-- \nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2021-04-29T16:41:17.577+0000",
                    "updated": "2021-04-29T16:41:17.577+0000",
                    "started": "2021-04-29T16:41:17.576+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "591117",
                    "issueId": "13360856"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13360856/worklog/591118",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "zhztheplayer commented on a change in pull request #10108:\nURL: https://github.com/apache/arrow/pull/10108#discussion_r623221239\n\n\n\n##########\nFile path: cpp/src/jni/dataset/jni_util.cc\n##########\n@@ -211,32 +234,140 @@ std::vector<std::string> ToStringVector(JNIEnv* env, jobjectArray& str_array) {\n   return vector;\n }\n \n-arrow::Result<jbyteArray> ToSchemaByteArray(JNIEnv* env,\n-                                            std::shared_ptr<arrow::Schema> schema) {\n-  ARROW_ASSIGN_OR_RAISE(\n-      std::shared_ptr<arrow::Buffer> buffer,\n-      arrow::ipc::SerializeSchema(*schema, arrow::default_memory_pool()))\n+Result<jbyteArray> ToSchemaByteArray(JNIEnv* env, std::shared_ptr<Schema> schema) {\n+  ARROW_ASSIGN_OR_RAISE(std::shared_ptr<Buffer> buffer,\n+                        ipc::SerializeSchema(*schema, default_memory_pool()))\n \n   jbyteArray out = env->NewByteArray(buffer->size());\n   auto src = reinterpret_cast<const jbyte*>(buffer->data());\n   env->SetByteArrayRegion(out, 0, buffer->size(), src);\n   return out;\n }\n \n-arrow::Result<std::shared_ptr<arrow::Schema>> FromSchemaByteArray(\n-    JNIEnv* env, jbyteArray schemaBytes) {\n-  arrow::ipc::DictionaryMemo in_memo;\n+Result<std::shared_ptr<Schema>> FromSchemaByteArray(JNIEnv* env, jbyteArray schemaBytes) {\n+  ipc::DictionaryMemo in_memo;\n   int schemaBytes_len = env->GetArrayLength(schemaBytes);\n   jbyte* schemaBytes_data = env->GetByteArrayElements(schemaBytes, nullptr);\n-  auto serialized_schema = std::make_shared<arrow::Buffer>(\n+  auto serialized_schema = std::make_shared<Buffer>(\n       reinterpret_cast<uint8_t*>(schemaBytes_data), schemaBytes_len);\n-  arrow::io::BufferReader buf_reader(serialized_schema);\n-  ARROW_ASSIGN_OR_RAISE(std::shared_ptr<arrow::Schema> schema,\n-                        arrow::ipc::ReadSchema(&buf_reader, &in_memo))\n+  io::BufferReader buf_reader(serialized_schema);\n+  ARROW_ASSIGN_OR_RAISE(std::shared_ptr<Schema> schema,\n+                        ipc::ReadSchema(&buf_reader, &in_memo))\n   env->ReleaseByteArrayElements(schemaBytes, schemaBytes_data, JNI_ABORT);\n   return schema;\n }\n \n+Status SetSingleField(std::shared_ptr<ArrayData> array_data,\n+                      UnsafeNativeManagedRecordBatchProto& batch_proto) {\n+  FieldProto* field_adder = batch_proto.add_fields();\n+  field_adder->set_length(array_data->length);\n+  field_adder->set_nullcount(array_data->null_count);\n+\n+  std::vector<std::shared_ptr<Buffer>> buffers;\n+  for (const auto& buffer : array_data->buffers) {\n+    buffers.push_back(buffer);\n+  }\n\nReview comment:\n       fixed in https://github.com/apache/arrow/pull/10201/commits/c16e0cb5c29624c1330f4bd1df6e6ddcb954861e, PR #10201 \n\n\n\n\n-- \nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2021-04-29T16:43:22.572+0000",
                    "updated": "2021-04-29T16:43:22.572+0000",
                    "started": "2021-04-29T16:43:22.572+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "591118",
                    "issueId": "13360856"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13360856/worklog/591120",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "zhztheplayer commented on a change in pull request #10108:\nURL: https://github.com/apache/arrow/pull/10108#discussion_r623221415\n\n\n\n##########\nFile path: cpp/src/jni/dataset/jni_util.cc\n##########\n@@ -117,26 +118,48 @@ class ReservationListenableMemoryPool::Impl {\n   std::shared_ptr<ReservationListener> get_listener() { return listener_; }\n \n  private:\n-  arrow::MemoryPool* pool_;\n+  MemoryPool* pool_;\n   std::shared_ptr<ReservationListener> listener_;\n   int64_t block_size_;\n   int64_t blocks_reserved_;\n   int64_t bytes_reserved_;\n   std::mutex mutex_;\n };\n \n+/// \\brief Buffer implementation that binds to a\n+/// Java buffer reference. Java buffer's release\n+/// method will be called once when being destructed.\n+class JavaAllocatedBuffer : public Buffer {\n+ public:\n+  JavaAllocatedBuffer(JNIEnv* env, jobject cleaner_ref, jmethodID cleaner_method_ref,\n+                      uint8_t* buffer, int32_t len)\n+      : Buffer(buffer, len),\n+        env_(env),\n+        cleaner_ref_(cleaner_ref),\n+        cleaner_method_ref_(cleaner_method_ref) {}\n+\n+  ~JavaAllocatedBuffer() override {\n+    env_->CallVoidMethod(cleaner_ref_, cleaner_method_ref_);\n+    env_->DeleteGlobalRef(cleaner_ref_);\n+  }\n+\n+ private:\n+  JNIEnv* env_;\n+  jobject cleaner_ref_;\n+  jmethodID cleaner_method_ref_;\n+};\n+\n ReservationListenableMemoryPool::ReservationListenableMemoryPool(\n     MemoryPool* pool, std::shared_ptr<ReservationListener> listener, int64_t block_size) {\n   impl_.reset(new Impl(pool, listener, block_size));\n }\n \n-arrow::Status ReservationListenableMemoryPool::Allocate(int64_t size, uint8_t** out) {\n+Status ReservationListenableMemoryPool::Allocate(int64_t size, uint8_t** out) {\n\nReview comment:\n       Thanks for the suggestion.\n\n\n\n\n-- \nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2021-04-29T16:43:37.967+0000",
                    "updated": "2021-04-29T16:43:37.967+0000",
                    "started": "2021-04-29T16:43:37.967+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "591120",
                    "issueId": "13360856"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13360856/worklog/591122",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "zhztheplayer commented on a change in pull request #10108:\nURL: https://github.com/apache/arrow/pull/10108#discussion_r623223851\n\n\n\n##########\nFile path: java/dataset/src/test/java/org/apache/arrow/dataset/file/TestFileSystemDataset.java\n##########\n@@ -126,6 +128,7 @@ public void testParquetBatchSize() throws Exception {\n     checkParquetReadResult(schema, writeSupport.getWrittenRecords(), datum);\n \n     AutoCloseables.close(datum);\n+    AutoCloseables.close(factory);\n\nReview comment:\n       They are not able to be combined directly. The first line calls code https://github.com/apache/arrow/blob/0a3cbd0b7337b464ef55619672727ebe6f65ad05/java/memory/memory-core/src/main/java/org/apache/arrow/util/AutoCloseables.java#L82-L109\r\n   second line calls\r\n   https://github.com/apache/arrow/blob/0a3cbd0b7337b464ef55619672727ebe6f65ad05/java/memory/memory-core/src/main/java/org/apache/arrow/util/AutoCloseables.java#L74-L76\n\n\n\n\n-- \nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2021-04-29T16:47:07.117+0000",
                    "updated": "2021-04-29T16:47:07.117+0000",
                    "started": "2021-04-29T16:47:07.117+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "591122",
                    "issueId": "13360856"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13360856/worklog/591124",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "zhztheplayer commented on a change in pull request #10108:\nURL: https://github.com/apache/arrow/pull/10108#discussion_r623227112\n\n\n\n##########\nFile path: cpp/src/jni/dataset/proto/record_batch.proto\n##########\n@@ -0,0 +1,55 @@\n+// Licensed to the Apache Software Foundation (ASF) under one\n\nReview comment:\n       Migrated to flatbuffers in PR #10201\n\n\n\n\n-- \nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2021-04-29T16:51:23.052+0000",
                    "updated": "2021-04-29T16:51:23.052+0000",
                    "started": "2021-04-29T16:51:23.052+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "591124",
                    "issueId": "13360856"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13360856/worklog/591134",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "zhztheplayer commented on a change in pull request #10201:\nURL: https://github.com/apache/arrow/pull/10201#discussion_r623237840\n\n\n\n##########\nFile path: cpp/src/jni/dataset/proto/record_batch.proto\n##########\n@@ -1,55 +0,0 @@\n-// Licensed to the Apache Software Foundation (ASF) under one\n-// or more contributor license agreements.  See the NOTICE file\n-// distributed with this work for additional information\n-// regarding copyright ownership.  The ASF licenses this file\n-// to you under the Apache License, Version 2.0 (the\n-// \"License\"); you may not use this file except in compliance\n-// with the License.  You may obtain a copy of the License at\n-//\n-//   http://www.apache.org/licenses/LICENSE-2.0\n-//\n-// Unless required by applicable law or agreed to in writing,\n-// software distributed under the License is distributed on an\n-// \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n-// KIND, either express or implied.  See the License for the\n-// specific language governing permissions and limitations\n-// under the License.\n-\n-syntax = \"proto2\";\n-package arrow.dataset.jni;\n-\n-option java_package = \"org.apache.arrow.dataset.jni\";\n-option java_outer_classname = \"RecordBatchProtos\";\n\nReview comment:\n       @emkornfield\r\n   I managed to migrate to existing flatbuffers API from protobuf.\r\n   \r\n   previous comment https://github.com/apache/arrow/pull/10108#discussion_r619887946\n\n\n\n\n-- \nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2021-04-29T17:07:02.474+0000",
                    "updated": "2021-04-29T17:07:02.474+0000",
                    "started": "2021-04-29T17:07:02.474+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "591134",
                    "issueId": "13360856"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13360856/worklog/591189",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "github-actions[bot] commented on pull request #10201:\nURL: https://github.com/apache/arrow/pull/10201#issuecomment-829496599\n\n\n   <!--\n     Licensed to the Apache Software Foundation (ASF) under one\n     or more contributor license agreements.  See the NOTICE file\n     distributed with this work for additional information\n     regarding copyright ownership.  The ASF licenses this file\n     to you under the Apache License, Version 2.0 (the\n     \"License\"); you may not use this file except in compliance\n     with the License.  You may obtain a copy of the License at\n   \n       http://www.apache.org/licenses/LICENSE-2.0\n   \n     Unless required by applicable law or agreed to in writing,\n     software distributed under the License is distributed on an\n     \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n     KIND, either express or implied.  See the License for the\n     specific language governing permissions and limitations\n     under the License.\n   -->\n   \n   Thanks for opening a pull request!\n   \n   If this is not a [minor PR](https://github.com/apache/arrow/blob/master/CONTRIBUTING.md#Minor-Fixes). Could you open an issue for this pull request on JIRA? https://issues.apache.org/jira/browse/ARROW\n   \n   Opening JIRAs ahead of time contributes to the [Openness](http://theapacheway.com/open/#:~:text=Openness%20allows%20new%20users%20the,must%20happen%20in%20the%20open.) of the Apache Arrow project.\n   \n   Then could you also rename pull request title in the following format?\n   \n       ARROW-${JIRA_ID}: [${COMPONENT}] ${SUMMARY}\n   \n   or\n   \n       MINOR: [${COMPONENT}] ${SUMMARY}\n   \n   See also:\n   \n     * [Other pull requests](https://github.com/apache/arrow/pulls/)\n     * [Contribution Guidelines - How to contribute patches](https://arrow.apache.org/docs/developers/contributing.html#how-to-contribute-patches)\n   \n\n\n-- \nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2021-04-29T18:38:11.108+0000",
                    "updated": "2021-04-29T18:38:11.108+0000",
                    "started": "2021-04-29T18:38:11.108+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "591189",
                    "issueId": "13360856"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13360856/worklog/597243",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "kiszk commented on a change in pull request #10201:\nURL: https://github.com/apache/arrow/pull/10201#discussion_r632975139\n\n\n\n##########\nFile path: java/dataset/src/main/java/org/apache/arrow/dataset/jni/JniWrapper.java\n##########\n@@ -52,7 +52,7 @@ private JniWrapper() {\n    * Create Dataset from a DatasetFactory and get the native pointer of the Dataset.\n    *\n    * @param datasetFactoryId the native pointer of the arrow::dataset::DatasetFactory instance.\n-   * @param schema the predefined schema of the resulting Dataset.\n+   * @param schema           the predefined schema of the resulting Dataset.\n\nReview comment:\n       nit: spaces are not necessary\n\n\n\n\n-- \nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2021-05-15T15:47:38.865+0000",
                    "updated": "2021-05-15T15:47:38.865+0000",
                    "started": "2021-05-15T15:47:38.865+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "597243",
                    "issueId": "13360856"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13360856/worklog/599628",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "emkornfield commented on a change in pull request #10201:\nURL: https://github.com/apache/arrow/pull/10201#discussion_r635787880\n\n\n\n##########\nFile path: cpp/src/jni/dataset/jni_util.cc\n##########\n@@ -16,36 +16,44 @@\n // under the License.\n \n #include \"jni/dataset/jni_util.h\"\n-\n+#include \"arrow/ipc/metadata_internal.h\"\n+#include \"arrow/util/base64.h\"\n+#include \"arrow/util/key_value_metadata.h\"\n #include \"arrow/util/logging.h\"\n \n+#include <memory>\n #include <mutex>\n \n+#include <flatbuffers/flatbuffers.h>\n+\n namespace arrow {\n+\n+namespace flatbuf = org::apache::arrow::flatbuf;\n\nReview comment:\n       nit: can you prefix org with \"::\"\n\n\n\n\n-- \nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2021-05-20T05:59:04.032+0000",
                    "updated": "2021-05-20T05:59:04.032+0000",
                    "started": "2021-05-20T05:59:04.032+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "599628",
                    "issueId": "13360856"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13360856/worklog/599629",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "emkornfield commented on a change in pull request #10201:\nURL: https://github.com/apache/arrow/pull/10201#discussion_r635788017\n\n\n\n##########\nFile path: cpp/src/jni/dataset/jni_util.cc\n##########\n@@ -16,36 +16,44 @@\n // under the License.\n \n #include \"jni/dataset/jni_util.h\"\n-\n+#include \"arrow/ipc/metadata_internal.h\"\n+#include \"arrow/util/base64.h\"\n+#include \"arrow/util/key_value_metadata.h\"\n #include \"arrow/util/logging.h\"\n \n+#include <memory>\n #include <mutex>\n \n+#include <flatbuffers/flatbuffers.h>\n+\n namespace arrow {\n+\n+namespace flatbuf = org::apache::arrow::flatbuf;\n+\n namespace dataset {\n namespace jni {\n \n class ReservationListenableMemoryPool::Impl {\n  public:\n-  explicit Impl(arrow::MemoryPool* pool, std::shared_ptr<ReservationListener> listener,\n+  explicit Impl(MemoryPool* pool, std::shared_ptr<ReservationListener> listener,\n                 int64_t block_size)\n       : pool_(pool),\n         listener_(listener),\n         block_size_(block_size),\n         blocks_reserved_(0),\n         bytes_reserved_(0) {}\n \n-  arrow::Status Allocate(int64_t size, uint8_t** out) {\n\nReview comment:\n       please try to avoid these types of cleanups with large functional changes.\n\n\n\n\n-- \nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2021-05-20T05:59:28.579+0000",
                    "updated": "2021-05-20T05:59:28.579+0000",
                    "started": "2021-05-20T05:59:28.579+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "599629",
                    "issueId": "13360856"
                }
            ]
        },
        "customfield_12313920": null,
        "issuetype": {
            "self": "https://issues.apache.org/jira/rest/api/2/issuetype/4",
            "id": "4",
            "description": "An improvement or enhancement to an existing feature or task.",
            "iconUrl": "https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21140&avatarType=issuetype",
            "name": "Improvement",
            "subtask": false,
            "avatarId": 21140
        },
        "timespent": 45600,
        "customfield_12314020": "{summaryBean=com.atlassian.jira.plugin.devstatus.rest.SummaryBean@79189fff[summary={pullrequest=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@2ef74edd[overall=PullRequestOverallBean{stateCount=0, state='OPEN', details=PullRequestOverallDetails{openCount=0, mergedCount=0, declinedCount=0}},byInstanceType={}], build=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@56e567b0[overall=com.atlassian.jira.plugin.devstatus.summary.beans.BuildOverallBean@42f04a17[failedBuildCount=0,successfulBuildCount=0,unknownBuildCount=0,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], review=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@173b7d0e[overall=com.atlassian.jira.plugin.devstatus.summary.beans.ReviewsOverallBean@3c28034[stateCount=0,state=<null>,dueDate=<null>,overDue=false,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], deployment-environment=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@7e67af1b[overall=com.atlassian.jira.plugin.devstatus.summary.beans.DeploymentOverallBean@3e87e232[topEnvironments=[],showProjects=false,successfulCount=0,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], repository=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@72982be1[overall=com.atlassian.jira.plugin.devstatus.summary.beans.CommitOverallBean@65ccc6a6[count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], branch=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@2610b273[overall=com.atlassian.jira.plugin.devstatus.summary.beans.BranchOverallBean@270752f1[count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}]},errors=[],configErrors=[]], devSummaryJson={\"cachedValue\":{\"errors\":[],\"configErrors\":[],\"summary\":{\"pullrequest\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"stateCount\":0,\"state\":\"OPEN\",\"details\":{\"openCount\":0,\"mergedCount\":0,\"declinedCount\":0,\"total\":0},\"open\":true},\"byInstanceType\":{}},\"build\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"failedBuildCount\":0,\"successfulBuildCount\":0,\"unknownBuildCount\":0},\"byInstanceType\":{}},\"review\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"stateCount\":0,\"state\":null,\"dueDate\":null,\"overDue\":false,\"completed\":false},\"byInstanceType\":{}},\"deployment-environment\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"topEnvironments\":[],\"showProjects\":false,\"successfulCount\":0},\"byInstanceType\":{}},\"repository\":{\"overall\":{\"count\":0,\"lastUpdated\":null},\"byInstanceType\":{}},\"branch\":{\"overall\":{\"count\":0,\"lastUpdated\":null},\"byInstanceType\":{}}}},\"isStale\":false}}",
        "customfield_12314141": null,
        "customfield_12314140": null,
        "project": {
            "self": "https://issues.apache.org/jira/rest/api/2/project/12319525",
            "id": "12319525",
            "key": "ARROW",
            "name": "Apache Arrow",
            "projectTypeKey": "software",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/projectavatar?pid=12319525&avatarId=10011",
                "24x24": "https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12319525&avatarId=10011",
                "16x16": "https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12319525&avatarId=10011",
                "32x32": "https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12319525&avatarId=10011"
            },
            "projectCategory": {
                "self": "https://issues.apache.org/jira/rest/api/2/projectCategory/13960",
                "id": "13960",
                "description": "Apache Arrow",
                "name": "Arrow"
            }
        },
        "aggregatetimespent": 45600,
        "customfield_12312520": null,
        "customfield_12312521": "Fri Oct 28 15:15:45 UTC 2022",
        "customfield_12314422": null,
        "customfield_12314421": null,
        "customfield_12314146": null,
        "customfield_12314420": null,
        "customfield_12314145": null,
        "customfield_12314144": null,
        "customfield_12314143": null,
        "resolutiondate": "2022-10-28T15:15:45.000+0000",
        "workratio": -1,
        "customfield_12312923": null,
        "customfield_12312920": null,
        "customfield_12312921": null,
        "watches": {
            "self": "https://issues.apache.org/jira/rest/api/2/issue/ARROW-11776/watchers",
            "watchCount": 4,
            "isWatching": false
        },
        "created": "2021-02-25T02:02:20.000+0000",
        "updated": "2022-10-29T20:52:05.000+0000",
        "timeoriginalestimate": null,
        "description": "This should include following:\r\n\r\n# Add writing methods to Java Dataset API;\r\n# In FileSystemDataset (Java), add base support of writing Parquets via JNI. (See also ARROW-9646)",
        "customfield_10010": null,
        "timetracking": {
            "remainingEstimate": "0h",
            "timeSpent": "12h 40m",
            "remainingEstimateSeconds": 0,
            "timeSpentSeconds": 45600
        },
        "customfield_12314523": null,
        "customfield_12314127": null,
        "customfield_12314522": null,
        "customfield_12314126": null,
        "customfield_12314521": null,
        "customfield_12314125": null,
        "customfield_12314520": null,
        "customfield_12314124": null,
        "attachment": [],
        "customfield_12312340": null,
        "customfield_12314123": null,
        "customfield_12312341": null,
        "customfield_12312220": null,
        "customfield_12314122": null,
        "customfield_12314121": null,
        "customfield_12314120": null,
        "customfield_12314129": null,
        "customfield_12314524": null,
        "customfield_12314128": null,
        "summary": "[Java][Dataset] Support writing to files within dataset scanner via JNI",
        "customfield_12314130": null,
        "customfield_12310291": null,
        "customfield_12310290": null,
        "customfield_12314138": null,
        "customfield_12314137": null,
        "environment": null,
        "customfield_12314136": null,
        "customfield_12314135": null,
        "customfield_12311020": null,
        "customfield_12314134": null,
        "duedate": null,
        "customfield_12314132": null,
        "customfield_12314131": null,
        "comment": {
            "comments": [
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13360856/comment/17476173",
                    "id": "17476173",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=kszucs",
                        "name": "kszucs",
                        "key": "kszucs",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "Krisztian Szucs",
                        "active": true,
                        "timeZone": "Europe/Budapest"
                    },
                    "body": "Postponing to 8.0 since the PR is in-progress.",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=kszucs",
                        "name": "kszucs",
                        "key": "kszucs",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "Krisztian Szucs",
                        "active": true,
                        "timeZone": "Europe/Budapest"
                    },
                    "created": "2022-01-14T14:34:31.244+0000",
                    "updated": "2022-01-14T14:34:31.244+0000"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13360856/comment/17625765",
                    "id": "17625765",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=lidavidm",
                        "name": "lidavidm",
                        "key": "lidavidm",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "David Li",
                        "active": true,
                        "timeZone": "America/New_York"
                    },
                    "body": "Issue resolved by pull request 14151\n[https://github.com/apache/arrow/pull/14151]",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=lidavidm",
                        "name": "lidavidm",
                        "key": "lidavidm",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "David Li",
                        "active": true,
                        "timeZone": "America/New_York"
                    },
                    "created": "2022-10-28T15:15:45.398+0000",
                    "updated": "2022-10-28T15:15:45.398+0000"
                }
            ],
            "maxResults": 2,
            "total": 2,
            "startAt": 0
        },
        "customfield_12311820": "0|z0o1jc:",
        "customfield_12314139": null
    }
}