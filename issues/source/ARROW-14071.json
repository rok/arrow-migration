{
    "expand": "operations,versionedRepresentations,editmeta,changelog,renderedFields",
    "id": "13402717",
    "self": "https://issues.apache.org/jira/rest/api/2/issue/13402717",
    "key": "ARROW-14071",
    "fields": {
        "fixVersions": [],
        "resolution": null,
        "customfield_12312322": null,
        "customfield_12312323": null,
        "customfield_12312320": null,
        "customfield_12310420": "9223372036854775807",
        "customfield_12312321": null,
        "customfield_12312328": null,
        "customfield_12312329": null,
        "customfield_12312326": null,
        "customfield_12310300": null,
        "customfield_12312327": null,
        "customfield_12312324": null,
        "customfield_12312720": null,
        "customfield_12312325": null,
        "lastViewed": null,
        "priority": {
            "self": "https://issues.apache.org/jira/rest/api/2/priority/3",
            "iconUrl": "https://issues.apache.org/jira/images/icons/priorities/major.svg",
            "name": "Major",
            "id": "3"
        },
        "labels": [
            "pull-request-available"
        ],
        "customfield_12312333": null,
        "customfield_12312334": null,
        "customfield_12313422": "false",
        "customfield_12310310": "0.0",
        "customfield_12312331": null,
        "customfield_12312332": null,
        "aggregatetimeoriginalestimate": null,
        "timeestimate": 0,
        "customfield_12312330": null,
        "versions": [],
        "customfield_12311120": null,
        "customfield_12313826": null,
        "customfield_12312339": null,
        "issuelinks": [
            {
                "id": "12645836",
                "self": "https://issues.apache.org/jira/rest/api/2/issueLink/12645836",
                "type": {
                    "id": "10030",
                    "name": "Reference",
                    "inward": "is related to",
                    "outward": "relates to",
                    "self": "https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"
                },
                "outwardIssue": {
                    "id": "13477253",
                    "key": "ARROW-17446",
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13477253",
                    "fields": {
                        "summary": "[R] Allow unrecognized R expressions to be callable as compute::Functions",
                        "status": {
                            "self": "https://issues.apache.org/jira/rest/api/2/status/1",
                            "description": "The issue is open and ready for the assignee to start work on it.",
                            "iconUrl": "https://issues.apache.org/jira/images/icons/statuses/open.png",
                            "name": "Open",
                            "id": "1",
                            "statusCategory": {
                                "self": "https://issues.apache.org/jira/rest/api/2/statuscategory/2",
                                "id": 2,
                                "key": "new",
                                "colorName": "blue-gray",
                                "name": "To Do"
                            }
                        },
                        "priority": {
                            "self": "https://issues.apache.org/jira/rest/api/2/priority/3",
                            "iconUrl": "https://issues.apache.org/jira/images/icons/priorities/major.svg",
                            "name": "Major",
                            "id": "3"
                        },
                        "issuetype": {
                            "self": "https://issues.apache.org/jira/rest/api/2/issuetype/1",
                            "id": "1",
                            "description": "A problem which impairs or prevents the functions of the product.",
                            "iconUrl": "https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype",
                            "name": "Bug",
                            "subtask": false,
                            "avatarId": 21133
                        }
                    }
                }
            },
            {
                "id": "12648861",
                "self": "https://issues.apache.org/jira/rest/api/2/issueLink/12648861",
                "type": {
                    "id": "10030",
                    "name": "Reference",
                    "inward": "is related to",
                    "outward": "relates to",
                    "self": "https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"
                },
                "inwardIssue": {
                    "id": "13484722",
                    "key": "ARROW-17948",
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13484722",
                    "fields": {
                        "summary": "[R] arrow_eval user-defined generic functions  ",
                        "status": {
                            "self": "https://issues.apache.org/jira/rest/api/2/status/1",
                            "description": "The issue is open and ready for the assignee to start work on it.",
                            "iconUrl": "https://issues.apache.org/jira/images/icons/statuses/open.png",
                            "name": "Open",
                            "id": "1",
                            "statusCategory": {
                                "self": "https://issues.apache.org/jira/rest/api/2/statuscategory/2",
                                "id": 2,
                                "key": "new",
                                "colorName": "blue-gray",
                                "name": "To Do"
                            }
                        },
                        "priority": {
                            "self": "https://issues.apache.org/jira/rest/api/2/priority/3",
                            "iconUrl": "https://issues.apache.org/jira/images/icons/priorities/major.svg",
                            "name": "Major",
                            "id": "3"
                        },
                        "issuetype": {
                            "self": "https://issues.apache.org/jira/rest/api/2/issuetype/4",
                            "id": "4",
                            "description": "An improvement or enhancement to an existing feature or task.",
                            "iconUrl": "https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21140&avatarType=issuetype",
                            "name": "Improvement",
                            "subtask": false,
                            "avatarId": 21140
                        }
                    }
                }
            }
        ],
        "customfield_12313825": null,
        "assignee": {
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=dragosmg",
            "name": "dragosmg",
            "key": "dragosmg",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=34061",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34061",
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34061",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34061"
            },
            "displayName": "Drago\u0219 Moldovan-Gr\u00fcnfeld",
            "active": true,
            "timeZone": "Etc/UTC"
        },
        "customfield_12312337": null,
        "customfield_12313823": null,
        "customfield_12312338": null,
        "customfield_12311920": null,
        "customfield_12313822": null,
        "customfield_12312335": null,
        "customfield_12313821": null,
        "customfield_12312336": null,
        "customfield_12313820": null,
        "status": {
            "self": "https://issues.apache.org/jira/rest/api/2/status/3",
            "description": "This issue is being actively worked on at the moment by the assignee.",
            "iconUrl": "https://issues.apache.org/jira/images/icons/statuses/inprogress.png",
            "name": "In Progress",
            "id": "3",
            "statusCategory": {
                "self": "https://issues.apache.org/jira/rest/api/2/statuscategory/4",
                "id": 4,
                "key": "indeterminate",
                "colorName": "yellow",
                "name": "In Progress"
            }
        },
        "components": [
            {
                "self": "https://issues.apache.org/jira/rest/api/2/component/12333008",
                "id": "12333008",
                "name": "R"
            }
        ],
        "customfield_12312026": null,
        "customfield_12312023": null,
        "customfield_12312024": null,
        "aggregatetimeestimate": 0,
        "customfield_12312022": null,
        "customfield_12310921": null,
        "customfield_12310920": "9223372036854775807",
        "customfield_12312823": null,
        "creator": {
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=npr",
            "name": "npr",
            "key": "npr",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=34045",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34045",
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34045",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34045"
            },
            "displayName": "Neal Richardson",
            "active": true,
            "timeZone": "America/Los_Angeles"
        },
        "subtasks": [
            {
                "id": "13468885",
                "key": "ARROW-16922",
                "self": "https://issues.apache.org/jira/rest/api/2/issue/13468885",
                "fields": {
                    "summary": "[R] Investigate simple injection with !!",
                    "status": {
                        "self": "https://issues.apache.org/jira/rest/api/2/status/6",
                        "description": "The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.",
                        "iconUrl": "https://issues.apache.org/jira/images/icons/statuses/closed.png",
                        "name": "Closed",
                        "id": "6",
                        "statusCategory": {
                            "self": "https://issues.apache.org/jira/rest/api/2/statuscategory/3",
                            "id": 3,
                            "key": "done",
                            "colorName": "green",
                            "name": "Done"
                        }
                    },
                    "priority": {
                        "self": "https://issues.apache.org/jira/rest/api/2/priority/3",
                        "iconUrl": "https://issues.apache.org/jira/images/icons/priorities/major.svg",
                        "name": "Major",
                        "id": "3"
                    },
                    "issuetype": {
                        "self": "https://issues.apache.org/jira/rest/api/2/issuetype/7",
                        "id": "7",
                        "description": "The sub-task of the issue",
                        "iconUrl": "https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21146&avatarType=issuetype",
                        "name": "Sub-task",
                        "subtask": true,
                        "avatarId": 21146
                    }
                }
            },
            {
                "id": "13468888",
                "key": "ARROW-16923",
                "self": "https://issues.apache.org/jira/rest/api/2/issue/13468888",
                "fields": {
                    "summary": "[R] Investigate injection with rlang::inject()",
                    "status": {
                        "self": "https://issues.apache.org/jira/rest/api/2/status/6",
                        "description": "The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.",
                        "iconUrl": "https://issues.apache.org/jira/images/icons/statuses/closed.png",
                        "name": "Closed",
                        "id": "6",
                        "statusCategory": {
                            "self": "https://issues.apache.org/jira/rest/api/2/statuscategory/3",
                            "id": 3,
                            "key": "done",
                            "colorName": "green",
                            "name": "Done"
                        }
                    },
                    "priority": {
                        "self": "https://issues.apache.org/jira/rest/api/2/priority/3",
                        "iconUrl": "https://issues.apache.org/jira/images/icons/priorities/major.svg",
                        "name": "Major",
                        "id": "3"
                    },
                    "issuetype": {
                        "self": "https://issues.apache.org/jira/rest/api/2/issuetype/7",
                        "id": "7",
                        "description": "The sub-task of the issue",
                        "iconUrl": "https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21146&avatarType=issuetype",
                        "name": "Sub-task",
                        "subtask": true,
                        "avatarId": 21146
                    }
                }
            },
            {
                "id": "13468889",
                "key": "ARROW-16924",
                "self": "https://issues.apache.org/jira/rest/api/2/issue/13468889",
                "fields": {
                    "summary": "[R] Investigate the data mask levels approach",
                    "status": {
                        "self": "https://issues.apache.org/jira/rest/api/2/status/6",
                        "description": "The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.",
                        "iconUrl": "https://issues.apache.org/jira/images/icons/statuses/closed.png",
                        "name": "Closed",
                        "id": "6",
                        "statusCategory": {
                            "self": "https://issues.apache.org/jira/rest/api/2/statuscategory/3",
                            "id": 3,
                            "key": "done",
                            "colorName": "green",
                            "name": "Done"
                        }
                    },
                    "priority": {
                        "self": "https://issues.apache.org/jira/rest/api/2/priority/3",
                        "iconUrl": "https://issues.apache.org/jira/images/icons/priorities/major.svg",
                        "name": "Major",
                        "id": "3"
                    },
                    "issuetype": {
                        "self": "https://issues.apache.org/jira/rest/api/2/issuetype/7",
                        "id": "7",
                        "description": "The sub-task of the issue",
                        "iconUrl": "https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21146&avatarType=issuetype",
                        "name": "Sub-task",
                        "subtask": true,
                        "avatarId": 21146
                    }
                }
            },
            {
                "id": "13468892",
                "key": "ARROW-16925",
                "self": "https://issues.apache.org/jira/rest/api/2/issue/13468892",
                "fields": {
                    "summary": "[R] Investigate other (undefined) approaches",
                    "status": {
                        "self": "https://issues.apache.org/jira/rest/api/2/status/6",
                        "description": "The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.",
                        "iconUrl": "https://issues.apache.org/jira/images/icons/statuses/closed.png",
                        "name": "Closed",
                        "id": "6",
                        "statusCategory": {
                            "self": "https://issues.apache.org/jira/rest/api/2/statuscategory/3",
                            "id": 3,
                            "key": "done",
                            "colorName": "green",
                            "name": "Done"
                        }
                    },
                    "priority": {
                        "self": "https://issues.apache.org/jira/rest/api/2/priority/3",
                        "iconUrl": "https://issues.apache.org/jira/images/icons/priorities/major.svg",
                        "name": "Major",
                        "id": "3"
                    },
                    "issuetype": {
                        "self": "https://issues.apache.org/jira/rest/api/2/issuetype/7",
                        "id": "7",
                        "description": "The sub-task of the issue",
                        "iconUrl": "https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21146&avatarType=issuetype",
                        "name": "Sub-task",
                        "subtask": true,
                        "avatarId": 21146
                    }
                }
            }
        ],
        "reporter": {
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=npr",
            "name": "npr",
            "key": "npr",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=34045",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34045",
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34045",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34045"
            },
            "displayName": "Neal Richardson",
            "active": true,
            "timeZone": "America/Los_Angeles"
        },
        "aggregateprogress": {
            "progress": 22200,
            "total": 22200,
            "percent": 100
        },
        "customfield_12313520": null,
        "customfield_12310250": null,
        "progress": {
            "progress": 22200,
            "total": 22200,
            "percent": 100
        },
        "customfield_12313924": null,
        "votes": {
            "self": "https://issues.apache.org/jira/rest/api/2/issue/ARROW-14071/votes",
            "votes": 0,
            "hasVoted": false
        },
        "worklog": {
            "startAt": 0,
            "maxResults": 20,
            "total": 37,
            "worklogs": [
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13402717/worklog/797697",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "github-actions[bot] commented on PR #13789:\nURL: https://github.com/apache/arrow/pull/13789#issuecomment-1204222880\n\n   https://issues.apache.org/jira/browse/ARROW-14071\n\n\n",
                    "created": "2022-08-03T16:51:47.278+0000",
                    "updated": "2022-08-03T16:51:47.278+0000",
                    "started": "2022-08-03T16:51:47.278+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "797697",
                    "issueId": "13402717"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13402717/worklog/797698",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "github-actions[bot] commented on PR #13789:\nURL: https://github.com/apache/arrow/pull/13789#issuecomment-1204222910\n\n   :warning: Ticket **has not been started in JIRA**, please click 'Start Progress'.\n\n\n",
                    "created": "2022-08-03T16:51:48.622+0000",
                    "updated": "2022-08-03T16:51:48.622+0000",
                    "started": "2022-08-03T16:51:48.621+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "797698",
                    "issueId": "13402717"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13402717/worklog/800588",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "paleolimbot commented on PR #13789:\nURL: https://github.com/apache/arrow/pull/13789#issuecomment-1214992856\n\n   This is very cool! It's the most important type of user-defined function because it's 100% translatable using Arrow kernels so it runs in parallel...a lot of applications will benefit from this!\r\n   \r\n   Have you considered adding a registration step? If you do, you may be able to simplify some of this. The dream, of course, is to not require pre-registration at all, which will require an approach much like the one you've sketched out here, (i.e., preprocessing the expression).\r\n   \r\n   <details>\r\n   \r\n   ``` r\r\n   library(dplyr, warn.conflicts = FALSE)\r\n   library(arrow, warn.conflicts = FALSE)\r\n   #> Some features are not enabled in this build of Arrow. Run `arrow_info()` for more information.\r\n   \r\n   register_user_binding <- function(name, f, env = rlang::caller_env()) {\r\n     # copy the bindings environment because we don't want to set the parent\r\n     # of the one-and-only official bindings environment\r\n     bindings_env <- as.environment(as.list(arrow:::nse_funcs))\r\n     parent.env(bindings_env) <- env\r\n     environment(f) <- bindings_env\r\n     \r\n     # register for use in Arrow (non-agg)\r\n     arrow:::register_binding(name, f, update_cache = TRUE)\r\n     \r\n     # in case this is a recursive function\r\n     arrow:::register_binding(name, f, bindings_env)\r\n     \r\n     # so that the user can call this function, too (most Arrow bindings accept\r\n     # regular input, too)\r\n     invisible(f)\r\n   }\r\n   \r\n   nchar2 <- register_user_binding(\"nchar2\", function(x) {\r\n     1 + nchar(x)\r\n   })\r\n   \r\n   record_batch(my_string = \"1234\") %>%\r\n     mutate(\r\n       var1 = nchar(my_string),\r\n       var2 = nchar2(my_string)) %>%\r\n     collect()\r\n   #> # A tibble: 1 \u00d7 3\r\n   #>   my_string  var1  var2\r\n   #>   <chr>     <int> <dbl>\r\n   #> 1 1234          4     5\r\n   ```\r\n   \r\n   <sup>Created on 2022-08-15 by the [reprex package](https://reprex.tidyverse.org) (v2.0.1)</sup>\r\n   \r\n   </details>\n\n\n",
                    "created": "2022-08-15T13:08:25.455+0000",
                    "updated": "2022-08-15T13:08:25.455+0000",
                    "started": "2022-08-15T13:08:25.454+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "800588",
                    "issueId": "13402717"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13402717/worklog/800638",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "dragosmg commented on PR #13789:\nURL: https://github.com/apache/arrow/pull/13789#issuecomment-1215132152\n\n   > Have you considered adding a registration step?\r\n   \r\n   A registration step would definitely simplify this. There was had a brief conversation (some of which is captured in the [capstone doc](https://docs.google.com/document/d/1OlVjZhMHY_X9lyZNw9LrBANvW_OgzNiQwXMjqIPShV0/edit?disco=AAAAbHEJGPE) and the [Jira](https://issues.apache.org/jira/browse/ARROW-14071)) and I agree with @jonkeane's point of view. There are valid arguments for both, but I am leaning towards users not being required to pre-register a binding / function. \r\n   \r\n   Happy to hear more thoughts, either here or on the [design doc](https://docs.google.com/document/d/1vBp8M8yXXfwMfpAPTXPKVT6QvhGrZWc0Uv5_xpEOq00/edit#heading=h.usuopcbswr78).    \n\n\n",
                    "created": "2022-08-15T15:07:40.784+0000",
                    "updated": "2022-08-15T15:07:40.784+0000",
                    "started": "2022-08-15T15:07:40.784+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "800638",
                    "issueId": "13402717"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13402717/worklog/800696",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "paleolimbot commented on PR #13789:\nURL: https://github.com/apache/arrow/pull/13789#issuecomment-1215604348\n\n   I like the idea of explicit registration if it means less complexity to maintain and makes it more likely that a user will understand an error that occurs. It also nicely parallels the user-defined function usage (which also requires an explicit registration step) and forms a natural progression (try using a user-defined binding and if that doesn't work, just change it to a user-defined scalar function).\n\n\n",
                    "created": "2022-08-15T18:47:33.707+0000",
                    "updated": "2022-08-15T18:47:33.707+0000",
                    "started": "2022-08-15T18:47:33.706+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "800696",
                    "issueId": "13402717"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13402717/worklog/800872",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "jonkeane commented on PR #13789:\nURL: https://github.com/apache/arrow/pull/13789#issuecomment-1216348088\n\n   I'm not wholly against requiring registration if it is significantly simpler or is the only way. But I'm not sure that requiring registration will necessarily help make errors easier to understand (we'll need to have some good, clear error messages when anything goes wrong here regardless of the path we take). \r\n   \r\n   And I might even argue that having only one kind of registration (for the user-defined scalar function) sets that apart in a positive way (crafting one of those will take care + do things that are surprising compared to all of our other bindings, after all). IMO: people shouldn't (need to) think too much about how the bindings work, just use the code you're used to, and if it works, great, if it gives you a (clear) error that some function isn't native to arrow yet, you can respond to that as is. If we have two different types of registration we'll need to find a way to explain how they are different (and even with great docs explaining that difference, there will be a contingent of people who will wonder what's the difference between the hypothetical `register_binding(...)` and `register_scalar_function(...)`.\r\n   \r\n   But, again, if autoregistering is a sticking point (though looking through the code that's here it doesn't look like it is...), then sure we can go the registration route first. (or if all the autoregistration stuff is overly burdensome from a maintenance perspective too, of course). \n\n\n",
                    "created": "2022-08-16T09:03:53.749+0000",
                    "updated": "2022-08-16T09:03:53.749+0000",
                    "started": "2022-08-16T09:03:53.748+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "800872",
                    "issueId": "13402717"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13402717/worklog/800875",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "jonkeane commented on code in PR #13789:\nURL: https://github.com/apache/arrow/pull/13789#discussion_r946522488\n\n\n##########\nr/R/dplyr-eval.R:\n##########\n@@ -121,3 +148,121 @@ format_expr <- function(x) {\n   }\n   head(out, 1)\n }\n+\n+#' Translate a function in a given context (environment with bindings)\n+#'\n+#' Translates a function (if possible) with the help of existing bindings in a\n+#' given environment.\n+#'\n+#' @param fn function to be translated\n+#' @param env environment to translate against\n+#'\n+#' @return a translated function\n+#' @keywords internal\n+#' @noRd\n+translate_to_arrow <- function(.fun, .env) {\n+  # get the args and the body of the unknown binding\n+  function_formals <- formals(.fun)\n+\n+  if (is.primitive(.fun)) {\n+    # exit as the function can't be translated, we can only translate closures\n+    stop(\"`\", as.character(.fun[[1]]), \"` is a primitive and cannot be translated\")\n+  }\n+\n+  # TODO handle errors. `fn_body()` errors when fn is a primitive, `body()` returns\n+  # NULL so maybe we can work with that\n+  function_body <- rlang::fn_body(.fun)\n+\n+  if (translatable(.fun, .env)) {\n+    translated_function <- rlang::new_function(\n+      args = function_formals,\n+      body = translate_to_arrow_rec(function_body[[2]])\n+    )\n+  } else {\n+    # TODO WIP if the function is not directly translatable, make one more try\n+    # by attempting to translate the unknown calls\n+    unknown_function <- setdiff(all_funs(function_body[[2]]), names(.env))\n+\n+    fn <- as_function(unknown_function, env = caller_env())\n+    translated_function <- NULL\n+  }\n\nReview Comment:\n   If I'm reading this code correctly, it looks like it translates two levels down in the function call, yeah? So if I have only functions in my function body that have bindings it'll be fine, or if my function calls a function that also has only functions that have bindings it'll be fine, but if my function calls a function, which calls another function, which has only bindings it won't work.\r\n   \r\n   In other words: these will work:\r\n   ```\r\n   my_func <- function(x) {\r\n     mean(x)\r\n   }\r\n   \r\n   my_func_2 <- function(x) {\r\n     my_func(x)\r\n   }\r\n   ```\r\n   \r\n   but this one will not:\r\n   ```\r\n   my_func_3 <- function(x) {\r\n     my_func_3(x)\r\n   }\r\n   ```\r\n   \r\n   Or does it actually recurse through the call stack?\n\n\n\n",
                    "created": "2022-08-16T09:13:16.287+0000",
                    "updated": "2022-08-16T09:13:16.287+0000",
                    "started": "2022-08-16T09:13:16.287+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "800875",
                    "issueId": "13402717"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13402717/worklog/800876",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "dragosmg commented on code in PR #13789:\nURL: https://github.com/apache/arrow/pull/13789#discussion_r946529125\n\n\n##########\nr/R/dplyr-eval.R:\n##########\n@@ -121,3 +148,121 @@ format_expr <- function(x) {\n   }\n   head(out, 1)\n }\n+\n+#' Translate a function in a given context (environment with bindings)\n+#'\n+#' Translates a function (if possible) with the help of existing bindings in a\n+#' given environment.\n+#'\n+#' @param fn function to be translated\n+#' @param env environment to translate against\n+#'\n+#' @return a translated function\n+#' @keywords internal\n+#' @noRd\n+translate_to_arrow <- function(.fun, .env) {\n+  # get the args and the body of the unknown binding\n+  function_formals <- formals(.fun)\n+\n+  if (is.primitive(.fun)) {\n+    # exit as the function can't be translated, we can only translate closures\n+    stop(\"`\", as.character(.fun[[1]]), \"` is a primitive and cannot be translated\")\n+  }\n+\n+  # TODO handle errors. `fn_body()` errors when fn is a primitive, `body()` returns\n+  # NULL so maybe we can work with that\n+  function_body <- rlang::fn_body(.fun)\n+\n+  if (translatable(.fun, .env)) {\n+    translated_function <- rlang::new_function(\n+      args = function_formals,\n+      body = translate_to_arrow_rec(function_body[[2]])\n+    )\n+  } else {\n+    # TODO WIP if the function is not directly translatable, make one more try\n+    # by attempting to translate the unknown calls\n+    unknown_function <- setdiff(all_funs(function_body[[2]]), names(.env))\n+\n+    fn <- as_function(unknown_function, env = caller_env())\n+    translated_function <- NULL\n+  }\n\nReview Comment:\n   It doesn't recurse through the call stack at the moment. Still working on it and I will implement it as recursing only 1 level down in the first instance.\n\n\n\n",
                    "created": "2022-08-16T09:15:01.537+0000",
                    "updated": "2022-08-16T09:15:01.537+0000",
                    "started": "2022-08-16T09:15:01.536+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "800876",
                    "issueId": "13402717"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13402717/worklog/800878",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "dragosmg commented on PR #13789:\nURL: https://github.com/apache/arrow/pull/13789#issuecomment-1216376404\n\n   > Thanks for this! One comment, so far. It would be nice to have an idea of which parts of this are working, and which parts still need work before they are ready (I see a handful of todos in the code, which is great, but also in a comment of \"I've done these bits: ..., still working on these: ...\")\r\n   \r\n   All the examples listed in the PR description work. So far this works for:\r\n   * mutate with:\r\n       - [ ] simple expression (`nchar2(my_string)`) - contains a simple call to a user-defined function\r\n       - [ ] a slightly more complicated expression (`1 + nchar2(my_string)`)\r\n       - [ ] multiple unknown calls in the same expression (to test the iteration) - `nchar2(my_string) + nchar3(my_string)`\r\n       - [ ] user function defined using namespacing `1 + nchar4(my_string)`\n\n\n",
                    "created": "2022-08-16T09:20:13.561+0000",
                    "updated": "2022-08-16T09:20:13.561+0000",
                    "started": "2022-08-16T09:20:13.561+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "800878",
                    "issueId": "13402717"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13402717/worklog/801415",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "dragosmg commented on PR #13789:\nURL: https://github.com/apache/arrow/pull/13789#issuecomment-1218176398\n\n   @paleolimbot I like your suggestion in https://github.com/apache/arrow/pull/13789#issuecomment-1214992856. Even if we don't require the user to self-register, that function can really simplify my current logic (as we can use it instead of having to walk the AST). \r\n   \r\n   \n\n\n",
                    "created": "2022-08-17T15:37:18.163+0000",
                    "updated": "2022-08-17T15:37:18.163+0000",
                    "started": "2022-08-17T15:37:18.163+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "801415",
                    "issueId": "13402717"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13402717/worklog/801434",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "paleolimbot commented on PR #13789:\nURL: https://github.com/apache/arrow/pull/13789#issuecomment-1218250746\n\n   That approach sounds good to me!\n\n\n",
                    "created": "2022-08-17T16:33:46.795+0000",
                    "updated": "2022-08-17T16:33:46.795+0000",
                    "started": "2022-08-17T16:33:46.794+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "801434",
                    "issueId": "13402717"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13402717/worklog/802407",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "dragosmg commented on code in PR #13789:\nURL: https://github.com/apache/arrow/pull/13789#discussion_r951226154\n\n\n##########\nr/R/dplyr-eval.R:\n##########\n@@ -121,3 +148,121 @@ format_expr <- function(x) {\n   }\n   head(out, 1)\n }\n+\n+#' Translate a function in a given context (environment with bindings)\n+#'\n+#' Translates a function (if possible) with the help of existing bindings in a\n+#' given environment.\n+#'\n+#' @param fn function to be translated\n+#' @param env environment to translate against\n+#'\n+#' @return a translated function\n+#' @keywords internal\n+#' @noRd\n+translate_to_arrow <- function(.fun, .env) {\n+  # get the args and the body of the unknown binding\n+  function_formals <- formals(.fun)\n+\n+  if (is.primitive(.fun)) {\n+    # exit as the function can't be translated, we can only translate closures\n+    stop(\"`\", as.character(.fun[[1]]), \"` is a primitive and cannot be translated\")\n+  }\n+\n+  # TODO handle errors. `fn_body()` errors when fn is a primitive, `body()` returns\n+  # NULL so maybe we can work with that\n+  function_body <- rlang::fn_body(.fun)\n+\n+  if (translatable(.fun, .env)) {\n+    translated_function <- rlang::new_function(\n+      args = function_formals,\n+      body = translate_to_arrow_rec(function_body[[2]])\n+    )\n+  } else {\n+    # TODO WIP if the function is not directly translatable, make one more try\n+    # by attempting to translate the unknown calls\n+    unknown_function <- setdiff(all_funs(function_body[[2]]), names(.env))\n+\n+    fn <- as_function(unknown_function, env = caller_env())\n+    translated_function <- NULL\n+  }\n\nReview Comment:\n   This now works, and will mark this as resolved. There's a lot of polishing / simplification I want to do.\n\n\n\n",
                    "created": "2022-08-22T09:39:27.009+0000",
                    "updated": "2022-08-22T09:39:27.009+0000",
                    "started": "2022-08-22T09:39:27.009+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "802407",
                    "issueId": "13402717"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13402717/worklog/802453",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "dragosmg commented on PR #13789:\nURL: https://github.com/apache/arrow/pull/13789#issuecomment-1222271723\n\n   **Update**:\r\n   * user-defined functions work with `mutate()` and `filter()`\r\n   * and work with nested function definitions\n\n\n",
                    "created": "2022-08-22T12:13:36.192+0000",
                    "updated": "2022-08-22T12:13:36.192+0000",
                    "started": "2022-08-22T12:13:36.192+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "802453",
                    "issueId": "13402717"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13402717/worklog/802461",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "jonkeane commented on PR #13789:\nURL: https://github.com/apache/arrow/pull/13789#issuecomment-1222297123\n\n   > Give both of these work and the approach is rather complex, by walking the AST, I will now go more in the direction suggested by @paleolimbot (in https://github.com/apache/arrow/pull/13789#issuecomment-1214992856) and refactor / simplify the implementation.\r\n   \r\n   Could you say more about what you're thinking about doing here, there were a few suggestions in that comment | thread. Are you going to now require registration? Or something else?\n\n\n",
                    "created": "2022-08-22T12:34:52.348+0000",
                    "updated": "2022-08-22T12:34:52.348+0000",
                    "started": "2022-08-22T12:34:52.348+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "802461",
                    "issueId": "13402717"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13402717/worklog/802466",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "dragosmg commented on PR #13789:\nURL: https://github.com/apache/arrow/pull/13789#issuecomment-1222347345\n\n   > > Give both of these work and the approach is rather complex, by walking the AST, I will now go more in the direction suggested by @paleolimbot (in [#13789 (comment)](https://github.com/apache/arrow/pull/13789#issuecomment-1214992856)) and refactor / simplify the implementation.\r\n   > \r\n   > Could you say more about what you're thinking about doing here, there were a few suggestions in that comment | thread. Are you going to now require registration? Or something else?\r\n   \r\n   Not requiring registration. I was thinking about switching from translation + registration to registration only.\r\n   \r\n   Currently my approach is to take:\r\n   ```r\r\n   nchar2 <- function(x) 1 + nchar(x)\r\n   ```\r\n   walk its abstract syntax tree, translate it to \r\n   ```r\r\n   nchar2 <- function(x) call_binding(\"+\", 1, call_binding(\"char\", x))\r\n   ```\r\n   and then register it + update `.cache$functions`.\r\n   \r\n   However, the translation might not be necessary and only complicates the implementation, as we only need to register the `\"nchar2\"` binding without actually translating its body for this to work. The reason it doesn't work in `main` is because the data mask has no knowledge of `\"nchar2\"`. So updating the context of the evaluation (to be aware of the _translation_, but without actually translating the body) should work.\r\n   \r\n   Translating the body also highlighted the overlap between `nse_funcs` and `.cache$functions`. We could potentially reduce that complexity too - [ARROW-17495](https://issues.apache.org/jira/browse/ARROW-17495), but I'm happy to leave that for another PR.  \n\n\n",
                    "created": "2022-08-22T13:16:01.353+0000",
                    "updated": "2022-08-22T13:16:01.353+0000",
                    "started": "2022-08-22T13:16:01.352+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "802466",
                    "issueId": "13402717"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13402717/worklog/802468",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "jonkeane commented on PR #13789:\nURL: https://github.com/apache/arrow/pull/13789#issuecomment-1222355143\n\n   Ah cool, that sounds good, thanks!\n\n\n",
                    "created": "2022-08-22T13:21:45.539+0000",
                    "updated": "2022-08-22T13:21:45.539+0000",
                    "started": "2022-08-22T13:21:45.539+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "802468",
                    "issueId": "13402717"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13402717/worklog/802573",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "dragosmg commented on PR #13789:\nURL: https://github.com/apache/arrow/pull/13789#issuecomment-1222668637\n\n   The CI failure (Windows & R 3.6) seems to be related to https://github.com/apache/arrow/pull/13661.\n\n\n",
                    "created": "2022-08-22T17:24:25.549+0000",
                    "updated": "2022-08-22T17:24:25.549+0000",
                    "started": "2022-08-22T17:24:25.549+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "802573",
                    "issueId": "13402717"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13402717/worklog/803173",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "github-actions[bot] commented on PR #13960:\nURL: https://github.com/apache/arrow/pull/13960#issuecomment-1225484389\n\n   https://issues.apache.org/jira/browse/ARROW-14071\n\n\n",
                    "created": "2022-08-24T09:44:15.324+0000",
                    "updated": "2022-08-24T09:44:15.324+0000",
                    "started": "2022-08-24T09:44:15.324+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "803173",
                    "issueId": "13402717"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13402717/worklog/803174",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "dragosmg closed pull request #13789: ARROW-14071: [R] Try to arrow_eval user-defined functions - explicit approach\nURL: https://github.com/apache/arrow/pull/13789\n\n\n",
                    "created": "2022-08-24T09:45:46.616+0000",
                    "updated": "2022-08-24T09:45:46.616+0000",
                    "started": "2022-08-24T09:45:46.616+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "803174",
                    "issueId": "13402717"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13402717/worklog/803176",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "dragosmg opened a new pull request, #13789:\nURL: https://github.com/apache/arrow/pull/13789\n\n   Once this PR is merged, users should be able to use their own functions in an {arrow} dplyr-like pipeline (provided they can be translated with the help of existing bindings). \r\n   \r\n   ``` r\r\n   library(dplyr)\r\n   library(arrow)\r\n   \r\n   nchar2 <- function(x) {\r\n     1 + nchar(x)\r\n   }\r\n   \r\n   # simple expression\r\n   tibble::tibble(my_string = \"1234\") %>%\r\n     mutate(\r\n       var1 = nchar(my_string),\r\n       var2 = nchar2(my_string)) %>%\r\n     collect()\r\n   #> # A tibble: 1 \u00d7 3\r\n   #>   my_string  var1  var2\r\n   #>   <chr>     <int> <dbl>\r\n   #> 1 1234          4     5\r\n   \r\n   # a slightly more complicated expression\r\n   tibble::tibble(my_string = \"1234\") %>%\r\n     mutate(\r\n       var1 = nchar(my_string),\r\n       var2 = 1 + nchar2(my_string)) %>%\r\n     collect()\r\n   #> # A tibble: 1 \u00d7 3\r\n   #>   my_string  var1  var2\r\n   #>   <chr>     <int> <dbl>\r\n   #> 1 1234          4     6\r\n     \r\n   nchar3 <- function(x) {\r\n     2 + nchar(x)\r\n   }\r\n   \r\n   # multiple unknown calls in the same expression (to test the iteration)\r\n   tibble::tibble(my_string = \"1234\") %>%\r\n     mutate(\r\n       var1 = nchar(my_string),\r\n       var2 = nchar2(my_string) + nchar3(my_string)) %>%\r\n     collect()\r\n   #> # A tibble: 1 \u00d7 3\r\n   #>   my_string  var1  var2\r\n   #>   <chr>     <int> <dbl>\r\n   #> 1 1234          4    11\r\n   \r\n   # user function defined using namespacing\r\n   nchar4 <- function(x) {\r\n     2 + base::nchar(x)\r\n   }\r\n   \r\n   tibble::tibble(my_string = \"1234\") %>%\r\n     mutate(\r\n       var1 = nchar(my_string),\r\n       var2 = 1 + nchar4(my_string)) %>%\r\n     collect()\r\n   #> # A tibble: 1 \u00d7 3\r\n   #>   my_string  var1  var2\r\n   #>   <chr>     <int> <dbl>\r\n   #> 1 1234          4     7\r\n   ```\r\n   \r\n   Thoughts around the design were captured in this [design doc](https://docs.google.com/document/d/1vBp8M8yXXfwMfpAPTXPKVT6QvhGrZWc0Uv5_xpEOq00/edit#).\n\n\n",
                    "created": "2022-08-24T09:47:16.324+0000",
                    "updated": "2022-08-24T09:47:16.324+0000",
                    "started": "2022-08-24T09:47:16.323+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "803176",
                    "issueId": "13402717"
                }
            ]
        },
        "customfield_12313920": null,
        "issuetype": {
            "self": "https://issues.apache.org/jira/rest/api/2/issuetype/4",
            "id": "4",
            "description": "An improvement or enhancement to an existing feature or task.",
            "iconUrl": "https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21140&avatarType=issuetype",
            "name": "Improvement",
            "subtask": false,
            "avatarId": 21140
        },
        "timespent": 22200,
        "customfield_12314020": "{summaryBean=com.atlassian.jira.plugin.devstatus.rest.SummaryBean@cf333dc[summary={pullrequest=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@7ca0ffee[overall=PullRequestOverallBean{stateCount=0, state='OPEN', details=PullRequestOverallDetails{openCount=0, mergedCount=0, declinedCount=0}},byInstanceType={}], build=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@59bab388[overall=com.atlassian.jira.plugin.devstatus.summary.beans.BuildOverallBean@221e68de[failedBuildCount=0,successfulBuildCount=0,unknownBuildCount=0,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], review=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@70a93db5[overall=com.atlassian.jira.plugin.devstatus.summary.beans.ReviewsOverallBean@2c173d43[stateCount=0,state=<null>,dueDate=<null>,overDue=false,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], deployment-environment=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@20bdfdba[overall=com.atlassian.jira.plugin.devstatus.summary.beans.DeploymentOverallBean@71b439eb[topEnvironments=[],showProjects=false,successfulCount=0,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], repository=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@4849e6fd[overall=com.atlassian.jira.plugin.devstatus.summary.beans.CommitOverallBean@5da12792[count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], branch=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@123e41b1[overall=com.atlassian.jira.plugin.devstatus.summary.beans.BranchOverallBean@4295597c[count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}]},errors=[],configErrors=[]], devSummaryJson={\"cachedValue\":{\"errors\":[],\"configErrors\":[],\"summary\":{\"pullrequest\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"stateCount\":0,\"state\":\"OPEN\",\"details\":{\"openCount\":0,\"mergedCount\":0,\"declinedCount\":0,\"total\":0},\"open\":true},\"byInstanceType\":{}},\"build\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"failedBuildCount\":0,\"successfulBuildCount\":0,\"unknownBuildCount\":0},\"byInstanceType\":{}},\"review\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"stateCount\":0,\"state\":null,\"dueDate\":null,\"overDue\":false,\"completed\":false},\"byInstanceType\":{}},\"deployment-environment\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"topEnvironments\":[],\"showProjects\":false,\"successfulCount\":0},\"byInstanceType\":{}},\"repository\":{\"overall\":{\"count\":0,\"lastUpdated\":null},\"byInstanceType\":{}},\"branch\":{\"overall\":{\"count\":0,\"lastUpdated\":null},\"byInstanceType\":{}}}},\"isStale\":false}}",
        "customfield_12314141": null,
        "customfield_12314140": null,
        "project": {
            "self": "https://issues.apache.org/jira/rest/api/2/project/12319525",
            "id": "12319525",
            "key": "ARROW",
            "name": "Apache Arrow",
            "projectTypeKey": "software",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/projectavatar?pid=12319525&avatarId=10011",
                "24x24": "https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12319525&avatarId=10011",
                "16x16": "https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12319525&avatarId=10011",
                "32x32": "https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12319525&avatarId=10011"
            },
            "projectCategory": {
                "self": "https://issues.apache.org/jira/rest/api/2/projectCategory/13960",
                "id": "13960",
                "description": "Apache Arrow",
                "name": "Arrow"
            }
        },
        "aggregatetimespent": 22200,
        "customfield_12312520": null,
        "customfield_12312521": "Tue Aug 23 16:50:21 UTC 2022",
        "customfield_12314422": null,
        "customfield_12314421": null,
        "customfield_12314146": null,
        "customfield_12314420": null,
        "customfield_12314145": null,
        "customfield_12314144": null,
        "customfield_12314143": null,
        "resolutiondate": null,
        "workratio": -1,
        "customfield_12312923": null,
        "customfield_12312920": null,
        "customfield_12312921": null,
        "watches": {
            "self": "https://issues.apache.org/jira/rest/api/2/issue/ARROW-14071/watchers",
            "watchCount": 5,
            "isWatching": false
        },
        "created": "2021-09-22T14:53:59.000+0000",
        "updated": "2022-10-13T14:11:27.000+0000",
        "timeoriginalestimate": null,
        "description": "*Proposed approach*:\r\n* Investigate simple injection with {{!!}}\r\n* Investigate injection with {{rlang::inject()}}\r\n* Investigate the data mask levels approach\r\n* investigate other (undefined) approaches\r\n\r\n*Original description*:\r\nThe first test passes but the second one fails, even though they're equivalent. The user's function isn't being evaluated in the nse_funcs environment.\r\n\r\n{code}\r\n  expect_dplyr_equal(\r\n    input %>%\r\n      select(-fct) %>%\r\n      filter(nchar(padded_strings) < 10) %>%\r\n      collect(),\r\n    tbl\r\n  )\r\n  isShortString <- function(x) nchar(x) < 10\r\n  expect_dplyr_equal(\r\n    input %>%\r\n      select(-fct) %>%\r\n      filter(isShortString(padded_strings)) %>%\r\n      collect(),\r\n    tbl\r\n  )\r\n{code}",
        "customfield_10010": null,
        "timetracking": {
            "remainingEstimate": "0h",
            "timeSpent": "6h 10m",
            "remainingEstimateSeconds": 0,
            "timeSpentSeconds": 22200
        },
        "customfield_12314523": null,
        "customfield_12314127": null,
        "customfield_12314522": null,
        "customfield_12314126": null,
        "customfield_12314521": null,
        "customfield_12314125": null,
        "customfield_12314520": null,
        "customfield_12314124": null,
        "attachment": [],
        "customfield_12312340": null,
        "customfield_12314123": null,
        "customfield_12312341": null,
        "customfield_12312220": null,
        "customfield_12314122": null,
        "customfield_12314121": null,
        "customfield_12314120": null,
        "customfield_12314129": null,
        "customfield_12314524": null,
        "customfield_12314128": null,
        "summary": "[R] Try to arrow_eval user-defined functions",
        "customfield_12314130": null,
        "customfield_12310291": null,
        "customfield_12310290": null,
        "customfield_12314138": null,
        "customfield_12314137": null,
        "environment": null,
        "customfield_12314136": null,
        "customfield_12314135": null,
        "customfield_12311020": null,
        "customfield_12314134": null,
        "duedate": null,
        "customfield_12314132": null,
        "customfield_12314131": null,
        "comment": {
            "comments": [
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13402717/comment/17438024",
                    "id": "17438024",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=paleolimbot",
                        "name": "paleolimbot",
                        "key": "paleolimbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=paleolimbot&avatarId=47795",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=paleolimbot&avatarId=47795",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=paleolimbot&avatarId=47795",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=paleolimbot&avatarId=47795"
                        },
                        "displayName": "Dewey Dunnington",
                        "active": true,
                        "timeZone": "America/Halifax"
                    },
                    "body": "Reprex:\u00a0\r\n\r\n\u00a0\r\n{code:java}\r\nlibrary(arrow, warn.conflicts = FALSE)\r\nlibrary(dplyr, warn.conflicts = FALSE)\r\nnchar2 <- function(x) {\r\n  nchar(x)\r\n}\r\nRecordBatch$create(my_string = \"1234\") %>%\r\n  mutate(nchar(my_string), nchar2(my_string)) %>%\r\n  collect()\r\n#> Warning: Expression nchar2(my_string) not supported in Arrow; pulling data into\r\n#> R\r\n#> # A tibble: 1 \u00d7 3\r\n#>   my_string `nchar(my_string)` `nchar2(my_string)`\r\n#>   <chr>                  <int>               <int>\r\n#> 1 1234                       4                   4{code}\r\n\u00a0I'm not sure if this works with the rlang data mask, but you could do this by setting `environment(fun)` to an environment that inherits the original `environment(fun)`. You probably don't want the data mask anyway because you don't want field references to interfere with the internal function variable names. (With apologies if you've done this already and I missed it):\r\n{noformat}\r\nmasked_function <- function(fun, env) {\r\n  # probably want to (shallow) copy `env` because we'd need to modify it\r\n  # and it's passed by reference\r\n  env2 <- new.env(parent = environment(fun))\r\n  for (name in names(env)) {\r\n    env2[[name]] <- env[[name]]\r\n  }\r\n  \r\n  environment(fun) <- env2\r\n  fun\r\n}\r\n\r\nsome_var <- 45\r\nmy_function <- function() {\r\n  some_var + 5\r\n}\r\n\r\nmy_function()\r\n#> [1] 50\r\nmasked_function(my_function, as.environment(list(some_var = 1)))()\r\n#> [1] 6{noformat}",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=jonkeane",
                        "name": "jonkeane",
                        "key": "jonkeane",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=34057",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34057",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34057",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34057"
                        },
                        "displayName": "Jonathan Keane",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "created": "2021-11-03T12:34:10.084+0000",
                    "updated": "2021-11-03T13:29:15.693+0000"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13402717/comment/17438074",
                    "id": "17438074",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=jonkeane",
                        "name": "jonkeane",
                        "key": "jonkeane",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=34057",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34057",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34057",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34057"
                        },
                        "displayName": "Jonathan Keane",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "body": "Yeah, it's not quite the same thing as described in the top/bottom of data mask docs, but similar (and we could maybe use this stacking to get what we want here? Though I haven't looked at this deeply in a while)\r\n\r\nhttps://rlang.r-lib.org/reference/as_data_mask.html#top-and-bottom-of-data-mask\r\n\r\nIn case you haven't yet found it, our masking happens at https://github.com/apache/arrow/blob/16af17c3327cfe624038913a7a808656082f69e0/r/R/dplyr-eval.R#L78-L111",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=jonkeane",
                        "name": "jonkeane",
                        "key": "jonkeane",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=34057",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34057",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34057",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34057"
                        },
                        "displayName": "Jonathan Keane",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "created": "2021-11-03T13:49:55.929+0000",
                    "updated": "2021-11-03T13:49:55.929+0000"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13402717/comment/17438152",
                    "id": "17438152",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=npr",
                        "name": "npr",
                        "key": "npr",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=34045",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34045",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34045",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34045"
                        },
                        "displayName": "Neal Richardson",
                        "active": true,
                        "timeZone": "America/Los_Angeles"
                    },
                    "body": "You could try copying the function into the data_mask and setting its env. Question is whether you should require a user to first register their function (i.e. do this explicitly) or whether to somehow detect functions and pull them automatically. ",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=npr",
                        "name": "npr",
                        "key": "npr",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=34045",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34045",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34045",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34045"
                        },
                        "displayName": "Neal Richardson",
                        "active": true,
                        "timeZone": "America/Los_Angeles"
                    },
                    "created": "2021-11-03T15:36:43.377+0000",
                    "updated": "2021-11-03T15:36:43.377+0000"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13402717/comment/17583523",
                    "id": "17583523",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=dragosmg",
                        "name": "dragosmg",
                        "key": "dragosmg",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=34061",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34061",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34061",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34061"
                        },
                        "displayName": "Drago\u0219 Moldovan-Gr\u00fcnfeld",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "body": "Maybe a silly question, but do we want to allow user defined functions inside {{summarise()}} too (i.e. translate aggregating functions too; or a mixture of aggregating and non-aggregating functions)? [~npr] [~jonkeane] [~paleolimbot]\u00a0",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=dragosmg",
                        "name": "dragosmg",
                        "key": "dragosmg",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=34061",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34061",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34061",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34061"
                        },
                        "displayName": "Drago\u0219 Moldovan-Gr\u00fcnfeld",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "created": "2022-08-23T11:14:59.736+0000",
                    "updated": "2022-08-23T11:14:59.736+0000"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13402717/comment/17583752",
                    "id": "17583752",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=westonpace",
                        "name": "westonpace",
                        "key": "westonpace",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=34045",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34045",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34045",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34045"
                        },
                        "displayName": "Weston Pace",
                        "active": true,
                        "timeZone": "America/Los_Angeles"
                    },
                    "body": "Aggregation (summarise) operations are a little trickier and some C++ work will probably need to be done to formalize things a bit but it is not a huge lift from where we are.  In Acero, aggregate operations are stateful and are actually represented by three different functions: consume (process a batch and update state), merge (combine two states into one), and finalize (turn a state into record batches).  So, for example, the min operation is:\r\n\r\nconsume - find the minimum value in a batch and, if smaller than state.min, update state.min\r\nmerge - compare two state.min and update with the smaller of the two\r\nfinalize - turn state.min into an int64 scalar\r\n\r\nWhen writing UDFs we would probably need to follow the same structure and provide three R functions for each aggregate operation.",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=westonpace",
                        "name": "westonpace",
                        "key": "westonpace",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=34045",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34045",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34045",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34045"
                        },
                        "displayName": "Weston Pace",
                        "active": true,
                        "timeZone": "America/Los_Angeles"
                    },
                    "created": "2022-08-23T16:50:21.403+0000",
                    "updated": "2022-08-23T16:50:21.403+0000"
                }
            ],
            "maxResults": 5,
            "total": 5,
            "startAt": 0
        },
        "customfield_12311820": "0|z0v6r4:",
        "customfield_12314139": null
    }
}