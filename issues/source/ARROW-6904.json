{
    "expand": "operations,versionedRepresentations,editmeta,changelog,renderedFields",
    "id": "13262660",
    "self": "https://issues.apache.org/jira/rest/api/2/issue/13262660",
    "key": "ARROW-6904",
    "fields": {
        "fixVersions": [
            {
                "self": "https://issues.apache.org/jira/rest/api/2/version/12340948",
                "id": "12340948",
                "description": "",
                "name": "0.16.0",
                "archived": false,
                "released": true,
                "releaseDate": "2020-02-07"
            }
        ],
        "resolution": {
            "self": "https://issues.apache.org/jira/rest/api/2/resolution/1",
            "id": "1",
            "description": "A fix for this issue is checked into the tree and tested.",
            "name": "Fixed"
        },
        "customfield_12312322": null,
        "customfield_12312323": null,
        "customfield_12312320": null,
        "customfield_12310420": "9223372036854775807",
        "customfield_12312321": null,
        "customfield_12312328": null,
        "customfield_12312329": null,
        "customfield_12312326": null,
        "customfield_12310300": null,
        "customfield_12312327": null,
        "customfield_12312324": null,
        "customfield_12312720": null,
        "customfield_12312325": null,
        "lastViewed": null,
        "priority": {
            "self": "https://issues.apache.org/jira/rest/api/2/priority/3",
            "iconUrl": "https://issues.apache.org/jira/images/icons/priorities/major.svg",
            "name": "Major",
            "id": "3"
        },
        "labels": [
            "pull-request-available"
        ],
        "customfield_12312333": null,
        "customfield_12312334": null,
        "customfield_12313422": "false",
        "customfield_12310310": "0.0",
        "customfield_12312331": null,
        "customfield_12312332": null,
        "aggregatetimeoriginalestimate": null,
        "timeestimate": 0,
        "customfield_12312330": null,
        "versions": [],
        "customfield_12311120": null,
        "customfield_12313826": null,
        "customfield_12312339": null,
        "issuelinks": [
            {
                "id": "12572502",
                "self": "https://issues.apache.org/jira/rest/api/2/issueLink/12572502",
                "type": {
                    "id": "10030",
                    "name": "Reference",
                    "inward": "is related to",
                    "outward": "relates to",
                    "self": "https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"
                },
                "inwardIssue": {
                    "id": "13261158",
                    "key": "ARROW-6820",
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13261158",
                    "fields": {
                        "summary": "[C++] [Doc] [Format] Map specification and implementation inconsistent",
                        "status": {
                            "self": "https://issues.apache.org/jira/rest/api/2/status/5",
                            "description": "A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.",
                            "iconUrl": "https://issues.apache.org/jira/images/icons/statuses/resolved.png",
                            "name": "Resolved",
                            "id": "5",
                            "statusCategory": {
                                "self": "https://issues.apache.org/jira/rest/api/2/statuscategory/3",
                                "id": 3,
                                "key": "done",
                                "colorName": "green",
                                "name": "Done"
                            }
                        },
                        "priority": {
                            "self": "https://issues.apache.org/jira/rest/api/2/priority/1",
                            "iconUrl": "https://issues.apache.org/jira/images/icons/priorities/blocker.svg",
                            "name": "Blocker",
                            "id": "1"
                        },
                        "issuetype": {
                            "self": "https://issues.apache.org/jira/rest/api/2/issuetype/1",
                            "id": "1",
                            "description": "A problem which impairs or prevents the functions of the product.",
                            "iconUrl": "https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype",
                            "name": "Bug",
                            "subtask": false,
                            "avatarId": 21133
                        }
                    }
                }
            },
            {
                "id": "12572093",
                "self": "https://issues.apache.org/jira/rest/api/2/issueLink/12572093",
                "type": {
                    "id": "10030",
                    "name": "Reference",
                    "inward": "is related to",
                    "outward": "relates to",
                    "self": "https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"
                },
                "inwardIssue": {
                    "id": "13200007",
                    "key": "ARROW-3850",
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13200007",
                    "fields": {
                        "summary": "[Python] Support MapType and StructType for enhanced PySpark integration",
                        "status": {
                            "self": "https://issues.apache.org/jira/rest/api/2/status/5",
                            "description": "A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.",
                            "iconUrl": "https://issues.apache.org/jira/images/icons/statuses/resolved.png",
                            "name": "Resolved",
                            "id": "5",
                            "statusCategory": {
                                "self": "https://issues.apache.org/jira/rest/api/2/statuscategory/3",
                                "id": 3,
                                "key": "done",
                                "colorName": "green",
                                "name": "Done"
                            }
                        },
                        "priority": {
                            "self": "https://issues.apache.org/jira/rest/api/2/priority/3",
                            "iconUrl": "https://issues.apache.org/jira/images/icons/priorities/major.svg",
                            "name": "Major",
                            "id": "3"
                        },
                        "issuetype": {
                            "self": "https://issues.apache.org/jira/rest/api/2/issuetype/2",
                            "id": "2",
                            "description": "A new feature of the product, which has yet to be developed.",
                            "iconUrl": "https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21141&avatarType=issuetype",
                            "name": "New Feature",
                            "subtask": false,
                            "avatarId": 21141
                        }
                    }
                }
            },
            {
                "id": "12572101",
                "self": "https://issues.apache.org/jira/rest/api/2/issueLink/12572101",
                "type": {
                    "id": "10001",
                    "name": "dependent",
                    "inward": "is depended upon by",
                    "outward": "depends upon",
                    "self": "https://issues.apache.org/jira/rest/api/2/issueLinkType/10001"
                },
                "inwardIssue": {
                    "id": "13165945",
                    "key": "SPARK-24554",
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13165945",
                    "fields": {
                        "summary": "Add MapType Support for Arrow in PySpark",
                        "status": {
                            "self": "https://issues.apache.org/jira/rest/api/2/status/5",
                            "description": "A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.",
                            "iconUrl": "https://issues.apache.org/jira/images/icons/statuses/resolved.png",
                            "name": "Resolved",
                            "id": "5",
                            "statusCategory": {
                                "self": "https://issues.apache.org/jira/rest/api/2/statuscategory/3",
                                "id": 3,
                                "key": "done",
                                "colorName": "green",
                                "name": "Done"
                            }
                        },
                        "priority": {
                            "self": "https://issues.apache.org/jira/rest/api/2/priority/3",
                            "iconUrl": "https://issues.apache.org/jira/images/icons/priorities/major.svg",
                            "name": "Major",
                            "id": "3"
                        },
                        "issuetype": {
                            "self": "https://issues.apache.org/jira/rest/api/2/issuetype/7",
                            "id": "7",
                            "description": "The sub-task of the issue",
                            "iconUrl": "https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21146&avatarType=issuetype",
                            "name": "Sub-task",
                            "subtask": true,
                            "avatarId": 21146
                        }
                    }
                }
            }
        ],
        "customfield_12313825": null,
        "assignee": {
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=bryanc",
            "name": "bryanc",
            "key": "bryanc",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=bryanc&avatarId=23479",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=bryanc&avatarId=23479",
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=bryanc&avatarId=23479",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=bryanc&avatarId=23479"
            },
            "displayName": "Bryan Cutler",
            "active": true,
            "timeZone": "America/Los_Angeles"
        },
        "customfield_12312337": null,
        "customfield_12313823": null,
        "customfield_12312338": null,
        "customfield_12311920": null,
        "customfield_12313822": null,
        "customfield_12312335": null,
        "customfield_12313821": null,
        "customfield_12312336": null,
        "customfield_12313820": null,
        "status": {
            "self": "https://issues.apache.org/jira/rest/api/2/status/5",
            "description": "A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.",
            "iconUrl": "https://issues.apache.org/jira/images/icons/statuses/resolved.png",
            "name": "Resolved",
            "id": "5",
            "statusCategory": {
                "self": "https://issues.apache.org/jira/rest/api/2/statuscategory/3",
                "id": 3,
                "key": "done",
                "colorName": "green",
                "name": "Done"
            }
        },
        "components": [
            {
                "self": "https://issues.apache.org/jira/rest/api/2/component/12328936",
                "id": "12328936",
                "name": "Python"
            }
        ],
        "customfield_12312026": null,
        "customfield_12312023": null,
        "customfield_12312024": null,
        "aggregatetimeestimate": 0,
        "customfield_12312022": null,
        "customfield_12310921": null,
        "customfield_12310920": "9223372036854775807",
        "customfield_12312823": null,
        "creator": {
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=bryanc",
            "name": "bryanc",
            "key": "bryanc",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=bryanc&avatarId=23479",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=bryanc&avatarId=23479",
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=bryanc&avatarId=23479",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=bryanc&avatarId=23479"
            },
            "displayName": "Bryan Cutler",
            "active": true,
            "timeZone": "America/Los_Angeles"
        },
        "subtasks": [],
        "reporter": {
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=bryanc",
            "name": "bryanc",
            "key": "bryanc",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=bryanc&avatarId=23479",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=bryanc&avatarId=23479",
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=bryanc&avatarId=23479",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=bryanc&avatarId=23479"
            },
            "displayName": "Bryan Cutler",
            "active": true,
            "timeZone": "America/Los_Angeles"
        },
        "aggregateprogress": {
            "progress": 40800,
            "total": 40800,
            "percent": 100
        },
        "customfield_12313520": null,
        "customfield_12310250": null,
        "progress": {
            "progress": 40800,
            "total": 40800,
            "percent": 100
        },
        "customfield_12313924": null,
        "votes": {
            "self": "https://issues.apache.org/jira/rest/api/2/issue/ARROW-6904/votes",
            "votes": 0,
            "hasVoted": false
        },
        "worklog": {
            "startAt": 0,
            "maxResults": 20,
            "total": 81,
            "worklogs": [
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13262660/worklog/338422",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "BryanCutler commented on pull request #5774: ARROW-6904: [Python] Add support for MapArray\nURL: https://github.com/apache/arrow/pull/5774\n \n \n   This adds support for `MapArray` in Python with conversion from a Python sequence of either dictionaries with \"key\" and \"value\" fields or a tuple with 2 elements. Additionally, added the API `MapArray.from_arrays` to build a `MapArray` from individual offset, key, value arrays.\n \n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2019-11-05T00:14:37.311+0000",
                    "updated": "2019-11-05T00:14:37.311+0000",
                    "started": "2019-11-05T00:14:37.311+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "338422",
                    "issueId": "13262660"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13262660/worklog/338423",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "github-actions[bot] commented on issue #5774: ARROW-6904: [Python] Add support for MapArray\nURL: https://github.com/apache/arrow/pull/5774#issuecomment-549606716\n \n \n   https://issues.apache.org/jira/browse/ARROW-6904\n \n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2019-11-05T00:18:56.181+0000",
                    "updated": "2019-11-05T00:18:56.181+0000",
                    "started": "2019-11-05T00:18:56.181+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "338423",
                    "issueId": "13262660"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13262660/worklog/338424",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "BryanCutler commented on issue #5774: ARROW-6904: [Python] Add support for MapArray\nURL: https://github.com/apache/arrow/pull/5774#issuecomment-549609131\n \n \n   Made this a draft PR because there are a few things to work out, but feel free to review. Mainly, I think https://issues.apache.org/jira/browse/ARROW-6820 should be resolved first. It was really confusing to keep everything straight since in C++ MapType uses 2 fields for \"key\" and \"value\" but the MapArray APIs define everything as \"key\" and \"item\". I kept everything as key/item for now.\n \n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2019-11-05T00:28:31.721+0000",
                    "updated": "2019-11-05T00:28:31.721+0000",
                    "started": "2019-11-05T00:28:31.721+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "338424",
                    "issueId": "13262660"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13262660/worklog/338425",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "BryanCutler commented on issue #5774: ARROW-6904: [Python] Add support for MapArray\nURL: https://github.com/apache/arrow/pull/5774#issuecomment-549609131\n \n \n   Made this a draft PR because there are a few things to work out, but feel free to review. Mainly, I think https://issues.apache.org/jira/browse/ARROW-6820 should be resolved first. It was really confusing to keep everything straight since in C++ MapType uses 2 fields for \"key\" and \"value\" but the MapArray APIs define everything as \"key\" and \"item\". I kept everything as key/item for now and I'll comment on the related JIRA.\n \n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2019-11-05T00:28:56.763+0000",
                    "updated": "2019-11-05T00:28:56.763+0000",
                    "started": "2019-11-05T00:28:56.763+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "338425",
                    "issueId": "13262660"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13262660/worklog/338430",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "BryanCutler commented on pull request #5774: ARROW-6904: [Python] Add support for MapArray\nURL: https://github.com/apache/arrow/pull/5774#discussion_r342342828\n \n \n\n ##########\n File path: cpp/src/arrow/array.cc\n ##########\n @@ -380,19 +382,82 @@ MapArray::MapArray(const std::shared_ptr<DataType>& type, int64_t length,\n   SetData(map_data);\n }\n \n+Status MapArray::FromArrays(const std::shared_ptr<Array>& offsets,\n+                            const std::shared_ptr<Array>& keys,\n+                            const std::shared_ptr<Array>& items,\n+                            MemoryPool* pool, std::shared_ptr<Array>* out) {\n+  using offset_type = typename MapType::offset_type;\n+  using OffsetArrowType = typename CTypeTraits<offset_type>::ArrowType;\n+  using OffsetArrayType = typename TypeTraits<OffsetArrowType>::ArrayType;\n+\n+  if (offsets->length() == 0) {\n+    return Status::Invalid(\"Map offsets must have non-zero length\");\n+  }\n+\n+  if (offsets->type_id() != OffsetArrowType::type_id) {\n+    return Status::TypeError(\"Map offsets must be \", OffsetArrowType::type_name());\n+  }\n+\n+  if (keys->length() != items->length()) {\n+    return Status::Invalid(\"Map key and item arrays must be equal length\");\n+  }\n+\n+  std::shared_ptr<Buffer> offset_buf, validity_buf;\n+\n+  const auto typed_offsets = checked_pointer_cast<const OffsetArrayType>(offsets);\n+\n+  const int64_t num_offsets = offsets->length();\n+\n+  if (offsets->null_count() > 0) {\n+    if (!offsets->IsValid(num_offsets - 1)) {\n+      return Status::Invalid(\"Last map offset should be non-null\");\n+    }\n+\n+    std::shared_ptr<Buffer> clean_offsets, clean_valid_bits;\n+    RETURN_NOT_OK(\n+        AllocateBuffer(pool, num_offsets * sizeof(offset_type), &clean_offsets));\n+\n+    // Copy valid bits, zero out the bit for the final offset\n+    // XXX why?\n+    RETURN_NOT_OK(offsets->null_bitmap()->Copy(0, BitUtil::BytesForBits(num_offsets - 1),\n+                                               &clean_valid_bits));\n+    BitUtil::ClearBit(clean_valid_bits->mutable_data(), num_offsets);\n+    validity_buf = clean_valid_bits;\n+\n+    const offset_type* raw_offsets = typed_offsets->raw_values();\n+    auto clean_raw_offsets =\n+        reinterpret_cast<offset_type*>(clean_offsets->mutable_data());\n+\n+    // Must work backwards so we can tell how many values were in the last non-null value\n+    offset_type current_offset = raw_offsets[num_offsets - 1];\n+    for (int64_t i = num_offsets - 1; i >= 0; --i) {\n+      if (offsets->IsValid(i)) {\n+        current_offset = raw_offsets[i];\n+      }\n+      clean_raw_offsets[i] = current_offset;\n+    }\n+\n+    offset_buf = clean_offsets;\n+  } else {\n+    validity_buf = offsets->null_bitmap();\n+    offset_buf = typed_offsets->values();\n+  }\n+\n+  auto map_type = std::make_shared<MapType>(keys->type(), items->type());\n+  *out = std::make_shared<MapArray>(map_type, num_offsets - 1, offset_buf,\n+                                    keys, items, validity_buf,\n+                                    offsets->null_count(), offsets->offset());\n+  return Status::OK();\n+}\n+\n void MapArray::SetData(const std::shared_ptr<ArrayData>& data) {\n-  ARROW_CHECK_EQ(data->type->id(), Type::MAP);\n+  this->ListArray::SetData(data, Type::MAP);\n   auto pair_data = data->child_data[0];\n   ARROW_CHECK_EQ(pair_data->type->id(), Type::STRUCT);\n   ARROW_CHECK_EQ(pair_data->null_count, 0);\n   ARROW_CHECK_EQ(pair_data->child_data.size(), 2);\n   ARROW_CHECK_EQ(pair_data->child_data[0]->null_count, 0);\n \n-  auto pair_list_data = data->Copy();\n-  pair_list_data->type = list(pair_data->type);\n-  this->ListArray::SetData(pair_list_data);\n-  data_->type = data->type;\n \n Review comment:\n   This was causing a problem. Calling `this->ListArray::SetData(pair_list_data)` would set `list_type_ = pair_list_data->type.get()`, then `pair_list_data->type()` was cleaned up and `list_type_` was no longer valid. Then calling `BaseListArray::value_type()` would crash.\n \n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2019-11-05T01:00:10.293+0000",
                    "updated": "2019-11-05T01:00:10.293+0000",
                    "started": "2019-11-05T01:00:10.292+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "338430",
                    "issueId": "13262660"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13262660/worklog/338432",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "BryanCutler commented on pull request #5774: ARROW-6904: [Python] Add support for MapArray\nURL: https://github.com/apache/arrow/pull/5774#discussion_r342344107\n \n \n\n ##########\n File path: cpp/src/arrow/array/builder_nested.cc\n ##########\n @@ -62,31 +66,23 @@ Status MapBuilder::Resize(int64_t capacity) {\n \n void MapBuilder::Reset() {\n   list_builder_->Reset();\n-  item_builder_->Reset();\n   ArrayBuilder::Reset();\n }\n \n Status MapBuilder::FinishInternal(std::shared_ptr<ArrayData>* out) {\n   ARROW_CHECK_EQ(item_builder_->length(), key_builder_->length())\n       << \"keys and items builders don't have the same size in MapBuilder\";\n-  // finish list(keys) builder\n+  RETURN_NOT_OK(CheckStructBuilderLength());\n   RETURN_NOT_OK(list_builder_->FinishInternal(out));\n-  // finish values builder\n-  std::shared_ptr<ArrayData> items_data;\n-  RETURN_NOT_OK(item_builder_->FinishInternal(&items_data));\n-\n-  auto keys_data = (*out)->child_data[0];\n   (*out)->type = type();\n-  (*out)->child_data[0] =\n-      ArrayData::Make((*out)->type->child(0)->type(), keys_data->length, {nullptr},\n-                      {keys_data, items_data}, 0, 0);\n \n Review comment:\n   This seemed a bit odd, using a list of keys builder and a separate item builder. I changed it to use use a list builder with a child struct builder. This way I could use this builder to convert a py sequence with the ListConverter as-is.  The only issue was that when using the separate key_builder and item_builders, the struct_builder needs a call to `Append`\\`AppendValues` before adding the next index in the MapArray.\n \n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2019-11-05T01:06:37.714+0000",
                    "updated": "2019-11-05T01:06:37.714+0000",
                    "started": "2019-11-05T01:06:37.713+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "338432",
                    "issueId": "13262660"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13262660/worklog/338433",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "BryanCutler commented on pull request #5774: ARROW-6904: [Python] Add support for MapArray\nURL: https://github.com/apache/arrow/pull/5774#discussion_r342344225\n \n \n\n ##########\n File path: cpp/src/arrow/array_list_test.cc\n ##########\n @@ -520,7 +520,7 @@ TEST_F(TestMapArray, BuildingStringToInt) {\n   ASSERT_OK(map_builder.Finish(&actual));\n   ASSERT_OK(actual->Validate());\n \n-  ASSERT_ARRAYS_EQUAL(*actual, expected);\n+  ASSERT_ARRAYS_EQUAL(expected, *actual);\n \n Review comment:\n   TODO: revert\n \n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2019-11-05T01:07:17.418+0000",
                    "updated": "2019-11-05T01:07:17.418+0000",
                    "started": "2019-11-05T01:07:17.418+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "338433",
                    "issueId": "13262660"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13262660/worklog/338954",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "BryanCutler commented on pull request #5774: ARROW-6904: [Python] Add support for MapArray\nURL: https://github.com/apache/arrow/pull/5774#discussion_r342344107\n \n \n\n ##########\n File path: cpp/src/arrow/array/builder_nested.cc\n ##########\n @@ -62,31 +66,23 @@ Status MapBuilder::Resize(int64_t capacity) {\n \n void MapBuilder::Reset() {\n   list_builder_->Reset();\n-  item_builder_->Reset();\n   ArrayBuilder::Reset();\n }\n \n Status MapBuilder::FinishInternal(std::shared_ptr<ArrayData>* out) {\n   ARROW_CHECK_EQ(item_builder_->length(), key_builder_->length())\n       << \"keys and items builders don't have the same size in MapBuilder\";\n-  // finish list(keys) builder\n+  RETURN_NOT_OK(CheckStructBuilderLength());\n   RETURN_NOT_OK(list_builder_->FinishInternal(out));\n-  // finish values builder\n-  std::shared_ptr<ArrayData> items_data;\n-  RETURN_NOT_OK(item_builder_->FinishInternal(&items_data));\n-\n-  auto keys_data = (*out)->child_data[0];\n   (*out)->type = type();\n-  (*out)->child_data[0] =\n-      ArrayData::Make((*out)->type->child(0)->type(), keys_data->length, {nullptr},\n-                      {keys_data, items_data}, 0, 0);\n \n Review comment:\n   This seemed a bit odd, using a list of keys builder and a separate item builder. I changed it to use use a list builder with a child struct builder. This way I could use this builder to convert a py sequence with the ListConverter as-is.  The only issue was that when using the separate key_builder and item_builders, the struct_builder needs a call to `Append`\\`AppendValues` before adding the next index in the MapArray, so I added `CheckStructBuilderLength` to handle this.\n \n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2019-11-05T19:22:53.430+0000",
                    "updated": "2019-11-05T19:22:53.430+0000",
                    "started": "2019-11-05T19:22:53.430+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "338954",
                    "issueId": "13262660"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13262660/worklog/339040",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "BryanCutler commented on issue #5774: ARROW-6904: [Python] Add support for MapArray\nURL: https://github.com/apache/arrow/pull/5774#issuecomment-550062429\n \n \n   Tests look to be passing now, I removed draft status. If we decide to change the Map terminology, I can update this.\n \n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2019-11-05T23:01:07.355+0000",
                    "updated": "2019-11-05T23:01:07.355+0000",
                    "started": "2019-11-05T23:01:07.354+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "339040",
                    "issueId": "13262660"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13262660/worklog/339041",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "BryanCutler commented on issue #5774: ARROW-6904: [Python] Add support for MapArray\nURL: https://github.com/apache/arrow/pull/5774#issuecomment-550062850\n \n \n   ping @wesm @pitrou @bkietz to take a look when you can, thanks!\n \n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2019-11-05T23:02:23.539+0000",
                    "updated": "2019-11-05T23:02:23.539+0000",
                    "started": "2019-11-05T23:02:23.539+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "339041",
                    "issueId": "13262660"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13262660/worklog/339236",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "pitrou commented on pull request #5774: ARROW-6904: [Python] Add support for MapArray\nURL: https://github.com/apache/arrow/pull/5774#discussion_r342973570\n \n \n\n ##########\n File path: cpp/src/arrow/array.cc\n ##########\n @@ -380,19 +382,82 @@ MapArray::MapArray(const std::shared_ptr<DataType>& type, int64_t length,\n   SetData(map_data);\n }\n \n+Status MapArray::FromArrays(const std::shared_ptr<Array>& offsets,\n+                            const std::shared_ptr<Array>& keys,\n+                            const std::shared_ptr<Array>& items, MemoryPool* pool,\n+                            std::shared_ptr<Array>* out) {\n+  using offset_type = typename MapType::offset_type;\n+  using OffsetArrowType = typename CTypeTraits<offset_type>::ArrowType;\n+  using OffsetArrayType = typename TypeTraits<OffsetArrowType>::ArrayType;\n+\n+  if (offsets->length() == 0) {\n+    return Status::Invalid(\"Map offsets must have non-zero length\");\n+  }\n+\n+  if (offsets->type_id() != OffsetArrowType::type_id) {\n+    return Status::TypeError(\"Map offsets must be \", OffsetArrowType::type_name());\n+  }\n+\n+  if (keys->length() != items->length()) {\n+    return Status::Invalid(\"Map key and item arrays must be equal length\");\n+  }\n+\n+  std::shared_ptr<Buffer> offset_buf, validity_buf;\n+\n+  const auto typed_offsets = checked_pointer_cast<const OffsetArrayType>(offsets);\n+\n+  const int64_t num_offsets = offsets->length();\n+\n+  if (offsets->null_count() > 0) {\n+    if (!offsets->IsValid(num_offsets - 1)) {\n+      return Status::Invalid(\"Last map offset should be non-null\");\n+    }\n+\n+    std::shared_ptr<Buffer> clean_offsets, clean_valid_bits;\n+    RETURN_NOT_OK(\n+        AllocateBuffer(pool, num_offsets * sizeof(offset_type), &clean_offsets));\n+\n+    // Copy valid bits, zero out the bit for the final offset\n+    // XXX why?\n+    RETURN_NOT_OK(offsets->null_bitmap()->Copy(0, BitUtil::BytesForBits(num_offsets - 1),\n+                                               &clean_valid_bits));\n+    BitUtil::ClearBit(clean_valid_bits->mutable_data(), num_offsets);\n+    validity_buf = clean_valid_bits;\n+\n+    const offset_type* raw_offsets = typed_offsets->raw_values();\n+    auto clean_raw_offsets =\n+        reinterpret_cast<offset_type*>(clean_offsets->mutable_data());\n+\n+    // Must work backwards so we can tell how many values were in the last non-null value\n+    offset_type current_offset = raw_offsets[num_offsets - 1];\n+    for (int64_t i = num_offsets - 1; i >= 0; --i) {\n+      if (offsets->IsValid(i)) {\n+        current_offset = raw_offsets[i];\n+      }\n+      clean_raw_offsets[i] = current_offset;\n+    }\n+\n+    offset_buf = clean_offsets;\n+  } else {\n+    validity_buf = offsets->null_bitmap();\n+    offset_buf = typed_offsets->values();\n+  }\n+\n+  auto map_type = std::make_shared<MapType>(keys->type(), items->type());\n+  *out =\n+      std::make_shared<MapArray>(map_type, num_offsets - 1, offset_buf, keys, items,\n+                                 validity_buf, offsets->null_count(), offsets->offset());\n+  return Status::OK();\n+}\n+\n void MapArray::SetData(const std::shared_ptr<ArrayData>& data) {\n-  ARROW_CHECK_EQ(data->type->id(), Type::MAP);\n+  this->ListArray::SetData(data, Type::MAP);\n \n Review comment:\n   Shouldn't this be done after the various checks?\n \n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2019-11-06T09:08:07.942+0000",
                    "updated": "2019-11-06T09:08:07.942+0000",
                    "started": "2019-11-06T09:08:07.942+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "339236",
                    "issueId": "13262660"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13262660/worklog/339237",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "pitrou commented on pull request #5774: ARROW-6904: [Python] Add support for MapArray\nURL: https://github.com/apache/arrow/pull/5774#discussion_r342973877\n \n \n\n ##########\n File path: cpp/src/arrow/array.cc\n ##########\n @@ -380,19 +382,82 @@ MapArray::MapArray(const std::shared_ptr<DataType>& type, int64_t length,\n   SetData(map_data);\n }\n \n+Status MapArray::FromArrays(const std::shared_ptr<Array>& offsets,\n+                            const std::shared_ptr<Array>& keys,\n+                            const std::shared_ptr<Array>& items, MemoryPool* pool,\n+                            std::shared_ptr<Array>* out) {\n+  using offset_type = typename MapType::offset_type;\n+  using OffsetArrowType = typename CTypeTraits<offset_type>::ArrowType;\n+  using OffsetArrayType = typename TypeTraits<OffsetArrowType>::ArrayType;\n+\n+  if (offsets->length() == 0) {\n+    return Status::Invalid(\"Map offsets must have non-zero length\");\n+  }\n+\n+  if (offsets->type_id() != OffsetArrowType::type_id) {\n+    return Status::TypeError(\"Map offsets must be \", OffsetArrowType::type_name());\n+  }\n+\n+  if (keys->length() != items->length()) {\n+    return Status::Invalid(\"Map key and item arrays must be equal length\");\n+  }\n+\n+  std::shared_ptr<Buffer> offset_buf, validity_buf;\n+\n+  const auto typed_offsets = checked_pointer_cast<const OffsetArrayType>(offsets);\n+\n+  const int64_t num_offsets = offsets->length();\n+\n+  if (offsets->null_count() > 0) {\n+    if (!offsets->IsValid(num_offsets - 1)) {\n+      return Status::Invalid(\"Last map offset should be non-null\");\n+    }\n+\n+    std::shared_ptr<Buffer> clean_offsets, clean_valid_bits;\n+    RETURN_NOT_OK(\n+        AllocateBuffer(pool, num_offsets * sizeof(offset_type), &clean_offsets));\n+\n+    // Copy valid bits, zero out the bit for the final offset\n+    // XXX why?\n \n Review comment:\n   This is the logic from `ListArray::FromArrays`? It may be better to factor it out instead of duplicating the code.\n \n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2019-11-06T09:08:08.292+0000",
                    "updated": "2019-11-06T09:08:08.292+0000",
                    "started": "2019-11-06T09:08:08.292+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "339237",
                    "issueId": "13262660"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13262660/worklog/339238",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "pitrou commented on pull request #5774: ARROW-6904: [Python] Add support for MapArray\nURL: https://github.com/apache/arrow/pull/5774#discussion_r342974778\n \n \n\n ##########\n File path: cpp/src/arrow/array/builder_nested.cc\n ##########\n @@ -110,12 +108,25 @@ Status MapBuilder::AppendNull() {\n \n Status MapBuilder::AppendNulls(int64_t length) {\n   DCHECK_EQ(item_builder_->length(), key_builder_->length());\n+  RETURN_NOT_OK(CheckStructBuilderLength());\n   RETURN_NOT_OK(list_builder_->AppendNulls(length));\n   length_ = list_builder_->length();\n   null_count_ = list_builder_->null_count();\n   return Status::OK();\n }\n \n+Status MapBuilder::CheckStructBuilderLength() {\n+  // If key/item builders have been appended, adjust struct builder lenght\n \n Review comment:\n   Typo: \"lenght\"\n \n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2019-11-06T09:08:08.337+0000",
                    "updated": "2019-11-06T09:08:08.337+0000",
                    "started": "2019-11-06T09:08:08.337+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "339238",
                    "issueId": "13262660"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13262660/worklog/339240",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "pitrou commented on pull request #5774: ARROW-6904: [Python] Add support for MapArray\nURL: https://github.com/apache/arrow/pull/5774#discussion_r342975847\n \n \n\n ##########\n File path: cpp/src/arrow/array/builder_nested.cc\n ##########\n @@ -110,12 +108,25 @@ Status MapBuilder::AppendNull() {\n \n Status MapBuilder::AppendNulls(int64_t length) {\n   DCHECK_EQ(item_builder_->length(), key_builder_->length());\n+  RETURN_NOT_OK(CheckStructBuilderLength());\n   RETURN_NOT_OK(list_builder_->AppendNulls(length));\n   length_ = list_builder_->length();\n   null_count_ = list_builder_->null_count();\n   return Status::OK();\n }\n \n+Status MapBuilder::CheckStructBuilderLength() {\n+  // If key/item builders have been appended, adjust struct builder lenght\n+  // to match. Struct and key are non-nullable, append all valid values.\n+  if (list_builder_->value_builder()->length() < key_builder_->length()) {\n \n Review comment:\n   Hmm... `length` below compares the key builder length and the struct builder length. Here you are comparing the list builder length and the key builder length. This seems inconsistent. Also suggest factoring out the `length` definition above.\n \n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2019-11-06T09:08:08.341+0000",
                    "updated": "2019-11-06T09:08:08.341+0000",
                    "started": "2019-11-06T09:08:08.340+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "339240",
                    "issueId": "13262660"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13262660/worklog/339239",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "pitrou commented on pull request #5774: ARROW-6904: [Python] Add support for MapArray\nURL: https://github.com/apache/arrow/pull/5774#discussion_r342976117\n \n \n\n ##########\n File path: cpp/src/arrow/array/builder_nested.cc\n ##########\n @@ -110,12 +108,25 @@ Status MapBuilder::AppendNull() {\n \n Status MapBuilder::AppendNulls(int64_t length) {\n   DCHECK_EQ(item_builder_->length(), key_builder_->length());\n+  RETURN_NOT_OK(CheckStructBuilderLength());\n   RETURN_NOT_OK(list_builder_->AppendNulls(length));\n   length_ = list_builder_->length();\n   null_count_ = list_builder_->null_count();\n   return Status::OK();\n }\n \n+Status MapBuilder::CheckStructBuilderLength() {\n+  // If key/item builders have been appended, adjust struct builder lenght\n+  // to match. Struct and key are non-nullable, append all valid values.\n \n Review comment:\n   You may also `DCHECK_EQ(key_builder_->length(), value_builder_->length())`?\n \n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2019-11-06T09:08:08.341+0000",
                    "updated": "2019-11-06T09:08:08.341+0000",
                    "started": "2019-11-06T09:08:08.340+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "339239",
                    "issueId": "13262660"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13262660/worklog/339241",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "pitrou commented on pull request #5774: ARROW-6904: [Python] Add support for MapArray\nURL: https://github.com/apache/arrow/pull/5774#discussion_r342980968\n \n \n\n ##########\n File path: python/pyarrow/tests/test_array.py\n ##########\n @@ -576,6 +576,43 @@ def test_list_from_arrays(list_array_type, list_type_factory):\n         list_array_type.from_arrays(offsets, values)\n \n \n+def test_map_from_arrays():\n+    offsets_arr = np.array([0, 2, 5, 8], dtype='i4')\n+    offsets = pa.array(offsets_arr, type='int32')\n+    pykeys = [b'a', b'b', b'c', b'd', b'e', b'f', b'g', b'h']\n+    pyitems = list(range(len(pykeys)))\n+    pypairs = list(zip(pykeys, pyitems))\n+    pyentries = [pypairs[:2], pypairs[2:5], pypairs[5:8]]\n+    keys = pa.array(pykeys, type='binary')\n+    items = pa.array(pyitems, type='i4')\n+\n+    result = pa.MapArray.from_arrays(offsets, keys, items)\n+    expected = pa.array(pyentries, type=pa.map_(pa.binary(), pa.int32()))\n+\n+    assert result.equals(expected)\n+\n+    # With nulls\n+    offsets = [0, None, 2, 6]\n+    pykeys = [b'a', b'b', b'c', b'd', b'e', b'f']\n+    pyitems = [1, 2, 3, None, 4, 5]\n+    pypairs = list(zip(pykeys, pyitems))\n+    pyentries = [pypairs[:2], None, pypairs[2:]]\n+    keys = pa.array(pykeys, type='binary')\n+    items = pa.array(pyitems, type='i4')\n+\n+    result = pa.MapArray.from_arrays(offsets, keys, items)\n+    expected = pa.array(pyentries, type=pa.map_(pa.binary(), pa.int32()))\n+\n+    assert result.equals(expected)\n+\n+    # raise on invalid array\n+    offsets = [1, 3, 10]\n+    keys = np.arange(5)\n+    items = np.arange(4)\n+    with pytest.raises(ValueError):\n+        pa.MapArray.from_arrays(offsets, keys, items)\n \n Review comment:\n   This is cumulating all kinds of errors (bad offsets, keys and items having different lengths). Ideally you'll check each error separately.\n \n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2019-11-06T09:08:08.452+0000",
                    "updated": "2019-11-06T09:08:08.452+0000",
                    "started": "2019-11-06T09:08:08.451+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "339241",
                    "issueId": "13262660"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13262660/worklog/339243",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "pitrou commented on pull request #5774: ARROW-6904: [Python] Add support for MapArray\nURL: https://github.com/apache/arrow/pull/5774#discussion_r342976568\n \n \n\n ##########\n File path: cpp/src/arrow/array/builder_nested.h\n ##########\n @@ -249,11 +249,15 @@ class ARROW_EXPORT MapBuilder : public ArrayBuilder {\n \n   ArrayBuilder* key_builder() const { return key_builder_.get(); }\n   ArrayBuilder* item_builder() const { return item_builder_.get(); }\n+  ArrayBuilder* value_builder() const { return list_builder_->value_builder(); }\n \n Review comment:\n   It may be good to add docstrings here.\n \n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2019-11-06T09:08:08.454+0000",
                    "updated": "2019-11-06T09:08:08.454+0000",
                    "started": "2019-11-06T09:08:08.454+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "339243",
                    "issueId": "13262660"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13262660/worklog/339242",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "pitrou commented on pull request #5774: ARROW-6904: [Python] Add support for MapArray\nURL: https://github.com/apache/arrow/pull/5774#discussion_r342981985\n \n \n\n ##########\n File path: python/pyarrow/scalar.pxi\n ##########\n @@ -731,6 +731,57 @@ cdef class LargeListValue(ArrayValue):\n         return result\n \n \n+cdef class MapValue(ArrayValue):\n \n Review comment:\n   Perhaps add a test in `test_scalars.py`.\n \n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2019-11-06T09:08:08.454+0000",
                    "updated": "2019-11-06T09:08:08.454+0000",
                    "started": "2019-11-06T09:08:08.454+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "339242",
                    "issueId": "13262660"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13262660/worklog/339244",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "pitrou commented on pull request #5774: ARROW-6904: [Python] Add support for MapArray\nURL: https://github.com/apache/arrow/pull/5774#discussion_r342976711\n \n \n\n ##########\n File path: cpp/src/arrow/array/builder_nested.cc\n ##########\n @@ -110,12 +108,25 @@ Status MapBuilder::AppendNull() {\n \n Status MapBuilder::AppendNulls(int64_t length) {\n   DCHECK_EQ(item_builder_->length(), key_builder_->length());\n+  RETURN_NOT_OK(CheckStructBuilderLength());\n   RETURN_NOT_OK(list_builder_->AppendNulls(length));\n   length_ = list_builder_->length();\n   null_count_ = list_builder_->null_count();\n   return Status::OK();\n }\n \n+Status MapBuilder::CheckStructBuilderLength() {\n \n Review comment:\n   Call this `AdjustStructBuilderLength`?\n \n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2019-11-06T09:08:08.455+0000",
                    "updated": "2019-11-06T09:08:08.455+0000",
                    "started": "2019-11-06T09:08:08.454+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "339244",
                    "issueId": "13262660"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13262660/worklog/339245",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "pitrou commented on pull request #5774: ARROW-6904: [Python] Add support for MapArray\nURL: https://github.com/apache/arrow/pull/5774#discussion_r342981742\n \n \n\n ##########\n File path: python/pyarrow/types.pxi\n ##########\n @@ -281,6 +281,33 @@ cdef class LargeListType(DataType):\n         return pyarrow_wrap_data_type(self.list_type.value_type())\n \n \n+cdef class MapType(DataType):\n \n Review comment:\n   Should test this in `test_types.py`.\n \n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2019-11-06T09:08:08.474+0000",
                    "updated": "2019-11-06T09:08:08.474+0000",
                    "started": "2019-11-06T09:08:08.474+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "339245",
                    "issueId": "13262660"
                }
            ]
        },
        "customfield_12313920": null,
        "issuetype": {
            "self": "https://issues.apache.org/jira/rest/api/2/issuetype/4",
            "id": "4",
            "description": "An improvement or enhancement to an existing feature or task.",
            "iconUrl": "https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21140&avatarType=issuetype",
            "name": "Improvement",
            "subtask": false,
            "avatarId": 21140
        },
        "timespent": 40800,
        "customfield_12314020": "{summaryBean=com.atlassian.jira.plugin.devstatus.rest.SummaryBean@2437f68a[summary={pullrequest=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@65d60d69[overall=PullRequestOverallBean{stateCount=0, state='OPEN', details=PullRequestOverallDetails{openCount=0, mergedCount=0, declinedCount=0}},byInstanceType={}], build=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@58ad1bc1[overall=com.atlassian.jira.plugin.devstatus.summary.beans.BuildOverallBean@dc5e8f8[failedBuildCount=0,successfulBuildCount=0,unknownBuildCount=0,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], review=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@5f7c61c3[overall=com.atlassian.jira.plugin.devstatus.summary.beans.ReviewsOverallBean@351785c9[stateCount=0,state=<null>,dueDate=<null>,overDue=false,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], deployment-environment=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@554f3b9[overall=com.atlassian.jira.plugin.devstatus.summary.beans.DeploymentOverallBean@277449c3[topEnvironments=[],showProjects=false,successfulCount=0,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], repository=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@1bba4697[overall=com.atlassian.jira.plugin.devstatus.summary.beans.CommitOverallBean@128aa1e4[count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], branch=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@30614137[overall=com.atlassian.jira.plugin.devstatus.summary.beans.BranchOverallBean@35de3ca9[count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}]},errors=[],configErrors=[]], devSummaryJson={\"cachedValue\":{\"errors\":[],\"configErrors\":[],\"summary\":{\"pullrequest\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"stateCount\":0,\"state\":\"OPEN\",\"details\":{\"openCount\":0,\"mergedCount\":0,\"declinedCount\":0,\"total\":0},\"open\":true},\"byInstanceType\":{}},\"build\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"failedBuildCount\":0,\"successfulBuildCount\":0,\"unknownBuildCount\":0},\"byInstanceType\":{}},\"review\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"stateCount\":0,\"state\":null,\"dueDate\":null,\"overDue\":false,\"completed\":false},\"byInstanceType\":{}},\"deployment-environment\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"topEnvironments\":[],\"showProjects\":false,\"successfulCount\":0},\"byInstanceType\":{}},\"repository\":{\"overall\":{\"count\":0,\"lastUpdated\":null},\"byInstanceType\":{}},\"branch\":{\"overall\":{\"count\":0,\"lastUpdated\":null},\"byInstanceType\":{}}}},\"isStale\":false}}",
        "customfield_12314141": null,
        "customfield_12314140": null,
        "project": {
            "self": "https://issues.apache.org/jira/rest/api/2/project/12319525",
            "id": "12319525",
            "key": "ARROW",
            "name": "Apache Arrow",
            "projectTypeKey": "software",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/projectavatar?pid=12319525&avatarId=10011",
                "24x24": "https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12319525&avatarId=10011",
                "16x16": "https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12319525&avatarId=10011",
                "32x32": "https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12319525&avatarId=10011"
            },
            "projectCategory": {
                "self": "https://issues.apache.org/jira/rest/api/2/projectCategory/13960",
                "id": "13960",
                "description": "Apache Arrow",
                "name": "Arrow"
            }
        },
        "aggregatetimespent": 40800,
        "customfield_12312520": null,
        "customfield_12312521": "Wed Dec 04 19:27:38 UTC 2019",
        "customfield_12314422": null,
        "customfield_12314421": null,
        "customfield_12314146": null,
        "customfield_12314420": null,
        "customfield_12314145": null,
        "customfield_12314144": null,
        "customfield_12314143": null,
        "resolutiondate": "2019-12-04T19:27:38.000+0000",
        "workratio": -1,
        "customfield_12312923": null,
        "customfield_12312920": null,
        "customfield_12312921": null,
        "watches": {
            "self": "https://issues.apache.org/jira/rest/api/2/issue/ARROW-6904/watchers",
            "watchCount": 2,
            "isWatching": false
        },
        "created": "2019-10-16T15:51:28.000+0000",
        "updated": "2019-12-04T19:27:51.000+0000",
        "timeoriginalestimate": null,
        "description": "Map arrays are already added to C++, need to expose them in the Python API also",
        "customfield_10010": null,
        "timetracking": {
            "remainingEstimate": "0h",
            "timeSpent": "11h 20m",
            "remainingEstimateSeconds": 0,
            "timeSpentSeconds": 40800
        },
        "customfield_12314523": null,
        "customfield_12314127": null,
        "customfield_12314522": null,
        "customfield_12314126": null,
        "customfield_12314521": null,
        "customfield_12314125": null,
        "customfield_12314520": null,
        "customfield_12314124": null,
        "attachment": [],
        "customfield_12312340": null,
        "customfield_12314123": null,
        "customfield_12312341": null,
        "customfield_12312220": null,
        "customfield_12314122": null,
        "customfield_12314121": null,
        "customfield_12314120": null,
        "customfield_12314129": null,
        "customfield_12314524": null,
        "customfield_12314128": null,
        "summary": "[Python] Implement MapArray and MapType",
        "customfield_12314130": null,
        "customfield_12310291": null,
        "customfield_12310290": null,
        "customfield_12314138": null,
        "customfield_12314137": null,
        "environment": null,
        "customfield_12314136": null,
        "customfield_12314135": null,
        "customfield_12311020": null,
        "customfield_12314134": null,
        "duedate": null,
        "customfield_12314132": null,
        "customfield_12314131": null,
        "comment": {
            "comments": [
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13262660/comment/16952955",
                    "id": "16952955",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=bryanc",
                        "name": "bryanc",
                        "key": "bryanc",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=bryanc&avatarId=23479",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=bryanc&avatarId=23479",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=bryanc&avatarId=23479",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=bryanc&avatarId=23479"
                        },
                        "displayName": "Bryan Cutler",
                        "active": true,
                        "timeZone": "America/Los_Angeles"
                    },
                    "body": "I can work on this",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=bryanc",
                        "name": "bryanc",
                        "key": "bryanc",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=bryanc&avatarId=23479",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=bryanc&avatarId=23479",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=bryanc&avatarId=23479",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=bryanc&avatarId=23479"
                        },
                        "displayName": "Bryan Cutler",
                        "active": true,
                        "timeZone": "America/Los_Angeles"
                    },
                    "created": "2019-10-16T15:52:33.403+0000",
                    "updated": "2019-10-16T15:52:33.403+0000"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13262660/comment/16988121",
                    "id": "16988121",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=apitrou",
                        "name": "apitrou",
                        "key": "pitrou",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=pitrou&avatarId=35049",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=pitrou&avatarId=35049",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=pitrou&avatarId=35049",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=pitrou&avatarId=35049"
                        },
                        "displayName": "Antoine Pitrou",
                        "active": true,
                        "timeZone": "Europe/Paris"
                    },
                    "body": "Issue resolved by pull request 5774\n[https://github.com/apache/arrow/pull/5774]",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=apitrou",
                        "name": "apitrou",
                        "key": "pitrou",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=pitrou&avatarId=35049",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=pitrou&avatarId=35049",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=pitrou&avatarId=35049",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=pitrou&avatarId=35049"
                        },
                        "displayName": "Antoine Pitrou",
                        "active": true,
                        "timeZone": "Europe/Paris"
                    },
                    "created": "2019-12-04T19:27:38.483+0000",
                    "updated": "2019-12-04T19:27:38.483+0000"
                }
            ],
            "maxResults": 2,
            "total": 2,
            "startAt": 0
        },
        "customfield_12311820": "0|z07nmw:",
        "customfield_12314139": null
    }
}