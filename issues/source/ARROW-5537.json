{
    "expand": "operations,versionedRepresentations,editmeta,changelog,renderedFields",
    "id": "13238396",
    "self": "https://issues.apache.org/jira/rest/api/2/issue/13238396",
    "key": "ARROW-5537",
    "fields": {
        "fixVersions": [
            {
                "self": "https://issues.apache.org/jira/rest/api/2/version/12344925",
                "id": "12344925",
                "description": "",
                "name": "0.14.0",
                "archived": false,
                "released": true,
                "releaseDate": "2019-07-04"
            }
        ],
        "resolution": {
            "self": "https://issues.apache.org/jira/rest/api/2/resolution/1",
            "id": "1",
            "description": "A fix for this issue is checked into the tree and tested.",
            "name": "Fixed"
        },
        "customfield_12312322": null,
        "customfield_12312323": null,
        "customfield_12312320": null,
        "customfield_12310420": "9223372036854775807",
        "customfield_12312321": null,
        "customfield_12312328": null,
        "customfield_12312329": null,
        "customfield_12312326": null,
        "customfield_12310300": null,
        "customfield_12312327": null,
        "customfield_12312324": null,
        "customfield_12312720": null,
        "customfield_12312325": null,
        "lastViewed": null,
        "priority": {
            "self": "https://issues.apache.org/jira/rest/api/2/priority/3",
            "iconUrl": "https://issues.apache.org/jira/images/icons/priorities/major.svg",
            "name": "Major",
            "id": "3"
        },
        "labels": [
            "pull-request-available"
        ],
        "customfield_12312333": null,
        "customfield_12312334": null,
        "customfield_12313422": "false",
        "customfield_12310310": "0.0",
        "customfield_12312331": null,
        "customfield_12312332": null,
        "aggregatetimeoriginalestimate": null,
        "timeestimate": 0,
        "customfield_12312330": null,
        "versions": [
            {
                "self": "https://issues.apache.org/jira/rest/api/2/version/12343937",
                "id": "12343937",
                "description": "",
                "name": "0.13.0",
                "archived": false,
                "released": true,
                "releaseDate": "2019-04-01"
            }
        ],
        "customfield_12311120": null,
        "customfield_12313826": null,
        "customfield_12312339": null,
        "issuelinks": [],
        "customfield_12313825": null,
        "assignee": {
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=paul.e.taylor",
            "name": "paul.e.taylor",
            "key": "paul.e.taylor",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
            },
            "displayName": "Paul Taylor",
            "active": true,
            "timeZone": "America/Los_Angeles"
        },
        "customfield_12312337": null,
        "customfield_12313823": null,
        "customfield_12312338": null,
        "customfield_12311920": null,
        "customfield_12313822": null,
        "customfield_12312335": null,
        "customfield_12313821": null,
        "customfield_12312336": null,
        "customfield_12313820": null,
        "status": {
            "self": "https://issues.apache.org/jira/rest/api/2/status/5",
            "description": "A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.",
            "iconUrl": "https://issues.apache.org/jira/images/icons/statuses/resolved.png",
            "name": "Resolved",
            "id": "5",
            "statusCategory": {
                "self": "https://issues.apache.org/jira/rest/api/2/statuscategory/3",
                "id": 3,
                "key": "done",
                "colorName": "green",
                "name": "Done"
            }
        },
        "components": [
            {
                "self": "https://issues.apache.org/jira/rest/api/2/component/12332552",
                "id": "12332552",
                "name": "JavaScript"
            }
        ],
        "customfield_12312026": null,
        "customfield_12312023": null,
        "customfield_12312024": null,
        "aggregatetimeestimate": 0,
        "customfield_12312022": null,
        "customfield_12310921": null,
        "customfield_12310920": "9223372036854775807",
        "customfield_12312823": null,
        "creator": {
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=paul.e.taylor",
            "name": "paul.e.taylor",
            "key": "paul.e.taylor",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
            },
            "displayName": "Paul Taylor",
            "active": true,
            "timeZone": "America/Los_Angeles"
        },
        "subtasks": [],
        "reporter": {
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=paul.e.taylor",
            "name": "paul.e.taylor",
            "key": "paul.e.taylor",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
            },
            "displayName": "Paul Taylor",
            "active": true,
            "timeZone": "America/Los_Angeles"
        },
        "aggregateprogress": {
            "progress": 6000,
            "total": 6000,
            "percent": 100
        },
        "customfield_12313520": null,
        "customfield_12310250": null,
        "progress": {
            "progress": 6000,
            "total": 6000,
            "percent": 100
        },
        "customfield_12313924": null,
        "votes": {
            "self": "https://issues.apache.org/jira/rest/api/2/issue/ARROW-5537/votes",
            "votes": 0,
            "hasVoted": false
        },
        "worklog": {
            "startAt": 0,
            "maxResults": 20,
            "total": 10,
            "worklogs": [
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13238396/worklog/256492",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "trxcllnt commented on pull request #4502: ARROW-5537: [JS] [WIP] Support delta dictionaries in RecordBatchWriter and DictionaryBuilder\nURL: https://github.com/apache/arrow/pull/4502\n \n \n   Adds support for building and writing delta dictionaries. Moves the `dictionary` Vector pointer to the Data class, similar to https://github.com/apache/arrow/pull/4316.\r\n   \r\n   Forked from  https://github.com/apache/arrow/pull/4476 since this adds support for delta dictionaries to the DictionaryBuilder. Will rebase this PR after that's merged. All the work is in the last commit, here: https://github.com/apache/arrow/commit/b12d842ebe1b341b2b0c67525bcf3f85ea88fecd\r\n   \n \n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2019-06-09T10:54:47.148+0000",
                    "updated": "2019-06-09T10:54:47.148+0000",
                    "started": "2019-06-09T10:54:47.148+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "256492",
                    "issueId": "13238396"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13238396/worklog/264963",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "TheNeuralBit commented on pull request #4502: ARROW-5537: [JS] Support delta dictionaries in RecordBatchWriter and DictionaryBuilder\nURL: https://github.com/apache/arrow/pull/4502#discussion_r296383764\n \n \n\n ##########\n File path: js/test/unit/ipc/writer/stream-writer-tests.ts\n ##########\n @@ -55,6 +64,38 @@ describe('RecordBatchStreamWriter', () => {\n         writer.close();\n         await validate;\n     });\n+\n+    it('should write delta dictionary batches', async () => {\n \n Review comment:\n   It looks like there's no corresponding \"should read delta dictionary batches\" test (unless I'm missing something). Would that be hard to add?\n \n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2019-06-21T20:33:20.260+0000",
                    "updated": "2019-06-21T20:33:20.260+0000",
                    "started": "2019-06-21T20:33:20.259+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "264963",
                    "issueId": "13238396"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13238396/worklog/264964",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "TheNeuralBit commented on pull request #4502: ARROW-5537: [JS] Support delta dictionaries in RecordBatchWriter and DictionaryBuilder\nURL: https://github.com/apache/arrow/pull/4502#discussion_r296383197\n \n \n\n ##########\n File path: js/test/unit/table-tests.ts\n ##########\n @@ -234,7 +234,7 @@ describe(`Table`, () => {\n             expect(f32.name).toBe('f32Renamed');\n             expect(i32.length).toBe(i32s.length);\n             expect(f32.length).toBe(i32s.length); // new length should be the same as the longest sibling\n-            expect(i32.nullable).toBe(false);\n+            expect(i32.nullable).toBe(true);\n \n Review comment:\n   Did all of these have to change because of the change in `_selectFieldArgs`, or is there something else going on here?\n \n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2019-06-21T20:33:21.427+0000",
                    "updated": "2019-06-21T20:33:21.427+0000",
                    "started": "2019-06-21T20:33:21.426+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "264964",
                    "issueId": "13238396"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13238396/worklog/264965",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "TheNeuralBit commented on pull request #4502: ARROW-5537: [JS] Support delta dictionaries in RecordBatchWriter and DictionaryBuilder\nURL: https://github.com/apache/arrow/pull/4502#discussion_r296381791\n \n \n\n ##########\n File path: js/src/util/args.ts\n ##########\n @@ -132,14 +132,14 @@ function _selectFieldArgs<T extends { [key: string]: DataType }>(vals: any[], re\n     while (++idx < len) {\n         val = vals[idx];\n         if (val instanceof Column && (values[++valueIndex] = val)) {\n-            fields[++fieldIndex] = val.field.clone(keys[idx], val.type, val.nullCount > 0);\n+            fields[++fieldIndex] = val.field.clone(keys[idx], val.type, true);\n         } else {\n             ({ [idx]: field = idx } = keys);\n             if (val instanceof DataType && (values[++valueIndex] = val)) {\n-                fields[++fieldIndex] = Field.new(field, val as DataType) as Field<T[keyof T]>;\n+                fields[++fieldIndex] = Field.new(field, val as DataType, true) as Field<T[keyof T]>;\n             } else if (val && val.type && (values[++valueIndex] = val)) {\n                 val instanceof Data && (values[valueIndex] = val = Vector.new(val) as Vector);\n-                fields[++fieldIndex] = Field.new(field, val.type, val.nullCount > 0) as Field<T[keyof T]>;\n+                fields[++fieldIndex] = Field.new(field, val.type, true) as Field<T[keyof T]>;\n \n Review comment:\n   Why are all these checks hard-coded to true now?\n \n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2019-06-21T20:33:21.786+0000",
                    "updated": "2019-06-21T20:33:21.786+0000",
                    "started": "2019-06-21T20:33:21.785+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "264965",
                    "issueId": "13238396"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13238396/worklog/264976",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "trxcllnt commented on pull request #4502: ARROW-5537: [JS] Support delta dictionaries in RecordBatchWriter and DictionaryBuilder\nURL: https://github.com/apache/arrow/pull/4502#discussion_r296390833\n \n \n\n ##########\n File path: js/src/util/args.ts\n ##########\n @@ -132,14 +132,14 @@ function _selectFieldArgs<T extends { [key: string]: DataType }>(vals: any[], re\n     while (++idx < len) {\n         val = vals[idx];\n         if (val instanceof Column && (values[++valueIndex] = val)) {\n-            fields[++fieldIndex] = val.field.clone(keys[idx], val.type, val.nullCount > 0);\n+            fields[++fieldIndex] = val.field.clone(keys[idx], val.type, true);\n         } else {\n             ({ [idx]: field = idx } = keys);\n             if (val instanceof DataType && (values[++valueIndex] = val)) {\n-                fields[++fieldIndex] = Field.new(field, val as DataType) as Field<T[keyof T]>;\n+                fields[++fieldIndex] = Field.new(field, val as DataType, true) as Field<T[keyof T]>;\n             } else if (val && val.type && (values[++valueIndex] = val)) {\n                 val instanceof Data && (values[valueIndex] = val = Vector.new(val) as Vector);\n-                fields[++fieldIndex] = Field.new(field, val.type, val.nullCount > 0) as Field<T[keyof T]>;\n+                fields[++fieldIndex] = Field.new(field, val.type, true) as Field<T[keyof T]>;\n \n Review comment:\n   @TheNeuralBit Ah yes, I forgot I had to change this. It's not for testing, but for streaming. The problem goes like this:\r\n   \r\n   * We start pulling from a source stream and appending values to the builder\r\n   * The builder reaches the high-water-mark, and yields a RecordBatch to the Writer\r\n   * The Writer sees it hasn't written a Schema yet, so it uses the Schema of the first batch\r\n   \r\n   If the first RecordBatch doesn't contain nulls, the Schema Message's Field will have `nullable=false`. If the source later yields a null, changing the Field's `nullable=true` won't be reflected in the stream since the Schema has already been sent. It's hacky, but I changed the default value of `nullable=true` to accommodate this unless explicitly set.\n \n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2019-06-21T20:52:46.004+0000",
                    "updated": "2019-06-21T20:52:46.004+0000",
                    "started": "2019-06-21T20:52:46.002+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "264976",
                    "issueId": "13238396"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13238396/worklog/264979",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "trxcllnt commented on pull request #4502: ARROW-5537: [JS] Support delta dictionaries in RecordBatchWriter and DictionaryBuilder\nURL: https://github.com/apache/arrow/pull/4502#discussion_r296391856\n \n \n\n ##########\n File path: js/test/unit/ipc/writer/stream-writer-tests.ts\n ##########\n @@ -55,6 +64,38 @@ describe('RecordBatchStreamWriter', () => {\n         writer.close();\n         await validate;\n     });\n+\n+    it('should write delta dictionary batches', async () => {\n \n Review comment:\n   That case should be covered a few lines below here, on this line:\r\n   https://github.com/apache/arrow/blob/6a70a25bdfc22958f2dced8623cad594d41dc059/js/test/unit/ipc/writer/stream-writer-tests.ts#L91\n \n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2019-06-21T20:56:26.271+0000",
                    "updated": "2019-06-21T20:56:26.271+0000",
                    "started": "2019-06-21T20:56:26.270+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "264979",
                    "issueId": "13238396"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13238396/worklog/264981",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "trxcllnt commented on pull request #4502: ARROW-5537: [JS] Support delta dictionaries in RecordBatchWriter and DictionaryBuilder\nURL: https://github.com/apache/arrow/pull/4502#discussion_r296392585\n \n \n\n ##########\n File path: js/src/util/args.ts\n ##########\n @@ -132,14 +132,14 @@ function _selectFieldArgs<T extends { [key: string]: DataType }>(vals: any[], re\n     while (++idx < len) {\n         val = vals[idx];\n         if (val instanceof Column && (values[++valueIndex] = val)) {\n-            fields[++fieldIndex] = val.field.clone(keys[idx], val.type, val.nullCount > 0);\n+            fields[++fieldIndex] = val.field.clone(keys[idx], val.type, true);\n         } else {\n             ({ [idx]: field = idx } = keys);\n             if (val instanceof DataType && (values[++valueIndex] = val)) {\n-                fields[++fieldIndex] = Field.new(field, val as DataType) as Field<T[keyof T]>;\n+                fields[++fieldIndex] = Field.new(field, val as DataType, true) as Field<T[keyof T]>;\n             } else if (val && val.type && (values[++valueIndex] = val)) {\n                 val instanceof Data && (values[valueIndex] = val = Vector.new(val) as Vector);\n-                fields[++fieldIndex] = Field.new(field, val.type, val.nullCount > 0) as Field<T[keyof T]>;\n+                fields[++fieldIndex] = Field.new(field, val.type, true) as Field<T[keyof T]>;\n \n Review comment:\n   Technically `nullable` doesn't indicate the existence of nulls, just that it's possible there will be nulls. I'm not sure if other implementations infer `nullable=true` to also mean there's a non-zero-length null bitmap buffer. If so, we can update the writer to synthesize one for compatibility.\n \n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2019-06-21T20:59:08.722+0000",
                    "updated": "2019-06-21T20:59:08.722+0000",
                    "started": "2019-06-21T20:59:08.722+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "264981",
                    "issueId": "13238396"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13238396/worklog/264996",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "TheNeuralBit commented on pull request #4502: ARROW-5537: [JS] Support delta dictionaries in RecordBatchWriter and DictionaryBuilder\nURL: https://github.com/apache/arrow/pull/4502#discussion_r296399040\n \n \n\n ##########\n File path: js/src/util/args.ts\n ##########\n @@ -132,14 +132,14 @@ function _selectFieldArgs<T extends { [key: string]: DataType }>(vals: any[], re\n     while (++idx < len) {\n         val = vals[idx];\n         if (val instanceof Column && (values[++valueIndex] = val)) {\n-            fields[++fieldIndex] = val.field.clone(keys[idx], val.type, val.nullCount > 0);\n+            fields[++fieldIndex] = val.field.clone(keys[idx], val.type, true);\n         } else {\n             ({ [idx]: field = idx } = keys);\n             if (val instanceof DataType && (values[++valueIndex] = val)) {\n-                fields[++fieldIndex] = Field.new(field, val as DataType) as Field<T[keyof T]>;\n+                fields[++fieldIndex] = Field.new(field, val as DataType, true) as Field<T[keyof T]>;\n             } else if (val && val.type && (values[++valueIndex] = val)) {\n                 val instanceof Data && (values[valueIndex] = val = Vector.new(val) as Vector);\n-                fields[++fieldIndex] = Field.new(field, val.type, val.nullCount > 0) as Field<T[keyof T]>;\n+                fields[++fieldIndex] = Field.new(field, val.type, true) as Field<T[keyof T]>;\n \n Review comment:\n   Ah I see. The spec says you're allowed to elide validity bitmaps when the null count is 0, so I think we're ok there:\r\n   \r\n   > Arrays having a 0 null count may choose to not allocate the null bitmap. Implementations may choose to always allocate one anyway as a matter of convenience, but this should be noted when memory is being shared.\r\n   \r\n   (from http://arrow.apache.org/docs/format/Layout.html#null-bitmaps)\r\n   \r\n   Doesn't need to happen here, but could we set nullable based on the builder options? e.g. it there are no `null_values`. I guess we would probably need another builder option (like `nullable = false`) to do that right, since you could still append `null` or `undefined` even without `null_values`.\n \n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2019-06-21T21:24:53.851+0000",
                    "updated": "2019-06-21T21:24:53.851+0000",
                    "started": "2019-06-21T21:24:53.850+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "264996",
                    "issueId": "13238396"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13238396/worklog/265001",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "TheNeuralBit commented on pull request #4502: ARROW-5537: [JS] Support delta dictionaries in RecordBatchWriter and DictionaryBuilder\nURL: https://github.com/apache/arrow/pull/4502#discussion_r296400265\n \n \n\n ##########\n File path: js/test/unit/ipc/writer/stream-writer-tests.ts\n ##########\n @@ -55,6 +64,38 @@ describe('RecordBatchStreamWriter', () => {\n         writer.close();\n         await validate;\n     });\n+\n+    it('should write delta dictionary batches', async () => {\n \n Review comment:\n   Ahh yeah, my bad.\n \n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2019-06-21T21:29:54.269+0000",
                    "updated": "2019-06-21T21:29:54.269+0000",
                    "started": "2019-06-21T21:29:54.268+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "265001",
                    "issueId": "13238396"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13238396/worklog/265137",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "TheNeuralBit commented on pull request #4502: ARROW-5537: [JS] Support delta dictionaries in RecordBatchWriter and DictionaryBuilder\nURL: https://github.com/apache/arrow/pull/4502\n \n \n   \n \n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2019-06-22T00:27:08.332+0000",
                    "updated": "2019-06-22T00:27:08.332+0000",
                    "started": "2019-06-22T00:27:08.331+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "265137",
                    "issueId": "13238396"
                }
            ]
        },
        "customfield_12313920": null,
        "issuetype": {
            "self": "https://issues.apache.org/jira/rest/api/2/issuetype/2",
            "id": "2",
            "description": "A new feature of the product, which has yet to be developed.",
            "iconUrl": "https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21141&avatarType=issuetype",
            "name": "New Feature",
            "subtask": false,
            "avatarId": 21141
        },
        "timespent": 6000,
        "customfield_12314020": "{summaryBean=com.atlassian.jira.plugin.devstatus.rest.SummaryBean@7268c1fe[summary={pullrequest=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@2276e763[overall=PullRequestOverallBean{stateCount=0, state='OPEN', details=PullRequestOverallDetails{openCount=0, mergedCount=0, declinedCount=0}},byInstanceType={}], build=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@12ef44a4[overall=com.atlassian.jira.plugin.devstatus.summary.beans.BuildOverallBean@7b7f465[failedBuildCount=0,successfulBuildCount=0,unknownBuildCount=0,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], review=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@53f07bdc[overall=com.atlassian.jira.plugin.devstatus.summary.beans.ReviewsOverallBean@15bf1e68[stateCount=0,state=<null>,dueDate=<null>,overDue=false,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], deployment-environment=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@7d1db21f[overall=com.atlassian.jira.plugin.devstatus.summary.beans.DeploymentOverallBean@45b17505[topEnvironments=[],showProjects=false,successfulCount=0,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], repository=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@154fd8f4[overall=com.atlassian.jira.plugin.devstatus.summary.beans.CommitOverallBean@78eec86b[count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], branch=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@68f31023[overall=com.atlassian.jira.plugin.devstatus.summary.beans.BranchOverallBean@26a45965[count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}]},errors=[],configErrors=[]], devSummaryJson={\"cachedValue\":{\"errors\":[],\"configErrors\":[],\"summary\":{\"pullrequest\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"stateCount\":0,\"state\":\"OPEN\",\"details\":{\"openCount\":0,\"mergedCount\":0,\"declinedCount\":0,\"total\":0},\"open\":true},\"byInstanceType\":{}},\"build\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"failedBuildCount\":0,\"successfulBuildCount\":0,\"unknownBuildCount\":0},\"byInstanceType\":{}},\"review\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"stateCount\":0,\"state\":null,\"dueDate\":null,\"overDue\":false,\"completed\":false},\"byInstanceType\":{}},\"deployment-environment\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"topEnvironments\":[],\"showProjects\":false,\"successfulCount\":0},\"byInstanceType\":{}},\"repository\":{\"overall\":{\"count\":0,\"lastUpdated\":null},\"byInstanceType\":{}},\"branch\":{\"overall\":{\"count\":0,\"lastUpdated\":null},\"byInstanceType\":{}}}},\"isStale\":false}}",
        "customfield_12314141": null,
        "customfield_12314140": null,
        "project": {
            "self": "https://issues.apache.org/jira/rest/api/2/project/12319525",
            "id": "12319525",
            "key": "ARROW",
            "name": "Apache Arrow",
            "projectTypeKey": "software",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/projectavatar?pid=12319525&avatarId=10011",
                "24x24": "https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12319525&avatarId=10011",
                "16x16": "https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12319525&avatarId=10011",
                "32x32": "https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12319525&avatarId=10011"
            },
            "projectCategory": {
                "self": "https://issues.apache.org/jira/rest/api/2/projectCategory/13960",
                "id": "13960",
                "description": "Apache Arrow",
                "name": "Arrow"
            }
        },
        "aggregatetimespent": 6000,
        "customfield_12312520": null,
        "customfield_12312521": "Sat Jun 22 00:26:57 UTC 2019",
        "customfield_12314422": null,
        "customfield_12314421": null,
        "customfield_12314146": null,
        "customfield_12314420": null,
        "customfield_12314145": null,
        "customfield_12314144": null,
        "customfield_12314143": null,
        "resolutiondate": "2019-06-22T00:26:57.000+0000",
        "workratio": -1,
        "customfield_12312923": null,
        "customfield_12312920": null,
        "customfield_12312921": null,
        "watches": {
            "self": "https://issues.apache.org/jira/rest/api/2/issue/ARROW-5537/watchers",
            "watchCount": 1,
            "isWatching": false
        },
        "created": "2019-06-09T10:47:31.000+0000",
        "updated": "2019-06-22T00:27:19.000+0000",
        "timeoriginalestimate": null,
        "description": "The new JS DictionaryBuilder and RecordBatchWriter and should support building and writing delta dictionary batches to enable creating DictionaryVectors while streaming.",
        "customfield_10010": null,
        "timetracking": {
            "remainingEstimate": "0h",
            "timeSpent": "1h 40m",
            "remainingEstimateSeconds": 0,
            "timeSpentSeconds": 6000
        },
        "customfield_12314523": null,
        "customfield_12314127": null,
        "customfield_12314522": null,
        "customfield_12314126": null,
        "customfield_12314521": null,
        "customfield_12314125": null,
        "customfield_12314520": null,
        "customfield_12314124": null,
        "attachment": [],
        "customfield_12312340": null,
        "customfield_12314123": null,
        "customfield_12312341": null,
        "customfield_12312220": null,
        "customfield_12314122": null,
        "customfield_12314121": null,
        "customfield_12314120": null,
        "customfield_12314129": null,
        "customfield_12314524": null,
        "customfield_12314128": null,
        "summary": "[JS] Support delta dictionaries in RecordBatchWriter and DictionaryBuilder",
        "customfield_12314130": null,
        "customfield_12310291": null,
        "customfield_12310290": null,
        "customfield_12314138": null,
        "customfield_12314137": null,
        "environment": null,
        "customfield_12314136": null,
        "customfield_12314135": null,
        "customfield_12311020": null,
        "customfield_12314134": null,
        "duedate": null,
        "customfield_12314132": null,
        "customfield_12314131": null,
        "comment": {
            "comments": [
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13238396/comment/16869975",
                    "id": "16869975",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=bhulette",
                        "name": "bhulette",
                        "key": "bhulette",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "Brian Hulette",
                        "active": true,
                        "timeZone": "America/Vancouver"
                    },
                    "body": "Issue resolved by pull request 4502\n[https://github.com/apache/arrow/pull/4502]",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=bhulette",
                        "name": "bhulette",
                        "key": "bhulette",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "Brian Hulette",
                        "active": true,
                        "timeZone": "America/Vancouver"
                    },
                    "created": "2019-06-22T00:26:57.672+0000",
                    "updated": "2019-06-22T00:26:57.672+0000"
                }
            ],
            "maxResults": 1,
            "total": 1,
            "startAt": 0
        },
        "customfield_12311820": "0|z03k0o:",
        "customfield_12314139": null
    }
}