{
    "expand": "operations,versionedRepresentations,editmeta,changelog,renderedFields",
    "id": "13357325",
    "self": "https://issues.apache.org/jira/rest/api/2/issue/13357325",
    "key": "ARROW-11541",
    "fields": {
        "fixVersions": [
            {
                "self": "https://issues.apache.org/jira/rest/api/2/version/12349493",
                "id": "12349493",
                "description": "",
                "name": "4.0.0",
                "archived": false,
                "released": true,
                "releaseDate": "2021-04-26"
            }
        ],
        "resolution": {
            "self": "https://issues.apache.org/jira/rest/api/2/resolution/1",
            "id": "1",
            "description": "A fix for this issue is checked into the tree and tested.",
            "name": "Fixed"
        },
        "customfield_12312322": null,
        "customfield_12312323": null,
        "customfield_12312320": null,
        "customfield_12310420": "9223372036854775807",
        "customfield_12312321": null,
        "customfield_12312328": null,
        "customfield_12312329": null,
        "customfield_12312326": null,
        "customfield_12310300": null,
        "customfield_12312327": null,
        "customfield_12312324": null,
        "customfield_12312720": null,
        "customfield_12312325": null,
        "lastViewed": null,
        "priority": {
            "self": "https://issues.apache.org/jira/rest/api/2/priority/3",
            "iconUrl": "https://issues.apache.org/jira/images/icons/priorities/major.svg",
            "name": "Major",
            "id": "3"
        },
        "labels": [
            "pull-request-available"
        ],
        "customfield_12312333": null,
        "customfield_12312334": null,
        "customfield_12313422": "false",
        "customfield_12310310": "0.0",
        "customfield_12312331": null,
        "customfield_12312332": null,
        "aggregatetimeoriginalestimate": null,
        "timeestimate": 0,
        "customfield_12312330": null,
        "versions": [],
        "customfield_12311120": null,
        "customfield_12313826": null,
        "customfield_12312339": null,
        "issuelinks": [
            {
                "id": "12620318",
                "self": "https://issues.apache.org/jira/rest/api/2/issueLink/12620318",
                "type": {
                    "id": "10030",
                    "name": "Reference",
                    "inward": "is related to",
                    "outward": "relates to",
                    "self": "https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"
                },
                "inwardIssue": {
                    "id": "13392955",
                    "key": "ARROW-13520",
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13392955",
                    "fields": {
                        "summary": "[C++] Implement hash_aggregate approximate quantile kernel",
                        "status": {
                            "self": "https://issues.apache.org/jira/rest/api/2/status/5",
                            "description": "A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.",
                            "iconUrl": "https://issues.apache.org/jira/images/icons/statuses/resolved.png",
                            "name": "Resolved",
                            "id": "5",
                            "statusCategory": {
                                "self": "https://issues.apache.org/jira/rest/api/2/statuscategory/3",
                                "id": 3,
                                "key": "done",
                                "colorName": "green",
                                "name": "Done"
                            }
                        },
                        "priority": {
                            "self": "https://issues.apache.org/jira/rest/api/2/priority/3",
                            "iconUrl": "https://issues.apache.org/jira/images/icons/priorities/major.svg",
                            "name": "Major",
                            "id": "3"
                        },
                        "issuetype": {
                            "self": "https://issues.apache.org/jira/rest/api/2/issuetype/4",
                            "id": "4",
                            "description": "An improvement or enhancement to an existing feature or task.",
                            "iconUrl": "https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21140&avatarType=issuetype",
                            "name": "Improvement",
                            "subtask": false,
                            "avatarId": 21140
                        }
                    }
                }
            }
        ],
        "customfield_12313825": null,
        "assignee": {
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=yibocai",
            "name": "yibocai",
            "key": "yibo",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=yibo&avatarId=47542",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=yibo&avatarId=47542",
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=yibo&avatarId=47542",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=yibo&avatarId=47542"
            },
            "displayName": "Yibo Cai",
            "active": true,
            "timeZone": "Etc/UTC"
        },
        "customfield_12312337": null,
        "customfield_12313823": null,
        "customfield_12312338": null,
        "customfield_12311920": null,
        "customfield_12313822": null,
        "customfield_12312335": null,
        "customfield_12313821": null,
        "customfield_12312336": null,
        "customfield_12313820": null,
        "status": {
            "self": "https://issues.apache.org/jira/rest/api/2/status/5",
            "description": "A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.",
            "iconUrl": "https://issues.apache.org/jira/images/icons/statuses/resolved.png",
            "name": "Resolved",
            "id": "5",
            "statusCategory": {
                "self": "https://issues.apache.org/jira/rest/api/2/statuscategory/3",
                "id": 3,
                "key": "done",
                "colorName": "green",
                "name": "Done"
            }
        },
        "components": [
            {
                "self": "https://issues.apache.org/jira/rest/api/2/component/12328935",
                "id": "12328935",
                "name": "C++"
            }
        ],
        "customfield_12312026": null,
        "customfield_12312023": null,
        "customfield_12312024": null,
        "aggregatetimeestimate": 0,
        "customfield_12312022": null,
        "customfield_12310921": null,
        "customfield_12310920": "9223372036854775807",
        "customfield_12312823": null,
        "creator": {
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=yibocai",
            "name": "yibocai",
            "key": "yibo",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=yibo&avatarId=47542",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=yibo&avatarId=47542",
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=yibo&avatarId=47542",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=yibo&avatarId=47542"
            },
            "displayName": "Yibo Cai",
            "active": true,
            "timeZone": "Etc/UTC"
        },
        "subtasks": [],
        "reporter": {
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=yibocai",
            "name": "yibocai",
            "key": "yibo",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=yibo&avatarId=47542",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=yibo&avatarId=47542",
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=yibo&avatarId=47542",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=yibo&avatarId=47542"
            },
            "displayName": "Yibo Cai",
            "active": true,
            "timeZone": "Etc/UTC"
        },
        "aggregateprogress": {
            "progress": 21600,
            "total": 21600,
            "percent": 100
        },
        "customfield_12313520": null,
        "customfield_12310250": null,
        "progress": {
            "progress": 21600,
            "total": 21600,
            "percent": 100
        },
        "customfield_12313924": null,
        "votes": {
            "self": "https://issues.apache.org/jira/rest/api/2/issue/ARROW-11541/votes",
            "votes": 0,
            "hasVoted": false
        },
        "worklog": {
            "startAt": 0,
            "maxResults": 20,
            "total": 36,
            "worklogs": [
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13357325/worklog/549203",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "cyb70289 opened a new pull request #9435:\nURL: https://github.com/apache/arrow/pull/9435\n\n\n   Implement approximate quantile kernel using t-digest util.\r\n   This patch also refines t-digest quantile calculation code.\n\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2021-02-07T05:27:02.996+0000",
                    "updated": "2021-02-07T05:27:02.996+0000",
                    "started": "2021-02-07T05:27:02.995+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "549203",
                    "issueId": "13357325"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13357325/worklog/549204",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "github-actions[bot] commented on pull request #9435:\nURL: https://github.com/apache/arrow/pull/9435#issuecomment-774603160\n\n\n   https://issues.apache.org/jira/browse/ARROW-11541\n\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2021-02-07T05:27:26.715+0000",
                    "updated": "2021-02-07T05:27:26.715+0000",
                    "started": "2021-02-07T05:27:26.715+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "549204",
                    "issueId": "13357325"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13357325/worklog/549578",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "pitrou commented on a change in pull request #9435:\nURL: https://github.com/apache/arrow/pull/9435#discussion_r572042030\n\n\n\n##########\nFile path: cpp/src/arrow/compute/api_aggregate.h\n##########\n@@ -105,12 +105,15 @@ struct ARROW_EXPORT VarianceOptions : public FunctionOptions {\n /// By default, returns the median value.\n struct ARROW_EXPORT QuantileOptions : public FunctionOptions {\n   /// Interpolation method to use when quantile lies between two data points\n+  /// TDIGEST is useful to approximate quantiles from large volume inputs.\n+  /// It has constant memory footprint, but lower accuracy.\n   enum Interpolation {\n     LINEAR = 0,\n     LOWER,\n     HIGHER,\n     NEAREST,\n     MIDPOINT,\n+    TDIGEST,\n\nReview comment:\n       I'm curious whether this is best exposed as an interpolation kind for the \"quantile\" function, or a separate function altogether. Are there precedents in other libraries or database engines?\r\n   \r\n   It seems R uses a separate function:\r\n   https://www.rdocumentation.org/packages/tdigest/versions/0.3.0/topics/tdigest\r\n   \r\n   cc @nealrichardson @michalursa  for opinion.\n\n\n\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2021-02-08T13:23:54.516+0000",
                    "updated": "2021-02-08T13:23:54.516+0000",
                    "started": "2021-02-08T13:23:54.516+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "549578",
                    "issueId": "13357325"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13357325/worklog/549611",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "cyb70289 commented on a change in pull request #9435:\nURL: https://github.com/apache/arrow/pull/9435#discussion_r572065888\n\n\n\n##########\nFile path: cpp/src/arrow/compute/api_aggregate.h\n##########\n@@ -105,12 +105,15 @@ struct ARROW_EXPORT VarianceOptions : public FunctionOptions {\n /// By default, returns the median value.\n struct ARROW_EXPORT QuantileOptions : public FunctionOptions {\n   /// Interpolation method to use when quantile lies between two data points\n+  /// TDIGEST is useful to approximate quantiles from large volume inputs.\n+  /// It has constant memory footprint, but lower accuracy.\n   enum Interpolation {\n     LINEAR = 0,\n     LOWER,\n     HIGHER,\n     NEAREST,\n     MIDPOINT,\n+    TDIGEST,\n\nReview comment:\n       Matlab quantile has a `method` parameter, which can be `exact` (linear interpolation) or `approximate` (t-digest).\r\n   https://www.mathworks.com/help/stats/quantile.html#mw_06fb6551-ec1a-48f6-a690-f790dfaa9849\n\n\n\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2021-02-08T13:57:42.594+0000",
                    "updated": "2021-02-08T13:57:42.594+0000",
                    "started": "2021-02-08T13:57:42.594+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "549611",
                    "issueId": "13357325"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13357325/worklog/549833",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "nealrichardson commented on a change in pull request #9435:\nURL: https://github.com/apache/arrow/pull/9435#discussion_r572322195\n\n\n\n##########\nFile path: cpp/src/arrow/compute/api_aggregate.h\n##########\n@@ -105,12 +105,15 @@ struct ARROW_EXPORT VarianceOptions : public FunctionOptions {\n /// By default, returns the median value.\n struct ARROW_EXPORT QuantileOptions : public FunctionOptions {\n   /// Interpolation method to use when quantile lies between two data points\n+  /// TDIGEST is useful to approximate quantiles from large volume inputs.\n+  /// It has constant memory footprint, but lower accuracy.\n   enum Interpolation {\n     LINEAR = 0,\n     LOWER,\n     HIGHER,\n     NEAREST,\n     MIDPOINT,\n+    TDIGEST,\n\nReview comment:\n       FWIW that tdigest R function is not part of base R, it is a contributed package.\r\n   \r\n   R's quantile function also supports multiple methods, 9 in fact, via the `type` parameter: https://stat.ethz.ch/R-manual/R-devel/library/stats/html/quantile.html\r\n   \r\n   None of these are approximate in the same way as this, but it's a further argument that it could be a function parameter rather than a separate function. TBH I don't know how much it matters, as a compute API consumer I can make either work. It's marginally easier if they're separate functions rather than having to mess with `FunctionOptions` to select them--are maybe there are downsides to that way?\n\n\n\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2021-02-08T19:45:49.273+0000",
                    "updated": "2021-02-08T19:45:49.273+0000",
                    "started": "2021-02-08T19:45:49.273+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "549833",
                    "issueId": "13357325"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13357325/worklog/549835",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "pitrou commented on a change in pull request #9435:\nURL: https://github.com/apache/arrow/pull/9435#discussion_r572323051\n\n\n\n##########\nFile path: cpp/src/arrow/compute/api_aggregate.h\n##########\n@@ -105,12 +105,15 @@ struct ARROW_EXPORT VarianceOptions : public FunctionOptions {\n /// By default, returns the median value.\n struct ARROW_EXPORT QuantileOptions : public FunctionOptions {\n   /// Interpolation method to use when quantile lies between two data points\n+  /// TDIGEST is useful to approximate quantiles from large volume inputs.\n+  /// It has constant memory footprint, but lower accuracy.\n   enum Interpolation {\n     LINEAR = 0,\n     LOWER,\n     HIGHER,\n     NEAREST,\n     MIDPOINT,\n+    TDIGEST,\n\nReview comment:\n       Note that the t-digest method also has its own parameters (compression and delta). If we ever want to expose them, it would probably be less confusing as a separate function.\n\n\n\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2021-02-08T19:46:54.740+0000",
                    "updated": "2021-02-08T19:46:54.740+0000",
                    "started": "2021-02-08T19:46:54.739+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "549835",
                    "issueId": "13357325"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13357325/worklog/549838",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "nealrichardson commented on a change in pull request #9435:\nURL: https://github.com/apache/arrow/pull/9435#discussion_r572323928\n\n\n\n##########\nFile path: cpp/src/arrow/compute/api_aggregate.h\n##########\n@@ -105,12 +105,15 @@ struct ARROW_EXPORT VarianceOptions : public FunctionOptions {\n /// By default, returns the median value.\n struct ARROW_EXPORT QuantileOptions : public FunctionOptions {\n   /// Interpolation method to use when quantile lies between two data points\n+  /// TDIGEST is useful to approximate quantiles from large volume inputs.\n+  /// It has constant memory footprint, but lower accuracy.\n   enum Interpolation {\n     LINEAR = 0,\n     LOWER,\n     HIGHER,\n     NEAREST,\n     MIDPOINT,\n+    TDIGEST,\n\nReview comment:\n       Sounds like separate function makes the most sense unless there's a cost to having an additional function.\n\n\n\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2021-02-08T19:48:20.478+0000",
                    "updated": "2021-02-08T19:48:20.478+0000",
                    "started": "2021-02-08T19:48:20.477+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "549838",
                    "issueId": "13357325"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13357325/worklog/549997",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "cyb70289 commented on a change in pull request #9435:\nURL: https://github.com/apache/arrow/pull/9435#discussion_r572504356\n\n\n\n##########\nFile path: cpp/src/arrow/compute/api_aggregate.h\n##########\n@@ -105,12 +105,15 @@ struct ARROW_EXPORT VarianceOptions : public FunctionOptions {\n /// By default, returns the median value.\n struct ARROW_EXPORT QuantileOptions : public FunctionOptions {\n   /// Interpolation method to use when quantile lies between two data points\n+  /// TDIGEST is useful to approximate quantiles from large volume inputs.\n+  /// It has constant memory footprint, but lower accuracy.\n   enum Interpolation {\n     LINEAR = 0,\n     LOWER,\n     HIGHER,\n     NEAREST,\n     MIDPOINT,\n+    TDIGEST,\n\nReview comment:\n       > Note that the t-digest method also has its own parameters (compression and delta). If we ever want to expose them, it would probably be less confusing as a separate function.\r\n   \r\n   Good point. I will separate it into another function.\n\n\n\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2021-02-09T01:37:29.618+0000",
                    "updated": "2021-02-09T01:37:29.618+0000",
                    "started": "2021-02-09T01:37:29.617+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "549997",
                    "issueId": "13357325"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13357325/worklog/555151",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "cyb70289 commented on pull request #9435:\nURL: https://github.com/apache/arrow/pull/9435#issuecomment-782614918\n\n\n   CI error is not related.\n\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2021-02-20T12:01:52.126+0000",
                    "updated": "2021-02-20T12:01:52.126+0000",
                    "started": "2021-02-20T12:01:52.125+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "555151",
                    "issueId": "13357325"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13357325/worklog/555152",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "cyb70289 commented on a change in pull request #9435:\nURL: https://github.com/apache/arrow/pull/9435#discussion_r579647773\n\n\n\n##########\nFile path: cpp/src/arrow/compute/api_aggregate.h\n##########\n@@ -105,12 +105,15 @@ struct ARROW_EXPORT VarianceOptions : public FunctionOptions {\n /// By default, returns the median value.\n struct ARROW_EXPORT QuantileOptions : public FunctionOptions {\n   /// Interpolation method to use when quantile lies between two data points\n+  /// TDIGEST is useful to approximate quantiles from large volume inputs.\n+  /// It has constant memory footprint, but lower accuracy.\n   enum Interpolation {\n     LINEAR = 0,\n     LOWER,\n     HIGHER,\n     NEAREST,\n     MIDPOINT,\n+    TDIGEST,\n\nReview comment:\n       Add separated `TDigest` kernel.\n\n\n\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2021-02-20T12:02:57.544+0000",
                    "updated": "2021-02-20T12:02:57.544+0000",
                    "started": "2021-02-20T12:02:57.543+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "555152",
                    "issueId": "13357325"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13357325/worklog/555153",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "cyb70289 commented on a change in pull request #9435:\nURL: https://github.com/apache/arrow/pull/9435#discussion_r579647773\n\n\n\n##########\nFile path: cpp/src/arrow/compute/api_aggregate.h\n##########\n@@ -105,12 +105,15 @@ struct ARROW_EXPORT VarianceOptions : public FunctionOptions {\n /// By default, returns the median value.\n struct ARROW_EXPORT QuantileOptions : public FunctionOptions {\n   /// Interpolation method to use when quantile lies between two data points\n+  /// TDIGEST is useful to approximate quantiles from large volume inputs.\n+  /// It has constant memory footprint, but lower accuracy.\n   enum Interpolation {\n     LINEAR = 0,\n     LOWER,\n     HIGHER,\n     NEAREST,\n     MIDPOINT,\n+    TDIGEST,\n\nReview comment:\n       Added separated `TDigest` kernel.\n\n\n\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2021-02-20T12:03:10.582+0000",
                    "updated": "2021-02-20T12:03:10.582+0000",
                    "started": "2021-02-20T12:03:10.582+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "555153",
                    "issueId": "13357325"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13357325/worklog/555568",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "cyb70289 commented on a change in pull request #9435:\nURL: https://github.com/apache/arrow/pull/9435#discussion_r579927161\n\n\n\n##########\nFile path: cpp/src/arrow/compute/api_aggregate.h\n##########\n@@ -105,12 +105,15 @@ struct ARROW_EXPORT VarianceOptions : public FunctionOptions {\n /// By default, returns the median value.\n struct ARROW_EXPORT QuantileOptions : public FunctionOptions {\n   /// Interpolation method to use when quantile lies between two data points\n+  /// TDIGEST is useful to approximate quantiles from large volume inputs.\n+  /// It has constant memory footprint, but lower accuracy.\n   enum Interpolation {\n     LINEAR = 0,\n     LOWER,\n     HIGHER,\n     NEAREST,\n     MIDPOINT,\n+    TDIGEST,\n\nReview comment:\n       @pitrou I've separated TDigest kernel, please review, thanks.\n\n\n\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2021-02-22T02:34:44.993+0000",
                    "updated": "2021-02-22T02:34:44.993+0000",
                    "started": "2021-02-22T02:34:44.993+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "555568",
                    "issueId": "13357325"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13357325/worklog/555695",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "cyb70289 removed a comment on pull request #9435:\nURL: https://github.com/apache/arrow/pull/9435#issuecomment-782614918\n\n\n   CI error is not related.\n\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2021-02-22T08:56:50.694+0000",
                    "updated": "2021-02-22T08:56:50.694+0000",
                    "started": "2021-02-22T08:56:50.694+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "555695",
                    "issueId": "13357325"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13357325/worklog/555696",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "cyb70289 commented on pull request #9435:\nURL: https://github.com/apache/arrow/pull/9435#issuecomment-783210395\n\n\n   appveyor complains protobuf namespace collision, should be fixed by pr https://github.com/apache/arrow/pull/9542\r\n   mingw32 arrow-python-test timeout, still checking if related to this patch\n\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2021-02-22T08:57:13.819+0000",
                    "updated": "2021-02-22T08:57:13.819+0000",
                    "started": "2021-02-22T08:57:13.818+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "555696",
                    "issueId": "13357325"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13357325/worklog/555856",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "pitrou commented on a change in pull request #9435:\nURL: https://github.com/apache/arrow/pull/9435#discussion_r580320934\n\n\n\n##########\nFile path: cpp/src/arrow/compute/kernels/aggregate_test.cc\n##########\n@@ -1533,23 +1533,67 @@ TEST_F(TestInt64QuantileKernel, Int64) {\n class TestRandomQuantileKernel : public TestPrimitiveQuantileKernel<Int32Type> {\n  public:\n   void CheckQuantiles(int64_t array_size, int64_t num_quantiles) {\n-    auto rand = random::RandomArrayGenerator(0x5487658);\n+    std::shared_ptr<Array> array;\n+    std::vector<double> quantiles;\n     // small value range to exercise input array with equal values and histogram approach\n-    const auto array = rand.Numeric<Int32Type>(array_size, -100, 200, 0.1);\n+    GenerateTestData(array_size, num_quantiles, -100, 200, &array, &quantiles);\n+\n+    this->AssertQuantilesAre(array, QuantileOptions{quantiles},\n+                             NaiveQuantile(*array, quantiles, interpolations_));\n+  }\n \n+  void CheckTDigests(std::vector<int> chunk_sizes, int64_t num_quantiles) {\n+    int total_size = 0;\n+    for (int size : chunk_sizes) {\n+      total_size += size;\n+    }\n+    std::shared_ptr<Array> array;\n     std::vector<double> quantiles;\n-    random_real(num_quantiles, 0x5487658, 0.0, 1.0, &quantiles);\n-    // make sure to exercise 0 and 1 quantiles\n-    *std::min_element(quantiles.begin(), quantiles.end()) = 0;\n-    *std::max_element(quantiles.begin(), quantiles.end()) = 1;\n+    GenerateTestData(total_size, num_quantiles, 100, 123456789, &array, &quantiles);\n \n-    this->AssertQuantilesAre(array, QuantileOptions{quantiles},\n-                             NaiveQuantile(*array, quantiles));\n+    total_size = 0;\n+    ArrayVector array_vector;\n+    for (int size : chunk_sizes) {\n+      array_vector.emplace_back(array->Slice(total_size, size));\n+      total_size += size;\n+    }\n+    auto chunked = *ChunkedArray::Make(array_vector);\n+\n+    TDigestOptions options(quantiles);\n+    ASSERT_OK_AND_ASSIGN(Datum out, TDigest(chunked, options));\n+    const auto& out_array = out.make_array();\n+    ASSERT_OK(out_array->ValidateFull());\n+    ASSERT_EQ(out_array->length(), quantiles.size());\n+    ASSERT_EQ(out_array->null_count(), 0);\n+    ASSERT_EQ(out_array->type(), float64());\n\nReview comment:\n       Use `AssertTypeEquals`. The type is not guaranteed to be equal by-pointer.\n\n##########\nFile path: cpp/src/arrow/compute/kernels/aggregate_tdigest.cc\n##########\n@@ -0,0 +1,154 @@\n+// Licensed to the Apache Software Foundation (ASF) under one\n+// or more contributor license agreements.  See the NOTICE file\n+// distributed with this work for additional information\n+// regarding copyright ownership.  The ASF licenses this file\n+// to you under the Apache License, Version 2.0 (the\n+// \"License\"); you may not use this file except in compliance\n+// with the License.  You may obtain a copy of the License at\n+//\n+//   http://www.apache.org/licenses/LICENSE-2.0\n+//\n+// Unless required by applicable law or agreed to in writing,\n+// software distributed under the License is distributed on an\n+// \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+// KIND, either express or implied.  See the License for the\n+// specific language governing permissions and limitations\n+// under the License.\n+\n+#include \"arrow/compute/api_aggregate.h\"\n+#include \"arrow/compute/kernels/aggregate_internal.h\"\n+#include \"arrow/compute/kernels/common.h\"\n+#include \"arrow/util/bit_run_reader.h\"\n+#include \"arrow/util/tdigest.h\"\n+\n+namespace arrow {\n+namespace compute {\n+namespace internal {\n+\n+namespace {\n+\n+using arrow::internal::TDigest;\n+using arrow::internal::VisitSetBitRunsVoid;\n+\n+template <typename ArrowType>\n+struct TDigestImpl : public ScalarAggregator {\n+  using ThisType = TDigestImpl<ArrowType>;\n+  using ArrayType = typename TypeTraits<ArrowType>::ArrayType;\n+  using CType = typename ArrowType::c_type;\n+\n+  explicit TDigestImpl(const TDigestOptions& options)\n+      : q{options.q}, tdigest{new TDigest(options.delta, options.buffer_size)} {}\n+\n+  void Consume(KernelContext*, const ExecBatch& batch) override {\n+    ArrayType array{batch[0].array()};\n+    const ArrayData& data = *array.data();\n+    const CType* values = data.GetValues<CType>(1);\n+\n+    if (array.length() > array.null_count()) {\n\nReview comment:\n       You could write `if (data.length > data.GetNullCount())` and avoid instantiating `array`.\n\n##########\nFile path: cpp/src/arrow/compute/kernels/aggregate_test.cc\n##########\n@@ -1533,23 +1533,67 @@ TEST_F(TestInt64QuantileKernel, Int64) {\n class TestRandomQuantileKernel : public TestPrimitiveQuantileKernel<Int32Type> {\n  public:\n   void CheckQuantiles(int64_t array_size, int64_t num_quantiles) {\n-    auto rand = random::RandomArrayGenerator(0x5487658);\n+    std::shared_ptr<Array> array;\n+    std::vector<double> quantiles;\n     // small value range to exercise input array with equal values and histogram approach\n-    const auto array = rand.Numeric<Int32Type>(array_size, -100, 200, 0.1);\n+    GenerateTestData(array_size, num_quantiles, -100, 200, &array, &quantiles);\n+\n+    this->AssertQuantilesAre(array, QuantileOptions{quantiles},\n+                             NaiveQuantile(*array, quantiles, interpolations_));\n+  }\n \n+  void CheckTDigests(std::vector<int> chunk_sizes, int64_t num_quantiles) {\n+    int total_size = 0;\n+    for (int size : chunk_sizes) {\n+      total_size += size;\n+    }\n+    std::shared_ptr<Array> array;\n     std::vector<double> quantiles;\n-    random_real(num_quantiles, 0x5487658, 0.0, 1.0, &quantiles);\n-    // make sure to exercise 0 and 1 quantiles\n-    *std::min_element(quantiles.begin(), quantiles.end()) = 0;\n-    *std::max_element(quantiles.begin(), quantiles.end()) = 1;\n+    GenerateTestData(total_size, num_quantiles, 100, 123456789, &array, &quantiles);\n \n-    this->AssertQuantilesAre(array, QuantileOptions{quantiles},\n-                             NaiveQuantile(*array, quantiles));\n+    total_size = 0;\n+    ArrayVector array_vector;\n+    for (int size : chunk_sizes) {\n+      array_vector.emplace_back(array->Slice(total_size, size));\n+      total_size += size;\n+    }\n+    auto chunked = *ChunkedArray::Make(array_vector);\n+\n+    TDigestOptions options(quantiles);\n+    ASSERT_OK_AND_ASSIGN(Datum out, TDigest(chunked, options));\n+    const auto& out_array = out.make_array();\n+    ASSERT_OK(out_array->ValidateFull());\n+    ASSERT_EQ(out_array->length(), quantiles.size());\n+    ASSERT_EQ(out_array->null_count(), 0);\n+    ASSERT_EQ(out_array->type(), float64());\n+\n+    // linear interpolated exact quantile as reference\n+    std::vector<std::vector<Datum>> exact =\n+        NaiveQuantile(*array, quantiles, {QuantileOptions::LINEAR});\n+    const double* approx = out_array->data()->GetValues<double>(1);\n+    for (size_t i = 0; i < quantiles.size(); ++i) {\n+      const auto& exact_scalar =\n+          std::static_pointer_cast<DoubleScalar>(exact[i][0].scalar());\n\nReview comment:\n       Use `checked_pointer_cast`?\n\n##########\nFile path: cpp/src/arrow/compute/kernels/aggregate_tdigest.cc\n##########\n@@ -0,0 +1,154 @@\n+// Licensed to the Apache Software Foundation (ASF) under one\n+// or more contributor license agreements.  See the NOTICE file\n+// distributed with this work for additional information\n+// regarding copyright ownership.  The ASF licenses this file\n+// to you under the Apache License, Version 2.0 (the\n+// \"License\"); you may not use this file except in compliance\n+// with the License.  You may obtain a copy of the License at\n+//\n+//   http://www.apache.org/licenses/LICENSE-2.0\n+//\n+// Unless required by applicable law or agreed to in writing,\n+// software distributed under the License is distributed on an\n+// \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+// KIND, either express or implied.  See the License for the\n+// specific language governing permissions and limitations\n+// under the License.\n+\n+#include \"arrow/compute/api_aggregate.h\"\n+#include \"arrow/compute/kernels/aggregate_internal.h\"\n+#include \"arrow/compute/kernels/common.h\"\n+#include \"arrow/util/bit_run_reader.h\"\n+#include \"arrow/util/tdigest.h\"\n+\n+namespace arrow {\n+namespace compute {\n+namespace internal {\n+\n+namespace {\n+\n+using arrow::internal::TDigest;\n+using arrow::internal::VisitSetBitRunsVoid;\n+\n+template <typename ArrowType>\n+struct TDigestImpl : public ScalarAggregator {\n+  using ThisType = TDigestImpl<ArrowType>;\n+  using ArrayType = typename TypeTraits<ArrowType>::ArrayType;\n+  using CType = typename ArrowType::c_type;\n+\n+  explicit TDigestImpl(const TDigestOptions& options)\n+      : q{options.q}, tdigest{new TDigest(options.delta, options.buffer_size)} {}\n+\n+  void Consume(KernelContext*, const ExecBatch& batch) override {\n+    ArrayType array{batch[0].array()};\n+    const ArrayData& data = *array.data();\n+    const CType* values = data.GetValues<CType>(1);\n+\n+    if (array.length() > array.null_count()) {\n+      VisitSetBitRunsVoid(data.buffers[0], data.offset, data.length,\n+                          [&](int64_t pos, int64_t len) {\n+                            for (int64_t i = 0; i < len; ++i) {\n+                              this->tdigest->NanAdd(values[pos + i]);\n+                            }\n+                          });\n+    }\n+  }\n+\n+  void MergeFrom(KernelContext*, KernelState&& src) override {\n+    auto& other = checked_cast<ThisType&>(src);\n+    std::vector<std::unique_ptr<TDigest>> other_tdigest;\n+    other_tdigest.push_back(std::move(other.tdigest));\n+    this->tdigest->Merge(&other_tdigest);\n+  }\n+\n+  void Finalize(KernelContext* ctx, Datum* out) override {\n+    const int64_t out_length = this->tdigest->is_empty() ? 0 : this->q.size();\n+    auto out_data = ArrayData::Make(float64(), out_length, 0);\n+    out_data->buffers.resize(2, nullptr);\n+\n+    if (out_length > 0) {\n+      KERNEL_ASSIGN_OR_RAISE(out_data->buffers[1], ctx,\n+                             ctx->Allocate(out_length * sizeof(double)));\n+      double* out_buffer = out_data->template GetMutableValues<double>(1);\n+      for (int64_t i = 0; i < out_length; ++i) {\n+        out_buffer[i] = this->tdigest->Quantile(this->q[i]);\n+      }\n+    }\n+\n+    *out = Datum(std::move(out_data));\n+  }\n+\n+  const std::vector<double>& q;\n+  std::unique_ptr<TDigest> tdigest;\n\nReview comment:\n       It doesn't seem to me that the `unique_ptr` is useful, you could just store the `TDigest` directly here.\n\n##########\nFile path: cpp/src/arrow/util/tdigest.h\n##########\n@@ -60,12 +61,27 @@ class ARROW_EXPORT TDigest {\n     input_.push_back(value);\n   }\n \n+  // skip NAN on adding\n+  // TODO(yibo): store NAN as is, partition to buffer end before merging\n+  template <typename T>\n+  typename std::enable_if<std::is_floating_point<T>::value>::type NanAdd(T value) {\n+    if (!std::isnan(value)) Add(value);\n+  }\n+\n+  template <typename T>\n+  typename std::enable_if<std::is_integral<T>::value>::type NanAdd(T value) {\n+    Add(static_cast<double>(value));\n\nReview comment:\n       Note that `std::isnan` is defined for integrals. So you could probably just write:\r\n   ```c++\r\n     template <typename T>\r\n     void NanAdd(T value) {\r\n       if (!std::isnan(value)) { Add(static_cast<double>(value)); }\r\n     }\r\n   ```\r\n   \n\n##########\nFile path: cpp/src/arrow/compute/kernels/aggregate_benchmark.cc\n##########\n@@ -498,5 +498,19 @@ QUANTILE_KERNEL_BENCHMARK_WIDE(QuantileKernelInt64Wide, Int64Type);\n QUANTILE_KERNEL_BENCHMARK_NARROW(QuantileKernelInt64Narrow, Int64Type);\n QUANTILE_KERNEL_BENCHMARK_WIDE(QuantileKernelDouble, DoubleType);\n \n+static void TDigestKernel(benchmark::State& state) {\n+  TDigestOptions options;\n+  RegressionArgs args(state);\n+  const int64_t array_size = args.size / sizeof(double);\n+  auto rand = random::RandomArrayGenerator(1926);\n+  auto array = rand.Numeric<DoubleType>(array_size, 0, 1 << 24, args.null_proportion);\n+\n+  for (auto _ : state) {\n+    ABORT_NOT_OK(TDigest(array, options).status());\n+  }\n+}\n+\n+BENCHMARK(TDigestKernel)->Apply(QuantileKernelBenchArgs);\n\nReview comment:\n       Call this `TDigestKernelDouble`?\n\n##########\nFile path: cpp/src/arrow/compute/kernels/aggregate_test.cc\n##########\n@@ -1625,6 +1669,10 @@ TEST_F(TestRandomQuantileKernel, Histogram) {\n   // exercise histogram approach: size >= 65536, range <= 65536\n   this->CheckQuantiles(/*array_size=*/80000, /*num_quantiles=*/100);\n }\n+\n+TEST_F(TestRandomQuantileKernel, TDigest) {\n+  this->CheckTDigests(/*chunk_sizes=*/{12345, 6789, 8765, 4321}, /*num_quantiles=*/100);\n\nReview comment:\n       Does it also check the case whether there are only nulls or NaNs? If not, can you add explicit tests?\n\n##########\nFile path: cpp/src/arrow/util/tdigest.h\n##########\n@@ -60,12 +61,27 @@ class ARROW_EXPORT TDigest {\n     input_.push_back(value);\n   }\n \n+  // skip NAN on adding\n+  // TODO(yibo): store NAN as is, partition to buffer end before merging\n\nReview comment:\n       Why would it be better to partition at the end?\n\n\n\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2021-02-22T15:20:54.581+0000",
                    "updated": "2021-02-22T15:20:54.581+0000",
                    "started": "2021-02-22T15:20:54.580+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "555856",
                    "issueId": "13357325"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13357325/worklog/555877",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "pitrou commented on pull request #9435:\nURL: https://github.com/apache/arrow/pull/9435#issuecomment-783480590\n\n\n   For the record, 93% of the consumed CPU time seems to be in `TDigest::MergeInput`, of which:\r\n   * 23% in `TDigestMerger::Add`\r\n   * 68% in `std::sort`\r\n   \n\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2021-02-22T16:03:21.064+0000",
                    "updated": "2021-02-22T16:03:21.064+0000",
                    "started": "2021-02-22T16:03:21.064+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "555877",
                    "issueId": "13357325"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13357325/worklog/555878",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "pitrou commented on pull request #9435:\nURL: https://github.com/apache/arrow/pull/9435#issuecomment-783483294\n\n\n   Here are the new benchmark results. It seems TDigest is only really useful for centiles (!):\r\n   ```\r\n   QuantileKernelMedianNarrow<Int32Type>/1048576/0          611 us          610 us         1170 bytes_per_second=1.59974G/s items_per_second=429.428M/s null_percent=0 size=1048.58k\r\n   QuantileKernelMedianWide<Int32Type>/1048576/0           1602 us         1595 us          438 bytes_per_second=627.15M/s items_per_second=164.404M/s null_percent=0 size=1048.58k\r\n   QuantileKernelMedianNarrow<Int64Type>/1048576/0          332 us          331 us         2111 bytes_per_second=2.95009G/s items_per_second=395.955M/s null_percent=0 size=1048.58k\r\n   QuantileKernelMedianWide<Int64Type>/1048576/0            553 us          550 us         1272 bytes_per_second=1.77461G/s items_per_second=238.185M/s null_percent=0 size=1048.58k\r\n   QuantileKernelMedianWide<DoubleType>/1048576/0          1148 us         1145 us          609 bytes_per_second=873.302M/s items_per_second=114.465M/s null_percent=0 size=1048.58k\r\n   \r\n   QuantileKernelDecilesNarrow<Int32Type>/1048576/0         620 us          617 us         1158 bytes_per_second=1.5826G/s items_per_second=424.825M/s null_percent=0 size=1048.58k\r\n   QuantileKernelDecilesWide<Int32Type>/1048576/0          4685 us         4666 us          151 bytes_per_second=214.324M/s items_per_second=56.1838M/s null_percent=0 size=1048.58k\r\n   QuantileKernelDecilesWide<DoubleType>/1048576/0         2841 us         2829 us          247 bytes_per_second=353.477M/s items_per_second=46.3309M/s null_percent=0 size=1048.58k\r\n   \r\n   QuantileKernelCentilesNarrow<Int32Type>/1048576/0        621 us          619 us         1137 bytes_per_second=1.57778G/s items_per_second=423.531M/s null_percent=0 size=1048.58k\r\n   QuantileKernelCentilesWide<Int32Type>/1048576/0        14151 us        14120 us           50 bytes_per_second=70.8198M/s items_per_second=18.565M/s null_percent=0 size=1048.58k\r\n   QuantileKernelCentilesWide<DoubleType>/1048576/0        7354 us         7328 us           97 bytes_per_second=136.46M/s items_per_second=17.8861M/s null_percent=0 size=1048.58k\r\n   \r\n   TDigestKernelDoubleMedian/1048576/0                     5655 us         5628 us          125 bytes_per_second=177.681M/s items_per_second=23.289M/s null_percent=0 size=1048.58k\r\n   TDigestKernelDoubleDeciles/1048576/0                    5617 us         5598 us          125 bytes_per_second=178.645M/s items_per_second=23.4154M/s null_percent=0 size=1048.58k\r\n   TDigestKernelDoubleCentiles/1048576/0                   5802 us         5784 us          125 bytes_per_second=172.883M/s items_per_second=22.6601M/s null_percent=0 size=1048.58k\r\n   ```\r\n   \n\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2021-02-22T16:07:04.311+0000",
                    "updated": "2021-02-22T16:07:04.311+0000",
                    "started": "2021-02-22T16:07:04.311+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "555878",
                    "issueId": "13357325"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13357325/worklog/556147",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "cyb70289 commented on pull request #9435:\nURL: https://github.com/apache/arrow/pull/9435#issuecomment-783839807\n\n\n   > Also, it seems there's a performance problem here where TDigest is much slower than Quantile:\r\n   \r\n   Thanks for careful review. As you found, the bottleneck of TDigest is sorting. I once talked with the author about possibility of improving TDigest performance by removing sorting: https://github.com/tdunning/t-digest/issues/153. There are some ideas to mitigate the penalty of sorting. I also plan to evaluate faster sorting algorithm like radix sort for floating numbers (folly has such an implementation).\r\n   \r\n   `Quantile` kernel is expensive in calculating quantiles (call `std::nth_element`). So centils() performances the worst, simply because it calculates more quantiles.\r\n   `TDigest` kernel is trivial in calculating quantiles, so its performance is almost constant regardless number of quantiles to calculate. But TDigest is expensive in adding data points (TDigestMerger::Add), when buffer is full, it sorts (call `std::sort`) the input buffer which is much slower than `std::nth_element`.\r\n   \r\n   I think `Quantile` and `TDigest` are for different purpose. You will use `TDigest` if you have large volume of inputs (or streaming data), and copying all of them leads to huge memory footprint. Another benefit of `TDigest` is that chunks can be processed in parallel, then merge into one tdigest, though current aggregate kernel framework doesn't support it.\n\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2021-02-23T02:49:27.004+0000",
                    "updated": "2021-02-23T02:49:27.004+0000",
                    "started": "2021-02-23T02:49:27.004+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "556147",
                    "issueId": "13357325"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13357325/worklog/556152",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "cyb70289 commented on pull request #9435:\nURL: https://github.com/apache/arrow/pull/9435#issuecomment-783843292\n\n\n   Other thoughts about O(1) space quantile kernel performance:\r\n   TDigest is good at estimate skewed quantiles, like 0.01, 0.99. For normal quantiles between 0.1 ~ 0.9, the old school online quantile algorithm P-Square [1] is good enough, it should be faster than TDigest. Maybe we can add a p-square kernel for additional cases, or auto select tdigest/p-square per input options.\r\n   [1] https://www.cse.wustl.edu/~jain/papers/ftp/psqr.pdf\n\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2021-02-23T03:02:44.311+0000",
                    "updated": "2021-02-23T03:02:44.311+0000",
                    "started": "2021-02-23T03:02:44.311+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "556152",
                    "issueId": "13357325"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13357325/worklog/556168",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "cyb70289 commented on a change in pull request #9435:\nURL: https://github.com/apache/arrow/pull/9435#discussion_r580761348\n\n\n\n##########\nFile path: cpp/src/arrow/util/tdigest.h\n##########\n@@ -60,12 +61,27 @@ class ARROW_EXPORT TDigest {\n     input_.push_back(value);\n   }\n \n+  // skip NAN on adding\n+  // TODO(yibo): store NAN as is, partition to buffer end before merging\n+  template <typename T>\n+  typename std::enable_if<std::is_floating_point<T>::value>::type NanAdd(T value) {\n+    if (!std::isnan(value)) Add(value);\n+  }\n+\n+  template <typename T>\n+  typename std::enable_if<std::is_integral<T>::value>::type NanAdd(T value) {\n+    Add(static_cast<double>(value));\n\nReview comment:\n       But looks MSVC doesn't support it? https://godbolt.org/z/h6jxGo\n\n\n\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2021-02-23T04:27:34.339+0000",
                    "updated": "2021-02-23T04:27:34.339+0000",
                    "started": "2021-02-23T04:27:34.339+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "556168",
                    "issueId": "13357325"
                }
            ]
        },
        "customfield_12313920": null,
        "issuetype": {
            "self": "https://issues.apache.org/jira/rest/api/2/issuetype/4",
            "id": "4",
            "description": "An improvement or enhancement to an existing feature or task.",
            "iconUrl": "https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21140&avatarType=issuetype",
            "name": "Improvement",
            "subtask": false,
            "avatarId": 21140
        },
        "timespent": 21600,
        "customfield_12314020": "{summaryBean=com.atlassian.jira.plugin.devstatus.rest.SummaryBean@627c2fed[summary={pullrequest=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@6123fb37[overall=PullRequestOverallBean{stateCount=0, state='OPEN', details=PullRequestOverallDetails{openCount=0, mergedCount=0, declinedCount=0}},byInstanceType={}], build=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@b53b446[overall=com.atlassian.jira.plugin.devstatus.summary.beans.BuildOverallBean@75571c58[failedBuildCount=0,successfulBuildCount=0,unknownBuildCount=0,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], review=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@37d2b1cf[overall=com.atlassian.jira.plugin.devstatus.summary.beans.ReviewsOverallBean@20993a02[stateCount=0,state=<null>,dueDate=<null>,overDue=false,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], deployment-environment=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@367e4bd3[overall=com.atlassian.jira.plugin.devstatus.summary.beans.DeploymentOverallBean@7b062498[topEnvironments=[],showProjects=false,successfulCount=0,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], repository=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@59f8aefe[overall=com.atlassian.jira.plugin.devstatus.summary.beans.CommitOverallBean@3058c6e9[count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], branch=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@74bc23e2[overall=com.atlassian.jira.plugin.devstatus.summary.beans.BranchOverallBean@3e54eb09[count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}]},errors=[],configErrors=[]], devSummaryJson={\"cachedValue\":{\"errors\":[],\"configErrors\":[],\"summary\":{\"pullrequest\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"stateCount\":0,\"state\":\"OPEN\",\"details\":{\"openCount\":0,\"mergedCount\":0,\"declinedCount\":0,\"total\":0},\"open\":true},\"byInstanceType\":{}},\"build\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"failedBuildCount\":0,\"successfulBuildCount\":0,\"unknownBuildCount\":0},\"byInstanceType\":{}},\"review\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"stateCount\":0,\"state\":null,\"dueDate\":null,\"overDue\":false,\"completed\":false},\"byInstanceType\":{}},\"deployment-environment\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"topEnvironments\":[],\"showProjects\":false,\"successfulCount\":0},\"byInstanceType\":{}},\"repository\":{\"overall\":{\"count\":0,\"lastUpdated\":null},\"byInstanceType\":{}},\"branch\":{\"overall\":{\"count\":0,\"lastUpdated\":null},\"byInstanceType\":{}}}},\"isStale\":false}}",
        "customfield_12314141": null,
        "customfield_12314140": null,
        "project": {
            "self": "https://issues.apache.org/jira/rest/api/2/project/12319525",
            "id": "12319525",
            "key": "ARROW",
            "name": "Apache Arrow",
            "projectTypeKey": "software",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/projectavatar?pid=12319525&avatarId=10011",
                "24x24": "https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12319525&avatarId=10011",
                "16x16": "https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12319525&avatarId=10011",
                "32x32": "https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12319525&avatarId=10011"
            },
            "projectCategory": {
                "self": "https://issues.apache.org/jira/rest/api/2/projectCategory/13960",
                "id": "13960",
                "description": "Apache Arrow",
                "name": "Arrow"
            }
        },
        "aggregatetimespent": 21600,
        "customfield_12312520": null,
        "customfield_12312521": "Tue Feb 23 15:22:38 UTC 2021",
        "customfield_12314422": null,
        "customfield_12314421": null,
        "customfield_12314146": null,
        "customfield_12314420": null,
        "customfield_12314145": null,
        "customfield_12314144": null,
        "customfield_12314143": null,
        "resolutiondate": "2021-02-23T15:22:38.000+0000",
        "workratio": -1,
        "customfield_12312923": null,
        "customfield_12312920": null,
        "customfield_12312921": null,
        "watches": {
            "self": "https://issues.apache.org/jira/rest/api/2/issue/ARROW-11541/watchers",
            "watchCount": 1,
            "isWatching": false
        },
        "created": "2021-02-07T01:47:05.000+0000",
        "updated": "2021-08-01T19:27:20.000+0000",
        "timeoriginalestimate": null,
        "description": "Implement approximate quantile kernel using tdigest util.",
        "customfield_10010": null,
        "timetracking": {
            "remainingEstimate": "0h",
            "timeSpent": "6h",
            "remainingEstimateSeconds": 0,
            "timeSpentSeconds": 21600
        },
        "customfield_12314523": null,
        "customfield_12314127": null,
        "customfield_12314522": null,
        "customfield_12314126": null,
        "customfield_12314521": null,
        "customfield_12314125": null,
        "customfield_12314520": null,
        "customfield_12314124": null,
        "attachment": [],
        "customfield_12312340": null,
        "customfield_12314123": null,
        "customfield_12312341": null,
        "customfield_12312220": null,
        "customfield_12314122": null,
        "customfield_12314121": null,
        "customfield_12314120": null,
        "customfield_12314129": null,
        "customfield_12314524": null,
        "customfield_12314128": null,
        "summary": "[C++][Compute] Implement approximate quantile kernel",
        "customfield_12314130": null,
        "customfield_12310291": null,
        "customfield_12310290": null,
        "customfield_12314138": null,
        "customfield_12314137": null,
        "environment": null,
        "customfield_12314136": null,
        "customfield_12314135": null,
        "customfield_12311020": null,
        "customfield_12314134": null,
        "duedate": null,
        "customfield_12314132": null,
        "customfield_12314131": null,
        "comment": {
            "comments": [
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13357325/comment/17289128",
                    "id": "17289128",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=apitrou",
                        "name": "apitrou",
                        "key": "pitrou",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=pitrou&avatarId=35049",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=pitrou&avatarId=35049",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=pitrou&avatarId=35049",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=pitrou&avatarId=35049"
                        },
                        "displayName": "Antoine Pitrou",
                        "active": true,
                        "timeZone": "Europe/Paris"
                    },
                    "body": "Issue resolved by pull request 9435\n[https://github.com/apache/arrow/pull/9435]",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=apitrou",
                        "name": "apitrou",
                        "key": "pitrou",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=pitrou&avatarId=35049",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=pitrou&avatarId=35049",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=pitrou&avatarId=35049",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=pitrou&avatarId=35049"
                        },
                        "displayName": "Antoine Pitrou",
                        "active": true,
                        "timeZone": "Europe/Paris"
                    },
                    "created": "2021-02-23T15:22:38.927+0000",
                    "updated": "2021-02-23T15:22:38.927+0000"
                }
            ],
            "maxResults": 1,
            "total": 1,
            "startAt": 0
        },
        "customfield_12311820": "0|z0ngeo:",
        "customfield_12314139": null
    }
}