{
    "expand": "operations,versionedRepresentations,editmeta,changelog,renderedFields",
    "id": "13370102",
    "self": "https://issues.apache.org/jira/rest/api/2/issue/13370102",
    "key": "ARROW-12254",
    "fields": {
        "fixVersions": [
            {
                "self": "https://issues.apache.org/jira/rest/api/2/version/12349493",
                "id": "12349493",
                "description": "",
                "name": "4.0.0",
                "archived": false,
                "released": true,
                "releaseDate": "2021-04-26"
            }
        ],
        "resolution": {
            "self": "https://issues.apache.org/jira/rest/api/2/resolution/1",
            "id": "1",
            "description": "A fix for this issue is checked into the tree and tested.",
            "name": "Fixed"
        },
        "customfield_12312322": null,
        "customfield_12312323": null,
        "customfield_12312320": null,
        "customfield_12310420": "9223372036854775807",
        "customfield_12312321": null,
        "customfield_12312328": null,
        "customfield_12312329": null,
        "customfield_12312326": null,
        "customfield_12310300": null,
        "customfield_12312327": null,
        "customfield_12312324": null,
        "customfield_12312720": null,
        "customfield_12312325": null,
        "lastViewed": null,
        "priority": {
            "self": "https://issues.apache.org/jira/rest/api/2/priority/3",
            "iconUrl": "https://issues.apache.org/jira/images/icons/priorities/major.svg",
            "name": "Major",
            "id": "3"
        },
        "labels": [
            "pull-request-available"
        ],
        "customfield_12312333": null,
        "customfield_12312334": null,
        "customfield_12313422": "false",
        "customfield_12310310": "0.0",
        "customfield_12312331": null,
        "customfield_12312332": null,
        "aggregatetimeoriginalestimate": null,
        "timeestimate": 0,
        "customfield_12312330": null,
        "versions": [],
        "customfield_12311120": null,
        "customfield_12313826": null,
        "customfield_12312339": null,
        "issuelinks": [],
        "customfield_12313825": null,
        "assignee": {
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=alamb",
            "name": "alamb",
            "key": "alamb",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=alamb&avatarId=43364",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=alamb&avatarId=43364",
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=alamb&avatarId=43364",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=alamb&avatarId=43364"
            },
            "displayName": "Andrew Lamb",
            "active": true,
            "timeZone": "America/New_York"
        },
        "customfield_12312337": null,
        "customfield_12313823": null,
        "customfield_12312338": null,
        "customfield_12311920": null,
        "customfield_12313822": null,
        "customfield_12312335": null,
        "customfield_12313821": null,
        "customfield_12312336": null,
        "customfield_12313820": null,
        "status": {
            "self": "https://issues.apache.org/jira/rest/api/2/status/5",
            "description": "A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.",
            "iconUrl": "https://issues.apache.org/jira/images/icons/statuses/resolved.png",
            "name": "Resolved",
            "id": "5",
            "statusCategory": {
                "self": "https://issues.apache.org/jira/rest/api/2/statuscategory/3",
                "id": 3,
                "key": "done",
                "colorName": "green",
                "name": "Done"
            }
        },
        "components": [
            {
                "self": "https://issues.apache.org/jira/rest/api/2/component/12335005",
                "id": "12335005",
                "name": "Rust - DataFusion"
            }
        ],
        "customfield_12312026": null,
        "customfield_12312023": null,
        "customfield_12312024": null,
        "aggregatetimeestimate": 0,
        "customfield_12312022": null,
        "customfield_12310921": null,
        "customfield_12310920": "9223372036854775807",
        "customfield_12312823": null,
        "creator": {
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=alamb",
            "name": "alamb",
            "key": "alamb",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=alamb&avatarId=43364",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=alamb&avatarId=43364",
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=alamb&avatarId=43364",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=alamb&avatarId=43364"
            },
            "displayName": "Andrew Lamb",
            "active": true,
            "timeZone": "America/New_York"
        },
        "subtasks": [],
        "reporter": {
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=alamb",
            "name": "alamb",
            "key": "alamb",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=alamb&avatarId=43364",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=alamb&avatarId=43364",
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=alamb&avatarId=43364",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=alamb&avatarId=43364"
            },
            "displayName": "Andrew Lamb",
            "active": true,
            "timeZone": "America/New_York"
        },
        "aggregateprogress": {
            "progress": 14400,
            "total": 14400,
            "percent": 100
        },
        "customfield_12313520": null,
        "customfield_12310250": null,
        "progress": {
            "progress": 14400,
            "total": 14400,
            "percent": 100
        },
        "customfield_12313924": null,
        "votes": {
            "self": "https://issues.apache.org/jira/rest/api/2/issue/ARROW-12254/votes",
            "votes": 0,
            "hasVoted": false
        },
        "worklog": {
            "startAt": 0,
            "maxResults": 20,
            "total": 24,
            "worklogs": [
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13370102/worklog/578357",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "alamb opened a new pull request #9926:\nURL: https://github.com/apache/arrow/pull/9926\n\n\n   (note this builds on the code in https://github.com/apache/arrow/pull/9924, so marking it a draft until that is merged)\r\n   \r\n   # Rationale\r\n   Once the number of rows needed for a limit query has been produced, any further work done to read values from its input is wasted.\r\n   \r\n   The current implementation of LimitStream will keep polling its input for the next value, and returning `Poll::Ready(None)` , even once the limit has been reached\r\n   \r\n   For queries like `select * from foo limit 10` used for initial data exploration this is very wasteful.\r\n   \r\n   # Changes\r\n   \r\n   This PR changes `LimitStream` so that it drops its input once the limit has been reached -- this both potentially frees resources (memory, file handles, etc) it also avoids unnecessary computation\n\n\n-- \nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2021-04-07T13:27:08.832+0000",
                    "updated": "2021-04-07T13:27:08.832+0000",
                    "started": "2021-04-07T13:27:08.832+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "578357",
                    "issueId": "13370102"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13370102/worklog/578359",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "alamb commented on a change in pull request #9926:\nURL: https://github.com/apache/arrow/pull/9926#discussion_r608654403\n\n\n\n##########\nFile path: rust/datafusion/src/physical_plan/limit.rs\n##########\n@@ -200,30 +200,39 @@ pub fn truncate_batch(batch: &RecordBatch, n: usize) -> RecordBatch {\n \n /// A Limit stream limits the stream to up to `limit` rows.\n struct LimitStream {\n+    /// The maximum number of rows to produce\n     limit: usize,\n-    input: SendableRecordBatchStream,\n-    // the current count\n+    /// The input to read from. This is set to None once the limit is\n+    /// reached to enable early termination\n+    input: Option<SendableRecordBatchStream>,\n+    /// Copy of the input schema\n+    schema: SchemaRef,\n+    // the current number of rows which have been produced\n     current_len: usize,\n }\n \n impl LimitStream {\n     fn new(input: SendableRecordBatchStream, limit: usize) -> Self {\n+        let schema = input.schema();\n\nReview comment:\n       The actual code change for this PR is very small -- the rest of the changes are related to writing a proper test for it\n\n\n\n\n-- \nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2021-04-07T13:29:29.700+0000",
                    "updated": "2021-04-07T13:29:29.700+0000",
                    "started": "2021-04-07T13:29:29.699+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "578359",
                    "issueId": "13370102"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13370102/worklog/578364",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "mkmik commented on a change in pull request #9926:\nURL: https://github.com/apache/arrow/pull/9926#discussion_r608659301\n\n\n\n##########\nFile path: rust/datafusion/src/physical_plan/limit.rs\n##########\n@@ -200,30 +200,39 @@ pub fn truncate_batch(batch: &RecordBatch, n: usize) -> RecordBatch {\n \n /// A Limit stream limits the stream to up to `limit` rows.\n struct LimitStream {\n+    /// The maximum number of rows to produce\n     limit: usize,\n-    input: SendableRecordBatchStream,\n-    // the current count\n+    /// The input to read from. This is set to None once the limit is\n+    /// reached to enable early termination\n+    input: Option<SendableRecordBatchStream>,\n+    /// Copy of the input schema\n+    schema: SchemaRef,\n+    // the current number of rows which have been produced\n     current_len: usize,\n }\n \n impl LimitStream {\n     fn new(input: SendableRecordBatchStream, limit: usize) -> Self {\n+        let schema = input.schema();\n\nReview comment:\n       I have a vague memory that [FusedStream](https://docs.rs/futures/0.3.13/futures/stream/trait.FusedStream.html) may have something to do with this property (although /noideadog)\r\n   \r\n   \n\n\n\n\n-- \nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2021-04-07T13:35:09.776+0000",
                    "updated": "2021-04-07T13:35:09.776+0000",
                    "started": "2021-04-07T13:35:09.776+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "578364",
                    "issueId": "13370102"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13370102/worklog/578370",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "alamb commented on a change in pull request #9926:\nURL: https://github.com/apache/arrow/pull/9926#discussion_r608675726\n\n\n\n##########\nFile path: rust/datafusion/src/physical_plan/limit.rs\n##########\n@@ -200,30 +200,39 @@ pub fn truncate_batch(batch: &RecordBatch, n: usize) -> RecordBatch {\n \n /// A Limit stream limits the stream to up to `limit` rows.\n struct LimitStream {\n+    /// The maximum number of rows to produce\n     limit: usize,\n-    input: SendableRecordBatchStream,\n-    // the current count\n+    /// The input to read from. This is set to None once the limit is\n+    /// reached to enable early termination\n+    input: Option<SendableRecordBatchStream>,\n+    /// Copy of the input schema\n+    schema: SchemaRef,\n+    // the current number of rows which have been produced\n     current_len: usize,\n }\n \n impl LimitStream {\n     fn new(input: SendableRecordBatchStream, limit: usize) -> Self {\n+        let schema = input.schema();\n\nReview comment:\n       This is a good point.\r\n   \r\n   One benefit of the this PR over `fuse()` is that this PR will actually drop the input stream (freeing resources) in addition to not calling the input stream again: https://docs.rs/futures-util/0.3.13/src/futures_util/stream/stream/fuse.rs.html#10\n\n\n\n\n-- \nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2021-04-07T13:53:30.750+0000",
                    "updated": "2021-04-07T13:53:30.750+0000",
                    "started": "2021-04-07T13:53:30.750+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "578370",
                    "issueId": "13370102"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13370102/worklog/578371",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "tustvold commented on a change in pull request #9926:\nURL: https://github.com/apache/arrow/pull/9926#discussion_r608677327\n\n\n\n##########\nFile path: rust/datafusion/src/physical_plan/limit.rs\n##########\n@@ -236,23 +245,29 @@ impl Stream for LimitStream {\n         mut self: Pin<&mut Self>,\n         cx: &mut Context<'_>,\n     ) -> Poll<Option<Self::Item>> {\n-        self.input.poll_next_unpin(cx).map(|x| match x {\n-            Some(Ok(batch)) => Ok(self.stream_limit(batch)).transpose(),\n-            other => other,\n-        })\n+        match &mut self.input {\n\nReview comment:\n       Why not just compare `self.current_len == self.limit` and short-cirtcuit before polling the wrapped stream, instead of the Option plumbing?\n\n\n\n\n-- \nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2021-04-07T13:55:17.597+0000",
                    "updated": "2021-04-07T13:55:17.597+0000",
                    "started": "2021-04-07T13:55:17.596+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "578371",
                    "issueId": "13370102"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13370102/worklog/578374",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "tustvold commented on pull request #9926:\nURL: https://github.com/apache/arrow/pull/9926#issuecomment-814937778\n\n\n   So I can understand from the code it polling the inner stream once before discarding the results of this and returning None, but at this point it should not be polled again. According to the [stream trait](https://docs.rs/futures/0.3.13/futures/stream/trait.Stream.html#panics)\r\n   \r\n   > Once a stream has finished (returned Ready(None) from poll_next), calling its poll_next method again may panic, block forever, or cause other kinds of problems; the Stream trait places no requirements on the effects of such a call. However, as the poll_next method is not marked unsafe, Rust's usual rules apply: calls must never cause undefined behavior (memory corruption, incorrect use of unsafe functions, or the like), regardless of the stream's state.\r\n   >\r\n   > If this is difficult to guard against then the fuse adapter can be used to ensure that poll_next always returns Ready(None) in subsequent calls.\r\n   \r\n   If this is occurring, there may be a more fundamental issue at play here that also needs fixing\r\n   \n\n\n-- \nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2021-04-07T13:59:09.199+0000",
                    "updated": "2021-04-07T13:59:09.199+0000",
                    "started": "2021-04-07T13:59:09.199+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "578374",
                    "issueId": "13370102"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13370102/worklog/578399",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "alamb commented on pull request #9926:\nURL: https://github.com/apache/arrow/pull/9926#issuecomment-814989652\n\n\n   > If this is occurring, there may be a more fundamental issue at play here that also needs fixing\r\n   \r\n   @tustvold  my initial reading of `LimitStream` also suggested to me that `input.poll_next` would only be called once after the limit had been hit. \r\n   \r\n   The   [`limit_early_shutdown`](https://github.com/apache/arrow/pull/9926/files#diff-d2c5066b508f7b8827fbe30c23dc2cdc367b4baa441eb5e74d7aee6f98e20880R310)  shows this bug in fact (it fails after consuming one more input than it should, without the changes in this PR).\r\n   \r\n   I had a test (https://github.com/apache/arrow/pull/9926/commits/99505b4a17fc176bea3304612b89408362296e27#diff-34dec6459ccea51c881a6ea392be9ad35f112395e6b8742df32a1742ac651e31L1799) that ran an entire query and I interpreted some `println!` output as showing that all the inputs were consumed (aka that `poll_next()` was repeatedly called). I did not debug it further. \r\n   \r\n   I am confident that this is an improvement to `LimitStream` -- there may well be some more fundamental issue that can also be fixed / improved as subsequent PRs\n\n\n-- \nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2021-04-07T15:04:37.221+0000",
                    "updated": "2021-04-07T15:04:37.221+0000",
                    "started": "2021-04-07T15:04:37.221+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "578399",
                    "issueId": "13370102"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13370102/worklog/578400",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "alamb commented on a change in pull request #9926:\nURL: https://github.com/apache/arrow/pull/9926#discussion_r608741617\n\n\n\n##########\nFile path: rust/datafusion/src/physical_plan/limit.rs\n##########\n@@ -236,23 +245,29 @@ impl Stream for LimitStream {\n         mut self: Pin<&mut Self>,\n         cx: &mut Context<'_>,\n     ) -> Poll<Option<Self::Item>> {\n-        self.input.poll_next_unpin(cx).map(|x| match x {\n-            Some(Ok(batch)) => Ok(self.stream_limit(batch)).transpose(),\n-            other => other,\n-        })\n+        match &mut self.input {\n\nReview comment:\n       My thinking was that the option plumbing actually `drop`s the input, freeing its resources when the limit has been hit, rather than waiting for the execution to be complete. \n\n\n\n\n-- \nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2021-04-07T15:06:20.562+0000",
                    "updated": "2021-04-07T15:06:20.562+0000",
                    "started": "2021-04-07T15:06:20.562+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "578400",
                    "issueId": "13370102"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13370102/worklog/578407",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "tustvold commented on a change in pull request #9926:\nURL: https://github.com/apache/arrow/pull/9926#discussion_r608745757\n\n\n\n##########\nFile path: rust/datafusion/src/physical_plan/limit.rs\n##########\n@@ -236,23 +245,29 @@ impl Stream for LimitStream {\n         mut self: Pin<&mut Self>,\n         cx: &mut Context<'_>,\n     ) -> Poll<Option<Self::Item>> {\n-        self.input.poll_next_unpin(cx).map(|x| match x {\n-            Some(Ok(batch)) => Ok(self.stream_limit(batch)).transpose(),\n-            other => other,\n-        })\n+        match &mut self.input {\n\nReview comment:\n       Fair enough\n\n\n\n\n-- \nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2021-04-07T15:10:46.589+0000",
                    "updated": "2021-04-07T15:10:46.589+0000",
                    "started": "2021-04-07T15:10:46.589+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "578407",
                    "issueId": "13370102"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13370102/worklog/578410",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "Dandandan commented on a change in pull request #9926:\nURL: https://github.com/apache/arrow/pull/9926#discussion_r608752879\n\n\n\n##########\nFile path: rust/datafusion/src/physical_plan/limit.rs\n##########\n@@ -200,30 +200,39 @@ pub fn truncate_batch(batch: &RecordBatch, n: usize) -> RecordBatch {\n \n /// A Limit stream limits the stream to up to `limit` rows.\n struct LimitStream {\n+    /// The maximum number of rows to produce\n     limit: usize,\n-    input: SendableRecordBatchStream,\n-    // the current count\n+    /// The input to read from. This is set to None once the limit is\n\nReview comment:\n       Is this necessary? It can be based on `self.current_len == self.limit` or otherwise a boolean flag like `limit_exhausted`?\n\n\n\n\n-- \nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2021-04-07T15:19:05.985+0000",
                    "updated": "2021-04-07T15:19:05.985+0000",
                    "started": "2021-04-07T15:19:05.984+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "578410",
                    "issueId": "13370102"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13370102/worklog/578411",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "Dandandan commented on a change in pull request #9926:\nURL: https://github.com/apache/arrow/pull/9926#discussion_r608752879\n\n\n\n##########\nFile path: rust/datafusion/src/physical_plan/limit.rs\n##########\n@@ -200,30 +200,39 @@ pub fn truncate_batch(batch: &RecordBatch, n: usize) -> RecordBatch {\n \n /// A Limit stream limits the stream to up to `limit` rows.\n struct LimitStream {\n+    /// The maximum number of rows to produce\n     limit: usize,\n-    input: SendableRecordBatchStream,\n-    // the current count\n+    /// The input to read from. This is set to None once the limit is\n\nReview comment:\n       Is this necessary? It can be based on `self.current_len == self.limit` or otherwise a boolean like `limit_exhausted`?\n\n\n\n\n-- \nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2021-04-07T15:19:48.956+0000",
                    "updated": "2021-04-07T15:19:48.956+0000",
                    "started": "2021-04-07T15:19:48.956+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "578411",
                    "issueId": "13370102"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13370102/worklog/578412",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "tustvold commented on a change in pull request #9926:\nURL: https://github.com/apache/arrow/pull/9926#discussion_r608754230\n\n\n\n##########\nFile path: rust/datafusion/src/physical_plan/limit.rs\n##########\n@@ -200,30 +200,39 @@ pub fn truncate_batch(batch: &RecordBatch, n: usize) -> RecordBatch {\n \n /// A Limit stream limits the stream to up to `limit` rows.\n struct LimitStream {\n+    /// The maximum number of rows to produce\n     limit: usize,\n-    input: SendableRecordBatchStream,\n-    // the current count\n+    /// The input to read from. This is set to None once the limit is\n\nReview comment:\n       Snap - https://github.com/apache/arrow/pull/9926#discussion_r608677327\n\n\n\n\n-- \nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2021-04-07T15:20:43.126+0000",
                    "updated": "2021-04-07T15:20:43.126+0000",
                    "started": "2021-04-07T15:20:43.126+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "578412",
                    "issueId": "13370102"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13370102/worklog/578414",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "Dandandan commented on a change in pull request #9926:\nURL: https://github.com/apache/arrow/pull/9926#discussion_r608755482\n\n\n\n##########\nFile path: rust/datafusion/src/physical_plan/limit.rs\n##########\n@@ -200,30 +200,39 @@ pub fn truncate_batch(batch: &RecordBatch, n: usize) -> RecordBatch {\n \n /// A Limit stream limits the stream to up to `limit` rows.\n struct LimitStream {\n+    /// The maximum number of rows to produce\n     limit: usize,\n-    input: SendableRecordBatchStream,\n-    // the current count\n+    /// The input to read from. This is set to None once the limit is\n\nReview comment:\n       haha \ud83d\udc4d \ud83d\ude06\n\n\n\n\n-- \nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2021-04-07T15:22:09.290+0000",
                    "updated": "2021-04-07T15:22:09.290+0000",
                    "started": "2021-04-07T15:22:09.290+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "578414",
                    "issueId": "13370102"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13370102/worklog/578417",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "Dandandan commented on a change in pull request #9926:\nURL: https://github.com/apache/arrow/pull/9926#discussion_r608757857\n\n\n\n##########\nFile path: rust/datafusion/src/physical_plan/limit.rs\n##########\n@@ -236,23 +245,29 @@ impl Stream for LimitStream {\n         mut self: Pin<&mut Self>,\n         cx: &mut Context<'_>,\n     ) -> Poll<Option<Self::Item>> {\n-        self.input.poll_next_unpin(cx).map(|x| match x {\n-            Some(Ok(batch)) => Ok(self.stream_limit(batch)).transpose(),\n-            other => other,\n-        })\n+        match &mut self.input {\n\nReview comment:\n       Do we do this in other places too? Isn't a `SendableRecordBatchStream` a small struct?\n\n\n\n\n-- \nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2021-04-07T15:24:48.641+0000",
                    "updated": "2021-04-07T15:24:48.641+0000",
                    "started": "2021-04-07T15:24:48.640+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "578417",
                    "issueId": "13370102"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13370102/worklog/578420",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "alamb commented on a change in pull request #9926:\nURL: https://github.com/apache/arrow/pull/9926#discussion_r608763472\n\n\n\n##########\nFile path: rust/datafusion/src/physical_plan/limit.rs\n##########\n@@ -200,30 +200,39 @@ pub fn truncate_batch(batch: &RecordBatch, n: usize) -> RecordBatch {\n \n /// A Limit stream limits the stream to up to `limit` rows.\n struct LimitStream {\n+    /// The maximum number of rows to produce\n     limit: usize,\n-    input: SendableRecordBatchStream,\n-    // the current count\n+    /// The input to read from. This is set to None once the limit is\n+    /// reached to enable early termination\n\nReview comment:\n       ```suggestion\r\n       /// reached so the input's resources can be `drop`ed (released) \r\n       /// without waiting until the entire plan's execution is complete\r\n   ```\n\n##########\nFile path: rust/datafusion/src/physical_plan/limit.rs\n##########\n@@ -236,23 +245,29 @@ impl Stream for LimitStream {\n         mut self: Pin<&mut Self>,\n         cx: &mut Context<'_>,\n     ) -> Poll<Option<Self::Item>> {\n-        self.input.poll_next_unpin(cx).map(|x| match x {\n-            Some(Ok(batch)) => Ok(self.stream_limit(batch)).transpose(),\n-            other => other,\n-        })\n+        match &mut self.input {\n\nReview comment:\n       > Isn't a SendableRecordBatchStream a small struct?\r\n   \r\n   It is a trait, so there are various things that implement it. Some, like the `ParquetStream` https://github.com/apache/arrow/blob/b6982df45dfd0cebf2b34deaec62801f87242bc5/rust/datafusion/src/physical_plan/parquet.rs#L876, could have substantial resources\n\n\n\n\n-- \nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2021-04-07T15:30:52.155+0000",
                    "updated": "2021-04-07T15:30:52.155+0000",
                    "started": "2021-04-07T15:30:52.155+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "578420",
                    "issueId": "13370102"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13370102/worklog/578421",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "Dandandan commented on a change in pull request #9926:\nURL: https://github.com/apache/arrow/pull/9926#discussion_r608763634\n\n\n\n##########\nFile path: rust/datafusion/src/physical_plan/limit.rs\n##########\n@@ -236,23 +245,29 @@ impl Stream for LimitStream {\n         mut self: Pin<&mut Self>,\n         cx: &mut Context<'_>,\n     ) -> Poll<Option<Self::Item>> {\n-        self.input.poll_next_unpin(cx).map(|x| match x {\n-            Some(Ok(batch)) => Ok(self.stream_limit(batch)).transpose(),\n-            other => other,\n-        })\n+        match &mut self.input {\n\nReview comment:\n       As far as I understand it now, it can consist of the whole tree of dependent streams. Probably still not a big resource hog but more than a few bytes.\n\n\n\n\n-- \nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2021-04-07T15:30:55.040+0000",
                    "updated": "2021-04-07T15:30:55.040+0000",
                    "started": "2021-04-07T15:30:55.039+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "578421",
                    "issueId": "13370102"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13370102/worklog/578520",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "alamb commented on a change in pull request #9926:\nURL: https://github.com/apache/arrow/pull/9926#discussion_r608880900\n\n\n\n##########\nFile path: rust/datafusion/src/physical_plan/limit.rs\n##########\n@@ -236,23 +245,29 @@ impl Stream for LimitStream {\n         mut self: Pin<&mut Self>,\n         cx: &mut Context<'_>,\n     ) -> Poll<Option<Self::Item>> {\n-        self.input.poll_next_unpin(cx).map(|x| match x {\n-            Some(Ok(batch)) => Ok(self.stream_limit(batch)).transpose(),\n-            other => other,\n-        })\n+        match &mut self.input {\n\nReview comment:\n       Imagine it is actually a subquery with a group by hash or join with a large hash table :) It may actually be hanging on to a substantial amount of memory I suspect\n\n\n\n\n-- \nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2021-04-07T18:08:40.932+0000",
                    "updated": "2021-04-07T18:08:40.932+0000",
                    "started": "2021-04-07T18:08:40.932+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "578520",
                    "issueId": "13370102"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13370102/worklog/578533",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "Dandandan commented on a change in pull request #9926:\nURL: https://github.com/apache/arrow/pull/9926#discussion_r608894732\n\n\n\n##########\nFile path: rust/datafusion/src/physical_plan/limit.rs\n##########\n@@ -236,23 +245,29 @@ impl Stream for LimitStream {\n         mut self: Pin<&mut Self>,\n         cx: &mut Context<'_>,\n     ) -> Poll<Option<Self::Item>> {\n-        self.input.poll_next_unpin(cx).map(|x| match x {\n-            Some(Ok(batch)) => Ok(self.stream_limit(batch)).transpose(),\n-            other => other,\n-        })\n+        match &mut self.input {\n\nReview comment:\n       Ah, yeah that's right!\n\n\n\n\n-- \nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2021-04-07T18:29:42.657+0000",
                    "updated": "2021-04-07T18:29:42.657+0000",
                    "started": "2021-04-07T18:29:42.657+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "578533",
                    "issueId": "13370102"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13370102/worklog/578555",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "github-actions[bot] commented on pull request #9926:\nURL: https://github.com/apache/arrow/pull/9926#issuecomment-815146795\n\n\n   https://issues.apache.org/jira/browse/ARROW-12254\n\n\n-- \nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2021-04-07T18:53:28.237+0000",
                    "updated": "2021-04-07T18:53:28.237+0000",
                    "started": "2021-04-07T18:53:28.236+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "578555",
                    "issueId": "13370102"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13370102/worklog/578584",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "codecov-io commented on pull request #9926:\nURL: https://github.com/apache/arrow/pull/9926#issuecomment-815163226\n\n\n   # [Codecov](https://codecov.io/gh/apache/arrow/pull/9926?src=pr&el=h1) Report\n   > Merging [#9926](https://codecov.io/gh/apache/arrow/pull/9926?src=pr&el=desc) (99505b4) into [master](https://codecov.io/gh/apache/arrow/commit/81f652102737ea89c30de0cec1e94414b8740666?el=desc) (81f6521) will **increase** coverage by `0.04%`.\n   > The diff coverage is `96.42%`.\n   \n   [![Impacted file tree graph](https://codecov.io/gh/apache/arrow/pull/9926/graphs/tree.svg?width=650&height=150&src=pr&token=LpTCFbqVT1)](https://codecov.io/gh/apache/arrow/pull/9926?src=pr&el=tree)\n   \n   ```diff\n   @@            Coverage Diff             @@\n   ##           master    #9926      +/-   ##\n   ==========================================\n   + Coverage   82.70%   82.75%   +0.04%     \n   ==========================================\n     Files         257      258       +1     \n     Lines       60486    60563      +77     \n   ==========================================\n   + Hits        50027    50120      +93     \n   + Misses      10459    10443      -16     \n   ```\n   \n   \n   | [Impacted Files](https://codecov.io/gh/apache/arrow/pull/9926?src=pr&el=tree) | Coverage \u0394 | |\n   |---|---|---|\n   | [rust/datafusion/src/test/exec.rs](https://codecov.io/gh/apache/arrow/pull/9926/diff?src=pr&el=tree#diff-cnVzdC9kYXRhZnVzaW9uL3NyYy90ZXN0L2V4ZWMucnM=) | `85.00% <85.00%> (\u00f8)` | |\n   | [rust/datafusion/src/physical\\_plan/limit.rs](https://codecov.io/gh/apache/arrow/pull/9926/diff?src=pr&el=tree#diff-cnVzdC9kYXRhZnVzaW9uL3NyYy9waHlzaWNhbF9wbGFuL2xpbWl0LnJz) | `79.82% <96.66%> (+23.15%)` | :arrow_up: |\n   | [rust/datafusion/src/execution/context.rs](https://codecov.io/gh/apache/arrow/pull/9926/diff?src=pr&el=tree#diff-cnVzdC9kYXRhZnVzaW9uL3NyYy9leGVjdXRpb24vY29udGV4dC5ycw==) | `93.13% <100.00%> (+0.10%)` | :arrow_up: |\n   | [rust/datafusion/src/test/mod.rs](https://codecov.io/gh/apache/arrow/pull/9926/diff?src=pr&el=tree#diff-cnVzdC9kYXRhZnVzaW9uL3NyYy90ZXN0L21vZC5ycw==) | `100.00% <100.00%> (\u00f8)` | |\n   | [rust/datafusion/src/physical\\_plan/planner.rs](https://codecov.io/gh/apache/arrow/pull/9926/diff?src=pr&el=tree#diff-cnVzdC9kYXRhZnVzaW9uL3NyYy9waHlzaWNhbF9wbGFuL3BsYW5uZXIucnM=) | `80.11% <0.00%> (+0.18%)` | :arrow_up: |\n   | [rust/datafusion/src/physical\\_plan/sort.rs](https://codecov.io/gh/apache/arrow/pull/9926/diff?src=pr&el=tree#diff-cnVzdC9kYXRhZnVzaW9uL3NyYy9waHlzaWNhbF9wbGFuL3NvcnQucnM=) | `91.52% <0.00%> (+1.12%)` | :arrow_up: |\n   \n   ------\n   \n   [Continue to review full report at Codecov](https://codecov.io/gh/apache/arrow/pull/9926?src=pr&el=continue).\n   > **Legend** - [Click here to learn more](https://docs.codecov.io/docs/codecov-delta)\n   > `\u0394 = absolute <relative> (impact)`, `\u00f8 = not affected`, `? = missing data`\n   > Powered by [Codecov](https://codecov.io/gh/apache/arrow/pull/9926?src=pr&el=footer). Last update [538e13b...99505b4](https://codecov.io/gh/apache/arrow/pull/9926?src=pr&el=lastupdated). Read the [comment docs](https://docs.codecov.io/docs/pull-request-comments).\n   \n\n\n-- \nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2021-04-07T19:19:11.419+0000",
                    "updated": "2021-04-07T19:19:11.419+0000",
                    "started": "2021-04-07T19:19:11.419+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "578584",
                    "issueId": "13370102"
                }
            ]
        },
        "customfield_12313920": null,
        "issuetype": {
            "self": "https://issues.apache.org/jira/rest/api/2/issuetype/1",
            "id": "1",
            "description": "A problem which impairs or prevents the functions of the product.",
            "iconUrl": "https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype",
            "name": "Bug",
            "subtask": false,
            "avatarId": 21133
        },
        "timespent": 14400,
        "customfield_12314020": "{summaryBean=com.atlassian.jira.plugin.devstatus.rest.SummaryBean@7033053d[summary={pullrequest=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@77f8f4e0[overall=PullRequestOverallBean{stateCount=0, state='OPEN', details=PullRequestOverallDetails{openCount=0, mergedCount=0, declinedCount=0}},byInstanceType={}], build=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@4f58485a[overall=com.atlassian.jira.plugin.devstatus.summary.beans.BuildOverallBean@7fb7eaa5[failedBuildCount=0,successfulBuildCount=0,unknownBuildCount=0,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], review=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@48f1d147[overall=com.atlassian.jira.plugin.devstatus.summary.beans.ReviewsOverallBean@3af26a75[stateCount=0,state=<null>,dueDate=<null>,overDue=false,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], deployment-environment=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@3765efe9[overall=com.atlassian.jira.plugin.devstatus.summary.beans.DeploymentOverallBean@77c7d962[topEnvironments=[],showProjects=false,successfulCount=0,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], repository=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@31fa5534[overall=com.atlassian.jira.plugin.devstatus.summary.beans.CommitOverallBean@18f220bc[count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], branch=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@709eec[overall=com.atlassian.jira.plugin.devstatus.summary.beans.BranchOverallBean@49b54b49[count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}]},errors=[],configErrors=[]], devSummaryJson={\"cachedValue\":{\"errors\":[],\"configErrors\":[],\"summary\":{\"pullrequest\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"stateCount\":0,\"state\":\"OPEN\",\"details\":{\"openCount\":0,\"mergedCount\":0,\"declinedCount\":0,\"total\":0},\"open\":true},\"byInstanceType\":{}},\"build\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"failedBuildCount\":0,\"successfulBuildCount\":0,\"unknownBuildCount\":0},\"byInstanceType\":{}},\"review\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"stateCount\":0,\"state\":null,\"dueDate\":null,\"overDue\":false,\"completed\":false},\"byInstanceType\":{}},\"deployment-environment\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"topEnvironments\":[],\"showProjects\":false,\"successfulCount\":0},\"byInstanceType\":{}},\"repository\":{\"overall\":{\"count\":0,\"lastUpdated\":null},\"byInstanceType\":{}},\"branch\":{\"overall\":{\"count\":0,\"lastUpdated\":null},\"byInstanceType\":{}}}},\"isStale\":false}}",
        "customfield_12314141": null,
        "customfield_12314140": null,
        "project": {
            "self": "https://issues.apache.org/jira/rest/api/2/project/12319525",
            "id": "12319525",
            "key": "ARROW",
            "name": "Apache Arrow",
            "projectTypeKey": "software",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/projectavatar?pid=12319525&avatarId=10011",
                "24x24": "https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12319525&avatarId=10011",
                "16x16": "https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12319525&avatarId=10011",
                "32x32": "https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12319525&avatarId=10011"
            },
            "projectCategory": {
                "self": "https://issues.apache.org/jira/rest/api/2/projectCategory/13960",
                "id": "13960",
                "description": "Apache Arrow",
                "name": "Arrow"
            }
        },
        "aggregatetimespent": 14400,
        "customfield_12312520": null,
        "customfield_12312521": "Fri Apr 09 10:33:15 UTC 2021",
        "customfield_12314422": null,
        "customfield_12314421": null,
        "customfield_12314146": null,
        "customfield_12314420": null,
        "customfield_12314145": null,
        "customfield_12314144": null,
        "customfield_12314143": null,
        "resolutiondate": "2021-04-09T10:33:15.000+0000",
        "workratio": -1,
        "customfield_12312923": null,
        "customfield_12312920": null,
        "customfield_12312921": null,
        "watches": {
            "self": "https://issues.apache.org/jira/rest/api/2/issue/ARROW-12254/watchers",
            "watchCount": 1,
            "isWatching": false
        },
        "created": "2021-04-07T13:23:43.000+0000",
        "updated": "2021-04-09T10:33:23.000+0000",
        "timeoriginalestimate": null,
        "description": "Once the number of rows needed for a limit query has been produced, any further work done to read values from its input is wasted.\r\n\r\nThe current implementation of LimitStream will keep polling its input for the next value, and returning Poll::Ready(None) , even once the limit has been reached\r\n\r\nThis is wasteful\r\n",
        "customfield_10010": null,
        "timetracking": {
            "remainingEstimate": "0h",
            "timeSpent": "4h",
            "remainingEstimateSeconds": 0,
            "timeSpentSeconds": 14400
        },
        "customfield_12314523": null,
        "customfield_12314127": null,
        "customfield_12314522": null,
        "customfield_12314126": null,
        "customfield_12314521": null,
        "customfield_12314125": null,
        "customfield_12314520": null,
        "customfield_12314124": null,
        "attachment": [],
        "customfield_12312340": null,
        "customfield_12314123": null,
        "customfield_12312341": null,
        "customfield_12312220": null,
        "customfield_12314122": null,
        "customfield_12314121": null,
        "customfield_12314120": null,
        "customfield_12314129": null,
        "customfield_12314524": null,
        "customfield_12314128": null,
        "summary": "[Rust][DataFusion] Limit keeps polling input after limit is reached",
        "customfield_12314130": null,
        "customfield_12310291": null,
        "customfield_12310290": null,
        "customfield_12314138": null,
        "customfield_12314137": null,
        "environment": null,
        "customfield_12314136": null,
        "customfield_12314135": null,
        "customfield_12311020": null,
        "customfield_12314134": null,
        "duedate": null,
        "customfield_12314132": null,
        "customfield_12314131": null,
        "comment": {
            "comments": [
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13370102/comment/17317872",
                    "id": "17317872",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=alamb",
                        "name": "alamb",
                        "key": "alamb",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=alamb&avatarId=43364",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=alamb&avatarId=43364",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=alamb&avatarId=43364",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=alamb&avatarId=43364"
                        },
                        "displayName": "Andrew Lamb",
                        "active": true,
                        "timeZone": "America/New_York"
                    },
                    "body": "Issue resolved by pull request 9926\n[https://github.com/apache/arrow/pull/9926]",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=alamb",
                        "name": "alamb",
                        "key": "alamb",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=alamb&avatarId=43364",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=alamb&avatarId=43364",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=alamb&avatarId=43364",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=alamb&avatarId=43364"
                        },
                        "displayName": "Andrew Lamb",
                        "active": true,
                        "timeZone": "America/New_York"
                    },
                    "created": "2021-04-09T10:33:15.226+0000",
                    "updated": "2021-04-09T10:33:15.226+0000"
                }
            ],
            "maxResults": 1,
            "total": 1,
            "startAt": 0
        },
        "customfield_12311820": "0|z0pmew:",
        "customfield_12314139": null
    }
}