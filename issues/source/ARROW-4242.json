{
    "expand": "operations,versionedRepresentations,editmeta,changelog,renderedFields",
    "id": "13209131",
    "self": "https://issues.apache.org/jira/rest/api/2/issue/13209131",
    "key": "ARROW-4242",
    "fields": {
        "fixVersions": [],
        "resolution": {
            "self": "https://issues.apache.org/jira/rest/api/2/resolution/2",
            "id": "2",
            "description": "The problem described is an issue which will never be fixed.",
            "name": "Won't Fix"
        },
        "customfield_12312322": null,
        "customfield_12312323": null,
        "customfield_12312320": null,
        "customfield_12310420": "9223372036854775807",
        "customfield_12312321": null,
        "customfield_12312328": null,
        "customfield_12312329": null,
        "customfield_12312326": null,
        "customfield_12310300": null,
        "customfield_12312327": null,
        "customfield_12312324": null,
        "customfield_12312720": null,
        "customfield_12312325": null,
        "lastViewed": null,
        "priority": {
            "self": "https://issues.apache.org/jira/rest/api/2/priority/4",
            "iconUrl": "https://issues.apache.org/jira/images/icons/priorities/minor.svg",
            "name": "Minor",
            "id": "4"
        },
        "labels": [],
        "customfield_12312333": null,
        "customfield_12312334": null,
        "customfield_12313422": "false",
        "customfield_12310310": "1.0",
        "customfield_12312331": null,
        "customfield_12312332": null,
        "aggregatetimeoriginalestimate": null,
        "timeestimate": null,
        "customfield_12312330": null,
        "versions": [],
        "customfield_12311120": null,
        "customfield_12313826": null,
        "customfield_12312339": null,
        "issuelinks": [],
        "customfield_12313825": null,
        "assignee": {
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=uwe",
            "name": "uwe",
            "key": "xhochy",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=xhochy&avatarId=30652",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=xhochy&avatarId=30652",
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=xhochy&avatarId=30652",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=xhochy&avatarId=30652"
            },
            "displayName": "Uwe Korn",
            "active": true,
            "timeZone": "Europe/Berlin"
        },
        "customfield_12312337": null,
        "customfield_12313823": null,
        "customfield_12312338": null,
        "customfield_12311920": null,
        "customfield_12313822": null,
        "customfield_12312335": null,
        "customfield_12313821": null,
        "customfield_12312336": null,
        "customfield_12313820": null,
        "status": {
            "self": "https://issues.apache.org/jira/rest/api/2/status/6",
            "description": "The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.",
            "iconUrl": "https://issues.apache.org/jira/images/icons/statuses/closed.png",
            "name": "Closed",
            "id": "6",
            "statusCategory": {
                "self": "https://issues.apache.org/jira/rest/api/2/statuscategory/3",
                "id": 3,
                "key": "done",
                "colorName": "green",
                "name": "Done"
            }
        },
        "components": [
            {
                "self": "https://issues.apache.org/jira/rest/api/2/component/12328935",
                "id": "12328935",
                "name": "C++"
            }
        ],
        "customfield_12312026": null,
        "customfield_12312023": null,
        "customfield_12312024": null,
        "aggregatetimeestimate": null,
        "customfield_12312022": null,
        "customfield_12310921": null,
        "customfield_12310920": "9223372036854775807",
        "customfield_12312823": null,
        "creator": {
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=mvilim",
            "name": "mvilim",
            "key": "mvilim",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
            },
            "displayName": "Michael Vilim",
            "active": true,
            "timeZone": "Etc/UTC"
        },
        "subtasks": [],
        "reporter": {
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=mvilim",
            "name": "mvilim",
            "key": "mvilim",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
            },
            "displayName": "Michael Vilim",
            "active": true,
            "timeZone": "Etc/UTC"
        },
        "aggregateprogress": {
            "progress": 0,
            "total": 0
        },
        "customfield_12313520": null,
        "customfield_12310250": null,
        "progress": {
            "progress": 0,
            "total": 0
        },
        "customfield_12313924": null,
        "votes": {
            "self": "https://issues.apache.org/jira/rest/api/2/issue/ARROW-4242/votes",
            "votes": 0,
            "hasVoted": false
        },
        "customfield_12313920": null,
        "issuetype": {
            "self": "https://issues.apache.org/jira/rest/api/2/issuetype/1",
            "id": "1",
            "description": "A problem which impairs or prevents the functions of the product.",
            "iconUrl": "https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype",
            "name": "Bug",
            "subtask": false,
            "avatarId": 21133
        },
        "timespent": null,
        "customfield_12314020": "{summaryBean=com.atlassian.jira.plugin.devstatus.rest.SummaryBean@535d58e4[summary={pullrequest=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@75cb6eae[overall=PullRequestOverallBean{stateCount=0, state='OPEN', details=PullRequestOverallDetails{openCount=0, mergedCount=0, declinedCount=0}},byInstanceType={}], build=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@490413e0[overall=com.atlassian.jira.plugin.devstatus.summary.beans.BuildOverallBean@6714aa70[failedBuildCount=0,successfulBuildCount=0,unknownBuildCount=0,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], review=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@6c032f00[overall=com.atlassian.jira.plugin.devstatus.summary.beans.ReviewsOverallBean@23104147[stateCount=0,state=<null>,dueDate=<null>,overDue=false,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], deployment-environment=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@4a62cdd6[overall=com.atlassian.jira.plugin.devstatus.summary.beans.DeploymentOverallBean@8e7b9c0[topEnvironments=[],showProjects=false,successfulCount=0,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], repository=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@7d69ecf3[overall=com.atlassian.jira.plugin.devstatus.summary.beans.CommitOverallBean@5cd29060[count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], branch=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@2ea51[overall=com.atlassian.jira.plugin.devstatus.summary.beans.BranchOverallBean@351e6a28[count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}]},errors=[],configErrors=[]], devSummaryJson={\"cachedValue\":{\"errors\":[],\"configErrors\":[],\"summary\":{\"pullrequest\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"stateCount\":0,\"state\":\"OPEN\",\"details\":{\"openCount\":0,\"mergedCount\":0,\"declinedCount\":0,\"total\":0},\"open\":true},\"byInstanceType\":{}},\"build\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"failedBuildCount\":0,\"successfulBuildCount\":0,\"unknownBuildCount\":0},\"byInstanceType\":{}},\"review\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"stateCount\":0,\"state\":null,\"dueDate\":null,\"overDue\":false,\"completed\":false},\"byInstanceType\":{}},\"deployment-environment\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"topEnvironments\":[],\"showProjects\":false,\"successfulCount\":0},\"byInstanceType\":{}},\"repository\":{\"overall\":{\"count\":0,\"lastUpdated\":null},\"byInstanceType\":{}},\"branch\":{\"overall\":{\"count\":0,\"lastUpdated\":null},\"byInstanceType\":{}}}},\"isStale\":false}}",
        "customfield_12314141": null,
        "customfield_12314140": null,
        "project": {
            "self": "https://issues.apache.org/jira/rest/api/2/project/12319525",
            "id": "12319525",
            "key": "ARROW",
            "name": "Apache Arrow",
            "projectTypeKey": "software",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/projectavatar?pid=12319525&avatarId=10011",
                "24x24": "https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12319525&avatarId=10011",
                "16x16": "https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12319525&avatarId=10011",
                "32x32": "https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12319525&avatarId=10011"
            },
            "projectCategory": {
                "self": "https://issues.apache.org/jira/rest/api/2/projectCategory/13960",
                "id": "13960",
                "description": "Apache Arrow",
                "name": "Arrow"
            }
        },
        "aggregatetimespent": null,
        "customfield_12312520": null,
        "customfield_12312521": "Sat Aug 27 14:41:40 UTC 2022",
        "customfield_12314422": null,
        "customfield_12314421": null,
        "customfield_12314146": null,
        "customfield_12314420": null,
        "customfield_12314145": null,
        "customfield_12314144": null,
        "customfield_12314143": null,
        "resolutiondate": "2019-03-04T10:09:03.000+0000",
        "workratio": -1,
        "customfield_12312923": null,
        "customfield_12312920": null,
        "customfield_12312921": null,
        "watches": {
            "self": "https://issues.apache.org/jira/rest/api/2/issue/ARROW-4242/watchers",
            "watchCount": 5,
            "isWatching": true
        },
        "created": "2019-01-12T02:18:07.000+0000",
        "updated": "2022-08-27T14:41:40.000+0000",
        "timeoriginalestimate": null,
        "description": "First, let me say I appreciate all the work that has been put into this project. I have been following it with great interest and recently decided to include it in one of my projects.\r\n\r\nHowever, I have run into an issue with a segmentation fault when trying to run the C++ unit tests (which previously worked for me). This issue appears to be something specific to my system (I am running Arch Linux). I can reproduce the issue with the minimal Docker install of Arch:\r\n{noformat}\r\nFROM archimg/base\r\n\r\nRUN \\\r\n pacman -Sy --noconfirm git cmake gcc make boost autoconf python; \\\r\n git clone --recursive https://github.com/apache/arrow.git; \\\r\n cd arrow/cpp; \\\r\n mkdir build; \\\r\n cd build; \\\r\n cmake -DARROW_BUILD_TESTS=ON ..; \\\r\n make\r\n{noformat}\r\nIf you create a Dockerfile with those contents and then run\r\n{noformat}\r\ndocker build -t mvilim/arch-arrow-test-segfault .\r\ndocker run mvilim/arch-arrow-test-segfault /bin/bash -c \"cd /arrow/cpp/build; make unittest; gcc --version; cmake --version\"{noformat}\r\nyou should be able to reproduce the issue:\r\n{noformat}\r\nThe following tests FAILED:\r\n 2 - arrow-array-test (Failed)\r\n 3 - arrow-buffer-test (Failed)\r\n 8 - arrow-stl-test (Failed)\r\n 9 - arrow-type-test (Failed)\r\n 10 - arrow-table-test (Failed)\r\n 15 - arrow-compute-boolean-test (Failed)\r\n 16 - arrow-compute-cast-test (Failed)\r\n 17 - arrow-compute-hash-test (Failed)\r\n 18 - arrow-feather-test (Failed)\r\n 19 - arrow-ipc-read-write-test (Failed)\r\n 20 - arrow-ipc-json-simple-test (Failed)\r\n 21 - arrow-ipc-json-test (Failed)\r\n 24 - arrow-csv-column-builder-test (Failed)\r\n 28 - arrow-io-compressed-test (Failed)\r\n 31 - arrow-io-memory-test (Failed){noformat}\r\nIf you run the container interactively and inspect the logs, you will see that all the failures are caused by seg faults.\r\n\r\nI used git bisect to narrow the problem down to commit 7cdab9b06 when the tests were switched to use shared linking by default. Static linking works fine for me (using -DARROW_TEST_LINKAGE=static).\r\n\r\nI also compiled with Clang and -DARROW_USE_ASAN=ON and inspected several of the stack traces. It looks like all the seg faults happen during creation of a shared pointer, but in varied places.\r\n\r\nOn creation of Int32Type:\r\n{noformat}\r\n./debug/arrow-array-test\r\n AddressSanitizer:DEADLYSIGNAL\r\n =================================================================\r\n ==29563==ERROR: AddressSanitizer: SEGV on unknown address 0x000000000000 (pc 0x558afa951b70 bp 0x7ffcf1c34880 sp 0x7ffcf1c34810 T0)\r\n ==29563==The signal is caused by a READ memory access.\r\n ==29563==Hint: address points to the zero page.\r\n #0 0x558afa951b6f in std::type_info::operator==(std::type_info const&) const /usr/bin/../lib64/gcc/x86_64-pc-linux-gnu/8.2.1/../../../../include/c++/8.2.1/typeinfo:123:12\r\n #1 0x558afa9b2c16 in std::Sp_counted_ptr_inplace<arrow::Int32Type, std::allocator<arrow::Int32Type>, (_gnu_cxx::_Lock_policy)2>::_M_get_deleter(std::type_info const&) /usr/bin/../lib64/gcc/x86_64-pc-linux-gnu/8.2.1/../../../../include/c++/8.2.1/bits/shared_ptr_base.h:573:16\r\n #2 0x7fe7b711e6f1 in std::_shared_count<(_gnu_cxx::_Lock_policy)2>::_M_get_deleter(std::type_info const&) const /usr/bin/../lib64/gcc/x86_64-pc-linux-gnu/8.2.1/../../../../include/c++/8.2.1/bits/shared_ptr_base.h:751:31\r\n #3 0x7fe7b73ec240 in std::_shared_ptr<arrow::Int32Type, (gnu_cxx::_Lock_policy)2>::_shared_ptr<std::allocator<arrow::Int32Type> >(std::_Sp_make_shared_tag, std::allocator<arrow::Int32Type> const&) /usr/bin/../lib64/gcc/x86_64-pc-linux-gnu/8.2.1/../../../../include/c++/8.2.1/bits/shared_ptr_base.h:1328:28\r\n #4 0x7fe7b73ec1c7 in std::shared_ptr<arrow::Int32Type>::shared_ptr<std::allocator<arrow::Int32Type> >(std::_Sp_make_shared_tag, std::allocator<arrow::Int32Type> const&) /usr/bin/../lib64/gcc/x86_64-pc-linux-gnu/8.2.1/../../../../include/c++/8.2.1/bits/shared_ptr.h:360:4\r\n #5 0x7fe7b73ec14b in std::shared_ptr<arrow::Int32Type> std::allocate_shared<arrow::Int32Type, std::allocator<arrow::Int32Type> >(std::allocator<arrow::Int32Type> const&) /usr/bin/../lib64/gcc/x86_64-pc-linux-gnu/8.2.1/../../../../include/c++/8.2.1/bits/shared_ptr.h:706:14\r\n #6 0x7fe7b73cd323 in std::shared_ptr<arrow::Int32Type> std::make_shared<arrow::Int32Type>() /usr/bin/../lib64/gcc/x86_64-pc-linux-gnu/8.2.1/../../../../include/c++/8.2.1/bits/shared_ptr.h:722:14\r\n #7 0x7fe7b73c3f2f in arrow::int32() /home/mvilim/repos/arrow/cpp/src/arrow/type.cc:484:1\r\n #8 0x558afa76cc8d in __cxx_global_var_init.1 /home/mvilim/repos/arrow/cpp/src/arrow/ipc/test-common.h:65:30\r\n #9 0x558afa779ef9 in GLOBAL_sub_I_array_test.cc /home/mvilim/repos/arrow/cpp/src/arrow/array-test.cc{noformat}\r\nOn creation of a Field:\r\n{noformat}\r\n#6 0x7f74f1947598 in std::shared_ptr<arrow::Field> std::make_shared<arrow::Field, std::_cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&, std::shared_ptr<arrow::DataType> const&, bool&, std::shared_ptr<arrow::KeyValueMetadata const> const&>(std::_cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&, std::shared_ptr<arrow::DataType> const&, bool&, std::shared_ptr<arrow::KeyValueMetadata const> const&) /usr/bin/../lib64/gcc/x86_64-pc-linux-gnu/8.2.1/../../../../include/c++/8.2.1/bits/shared_ptr.h:722:14\r\n #7 0x7f74f193e1e3 in arrow::field(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&, std::shared_ptr<arrow::DataType> const&, bool, std::shared_ptr<arrow::KeyValueMetadata const> const&) /home/mvilim/repos/arrow/cpp/src/arrow/type.cc:556:10\r\n #8 0x56079cb90206 in arrow::TestField_TestMetadataConstruction_Test::TestBody() /home/mvilim/repos/arrow/cpp/src/arrow/type-test.cc:68:13{noformat}\r\nOn creation of an Array:\r\n{noformat}\r\n#6 0x7f8da9f9300f in std::shared_ptr<arrow::NumericArray<arrow::Int32Type> > std::make_shared<arrow::NumericArray<arrow::Int32Type>, std::shared_ptr<arrow::ArrayData> const&>(std::shared_ptr<arrow::ArrayData> const&) /usr/bin/../lib64/gcc/x86_64-pc-linux-gnu/8.2.1/../../../../include/c++/8.2.1/bits/shared_ptr.h:722:14\r\n #7 0x7f8da9f86fc2 in arrow::Status arrow::internal::ArrayDataWrapper::Visit<arrow::Int32Type>(arrow::Int32Type const&) /home/mvilim/repos/arrow/cpp/src/arrow/array.cc:892:13\r\n #8 0x7f8da9f5a076 in arrow::Status arrow::VisitTypeInline<arrow::internal::ArrayDataWrapper>(arrow::DataType const&, arrow::internal::ArrayDataWrapper*) /home/mvilim/repos/arrow/cpp/src/arrow/visitor_inline.h:46:5\r\n #9 0x7f8da9f2f3d3 in arrow::MakeArray(std::shared_ptr<arrow::ArrayData> const&) /home/mvilim/repos/arrow/cpp/src/arrow/array.cc:905:14{noformat}\r\nGCC version is 8.2.1 20181127\r\n cmake version is 3.13.2\r\n\r\nI believe the issue is related to linking in some way (because this does not happen with static linking). It is probably my lack of experience in C++ showing, but I am unsure how to proceed in finding the cause of this issue.\r\n\r\nAny help or advice would be appreciated.",
        "customfield_10010": null,
        "customfield_12314523": null,
        "customfield_12314127": null,
        "customfield_12314522": null,
        "customfield_12314126": null,
        "customfield_12314521": null,
        "customfield_12314125": null,
        "customfield_12314520": null,
        "customfield_12314124": null,
        "customfield_12312340": null,
        "customfield_12314123": null,
        "customfield_12312341": null,
        "customfield_12312220": null,
        "customfield_12314122": null,
        "customfield_12314121": null,
        "customfield_12314120": null,
        "customfield_12314129": null,
        "customfield_12314524": null,
        "customfield_12314128": null,
        "summary": "[C++] Seg fault when running unit tests on fresh Arch Linux install",
        "customfield_12314130": null,
        "customfield_12310291": null,
        "customfield_12310290": null,
        "customfield_12314138": null,
        "customfield_12314137": null,
        "environment": "Arch Linux x86-64",
        "customfield_12314136": null,
        "customfield_12314135": null,
        "customfield_12311020": "https://github.com/apache/arrow/issues/3384",
        "customfield_12314134": null,
        "duedate": null,
        "customfield_12314132": null,
        "customfield_12314131": null,
        "customfield_12311820": "0|u00rmw:",
        "customfield_12314139": null
    }
}