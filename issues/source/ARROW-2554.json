{
    "expand": "operations,versionedRepresentations,editmeta,changelog,renderedFields",
    "id": "13157934",
    "self": "https://issues.apache.org/jira/rest/api/2/issue/13157934",
    "key": "ARROW-2554",
    "fields": {
        "fixVersions": [
            {
                "self": "https://issues.apache.org/jira/rest/api/2/version/12342562",
                "id": "12342562",
                "description": "",
                "name": "0.10.0",
                "archived": false,
                "released": true,
                "releaseDate": "2018-08-06"
            }
        ],
        "resolution": {
            "self": "https://issues.apache.org/jira/rest/api/2/resolution/1",
            "id": "1",
            "description": "A fix for this issue is checked into the tree and tested.",
            "name": "Fixed"
        },
        "customfield_12312322": null,
        "customfield_12312323": null,
        "customfield_12312320": null,
        "customfield_12310420": "9223372036854775807",
        "customfield_12312321": null,
        "customfield_12312328": null,
        "customfield_12312329": null,
        "customfield_12312326": null,
        "customfield_12310300": null,
        "customfield_12312327": null,
        "customfield_12312324": null,
        "customfield_12312720": null,
        "customfield_12312325": null,
        "lastViewed": null,
        "priority": {
            "self": "https://issues.apache.org/jira/rest/api/2/priority/3",
            "iconUrl": "https://issues.apache.org/jira/images/icons/priorities/major.svg",
            "name": "Major",
            "id": "3"
        },
        "labels": [
            "pull-request-available"
        ],
        "customfield_12312333": null,
        "customfield_12312334": null,
        "customfield_12313422": "false",
        "customfield_12310310": "0.0",
        "customfield_12312331": null,
        "customfield_12312332": null,
        "aggregatetimeoriginalestimate": null,
        "timeestimate": 0,
        "customfield_12312330": null,
        "versions": [
            {
                "self": "https://issues.apache.org/jira/rest/api/2/version/12341707",
                "id": "12341707",
                "description": "",
                "name": "0.9.0",
                "archived": false,
                "released": true,
                "releaseDate": "2018-03-19"
            }
        ],
        "customfield_12311120": null,
        "customfield_12313826": null,
        "customfield_12312339": null,
        "issuelinks": [],
        "customfield_12313825": null,
        "assignee": {
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=marco.neumann.by",
            "name": "marco.neumann.by",
            "key": "marco.neumann.by",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
            },
            "displayName": "Marco Neumann",
            "active": true,
            "timeZone": "Europe/Berlin"
        },
        "customfield_12312337": null,
        "customfield_12313823": null,
        "customfield_12312338": null,
        "customfield_12311920": null,
        "customfield_12313822": null,
        "customfield_12312335": null,
        "customfield_12313821": null,
        "customfield_12312336": null,
        "customfield_12313820": null,
        "status": {
            "self": "https://issues.apache.org/jira/rest/api/2/status/5",
            "description": "A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.",
            "iconUrl": "https://issues.apache.org/jira/images/icons/statuses/resolved.png",
            "name": "Resolved",
            "id": "5",
            "statusCategory": {
                "self": "https://issues.apache.org/jira/rest/api/2/statuscategory/3",
                "id": 3,
                "key": "done",
                "colorName": "green",
                "name": "Done"
            }
        },
        "components": [
            {
                "self": "https://issues.apache.org/jira/rest/api/2/component/12328936",
                "id": "12328936",
                "name": "Python"
            }
        ],
        "customfield_12312026": null,
        "customfield_12312023": null,
        "customfield_12312024": null,
        "aggregatetimeestimate": 0,
        "customfield_12312022": null,
        "customfield_12310921": null,
        "customfield_12310920": "9223372036854775807",
        "customfield_12312823": null,
        "creator": {
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=marco.neumann.by",
            "name": "marco.neumann.by",
            "key": "marco.neumann.by",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
            },
            "displayName": "Marco Neumann",
            "active": true,
            "timeZone": "Europe/Berlin"
        },
        "subtasks": [],
        "reporter": {
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=marco.neumann.by",
            "name": "marco.neumann.by",
            "key": "marco.neumann.by",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
            },
            "displayName": "Marco Neumann",
            "active": true,
            "timeZone": "Europe/Berlin"
        },
        "aggregateprogress": {
            "progress": 4800,
            "total": 4800,
            "percent": 100
        },
        "customfield_12313520": null,
        "customfield_12310250": null,
        "progress": {
            "progress": 4800,
            "total": 4800,
            "percent": 100
        },
        "customfield_12313924": null,
        "votes": {
            "self": "https://issues.apache.org/jira/rest/api/2/issue/ARROW-2554/votes",
            "votes": 0,
            "hasVoted": false
        },
        "worklog": {
            "startAt": 0,
            "maxResults": 20,
            "total": 8,
            "worklogs": [
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13157934/worklog/110051",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "crepererum opened a new pull request #2118: ARROW-2554: [Python] fix timestamp unit detection from python lists\nURL: https://github.com/apache/arrow/pull/2118\n \n \n   \n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2018-06-08T09:57:18.962+0000",
                    "updated": "2018-06-08T09:57:18.962+0000",
                    "started": "2018-06-08T09:57:18.962+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "110051",
                    "issueId": "13157934"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13157934/worklog/110120",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "codecov-io commented on issue #2118: ARROW-2554: [Python] fix timestamp unit detection from python lists\nURL: https://github.com/apache/arrow/pull/2118#issuecomment-395769319\n \n \n   # [Codecov](https://codecov.io/gh/apache/arrow/pull/2118?src=pr&el=h1) Report\n   > Merging [#2118](https://codecov.io/gh/apache/arrow/pull/2118?src=pr&el=desc) into [master](https://codecov.io/gh/apache/arrow/commit/e82a34a3cb30a92a5ef00cca74d054e84cee7a6c?src=pr&el=desc) will **increase** coverage by `<.01%`.\n   > The diff coverage is `100%`.\n   \n   [![Impacted file tree graph](https://codecov.io/gh/apache/arrow/pull/2118/graphs/tree.svg?height=150&token=LpTCFbqVT1&src=pr&width=650)](https://codecov.io/gh/apache/arrow/pull/2118?src=pr&el=tree)\n   \n   ```diff\n   @@            Coverage Diff             @@\n   ##           master    #2118      +/-   ##\n   ==========================================\n   + Coverage   86.35%   86.36%   +<.01%     \n   ==========================================\n     Files         230      230              \n     Lines       40513    40535      +22     \n   ==========================================\n   + Hits        34987    35008      +21     \n   - Misses       5526     5527       +1\n   ```\n   \n   \n   | [Impacted Files](https://codecov.io/gh/apache/arrow/pull/2118?src=pr&el=tree) | Coverage \u0394 | |\n   |---|---|---|\n   | [python/pyarrow/tests/test\\_array.py](https://codecov.io/gh/apache/arrow/pull/2118/diff?src=pr&el=tree#diff-cHl0aG9uL3B5YXJyb3cvdGVzdHMvdGVzdF9hcnJheS5weQ==) | `100% <100%> (\u00f8)` | :arrow_up: |\n   | [cpp/src/arrow/python/builtin\\_convert.cc](https://codecov.io/gh/apache/arrow/pull/2118/diff?src=pr&el=tree#diff-Y3BwL3NyYy9hcnJvdy9weXRob24vYnVpbHRpbl9jb252ZXJ0LmNj) | `92.1% <100%> (+0.29%)` | :arrow_up: |\n   | [cpp/src/arrow/util/thread-pool-test.cc](https://codecov.io/gh/apache/arrow/pull/2118/diff?src=pr&el=tree#diff-Y3BwL3NyYy9hcnJvdy91dGlsL3RocmVhZC1wb29sLXRlc3QuY2M=) | `98.91% <0%> (-0.55%)` | :arrow_down: |\n   \n   ------\n   \n   [Continue to review full report at Codecov](https://codecov.io/gh/apache/arrow/pull/2118?src=pr&el=continue).\n   > **Legend** - [Click here to learn more](https://docs.codecov.io/docs/codecov-delta)\n   > `\u0394 = absolute <relative> (impact)`, `\u00f8 = not affected`, `? = missing data`\n   > Powered by [Codecov](https://codecov.io/gh/apache/arrow/pull/2118?src=pr&el=footer). Last update [e82a34a...b3ab6e1](https://codecov.io/gh/apache/arrow/pull/2118?src=pr&el=lastupdated). Read the [comment docs](https://docs.codecov.io/docs/pull-request-comments).\n   \n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2018-06-08T13:59:10.039+0000",
                    "updated": "2018-06-08T13:59:10.039+0000",
                    "started": "2018-06-08T13:59:10.039+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "110120",
                    "issueId": "13157934"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13157934/worklog/110184",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "xhochy commented on a change in pull request #2118: ARROW-2554: [Python] fix timestamp unit detection from python lists\nURL: https://github.com/apache/arrow/pull/2118#discussion_r194130952\n \n \n\n ##########\n File path: cpp/src/arrow/python/builtin_convert.cc\n ##########\n @@ -107,7 +110,16 @@ class TypeInferrer {\n       } else if (is_floating(type->id())) {\n         ++float_count_;\n       } else if (type->id() == Type::TIMESTAMP) {\n-        ++timestamp_count_;\n+        auto type2 = std::dynamic_pointer_cast<TimestampType>(type);\n \n Review comment:\n   Use `checked_cast<TimestampType&>(*type)` here to avoid increasing the reference counter. (`checked_cast` is an Arrow-defined cast that evaluates to `dynamic_cast` in debug builds, otherwise it's a `static_cast`).\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2018-06-08T17:39:59.847+0000",
                    "updated": "2018-06-08T17:39:59.847+0000",
                    "started": "2018-06-08T17:39:59.847+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "110184",
                    "issueId": "13157934"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13157934/worklog/110255",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "wesm commented on a change in pull request #2118: ARROW-2554: [Python] fix timestamp unit detection from python lists\nURL: https://github.com/apache/arrow/pull/2118#discussion_r194168350\n \n \n\n ##########\n File path: cpp/src/arrow/python/builtin_convert.cc\n ##########\n @@ -107,7 +110,16 @@ class TypeInferrer {\n       } else if (is_floating(type->id())) {\n         ++float_count_;\n       } else if (type->id() == Type::TIMESTAMP) {\n-        ++timestamp_count_;\n+        auto type2 = std::dynamic_pointer_cast<TimestampType>(type);\n \n Review comment:\n   If you do that, make sure to use `const auto&` otherwise I believe the copy constructor will still be invoked\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2018-06-08T20:08:52.476+0000",
                    "updated": "2018-06-08T20:08:52.476+0000",
                    "started": "2018-06-08T20:08:52.476+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "110255",
                    "issueId": "13157934"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13157934/worklog/110259",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "wesm commented on a change in pull request #2118: ARROW-2554: [Python] fix timestamp unit detection from python lists\nURL: https://github.com/apache/arrow/pull/2118#discussion_r194169741\n \n \n\n ##########\n File path: cpp/src/arrow/python/builtin_convert.cc\n ##########\n @@ -107,7 +110,16 @@ class TypeInferrer {\n       } else if (is_floating(type->id())) {\n         ++float_count_;\n       } else if (type->id() == Type::TIMESTAMP) {\n-        ++timestamp_count_;\n+        auto type2 = std::dynamic_pointer_cast<TimestampType>(type);\n+        if (type2->unit() == TimeUnit::NANO) {\n+          ++timestamp_nano_count_;\n+        } else if (type2->unit() == TimeUnit::MICRO) {\n+          ++timestamp_micro_count_;\n+        } else if (type2->unit() == TimeUnit::MILLI) {\n+          ++timestamp_milli_count_;\n+        } else if (type2->unit() == TimeUnit::SECOND) {\n+          ++timestamp_second_count_;\n+        }\n \n Review comment:\n   If the scalar type is some other unit (or unitless? can't remember how we're handling that at the moment) then you should raise in an `else` branch\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2018-06-08T20:16:14.572+0000",
                    "updated": "2018-06-08T20:16:14.572+0000",
                    "started": "2018-06-08T20:16:14.572+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "110259",
                    "issueId": "13157934"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13157934/worklog/110523",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "codecov-io commented on issue #2118: ARROW-2554: [Python] fix timestamp unit detection from python lists\nURL: https://github.com/apache/arrow/pull/2118#issuecomment-395769319\n \n \n   # [Codecov](https://codecov.io/gh/apache/arrow/pull/2118?src=pr&el=h1) Report\n   > Merging [#2118](https://codecov.io/gh/apache/arrow/pull/2118?src=pr&el=desc) into [master](https://codecov.io/gh/apache/arrow/commit/6df28d35711ec15e56b4cd2428036964c25e296d?src=pr&el=desc) will **decrease** coverage by `0.01%`.\n   > The diff coverage is `96%`.\n   \n   [![Impacted file tree graph](https://codecov.io/gh/apache/arrow/pull/2118/graphs/tree.svg?width=650&height=150&src=pr&token=LpTCFbqVT1)](https://codecov.io/gh/apache/arrow/pull/2118?src=pr&el=tree)\n   \n   ```diff\n   @@            Coverage Diff             @@\n   ##           master    #2118      +/-   ##\n   ==========================================\n   - Coverage   86.39%   86.38%   -0.02%     \n   ==========================================\n     Files         242      230      -12     \n     Lines       41481    40611     -870     \n   ==========================================\n   - Hits        35838    35080     -758     \n   + Misses       5643     5531     -112\n   ```\n   \n   \n   | [Impacted Files](https://codecov.io/gh/apache/arrow/pull/2118?src=pr&el=tree) | Coverage \u0394 | |\n   |---|---|---|\n   | [python/pyarrow/tests/test\\_array.py](https://codecov.io/gh/apache/arrow/pull/2118/diff?src=pr&el=tree#diff-cHl0aG9uL3B5YXJyb3cvdGVzdHMvdGVzdF9hcnJheS5weQ==) | `100% <100%> (\u00f8)` | :arrow_up: |\n   | [cpp/src/arrow/python/builtin\\_convert.cc](https://codecov.io/gh/apache/arrow/pull/2118/diff?src=pr&el=tree#diff-Y3BwL3NyYy9hcnJvdy9weXRob24vYnVpbHRpbl9jb252ZXJ0LmNj) | `91.86% <94.44%> (+0.05%)` | :arrow_up: |\n   | [rust/src/memory.rs](https://codecov.io/gh/apache/arrow/pull/2118/diff?src=pr&el=tree#diff-cnVzdC9zcmMvbWVtb3J5LnJz) | | |\n   | [rust/src/builder.rs](https://codecov.io/gh/apache/arrow/pull/2118/diff?src=pr&el=tree#diff-cnVzdC9zcmMvYnVpbGRlci5ycw==) | | |\n   | [rust/src/list.rs](https://codecov.io/gh/apache/arrow/pull/2118/diff?src=pr&el=tree#diff-cnVzdC9zcmMvbGlzdC5ycw==) | | |\n   | [rust/src/error.rs](https://codecov.io/gh/apache/arrow/pull/2118/diff?src=pr&el=tree#diff-cnVzdC9zcmMvZXJyb3IucnM=) | | |\n   | [rust/src/record\\_batch.rs](https://codecov.io/gh/apache/arrow/pull/2118/diff?src=pr&el=tree#diff-cnVzdC9zcmMvcmVjb3JkX2JhdGNoLnJz) | | |\n   | [rust/src/array.rs](https://codecov.io/gh/apache/arrow/pull/2118/diff?src=pr&el=tree#diff-cnVzdC9zcmMvYXJyYXkucnM=) | | |\n   | [rust/src/memory\\_pool.rs](https://codecov.io/gh/apache/arrow/pull/2118/diff?src=pr&el=tree#diff-cnVzdC9zcmMvbWVtb3J5X3Bvb2wucnM=) | | |\n   | [rust/src/buffer.rs](https://codecov.io/gh/apache/arrow/pull/2118/diff?src=pr&el=tree#diff-cnVzdC9zcmMvYnVmZmVyLnJz) | | |\n   | ... and [4 more](https://codecov.io/gh/apache/arrow/pull/2118/diff?src=pr&el=tree-more) | |\n   \n   ------\n   \n   [Continue to review full report at Codecov](https://codecov.io/gh/apache/arrow/pull/2118?src=pr&el=continue).\n   > **Legend** - [Click here to learn more](https://docs.codecov.io/docs/codecov-delta)\n   > `\u0394 = absolute <relative> (impact)`, `\u00f8 = not affected`, `? = missing data`\n   > Powered by [Codecov](https://codecov.io/gh/apache/arrow/pull/2118?src=pr&el=footer). Last update [6df28d3...850765e](https://codecov.io/gh/apache/arrow/pull/2118?src=pr&el=lastupdated). Read the [comment docs](https://docs.codecov.io/docs/pull-request-comments).\n   \n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2018-06-11T08:01:54.335+0000",
                    "updated": "2018-06-11T08:01:54.335+0000",
                    "started": "2018-06-11T08:01:54.334+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "110523",
                    "issueId": "13157934"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13157934/worklog/111816",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "crepererum commented on issue #2118: ARROW-2554: [Python] fix timestamp unit detection from python lists\nURL: https://github.com/apache/arrow/pull/2118#issuecomment-397219394\n \n \n   @xhochy ready :)\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2018-06-14T08:45:36.326+0000",
                    "updated": "2018-06-14T08:45:36.326+0000",
                    "started": "2018-06-14T08:45:36.325+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "111816",
                    "issueId": "13157934"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13157934/worklog/111856",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "xhochy closed pull request #2118: ARROW-2554: [Python] fix timestamp unit detection from python lists\nURL: https://github.com/apache/arrow/pull/2118\n \n \n   \n\nThis is a PR merged from a forked repository.\nAs GitHub hides the original diff on merge, it is displayed below for\nthe sake of provenance:\n\nAs this is a foreign pull request (from a fork), the diff is supplied\nbelow (as it won't show otherwise due to GitHub magic):\n\ndiff --git a/cpp/src/arrow/python/builtin_convert.cc b/cpp/src/arrow/python/builtin_convert.cc\nindex dc0ae8c886..49f2b31ab4 100644\n--- a/cpp/src/arrow/python/builtin_convert.cc\n+++ b/cpp/src/arrow/python/builtin_convert.cc\n@@ -62,7 +62,10 @@ class TypeInferrer {\n         bool_count_(0),\n         int_count_(0),\n         date_count_(0),\n-        timestamp_count_(0),\n+        timestamp_second_count_(0),\n+        timestamp_milli_count_(0),\n+        timestamp_micro_count_(0),\n+        timestamp_nano_count_(0),\n         float_count_(0),\n         binary_count_(0),\n         unicode_count_(0),\n@@ -94,7 +97,7 @@ class TypeInferrer {\n     } else if (PyDate_CheckExact(obj)) {\n       ++date_count_;\n     } else if (PyDateTime_CheckExact(obj)) {\n-      ++timestamp_count_;\n+      ++timestamp_micro_count_;\n     } else if (internal::IsPyBinary(obj)) {\n       ++binary_count_;\n     } else if (PyUnicode_Check(obj)) {\n@@ -107,7 +110,18 @@ class TypeInferrer {\n       } else if (is_floating(type->id())) {\n         ++float_count_;\n       } else if (type->id() == Type::TIMESTAMP) {\n-        ++timestamp_count_;\n+        const auto& type2 = checked_cast<TimestampType&>(*type);\n+        if (type2.unit() == TimeUnit::NANO) {\n+          ++timestamp_nano_count_;\n+        } else if (type2.unit() == TimeUnit::MICRO) {\n+          ++timestamp_micro_count_;\n+        } else if (type2.unit() == TimeUnit::MILLI) {\n+          ++timestamp_milli_count_;\n+        } else if (type2.unit() == TimeUnit::SECOND) {\n+          ++timestamp_second_count_;\n+        } else {\n+          throw std::runtime_error(\"Unknown unit of TimestampType\");\n+        }\n       } else {\n         std::ostringstream ss;\n         ss << \"Found a NumPy scalar with Arrow dtype that we cannot handle: \";\n@@ -168,8 +182,14 @@ class TypeInferrer {\n       return int64();\n     } else if (date_count_) {\n       return date64();\n-    } else if (timestamp_count_) {\n+    } else if (timestamp_nano_count_) {\n+      return timestamp(TimeUnit::NANO);\n+    } else if (timestamp_micro_count_) {\n       return timestamp(TimeUnit::MICRO);\n+    } else if (timestamp_milli_count_) {\n+      return timestamp(TimeUnit::MILLI);\n+    } else if (timestamp_second_count_) {\n+      return timestamp(TimeUnit::SECOND);\n     } else if (bool_count_) {\n       return boolean();\n     } else if (binary_count_) {\n@@ -236,7 +256,10 @@ class TypeInferrer {\n   int64_t bool_count_;\n   int64_t int_count_;\n   int64_t date_count_;\n-  int64_t timestamp_count_;\n+  int64_t timestamp_second_count_;\n+  int64_t timestamp_milli_count_;\n+  int64_t timestamp_micro_count_;\n+  int64_t timestamp_nano_count_;\n   int64_t float_count_;\n   int64_t binary_count_;\n   int64_t unicode_count_;\ndiff --git a/python/pyarrow/tests/test_array.py b/python/pyarrow/tests/test_array.py\nindex f30203c349..a0b1a51a6b 100644\n--- a/python/pyarrow/tests/test_array.py\n+++ b/python/pyarrow/tests/test_array.py\n@@ -877,3 +877,14 @@ def test_nested_dictionary_array():\n     dict_arr = pa.DictionaryArray.from_arrays([0, 1, 0], ['a', 'b'])\n     dict_arr2 = pa.DictionaryArray.from_arrays([0, 1, 2, 1, 0], dict_arr)\n     assert dict_arr2.to_pylist() == ['a', 'b', 'a', 'b', 'a']\n+\n+\n+@pytest.mark.parametrize('unit', ['ns', 'us', 'ms', 's'])\n+def test_timestamp_units_from_list(unit):\n+    x = np.datetime64('2017-01-01 01:01:01.111111111', unit)\n+    a1 = pa.array([x])\n+    a2 = pa.array([x], type=pa.timestamp(unit))\n+\n+    assert a1.type == a2.type\n+    assert a1.type.unit == unit\n+    assert a1[0] == a2[0]\n\n\n \n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2018-06-14T12:21:26.531+0000",
                    "updated": "2018-06-14T12:21:26.531+0000",
                    "started": "2018-06-14T12:21:26.531+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "111856",
                    "issueId": "13157934"
                }
            ]
        },
        "customfield_12313920": null,
        "issuetype": {
            "self": "https://issues.apache.org/jira/rest/api/2/issuetype/1",
            "id": "1",
            "description": "A problem which impairs or prevents the functions of the product.",
            "iconUrl": "https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype",
            "name": "Bug",
            "subtask": false,
            "avatarId": 21133
        },
        "timespent": 4800,
        "customfield_12314020": "{summaryBean=com.atlassian.jira.plugin.devstatus.rest.SummaryBean@52a6c29a[summary={pullrequest=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@4e8aab45[overall=PullRequestOverallBean{stateCount=0, state='OPEN', details=PullRequestOverallDetails{openCount=0, mergedCount=0, declinedCount=0}},byInstanceType={}], build=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@4532fd0[overall=com.atlassian.jira.plugin.devstatus.summary.beans.BuildOverallBean@1f186c9c[failedBuildCount=0,successfulBuildCount=0,unknownBuildCount=0,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], review=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@229fccbc[overall=com.atlassian.jira.plugin.devstatus.summary.beans.ReviewsOverallBean@6e4c1474[stateCount=0,state=<null>,dueDate=<null>,overDue=false,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], deployment-environment=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@737c9bc2[overall=com.atlassian.jira.plugin.devstatus.summary.beans.DeploymentOverallBean@2fdc65bd[topEnvironments=[],showProjects=false,successfulCount=0,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], repository=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@737aa6d6[overall=com.atlassian.jira.plugin.devstatus.summary.beans.CommitOverallBean@7d9be379[count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], branch=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@6aaed583[overall=com.atlassian.jira.plugin.devstatus.summary.beans.BranchOverallBean@2613a4e6[count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}]},errors=[],configErrors=[]], devSummaryJson={\"cachedValue\":{\"errors\":[],\"configErrors\":[],\"summary\":{\"pullrequest\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"stateCount\":0,\"state\":\"OPEN\",\"details\":{\"openCount\":0,\"mergedCount\":0,\"declinedCount\":0,\"total\":0},\"open\":true},\"byInstanceType\":{}},\"build\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"failedBuildCount\":0,\"successfulBuildCount\":0,\"unknownBuildCount\":0},\"byInstanceType\":{}},\"review\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"stateCount\":0,\"state\":null,\"dueDate\":null,\"overDue\":false,\"completed\":false},\"byInstanceType\":{}},\"deployment-environment\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"topEnvironments\":[],\"showProjects\":false,\"successfulCount\":0},\"byInstanceType\":{}},\"repository\":{\"overall\":{\"count\":0,\"lastUpdated\":null},\"byInstanceType\":{}},\"branch\":{\"overall\":{\"count\":0,\"lastUpdated\":null},\"byInstanceType\":{}}}},\"isStale\":false}}",
        "customfield_12314141": null,
        "customfield_12314140": null,
        "project": {
            "self": "https://issues.apache.org/jira/rest/api/2/project/12319525",
            "id": "12319525",
            "key": "ARROW",
            "name": "Apache Arrow",
            "projectTypeKey": "software",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/projectavatar?pid=12319525&avatarId=10011",
                "24x24": "https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12319525&avatarId=10011",
                "16x16": "https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12319525&avatarId=10011",
                "32x32": "https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12319525&avatarId=10011"
            },
            "projectCategory": {
                "self": "https://issues.apache.org/jira/rest/api/2/projectCategory/13960",
                "id": "13960",
                "description": "Apache Arrow",
                "name": "Arrow"
            }
        },
        "aggregatetimespent": 4800,
        "customfield_12312520": null,
        "customfield_12312521": "Thu Jun 14 12:21:24 UTC 2018",
        "customfield_12314422": null,
        "customfield_12314421": null,
        "customfield_12314146": null,
        "customfield_12314420": null,
        "customfield_12314145": null,
        "customfield_12314144": null,
        "customfield_12314143": null,
        "resolutiondate": "2018-06-14T12:21:24.000+0000",
        "workratio": -1,
        "customfield_12312923": null,
        "customfield_12312920": null,
        "customfield_12312921": null,
        "watches": {
            "self": "https://issues.apache.org/jira/rest/api/2/issue/ARROW-2554/watchers",
            "watchCount": 1,
            "isWatching": false
        },
        "created": "2018-05-08T15:51:00.000+0000",
        "updated": "2018-06-14T12:21:26.000+0000",
        "timeoriginalestimate": null,
        "description": "The following fails:\r\n{noformat}\r\nimport pandas as pd\r\nimport pyarrow as pa\r\n\r\npa.array([pd.Timestamp('now').to_datetime64()])\r\n{noformat}\r\n\r\nwith {{ArrowNotImplementedError: Cannot convert NumPy datetime64 objects with differing unit}}, but when you provide the correct type information directly, it works:\r\n\r\n{noformat}\r\nimport pandas as pd\r\nimport pyarrow as pa\r\n\r\npa.array([pd.Timestamp('now').to_datetime64()], type=pa.timestamp('ns'))\r\n{noformat}",
        "customfield_10010": null,
        "timetracking": {
            "remainingEstimate": "0h",
            "timeSpent": "1h 20m",
            "remainingEstimateSeconds": 0,
            "timeSpentSeconds": 4800
        },
        "customfield_12314523": null,
        "customfield_12314127": null,
        "customfield_12314522": null,
        "customfield_12314126": null,
        "customfield_12314521": null,
        "customfield_12314125": null,
        "customfield_12314520": null,
        "customfield_12314124": null,
        "attachment": [],
        "customfield_12312340": null,
        "customfield_12314123": null,
        "customfield_12312341": null,
        "customfield_12312220": null,
        "customfield_12314122": null,
        "customfield_12314121": null,
        "customfield_12314120": null,
        "customfield_12314129": null,
        "customfield_12314524": null,
        "customfield_12314128": null,
        "summary": "pa.array type inference bug when using NS-timestamp",
        "customfield_12314130": null,
        "customfield_12310291": null,
        "customfield_12310290": null,
        "customfield_12314138": null,
        "customfield_12314137": null,
        "environment": null,
        "customfield_12314136": null,
        "customfield_12314135": null,
        "customfield_12311020": null,
        "customfield_12314134": null,
        "duedate": null,
        "customfield_12314132": null,
        "customfield_12314131": null,
        "comment": {
            "comments": [
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13157934/comment/16512391",
                    "id": "16512391",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=uwe",
                        "name": "uwe",
                        "key": "xhochy",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=xhochy&avatarId=30652",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=xhochy&avatarId=30652",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=xhochy&avatarId=30652",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=xhochy&avatarId=30652"
                        },
                        "displayName": "Uwe Korn",
                        "active": true,
                        "timeZone": "Europe/Berlin"
                    },
                    "body": "Issue resolved by pull request 2118\n[https://github.com/apache/arrow/pull/2118]",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=uwe",
                        "name": "uwe",
                        "key": "xhochy",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=xhochy&avatarId=30652",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=xhochy&avatarId=30652",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=xhochy&avatarId=30652",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=xhochy&avatarId=30652"
                        },
                        "displayName": "Uwe Korn",
                        "active": true,
                        "timeZone": "Europe/Berlin"
                    },
                    "created": "2018-06-14T12:21:24.777+0000",
                    "updated": "2018-06-14T12:21:24.777+0000"
                }
            ],
            "maxResults": 1,
            "total": 1,
            "startAt": 0
        },
        "customfield_12311820": "0|i3th5z:",
        "customfield_12314139": null
    }
}