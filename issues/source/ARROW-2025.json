{
    "expand": "operations,versionedRepresentations,editmeta,changelog,renderedFields",
    "id": "13133437",
    "self": "https://issues.apache.org/jira/rest/api/2/issue/13133437",
    "key": "ARROW-2025",
    "fields": {
        "fixVersions": [
            {
                "self": "https://issues.apache.org/jira/rest/api/2/version/12341707",
                "id": "12341707",
                "description": "",
                "name": "0.9.0",
                "archived": false,
                "released": true,
                "releaseDate": "2018-03-19"
            }
        ],
        "resolution": {
            "self": "https://issues.apache.org/jira/rest/api/2/resolution/1",
            "id": "1",
            "description": "A fix for this issue is checked into the tree and tested.",
            "name": "Fixed"
        },
        "customfield_12312322": null,
        "customfield_12312323": null,
        "customfield_12312320": null,
        "customfield_12310420": "9223372036854775807",
        "customfield_12312321": null,
        "customfield_12312328": null,
        "customfield_12312329": null,
        "customfield_12312326": null,
        "customfield_12310300": null,
        "customfield_12312327": null,
        "customfield_12312324": null,
        "customfield_12312720": null,
        "customfield_12312325": null,
        "lastViewed": null,
        "priority": {
            "self": "https://issues.apache.org/jira/rest/api/2/priority/3",
            "iconUrl": "https://issues.apache.org/jira/images/icons/priorities/major.svg",
            "name": "Major",
            "id": "3"
        },
        "labels": [
            "pull-request-available"
        ],
        "customfield_12312333": null,
        "customfield_12312334": null,
        "customfield_12313422": "false",
        "customfield_12310310": "0.0",
        "customfield_12312331": null,
        "customfield_12312332": null,
        "aggregatetimeoriginalestimate": null,
        "timeestimate": null,
        "customfield_12312330": null,
        "versions": [],
        "customfield_12311120": null,
        "customfield_12313826": null,
        "customfield_12312339": null,
        "issuelinks": [],
        "customfield_12313825": null,
        "assignee": {
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=jim.crist",
            "name": "jim.crist",
            "key": "jim.crist",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=jim.crist&avatarId=33449",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jim.crist&avatarId=33449",
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jim.crist&avatarId=33449",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jim.crist&avatarId=33449"
            },
            "displayName": "Jim Crist",
            "active": true,
            "timeZone": "Etc/UTC"
        },
        "customfield_12312337": null,
        "customfield_12313823": null,
        "customfield_12312338": null,
        "customfield_12311920": null,
        "customfield_12313822": null,
        "customfield_12312335": null,
        "customfield_12313821": null,
        "customfield_12312336": null,
        "customfield_12313820": null,
        "status": {
            "self": "https://issues.apache.org/jira/rest/api/2/status/5",
            "description": "A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.",
            "iconUrl": "https://issues.apache.org/jira/images/icons/statuses/resolved.png",
            "name": "Resolved",
            "id": "5",
            "statusCategory": {
                "self": "https://issues.apache.org/jira/rest/api/2/statuscategory/3",
                "id": 3,
                "key": "done",
                "colorName": "green",
                "name": "Done"
            }
        },
        "components": [
            {
                "self": "https://issues.apache.org/jira/rest/api/2/component/12328935",
                "id": "12328935",
                "name": "C++"
            },
            {
                "self": "https://issues.apache.org/jira/rest/api/2/component/12328936",
                "id": "12328936",
                "name": "Python"
            }
        ],
        "customfield_12312026": null,
        "customfield_12312023": null,
        "customfield_12312024": null,
        "aggregatetimeestimate": null,
        "customfield_12312022": null,
        "customfield_12310921": null,
        "customfield_12310920": "9223372036854775807",
        "customfield_12312823": null,
        "creator": {
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=jim.crist",
            "name": "jim.crist",
            "key": "jim.crist",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=jim.crist&avatarId=33449",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jim.crist&avatarId=33449",
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jim.crist&avatarId=33449",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jim.crist&avatarId=33449"
            },
            "displayName": "Jim Crist",
            "active": true,
            "timeZone": "Etc/UTC"
        },
        "subtasks": [],
        "reporter": {
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=jim.crist",
            "name": "jim.crist",
            "key": "jim.crist",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=jim.crist&avatarId=33449",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jim.crist&avatarId=33449",
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jim.crist&avatarId=33449",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jim.crist&avatarId=33449"
            },
            "displayName": "Jim Crist",
            "active": true,
            "timeZone": "Etc/UTC"
        },
        "aggregateprogress": {
            "progress": 0,
            "total": 0
        },
        "customfield_12313520": null,
        "customfield_12310250": null,
        "progress": {
            "progress": 0,
            "total": 0
        },
        "customfield_12313924": null,
        "votes": {
            "self": "https://issues.apache.org/jira/rest/api/2/issue/ARROW-2025/votes",
            "votes": 0,
            "hasVoted": false
        },
        "worklog": {
            "startAt": 0,
            "maxResults": 20,
            "total": 0,
            "worklogs": []
        },
        "customfield_12313920": null,
        "issuetype": {
            "self": "https://issues.apache.org/jira/rest/api/2/issuetype/1",
            "id": "1",
            "description": "A problem which impairs or prevents the functions of the product.",
            "iconUrl": "https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype",
            "name": "Bug",
            "subtask": false,
            "avatarId": 21133
        },
        "timespent": null,
        "customfield_12314020": "{summaryBean=com.atlassian.jira.plugin.devstatus.rest.SummaryBean@4da57451[summary={pullrequest=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@4f6396f5[overall=PullRequestOverallBean{stateCount=0, state='OPEN', details=PullRequestOverallDetails{openCount=0, mergedCount=0, declinedCount=0}},byInstanceType={}], build=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@2bdc9e22[overall=com.atlassian.jira.plugin.devstatus.summary.beans.BuildOverallBean@785b7192[failedBuildCount=0,successfulBuildCount=0,unknownBuildCount=0,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], review=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@7b47f198[overall=com.atlassian.jira.plugin.devstatus.summary.beans.ReviewsOverallBean@5d3d8e64[stateCount=0,state=<null>,dueDate=<null>,overDue=false,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], deployment-environment=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@12df366f[overall=com.atlassian.jira.plugin.devstatus.summary.beans.DeploymentOverallBean@31ab0247[topEnvironments=[],showProjects=false,successfulCount=0,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], repository=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@7524eedb[overall=com.atlassian.jira.plugin.devstatus.summary.beans.CommitOverallBean@445b10b5[count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], branch=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@2fdc2a1f[overall=com.atlassian.jira.plugin.devstatus.summary.beans.BranchOverallBean@468cac99[count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}]},errors=[],configErrors=[]], devSummaryJson={\"cachedValue\":{\"errors\":[],\"configErrors\":[],\"summary\":{\"pullrequest\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"stateCount\":0,\"state\":\"OPEN\",\"details\":{\"openCount\":0,\"mergedCount\":0,\"declinedCount\":0,\"total\":0},\"open\":true},\"byInstanceType\":{}},\"build\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"failedBuildCount\":0,\"successfulBuildCount\":0,\"unknownBuildCount\":0},\"byInstanceType\":{}},\"review\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"stateCount\":0,\"state\":null,\"dueDate\":null,\"overDue\":false,\"completed\":false},\"byInstanceType\":{}},\"deployment-environment\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"topEnvironments\":[],\"showProjects\":false,\"successfulCount\":0},\"byInstanceType\":{}},\"repository\":{\"overall\":{\"count\":0,\"lastUpdated\":null},\"byInstanceType\":{}},\"branch\":{\"overall\":{\"count\":0,\"lastUpdated\":null},\"byInstanceType\":{}}}},\"isStale\":false}}",
        "customfield_12314141": null,
        "customfield_12314140": null,
        "project": {
            "self": "https://issues.apache.org/jira/rest/api/2/project/12319525",
            "id": "12319525",
            "key": "ARROW",
            "name": "Apache Arrow",
            "projectTypeKey": "software",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/projectavatar?pid=12319525&avatarId=10011",
                "24x24": "https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12319525&avatarId=10011",
                "16x16": "https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12319525&avatarId=10011",
                "32x32": "https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12319525&avatarId=10011"
            },
            "projectCategory": {
                "self": "https://issues.apache.org/jira/rest/api/2/projectCategory/13960",
                "id": "13960",
                "description": "Apache Arrow",
                "name": "Arrow"
            }
        },
        "aggregatetimespent": null,
        "customfield_12312520": null,
        "customfield_12312521": "Thu Jan 25 01:33:17 UTC 2018",
        "customfield_12314422": null,
        "customfield_12314421": null,
        "customfield_12314146": null,
        "customfield_12314420": null,
        "customfield_12314145": null,
        "customfield_12314144": null,
        "customfield_12314143": null,
        "resolutiondate": "2018-01-25T01:33:14.000+0000",
        "workratio": -1,
        "customfield_12312923": null,
        "customfield_12312920": null,
        "customfield_12312921": null,
        "watches": {
            "self": "https://issues.apache.org/jira/rest/api/2/issue/ARROW-2025/watchers",
            "watchCount": 2,
            "isWatching": false
        },
        "created": "2018-01-24T17:14:54.000+0000",
        "updated": "2018-01-25T01:33:17.000+0000",
        "timeoriginalestimate": null,
        "description": "In the python library, if an instance of `HadoopFileSystem` is garbage collected, all other existing instances become invalid. I haven't checked with a C++ only example, but from reading the cython code I can't see how cython is responsible, so I think this is a bug in the C++ library.\r\n\r\n\u00a0\r\n{code:java}\r\n>>> import pyarrow as pa\r\n>>> h = pa.hdfs.connect()\r\n18/01/24 16:54:25 WARN util.NativeCodeLoader: Unable to load native-hadoop library for your platform... using builtin-java classes where applicable\r\n18/01/24 16:54:26 WARN shortcircuit.DomainSocketFactory: The short-circuit local reads feature cannot be used because libhadoop cannot be loaded.\r\n>>> h.ls(\"/\")\r\n['/benchmarks', '/hbase', '/tmp', '/user', '/var']\r\n>>> h2 = pa.hdfs.connect()\r\n>>> del h  # close one client\r\n>>> h2.ls(\"/\")  # all filesystem operations now fail\r\nhdfsListDirectory(/): FileSystem#listStatus error:\r\nIOException: Filesystem closedjava.io.IOException: Filesystem closed\r\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 at org.apache.hadoop.hdfs.DFSClient.checkOpen(DFSClient.java:865)\r\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 at org.apache.hadoop.hdfs.DFSClient.listPaths(DFSClient.java:2106)\r\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 at org.apache.hadoop.hdfs.DFSClient.listPaths(DFSClient.java:2092)\r\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 at org.apache.hadoop.hdfs.DistributedFileSystem.listStatusInternal(DistributedFileSystem.java:743)\r\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 at org.apache.hadoop.hdfs.DistributedFileSystem.access$600(DistributedFileSystem.java:113)\r\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 at org.apache.hadoop.hdfs.DistributedFileSystem$16.doCall(DistributedFileSystem.java:808)\r\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 at org.apache.hadoop.hdfs.DistributedFileSystem$16.doCall(DistributedFileSystem.java:804)\r\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 at org.apache.hadoop.fs.FileSystemLinkResolver.resolve(FileSystemLinkResolver.java:81)\r\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 at org.apache.hadoop.hdfs.DistributedFileSystem.listStatus(DistributedFileSystem.java:804)\r\nTraceback (most recent call last):\r\n\u00a0 File \"<stdin>\", line 1, in <module>\r\n\u00a0 File \"/opt/conda/lib/python3.6/site-packages/pyarrow/hdfs.py\", line 88, in ls\r\n\u00a0\u00a0\u00a0 return super(HadoopFileSystem, self).ls(path, detail)\r\n\u00a0 File \"io-hdfs.pxi\", line 248, in pyarrow.lib.HadoopFileSystem.ls\r\n\u00a0 File \"error.pxi\", line 79, in pyarrow.lib.check_status\r\npyarrow.lib.ArrowIOError: HDFS: list directory failed\r\n>>> h2.is_open  # The python object still thinks it's open\r\nTrue\r\n{code}",
        "customfield_10010": null,
        "timetracking": {},
        "customfield_12314523": null,
        "customfield_12314127": null,
        "customfield_12314522": null,
        "customfield_12314126": null,
        "customfield_12314521": null,
        "customfield_12314125": null,
        "customfield_12314520": null,
        "customfield_12314124": null,
        "attachment": [],
        "customfield_12312340": null,
        "customfield_12314123": null,
        "customfield_12312341": null,
        "customfield_12312220": null,
        "customfield_12314122": null,
        "customfield_12314121": null,
        "customfield_12314120": null,
        "customfield_12314129": null,
        "customfield_12314524": null,
        "customfield_12314128": null,
        "summary": "[Python/C++] HDFS Client disconnect closes all open clients",
        "customfield_12314130": null,
        "customfield_12310291": null,
        "customfield_12310290": null,
        "customfield_12314138": null,
        "customfield_12314137": null,
        "environment": null,
        "customfield_12314136": null,
        "customfield_12314135": null,
        "customfield_12311020": null,
        "customfield_12314134": null,
        "duedate": null,
        "customfield_12314132": null,
        "customfield_12314131": null,
        "comment": {
            "comments": [
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13133437/comment/16337932",
                    "id": "16337932",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=jim.crist",
                        "name": "jim.crist",
                        "key": "jim.crist",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=jim.crist&avatarId=33449",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jim.crist&avatarId=33449",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jim.crist&avatarId=33449",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jim.crist&avatarId=33449"
                        },
                        "displayName": "Jim Crist",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "body": "Looking closer, I think this may be due to the libhdfs fs cache. From [https://hadoop.apache.org/docs/stable/hadoop-project-dist/hadoop-hdfs/LibHdfs.html:]\r\n\r\n\u00a0\r\n\r\n> The Hadoop FS implementation includes an FS handle cache which caches based on the URI of the namenode along with the user connecting. So, all calls to {{hdfsConnect}} will return the same handle but calls to {{hdfsConnectAsUser}} with different users will return different handles. But, since HDFS client handles are completely thread safe, this has no bearing on concurrency.\r\n\r\n\u00a0\r\n\r\nGiven this, I think we need to refcount on handles somehow, otherwise calling disconnect on an equivalent filesystem handle will close for all of them.",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=jim.crist",
                        "name": "jim.crist",
                        "key": "jim.crist",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=jim.crist&avatarId=33449",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jim.crist&avatarId=33449",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jim.crist&avatarId=33449",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jim.crist&avatarId=33449"
                        },
                        "displayName": "Jim Crist",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "created": "2018-01-24T17:31:03.618+0000",
                    "updated": "2018-01-24T17:31:03.618+0000"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13133437/comment/16337955",
                    "id": "16337955",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=jim.crist",
                        "name": "jim.crist",
                        "key": "jim.crist",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=jim.crist&avatarId=33449",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jim.crist&avatarId=33449",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jim.crist&avatarId=33449",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jim.crist&avatarId=33449"
                        },
                        "displayName": "Jim Crist",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "body": "Actually, we should just use `hdfsBuilderSetForceNewInstance` to prevent this cacheing. Users can cache on their own as needed.",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=jim.crist",
                        "name": "jim.crist",
                        "key": "jim.crist",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=jim.crist&avatarId=33449",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jim.crist&avatarId=33449",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jim.crist&avatarId=33449",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jim.crist&avatarId=33449"
                        },
                        "displayName": "Jim Crist",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "created": "2018-01-24T17:41:49.984+0000",
                    "updated": "2018-01-24T17:41:49.984+0000"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13133437/comment/16338030",
                    "id": "16338030",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "body": "jcrist opened a new pull request #1499: ARROW-2025: [C++] Creating multiple equivalent `HadoopFileSystem`s works fine\nURL: https://github.com/apache/arrow/pull/1499\n \n \n   Previously creating two instances of `HadoopFileSystem` using the same init parameters would result in both pointing to the same `hdfsFS` object. If one `HadoopFileSystem` disconnected then the underlying `hdfsFS` would be closed for both instances.\r\n   \r\n   To fix this, we force a new instance of `hdfsFS` on connect, removing this cacheing behavior.\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "created": "2018-01-24T18:28:52.705+0000",
                    "updated": "2018-01-24T18:28:52.705+0000"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13133437/comment/16338234",
                    "id": "16338234",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "body": "jcrist commented on issue #1499: ARROW-2025: [C++] Creating multiple equivalent `HadoopFileSystem`s works fine\nURL: https://github.com/apache/arrow/pull/1499#issuecomment-360275723\n \n \n   I don't *think* the hdfs tests are run on travis, but I can verify this PR fixes the issue locally:\r\n   \r\n   ```python\r\n   >>> import pyarrow as pa\r\n   >>> h = pa.hdfs.connect()\r\n   18/01/24 21:13:29 WARN util.NativeCodeLoader: Unable to load native-hadoop library for your platform... using builtin-java classes where applicable\r\n   18/01/24 21:13:30 WARN shortcircuit.DomainSocketFactory: The short-circuit local reads feature cannot be used because libhadoop cannot be loaded.\r\n   >>> h2 = pa.hdfs.connect()\r\n   >>> h.ls(\"/\")\r\n   ['/benchmarks', '/hbase', '/tmp', '/user', '/var']\r\n   >>> del h\r\n   >>> h2.ls(\"/\")\r\n   ['/benchmarks', '/hbase', '/tmp', '/user', '/var']\r\n   ```\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "created": "2018-01-24T21:15:42.789+0000",
                    "updated": "2018-01-24T21:15:42.789+0000"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13133437/comment/16338561",
                    "id": "16338561",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=wesm",
                        "name": "wesm",
                        "key": "wesmckinn",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=wesmckinn&avatarId=29931",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=wesmckinn&avatarId=29931",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=wesmckinn&avatarId=29931",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=wesmckinn&avatarId=29931"
                        },
                        "displayName": "Wes McKinney",
                        "active": true,
                        "timeZone": "America/New_York"
                    },
                    "body": "Issue resolved by pull request 1499\n[https://github.com/apache/arrow/pull/1499]",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=wesm",
                        "name": "wesm",
                        "key": "wesmckinn",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=wesmckinn&avatarId=29931",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=wesmckinn&avatarId=29931",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=wesmckinn&avatarId=29931",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=wesmckinn&avatarId=29931"
                        },
                        "displayName": "Wes McKinney",
                        "active": true,
                        "timeZone": "America/New_York"
                    },
                    "created": "2018-01-25T01:33:14.198+0000",
                    "updated": "2018-01-25T01:33:14.198+0000"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13133437/comment/16338562",
                    "id": "16338562",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "body": "wesm closed pull request #1499: ARROW-2025: [C++] Creating multiple equivalent `HadoopFileSystem`s works fine\nURL: https://github.com/apache/arrow/pull/1499\n \n \n   \n\nThis is a PR merged from a forked repository.\nAs GitHub hides the original diff on merge, it is displayed below for\nthe sake of provenance:\n\nAs this is a foreign pull request (from a fork), the diff is supplied\nbelow (as it won't show otherwise due to GitHub magic):\n\ndiff --git a/cpp/src/arrow/io/hdfs-internal.cc b/cpp/src/arrow/io/hdfs-internal.cc\nindex 545b2d17d..efceb8ae6 100644\n--- a/cpp/src/arrow/io/hdfs-internal.cc\n+++ b/cpp/src/arrow/io/hdfs-internal.cc\n@@ -310,6 +310,10 @@ void LibHdfsShim::BuilderSetKerbTicketCachePath(hdfsBuilder* bld,\n   this->hdfsBuilderSetKerbTicketCachePath(bld, kerbTicketCachePath);\n }\n \n+void LibHdfsShim::BuilderSetForceNewInstance(hdfsBuilder* bld) {\n+  this->hdfsBuilderSetForceNewInstance(bld);\n+}\n+\n hdfsFS LibHdfsShim::BuilderConnect(hdfsBuilder* bld) {\n   return this->hdfsBuilderConnect(bld);\n }\n@@ -490,6 +494,7 @@ Status LibHdfsShim::GetRequiredSymbols() {\n   GET_SYMBOL_REQUIRED(this, hdfsBuilderSetNameNodePort);\n   GET_SYMBOL_REQUIRED(this, hdfsBuilderSetUserName);\n   GET_SYMBOL_REQUIRED(this, hdfsBuilderSetKerbTicketCachePath);\n+  GET_SYMBOL_REQUIRED(this, hdfsBuilderSetForceNewInstance);\n   GET_SYMBOL_REQUIRED(this, hdfsBuilderConnect);\n   GET_SYMBOL_REQUIRED(this, hdfsCreateDirectory);\n   GET_SYMBOL_REQUIRED(this, hdfsDelete);\ndiff --git a/cpp/src/arrow/io/hdfs-internal.h b/cpp/src/arrow/io/hdfs-internal.h\nindex df925cf62..f0fce23c2 100644\n--- a/cpp/src/arrow/io/hdfs-internal.h\n+++ b/cpp/src/arrow/io/hdfs-internal.h\n@@ -51,6 +51,7 @@ struct LibHdfsShim {\n   void (*hdfsBuilderSetUserName)(hdfsBuilder* bld, const char* userName);\n   void (*hdfsBuilderSetKerbTicketCachePath)(hdfsBuilder* bld,\n                                             const char* kerbTicketCachePath);\n+  void (*hdfsBuilderSetForceNewInstance)(hdfsBuilder* bld);\n   hdfsFS (*hdfsBuilderConnect)(hdfsBuilder* bld);\n \n   int (*hdfsDisconnect)(hdfsFS fs);\n@@ -95,6 +96,7 @@ struct LibHdfsShim {\n     this->hdfsBuilderSetNameNodePort = nullptr;\n     this->hdfsBuilderSetUserName = nullptr;\n     this->hdfsBuilderSetKerbTicketCachePath = nullptr;\n+    this->hdfsBuilderSetForceNewInstance = nullptr;\n     this->hdfsBuilderConnect = nullptr;\n     this->hdfsDisconnect = nullptr;\n     this->hdfsOpenFile = nullptr;\n@@ -138,6 +140,8 @@ struct LibHdfsShim {\n \n   void BuilderSetKerbTicketCachePath(hdfsBuilder* bld, const char* kerbTicketCachePath);\n \n+  void BuilderSetForceNewInstance(hdfsBuilder* bld);\n+\n   hdfsFS BuilderConnect(hdfsBuilder* bld);\n \n   int Disconnect(hdfsFS fs);\ndiff --git a/cpp/src/arrow/io/hdfs.cc b/cpp/src/arrow/io/hdfs.cc\nindex 6e3e4a7a1..6c569ae1e 100644\n--- a/cpp/src/arrow/io/hdfs.cc\n+++ b/cpp/src/arrow/io/hdfs.cc\n@@ -335,6 +335,7 @@ class HadoopFileSystem::HadoopFileSystemImpl {\n     if (!config->kerb_ticket.empty()) {\n       driver_->BuilderSetKerbTicketCachePath(builder, config->kerb_ticket.c_str());\n     }\n+    driver_->BuilderSetForceNewInstance(builder);\n     fs_ = driver_->BuilderConnect(builder);\n \n     if (fs_ == nullptr) {\ndiff --git a/cpp/src/arrow/io/io-hdfs-test.cc b/cpp/src/arrow/io/io-hdfs-test.cc\nindex 5305b4774..f2ded6ff4 100644\n--- a/cpp/src/arrow/io/io-hdfs-test.cc\n+++ b/cpp/src/arrow/io/io-hdfs-test.cc\n@@ -178,6 +178,21 @@ TYPED_TEST(TestHadoopFileSystem, ConnectsAgain) {\n   ASSERT_OK(client->Disconnect());\n }\n \n+TYPED_TEST(TestHadoopFileSystem, MultipleClients) {\n+  SKIP_IF_NO_DRIVER();\n+\n+  std::shared_ptr<HadoopFileSystem> client1;\n+  std::shared_ptr<HadoopFileSystem> client2;\n+  ASSERT_OK(HadoopFileSystem::Connect(&this->conf_, &client1));\n+  ASSERT_OK(HadoopFileSystem::Connect(&this->conf_, &client2));\n+  ASSERT_OK(client1->Disconnect());\n+\n+  // client2 continues to function after equivalent client1 has shutdown\n+  std::vector<HdfsPathInfo> listing;\n+  EXPECT_OK(client2->ListDirectory(this->scratch_dir_, &listing));\n+  ASSERT_OK(client2->Disconnect());\n+}\n+\n TYPED_TEST(TestHadoopFileSystem, MakeDirectory) {\n   SKIP_IF_NO_DRIVER();\n \n\n\n \n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "created": "2018-01-25T01:33:17.396+0000",
                    "updated": "2018-01-25T01:33:17.396+0000"
                }
            ],
            "maxResults": 6,
            "total": 6,
            "startAt": 0
        },
        "customfield_12311820": "0|i3pbbj:",
        "customfield_12314139": null
    }
}