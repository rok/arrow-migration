{
    "expand": "operations,versionedRepresentations,editmeta,changelog,renderedFields",
    "id": "13140864",
    "self": "https://issues.apache.org/jira/rest/api/2/issue/13140864",
    "key": "ARROW-2215",
    "fields": {
        "fixVersions": [
            {
                "self": "https://issues.apache.org/jira/rest/api/2/version/12342821",
                "id": "12342821",
                "description": "",
                "name": "JS-0.3.1",
                "archived": false,
                "released": true,
                "releaseDate": "2018-03-16"
            }
        ],
        "resolution": {
            "self": "https://issues.apache.org/jira/rest/api/2/resolution/1",
            "id": "1",
            "description": "A fix for this issue is checked into the tree and tested.",
            "name": "Fixed"
        },
        "customfield_12312322": null,
        "customfield_12312323": null,
        "customfield_12312320": null,
        "customfield_12310420": "9223372036854775807",
        "customfield_12312321": null,
        "customfield_12312328": null,
        "customfield_12312329": null,
        "customfield_12312326": null,
        "customfield_12310300": null,
        "customfield_12312327": null,
        "customfield_12312324": null,
        "customfield_12312720": null,
        "customfield_12312325": null,
        "lastViewed": null,
        "priority": {
            "self": "https://issues.apache.org/jira/rest/api/2/priority/3",
            "iconUrl": "https://issues.apache.org/jira/images/icons/priorities/major.svg",
            "name": "Major",
            "id": "3"
        },
        "labels": [
            "pull-request-available"
        ],
        "customfield_12312333": null,
        "customfield_12312334": null,
        "customfield_12313422": "false",
        "customfield_12310310": "0.0",
        "customfield_12312331": null,
        "customfield_12312332": null,
        "aggregatetimeoriginalestimate": null,
        "timeestimate": null,
        "customfield_12312330": null,
        "versions": [],
        "customfield_12311120": null,
        "customfield_12313826": null,
        "customfield_12312339": null,
        "issuelinks": [],
        "customfield_12313825": null,
        "assignee": {
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=pcmoritz",
            "name": "pcmoritz",
            "key": "pcmoritz",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
            },
            "displayName": "Philipp Moritz",
            "active": true,
            "timeZone": "Etc/UTC"
        },
        "customfield_12312337": null,
        "customfield_12313823": null,
        "customfield_12312338": null,
        "customfield_12311920": null,
        "customfield_12313822": null,
        "customfield_12312335": null,
        "customfield_12313821": null,
        "customfield_12312336": null,
        "customfield_12313820": null,
        "status": {
            "self": "https://issues.apache.org/jira/rest/api/2/status/5",
            "description": "A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.",
            "iconUrl": "https://issues.apache.org/jira/images/icons/statuses/resolved.png",
            "name": "Resolved",
            "id": "5",
            "statusCategory": {
                "self": "https://issues.apache.org/jira/rest/api/2/statuscategory/3",
                "id": 3,
                "key": "done",
                "colorName": "green",
                "name": "Done"
            }
        },
        "components": [
            {
                "self": "https://issues.apache.org/jira/rest/api/2/component/12332956",
                "id": "12332956",
                "name": "C++ - Plasma"
            }
        ],
        "customfield_12312026": null,
        "customfield_12312023": null,
        "customfield_12312024": null,
        "aggregatetimeestimate": null,
        "customfield_12312022": null,
        "customfield_12310921": null,
        "customfield_12310920": "9223372036854775807",
        "customfield_12312823": null,
        "creator": {
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=pcmoritz",
            "name": "pcmoritz",
            "key": "pcmoritz",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
            },
            "displayName": "Philipp Moritz",
            "active": true,
            "timeZone": "Etc/UTC"
        },
        "subtasks": [],
        "reporter": {
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=pcmoritz",
            "name": "pcmoritz",
            "key": "pcmoritz",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
            },
            "displayName": "Philipp Moritz",
            "active": true,
            "timeZone": "Etc/UTC"
        },
        "aggregateprogress": {
            "progress": 0,
            "total": 0
        },
        "customfield_12313520": null,
        "customfield_12310250": null,
        "progress": {
            "progress": 0,
            "total": 0
        },
        "customfield_12313924": null,
        "votes": {
            "self": "https://issues.apache.org/jira/rest/api/2/issue/ARROW-2215/votes",
            "votes": 0,
            "hasVoted": false
        },
        "worklog": {
            "startAt": 0,
            "maxResults": 20,
            "total": 0,
            "worklogs": []
        },
        "customfield_12313920": null,
        "issuetype": {
            "self": "https://issues.apache.org/jira/rest/api/2/issuetype/4",
            "id": "4",
            "description": "An improvement or enhancement to an existing feature or task.",
            "iconUrl": "https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21140&avatarType=issuetype",
            "name": "Improvement",
            "subtask": false,
            "avatarId": 21140
        },
        "timespent": null,
        "customfield_12314020": "{summaryBean=com.atlassian.jira.plugin.devstatus.rest.SummaryBean@4bb10428[summary={pullrequest=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@47d94913[overall=PullRequestOverallBean{stateCount=0, state='OPEN', details=PullRequestOverallDetails{openCount=0, mergedCount=0, declinedCount=0}},byInstanceType={}], build=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@a02da4e[overall=com.atlassian.jira.plugin.devstatus.summary.beans.BuildOverallBean@79e9bcc[failedBuildCount=0,successfulBuildCount=0,unknownBuildCount=0,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], review=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@713e7e27[overall=com.atlassian.jira.plugin.devstatus.summary.beans.ReviewsOverallBean@30164edf[stateCount=0,state=<null>,dueDate=<null>,overDue=false,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], deployment-environment=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@2cda3239[overall=com.atlassian.jira.plugin.devstatus.summary.beans.DeploymentOverallBean@5f698c95[topEnvironments=[],showProjects=false,successfulCount=0,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], repository=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@5da41e19[overall=com.atlassian.jira.plugin.devstatus.summary.beans.CommitOverallBean@5f46d3c4[count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], branch=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@22f069ef[overall=com.atlassian.jira.plugin.devstatus.summary.beans.BranchOverallBean@316e5400[count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}]},errors=[],configErrors=[]], devSummaryJson={\"cachedValue\":{\"errors\":[],\"configErrors\":[],\"summary\":{\"pullrequest\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"stateCount\":0,\"state\":\"OPEN\",\"details\":{\"openCount\":0,\"mergedCount\":0,\"declinedCount\":0,\"total\":0},\"open\":true},\"byInstanceType\":{}},\"build\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"failedBuildCount\":0,\"successfulBuildCount\":0,\"unknownBuildCount\":0},\"byInstanceType\":{}},\"review\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"stateCount\":0,\"state\":null,\"dueDate\":null,\"overDue\":false,\"completed\":false},\"byInstanceType\":{}},\"deployment-environment\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"topEnvironments\":[],\"showProjects\":false,\"successfulCount\":0},\"byInstanceType\":{}},\"repository\":{\"overall\":{\"count\":0,\"lastUpdated\":null},\"byInstanceType\":{}},\"branch\":{\"overall\":{\"count\":0,\"lastUpdated\":null},\"byInstanceType\":{}}}},\"isStale\":false}}",
        "customfield_12314141": null,
        "customfield_12314140": null,
        "project": {
            "self": "https://issues.apache.org/jira/rest/api/2/project/12319525",
            "id": "12319525",
            "key": "ARROW",
            "name": "Apache Arrow",
            "projectTypeKey": "software",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/projectavatar?pid=12319525&avatarId=10011",
                "24x24": "https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12319525&avatarId=10011",
                "16x16": "https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12319525&avatarId=10011",
                "32x32": "https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12319525&avatarId=10011"
            },
            "projectCategory": {
                "self": "https://issues.apache.org/jira/rest/api/2/projectCategory/13960",
                "id": "13960",
                "description": "Apache Arrow",
                "name": "Arrow"
            }
        },
        "aggregatetimespent": null,
        "customfield_12312520": null,
        "customfield_12312521": "Thu Mar 01 00:44:24 UTC 2018",
        "customfield_12314422": null,
        "customfield_12314421": null,
        "customfield_12314146": null,
        "customfield_12314420": null,
        "customfield_12314145": null,
        "customfield_12314144": null,
        "customfield_12314143": null,
        "resolutiondate": "2018-03-01T00:44:24.000+0000",
        "workratio": -1,
        "customfield_12312923": null,
        "customfield_12312920": null,
        "customfield_12312921": null,
        "watches": {
            "self": "https://issues.apache.org/jira/rest/api/2/issue/ARROW-2215/watchers",
            "watchCount": 2,
            "isWatching": false
        },
        "created": "2018-02-26T08:51:13.000+0000",
        "updated": "2018-03-01T00:44:52.000+0000",
        "timeoriginalestimate": null,
        "description": "see\u00a0https://github.com/ray-project/ray/issues/1592",
        "customfield_10010": null,
        "timetracking": {},
        "customfield_12314523": null,
        "customfield_12314127": null,
        "customfield_12314522": null,
        "customfield_12314126": null,
        "customfield_12314521": null,
        "customfield_12314125": null,
        "customfield_12314520": null,
        "customfield_12314124": null,
        "attachment": [],
        "customfield_12312340": null,
        "customfield_12314123": null,
        "customfield_12312341": null,
        "customfield_12312220": null,
        "customfield_12314122": null,
        "customfield_12314121": null,
        "customfield_12314120": null,
        "customfield_12314129": null,
        "customfield_12314524": null,
        "customfield_12314128": null,
        "summary": "[Plasma] Error when using huge pages",
        "customfield_12314130": null,
        "customfield_12310291": null,
        "customfield_12310290": null,
        "customfield_12314138": null,
        "customfield_12314137": null,
        "environment": null,
        "customfield_12314136": null,
        "customfield_12314135": null,
        "customfield_12311020": null,
        "customfield_12314134": null,
        "duedate": null,
        "customfield_12314132": null,
        "customfield_12314131": null,
        "comment": {
            "comments": [
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13140864/comment/16376536",
                    "id": "16376536",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "body": "pcmoritz opened a new pull request #1660: ARROW-2215: [Plasma] hugetables munmap issue\nURL: https://github.com/apache/arrow/pull/1660\n \n \n   \n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "created": "2018-02-26T08:52:50.253+0000",
                    "updated": "2018-02-26T08:52:50.253+0000"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13140864/comment/16376543",
                    "id": "16376543",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=pcmoritz",
                        "name": "pcmoritz",
                        "key": "pcmoritz",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "Philipp Moritz",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "body": "The sizes for munmap need to be page aligned, so our hack in [https://github.com/apache/arrow/blob/c0b0e3300ee9747e9eb781b517f0b3dc7c661ada/cpp/src/plasma/malloc.cc#L133]\u00a0prevented that.",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=pcmoritz",
                        "name": "pcmoritz",
                        "key": "pcmoritz",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "Philipp Moritz",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "created": "2018-02-26T08:55:30.654+0000",
                    "updated": "2018-02-26T08:55:30.654+0000"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13140864/comment/16376817",
                    "id": "16376817",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "body": "xhochy commented on a change in pull request #1660: ARROW-2215: [Plasma] hugetables munmap issue\nURL: https://github.com/apache/arrow/pull/1660#discussion_r170581885\n \n \n\n ##########\n File path: python/pyarrow/tests/test_plasma.py\n ##########\n @@ -755,6 +755,18 @@ def test_use_one_memory_mapped_file(self):\n             create_object(self.plasma_client, DEFAULT_PLASMA_STORE_MEMORY + 1,\n                           0)\n \n+    def test_use_huge_pages(self):\n+        subprocess.check_call(\"sudo mkdir -p /mnt/hugepages\", shell=True)\n \n Review comment:\n   Please don't do `sudo` calls in unit tests. This could rather be a script that is run as an extra step in the CI. Still, this does not seem to test any Arrow/Plasma functionality?\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "created": "2018-02-26T12:56:17.759+0000",
                    "updated": "2018-02-26T12:56:17.759+0000"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13140864/comment/16378150",
                    "id": "16378150",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "body": "pcmoritz commented on issue #1660: ARROW-2215: [Plasma] Hugetables munmap issue\nURL: https://github.com/apache/arrow/pull/1660#issuecomment-368768723\n \n \n   Thanks for the tip, this was not ready yet. It is now ready, the test failure is unrelated.\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "created": "2018-02-27T07:07:49.383+0000",
                    "updated": "2018-02-27T07:07:49.383+0000"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13140864/comment/16378156",
                    "id": "16378156",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "body": "pcmoritz commented on issue #1660: ARROW-2215: [Plasma] Hugetables munmap issue\nURL: https://github.com/apache/arrow/pull/1660#issuecomment-368768723\n \n \n   Thanks for the tip about sudo. The test was not complete yet. It is now ready, the test failure is unrelated.\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "created": "2018-02-27T07:10:15.153+0000",
                    "updated": "2018-02-27T07:10:15.153+0000"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13140864/comment/16378163",
                    "id": "16378163",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "body": "robertnishihara commented on issue #1660: ARROW-2215: [Plasma] Hugetables munmap issue\nURL: https://github.com/apache/arrow/pull/1660#issuecomment-368770473\n \n \n   Looks good to me. Consider adding a comment in `malloc.cc` that if we change https://github.com/apache/arrow/blob/e50a8ec432625656c7c2158228c878ba5fb94568/cpp/src/plasma/malloc.cc#L158 then we need to modify the client as well.\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "created": "2018-02-27T07:17:23.537+0000",
                    "updated": "2018-02-27T07:17:23.537+0000"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13140864/comment/16381282",
                    "id": "16381282",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "body": "robertnishihara commented on a change in pull request #1660: ARROW-2215: [Plasma] Hugetables munmap issue\nURL: https://github.com/apache/arrow/pull/1660#discussion_r171428063\n \n \n\n ##########\n File path: python/pyarrow/tests/test_plasma.py\n ##########\n @@ -755,6 +755,18 @@ def test_use_one_memory_mapped_file(self):\n             create_object(self.plasma_client, DEFAULT_PLASMA_STORE_MEMORY + 1,\n                           0)\n \n+    def test_use_huge_pages(self):\n+        subprocess.check_call(\"sudo mkdir -p /mnt/hugepages\", shell=True)\n \n Review comment:\n   The filesystem created here is used to test Plasma support for huge pages, which is a performance optimization.\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "created": "2018-03-01T00:10:29.072+0000",
                    "updated": "2018-03-01T00:10:29.072+0000"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13140864/comment/16381283",
                    "id": "16381283",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "body": "robertnishihara commented on issue #1660: ARROW-2215: [Plasma] Hugetables munmap issue\nURL: https://github.com/apache/arrow/pull/1660#issuecomment-369428582\n \n \n   I believe @xhochy's comment is addressed, so I will attempt to merge this.\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "created": "2018-03-01T00:10:54.402+0000",
                    "updated": "2018-03-01T00:10:54.402+0000"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13140864/comment/16381319",
                    "id": "16381319",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "body": "robertnishihara closed pull request #1660: ARROW-2215: [Plasma] Hugetables munmap issue\nURL: https://github.com/apache/arrow/pull/1660\n \n \n   \n\nThis is a PR merged from a forked repository.\nAs GitHub hides the original diff on merge, it is displayed below for\nthe sake of provenance:\n\nAs this is a foreign pull request (from a fork), the diff is supplied\nbelow (as it won't show otherwise due to GitHub magic):\n\ndiff --git a/ci/travis_script_python.sh b/ci/travis_script_python.sh\nindex 9ed5825bb..a776c4263 100755\n--- a/ci/travis_script_python.sh\n+++ b/ci/travis_script_python.sh\n@@ -96,6 +96,14 @@ if [ $ARROW_TRAVIS_VALGRIND == \"1\" ]; then\n   export PLASMA_VALGRIND=1\n fi\n \n+# Set up huge pages for plasma test\n+if [ $TRAVIS_OS_NAME == \"linux\" ]; then\n+    sudo mkdir -p /mnt/hugepages\n+    sudo mount -t hugetlbfs -o uid=`id -u` -o gid=`id -g` none /mnt/hugepages\n+    sudo bash -c \"echo `id -g` > /proc/sys/vm/hugetlb_shm_group\"\n+    sudo bash -c \"echo 20000 > /proc/sys/vm/nr_hugepages\"\n+fi\n+\n PYARROW_PATH=$CONDA_PREFIX/lib/python$PYTHON_VERSION/site-packages/pyarrow\n python -m pytest -vv -r sxX --durations=15 -s $PYARROW_PATH --parquet\n \ndiff --git a/cpp/src/plasma/client.cc b/cpp/src/plasma/client.cc\nindex 679d9cecd..a9bbd8cc4 100644\n--- a/cpp/src/plasma/client.cc\n+++ b/cpp/src/plasma/client.cc\n@@ -45,6 +45,7 @@\n #include \"plasma/common.h\"\n #include \"plasma/fling.h\"\n #include \"plasma/io.h\"\n+#include \"plasma/malloc.h\"\n #include \"plasma/plasma.h\"\n #include \"plasma/protocol.h\"\n \n@@ -117,8 +118,10 @@ uint8_t* PlasmaClient::lookup_or_mmap(int fd, int store_fd_val, int64_t map_size\n     close(fd);\n     return entry->second.pointer;\n   } else {\n-    uint8_t* result = reinterpret_cast<uint8_t*>(\n-        mmap(NULL, map_size, PROT_READ | PROT_WRITE, MAP_SHARED, fd, 0));\n+    // We subtract kMmapRegionsGap from the length that was added\n+    // in fake_mmap in malloc.h, to make map_size page-aligned again.\n+    uint8_t* result = reinterpret_cast<uint8_t*>(mmap(\n+        NULL, map_size - kMmapRegionsGap, PROT_READ | PROT_WRITE, MAP_SHARED, fd, 0));\n     // TODO(pcm): Don't fail here, instead return a Status.\n     if (result == MAP_FAILED) {\n       ARROW_LOG(FATAL) << \"mmap failed\";\n@@ -395,7 +398,9 @@ Status PlasmaClient::UnmapObject(const ObjectID& object_id) {\n   ARROW_CHECK(entry->second.count >= 1);\n   if (entry->second.count == 1) {\n     // If no other objects are being used, then unmap the file.\n-    int err = munmap(entry->second.pointer, entry->second.length);\n+    // We subtract kMmapRegionsGap from the length that was added\n+    // in fake_mmap in malloc.h, to make the size page-aligned again.\n+    int err = munmap(entry->second.pointer, entry->second.length - kMmapRegionsGap);\n     if (err == -1) {\n       return Status::IOError(\"Error during munmap\");\n     }\ndiff --git a/cpp/src/plasma/malloc.cc b/cpp/src/plasma/malloc.cc\nindex 3c5d107b2..e2403fd61 100644\n--- a/cpp/src/plasma/malloc.cc\n+++ b/cpp/src/plasma/malloc.cc\n@@ -127,10 +127,10 @@ int create_buffer(int64_t size) {\n }\n \n void* fake_mmap(size_t size) {\n-  // Add sizeof(size_t) so that the returned pointer is deliberately not\n+  // Add kMmapRegionsGap so that the returned pointer is deliberately not\n   // page-aligned. This ensures that the segments of memory returned by\n   // fake_mmap are never contiguous.\n-  size += sizeof(size_t);\n+  size += kMmapRegionsGap;\n \n   int fd = create_buffer(size);\n   ARROW_CHECK(fd >= 0) << \"Failed to create buffer during mmap\";\n@@ -155,15 +155,15 @@ void* fake_mmap(size_t size) {\n   record.size = size;\n \n   // We lie to dlmalloc about where mapped memory actually lives.\n-  pointer = pointer_advance(pointer, sizeof(size_t));\n+  pointer = pointer_advance(pointer, kMmapRegionsGap);\n   ARROW_LOG(DEBUG) << pointer << \" = fake_mmap(\" << size << \")\";\n   return pointer;\n }\n \n int fake_munmap(void* addr, int64_t size) {\n   ARROW_LOG(DEBUG) << \"fake_munmap(\" << addr << \", \" << size << \")\";\n-  addr = pointer_retreat(addr, sizeof(size_t));\n-  size += sizeof(size_t);\n+  addr = pointer_retreat(addr, kMmapRegionsGap);\n+  size += kMmapRegionsGap;\n \n   auto entry = mmap_records.find(addr);\n \ndiff --git a/cpp/src/plasma/malloc.h b/cpp/src/plasma/malloc.h\nindex cb8c600b1..c24f15456 100644\n--- a/cpp/src/plasma/malloc.h\n+++ b/cpp/src/plasma/malloc.h\n@@ -21,6 +21,12 @@\n #include <inttypes.h>\n #include <stddef.h>\n \n+/// Gap between two consecutive mmap regions allocated by fake_mmap.\n+/// This ensures that the segments of memory returned by\n+/// fake_mmap are never contiguous and dlmalloc does not coalesce it\n+/// (in the client we cannot guarantee that these mmaps are contiguous).\n+constexpr int64_t kMmapRegionsGap = sizeof(size_t);\n+\n void get_malloc_mapinfo(void* addr, int* fd, int64_t* map_length, ptrdiff_t* offset);\n \n /// Get the mmap size corresponding to a specific file descriptor.\ndiff --git a/python/pyarrow/tests/test_plasma.py b/python/pyarrow/tests/test_plasma.py\nindex 27556e60d..0df627fe6 100644\n--- a/python/pyarrow/tests/test_plasma.py\n+++ b/python/pyarrow/tests/test_plasma.py\n@@ -105,7 +105,8 @@ def assert_get_object_equal(unit_test, client1, client2, object_id,\n def start_plasma_store(plasma_store_memory=DEFAULT_PLASMA_STORE_MEMORY,\n                        use_valgrind=False, use_profiler=False,\n                        stdout_file=None, stderr_file=None,\n-                       use_one_memory_mapped_file=False):\n+                       use_one_memory_mapped_file=False,\n+                       plasma_directory=None, use_hugepages=False):\n     \"\"\"Start a plasma store process.\n     Args:\n         use_valgrind (bool): True if the plasma store should be started inside\n@@ -131,6 +132,10 @@ def start_plasma_store(plasma_store_memory=DEFAULT_PLASMA_STORE_MEMORY,\n                \"-m\", str(plasma_store_memory)]\n     if use_one_memory_mapped_file:\n         command += [\"-f\"]\n+    if plasma_directory:\n+        command += [\"-d\", plasma_directory]\n+    if use_hugepages:\n+        command += [\"-h\"]\n     if use_valgrind:\n         pid = subprocess.Popen([\"valgrind\",\n                                 \"--track-origins=yes\",\n@@ -762,3 +767,14 @@ def test_object_id_size():\n     with pytest.raises(ValueError):\n         plasma.ObjectID(\"hello\")\n     plasma.ObjectID(20 * b\"0\")\n+\n+\n+@pytest.mark.skipif(not os.path.exists(\"/mnt/hugepages\"),\n+                    reason=\"requires hugepage support\")\n+def test_use_huge_pages():\n+    import pyarrow.plasma as plasma\n+    plasma_store_name, p = start_plasma_store(\n+        plasma_directory=\"/mnt/hugepages\", use_hugepages=True)\n+    plasma_client = plasma.connect(plasma_store_name, \"\", 64)\n+    create_object(plasma_client, 100000000)\n+    p.kill()\n\n\n \n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "created": "2018-03-01T00:44:00.201+0000",
                    "updated": "2018-03-01T00:44:00.201+0000"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13140864/comment/16381320",
                    "id": "16381320",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=robertnishihara",
                        "name": "robertnishihara",
                        "key": "robertnishihara",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "Robert Nishihara",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "body": "Issue resolved by pull request 1660\n[https://github.com/apache/arrow/pull/1660]",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=robertnishihara",
                        "name": "robertnishihara",
                        "key": "robertnishihara",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "Robert Nishihara",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "created": "2018-03-01T00:44:24.585+0000",
                    "updated": "2018-03-01T00:44:24.585+0000"
                }
            ],
            "maxResults": 10,
            "total": 10,
            "startAt": 0
        },
        "customfield_12311820": "0|i3ql33:",
        "customfield_12314139": null
    }
}