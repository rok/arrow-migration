{
    "expand": "operations,versionedRepresentations,editmeta,changelog,renderedFields",
    "id": "13168821",
    "self": "https://issues.apache.org/jira/rest/api/2/issue/13168821",
    "key": "ARROW-2759",
    "fields": {
        "fixVersions": [
            {
                "self": "https://issues.apache.org/jira/rest/api/2/version/12343858",
                "id": "12343858",
                "description": "",
                "name": "0.12.0",
                "archived": false,
                "released": true,
                "releaseDate": "2019-01-20"
            }
        ],
        "resolution": {
            "self": "https://issues.apache.org/jira/rest/api/2/resolution/1",
            "id": "1",
            "description": "A fix for this issue is checked into the tree and tested.",
            "name": "Fixed"
        },
        "customfield_12312322": null,
        "customfield_12312323": null,
        "customfield_12312320": null,
        "customfield_12310420": "9223372036854775807",
        "customfield_12312321": null,
        "customfield_12312328": null,
        "customfield_12312329": null,
        "customfield_12312326": null,
        "customfield_12310300": null,
        "customfield_12312327": null,
        "customfield_12312324": null,
        "customfield_12312720": null,
        "customfield_12312325": null,
        "lastViewed": null,
        "priority": {
            "self": "https://issues.apache.org/jira/rest/api/2/priority/3",
            "iconUrl": "https://issues.apache.org/jira/images/icons/priorities/major.svg",
            "name": "Major",
            "id": "3"
        },
        "labels": [
            "pull-request-available"
        ],
        "customfield_12312333": null,
        "customfield_12312334": null,
        "customfield_12313422": "false",
        "customfield_12310310": "0.0",
        "customfield_12312331": null,
        "customfield_12312332": null,
        "aggregatetimeoriginalestimate": null,
        "timeestimate": 0,
        "customfield_12312330": null,
        "versions": [],
        "customfield_12311120": null,
        "customfield_12313826": null,
        "customfield_12312339": null,
        "issuelinks": [],
        "customfield_12313825": null,
        "assignee": {
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=suquark",
            "name": "suquark",
            "key": "suquark",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=suquark&avatarId=36059",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=suquark&avatarId=36059",
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=suquark&avatarId=36059",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=suquark&avatarId=36059"
            },
            "displayName": "Siyuan Zhuang",
            "active": true,
            "timeZone": "Etc/UTC"
        },
        "customfield_12312337": null,
        "customfield_12313823": null,
        "customfield_12312338": null,
        "customfield_12311920": null,
        "customfield_12313822": null,
        "customfield_12312335": null,
        "customfield_12313821": null,
        "customfield_12312336": null,
        "customfield_12313820": null,
        "status": {
            "self": "https://issues.apache.org/jira/rest/api/2/status/5",
            "description": "A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.",
            "iconUrl": "https://issues.apache.org/jira/images/icons/statuses/resolved.png",
            "name": "Resolved",
            "id": "5",
            "statusCategory": {
                "self": "https://issues.apache.org/jira/rest/api/2/statuscategory/3",
                "id": 3,
                "key": "done",
                "colorName": "green",
                "name": "Done"
            }
        },
        "components": [
            {
                "self": "https://issues.apache.org/jira/rest/api/2/component/12332956",
                "id": "12332956",
                "name": "C++ - Plasma"
            },
            {
                "self": "https://issues.apache.org/jira/rest/api/2/component/12328936",
                "id": "12328936",
                "name": "Python"
            }
        ],
        "customfield_12312026": null,
        "customfield_12312023": null,
        "customfield_12312024": null,
        "aggregatetimeestimate": 0,
        "customfield_12312022": null,
        "customfield_12310921": null,
        "customfield_12310920": "9223372036854775807",
        "customfield_12312823": null,
        "creator": {
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=suquark",
            "name": "suquark",
            "key": "suquark",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=suquark&avatarId=36059",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=suquark&avatarId=36059",
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=suquark&avatarId=36059",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=suquark&avatarId=36059"
            },
            "displayName": "Siyuan Zhuang",
            "active": true,
            "timeZone": "Etc/UTC"
        },
        "subtasks": [],
        "reporter": {
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=suquark",
            "name": "suquark",
            "key": "suquark",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=suquark&avatarId=36059",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=suquark&avatarId=36059",
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=suquark&avatarId=36059",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=suquark&avatarId=36059"
            },
            "displayName": "Siyuan Zhuang",
            "active": true,
            "timeZone": "Etc/UTC"
        },
        "aggregateprogress": {
            "progress": 4800,
            "total": 4800,
            "percent": 100
        },
        "customfield_12313520": null,
        "customfield_12310250": null,
        "progress": {
            "progress": 4800,
            "total": 4800,
            "percent": 100
        },
        "customfield_12313924": null,
        "votes": {
            "self": "https://issues.apache.org/jira/rest/api/2/issue/ARROW-2759/votes",
            "votes": 0,
            "hasVoted": false
        },
        "worklog": {
            "startAt": 0,
            "maxResults": 20,
            "total": 8,
            "worklogs": [
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13168821/worklog/168203",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "suquark opened a new pull request #3008: ARROW-2759: [Plasma] Export plasma notification socket.\nURL: https://github.com/apache/arrow/pull/3008\n \n \n   https://issues.apache.org/jira/browse/ARROW-2759\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2018-11-21T08:45:01.137+0000",
                    "updated": "2018-11-21T08:45:01.137+0000",
                    "started": "2018-11-21T08:45:01.136+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "168203",
                    "issueId": "13168821"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13168821/worklog/168577",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "suquark commented on issue #3008: ARROW-2759: [Plasma] Export plasma notification socket\nURL: https://github.com/apache/arrow/pull/3008#issuecomment-440851402\n \n \n   Ready to merge. @pcmoritz Can you review this PR?\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2018-11-21T23:41:58.142+0000",
                    "updated": "2018-11-21T23:41:58.142+0000",
                    "started": "2018-11-21T23:41:58.142+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "168577",
                    "issueId": "13168821"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13168821/worklog/171195",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "pcmoritz commented on a change in pull request #3008: ARROW-2759: [Plasma] Export plasma notification socket\nURL: https://github.com/apache/arrow/pull/3008#discussion_r237998475\n \n \n\n ##########\n File path: python/pyarrow/_plasma.pyx\n ##########\n @@ -729,6 +735,44 @@ cdef class PlasmaClient:\n         with nogil:\n             check_status(self.client.get().Subscribe(&self.notification_fd))\n \n+    def get_notification_socket(self):\n+        \"\"\"\n+        Get the notification socket.\n+        \"\"\"\n+        if PY_MAJOR_VERSION >= 3:\n \n Review comment:\n   This code should go into compat.py\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2018-11-30T20:51:17.582+0000",
                    "updated": "2018-11-30T20:51:17.582+0000",
                    "started": "2018-11-30T20:51:17.581+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "171195",
                    "issueId": "13168821"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13168821/worklog/171199",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "pcmoritz commented on a change in pull request #3008: ARROW-2759: [Plasma] Export plasma notification socket\nURL: https://github.com/apache/arrow/pull/3008#discussion_r238000048\n \n \n\n ##########\n File path: python/pyarrow/tests/test_plasma.py\n ##########\n @@ -742,6 +743,34 @@ def test_subscribe(self):\n                 assert data_sizes[j] == recv_dsize\n                 assert metadata_sizes[j] == recv_msize\n \n+    def test_subscribe_socket(self):\n+        # Subscribe to notifications from the Plasma Store.\n+        self.plasma_client.subscribe()\n+        rsock = self.plasma_client.get_notification_socket()\n+        for i in self.SUBSCRIBE_TEST_SIZES:\n+            # Get notification from socket.\n+            object_ids = [random_object_id() for _ in range(i)]\n+            metadata_sizes = [np.random.randint(1000) for _ in range(i)]\n+            data_sizes = [np.random.randint(1000) for _ in range(i)]\n+\n+            for j in range(i):\n+                self.plasma_client.create(\n+                    object_ids[j], data_sizes[j],\n+                    metadata=bytearray(np.random.bytes(metadata_sizes[j])))\n+                self.plasma_client.seal(object_ids[j])\n+\n+            # Check that we received notifications for all of the objects.\n+            for j in range(i):\n+                # Assume the plasma store will not be full,\n+                # so we always get the data size instead of -1.\n+                msg_len = struct.unpack('L', rsock.recv(8))[0]\n \n Review comment:\n   This looks uggly, can we call GetNotification here instead?\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2018-11-30T20:57:57.787+0000",
                    "updated": "2018-11-30T20:57:57.787+0000",
                    "started": "2018-11-30T20:57:57.786+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "171199",
                    "issueId": "13168821"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13168821/worklog/171200",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "pcmoritz commented on a change in pull request #3008: ARROW-2759: [Plasma] Export plasma notification socket\nURL: https://github.com/apache/arrow/pull/3008#discussion_r238000048\n \n \n\n ##########\n File path: python/pyarrow/tests/test_plasma.py\n ##########\n @@ -742,6 +743,34 @@ def test_subscribe(self):\n                 assert data_sizes[j] == recv_dsize\n                 assert metadata_sizes[j] == recv_msize\n \n+    def test_subscribe_socket(self):\n+        # Subscribe to notifications from the Plasma Store.\n+        self.plasma_client.subscribe()\n+        rsock = self.plasma_client.get_notification_socket()\n+        for i in self.SUBSCRIBE_TEST_SIZES:\n+            # Get notification from socket.\n+            object_ids = [random_object_id() for _ in range(i)]\n+            metadata_sizes = [np.random.randint(1000) for _ in range(i)]\n+            data_sizes = [np.random.randint(1000) for _ in range(i)]\n+\n+            for j in range(i):\n+                self.plasma_client.create(\n+                    object_ids[j], data_sizes[j],\n+                    metadata=bytearray(np.random.bytes(metadata_sizes[j])))\n+                self.plasma_client.seal(object_ids[j])\n+\n+            # Check that we received notifications for all of the objects.\n+            for j in range(i):\n+                # Assume the plasma store will not be full,\n+                # so we always get the data size instead of -1.\n+                msg_len = struct.unpack('L', rsock.recv(8))[0]\n \n Review comment:\n   This looks ugly, can we call GetNotification here instead?\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2018-11-30T20:58:09.194+0000",
                    "updated": "2018-11-30T20:58:09.194+0000",
                    "started": "2018-11-30T20:58:09.193+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "171200",
                    "issueId": "13168821"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13168821/worklog/171280",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "suquark commented on issue #3008: ARROW-2759: [Plasma] Export plasma notification socket\nURL: https://github.com/apache/arrow/pull/3008#issuecomment-443400311\n \n \n   Ready to merge. The test fail is not because of this PR.\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2018-12-01T05:05:41.067+0000",
                    "updated": "2018-12-01T05:05:41.067+0000",
                    "started": "2018-12-01T05:05:41.066+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "171280",
                    "issueId": "13168821"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13168821/worklog/171672",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "suquark edited a comment on issue #3008: ARROW-2759: [Plasma] Export plasma notification socket\nURL: https://github.com/apache/arrow/pull/3008#issuecomment-443400311\n \n \n   Ready to merge. @pcmoritz Can you review it?\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2018-12-03T18:39:39.562+0000",
                    "updated": "2018-12-03T18:39:39.562+0000",
                    "started": "2018-12-03T18:39:39.561+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "171672",
                    "issueId": "13168821"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13168821/worklog/171736",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "pcmoritz closed pull request #3008: ARROW-2759: [Plasma] Export plasma notification socket\nURL: https://github.com/apache/arrow/pull/3008\n \n \n   \n\nThis is a PR merged from a forked repository.\nAs GitHub hides the original diff on merge, it is displayed below for\nthe sake of provenance:\n\nAs this is a foreign pull request (from a fork), the diff is supplied\nbelow (as it won't show otherwise due to GitHub magic):\n\ndiff --git a/cpp/src/plasma/client.cc b/cpp/src/plasma/client.cc\nindex d37b033f8f..4cfc246aaf 100644\n--- a/cpp/src/plasma/client.cc\n+++ b/cpp/src/plasma/client.cc\n@@ -201,6 +201,9 @@ class PlasmaClient::Impl : public std::enable_shared_from_this<PlasmaClient::Imp\n \n   Status Subscribe(int* fd);\n \n+  Status DecodeNotification(const uint8_t* buffer, ObjectID* object_id,\n+                            int64_t* data_size, int64_t* metadata_size);\n+\n   Status GetNotification(int fd, ObjectID* object_id, int64_t* data_size,\n                          int64_t* metadata_size);\n \n@@ -942,13 +945,10 @@ Status PlasmaClient::Impl::Subscribe(int* fd) {\n   return Status::OK();\n }\n \n-Status PlasmaClient::Impl::GetNotification(int fd, ObjectID* object_id,\n-                                           int64_t* data_size, int64_t* metadata_size) {\n-  auto notification = ReadMessageAsync(fd);\n-  if (notification == NULL) {\n-    return Status::IOError(\"Failed to read object notification from Plasma socket\");\n-  }\n-  auto object_info = flatbuffers::GetRoot<fb::ObjectInfo>(notification.get());\n+Status PlasmaClient::Impl::DecodeNotification(const uint8_t* buffer, ObjectID* object_id,\n+                                              int64_t* data_size,\n+                                              int64_t* metadata_size) {\n+  auto object_info = flatbuffers::GetRoot<fb::ObjectInfo>(buffer);\n   ARROW_CHECK(object_info->object_id()->size() == sizeof(ObjectID));\n   memcpy(object_id, object_info->object_id()->data(), sizeof(ObjectID));\n   if (object_info->is_deletion()) {\n@@ -961,6 +961,15 @@ Status PlasmaClient::Impl::GetNotification(int fd, ObjectID* object_id,\n   return Status::OK();\n }\n \n+Status PlasmaClient::Impl::GetNotification(int fd, ObjectID* object_id,\n+                                           int64_t* data_size, int64_t* metadata_size) {\n+  auto notification = ReadMessageAsync(fd);\n+  if (notification == NULL) {\n+    return Status::IOError(\"Failed to read object notification from Plasma socket\");\n+  }\n+  return DecodeNotification(notification.get(), object_id, data_size, metadata_size);\n+}\n+\n Status PlasmaClient::Impl::Connect(const std::string& store_socket_name,\n                                    const std::string& manager_socket_name,\n                                    int release_delay, int num_retries) {\n@@ -1137,6 +1146,11 @@ Status PlasmaClient::GetNotification(int fd, ObjectID* object_id, int64_t* data_\n   return impl_->GetNotification(fd, object_id, data_size, metadata_size);\n }\n \n+Status PlasmaClient::DecodeNotification(const uint8_t* buffer, ObjectID* object_id,\n+                                        int64_t* data_size, int64_t* metadata_size) {\n+  return impl_->DecodeNotification(buffer, object_id, data_size, metadata_size);\n+}\n+\n Status PlasmaClient::Disconnect() { return impl_->Disconnect(); }\n \n Status PlasmaClient::Fetch(int num_object_ids, const ObjectID* object_ids) {\ndiff --git a/cpp/src/plasma/client.h b/cpp/src/plasma/client.h\nindex 1ad09f5c06..9e080b7760 100644\n--- a/cpp/src/plasma/client.h\n+++ b/cpp/src/plasma/client.h\n@@ -246,6 +246,9 @@ class ARROW_EXPORT PlasmaClient {\n   Status GetNotification(int fd, ObjectID* object_id, int64_t* data_size,\n                          int64_t* metadata_size);\n \n+  Status DecodeNotification(const uint8_t* buffer, ObjectID* object_id,\n+                            int64_t* data_size, int64_t* metadata_size);\n+\n   /// Disconnect from the local plasma instance, including the local store and\n   /// manager.\n   ///\ndiff --git a/python/pyarrow/_plasma.pyx b/python/pyarrow/_plasma.pyx\nindex 677e768035..2fad09c054 100644\n--- a/python/pyarrow/_plasma.pyx\n+++ b/python/pyarrow/_plasma.pyx\n@@ -32,11 +32,13 @@ from cpython.pycapsule cimport *\n import collections\n import pyarrow\n import random\n+import socket\n \n from pyarrow.lib cimport Buffer, NativeFile, check_status, pyarrow_wrap_buffer\n from pyarrow.includes.libarrow cimport (CBuffer, CMutableBuffer,\n                                         CFixedSizeBufferWriter, CStatus)\n \n+from pyarrow import compat\n \n PLASMA_WAIT_TIMEOUT = 2 ** 30\n \n@@ -131,6 +133,10 @@ cdef extern from \"plasma/client.h\" nogil:\n \n         CStatus Subscribe(int* fd)\n \n+        CStatus DecodeNotification(const uint8_t* buffer,\n+                                   CUniqueID* object_id, int64_t* data_size,\n+                                   int64_t* metadata_size)\n+\n         CStatus GetNotification(int fd, CUniqueID* object_id,\n                                 int64_t* data_size, int64_t* metadata_size)\n \n@@ -729,6 +735,38 @@ cdef class PlasmaClient:\n         with nogil:\n             check_status(self.client.get().Subscribe(&self.notification_fd))\n \n+    def get_notification_socket(self):\n+        \"\"\"\n+        Get the notification socket.\n+        \"\"\"\n+        return compat.get_socket_from_fd(self.notification_fd,\n+                                         family=socket.AF_UNIX,\n+                                         type=socket.SOCK_STREAM)\n+\n+    def decode_notification(self, const uint8_t* buf):\n+        \"\"\"\n+        Get the notification from the buffer.\n+\n+        Returns\n+        -------\n+        ObjectID\n+            The object ID of the object that was stored.\n+        int\n+            The data size of the object that was stored.\n+        int\n+            The metadata size of the object that was stored.\n+        \"\"\"\n+        cdef CUniqueID object_id\n+        cdef int64_t data_size\n+        cdef int64_t metadata_size\n+        with nogil:\n+            check_status(self.client.get()\n+                         .DecodeNotification(buf,\n+                                             &object_id,\n+                                             &data_size,\n+                                             &metadata_size))\n+        return ObjectID(object_id.binary()), data_size, metadata_size\n+\n     def get_next_notification(self):\n         \"\"\"\n         Get the next notification from the notification socket.\ndiff --git a/python/pyarrow/compat.py b/python/pyarrow/compat.py\nindex a481db0d53..068d5607de 100644\n--- a/python/pyarrow/compat.py\n+++ b/python/pyarrow/compat.py\n@@ -25,6 +25,7 @@\n import sys\n import six\n from six import BytesIO, StringIO, string_types as py_string\n+import socket\n \n \n PY26 = sys.version_info[:2] == (2, 6)\n@@ -267,4 +268,13 @@ def import_pytorch_extension():\n \n integer_types = six.integer_types + (np.integer,)\n \n+\n+def get_socket_from_fd(fileno, family, type):\n+    if PY2:\n+        socket_obj = socket.fromfd(fileno, family, type)\n+        return socket.socket(family, type, _sock=socket_obj)\n+    else:\n+        return socket.socket(fileno=fileno, family=family, type=type)\n+\n+\n __all__ = []\ndiff --git a/python/pyarrow/tests/test_plasma.py b/python/pyarrow/tests/test_plasma.py\nindex 69b3d9c016..e3d31b7de1 100644\n--- a/python/pyarrow/tests/test_plasma.py\n+++ b/python/pyarrow/tests/test_plasma.py\n@@ -25,6 +25,7 @@\n import pytest\n import random\n import signal\n+import struct\n import subprocess\n import sys\n import time\n@@ -742,6 +743,34 @@ def test_subscribe(self):\n                 assert data_sizes[j] == recv_dsize\n                 assert metadata_sizes[j] == recv_msize\n \n+    def test_subscribe_socket(self):\n+        # Subscribe to notifications from the Plasma Store.\n+        self.plasma_client.subscribe()\n+        rsock = self.plasma_client.get_notification_socket()\n+        for i in self.SUBSCRIBE_TEST_SIZES:\n+            # Get notification from socket.\n+            object_ids = [random_object_id() for _ in range(i)]\n+            metadata_sizes = [np.random.randint(1000) for _ in range(i)]\n+            data_sizes = [np.random.randint(1000) for _ in range(i)]\n+\n+            for j in range(i):\n+                self.plasma_client.create(\n+                    object_ids[j], data_sizes[j],\n+                    metadata=bytearray(np.random.bytes(metadata_sizes[j])))\n+                self.plasma_client.seal(object_ids[j])\n+\n+            # Check that we received notifications for all of the objects.\n+            for j in range(i):\n+                # Assume the plasma store will not be full,\n+                # so we always get the data size instead of -1.\n+                msg_len, = struct.unpack('L', rsock.recv(8))\n+                content = rsock.recv(msg_len)\n+                recv_objid, recv_dsize, recv_msize = (\n+                    self.plasma_client.decode_notification(content))\n+                assert object_ids[j] == recv_objid\n+                assert data_sizes[j] == recv_dsize\n+                assert metadata_sizes[j] == recv_msize\n+\n     def test_subscribe_deletions(self):\n         # Subscribe to notifications from the Plasma Store. We use\n         # plasma_client2 to make sure that all used objects will get evicted\n\n\n \n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2018-12-03T22:34:24.872+0000",
                    "updated": "2018-12-03T22:34:24.872+0000",
                    "started": "2018-12-03T22:34:24.871+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "171736",
                    "issueId": "13168821"
                }
            ]
        },
        "customfield_12313920": null,
        "issuetype": {
            "self": "https://issues.apache.org/jira/rest/api/2/issuetype/4",
            "id": "4",
            "description": "An improvement or enhancement to an existing feature or task.",
            "iconUrl": "https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21140&avatarType=issuetype",
            "name": "Improvement",
            "subtask": false,
            "avatarId": 21140
        },
        "timespent": 4800,
        "customfield_12314020": "{summaryBean=com.atlassian.jira.plugin.devstatus.rest.SummaryBean@4e8e4d46[summary={pullrequest=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@1d2805fe[overall=PullRequestOverallBean{stateCount=0, state='OPEN', details=PullRequestOverallDetails{openCount=0, mergedCount=0, declinedCount=0}},byInstanceType={}], build=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@46de6645[overall=com.atlassian.jira.plugin.devstatus.summary.beans.BuildOverallBean@1b049c95[failedBuildCount=0,successfulBuildCount=0,unknownBuildCount=0,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], review=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@12d136a2[overall=com.atlassian.jira.plugin.devstatus.summary.beans.ReviewsOverallBean@5f1ba3c6[stateCount=0,state=<null>,dueDate=<null>,overDue=false,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], deployment-environment=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@6a421a2e[overall=com.atlassian.jira.plugin.devstatus.summary.beans.DeploymentOverallBean@551dc3c7[topEnvironments=[],showProjects=false,successfulCount=0,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], repository=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@4e629be0[overall=com.atlassian.jira.plugin.devstatus.summary.beans.CommitOverallBean@4c651479[count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], branch=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@368cf4b1[overall=com.atlassian.jira.plugin.devstatus.summary.beans.BranchOverallBean@db41a5c[count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}]},errors=[],configErrors=[]], devSummaryJson={\"cachedValue\":{\"errors\":[],\"configErrors\":[],\"summary\":{\"pullrequest\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"stateCount\":0,\"state\":\"OPEN\",\"details\":{\"openCount\":0,\"mergedCount\":0,\"declinedCount\":0,\"total\":0},\"open\":true},\"byInstanceType\":{}},\"build\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"failedBuildCount\":0,\"successfulBuildCount\":0,\"unknownBuildCount\":0},\"byInstanceType\":{}},\"review\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"stateCount\":0,\"state\":null,\"dueDate\":null,\"overDue\":false,\"completed\":false},\"byInstanceType\":{}},\"deployment-environment\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"topEnvironments\":[],\"showProjects\":false,\"successfulCount\":0},\"byInstanceType\":{}},\"repository\":{\"overall\":{\"count\":0,\"lastUpdated\":null},\"byInstanceType\":{}},\"branch\":{\"overall\":{\"count\":0,\"lastUpdated\":null},\"byInstanceType\":{}}}},\"isStale\":false}}",
        "customfield_12314141": null,
        "customfield_12314140": null,
        "project": {
            "self": "https://issues.apache.org/jira/rest/api/2/project/12319525",
            "id": "12319525",
            "key": "ARROW",
            "name": "Apache Arrow",
            "projectTypeKey": "software",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/projectavatar?pid=12319525&avatarId=10011",
                "24x24": "https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12319525&avatarId=10011",
                "16x16": "https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12319525&avatarId=10011",
                "32x32": "https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12319525&avatarId=10011"
            },
            "projectCategory": {
                "self": "https://issues.apache.org/jira/rest/api/2/projectCategory/13960",
                "id": "13960",
                "description": "Apache Arrow",
                "name": "Arrow"
            }
        },
        "aggregatetimespent": 4800,
        "customfield_12312520": null,
        "customfield_12312521": "Mon Dec 03 22:34:19 UTC 2018",
        "customfield_12314422": null,
        "customfield_12314421": null,
        "customfield_12314146": null,
        "customfield_12314420": null,
        "customfield_12314145": null,
        "customfield_12314144": null,
        "customfield_12314143": null,
        "resolutiondate": "2018-12-03T22:34:19.000+0000",
        "workratio": -1,
        "customfield_12312923": null,
        "customfield_12312920": null,
        "customfield_12312921": null,
        "watches": {
            "self": "https://issues.apache.org/jira/rest/api/2/issue/ARROW-2759/watchers",
            "watchCount": 1,
            "isWatching": false
        },
        "created": "2018-06-28T09:58:42.000+0000",
        "updated": "2018-12-03T22:34:24.000+0000",
        "timeoriginalestimate": null,
        "description": "Currently, I am implementing an async interface for Ray. The implementation needs some kind of message polling methods like `get_next_notification`.\r\n Unfortunately, I find `get_next_notification` in `[https://github.com/apache/arrow/blob/master/python/pyarrow/_plasma.pyx]` blocking, which is an impediment to implementing async utilities. Also, it's hard to check the status of the socket (it could be closed or break up). So I suggest\u00a0export the notification socket so that there will be more flexibility.",
        "customfield_10010": null,
        "timetracking": {
            "remainingEstimate": "0h",
            "timeSpent": "1h 20m",
            "remainingEstimateSeconds": 0,
            "timeSpentSeconds": 4800
        },
        "customfield_12314523": null,
        "customfield_12314127": null,
        "customfield_12314522": null,
        "customfield_12314126": null,
        "customfield_12314521": null,
        "customfield_12314125": null,
        "customfield_12314520": null,
        "customfield_12314124": null,
        "attachment": [],
        "customfield_12312340": null,
        "customfield_12314123": null,
        "customfield_12312341": null,
        "customfield_12312220": null,
        "customfield_12314122": null,
        "customfield_12314121": null,
        "customfield_12314120": null,
        "customfield_12314129": null,
        "customfield_12314524": null,
        "customfield_12314128": null,
        "summary": "Export notification socket of Plasma",
        "customfield_12314130": null,
        "customfield_12310291": null,
        "customfield_12310290": null,
        "customfield_12314138": null,
        "customfield_12314137": null,
        "environment": null,
        "customfield_12314136": null,
        "customfield_12314135": null,
        "customfield_12311020": null,
        "customfield_12314134": null,
        "duedate": null,
        "customfield_12314132": null,
        "customfield_12314131": null,
        "comment": {
            "comments": [
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13168821/comment/16707920",
                    "id": "16707920",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=pcmoritz",
                        "name": "pcmoritz",
                        "key": "pcmoritz",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "Philipp Moritz",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "body": "Issue resolved by pull request 3008\n[https://github.com/apache/arrow/pull/3008]",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=pcmoritz",
                        "name": "pcmoritz",
                        "key": "pcmoritz",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "Philipp Moritz",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "created": "2018-12-03T22:34:19.203+0000",
                    "updated": "2018-12-03T22:34:19.203+0000"
                }
            ],
            "maxResults": 1,
            "total": 1,
            "startAt": 0
        },
        "customfield_12311820": "0|i3vbtr:",
        "customfield_12314139": null
    }
}