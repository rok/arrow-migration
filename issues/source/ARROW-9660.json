{
    "expand": "operations,versionedRepresentations,editmeta,changelog,renderedFields",
    "id": "13321194",
    "self": "https://issues.apache.org/jira/rest/api/2/issue/13321194",
    "key": "ARROW-9660",
    "fields": {
        "fixVersions": [
            {
                "self": "https://issues.apache.org/jira/rest/api/2/version/12345977",
                "id": "12345977",
                "description": "",
                "name": "2.0.0",
                "archived": false,
                "released": true,
                "releaseDate": "2020-10-19"
            }
        ],
        "resolution": {
            "self": "https://issues.apache.org/jira/rest/api/2/resolution/1",
            "id": "1",
            "description": "A fix for this issue is checked into the tree and tested.",
            "name": "Fixed"
        },
        "customfield_12312322": null,
        "customfield_12312323": null,
        "customfield_12312320": null,
        "customfield_12310420": "9223372036854775807",
        "customfield_12312321": null,
        "customfield_12312328": null,
        "customfield_12312329": null,
        "customfield_12312326": null,
        "customfield_12310300": null,
        "customfield_12312327": null,
        "customfield_12312324": null,
        "customfield_12312720": null,
        "customfield_12312325": null,
        "lastViewed": null,
        "priority": {
            "self": "https://issues.apache.org/jira/rest/api/2/priority/3",
            "iconUrl": "https://issues.apache.org/jira/images/icons/priorities/major.svg",
            "name": "Major",
            "id": "3"
        },
        "labels": [
            "pull-request-available"
        ],
        "customfield_12312333": null,
        "customfield_12312334": null,
        "customfield_12313422": "false",
        "customfield_12310310": "0.0",
        "customfield_12312331": null,
        "customfield_12312332": null,
        "aggregatetimeoriginalestimate": null,
        "timeestimate": 0,
        "customfield_12312330": null,
        "versions": [
            {
                "self": "https://issues.apache.org/jira/rest/api/2/version/12347769",
                "id": "12347769",
                "description": "",
                "name": "1.0.0",
                "archived": false,
                "released": true,
                "releaseDate": "2020-07-24"
            }
        ],
        "customfield_12311120": null,
        "customfield_12313826": null,
        "customfield_12312339": null,
        "issuelinks": [
            {
                "id": "12597769",
                "self": "https://issues.apache.org/jira/rest/api/2/issueLink/12597769",
                "type": {
                    "id": "12310000",
                    "name": "Duplicate",
                    "inward": "is duplicated by",
                    "outward": "duplicates",
                    "self": "https://issues.apache.org/jira/rest/api/2/issueLinkType/12310000"
                },
                "inwardIssue": {
                    "id": "13303874",
                    "key": "ARROW-8749",
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13303874",
                    "fields": {
                        "summary": "[C++] IpcFormatWriter writes dictionary batches with wrong ID",
                        "status": {
                            "self": "https://issues.apache.org/jira/rest/api/2/status/5",
                            "description": "A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.",
                            "iconUrl": "https://issues.apache.org/jira/images/icons/statuses/resolved.png",
                            "name": "Resolved",
                            "id": "5",
                            "statusCategory": {
                                "self": "https://issues.apache.org/jira/rest/api/2/statuscategory/3",
                                "id": 3,
                                "key": "done",
                                "colorName": "green",
                                "name": "Done"
                            }
                        },
                        "priority": {
                            "self": "https://issues.apache.org/jira/rest/api/2/priority/3",
                            "iconUrl": "https://issues.apache.org/jira/images/icons/priorities/major.svg",
                            "name": "Major",
                            "id": "3"
                        },
                        "issuetype": {
                            "self": "https://issues.apache.org/jira/rest/api/2/issuetype/1",
                            "id": "1",
                            "description": "A problem which impairs or prevents the functions of the product.",
                            "iconUrl": "https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype",
                            "name": "Bug",
                            "subtask": false,
                            "avatarId": 21133
                        }
                    }
                }
            }
        ],
        "customfield_12313825": null,
        "assignee": {
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=apitrou",
            "name": "apitrou",
            "key": "pitrou",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=pitrou&avatarId=35049",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=pitrou&avatarId=35049",
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=pitrou&avatarId=35049",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=pitrou&avatarId=35049"
            },
            "displayName": "Antoine Pitrou",
            "active": true,
            "timeZone": "Europe/Paris"
        },
        "customfield_12312337": null,
        "customfield_12313823": null,
        "customfield_12312338": null,
        "customfield_12311920": null,
        "customfield_12313822": null,
        "customfield_12312335": null,
        "customfield_12313821": null,
        "customfield_12312336": null,
        "customfield_12313820": null,
        "status": {
            "self": "https://issues.apache.org/jira/rest/api/2/status/5",
            "description": "A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.",
            "iconUrl": "https://issues.apache.org/jira/images/icons/statuses/resolved.png",
            "name": "Resolved",
            "id": "5",
            "statusCategory": {
                "self": "https://issues.apache.org/jira/rest/api/2/statuscategory/3",
                "id": 3,
                "key": "done",
                "colorName": "green",
                "name": "Done"
            }
        },
        "components": [
            {
                "self": "https://issues.apache.org/jira/rest/api/2/component/12328935",
                "id": "12328935",
                "name": "C++"
            }
        ],
        "customfield_12312026": null,
        "customfield_12312023": null,
        "customfield_12312024": null,
        "aggregatetimeestimate": 0,
        "customfield_12312022": null,
        "customfield_12310921": null,
        "customfield_12310920": "9223372036854775807",
        "customfield_12312823": null,
        "creator": {
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=belzilep",
            "name": "belzilep",
            "key": "belzilep",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
            },
            "displayName": "Pierre Belzile",
            "active": true,
            "timeZone": "Etc/UTC"
        },
        "subtasks": [],
        "reporter": {
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=belzilep",
            "name": "belzilep",
            "key": "belzilep",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
            },
            "displayName": "Pierre Belzile",
            "active": true,
            "timeZone": "Etc/UTC"
        },
        "aggregateprogress": {
            "progress": 8400,
            "total": 8400,
            "percent": 100
        },
        "customfield_12313520": null,
        "customfield_12310250": null,
        "progress": {
            "progress": 8400,
            "total": 8400,
            "percent": 100
        },
        "customfield_12313924": null,
        "votes": {
            "self": "https://issues.apache.org/jira/rest/api/2/issue/ARROW-9660/votes",
            "votes": 0,
            "hasVoted": false
        },
        "worklog": {
            "startAt": 0,
            "maxResults": 20,
            "total": 14,
            "worklogs": [
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13321194/worklog/472017",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "pitrou opened a new pull request #7992:\nURL: https://github.com/apache/arrow/pull/7992\n\n\n   \n\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2020-08-18T15:48:22.310+0000",
                    "updated": "2020-08-18T15:48:22.310+0000",
                    "started": "2020-08-18T15:48:22.309+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "472017",
                    "issueId": "13321194"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13321194/worklog/472018",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "github-actions[bot] commented on pull request #7992:\nURL: https://github.com/apache/arrow/pull/7992#issuecomment-675559545\n\n\n   https://issues.apache.org/jira/browse/ARROW-9660\n\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2020-08-18T15:48:35.949+0000",
                    "updated": "2020-08-18T15:48:35.949+0000",
                    "started": "2020-08-18T15:48:35.948+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "472018",
                    "issueId": "13321194"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13321194/worklog/472058",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "pitrou commented on a change in pull request #7992:\nURL: https://github.com/apache/arrow/pull/7992#discussion_r472355484\n\n\n\n##########\nFile path: cpp/src/arrow/ipc/dictionary.h\n##########\n@@ -21,34 +21,75 @@\n \n #include <cstdint>\n #include <memory>\n-#include <unordered_map>\n #include <utility>\n #include <vector>\n \n-#include \"arrow/memory_pool.h\"\n+#include \"arrow/result.h\"\n #include \"arrow/status.h\"\n+#include \"arrow/type_fwd.h\"\n #include \"arrow/util/macros.h\"\n #include \"arrow/util/visibility.h\"\n \n namespace arrow {\n+namespace ipc {\n \n-class Array;\n-class DataType;\n-class Field;\n-class RecordBatch;\n+class FieldPosition {\n+ public:\n+  FieldPosition() : parent_(NULLPTR), index_(-1), depth_(0) {}\n\nReview comment:\n       @bkietz The idea here is to keep track of the current position in a schema without allocating a `std::vector<int>` for each visited field, only when necessary (e.g. when a dictionary is encountered). What do you think?\n\n\n\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2020-08-18T17:15:35.867+0000",
                    "updated": "2020-08-18T17:15:35.867+0000",
                    "started": "2020-08-18T17:15:35.867+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "472058",
                    "issueId": "13321194"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13321194/worklog/473089",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "wesm commented on pull request #7992:\nURL: https://github.com/apache/arrow/pull/7992#issuecomment-677917549\n\n\n   Looking.\n\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2020-08-20T21:33:46.893+0000",
                    "updated": "2020-08-20T21:33:46.893+0000",
                    "started": "2020-08-20T21:33:46.893+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "473089",
                    "issueId": "13321194"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13321194/worklog/474321",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "wesm commented on pull request #7992:\nURL: https://github.com/apache/arrow/pull/7992#issuecomment-680038748\n\n\n   I'm sorry about the delay on this, I will try to complete this code review today\n\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2020-08-25T13:52:46.382+0000",
                    "updated": "2020-08-25T13:52:46.382+0000",
                    "started": "2020-08-25T13:52:46.382+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "474321",
                    "issueId": "13321194"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13321194/worklog/474820",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "pitrou commented on pull request #7992:\nURL: https://github.com/apache/arrow/pull/7992#issuecomment-680893599\n\n\n   Rebased, fixed conflict.\n\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2020-08-26T13:52:55.297+0000",
                    "updated": "2020-08-26T13:52:55.297+0000",
                    "started": "2020-08-26T13:52:55.297+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "474820",
                    "issueId": "13321194"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13321194/worklog/474821",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "wesm commented on a change in pull request #7992:\nURL: https://github.com/apache/arrow/pull/7992#discussion_r474285549\n\n\n\n##########\nFile path: cpp/src/arrow/flight/internal.cc\n##########\n@@ -465,11 +465,9 @@ Status FromProto(const pb::SchemaResult& pb_result, std::string* result) {\n }\n \n Status SchemaToString(const Schema& schema, std::string* out) {\n-  // TODO(wesm): Do we care about better memory efficiency here?\n   ipc::DictionaryMemo unused_dict_memo;\n\nReview comment:\n       This can be removed now?\n\n##########\nFile path: cpp/src/arrow/ipc/dictionary.h\n##########\n@@ -21,96 +21,145 @@\n \n #include <cstdint>\n #include <memory>\n-#include <unordered_map>\n #include <utility>\n #include <vector>\n \n-#include \"arrow/memory_pool.h\"\n+#include \"arrow/result.h\"\n #include \"arrow/status.h\"\n+#include \"arrow/type_fwd.h\"\n #include \"arrow/util/macros.h\"\n #include \"arrow/util/visibility.h\"\n \n namespace arrow {\n+namespace ipc {\n+\n+class FieldPosition {\n+ public:\n+  FieldPosition() : parent_(NULLPTR), index_(-1), depth_(0) {}\n+\n+  FieldPosition child(int index) const { return {this, index}; }\n+\n+  std::vector<int> path() const {\n+    std::vector<int> path(depth_);\n+    const FieldPosition* cur = this;\n+    for (int i = depth_ - 1; i >= 0; --i) {\n+      path[i] = cur->index_;\n+      cur = cur->parent_;\n+    }\n+    return path;\n+  }\n+\n+ protected:\n+  FieldPosition(const FieldPosition* parent, int index)\n+      : parent_(parent), index_(index), depth_(parent->depth_ + 1) {}\n+\n+  const FieldPosition* parent_;\n+  int index_;\n+  int depth_;\n+};\n \n-class Array;\n-class DataType;\n-class Field;\n-class RecordBatch;\n+/// \\brief Map fields in a schema to dictionary ids\n+///\n+/// The mapping is structural, i.e. the field path (as a vector of indices)\n+/// is associated to the dictionary id.\n\nReview comment:\n       It would be helpful to state that a dictionary id can be associated with multiple field paths\n\n##########\nFile path: cpp/src/arrow/ipc/metadata_internal.h\n##########\n@@ -48,6 +48,7 @@ namespace flatbuf = org::apache::arrow::flatbuf;\n \n namespace ipc {\n \n+class DictionaryFieldMapper;\n class DictionaryMemo;\n\nReview comment:\n       Perhaps we should move these both to `ipc::internal`?\n\n##########\nFile path: cpp/src/arrow/ipc/dictionary.h\n##########\n@@ -21,96 +21,145 @@\n \n #include <cstdint>\n #include <memory>\n-#include <unordered_map>\n #include <utility>\n #include <vector>\n \n-#include \"arrow/memory_pool.h\"\n+#include \"arrow/result.h\"\n #include \"arrow/status.h\"\n+#include \"arrow/type_fwd.h\"\n #include \"arrow/util/macros.h\"\n #include \"arrow/util/visibility.h\"\n \n namespace arrow {\n+namespace ipc {\n+\n+class FieldPosition {\n+ public:\n+  FieldPosition() : parent_(NULLPTR), index_(-1), depth_(0) {}\n+\n+  FieldPosition child(int index) const { return {this, index}; }\n+\n+  std::vector<int> path() const {\n+    std::vector<int> path(depth_);\n+    const FieldPosition* cur = this;\n+    for (int i = depth_ - 1; i >= 0; --i) {\n+      path[i] = cur->index_;\n+      cur = cur->parent_;\n+    }\n+    return path;\n+  }\n+\n+ protected:\n+  FieldPosition(const FieldPosition* parent, int index)\n+      : parent_(parent), index_(index), depth_(parent->depth_ + 1) {}\n+\n+  const FieldPosition* parent_;\n+  int index_;\n+  int depth_;\n+};\n \n-class Array;\n-class DataType;\n-class Field;\n-class RecordBatch;\n+/// \\brief Map fields in a schema to dictionary ids\n+///\n+/// The mapping is structural, i.e. the field path (as a vector of indices)\n+/// is associated to the dictionary id.\n+class ARROW_EXPORT DictionaryFieldMapper {\n+ public:\n+  DictionaryFieldMapper();\n+  explicit DictionaryFieldMapper(const Schema& schema);\n+  ~DictionaryFieldMapper();\n \n-namespace ipc {\n+  Status AddSchemaFields(const Schema& schema);\n+  Status AddField(int64_t id, std::vector<int> field_path);\n \n-/// \\brief Memoization data structure for assigning id numbers to\n-/// dictionaries and tracking their current state through possible\n-/// deltas in an IPC stream\n+  Result<int64_t> GetFieldId(std::vector<int> field_path) const;\n+\n+  int num_fields() const;\n+\n+ private:\n+  struct Impl;\n+  std::unique_ptr<Impl> impl_;\n+};\n+\n+using DictionaryVector = std::vector<std::pair<int64_t, std::shared_ptr<Array>>>;\n+\n+/// \\brief Memoization data structure for reading dictionaries from IPC streams\n+///\n+/// This structure tracks the following associations:\n+/// - field position (structural) -> dictionary id\n+/// - dictionary id -> value type\n+/// - dictionary id -> dictionary (value) data\n+///\n+/// Together, they allow resolving dictionary data when reading an IPC stream,\n+/// using metadata recorded in the schema message and data recorded in the\n+/// dictionary batch messages (see ResolveDictionaries).\n+///\n+/// This structure isn't useful for writing an IPC stream, where only\n+/// DictionaryFieldMapper is necessary.\n class ARROW_EXPORT DictionaryMemo {\n  public:\n-  using DictionaryVector = std::vector<std::pair<int64_t, std::shared_ptr<Array>>>;\n-\n   DictionaryMemo();\n-  DictionaryMemo(DictionaryMemo&&) = default;\n-  DictionaryMemo& operator=(DictionaryMemo&&) = default;\n+  ~DictionaryMemo();\n+\n+  DictionaryFieldMapper& fields();\n\nReview comment:\n       Is this necessary? It might be clearer to have `DictionaryFieldMapper* mutable_fields()`\n\n##########\nFile path: cpp/src/arrow/ipc/dictionary.h\n##########\n@@ -21,34 +21,75 @@\n \n #include <cstdint>\n #include <memory>\n-#include <unordered_map>\n #include <utility>\n #include <vector>\n \n-#include \"arrow/memory_pool.h\"\n+#include \"arrow/result.h\"\n #include \"arrow/status.h\"\n+#include \"arrow/type_fwd.h\"\n #include \"arrow/util/macros.h\"\n #include \"arrow/util/visibility.h\"\n \n namespace arrow {\n+namespace ipc {\n \n-class Array;\n-class DataType;\n-class Field;\n-class RecordBatch;\n+class FieldPosition {\n+ public:\n+  FieldPosition() : parent_(NULLPTR), index_(-1), depth_(0) {}\n\nReview comment:\n       Seems reasonable to me\n\n##########\nFile path: cpp/src/arrow/ipc/dictionary.cc\n##########\n@@ -30,6 +31,14 @@\n #include \"arrow/status.h\"\n #include \"arrow/type.h\"\n #include \"arrow/util/checked_cast.h\"\n+#include \"arrow/util/logging.h\"\n+\n+namespace std {\n+template <>\n+struct hash<arrow::FieldPath> {\n+  size_t operator()(const arrow::FieldPath& path) const { return path.hash(); }\n+};\n\nReview comment:\n       This might be better placed in a common header, but this is ok for now\n\n\n\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2020-08-26T14:04:39.069+0000",
                    "updated": "2020-08-26T14:04:39.069+0000",
                    "started": "2020-08-26T14:04:39.069+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "474821",
                    "issueId": "13321194"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13321194/worklog/474825",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "pitrou commented on a change in pull request #7992:\nURL: https://github.com/apache/arrow/pull/7992#discussion_r477340451\n\n\n\n##########\nFile path: cpp/src/arrow/flight/internal.cc\n##########\n@@ -465,11 +465,9 @@ Status FromProto(const pb::SchemaResult& pb_result, std::string* result) {\n }\n \n Status SchemaToString(const Schema& schema, std::string* out) {\n-  // TODO(wesm): Do we care about better memory efficiency here?\n   ipc::DictionaryMemo unused_dict_memo;\n\nReview comment:\n       Hmm... since there seemed to be nothing concerning about memory efficiency, I thought this TODO was obsolete. What did you have in mind when writing it?\n\n\n\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2020-08-26T14:22:09.961+0000",
                    "updated": "2020-08-26T14:22:09.961+0000",
                    "started": "2020-08-26T14:22:09.961+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "474825",
                    "issueId": "13321194"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13321194/worklog/474826",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "pitrou commented on a change in pull request #7992:\nURL: https://github.com/apache/arrow/pull/7992#discussion_r477340732\n\n\n\n##########\nFile path: cpp/src/arrow/ipc/dictionary.h\n##########\n@@ -21,96 +21,145 @@\n \n #include <cstdint>\n #include <memory>\n-#include <unordered_map>\n #include <utility>\n #include <vector>\n \n-#include \"arrow/memory_pool.h\"\n+#include \"arrow/result.h\"\n #include \"arrow/status.h\"\n+#include \"arrow/type_fwd.h\"\n #include \"arrow/util/macros.h\"\n #include \"arrow/util/visibility.h\"\n \n namespace arrow {\n+namespace ipc {\n+\n+class FieldPosition {\n+ public:\n+  FieldPosition() : parent_(NULLPTR), index_(-1), depth_(0) {}\n+\n+  FieldPosition child(int index) const { return {this, index}; }\n+\n+  std::vector<int> path() const {\n+    std::vector<int> path(depth_);\n+    const FieldPosition* cur = this;\n+    for (int i = depth_ - 1; i >= 0; --i) {\n+      path[i] = cur->index_;\n+      cur = cur->parent_;\n+    }\n+    return path;\n+  }\n+\n+ protected:\n+  FieldPosition(const FieldPosition* parent, int index)\n+      : parent_(parent), index_(index), depth_(parent->depth_ + 1) {}\n+\n+  const FieldPosition* parent_;\n+  int index_;\n+  int depth_;\n+};\n \n-class Array;\n-class DataType;\n-class Field;\n-class RecordBatch;\n+/// \\brief Map fields in a schema to dictionary ids\n+///\n+/// The mapping is structural, i.e. the field path (as a vector of indices)\n+/// is associated to the dictionary id.\n\nReview comment:\n       Will add.\n\n\n\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2020-08-26T14:22:32.955+0000",
                    "updated": "2020-08-26T14:22:32.955+0000",
                    "started": "2020-08-26T14:22:32.955+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "474826",
                    "issueId": "13321194"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13321194/worklog/474828",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "pitrou commented on a change in pull request #7992:\nURL: https://github.com/apache/arrow/pull/7992#discussion_r477341153\n\n\n\n##########\nFile path: cpp/src/arrow/ipc/dictionary.h\n##########\n@@ -21,96 +21,145 @@\n \n #include <cstdint>\n #include <memory>\n-#include <unordered_map>\n #include <utility>\n #include <vector>\n \n-#include \"arrow/memory_pool.h\"\n+#include \"arrow/result.h\"\n #include \"arrow/status.h\"\n+#include \"arrow/type_fwd.h\"\n #include \"arrow/util/macros.h\"\n #include \"arrow/util/visibility.h\"\n \n namespace arrow {\n+namespace ipc {\n+\n+class FieldPosition {\n+ public:\n+  FieldPosition() : parent_(NULLPTR), index_(-1), depth_(0) {}\n+\n+  FieldPosition child(int index) const { return {this, index}; }\n+\n+  std::vector<int> path() const {\n+    std::vector<int> path(depth_);\n+    const FieldPosition* cur = this;\n+    for (int i = depth_ - 1; i >= 0; --i) {\n+      path[i] = cur->index_;\n+      cur = cur->parent_;\n+    }\n+    return path;\n+  }\n+\n+ protected:\n+  FieldPosition(const FieldPosition* parent, int index)\n+      : parent_(parent), index_(index), depth_(parent->depth_ + 1) {}\n+\n+  const FieldPosition* parent_;\n+  int index_;\n+  int depth_;\n+};\n \n-class Array;\n-class DataType;\n-class Field;\n-class RecordBatch;\n+/// \\brief Map fields in a schema to dictionary ids\n+///\n+/// The mapping is structural, i.e. the field path (as a vector of indices)\n+/// is associated to the dictionary id.\n+class ARROW_EXPORT DictionaryFieldMapper {\n+ public:\n+  DictionaryFieldMapper();\n+  explicit DictionaryFieldMapper(const Schema& schema);\n+  ~DictionaryFieldMapper();\n \n-namespace ipc {\n+  Status AddSchemaFields(const Schema& schema);\n+  Status AddField(int64_t id, std::vector<int> field_path);\n \n-/// \\brief Memoization data structure for assigning id numbers to\n-/// dictionaries and tracking their current state through possible\n-/// deltas in an IPC stream\n+  Result<int64_t> GetFieldId(std::vector<int> field_path) const;\n+\n+  int num_fields() const;\n+\n+ private:\n+  struct Impl;\n+  std::unique_ptr<Impl> impl_;\n+};\n+\n+using DictionaryVector = std::vector<std::pair<int64_t, std::shared_ptr<Array>>>;\n+\n+/// \\brief Memoization data structure for reading dictionaries from IPC streams\n+///\n+/// This structure tracks the following associations:\n+/// - field position (structural) -> dictionary id\n+/// - dictionary id -> value type\n+/// - dictionary id -> dictionary (value) data\n+///\n+/// Together, they allow resolving dictionary data when reading an IPC stream,\n+/// using metadata recorded in the schema message and data recorded in the\n+/// dictionary batch messages (see ResolveDictionaries).\n+///\n+/// This structure isn't useful for writing an IPC stream, where only\n+/// DictionaryFieldMapper is necessary.\n class ARROW_EXPORT DictionaryMemo {\n  public:\n-  using DictionaryVector = std::vector<std::pair<int64_t, std::shared_ptr<Array>>>;\n-\n   DictionaryMemo();\n-  DictionaryMemo(DictionaryMemo&&) = default;\n-  DictionaryMemo& operator=(DictionaryMemo&&) = default;\n+  ~DictionaryMemo();\n+\n+  DictionaryFieldMapper& fields();\n\nReview comment:\n       Well, either this, or we duplicate the `DictionaryFieldMapper` APIs here. I have no particular preference.\n\n\n\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2020-08-26T14:23:09.460+0000",
                    "updated": "2020-08-26T14:23:09.460+0000",
                    "started": "2020-08-26T14:23:09.460+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "474828",
                    "issueId": "13321194"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13321194/worklog/474829",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "pitrou commented on a change in pull request #7992:\nURL: https://github.com/apache/arrow/pull/7992#discussion_r477341587\n\n\n\n##########\nFile path: cpp/src/arrow/ipc/metadata_internal.h\n##########\n@@ -48,6 +48,7 @@ namespace flatbuf = org::apache::arrow::flatbuf;\n \n namespace ipc {\n \n+class DictionaryFieldMapper;\n class DictionaryMemo;\n\nReview comment:\n       `DictionaryMemo` is still passed in some IPC reading APIs, I think. I don't know if those are meant to be public.\n\n\n\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2020-08-26T14:23:45.915+0000",
                    "updated": "2020-08-26T14:23:45.915+0000",
                    "started": "2020-08-26T14:23:45.914+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "474829",
                    "issueId": "13321194"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13321194/worklog/475295",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "pitrou commented on pull request #7992:\nURL: https://github.com/apache/arrow/pull/7992#issuecomment-681943423\n\n\n   I've tried the suggested API changes but they would require some annoying C++ wrangling that's basically not worth it. Will merge if CI green.\n\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2020-08-27T13:18:26.752+0000",
                    "updated": "2020-08-27T13:18:26.752+0000",
                    "started": "2020-08-27T13:18:26.752+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "475295",
                    "issueId": "13321194"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13321194/worklog/475299",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "wesm commented on pull request #7992:\nURL: https://github.com/apache/arrow/pull/7992#issuecomment-681947570\n\n\n   Thanks. +1 from me\n\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2020-08-27T13:25:57.100+0000",
                    "updated": "2020-08-27T13:25:57.100+0000",
                    "started": "2020-08-27T13:25:57.100+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "475299",
                    "issueId": "13321194"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13321194/worklog/475387",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "pitrou closed pull request #7992:\nURL: https://github.com/apache/arrow/pull/7992\n\n\n   \n\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2020-08-27T16:11:01.706+0000",
                    "updated": "2020-08-27T16:11:01.706+0000",
                    "started": "2020-08-27T16:11:01.706+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "475387",
                    "issueId": "13321194"
                }
            ]
        },
        "customfield_12313920": null,
        "issuetype": {
            "self": "https://issues.apache.org/jira/rest/api/2/issuetype/1",
            "id": "1",
            "description": "A problem which impairs or prevents the functions of the product.",
            "iconUrl": "https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype",
            "name": "Bug",
            "subtask": false,
            "avatarId": 21133
        },
        "timespent": 8400,
        "customfield_12314020": "{summaryBean=com.atlassian.jira.plugin.devstatus.rest.SummaryBean@6015abcf[summary={pullrequest=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@7f2bd1a6[overall=PullRequestOverallBean{stateCount=0, state='OPEN', details=PullRequestOverallDetails{openCount=0, mergedCount=0, declinedCount=0}},byInstanceType={}], build=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@3a4bb500[overall=com.atlassian.jira.plugin.devstatus.summary.beans.BuildOverallBean@1b4cf50e[failedBuildCount=0,successfulBuildCount=0,unknownBuildCount=0,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], review=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@5412717d[overall=com.atlassian.jira.plugin.devstatus.summary.beans.ReviewsOverallBean@4ade2201[stateCount=0,state=<null>,dueDate=<null>,overDue=false,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], deployment-environment=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@2d5a7def[overall=com.atlassian.jira.plugin.devstatus.summary.beans.DeploymentOverallBean@514219cf[topEnvironments=[],showProjects=false,successfulCount=0,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], repository=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@169c0303[overall=com.atlassian.jira.plugin.devstatus.summary.beans.CommitOverallBean@2de9f5fb[count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], branch=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@53a240ac[overall=com.atlassian.jira.plugin.devstatus.summary.beans.BranchOverallBean@12efb776[count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}]},errors=[],configErrors=[]], devSummaryJson={\"cachedValue\":{\"errors\":[],\"configErrors\":[],\"summary\":{\"pullrequest\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"stateCount\":0,\"state\":\"OPEN\",\"details\":{\"openCount\":0,\"mergedCount\":0,\"declinedCount\":0,\"total\":0},\"open\":true},\"byInstanceType\":{}},\"build\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"failedBuildCount\":0,\"successfulBuildCount\":0,\"unknownBuildCount\":0},\"byInstanceType\":{}},\"review\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"stateCount\":0,\"state\":null,\"dueDate\":null,\"overDue\":false,\"completed\":false},\"byInstanceType\":{}},\"deployment-environment\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"topEnvironments\":[],\"showProjects\":false,\"successfulCount\":0},\"byInstanceType\":{}},\"repository\":{\"overall\":{\"count\":0,\"lastUpdated\":null},\"byInstanceType\":{}},\"branch\":{\"overall\":{\"count\":0,\"lastUpdated\":null},\"byInstanceType\":{}}}},\"isStale\":false}}",
        "customfield_12314141": null,
        "customfield_12314140": null,
        "project": {
            "self": "https://issues.apache.org/jira/rest/api/2/project/12319525",
            "id": "12319525",
            "key": "ARROW",
            "name": "Apache Arrow",
            "projectTypeKey": "software",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/projectavatar?pid=12319525&avatarId=10011",
                "24x24": "https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12319525&avatarId=10011",
                "16x16": "https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12319525&avatarId=10011",
                "32x32": "https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12319525&avatarId=10011"
            },
            "projectCategory": {
                "self": "https://issues.apache.org/jira/rest/api/2/projectCategory/13960",
                "id": "13960",
                "description": "Apache Arrow",
                "name": "Arrow"
            }
        },
        "aggregatetimespent": 8400,
        "customfield_12312520": null,
        "customfield_12312521": "Thu Aug 27 16:10:50 UTC 2020",
        "customfield_12314422": null,
        "customfield_12314421": null,
        "customfield_12314146": null,
        "customfield_12314420": null,
        "customfield_12314145": null,
        "customfield_12314144": null,
        "customfield_12314143": null,
        "resolutiondate": "2020-08-27T16:10:50.000+0000",
        "workratio": -1,
        "customfield_12312923": null,
        "customfield_12312920": null,
        "customfield_12312921": null,
        "watches": {
            "self": "https://issues.apache.org/jira/rest/api/2/issue/ARROW-9660/watchers",
            "watchCount": 1,
            "isWatching": false
        },
        "created": "2020-08-05T23:53:13.000+0000",
        "updated": "2020-08-29T19:36:38.000+0000",
        "timeoriginalestimate": null,
        "description": "I created the following record batch which has a single column with a type of map<dict, string> where dict is defined as: dict<int8,string>:\r\n\r\n\u00a0\r\n{code:java}\r\narrow::MapBuilder map_builder(arrow::default_memory_pool(),\r\n    std::make_shared<arrow::StringDictionaryBuilder>(),\r\n    std::make_shared<arrow::StringBuilder>());\r\nauto key_builder = \r\n    dynamic_cast<arrow::StringDictionaryBuilder *>(map_builder.key_builder());\r\nauto item_builder = \r\n    dynamic_cast<arrow::StringBuilder *>(map_builder.item_builder());\r\n\r\n// Add a first row with k<i>=v<i> for i 0..14;\r\nASSERT_OK(map_builder.Append());\r\nfor (int i = 0; i < 15; ++i) {\r\n  ASSERT_OK(key_builder->Append(\"k\" + std::to_string(i)));\r\n  ASSERT_OK(item_builder->Append(\"v\" + std::to_string(i)));\r\n}\r\n// Add a second row with k<i>=w<i> for i 0..14;\r\nASSERT_OK(map_builder.Append());\r\nfor (int i = 0; i < 15; ++i) {\r\n  ASSERT_OK(key_builder->Append(\"k\" + std::to_string(i)));\r\n  ASSERT_OK(item_builder->Append(\"w\" + std::to_string(i)));\r\n}\r\nstd::shared_ptr<arrow::Array> array;\r\nASSERT_OK(map_builder.Finish(&array));\r\nstd::shared_ptr<arrow::Schema> schema = \r\n    arrow::schema({arrow::field(\"s\", array->type())});\r\nstd::shared_ptr<arrow::RecordBatch> batch = \r\n    arrow::RecordBatch::Make(schema, array->length(), {array});\r\n{code}\r\nWhen one attempts to send this in a round trip IPC:\r\n # On IpcFormatWriter::Start(): The memo records one entry for field_to_id and id_to_type_ where the dict id = 0.\r\n # On IpcFormatWriter::CollectDictionaries: The memo records a new entry for field_to_id and id_to_type with id=1 and also records in id_to_dictionary_. At this point we have 2 entries with the entry id=0 having no associated dict.\r\n # On IpcFormatWriter;:WriteDictionaries: It writes the dict with entry = 1\r\n\r\nWhen reading:\r\n # GetSchema eventually gets to the nested dictionary in FieldFromFlatBuffer\r\n # The recovered dict id is 0.\r\n # This adds to the memo the field_to_id and id_to_type with id = 0\r\n # My round trip code calls \"ReadAll\".\r\n # RecordBatchStreamReaderImpl::ReadNext attempts to load the initial dicts\r\n # It recovers id = 1\r\n # The process aborts because id = 1 is not in the memo: dictionary_memo->GetDictionaryType(id, &value_type)\r\n\r\nA similar example with a dict inside a \"struct\" worked fine and only used dict id = 0. So it looks like something wrong when gathering the schema for the map. Unless I did not construct the map correctly?\r\n\r\n\u00a0",
        "customfield_10010": null,
        "timetracking": {
            "remainingEstimate": "0h",
            "timeSpent": "2h 20m",
            "remainingEstimateSeconds": 0,
            "timeSpentSeconds": 8400
        },
        "customfield_12314523": null,
        "customfield_12314127": null,
        "customfield_12314522": null,
        "customfield_12314126": null,
        "customfield_12314521": null,
        "customfield_12314125": null,
        "customfield_12314520": null,
        "customfield_12314124": null,
        "attachment": [],
        "customfield_12312340": null,
        "customfield_12314123": null,
        "customfield_12312341": null,
        "customfield_12312220": null,
        "customfield_12314122": null,
        "customfield_12314121": null,
        "customfield_12314120": null,
        "customfield_12314129": null,
        "customfield_12314524": null,
        "customfield_12314128": null,
        "summary": "[C++] IPC - dictionaries in maps",
        "customfield_12314130": null,
        "customfield_12310291": null,
        "customfield_12310290": null,
        "customfield_12314138": null,
        "customfield_12314137": null,
        "environment": null,
        "customfield_12314136": null,
        "customfield_12314135": null,
        "customfield_12311020": null,
        "customfield_12314134": null,
        "duedate": null,
        "customfield_12314132": null,
        "customfield_12314131": null,
        "comment": {
            "comments": [
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13321194/comment/17185941",
                    "id": "17185941",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=apitrou",
                        "name": "apitrou",
                        "key": "pitrou",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=pitrou&avatarId=35049",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=pitrou&avatarId=35049",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=pitrou&avatarId=35049",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=pitrou&avatarId=35049"
                        },
                        "displayName": "Antoine Pitrou",
                        "active": true,
                        "timeZone": "Europe/Paris"
                    },
                    "body": "Issue resolved by pull request 7992\n[https://github.com/apache/arrow/pull/7992]",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=apitrou",
                        "name": "apitrou",
                        "key": "pitrou",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=pitrou&avatarId=35049",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=pitrou&avatarId=35049",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=pitrou&avatarId=35049",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=pitrou&avatarId=35049"
                        },
                        "displayName": "Antoine Pitrou",
                        "active": true,
                        "timeZone": "Europe/Paris"
                    },
                    "created": "2020-08-27T16:10:50.440+0000",
                    "updated": "2020-08-27T16:10:50.440+0000"
                }
            ],
            "maxResults": 1,
            "total": 1,
            "startAt": 0
        },
        "customfield_12311820": "0|z0hihk:",
        "customfield_12314139": null
    }
}