{
    "expand": "operations,versionedRepresentations,editmeta,changelog,renderedFields",
    "id": "13365973",
    "self": "https://issues.apache.org/jira/rest/api/2/issue/13365973",
    "key": "ARROW-12012",
    "fields": {
        "fixVersions": [
            {
                "self": "https://issues.apache.org/jira/rest/api/2/version/12349493",
                "id": "12349493",
                "description": "",
                "name": "4.0.0",
                "archived": false,
                "released": true,
                "releaseDate": "2021-04-26"
            }
        ],
        "resolution": {
            "self": "https://issues.apache.org/jira/rest/api/2/resolution/1",
            "id": "1",
            "description": "A fix for this issue is checked into the tree and tested.",
            "name": "Fixed"
        },
        "customfield_12312322": null,
        "customfield_12312323": null,
        "customfield_12312320": null,
        "customfield_12310420": "9223372036854775807",
        "customfield_12312321": null,
        "customfield_12312328": null,
        "customfield_12312329": null,
        "customfield_12312326": null,
        "customfield_12310300": null,
        "customfield_12312327": null,
        "customfield_12312324": null,
        "customfield_12312720": null,
        "customfield_12312325": null,
        "lastViewed": null,
        "priority": {
            "self": "https://issues.apache.org/jira/rest/api/2/priority/3",
            "iconUrl": "https://issues.apache.org/jira/images/icons/priorities/major.svg",
            "name": "Major",
            "id": "3"
        },
        "labels": [
            "pull-request-available"
        ],
        "customfield_12312333": null,
        "customfield_12312334": null,
        "customfield_12313422": "false",
        "customfield_12310310": "0.0",
        "customfield_12312331": null,
        "customfield_12312332": null,
        "aggregatetimeoriginalestimate": null,
        "timeestimate": 0,
        "customfield_12312330": null,
        "versions": [
            {
                "self": "https://issues.apache.org/jira/rest/api/2/version/12348823",
                "id": "12348823",
                "description": "",
                "name": "3.0.0",
                "archived": false,
                "released": true,
                "releaseDate": "2021-01-25"
            }
        ],
        "customfield_12311120": null,
        "customfield_12313826": null,
        "customfield_12312339": null,
        "issuelinks": [],
        "customfield_12313825": null,
        "assignee": null,
        "customfield_12312337": null,
        "customfield_12313823": null,
        "customfield_12312338": null,
        "customfield_12311920": null,
        "customfield_12313822": null,
        "customfield_12312335": null,
        "customfield_12313821": null,
        "customfield_12312336": null,
        "customfield_12313820": null,
        "status": {
            "self": "https://issues.apache.org/jira/rest/api/2/status/5",
            "description": "A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.",
            "iconUrl": "https://issues.apache.org/jira/images/icons/statuses/resolved.png",
            "name": "Resolved",
            "id": "5",
            "statusCategory": {
                "self": "https://issues.apache.org/jira/rest/api/2/statuscategory/3",
                "id": 3,
                "key": "done",
                "colorName": "green",
                "name": "Done"
            }
        },
        "components": [
            {
                "self": "https://issues.apache.org/jira/rest/api/2/component/12328933",
                "id": "12328933",
                "name": "Java"
            }
        ],
        "customfield_12312026": null,
        "customfield_12312023": null,
        "customfield_12312024": null,
        "aggregatetimeestimate": 0,
        "customfield_12312022": null,
        "customfield_12310921": null,
        "customfield_12310920": "9223372036854775807",
        "customfield_12312823": null,
        "creator": {
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=zxf-nnn",
            "name": "zxf-nnn",
            "key": "zxf-nnn",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=zxf-nnn&avatarId=43619",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=zxf-nnn&avatarId=43619",
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=zxf-nnn&avatarId=43619",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=zxf-nnn&avatarId=43619"
            },
            "displayName": "Felix",
            "active": true,
            "timeZone": "Etc/UTC"
        },
        "subtasks": [],
        "reporter": {
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=zxf-nnn",
            "name": "zxf-nnn",
            "key": "zxf-nnn",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=zxf-nnn&avatarId=43619",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=zxf-nnn&avatarId=43619",
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=zxf-nnn&avatarId=43619",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=zxf-nnn&avatarId=43619"
            },
            "displayName": "Felix",
            "active": true,
            "timeZone": "Etc/UTC"
        },
        "aggregateprogress": {
            "progress": 9600,
            "total": 9600,
            "percent": 100
        },
        "customfield_12313520": null,
        "customfield_12310250": null,
        "progress": {
            "progress": 9600,
            "total": 9600,
            "percent": 100
        },
        "customfield_12313924": null,
        "votes": {
            "self": "https://issues.apache.org/jira/rest/api/2/issue/ARROW-12012/votes",
            "votes": 0,
            "hasVoted": false
        },
        "worklog": {
            "startAt": 0,
            "maxResults": 20,
            "total": 16,
            "worklogs": [
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13365973/worklog/568048",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "zxf opened a new pull request #9744:\nURL: https://github.com/apache/arrow/pull/9744\n\n\n   [ARROW-12012](https://issues.apache.org/jira/browse/ARROW-12012)\r\n   An exception will be thrown when BinaryConsumer consumes a large amount or a lot of data.\n\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2021-03-18T02:36:11.028+0000",
                    "updated": "2021-03-18T02:36:11.028+0000",
                    "started": "2021-03-18T02:36:11.027+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "568048",
                    "issueId": "13365973"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13365973/worklog/568049",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "github-actions[bot] commented on pull request #9744:\nURL: https://github.com/apache/arrow/pull/9744#issuecomment-801571749\n\n\n   https://issues.apache.org/jira/browse/ARROW-12012\n\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2021-03-18T02:36:24.495+0000",
                    "updated": "2021-03-18T02:36:24.495+0000",
                    "started": "2021-03-18T02:36:24.495+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "568049",
                    "issueId": "13365973"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13365973/worklog/568745",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "emkornfield commented on pull request #9744:\nURL: https://github.com/apache/arrow/pull/9744#issuecomment-802518342\n\n\n   @liyafan82 or @tianchen92 do you have time to review?\n\n\n-- \nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2021-03-19T03:24:04.677+0000",
                    "updated": "2021-03-19T03:24:04.677+0000",
                    "started": "2021-03-19T03:24:04.677+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "568745",
                    "issueId": "13365973"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13365973/worklog/568773",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "liyafan82 commented on pull request #9744:\nURL: https://github.com/apache/arrow/pull/9744#issuecomment-802541994\n\n\n   > @liyafan82 or @tianchen92 do you have time to review?\r\n   \r\n   @zxf Thanks for the patch. I will take a look.\n\n\n-- \nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2021-03-19T04:19:40.878+0000",
                    "updated": "2021-03-19T04:19:40.878+0000",
                    "started": "2021-03-19T04:19:40.877+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "568773",
                    "issueId": "13365973"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13365973/worklog/568776",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "liyafan82 commented on a change in pull request #9744:\nURL: https://github.com/apache/arrow/pull/9744#discussion_r597399290\n\n\n\n##########\nFile path: java/adapter/jdbc/src/main/java/org/apache/arrow/adapter/jdbc/consumer/BinaryConsumer.java\n##########\n@@ -57,30 +55,44 @@ public BinaryConsumer(VarBinaryVector vector, int index) {\n     }\n   }\n \n+  /**\n+   * Set the variable length element at the specified index to the supplied\n+   * byte array supplied in the input stream. Besides, it will handle the\n+   * case where index and length of new element are beyond the existing\n+   * capacity of the vector.\n+   *\n+   * @param vector   binary vector\n+   * @param index   position of the element to set\n+   * @param is   input stream\n+   */\n+  public static void setSafe(VarBinaryVector vector, int index, InputStream is) throws IOException {\n+    assert index >= 0;\n+    while (index >= vector.getValueCapacity()) {\n+      vector.reallocValidityAndOffsetBuffers();\n+    }\n+    final int startOffset = vector.getStartOffset(index);\n+    final ArrowBuf offsetBuffer = vector.getOffsetBuffer();\n+    int dataLength = 0;\n+    int read;\n+    byte[] bytes = new byte[BUFFER_SIZE];\n\nReview comment:\n       Repeated small allocations can be expensive. Can we reuse the buffer?\n\n\n\n\n-- \nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2021-03-19T04:27:49.688+0000",
                    "updated": "2021-03-19T04:27:49.688+0000",
                    "started": "2021-03-19T04:27:49.687+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "568776",
                    "issueId": "13365973"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13365973/worklog/568777",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "liyafan82 commented on a change in pull request #9744:\nURL: https://github.com/apache/arrow/pull/9744#discussion_r597399889\n\n\n\n##########\nFile path: java/adapter/jdbc/src/main/java/org/apache/arrow/adapter/jdbc/consumer/BinaryConsumer.java\n##########\n@@ -57,30 +55,44 @@ public BinaryConsumer(VarBinaryVector vector, int index) {\n     }\n   }\n \n+  /**\n+   * Set the variable length element at the specified index to the supplied\n+   * byte array supplied in the input stream. Besides, it will handle the\n+   * case where index and length of new element are beyond the existing\n+   * capacity of the vector.\n+   *\n+   * @param vector   binary vector\n+   * @param index   position of the element to set\n+   * @param is   input stream\n+   */\n+  public static void setSafe(VarBinaryVector vector, int index, InputStream is) throws IOException {\n+    assert index >= 0;\n+    while (index >= vector.getValueCapacity()) {\n+      vector.reallocValidityAndOffsetBuffers();\n+    }\n+    final int startOffset = vector.getStartOffset(index);\n+    final ArrowBuf offsetBuffer = vector.getOffsetBuffer();\n+    int dataLength = 0;\n+    int read;\n+    byte[] bytes = new byte[BUFFER_SIZE];\n+    while ((read = is.read(bytes)) != -1) {\n+      while (vector.getDataBuffer().capacity() < (startOffset + dataLength + read)) {\n+        vector.reallocDataBuffer();\n+      }\n+      vector.getDataBuffer().setBytes(startOffset + dataLength, bytes, 0, read);\n+      dataLength += read;\n+    }\n+    offsetBuffer.setInt((index + 1) * VarBinaryVector.OFFSET_WIDTH, startOffset + dataLength);\n+    BitVectorHelper.setBit(vector.getValidityBuffer(), index);\n+    vector.setLastSet(index);\n+  }\n+\n   /**\n    * consume a InputStream.\n    */\n   public void consume(InputStream is) throws IOException {\n     if (is != null) {\n-\n-      int read;\n-      byte[] bytes = new byte[BUFFER_SIZE];\n-      int totalBytes = 0;\n-\n-      ArrowBuf dataBuffer = vector.getDataBuffer();\n-      ArrowBuf offsetBuffer = vector.getOffsetBuffer();\n-      int startIndex = offsetBuffer.getInt(currentIndex * 4);\n-      while ((read = is.read(bytes)) != -1) {\n-        while ((dataBuffer.writerIndex() + read) > dataBuffer.capacity()) {\n-          vector.reallocDataBuffer();\n-        }\n-        PlatformDependent.copyMemory(bytes, 0,\n-                dataBuffer.memoryAddress() + startIndex + totalBytes, read);\n-        totalBytes += read;\n-      }\n-      offsetBuffer.setInt((currentIndex + 1) * 4, startIndex + totalBytes);\n-      BitVectorHelper.setBit(vector.getValidityBuffer(), currentIndex);\n-      vector.setLastSet(currentIndex);\n+      setSafe(vector, currentIndex, is);\n\nReview comment:\n       nit: it seems this method is simply enough. why extract another method?\n\n\n\n\n-- \nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2021-03-19T04:29:43.302+0000",
                    "updated": "2021-03-19T04:29:43.302+0000",
                    "started": "2021-03-19T04:29:43.302+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "568777",
                    "issueId": "13365973"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13365973/worklog/568778",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "liyafan82 commented on a change in pull request #9744:\nURL: https://github.com/apache/arrow/pull/9744#discussion_r597400475\n\n\n\n##########\nFile path: java/adapter/jdbc/src/test/java/org/apache/arrow/adapter/jdbc/consumer/BinaryConsumerTest.java\n##########\n@@ -0,0 +1,116 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *    http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.apache.arrow.adapter.jdbc.consumer;\n+\n+import static org.junit.Assert.*;\n\nReview comment:\n       Please split this into a number of import statements for each class. \n\n\n\n\n-- \nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2021-03-19T04:31:50.393+0000",
                    "updated": "2021-03-19T04:31:50.393+0000",
                    "started": "2021-03-19T04:31:50.392+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "568778",
                    "issueId": "13365973"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13365973/worklog/568779",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "liyafan82 commented on a change in pull request #9744:\nURL: https://github.com/apache/arrow/pull/9744#discussion_r597401010\n\n\n\n##########\nFile path: java/adapter/jdbc/src/test/java/org/apache/arrow/adapter/jdbc/consumer/BinaryConsumerTest.java\n##########\n@@ -0,0 +1,116 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *    http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.apache.arrow.adapter.jdbc.consumer;\n+\n+import static org.junit.Assert.*;\n+\n+import java.io.ByteArrayInputStream;\n+import java.io.IOException;\n+import java.util.function.Consumer;\n+\n+import org.apache.arrow.vector.BaseValueVector;\n+import org.apache.arrow.vector.VarBinaryVector;\n+import org.junit.Test;\n+\n+public class BinaryConsumerTest extends AbstractConsumerTest {\n+\n+  private static final int INITIAL_VALUE_ALLOCATION = BaseValueVector.INITIAL_VALUE_ALLOCATION;\n+  private static final int DEFAULT_RECORD_BYTE_COUNT = 8;\n+\n+  protected void assertConsume(boolean nullable, Consumer<BinaryConsumer> dataConsumer, byte[][] expect) {\n+    try (final VarBinaryVector vector = new VarBinaryVector(\"binary\", allocator)) {\n+      BinaryConsumer consumer = BinaryConsumer.createConsumer(vector, 0, nullable);\n+      dataConsumer.accept(consumer);\n+      assertEquals(expect.length - 1, vector.getLastSet());\n\nReview comment:\n       we also need `assertEquals(expect.length, vector.getValueCount);` ?\n\n\n\n\n-- \nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2021-03-19T04:33:54.010+0000",
                    "updated": "2021-03-19T04:33:54.010+0000",
                    "started": "2021-03-19T04:33:54.010+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "568779",
                    "issueId": "13365973"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13365973/worklog/568780",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "liyafan82 commented on a change in pull request #9744:\nURL: https://github.com/apache/arrow/pull/9744#discussion_r597401786\n\n\n\n##########\nFile path: java/adapter/jdbc/src/test/java/org/apache/arrow/adapter/jdbc/consumer/BinaryConsumerTest.java\n##########\n@@ -0,0 +1,116 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *    http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.apache.arrow.adapter.jdbc.consumer;\n+\n+import static org.junit.Assert.*;\n+\n+import java.io.ByteArrayInputStream;\n+import java.io.IOException;\n+import java.util.function.Consumer;\n+\n+import org.apache.arrow.vector.BaseValueVector;\n+import org.apache.arrow.vector.VarBinaryVector;\n+import org.junit.Test;\n+\n+public class BinaryConsumerTest extends AbstractConsumerTest {\n+\n+  private static final int INITIAL_VALUE_ALLOCATION = BaseValueVector.INITIAL_VALUE_ALLOCATION;\n+  private static final int DEFAULT_RECORD_BYTE_COUNT = 8;\n+\n+  protected void assertConsume(boolean nullable, Consumer<BinaryConsumer> dataConsumer, byte[][] expect) {\n+    try (final VarBinaryVector vector = new VarBinaryVector(\"binary\", allocator)) {\n+      BinaryConsumer consumer = BinaryConsumer.createConsumer(vector, 0, nullable);\n+      dataConsumer.accept(consumer);\n+      assertEquals(expect.length - 1, vector.getLastSet());\n+      for (int i = 0; i < expect.length; i++) {\n+        byte[] value = expect[i];\n+        if (value == null) {\n+          assertTrue(vector.isNull(i));\n+        } else {\n+          assertArrayEquals(expect[i], vector.get(i));\n+        }\n+      }\n+    }\n+  }\n+\n+  private byte[] createBytes(int length) {\n+    byte[] bytes = new byte[length];\n+    for (int i = 0; i < length; i++) {\n+      bytes[i] = (byte) (i % 1024);\n+    }\n+    return bytes;\n+  }\n+\n+\n+  public void testConsumeInputStream(byte[][] values, boolean nullable) throws IOException {\n+    assertConsume(nullable, binaryConsumer -> {\n+      for (byte[] value : values) {\n+        try {\n+          binaryConsumer.consume(new ByteArrayInputStream(value));\n+        } catch (IOException e) {\n+          e.printStackTrace();\n\nReview comment:\n       why swallow the exception?\n\n\n\n\n-- \nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2021-03-19T04:37:08.190+0000",
                    "updated": "2021-03-19T04:37:08.190+0000",
                    "started": "2021-03-19T04:37:08.190+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "568780",
                    "issueId": "13365973"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13365973/worklog/568781",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "liyafan82 commented on a change in pull request #9744:\nURL: https://github.com/apache/arrow/pull/9744#discussion_r597402341\n\n\n\n##########\nFile path: java/adapter/jdbc/src/test/java/org/apache/arrow/adapter/jdbc/consumer/BinaryConsumerTest.java\n##########\n@@ -0,0 +1,116 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *    http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.apache.arrow.adapter.jdbc.consumer;\n+\n+import static org.junit.Assert.*;\n+\n+import java.io.ByteArrayInputStream;\n+import java.io.IOException;\n+import java.util.function.Consumer;\n+\n+import org.apache.arrow.vector.BaseValueVector;\n+import org.apache.arrow.vector.VarBinaryVector;\n+import org.junit.Test;\n+\n+public class BinaryConsumerTest extends AbstractConsumerTest {\n+\n+  private static final int INITIAL_VALUE_ALLOCATION = BaseValueVector.INITIAL_VALUE_ALLOCATION;\n+  private static final int DEFAULT_RECORD_BYTE_COUNT = 8;\n+\n+  protected void assertConsume(boolean nullable, Consumer<BinaryConsumer> dataConsumer, byte[][] expect) {\n+    try (final VarBinaryVector vector = new VarBinaryVector(\"binary\", allocator)) {\n+      BinaryConsumer consumer = BinaryConsumer.createConsumer(vector, 0, nullable);\n+      dataConsumer.accept(consumer);\n+      assertEquals(expect.length - 1, vector.getLastSet());\n+      for (int i = 0; i < expect.length; i++) {\n+        byte[] value = expect[i];\n+        if (value == null) {\n+          assertTrue(vector.isNull(i));\n+        } else {\n+          assertArrayEquals(expect[i], vector.get(i));\n+        }\n+      }\n+    }\n+  }\n+\n+  private byte[] createBytes(int length) {\n+    byte[] bytes = new byte[length];\n+    for (int i = 0; i < length; i++) {\n+      bytes[i] = (byte) (i % 1024);\n+    }\n+    return bytes;\n+  }\n+\n+\n+  public void testConsumeInputStream(byte[][] values, boolean nullable) throws IOException {\n+    assertConsume(nullable, binaryConsumer -> {\n+      for (byte[] value : values) {\n+        try {\n+          binaryConsumer.consume(new ByteArrayInputStream(value));\n+        } catch (IOException e) {\n+          e.printStackTrace();\n+        }\n+        binaryConsumer.moveWriterPosition();\n+      }\n+    }, values);\n+  }\n+\n+  @Test\n+  public void testConsumeInputStream() throws IOException {\n+    testConsumeInputStream(new byte[][]{\n+        createBytes(DEFAULT_RECORD_BYTE_COUNT)\n+    }, false);\n+\n+    testConsumeInputStream(new byte[][]{\n+        createBytes(DEFAULT_RECORD_BYTE_COUNT),\n+        createBytes(DEFAULT_RECORD_BYTE_COUNT)\n+    }, false);\n+\n+    testConsumeInputStream(new byte[][]{\n+        createBytes(DEFAULT_RECORD_BYTE_COUNT * 2),\n+        createBytes(DEFAULT_RECORD_BYTE_COUNT),\n+        createBytes(DEFAULT_RECORD_BYTE_COUNT)\n+    }, false);\n+\n+    testConsumeInputStream(new byte[][]{\n+        createBytes(INITIAL_VALUE_ALLOCATION * DEFAULT_RECORD_BYTE_COUNT)\n+    }, false);\n+\n+    testConsumeInputStream(new byte[][]{\n+        createBytes(INITIAL_VALUE_ALLOCATION * DEFAULT_RECORD_BYTE_COUNT * 10),\n+    }, false);\n\nReview comment:\n       do we need a case for `nullable = true`\n\n\n\n\n-- \nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2021-03-19T04:38:52.025+0000",
                    "updated": "2021-03-19T04:38:52.025+0000",
                    "started": "2021-03-19T04:38:52.025+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "568781",
                    "issueId": "13365973"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13365973/worklog/569367",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "zxf commented on a change in pull request #9744:\nURL: https://github.com/apache/arrow/pull/9744#discussion_r598270779\n\n\n\n##########\nFile path: java/adapter/jdbc/src/test/java/org/apache/arrow/adapter/jdbc/consumer/BinaryConsumerTest.java\n##########\n@@ -0,0 +1,116 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *    http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.apache.arrow.adapter.jdbc.consumer;\n+\n+import static org.junit.Assert.*;\n+\n+import java.io.ByteArrayInputStream;\n+import java.io.IOException;\n+import java.util.function.Consumer;\n+\n+import org.apache.arrow.vector.BaseValueVector;\n+import org.apache.arrow.vector.VarBinaryVector;\n+import org.junit.Test;\n+\n+public class BinaryConsumerTest extends AbstractConsumerTest {\n+\n+  private static final int INITIAL_VALUE_ALLOCATION = BaseValueVector.INITIAL_VALUE_ALLOCATION;\n+  private static final int DEFAULT_RECORD_BYTE_COUNT = 8;\n+\n+  protected void assertConsume(boolean nullable, Consumer<BinaryConsumer> dataConsumer, byte[][] expect) {\n+    try (final VarBinaryVector vector = new VarBinaryVector(\"binary\", allocator)) {\n+      BinaryConsumer consumer = BinaryConsumer.createConsumer(vector, 0, nullable);\n+      dataConsumer.accept(consumer);\n+      assertEquals(expect.length - 1, vector.getLastSet());\n+      for (int i = 0; i < expect.length; i++) {\n+        byte[] value = expect[i];\n+        if (value == null) {\n+          assertTrue(vector.isNull(i));\n+        } else {\n+          assertArrayEquals(expect[i], vector.get(i));\n+        }\n+      }\n+    }\n+  }\n+\n+  private byte[] createBytes(int length) {\n+    byte[] bytes = new byte[length];\n+    for (int i = 0; i < length; i++) {\n+      bytes[i] = (byte) (i % 1024);\n+    }\n+    return bytes;\n+  }\n+\n+\n+  public void testConsumeInputStream(byte[][] values, boolean nullable) throws IOException {\n+    assertConsume(nullable, binaryConsumer -> {\n+      for (byte[] value : values) {\n+        try {\n+          binaryConsumer.consume(new ByteArrayInputStream(value));\n+        } catch (IOException e) {\n+          e.printStackTrace();\n+        }\n+        binaryConsumer.moveWriterPosition();\n+      }\n+    }, values);\n+  }\n+\n+  @Test\n+  public void testConsumeInputStream() throws IOException {\n+    testConsumeInputStream(new byte[][]{\n+        createBytes(DEFAULT_RECORD_BYTE_COUNT)\n+    }, false);\n+\n+    testConsumeInputStream(new byte[][]{\n+        createBytes(DEFAULT_RECORD_BYTE_COUNT),\n+        createBytes(DEFAULT_RECORD_BYTE_COUNT)\n+    }, false);\n+\n+    testConsumeInputStream(new byte[][]{\n+        createBytes(DEFAULT_RECORD_BYTE_COUNT * 2),\n+        createBytes(DEFAULT_RECORD_BYTE_COUNT),\n+        createBytes(DEFAULT_RECORD_BYTE_COUNT)\n+    }, false);\n+\n+    testConsumeInputStream(new byte[][]{\n+        createBytes(INITIAL_VALUE_ALLOCATION * DEFAULT_RECORD_BYTE_COUNT)\n+    }, false);\n+\n+    testConsumeInputStream(new byte[][]{\n+        createBytes(INITIAL_VALUE_ALLOCATION * DEFAULT_RECORD_BYTE_COUNT * 10),\n+    }, false);\n\nReview comment:\n       According to the original logic, when a nullable consumer processes a null value, it just adds 1 to its own index and does not modify the content of the vector. And set the rowCount in ArrowVectorIterator.\n\n\n\n\n-- \nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2021-03-21T12:21:40.483+0000",
                    "updated": "2021-03-21T12:21:40.483+0000",
                    "started": "2021-03-21T12:21:40.483+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "569367",
                    "issueId": "13365973"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13365973/worklog/569369",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "zxf commented on a change in pull request #9744:\nURL: https://github.com/apache/arrow/pull/9744#discussion_r598271865\n\n\n\n##########\nFile path: java/adapter/jdbc/src/test/java/org/apache/arrow/adapter/jdbc/consumer/BinaryConsumerTest.java\n##########\n@@ -0,0 +1,116 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *    http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.apache.arrow.adapter.jdbc.consumer;\n+\n+import static org.junit.Assert.*;\n+\n+import java.io.ByteArrayInputStream;\n+import java.io.IOException;\n+import java.util.function.Consumer;\n+\n+import org.apache.arrow.vector.BaseValueVector;\n+import org.apache.arrow.vector.VarBinaryVector;\n+import org.junit.Test;\n+\n+public class BinaryConsumerTest extends AbstractConsumerTest {\n+\n+  private static final int INITIAL_VALUE_ALLOCATION = BaseValueVector.INITIAL_VALUE_ALLOCATION;\n+  private static final int DEFAULT_RECORD_BYTE_COUNT = 8;\n+\n+  protected void assertConsume(boolean nullable, Consumer<BinaryConsumer> dataConsumer, byte[][] expect) {\n+    try (final VarBinaryVector vector = new VarBinaryVector(\"binary\", allocator)) {\n+      BinaryConsumer consumer = BinaryConsumer.createConsumer(vector, 0, nullable);\n+      dataConsumer.accept(consumer);\n+      assertEquals(expect.length - 1, vector.getLastSet());\n\nReview comment:\n       The valueCount is set outside the consumer. So if only the consumer is called, the valueCount will always be zero.\n\n\n\n\n-- \nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2021-03-21T12:29:21.844+0000",
                    "updated": "2021-03-21T12:29:21.844+0000",
                    "started": "2021-03-21T12:29:21.844+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "569369",
                    "issueId": "13365973"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13365973/worklog/570183",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "liyafan82 commented on pull request #9744:\nURL: https://github.com/apache/arrow/pull/9744#issuecomment-804525164\n\n\n   Rerunning integration tests. The failure seems unrelated.\n\n\n-- \nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2021-03-23T01:58:19.090+0000",
                    "updated": "2021-03-23T01:58:19.090+0000",
                    "started": "2021-03-23T01:58:19.090+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "570183",
                    "issueId": "13365973"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13365973/worklog/570184",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "liyafan82 commented on pull request #9744:\nURL: https://github.com/apache/arrow/pull/9744#issuecomment-804525245\n\n\n   Mostly look good. Thank you @zxf \n\n\n-- \nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2021-03-23T01:58:32.089+0000",
                    "updated": "2021-03-23T01:58:32.089+0000",
                    "started": "2021-03-23T01:58:32.089+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "570184",
                    "issueId": "13365973"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13365973/worklog/570878",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "liyafan82 commented on pull request #9744:\nURL: https://github.com/apache/arrow/pull/9744#issuecomment-805416730\n\n\n   +1. Thanks @zxf \n\n\n-- \nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2021-03-24T02:03:46.682+0000",
                    "updated": "2021-03-24T02:03:46.682+0000",
                    "started": "2021-03-24T02:03:46.681+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "570878",
                    "issueId": "13365973"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13365973/worklog/570896",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "liyafan82 closed pull request #9744:\nURL: https://github.com/apache/arrow/pull/9744\n\n\n   \n\n\n-- \nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2021-03-24T02:35:46.750+0000",
                    "updated": "2021-03-24T02:35:46.750+0000",
                    "started": "2021-03-24T02:35:46.750+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "570896",
                    "issueId": "13365973"
                }
            ]
        },
        "customfield_12313920": null,
        "issuetype": {
            "self": "https://issues.apache.org/jira/rest/api/2/issuetype/1",
            "id": "1",
            "description": "A problem which impairs or prevents the functions of the product.",
            "iconUrl": "https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype",
            "name": "Bug",
            "subtask": false,
            "avatarId": 21133
        },
        "timespent": 9600,
        "customfield_12314020": "{summaryBean=com.atlassian.jira.plugin.devstatus.rest.SummaryBean@7323d4f7[summary={pullrequest=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@7139e1f6[overall=PullRequestOverallBean{stateCount=0, state='OPEN', details=PullRequestOverallDetails{openCount=0, mergedCount=0, declinedCount=0}},byInstanceType={}], build=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@1e0c83e3[overall=com.atlassian.jira.plugin.devstatus.summary.beans.BuildOverallBean@2084f785[failedBuildCount=0,successfulBuildCount=0,unknownBuildCount=0,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], review=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@662aa24e[overall=com.atlassian.jira.plugin.devstatus.summary.beans.ReviewsOverallBean@3e3f365a[stateCount=0,state=<null>,dueDate=<null>,overDue=false,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], deployment-environment=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@44d6a9e5[overall=com.atlassian.jira.plugin.devstatus.summary.beans.DeploymentOverallBean@43e94625[topEnvironments=[],showProjects=false,successfulCount=0,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], repository=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@7062a4c4[overall=com.atlassian.jira.plugin.devstatus.summary.beans.CommitOverallBean@37a8d174[count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], branch=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@46c0dfe5[overall=com.atlassian.jira.plugin.devstatus.summary.beans.BranchOverallBean@4f116176[count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}]},errors=[],configErrors=[]], devSummaryJson={\"cachedValue\":{\"errors\":[],\"configErrors\":[],\"summary\":{\"pullrequest\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"stateCount\":0,\"state\":\"OPEN\",\"details\":{\"openCount\":0,\"mergedCount\":0,\"declinedCount\":0,\"total\":0},\"open\":true},\"byInstanceType\":{}},\"build\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"failedBuildCount\":0,\"successfulBuildCount\":0,\"unknownBuildCount\":0},\"byInstanceType\":{}},\"review\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"stateCount\":0,\"state\":null,\"dueDate\":null,\"overDue\":false,\"completed\":false},\"byInstanceType\":{}},\"deployment-environment\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"topEnvironments\":[],\"showProjects\":false,\"successfulCount\":0},\"byInstanceType\":{}},\"repository\":{\"overall\":{\"count\":0,\"lastUpdated\":null},\"byInstanceType\":{}},\"branch\":{\"overall\":{\"count\":0,\"lastUpdated\":null},\"byInstanceType\":{}}}},\"isStale\":false}}",
        "customfield_12314141": null,
        "customfield_12314140": null,
        "project": {
            "self": "https://issues.apache.org/jira/rest/api/2/project/12319525",
            "id": "12319525",
            "key": "ARROW",
            "name": "Apache Arrow",
            "projectTypeKey": "software",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/projectavatar?pid=12319525&avatarId=10011",
                "24x24": "https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12319525&avatarId=10011",
                "16x16": "https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12319525&avatarId=10011",
                "32x32": "https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12319525&avatarId=10011"
            },
            "projectCategory": {
                "self": "https://issues.apache.org/jira/rest/api/2/projectCategory/13960",
                "id": "13960",
                "description": "Apache Arrow",
                "name": "Arrow"
            }
        },
        "aggregatetimespent": 9600,
        "customfield_12312520": null,
        "customfield_12312521": "Wed Mar 24 02:35:42 UTC 2021",
        "customfield_12314422": null,
        "customfield_12314421": null,
        "customfield_12314146": null,
        "customfield_12314420": null,
        "customfield_12314145": null,
        "customfield_12314144": null,
        "customfield_12314143": null,
        "resolutiondate": "2021-03-24T02:35:42.000+0000",
        "workratio": -1,
        "customfield_12312923": null,
        "customfield_12312920": null,
        "customfield_12312921": null,
        "watches": {
            "self": "https://issues.apache.org/jira/rest/api/2/issue/ARROW-12012/watchers",
            "watchCount": 1,
            "isWatching": false
        },
        "created": "2021-03-18T02:19:50.000+0000",
        "updated": "2021-03-24T02:35:47.000+0000",
        "timeoriginalestimate": null,
        "description": "The data buffer reallocation logic of BinaryConsumer is wrong, and it doesn\u2019t handle the case where offset buffer is exceeded.\r\n\r\n\u00a0",
        "customfield_10010": null,
        "timetracking": {
            "remainingEstimate": "0h",
            "timeSpent": "2h 40m",
            "remainingEstimateSeconds": 0,
            "timeSpentSeconds": 9600
        },
        "customfield_12314523": null,
        "customfield_12314127": null,
        "customfield_12314522": null,
        "customfield_12314126": null,
        "customfield_12314521": null,
        "customfield_12314125": null,
        "customfield_12314520": null,
        "customfield_12314124": null,
        "attachment": [],
        "customfield_12312340": null,
        "customfield_12314123": null,
        "customfield_12312341": null,
        "customfield_12312220": null,
        "customfield_12314122": null,
        "customfield_12314121": null,
        "customfield_12314120": null,
        "customfield_12314129": null,
        "customfield_12314524": null,
        "customfield_12314128": null,
        "summary": "[Java] [JDBC] BinaryConsumer cannot reallocate memory correctly",
        "customfield_12314130": null,
        "customfield_12310291": null,
        "customfield_12310290": null,
        "customfield_12314138": null,
        "customfield_12314137": null,
        "environment": null,
        "customfield_12314136": null,
        "customfield_12314135": null,
        "customfield_12311020": "https://github.com/apache/arrow/pull/9744",
        "customfield_12314134": null,
        "duedate": null,
        "customfield_12314132": null,
        "customfield_12314131": null,
        "comment": {
            "comments": [
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13365973/comment/17307516",
                    "id": "17307516",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=fan_li_ya",
                        "name": "fan_li_ya",
                        "key": "fan_li_ya",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=34045",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34045",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34045",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34045"
                        },
                        "displayName": "Liya Fan",
                        "active": true,
                        "timeZone": "Asia/Shanghai"
                    },
                    "body": "Issue resolved by pull request 9744\n[https://github.com/apache/arrow/pull/9744]",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=fan_li_ya",
                        "name": "fan_li_ya",
                        "key": "fan_li_ya",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=34045",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34045",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34045",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34045"
                        },
                        "displayName": "Liya Fan",
                        "active": true,
                        "timeZone": "Asia/Shanghai"
                    },
                    "created": "2021-03-24T02:35:42.060+0000",
                    "updated": "2021-03-24T02:35:42.060+0000"
                }
            ],
            "maxResults": 1,
            "total": 1,
            "startAt": 0
        },
        "customfield_12311820": "0|z0owzc:",
        "customfield_12314139": null
    }
}