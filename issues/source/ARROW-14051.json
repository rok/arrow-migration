{
    "expand": "operations,versionedRepresentations,editmeta,changelog,renderedFields",
    "id": "13402384",
    "self": "https://issues.apache.org/jira/rest/api/2/issue/13402384",
    "key": "ARROW-14051",
    "fields": {
        "fixVersions": [
            {
                "self": "https://issues.apache.org/jira/rest/api/2/version/12350591",
                "id": "12350591",
                "description": "",
                "name": "7.0.0",
                "archived": false,
                "released": true,
                "releaseDate": "2022-02-03"
            }
        ],
        "resolution": {
            "self": "https://issues.apache.org/jira/rest/api/2/resolution/1",
            "id": "1",
            "description": "A fix for this issue is checked into the tree and tested.",
            "name": "Fixed"
        },
        "customfield_12312322": null,
        "customfield_12312323": null,
        "customfield_12312320": null,
        "customfield_12310420": "9223372036854775807",
        "customfield_12312321": null,
        "customfield_12312328": null,
        "customfield_12312329": null,
        "customfield_12312326": null,
        "customfield_12310300": null,
        "customfield_12312327": null,
        "customfield_12312324": null,
        "customfield_12312720": null,
        "customfield_12312325": null,
        "lastViewed": null,
        "priority": {
            "self": "https://issues.apache.org/jira/rest/api/2/priority/3",
            "iconUrl": "https://issues.apache.org/jira/images/icons/priorities/major.svg",
            "name": "Major",
            "id": "3"
        },
        "labels": [
            "pull-request-available",
            "query-engine"
        ],
        "customfield_12312333": null,
        "customfield_12312334": null,
        "customfield_12313422": "false",
        "customfield_12310310": "0.0",
        "customfield_12312331": null,
        "customfield_12312332": null,
        "aggregatetimeoriginalestimate": null,
        "timeestimate": 0,
        "customfield_12312330": null,
        "versions": [],
        "customfield_12311120": null,
        "customfield_12313826": null,
        "customfield_12312339": null,
        "issuelinks": [],
        "customfield_12313825": null,
        "assignee": {
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=paleolimbot",
            "name": "paleolimbot",
            "key": "paleolimbot",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=paleolimbot&avatarId=47795",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=paleolimbot&avatarId=47795",
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=paleolimbot&avatarId=47795",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=paleolimbot&avatarId=47795"
            },
            "displayName": "Dewey Dunnington",
            "active": true,
            "timeZone": "America/Halifax"
        },
        "customfield_12312337": null,
        "customfield_12313823": null,
        "customfield_12312338": null,
        "customfield_12311920": null,
        "customfield_12313822": null,
        "customfield_12312335": null,
        "customfield_12313821": null,
        "customfield_12312336": null,
        "customfield_12313820": null,
        "status": {
            "self": "https://issues.apache.org/jira/rest/api/2/status/5",
            "description": "A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.",
            "iconUrl": "https://issues.apache.org/jira/images/icons/statuses/resolved.png",
            "name": "Resolved",
            "id": "5",
            "statusCategory": {
                "self": "https://issues.apache.org/jira/rest/api/2/statuscategory/3",
                "id": 3,
                "key": "done",
                "colorName": "green",
                "name": "Done"
            }
        },
        "components": [
            {
                "self": "https://issues.apache.org/jira/rest/api/2/component/12333008",
                "id": "12333008",
                "name": "R"
            }
        ],
        "customfield_12312026": null,
        "customfield_12312023": null,
        "customfield_12312024": null,
        "aggregatetimeestimate": 0,
        "customfield_12312022": null,
        "customfield_12310921": null,
        "customfield_12310920": "9223372036854775807",
        "customfield_12312823": null,
        "creator": {
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=icook",
            "name": "icook",
            "key": "icook",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=icook&avatarId=29388",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=icook&avatarId=29388",
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=icook&avatarId=29388",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=icook&avatarId=29388"
            },
            "displayName": "Ian Cook",
            "active": true,
            "timeZone": "America/New_York"
        },
        "subtasks": [],
        "reporter": {
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=icook",
            "name": "icook",
            "key": "icook",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=icook&avatarId=29388",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=icook&avatarId=29388",
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=icook&avatarId=29388",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=icook&avatarId=29388"
            },
            "displayName": "Ian Cook",
            "active": true,
            "timeZone": "America/New_York"
        },
        "aggregateprogress": {
            "progress": 12000,
            "total": 12000,
            "percent": 100
        },
        "customfield_12313520": null,
        "customfield_12310250": null,
        "progress": {
            "progress": 12000,
            "total": 12000,
            "percent": 100
        },
        "customfield_12313924": null,
        "votes": {
            "self": "https://issues.apache.org/jira/rest/api/2/issue/ARROW-14051/votes",
            "votes": 0,
            "hasVoted": false
        },
        "worklog": {
            "startAt": 0,
            "maxResults": 20,
            "total": 20,
            "worklogs": [
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13402384/worklog/676675",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "paleolimbot opened a new pull request #11612:\nURL: https://github.com/apache/arrow/pull/11612\n\n\n   This PR more correctly passes on type information for the temporary columns that are created when nested expressions exist. This isn't needed often, but occasionally the expression type is checked for the purposes of erroring or warning. The two examples where this happens are `ifelse()` and `case_when()`, which resulted in the following (valid) code pulling data into R with a confusing message:\r\n   \r\n   ``` r\r\n   library(arrow, warn.conflicts = FALSE)\r\n   library(dplyr, warn.conflicts = FALSE)\r\n   \r\n   # motvating example\r\n   RecordBatch$create(x = c(0, 1, 1), y = c(2, 3, 5), z = c(8, 13, 21)) %>%\r\n     group_by(x) %>%\r\n     summarise(r = ifelse(n() > 1, mean(y), mean(z))) %>% \r\n     collect()\r\n   #> Warning: Error : Expression ifelse(..temp0 > 1, ..temp1, ..temp2) not supported\r\n   #> in Arrow; pulling data into R\r\n   #> # A tibble: 2 \u00d7 2\r\n   #>       x     r\r\n   #>   <dbl> <dbl>\r\n   #> 1     0     8\r\n   #> 2     1     4\r\n   ```\r\n   \r\n   After this PR, the above works without warning:\r\n   \r\n   ``` r\r\n   library(arrow, warn.conflicts = FALSE)\r\n   library(dplyr, warn.conflicts = FALSE)\r\n   \r\n   # motvating example\r\n   RecordBatch$create(x = c(0, 1, 1), y = c(2, 3, 5), z = c(8, 13, 21)) %>%\r\n     group_by(x) %>%\r\n     summarise(r = ifelse(n() > 1, mean(y), mean(z))) %>% \r\n     collect()\r\n   #> # A tibble: 2 \u00d7 2\r\n   #>       x     r\r\n   #>   <dbl> <dbl>\r\n   #> 1     0     8\r\n   #> 2     1     4\r\n   ```\r\n   \r\n   I imagine I'm missing some of the complexity here...feel free to let me know!\n\n\n-- \nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nTo unsubscribe, e-mail: github-unsubscribe@arrow.apache.org\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2021-11-04T19:38:57.724+0000",
                    "updated": "2021-11-04T19:38:57.724+0000",
                    "started": "2021-11-04T19:38:57.724+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "676675",
                    "issueId": "13402384"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13402384/worklog/676676",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "github-actions[bot] commented on pull request #11612:\nURL: https://github.com/apache/arrow/pull/11612#issuecomment-961358716\n\n\n\n\n\n\n-- \nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nTo unsubscribe, e-mail: github-unsubscribe@arrow.apache.org\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2021-11-04T19:39:11.594+0000",
                    "updated": "2021-11-04T19:39:11.594+0000",
                    "started": "2021-11-04T19:39:11.594+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "676676",
                    "issueId": "13402384"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13402384/worklog/677231",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "paleolimbot opened a new pull request #11612:\nURL: https://github.com/apache/arrow/pull/11612\n\n\n   This PR more correctly passes on type information for the temporary columns that are created when nested expressions exist. This isn't needed often, but occasionally the expression type is checked for the purposes of erroring or warning. The two examples where this happens are `ifelse()` and `case_when()`, which resulted in the following (valid) code pulling data into R with a confusing message:\r\n   \r\n   ``` r\r\n   library(arrow, warn.conflicts = FALSE)\r\n   library(dplyr, warn.conflicts = FALSE)\r\n   \r\n   # motvating example\r\n   RecordBatch$create(x = c(0, 1, 1), y = c(2, 3, 5), z = c(8, 13, 21)) %>%\r\n     group_by(x) %>%\r\n     summarise(r = ifelse(n() > 1, mean(y), mean(z))) %>% \r\n     collect()\r\n   #> Warning: Error : Expression ifelse(..temp0 > 1, ..temp1, ..temp2) not supported\r\n   #> in Arrow; pulling data into R\r\n   #> # A tibble: 2 \u00d7 2\r\n   #>       x     r\r\n   #>   <dbl> <dbl>\r\n   #> 1     0     8\r\n   #> 2     1     4\r\n   ```\r\n   \r\n   After this PR, the above works without warning:\r\n   \r\n   ``` r\r\n   library(arrow, warn.conflicts = FALSE)\r\n   library(dplyr, warn.conflicts = FALSE)\r\n   \r\n   # motvating example\r\n   RecordBatch$create(x = c(0, 1, 1), y = c(2, 3, 5), z = c(8, 13, 21)) %>%\r\n     group_by(x) %>%\r\n     summarise(r = ifelse(n() > 1, mean(y), mean(z))) %>% \r\n     collect()\r\n   #> # A tibble: 2 \u00d7 2\r\n   #>       x     r\r\n   #>   <dbl> <dbl>\r\n   #> 1     0     8\r\n   #> 2     1     4\r\n   ```\r\n   \r\n   I imagine I'm missing some of the complexity here...feel free to let me know!\n\n\n-- \nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nTo unsubscribe, e-mail: github-unsubscribe@arrow.apache.org\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2021-11-05T19:25:50.755+0000",
                    "updated": "2021-11-05T19:25:50.755+0000",
                    "started": "2021-11-05T19:25:50.754+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "677231",
                    "issueId": "13402384"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13402384/worklog/677429",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "github-actions[bot] commented on pull request #11612:\nURL: https://github.com/apache/arrow/pull/11612#issuecomment-961358716\n\n\n\n\n\n\n-- \nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nTo unsubscribe, e-mail: github-unsubscribe@arrow.apache.org\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2021-11-05T19:51:10.412+0000",
                    "updated": "2021-11-05T19:51:10.412+0000",
                    "started": "2021-11-05T19:51:10.412+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "677429",
                    "issueId": "13402384"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13402384/worklog/677634",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "paleolimbot opened a new pull request #11612:\nURL: https://github.com/apache/arrow/pull/11612\n\n\n   This PR more correctly passes on type information for the temporary columns that are created when nested expressions exist. This isn't needed often, but occasionally the expression type is checked for the purposes of erroring or warning. The two examples where this happens are `ifelse()` and `case_when()`, which resulted in the following (valid) code pulling data into R with a confusing message:\r\n   \r\n   ``` r\r\n   library(arrow, warn.conflicts = FALSE)\r\n   library(dplyr, warn.conflicts = FALSE)\r\n   \r\n   # motvating example\r\n   RecordBatch$create(x = c(0, 1, 1), y = c(2, 3, 5), z = c(8, 13, 21)) %>%\r\n     group_by(x) %>%\r\n     summarise(r = ifelse(n() > 1, mean(y), mean(z))) %>% \r\n     collect()\r\n   #> Warning: Error : Expression ifelse(..temp0 > 1, ..temp1, ..temp2) not supported\r\n   #> in Arrow; pulling data into R\r\n   #> # A tibble: 2 \u00d7 2\r\n   #>       x     r\r\n   #>   <dbl> <dbl>\r\n   #> 1     0     8\r\n   #> 2     1     4\r\n   ```\r\n   \r\n   After this PR, the above works without warning:\r\n   \r\n   ``` r\r\n   library(arrow, warn.conflicts = FALSE)\r\n   library(dplyr, warn.conflicts = FALSE)\r\n   \r\n   # motvating example\r\n   RecordBatch$create(x = c(0, 1, 1), y = c(2, 3, 5), z = c(8, 13, 21)) %>%\r\n     group_by(x) %>%\r\n     summarise(r = ifelse(n() > 1, mean(y), mean(z))) %>% \r\n     collect()\r\n   #> # A tibble: 2 \u00d7 2\r\n   #>       x     r\r\n   #>   <dbl> <dbl>\r\n   #> 1     0     8\r\n   #> 2     1     4\r\n   ```\r\n   \r\n   I imagine I'm missing some of the complexity here...feel free to let me know!\n\n\n-- \nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nTo unsubscribe, e-mail: github-unsubscribe@arrow.apache.org\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2021-11-05T20:18:22.545+0000",
                    "updated": "2021-11-05T20:18:22.545+0000",
                    "started": "2021-11-05T20:18:22.545+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "677634",
                    "issueId": "13402384"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13402384/worklog/677802",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "github-actions[bot] commented on pull request #11612:\nURL: https://github.com/apache/arrow/pull/11612#issuecomment-961358716\n\n\n\n\n\n\n-- \nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nTo unsubscribe, e-mail: github-unsubscribe@arrow.apache.org\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2021-11-05T20:39:27.425+0000",
                    "updated": "2021-11-05T20:39:27.425+0000",
                    "started": "2021-11-05T20:39:27.425+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "677802",
                    "issueId": "13402384"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13402384/worklog/677900",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "jonkeane commented on a change in pull request #11612:\nURL: https://github.com/apache/arrow/pull/11612#discussion_r743946777\n\n\n\n##########\nFile path: r/tests/testthat/test-dplyr-summarize.R\n##########\n@@ -879,3 +879,20 @@ test_that(\"summarize() handles group_by .drop\", {\n     )\n   )\n })\n+\n+test_that(\"summarise() passes through type information for temporary columns\", {\n+  # applies to ifelse and case_when(), in which argument types are checked\n+  # within a translated function (previously this failed because the appropriate\n+  # schema was not available for n() > 1, mean(y), and mean(z))\n+  compare_dplyr_binding(\n+    .input %>%\n+      group_by(x) %>%\n+      summarise(r = ifelse(n() > 1, mean(y), mean(z))) %>%\n+      collect(),\n+    tibble(\n+      x = c(0, 1, 1),\n+      y = c(2, 3, 5),\n+      z = c(8, 13, 21)\n+    )\n+  )\n\nReview comment:\n       Would it be good to test something like the following?\r\n   \r\n   ```\r\n   .input %>%\r\n          mutate(new_col = ...) %>%\r\n          group_by(x) %>%\r\n          summarise(r = ifelse(New_col > 1, mean(y), mean(z))) %>%\r\n          collect()\r\n   ```\r\n   \r\n   Tt should just work, but would be good to check.\n\n##########\nFile path: r/R/dplyr-summarize.R\n##########\n@@ -218,8 +218,16 @@ summarize_eval <- function(name, quosure, ctx, hash, recurse = FALSE) {\n   } else if (all(inner_agg_exprs)) {\n     # Something like: fun(agg(x), agg(y))\n     # So based on the aggregations that have been extracted, mutate after\n+    agg_field_refs <- make_field_refs(names(ctx$aggregations))\n+    agg_field_types <- lapply(ctx$aggregations, function(x) x$data$type())\n\nReview comment:\n       `ctx$aggregations` are (a list of) expressions at this point, yeah? \n\n##########\nFile path: r/tests/testthat/test-dplyr-summarize.R\n##########\n@@ -879,3 +879,20 @@ test_that(\"summarize() handles group_by .drop\", {\n     )\n   )\n })\n+\n+test_that(\"summarise() passes through type information for temporary columns\", {\n+  # applies to ifelse and case_when(), in which argument types are checked\n+  # within a translated function (previously this failed because the appropriate\n+  # schema was not available for n() > 1, mean(y), and mean(z))\n+  compare_dplyr_binding(\n+    .input %>%\n+      group_by(x) %>%\n+      summarise(r = ifelse(n() > 1, mean(y), mean(z))) %>%\n\nReview comment:\n       This is super-duper minor, but I wonder if we should use `if_else()` here since that is a bit more strict about the types of the `true` and `false` arguments. IIRC, our arrow `ifelse()` is just as strict (since it uses the exact same implementation), but the intention of the test + testing the types of those would be a little bit clear with it.\n\n\n\n\n-- \nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nTo unsubscribe, e-mail: github-unsubscribe@arrow.apache.org\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2021-11-05T20:50:08.189+0000",
                    "updated": "2021-11-05T20:50:08.189+0000",
                    "started": "2021-11-05T20:50:08.189+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "677900",
                    "issueId": "13402384"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13402384/worklog/678417",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "paleolimbot commented on a change in pull request #11612:\nURL: https://github.com/apache/arrow/pull/11612#discussion_r744631444\n\n\n\n##########\nFile path: r/tests/testthat/test-dplyr-summarize.R\n##########\n@@ -879,3 +879,20 @@ test_that(\"summarize() handles group_by .drop\", {\n     )\n   )\n })\n+\n+test_that(\"summarise() passes through type information for temporary columns\", {\n+  # applies to ifelse and case_when(), in which argument types are checked\n+  # within a translated function (previously this failed because the appropriate\n+  # schema was not available for n() > 1, mean(y), and mean(z))\n+  compare_dplyr_binding(\n+    .input %>%\n+      group_by(x) %>%\n+      summarise(r = ifelse(n() > 1, mean(y), mean(z))) %>%\n+      collect(),\n+    tibble(\n+      x = c(0, 1, 1),\n+      y = c(2, 3, 5),\n+      z = c(8, 13, 21)\n+    )\n+  )\n\nReview comment:\n       It doesn't, and I wonder if all the elements of inner expressions have to be aggregate expressions? FWIW I get:\r\n   \r\n   ``` r\r\n   library(arrow, warn.conflicts = FALSE)\r\n   library(dplyr, warn.conflicts = FALSE)\r\n   \r\n   RecordBatch$create(x = c(0, 1, 1), y = c(2, 3, 5), z = c(8, 13, 21)) %>%\r\n     mutate(new_col = x + 0.1) %>%\r\n     group_by(x) %>%\r\n     summarise(r = ifelse(new_col > 1, mean(y), mean(z))) %>%\r\n     collect()\r\n   #> Warning: Error : Expression ifelse(new_col > 1, mean(y), mean(z)) not supported\r\n   #> in Arrow; pulling data into R\r\n   #> `summarise()` has grouped output by 'x'. You can override using the `.groups` argument.\r\n   #> # A tibble: 3 \u00d7 2\r\n   #> # Groups:   x [2]\r\n   #>       x     r\r\n   #>   <dbl> <dbl>\r\n   #> 1     0     8\r\n   #> 2     1     4\r\n   #> 3     1     4\r\n   ```\r\n   \n\n\n\n\n-- \nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nTo unsubscribe, e-mail: github-unsubscribe@arrow.apache.org\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2021-11-08T11:22:58.553+0000",
                    "updated": "2021-11-08T11:22:58.553+0000",
                    "started": "2021-11-08T11:22:58.553+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "678417",
                    "issueId": "13402384"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13402384/worklog/678419",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "paleolimbot commented on a change in pull request #11612:\nURL: https://github.com/apache/arrow/pull/11612#discussion_r744634095\n\n\n\n##########\nFile path: r/R/dplyr-summarize.R\n##########\n@@ -218,8 +218,16 @@ summarize_eval <- function(name, quosure, ctx, hash, recurse = FALSE) {\n   } else if (all(inner_agg_exprs)) {\n     # Something like: fun(agg(x), agg(y))\n     # So based on the aggregations that have been extracted, mutate after\n+    agg_field_refs <- make_field_refs(names(ctx$aggregations))\n+    agg_field_types <- lapply(ctx$aggregations, function(x) x$data$type())\n\nReview comment:\n       Almost...it's more like `list(..temp0 = list(fun = \"sum\", data = Expression(...), options = list()))`\r\n   \r\n   <details>\r\n   \r\n   ``` r\r\n   library(arrow, warn.conflicts = FALSE)\r\n   library(dplyr, warn.conflicts = FALSE)\r\n   \r\n   x <- RecordBatch$create(x = c(0, 1, 1), y = c(2, 3, 5), z = c(8, 13, 21)) %>%\r\n     mutate(new_col = x + 0.1) %>%\r\n     group_by(x) %>%\r\n     summarise(r = ifelse(n() > 1, mean(y), mean(z)))\r\n   \r\n   str(x$.data$aggregations)\r\n   #> List of 3\r\n   #>  $ ..temp0:List of 3\r\n   #>   ..$ fun    : chr \"sum\"\r\n   #>   ..$ data   :Classes 'Expression', 'ArrowObject', 'R6' <Expression>\r\n   #>   Inherits from: <ArrowObject>\r\n   #>   Public:\r\n   #>     .:xp:.: externalptr\r\n   #>     cast: function (to_type, safe = TRUE, ...) \r\n   #>     clone: function (deep = FALSE) \r\n   #>     Equals: function (other, ...) \r\n   #>     field_name: active binding\r\n   #>     initialize: function (xp) \r\n   #>     invalidate: function () \r\n   #>     pointer: function () \r\n   #>     print: function (...) \r\n   #>     schema: Schema, ArrowObject, R6\r\n   #>     set_pointer: function (xp) \r\n   #>     ToString: function () \r\n   #>     type: function (schema = self$schema) \r\n   #>     type_id: function (schema = self$schema)  \r\n   #>   ..$ options: list()\r\n   #>  $ ..temp1:List of 3\r\n   #>   ..$ fun    : chr \"mean\"\r\n   #>   ..$ data   :Classes 'Expression', 'ArrowObject', 'R6' <Expression>\r\n   #>   Inherits from: <ArrowObject>\r\n   #>   Public:\r\n   #>     .:xp:.: externalptr\r\n   #>     cast: function (to_type, safe = TRUE, ...) \r\n   #>     clone: function (deep = FALSE) \r\n   #>     Equals: function (other, ...) \r\n   #>     field_name: active binding\r\n   #>     initialize: function (xp) \r\n   #>     invalidate: function () \r\n   #>     pointer: function () \r\n   #>     print: function (...) \r\n   #>     schema: Schema, ArrowObject, R6\r\n   #>     set_pointer: function (xp) \r\n   #>     ToString: function () \r\n   #>     type: function (schema = self$schema) \r\n   #>     type_id: function (schema = self$schema)  \r\n   #>   ..$ options:List of 2\r\n   #>   .. ..$ skip_nulls: logi FALSE\r\n   #>   .. ..$ min_count : int 0\r\n   #>  $ ..temp2:List of 3\r\n   #>   ..$ fun    : chr \"mean\"\r\n   #>   ..$ data   :Classes 'Expression', 'ArrowObject', 'R6' <Expression>\r\n   #>   Inherits from: <ArrowObject>\r\n   #>   Public:\r\n   #>     .:xp:.: externalptr\r\n   #>     cast: function (to_type, safe = TRUE, ...) \r\n   #>     clone: function (deep = FALSE) \r\n   #>     Equals: function (other, ...) \r\n   #>     field_name: active binding\r\n   #>     initialize: function (xp) \r\n   #>     invalidate: function () \r\n   #>     pointer: function () \r\n   #>     print: function (...) \r\n   #>     schema: Schema, ArrowObject, R6\r\n   #>     set_pointer: function (xp) \r\n   #>     ToString: function () \r\n   #>     type: function (schema = self$schema) \r\n   #>     type_id: function (schema = self$schema)  \r\n   #>   ..$ options:List of 2\r\n   #>   .. ..$ skip_nulls: logi FALSE\r\n   #>   .. ..$ min_count : int 0\r\n   ```\r\n   \r\n   <sup>Created on 2021-11-08 by the [reprex package](https://reprex.tidyverse.org) (v2.0.1)</sup>\r\n   \r\n   </details>\n\n\n\n\n-- \nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nTo unsubscribe, e-mail: github-unsubscribe@arrow.apache.org\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2021-11-08T11:26:39.488+0000",
                    "updated": "2021-11-08T11:26:39.488+0000",
                    "started": "2021-11-08T11:26:39.487+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "678419",
                    "issueId": "13402384"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13402384/worklog/678422",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "paleolimbot commented on a change in pull request #11612:\nURL: https://github.com/apache/arrow/pull/11612#discussion_r744636509\n\n\n\n##########\nFile path: r/tests/testthat/test-dplyr-summarize.R\n##########\n@@ -879,3 +879,20 @@ test_that(\"summarize() handles group_by .drop\", {\n     )\n   )\n })\n+\n+test_that(\"summarise() passes through type information for temporary columns\", {\n+  # applies to ifelse and case_when(), in which argument types are checked\n+  # within a translated function (previously this failed because the appropriate\n+  # schema was not available for n() > 1, mean(y), and mean(z))\n+  compare_dplyr_binding(\n+    .input %>%\n+      group_by(x) %>%\n+      summarise(r = ifelse(n() > 1, mean(y), mean(z))) %>%\n+      collect(),\n+    tibble(\n+      x = c(0, 1, 1),\n+      y = c(2, 3, 5),\n+      z = c(8, 13, 21)\n+    )\n+  )\n\nReview comment:\n       Generating better errors for aggregate expressions that aren't supported is already a ticket (ARROW-14586)...I'd be happy to add that example!\n\n\n\n\n-- \nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nTo unsubscribe, e-mail: github-unsubscribe@arrow.apache.org\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2021-11-08T11:29:57.733+0000",
                    "updated": "2021-11-08T11:29:57.733+0000",
                    "started": "2021-11-08T11:29:57.733+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "678422",
                    "issueId": "13402384"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13402384/worklog/678789",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "jonkeane commented on a change in pull request #11612:\nURL: https://github.com/apache/arrow/pull/11612#discussion_r745146259\n\n\n\n##########\nFile path: r/tests/testthat/test-dplyr-summarize.R\n##########\n@@ -879,3 +879,20 @@ test_that(\"summarize() handles group_by .drop\", {\n     )\n   )\n })\n+\n+test_that(\"summarise() passes through type information for temporary columns\", {\n+  # applies to ifelse and case_when(), in which argument types are checked\n+  # within a translated function (previously this failed because the appropriate\n+  # schema was not available for n() > 1, mean(y), and mean(z))\n+  compare_dplyr_binding(\n+    .input %>%\n+      group_by(x) %>%\n+      summarise(r = ifelse(n() > 1, mean(y), mean(z))) %>%\n+      collect(),\n+    tibble(\n+      x = c(0, 1, 1),\n+      y = c(2, 3, 5),\n+      z = c(8, 13, 21)\n+    )\n+  )\n\nReview comment:\n       Hmm ok I see more of what's going on here. My first question was a bit off (since at the `ifelse()` stage we really should be evaluating aggregates in it's first argument \u2014 like in the example you gave above + you used in the tests where we're looking at `n()` for the group).\r\n   \r\n   But I'm not 100% sure if the aggregate aggregate expressions are the problem here.\r\n   \r\n   This new column column is admittedly a little strange (though I can imagine situations where this is ~something someone wants to do!) but I'm surprised that this still errors:\r\n   \r\n   ``` r\r\n   library(arrow, warn.conflicts = FALSE)\r\n   library(dplyr, warn.conflicts = FALSE)\r\n   \r\n   tab <- Table$create(starwars)\r\n   \r\n   tab %>% \r\n    group_by(gender) %>% \r\n    summarise(\r\n      height_mean = mean(height, na.rm = TRUE),\r\n      height_median = median(height, na.rm = TRUE),\r\n      height_evil_avg = if_else(\r\n        height_mean > 178, \r\n        mean(height, na.rm = TRUE), \r\n        as.double(median(height, na.rm = TRUE))\r\n      )) %>%\r\n    collect()\r\n   #> Warning: median() currently returns an approximate median in Arrow\r\n   \r\n   #> Warning: median() currently returns an approximate median in Arrow\r\n   #> Warning: Error : Expression if_else(height_mean > 178, ..temp2,\r\n   #> as.double(..temp3)) not supported in Arrow; pulling data into R\r\n   #> # A tibble: 3 \u00d7 4\r\n   #>   gender    height_mean height_median height_evil_avg\r\n   #>   <chr>           <dbl>         <dbl>           <dbl>\r\n   #> 1 feminine         165.          166.            166.\r\n   #> 2 masculine        177.          183             183 \r\n   #> 3 <NA>             181.          183             181.\r\n   ```\r\n   \r\n   It's not immediately clear to me that it's the same thing as ARROW-14586, but maybe they are interrelated? Anyway, if there's not an obvious way to get that working here that's totally fine, but maybe we should add this example to ARROW-14586 or we can create a new jira for trying to make this type work.\n\n\n\n\n-- \nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nTo unsubscribe, e-mail: github-unsubscribe@arrow.apache.org\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2021-11-08T22:36:02.238+0000",
                    "updated": "2021-11-08T22:36:02.238+0000",
                    "started": "2021-11-08T22:36:02.237+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "678789",
                    "issueId": "13402384"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13402384/worklog/678793",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "jonkeane commented on a change in pull request #11612:\nURL: https://github.com/apache/arrow/pull/11612#discussion_r745147033\n\n\n\n##########\nFile path: r/R/dplyr-summarize.R\n##########\n@@ -218,8 +218,16 @@ summarize_eval <- function(name, quosure, ctx, hash, recurse = FALSE) {\n   } else if (all(inner_agg_exprs)) {\n     # Something like: fun(agg(x), agg(y))\n     # So based on the aggregations that have been extracted, mutate after\n+    agg_field_refs <- make_field_refs(names(ctx$aggregations))\n+    agg_field_types <- lapply(ctx$aggregations, function(x) x$data$type())\n\nReview comment:\n       Ah, ok that's helpful. I was a bit hopeful that it was one of our R6 objects that might already have (or we could easily extend to have) a `$type()` method, but it looks like not. \n\n\n\n\n-- \nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nTo unsubscribe, e-mail: github-unsubscribe@arrow.apache.org\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2021-11-08T22:37:44.572+0000",
                    "updated": "2021-11-08T22:37:44.572+0000",
                    "started": "2021-11-08T22:37:44.572+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "678793",
                    "issueId": "13402384"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13402384/worklog/679020",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "paleolimbot commented on a change in pull request #11612:\nURL: https://github.com/apache/arrow/pull/11612#discussion_r745594596\n\n\n\n##########\nFile path: r/tests/testthat/test-dplyr-summarize.R\n##########\n@@ -879,3 +879,20 @@ test_that(\"summarize() handles group_by .drop\", {\n     )\n   )\n })\n+\n+test_that(\"summarise() passes through type information for temporary columns\", {\n+  # applies to ifelse and case_when(), in which argument types are checked\n+  # within a translated function (previously this failed because the appropriate\n+  # schema was not available for n() > 1, mean(y), and mean(z))\n+  compare_dplyr_binding(\n+    .input %>%\n+      group_by(x) %>%\n+      summarise(r = ifelse(n() > 1, mean(y), mean(z))) %>%\n+      collect(),\n+    tibble(\n+      x = c(0, 1, 1),\n+      y = c(2, 3, 5),\n+      z = c(8, 13, 21)\n+    )\n+  )\n\nReview comment:\n       Your example is fixed by this PR! The first example with `new_col` makes sense to fail because it would produce a length != 1 result. I'll add the first example to the issue about error messages in summarise.\r\n   \r\n   <details>\r\n   ``` r\r\n   # remotes::install_github(\"apache/arrow/r#11612)\r\n   library(arrow, warn.conflicts = FALSE)\r\n   library(dplyr, warn.conflicts = FALSE)\r\n   \r\n   tab <- Table$create(starwars)\r\n   \r\n   tab %>% \r\n     group_by(gender) %>% \r\n     summarise(\r\n       height_mean = mean(height, na.rm = TRUE),\r\n       height_median = median(height, na.rm = TRUE),\r\n       height_evil_avg = if_else(\r\n         height_mean > 178, \r\n         mean(height, na.rm = TRUE), \r\n         as.double(median(height, na.rm = TRUE))\r\n       )) %>%\r\n     collect()\r\n   #> Warning: median() currently returns an approximate median in Arrow\r\n   \r\n   #> Warning: median() currently returns an approximate median in Arrow\r\n   #> # A tibble: 3 \u00d7 4\r\n   #>   gender    height_mean height_median height_evil_avg\r\n   #>   <chr>           <dbl>         <dbl>           <dbl>\r\n   #> 1 masculine        177.          183             183 \r\n   #> 2 feminine         165.          166.            166.\r\n   #> 3 <NA>             181.          183             181.\r\n   ```\r\n   \r\n   <sup>Created on 2021-11-09 by the [reprex package](https://reprex.tidyverse.org) (v2.0.1)</sup>\r\n   </details>\n\n\n\n\n-- \nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nTo unsubscribe, e-mail: github-unsubscribe@arrow.apache.org\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2021-11-09T13:02:55.520+0000",
                    "updated": "2021-11-09T13:02:55.520+0000",
                    "started": "2021-11-09T13:02:55.520+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "679020",
                    "issueId": "13402384"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13402384/worklog/679022",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "paleolimbot commented on a change in pull request #11612:\nURL: https://github.com/apache/arrow/pull/11612#discussion_r745594596\n\n\n\n##########\nFile path: r/tests/testthat/test-dplyr-summarize.R\n##########\n@@ -879,3 +879,20 @@ test_that(\"summarize() handles group_by .drop\", {\n     )\n   )\n })\n+\n+test_that(\"summarise() passes through type information for temporary columns\", {\n+  # applies to ifelse and case_when(), in which argument types are checked\n+  # within a translated function (previously this failed because the appropriate\n+  # schema was not available for n() > 1, mean(y), and mean(z))\n+  compare_dplyr_binding(\n+    .input %>%\n+      group_by(x) %>%\n+      summarise(r = ifelse(n() > 1, mean(y), mean(z))) %>%\n+      collect(),\n+    tibble(\n+      x = c(0, 1, 1),\n+      y = c(2, 3, 5),\n+      z = c(8, 13, 21)\n+    )\n+  )\n\nReview comment:\n       Your example is fixed by this PR! The first example with `new_col` makes sense to fail because it would produce a length != 1 result. I'll add the first example to the issue about error messages in summarise.\r\n   \r\n   <details>\r\n   \r\n   ``` r\r\n   # remotes::install_github(\"apache/arrow/r#11612)\r\n   library(arrow, warn.conflicts = FALSE)\r\n   library(dplyr, warn.conflicts = FALSE)\r\n   \r\n   tab <- Table$create(starwars)\r\n   \r\n   tab %>% \r\n     group_by(gender) %>% \r\n     summarise(\r\n       height_mean = mean(height, na.rm = TRUE),\r\n       height_median = median(height, na.rm = TRUE),\r\n       height_evil_avg = if_else(\r\n         height_mean > 178, \r\n         mean(height, na.rm = TRUE), \r\n         as.double(median(height, na.rm = TRUE))\r\n       )) %>%\r\n     collect()\r\n   #> Warning: median() currently returns an approximate median in Arrow\r\n   \r\n   #> Warning: median() currently returns an approximate median in Arrow\r\n   #> # A tibble: 3 \u00d7 4\r\n   #>   gender    height_mean height_median height_evil_avg\r\n   #>   <chr>           <dbl>         <dbl>           <dbl>\r\n   #> 1 masculine        177.          183             183 \r\n   #> 2 feminine         165.          166.            166.\r\n   #> 3 <NA>             181.          183             181.\r\n   ```\r\n   \r\n   \r\n   </details>\n\n\n\n\n-- \nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nTo unsubscribe, e-mail: github-unsubscribe@arrow.apache.org\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2021-11-09T13:03:12.698+0000",
                    "updated": "2021-11-09T13:03:12.698+0000",
                    "started": "2021-11-09T13:03:12.698+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "679022",
                    "issueId": "13402384"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13402384/worklog/679062",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "jonkeane commented on a change in pull request #11612:\nURL: https://github.com/apache/arrow/pull/11612#discussion_r745659614\n\n\n\n##########\nFile path: r/tests/testthat/test-dplyr-summarize.R\n##########\n@@ -879,3 +879,20 @@ test_that(\"summarize() handles group_by .drop\", {\n     )\n   )\n })\n+\n+test_that(\"summarise() passes through type information for temporary columns\", {\n+  # applies to ifelse and case_when(), in which argument types are checked\n+  # within a translated function (previously this failed because the appropriate\n+  # schema was not available for n() > 1, mean(y), and mean(z))\n+  compare_dplyr_binding(\n+    .input %>%\n+      group_by(x) %>%\n+      summarise(r = ifelse(n() > 1, mean(y), mean(z))) %>%\n+      collect(),\n+    tibble(\n+      x = c(0, 1, 1),\n+      y = c(2, 3, 5),\n+      z = c(8, 13, 21)\n+    )\n+  )\n\nReview comment:\n       Ah, fantastic!\n\n\n\n\n-- \nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nTo unsubscribe, e-mail: github-unsubscribe@arrow.apache.org\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2021-11-09T14:19:17.153+0000",
                    "updated": "2021-11-09T14:19:17.153+0000",
                    "started": "2021-11-09T14:19:17.152+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "679062",
                    "issueId": "13402384"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13402384/worklog/679063",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "jonkeane closed pull request #11612:\nURL: https://github.com/apache/arrow/pull/11612\n\n\n   \n\n\n-- \nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nTo unsubscribe, e-mail: github-unsubscribe@arrow.apache.org\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2021-11-09T14:20:31.415+0000",
                    "updated": "2021-11-09T14:20:31.415+0000",
                    "started": "2021-11-09T14:20:31.415+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "679063",
                    "issueId": "13402384"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13402384/worklog/679064",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "ursabot commented on pull request #11612:\nURL: https://github.com/apache/arrow/pull/11612#issuecomment-964195863\n\n\n   Benchmark runs are scheduled for baseline = caf1e1ed459e2c6ff66255fc915a5a7b16c0f5c5 and contender = 5c936560c1da003baf714d67dc92f25670730c84. 5c936560c1da003baf714d67dc92f25670730c84 is a master commit associated with this PR. Results will be available as each benchmark for each run completes.\n   Conbench compare runs links:\n   [Scheduled] [ec2-t3-xlarge-us-east-2](https://conbench.ursa.dev/compare/runs/a32ec6a017f3475aba398a35a9248240...7e2a31fb4409442e93a77dfaabe7c39a/)\n   [Scheduled] [ursa-i9-9960x](https://conbench.ursa.dev/compare/runs/1a88c8de5ec34d129f7b198542286a27...b7bc0b0371a2428b81e2b97bae35ae97/)\n   [Scheduled] [ursa-thinkcentre-m75q](https://conbench.ursa.dev/compare/runs/d76c3bf06b9b4a4b834b153f2fef5c1a...910dfdee488846d6ab422b1f5df8e9f6/)\n   Supported benchmarks:\n   ursa-i9-9960x: langs = Python, R, JavaScript\n   ursa-thinkcentre-m75q: langs = C++, Java\n   ec2-t3-xlarge-us-east-2: cloud = True\n   \n\n\n-- \nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nTo unsubscribe, e-mail: github-unsubscribe@arrow.apache.org\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2021-11-09T14:21:25.926+0000",
                    "updated": "2021-11-09T14:21:25.926+0000",
                    "started": "2021-11-09T14:21:25.926+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "679064",
                    "issueId": "13402384"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13402384/worklog/679075",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "ursabot edited a comment on pull request #11612:\nURL: https://github.com/apache/arrow/pull/11612#issuecomment-964195863\n\n\n   Benchmark runs are scheduled for baseline = caf1e1ed459e2c6ff66255fc915a5a7b16c0f5c5 and contender = 5c936560c1da003baf714d67dc92f25670730c84. 5c936560c1da003baf714d67dc92f25670730c84 is a master commit associated with this PR. Results will be available as each benchmark for each run completes.\n   Conbench compare runs links:\n   [Finished :arrow_down:0.0% :arrow_up:0.0%] [ec2-t3-xlarge-us-east-2](https://conbench.ursa.dev/compare/runs/a32ec6a017f3475aba398a35a9248240...7e2a31fb4409442e93a77dfaabe7c39a/)\n   [Scheduled] [ursa-i9-9960x](https://conbench.ursa.dev/compare/runs/1a88c8de5ec34d129f7b198542286a27...b7bc0b0371a2428b81e2b97bae35ae97/)\n   [Scheduled] [ursa-thinkcentre-m75q](https://conbench.ursa.dev/compare/runs/d76c3bf06b9b4a4b834b153f2fef5c1a...910dfdee488846d6ab422b1f5df8e9f6/)\n   Supported benchmarks:\n   ursa-i9-9960x: langs = Python, R, JavaScript\n   ursa-thinkcentre-m75q: langs = C++, Java\n   ec2-t3-xlarge-us-east-2: cloud = True\n   \n\n\n-- \nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nTo unsubscribe, e-mail: github-unsubscribe@arrow.apache.org\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2021-11-09T14:31:28.686+0000",
                    "updated": "2021-11-09T14:31:28.686+0000",
                    "started": "2021-11-09T14:31:28.686+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "679075",
                    "issueId": "13402384"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13402384/worklog/679177",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "ursabot edited a comment on pull request #11612:\nURL: https://github.com/apache/arrow/pull/11612#issuecomment-964195863\n\n\n   Benchmark runs are scheduled for baseline = caf1e1ed459e2c6ff66255fc915a5a7b16c0f5c5 and contender = 5c936560c1da003baf714d67dc92f25670730c84. 5c936560c1da003baf714d67dc92f25670730c84 is a master commit associated with this PR. Results will be available as each benchmark for each run completes.\n   Conbench compare runs links:\n   [Finished :arrow_down:0.0% :arrow_up:0.0%] [ec2-t3-xlarge-us-east-2](https://conbench.ursa.dev/compare/runs/a32ec6a017f3475aba398a35a9248240...7e2a31fb4409442e93a77dfaabe7c39a/)\n   [Scheduled] [ursa-i9-9960x](https://conbench.ursa.dev/compare/runs/1a88c8de5ec34d129f7b198542286a27...b7bc0b0371a2428b81e2b97bae35ae97/)\n   [Finished :arrow_down:0.13% :arrow_up:0.0%] [ursa-thinkcentre-m75q](https://conbench.ursa.dev/compare/runs/d76c3bf06b9b4a4b834b153f2fef5c1a...910dfdee488846d6ab422b1f5df8e9f6/)\n   Supported benchmarks:\n   ursa-i9-9960x: langs = Python, R, JavaScript\n   ursa-thinkcentre-m75q: langs = C++, Java\n   ec2-t3-xlarge-us-east-2: cloud = True\n   \n\n\n-- \nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nTo unsubscribe, e-mail: github-unsubscribe@arrow.apache.org\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2021-11-09T17:10:29.343+0000",
                    "updated": "2021-11-09T17:10:29.343+0000",
                    "started": "2021-11-09T17:10:29.343+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "679177",
                    "issueId": "13402384"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13402384/worklog/679342",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "ursabot edited a comment on pull request #11612:\nURL: https://github.com/apache/arrow/pull/11612#issuecomment-964195863\n\n\n   Benchmark runs are scheduled for baseline = caf1e1ed459e2c6ff66255fc915a5a7b16c0f5c5 and contender = 5c936560c1da003baf714d67dc92f25670730c84. 5c936560c1da003baf714d67dc92f25670730c84 is a master commit associated with this PR. Results will be available as each benchmark for each run completes.\n   Conbench compare runs links:\n   [Finished :arrow_down:0.0% :arrow_up:0.0%] [ec2-t3-xlarge-us-east-2](https://conbench.ursa.dev/compare/runs/a32ec6a017f3475aba398a35a9248240...7e2a31fb4409442e93a77dfaabe7c39a/)\n   [Finished :arrow_down:0.0% :arrow_up:0.0%] [ursa-i9-9960x](https://conbench.ursa.dev/compare/runs/1a88c8de5ec34d129f7b198542286a27...b7bc0b0371a2428b81e2b97bae35ae97/)\n   [Finished :arrow_down:0.13% :arrow_up:0.0%] [ursa-thinkcentre-m75q](https://conbench.ursa.dev/compare/runs/d76c3bf06b9b4a4b834b153f2fef5c1a...910dfdee488846d6ab422b1f5df8e9f6/)\n   Supported benchmarks:\n   ursa-i9-9960x: langs = Python, R, JavaScript\n   ursa-thinkcentre-m75q: langs = C++, Java\n   ec2-t3-xlarge-us-east-2: cloud = True\n   \n\n\n-- \nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nTo unsubscribe, e-mail: github-unsubscribe@arrow.apache.org\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2021-11-09T21:47:23.001+0000",
                    "updated": "2021-11-09T21:47:23.001+0000",
                    "started": "2021-11-09T21:47:23.001+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "679342",
                    "issueId": "13402384"
                }
            ]
        },
        "customfield_12313920": null,
        "issuetype": {
            "self": "https://issues.apache.org/jira/rest/api/2/issuetype/4",
            "id": "4",
            "description": "An improvement or enhancement to an existing feature or task.",
            "iconUrl": "https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21140&avatarType=issuetype",
            "name": "Improvement",
            "subtask": false,
            "avatarId": 21140
        },
        "timespent": 12000,
        "customfield_12314020": "{summaryBean=com.atlassian.jira.plugin.devstatus.rest.SummaryBean@e10b572[summary={pullrequest=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@98250e4[overall=PullRequestOverallBean{stateCount=0, state='OPEN', details=PullRequestOverallDetails{openCount=0, mergedCount=0, declinedCount=0}},byInstanceType={}], build=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@1b7e8d3c[overall=com.atlassian.jira.plugin.devstatus.summary.beans.BuildOverallBean@60ebc7[failedBuildCount=0,successfulBuildCount=0,unknownBuildCount=0,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], review=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@7e60cb7b[overall=com.atlassian.jira.plugin.devstatus.summary.beans.ReviewsOverallBean@1e459054[stateCount=0,state=<null>,dueDate=<null>,overDue=false,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], deployment-environment=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@713df9cd[overall=com.atlassian.jira.plugin.devstatus.summary.beans.DeploymentOverallBean@76840afe[topEnvironments=[],showProjects=false,successfulCount=0,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], repository=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@ec72c46[overall=com.atlassian.jira.plugin.devstatus.summary.beans.CommitOverallBean@3cb2dafa[count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], branch=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@225faf30[overall=com.atlassian.jira.plugin.devstatus.summary.beans.BranchOverallBean@74da927f[count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}]},errors=[],configErrors=[]], devSummaryJson={\"cachedValue\":{\"errors\":[],\"configErrors\":[],\"summary\":{\"pullrequest\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"stateCount\":0,\"state\":\"OPEN\",\"details\":{\"openCount\":0,\"mergedCount\":0,\"declinedCount\":0,\"total\":0},\"open\":true},\"byInstanceType\":{}},\"build\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"failedBuildCount\":0,\"successfulBuildCount\":0,\"unknownBuildCount\":0},\"byInstanceType\":{}},\"review\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"stateCount\":0,\"state\":null,\"dueDate\":null,\"overDue\":false,\"completed\":false},\"byInstanceType\":{}},\"deployment-environment\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"topEnvironments\":[],\"showProjects\":false,\"successfulCount\":0},\"byInstanceType\":{}},\"repository\":{\"overall\":{\"count\":0,\"lastUpdated\":null},\"byInstanceType\":{}},\"branch\":{\"overall\":{\"count\":0,\"lastUpdated\":null},\"byInstanceType\":{}}}},\"isStale\":false}}",
        "customfield_12314141": null,
        "customfield_12314140": null,
        "project": {
            "self": "https://issues.apache.org/jira/rest/api/2/project/12319525",
            "id": "12319525",
            "key": "ARROW",
            "name": "Apache Arrow",
            "projectTypeKey": "software",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/projectavatar?pid=12319525&avatarId=10011",
                "24x24": "https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12319525&avatarId=10011",
                "16x16": "https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12319525&avatarId=10011",
                "32x32": "https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12319525&avatarId=10011"
            },
            "projectCategory": {
                "self": "https://issues.apache.org/jira/rest/api/2/projectCategory/13960",
                "id": "13960",
                "description": "Apache Arrow",
                "name": "Arrow"
            }
        },
        "aggregatetimespent": 12000,
        "customfield_12312520": null,
        "customfield_12312521": "Tue Nov 09 14:20:28 UTC 2021",
        "customfield_12314422": null,
        "customfield_12314421": null,
        "customfield_12314146": null,
        "customfield_12314420": null,
        "customfield_12314145": null,
        "customfield_12314144": null,
        "customfield_12314143": null,
        "resolutiondate": "2021-11-09T14:20:28.000+0000",
        "workratio": -1,
        "customfield_12312923": null,
        "customfield_12312920": null,
        "customfield_12312921": null,
        "watches": {
            "self": "https://issues.apache.org/jira/rest/api/2/issue/ARROW-14051/watchers",
            "watchCount": 3,
            "isWatching": false
        },
        "created": "2021-09-21T04:12:48.000+0000",
        "updated": "2021-11-09T21:47:23.000+0000",
        "timeoriginalestimate": null,
        "description": "This type of\u00a0{{summarise()}}\u00a0expression does not work in arrow:\r\n{code:r}\r\nTable$create(x = c(0, 1, 1), y = c(2, 3, 5), z = c(8, 13, 21)) %>%\r\n  group_by(x) %>%\r\n  summarise(r = ifelse(n() > 1, mean(y), mean(z))){code}",
        "customfield_10010": null,
        "timetracking": {
            "remainingEstimate": "0h",
            "timeSpent": "3h 20m",
            "remainingEstimateSeconds": 0,
            "timeSpentSeconds": 12000
        },
        "customfield_12314523": null,
        "customfield_12314127": null,
        "customfield_12314522": null,
        "customfield_12314126": null,
        "customfield_12314521": null,
        "customfield_12314125": null,
        "customfield_12314520": null,
        "customfield_12314124": null,
        "attachment": [],
        "customfield_12312340": null,
        "customfield_12314123": null,
        "customfield_12312341": null,
        "customfield_12312220": null,
        "customfield_12314122": null,
        "customfield_12314121": null,
        "customfield_12314120": null,
        "customfield_12314129": null,
        "customfield_12314524": null,
        "customfield_12314128": null,
        "summary": "[R] Handle conditionals enclosing aggregate expressions",
        "customfield_12314130": null,
        "customfield_12310291": null,
        "customfield_12310290": null,
        "customfield_12314138": null,
        "customfield_12314137": null,
        "environment": null,
        "customfield_12314136": null,
        "customfield_12314135": null,
        "customfield_12311020": null,
        "customfield_12314134": null,
        "duedate": null,
        "customfield_12314132": null,
        "customfield_12314131": null,
        "comment": {
            "comments": [
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13402384/comment/17418109",
                    "id": "17418109",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=npr",
                        "name": "npr",
                        "key": "npr",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=34045",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34045",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34045",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34045"
                        },
                        "displayName": "Neal Richardson",
                        "active": true,
                        "timeZone": "America/Los_Angeles"
                    },
                    "body": "How does it fail? I would expect that to work (generate 3 temp aggregations, then mutate {{r = ifelse(..temp0 > 1, ..temp1, ..temp2)}} )",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=npr",
                        "name": "npr",
                        "key": "npr",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=34045",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34045",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34045",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34045"
                        },
                        "displayName": "Neal Richardson",
                        "active": true,
                        "timeZone": "America/Los_Angeles"
                    },
                    "created": "2021-09-21T13:08:03.784+0000",
                    "updated": "2021-09-21T13:08:03.784+0000"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13402384/comment/17438009",
                    "id": "17438009",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=paleolimbot",
                        "name": "paleolimbot",
                        "key": "paleolimbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=paleolimbot&avatarId=47795",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=paleolimbot&avatarId=47795",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=paleolimbot&avatarId=47795",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=paleolimbot&avatarId=47795"
                        },
                        "displayName": "Dewey Dunnington",
                        "active": true,
                        "timeZone": "America/Halifax"
                    },
                    "body": "The (partial) stack trace generating the error is this:\r\n\r\n`Expression$type_id()`: [https://github.com/apache/arrow/blob/master/r/R/expression.R#L140]\r\n\r\n`nse_funcs$is.factor()`: [https://github.com/apache/arrow/blob/master/r/R/dplyr-functions.R#L229]\r\n\r\n`nse_funcs$if_else()`: [https://github.com/apache/arrow/blob/master/r/R/dplyr-functions.R#L895]\r\n\r\n\u00a0\r\n\r\nIt looks like the `Expression` that gets created has the `$schema` field dropped in `make_field_refs()` (hence the `NULL` schema) that triggers the error:\u00a0[https://github.com/apache/arrow/blob/master/r/R/dplyr-summarize.R#L222]",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=paleolimbot",
                        "name": "paleolimbot",
                        "key": "paleolimbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=paleolimbot&avatarId=47795",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=paleolimbot&avatarId=47795",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=paleolimbot&avatarId=47795",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=paleolimbot&avatarId=47795"
                        },
                        "displayName": "Dewey Dunnington",
                        "active": true,
                        "timeZone": "America/Halifax"
                    },
                    "created": "2021-11-03T12:12:45.150+0000",
                    "updated": "2021-11-03T12:12:45.150+0000"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13402384/comment/17441191",
                    "id": "17441191",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=jonkeane",
                        "name": "jonkeane",
                        "key": "jonkeane",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=34057",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34057",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34057",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34057"
                        },
                        "displayName": "Jonathan Keane",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "body": "Issue resolved by pull request 11612\n[https://github.com/apache/arrow/pull/11612]",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=jonkeane",
                        "name": "jonkeane",
                        "key": "jonkeane",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=34057",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34057",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34057",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34057"
                        },
                        "displayName": "Jonathan Keane",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "created": "2021-11-09T14:20:28.582+0000",
                    "updated": "2021-11-09T14:20:28.582+0000"
                }
            ],
            "maxResults": 3,
            "total": 3,
            "startAt": 0
        },
        "customfield_12311820": "0|z0v4pc:",
        "customfield_12314139": null
    }
}