{
    "expand": "operations,versionedRepresentations,editmeta,changelog,renderedFields",
    "id": "13450698",
    "self": "https://issues.apache.org/jira/rest/api/2/issue/13450698",
    "key": "ARROW-16852",
    "fields": {
        "fixVersions": [
            {
                "self": "https://issues.apache.org/jira/rest/api/2/version/12351550",
                "id": "12351550",
                "name": "9.0.0",
                "archived": false,
                "released": true,
                "releaseDate": "2022-08-03"
            }
        ],
        "resolution": {
            "self": "https://issues.apache.org/jira/rest/api/2/resolution/1",
            "id": "1",
            "description": "A fix for this issue is checked into the tree and tested.",
            "name": "Fixed"
        },
        "customfield_12312322": null,
        "customfield_12312323": null,
        "customfield_12312320": null,
        "customfield_12310420": "9223372036854775807",
        "customfield_12312321": null,
        "customfield_12312328": null,
        "customfield_12312329": null,
        "customfield_12312326": null,
        "customfield_12310300": null,
        "customfield_12312327": null,
        "customfield_12312324": null,
        "customfield_12312720": null,
        "customfield_12312325": null,
        "lastViewed": null,
        "priority": {
            "self": "https://issues.apache.org/jira/rest/api/2/priority/3",
            "iconUrl": "https://issues.apache.org/jira/images/icons/priorities/major.svg",
            "name": "Major",
            "id": "3"
        },
        "labels": [
            "pull-request-available"
        ],
        "customfield_12312333": null,
        "customfield_12312334": null,
        "customfield_12313422": "false",
        "customfield_12310310": "0.0",
        "customfield_12312331": null,
        "customfield_12312332": null,
        "aggregatetimeoriginalestimate": null,
        "timeestimate": 0,
        "customfield_12312330": null,
        "versions": [],
        "customfield_12311120": null,
        "customfield_12313826": null,
        "customfield_12312339": null,
        "issuelinks": [
            {
                "id": "12642039",
                "self": "https://issues.apache.org/jira/rest/api/2/issueLink/12642039",
                "type": {
                    "id": "12310460",
                    "name": "Child-Issue",
                    "inward": "is a child of",
                    "outward": "is a parent of",
                    "self": "https://issues.apache.org/jira/rest/api/2/issueLinkType/12310460"
                },
                "inwardIssue": {
                    "id": "13448614",
                    "key": "ARROW-16755",
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13448614",
                    "fields": {
                        "summary": "[C++] Improve array expression and kernel evaluation performance on small inputs",
                        "status": {
                            "self": "https://issues.apache.org/jira/rest/api/2/status/1",
                            "description": "The issue is open and ready for the assignee to start work on it.",
                            "iconUrl": "https://issues.apache.org/jira/images/icons/statuses/open.png",
                            "name": "Open",
                            "id": "1",
                            "statusCategory": {
                                "self": "https://issues.apache.org/jira/rest/api/2/statuscategory/2",
                                "id": 2,
                                "key": "new",
                                "colorName": "blue-gray",
                                "name": "To Do"
                            }
                        },
                        "priority": {
                            "self": "https://issues.apache.org/jira/rest/api/2/priority/3",
                            "iconUrl": "https://issues.apache.org/jira/images/icons/priorities/major.svg",
                            "name": "Major",
                            "id": "3"
                        },
                        "issuetype": {
                            "self": "https://issues.apache.org/jira/rest/api/2/issuetype/4",
                            "id": "4",
                            "description": "An improvement or enhancement to an existing feature or task.",
                            "iconUrl": "https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21140&avatarType=issuetype",
                            "name": "Improvement",
                            "subtask": false,
                            "avatarId": 21140
                        }
                    }
                }
            }
        ],
        "customfield_12313825": null,
        "assignee": {
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=wesm",
            "name": "wesm",
            "key": "wesmckinn",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=wesmckinn&avatarId=29931",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=wesmckinn&avatarId=29931",
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=wesmckinn&avatarId=29931",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=wesmckinn&avatarId=29931"
            },
            "displayName": "Wes McKinney",
            "active": true,
            "timeZone": "America/New_York"
        },
        "customfield_12312337": null,
        "customfield_12313823": null,
        "customfield_12312338": null,
        "customfield_12311920": null,
        "customfield_12313822": null,
        "customfield_12312335": null,
        "customfield_12313821": null,
        "customfield_12312336": null,
        "customfield_12313820": null,
        "status": {
            "self": "https://issues.apache.org/jira/rest/api/2/status/5",
            "description": "A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.",
            "iconUrl": "https://issues.apache.org/jira/images/icons/statuses/resolved.png",
            "name": "Resolved",
            "id": "5",
            "statusCategory": {
                "self": "https://issues.apache.org/jira/rest/api/2/statuscategory/3",
                "id": 3,
                "key": "done",
                "colorName": "green",
                "name": "Done"
            }
        },
        "components": [
            {
                "self": "https://issues.apache.org/jira/rest/api/2/component/12328935",
                "id": "12328935",
                "name": "C++"
            }
        ],
        "customfield_12312026": null,
        "customfield_12312023": null,
        "customfield_12312024": null,
        "aggregatetimeestimate": 0,
        "customfield_12312022": null,
        "customfield_12310921": null,
        "customfield_12310920": "9223372036854775807",
        "customfield_12312823": null,
        "creator": {
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=wesm",
            "name": "wesm",
            "key": "wesmckinn",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=wesmckinn&avatarId=29931",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=wesmckinn&avatarId=29931",
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=wesmckinn&avatarId=29931",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=wesmckinn&avatarId=29931"
            },
            "displayName": "Wes McKinney",
            "active": true,
            "timeZone": "America/New_York"
        },
        "subtasks": [],
        "reporter": {
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=wesm",
            "name": "wesm",
            "key": "wesmckinn",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=wesmckinn&avatarId=29931",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=wesmckinn&avatarId=29931",
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=wesmckinn&avatarId=29931",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=wesmckinn&avatarId=29931"
            },
            "displayName": "Wes McKinney",
            "active": true,
            "timeZone": "America/New_York"
        },
        "aggregateprogress": {
            "progress": 7800,
            "total": 7800,
            "percent": 100
        },
        "customfield_12313520": null,
        "customfield_12310250": null,
        "progress": {
            "progress": 7800,
            "total": 7800,
            "percent": 100
        },
        "customfield_12313924": null,
        "votes": {
            "self": "https://issues.apache.org/jira/rest/api/2/issue/ARROW-16852/votes",
            "votes": 0,
            "hasVoted": false
        },
        "worklog": {
            "startAt": 0,
            "maxResults": 20,
            "total": 13,
            "worklogs": [
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13450698/worklog/791784",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "wesm opened a new pull request, #13630:\nURL: https://github.com/apache/arrow/pull/13630\n\n   This completes the porting to use ExecSpan everywhere. I also changed the ExecBatchIterator benchmarks to use ExecSpan to show the performance improvement in input splitting that we've talked about in the past:\r\n   \r\n   Splitting inputs into small ExecSpan:\r\n   \r\n   ```\r\n   ------------------------------------------------------------------------------------\r\n   Benchmark                          Time             CPU   Iterations UserCounters...\r\n   ------------------------------------------------------------------------------------\r\n   BM_ExecSpanIterator/1024      205671 ns       205667 ns         3395 items_per_second=4.86223k/s\r\n   BM_ExecSpanIterator/4096       54749 ns        54750 ns        13121 items_per_second=18.265k/s\r\n   BM_ExecSpanIterator/16384      15979 ns        15979 ns        42628 items_per_second=62.5824k/s\r\n   BM_ExecSpanIterator/65536       5597 ns         5597 ns       125099 items_per_second=178.668k/s\r\n   ```\r\n   \r\n   Splitting inputs into small ExecBatch:\r\n   \r\n   ```\r\n   -------------------------------------------------------------------------------------\r\n   Benchmark                           Time             CPU   Iterations UserCounters...\r\n   -------------------------------------------------------------------------------------\r\n   BM_ExecBatchIterator/1024    17163432 ns     17163171 ns           41 items_per_second=58.2643/s\r\n   BM_ExecBatchIterator/4096     4243467 ns      4243316 ns          163 items_per_second=235.665/s\r\n   BM_ExecBatchIterator/16384    1093680 ns      1093638 ns          620 items_per_second=914.38/s\r\n   BM_ExecBatchIterator/65536     272451 ns       272435 ns         2584 items_per_second=3.6706k/s\r\n   ```\r\n   \r\n   Because the input in this benchmark has 1M elements, this shows that splitting into 1024 chunks of size 1024 adds only 0.2ms of overhead with ExecSpanIterator versus 17.16ms of overhead with ExecBatchIterator (> 80x improvement). \r\n   \r\n   This won't by itself do much to impact performance in Acero but things for the community to explore in the future are the following (this work that I've been doing has been a precondition to consider this):\r\n   \r\n   * A leaner ExecuteScalarExpression implementation that reuses temporary allocations (ARROW-16758)\r\n   * Parallel expression evaluation\r\n   * Better defining morsel (~1M elements) versus task (~1K elements) granularity in execution \r\n   * Work stealing so that we don't \"hog\" the thread pools, and we keep the work pinned to a particular CPU core if there are other things going on at the same time\n\n\n",
                    "created": "2022-07-17T20:16:40.252+0000",
                    "updated": "2022-07-17T20:16:40.252+0000",
                    "started": "2022-07-17T20:16:40.251+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "791784",
                    "issueId": "13450698"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13450698/worklog/791785",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "github-actions[bot] commented on PR #13630:\nURL: https://github.com/apache/arrow/pull/13630#issuecomment-1186600425\n\n   https://issues.apache.org/jira/browse/ARROW-16852\n\n\n",
                    "created": "2022-07-17T20:17:01.773+0000",
                    "updated": "2022-07-17T20:17:01.773+0000",
                    "started": "2022-07-17T20:17:01.772+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "791785",
                    "issueId": "13450698"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13450698/worklog/791793",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "wesm commented on PR #13630:\nURL: https://github.com/apache/arrow/pull/13630#issuecomment-1186610944\n\n   The only CI failures are the linkage issues related to protobuf/otel\n\n\n",
                    "created": "2022-07-17T21:33:03.965+0000",
                    "updated": "2022-07-17T21:33:03.965+0000",
                    "started": "2022-07-17T21:33:03.965+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "791793",
                    "issueId": "13450698"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13450698/worklog/792522",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "pitrou commented on code in PR #13630:\nURL: https://github.com/apache/arrow/pull/13630#discussion_r924240870\n\n\n##########\ncpp/src/arrow/compute/exec/aggregate.cc:\n##########\n@@ -193,8 +193,11 @@ Result<Datum> GroupBy(const std::vector<Datum>& arguments, const std::vector<Dat\n \n   // Merge if necessary\n   for (size_t thread_index = 1; thread_index < thread_ids.size(); ++thread_index) {\n+    // TODO: Return ExecSpan from GetUniques; but need to figure out memory\n+    // management strategy\n\nReview Comment:\n   Same here?\n\n\n\n##########\ncpp/src/arrow/compute/exec/aggregate.cc:\n##########\n@@ -174,15 +171,18 @@ Result<Datum> GroupBy(const std::vector<Datum>& arguments, const std::vector<Dat\n       auto grouper = groupers[thread_index].get();\n \n       // compute a batch of group ids\n+      // TODO(wesm): refactor Grouper::Consume to write into preallocated\n+      // memory\n\nReview Comment:\n   Rather than adding TODOs in the code, this would better be tracked and remembered using a JIRA, IMHO.\n\n\n\n##########\ncpp/src/arrow/compute/exec_internal.h:\n##########\n@@ -84,7 +51,10 @@ class ARROW_EXPORT ExecSpanIterator {\n   /// \\param[in] batch the input ExecBatch\n   /// \\param[in] max_chunksize the maximum length of each ExecSpan. Depending\n   /// on the chunk layout of ChunkedArray.\n-  Status Init(const ExecBatch& batch, int64_t max_chunksize = kDefaultMaxChunksize);\n+  /// \\param[in] promote_if_all_scalars if all of the values are scalars,\n+  /// return them in each ExecSpan as ArraySpan of length 1\n\nReview Comment:\n   What happens otherwise? (i.e. if all values are scalars but `promote_if_all_scalars` is false)\n\n\n\n##########\ncpp/src/arrow/compute/row/grouper.cc:\n##########\n@@ -294,20 +282,21 @@ struct GrouperFastImpl : Grouper {\n                                     ctx_->memory_pool()));\n           }\n         }\n-        return ConsumeImpl(expanded);\n+        return ConsumeImpl(ExecSpan(expanded));\n       }\n     }\n     return ConsumeImpl(batch);\n   }\n \n-  Result<Datum> ConsumeImpl(const ExecBatch& batch) {\n+  Result<Datum> ConsumeImpl(const ExecSpan& batch) {\n     int64_t num_rows = batch.length;\n     int num_columns = batch.num_values();\n     // Process dictionaries\n     for (int icol = 0; icol < num_columns; ++icol) {\n       if (key_types_[icol].id() == Type::DICTIONARY) {\n-        auto data = batch[icol].array();\n-        auto dict = MakeArray(data->dictionary);\n+        const ArraySpan& data = batch[icol].array;\n+        // TODO(wesm): do not require ToArrayData here\n\nReview Comment:\n   Add a JIRA?\n\n\n\n##########\ncpp/src/arrow/compute/exec_internal.h:\n##########\n@@ -110,6 +80,7 @@ class ARROW_EXPORT ExecSpanIterator {\n   bool initialized_ = false;\n   bool have_chunked_arrays_ = false;\n   bool have_all_scalars_ = false;\n+  bool promote_if_all_scalars_ = false;\n\nReview Comment:\n   For the sake of avoiding confusion, can this have the same default value `true` as in the constructor?\n\n\n\n##########\ncpp/src/arrow/compute/kernel.h:\n##########\n@@ -609,20 +609,17 @@ struct VectorKernel : public Kernel {\n // ----------------------------------------------------------------------\n // ScalarAggregateKernel (for ScalarAggregateFunction)\n \n-using ScalarAggregateConsume = std::function<Status(KernelContext*, const ExecBatch&)>;\n-\n-using ScalarAggregateMerge =\n-    std::function<Status(KernelContext*, KernelState&&, KernelState*)>;\n-\n+typedef Status (*ScalarAggregateConsume)(KernelContext*, const ExecSpan&);\n+typedef Status (*ScalarAggregateMerge)(KernelContext*, KernelState&&, KernelState*);\n // Finalize returns Datum to permit multiple return values\n-using ScalarAggregateFinalize = std::function<Status(KernelContext*, Datum*)>;\n+typedef Status (*ScalarAggregateFinalize)(KernelContext*, Datum*);\n\nReview Comment:\n   The style guide discourages `typedef` and recommends `using` instead\n\n\n\n##########\ncpp/src/arrow/compute/kernels/aggregate_basic_internal.h:\n##########\n@@ -448,9 +449,12 @@ struct MinMaxImpl : public ScalarAggregator {\n     return Status::OK();\n   }\n \n-  Status ConsumeArray(const ArrayType& arr) {\n+  Status ConsumeArray(const ArraySpan& arr_span) {\n     StateType local;\n \n+    // TODO(wesm): do not use ToArrayData\n+    ArrayType arr(arr_span.ToArrayData());\n\nReview Comment:\n   Is this something that you plan to do in a later PR? Or can it just be done here?\n\n\n\n##########\ncpp/src/arrow/compute/kernels/hash_aggregate_test.cc:\n##########\n@@ -202,14 +202,16 @@ Result<Datum> GroupByUsingExecPlan(const std::vector<Datum>& arguments,\n   inputs.reserve(inputs.size() + keys.size());\n   inputs.insert(inputs.end(), keys.begin(), keys.end());\n \n-  ARROW_ASSIGN_OR_RAISE(auto batch_iterator,\n-                        ExecBatchIterator::Make(inputs, ctx->exec_chunksize()));\n+  ExecSpanIterator span_iterator;\n+  ARROW_ASSIGN_OR_RAISE(auto batch, ExecBatch::Make(inputs));\n+  RETURN_NOT_OK(span_iterator.Init(batch, ctx->exec_chunksize()));\n   BatchesWithSchema input;\n   input.schema = schema(std::move(scan_fields));\n-  ExecBatch batch;\n-  while (batch_iterator->Next(&batch)) {\n-    if (batch.length == 0) continue;\n-    input.batches.push_back(std::move(batch));\n+  ExecSpan span;\n+  while (span_iterator.Next(&span)) {\n+    if (span.length == 0) continue;\n+    // TODO(wesm): investigate possibility of ExecPlans using ExecSpan\n\nReview Comment:\n   Should this be a JIRA instead? TODOs sprinkled in code are often ignored.\n\n\n\n##########\ncpp/src/arrow/compute/kernel.h:\n##########\n@@ -659,23 +656,20 @@ struct ScalarAggregateKernel : public Kernel {\n // ----------------------------------------------------------------------\n // HashAggregateKernel (for HashAggregateFunction)\n \n-using HashAggregateResize = std::function<Status(KernelContext*, int64_t)>;\n-\n-using HashAggregateConsume = std::function<Status(KernelContext*, const ExecBatch&)>;\n-\n-using HashAggregateMerge =\n-    std::function<Status(KernelContext*, KernelState&&, const ArrayData&)>;\n+typedef Status (*HashAggregateResize)(KernelContext*, int64_t);\n+typedef Status (*HashAggregateConsume)(KernelContext*, const ExecSpan&);\n+typedef Status (*HashAggregateMerge)(KernelContext*, KernelState&&, const ArrayData&);\n \n // Finalize returns Datum to permit multiple return values\n-using HashAggregateFinalize = std::function<Status(KernelContext*, Datum*)>;\n+typedef Status (*HashAggregateFinalize)(KernelContext*, Datum*);\n\nReview Comment:\n   Same here.\n\n\n\n##########\ncpp/src/arrow/compute/kernels/aggregate_quantile.cc:\n##########\n@@ -471,45 +471,6 @@ struct ExactQuantiler<InType, enable_if_t<is_decimal_type<InType>::value>> {\n   SortQuantiler<InType> impl;\n };\n \n-template <typename T>\n-Status ScalarQuantile(KernelContext* ctx, const Scalar& scalar, ExecResult* out) {\n-  const QuantileOptions& options = QuantileState::Get(ctx);\n-  using CType = typename TypeTraits<T>::CType;\n-  ArrayData* output = out->array_data().get();\n-  output->length = options.q.size();\n-  auto out_type = IsDataPoint(options) ? scalar.type : float64();\n-  ARROW_ASSIGN_OR_RAISE(output->buffers[1],\n-                        ctx->Allocate(output->length * out_type->byte_width()));\n-\n-  if (!scalar.is_valid || options.min_count > 1) {\n-    output->null_count = output->length;\n-    ARROW_ASSIGN_OR_RAISE(output->buffers[0], ctx->AllocateBitmap(output->length));\n-    bit_util::SetBitsTo(output->buffers[0]->mutable_data(), /*offset=*/0, output->length,\n-                        false);\n-    if (IsDataPoint(options)) {\n-      CType* out_buffer = output->template GetMutableValues<CType>(1);\n-      std::fill(out_buffer, out_buffer + output->length, CType(0));\n-    } else {\n-      double* out_buffer = output->template GetMutableValues<double>(1);\n-      std::fill(out_buffer, out_buffer + output->length, 0.0);\n-    }\n-    return Status::OK();\n-  }\n-  output->null_count = 0;\n-  if (IsDataPoint(options)) {\n-    CType* out_buffer = output->template GetMutableValues<CType>(1);\n-    for (int64_t i = 0; i < output->length; i++) {\n-      out_buffer[i] = UnboxScalar<T>::Unbox(scalar);\n-    }\n-  } else {\n-    double* out_buffer = output->template GetMutableValues<double>(1);\n-    for (int64_t i = 0; i < output->length; i++) {\n-      out_buffer[i] = DataPointToDouble(UnboxScalar<T>::Unbox(scalar), *scalar.type);\n-    }\n-  }\n-  return Status::OK();\n-}\n-\n\nReview Comment:\n   Neat removal :-)\n\n\n\n",
                    "created": "2022-07-19T09:04:08.355+0000",
                    "updated": "2022-07-19T09:04:08.355+0000",
                    "started": "2022-07-19T09:04:08.354+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "792522",
                    "issueId": "13450698"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13450698/worklog/792685",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "wesm commented on code in PR #13630:\nURL: https://github.com/apache/arrow/pull/13630#discussion_r924503273\n\n\n##########\ncpp/src/arrow/compute/exec_internal.h:\n##########\n@@ -84,7 +51,10 @@ class ARROW_EXPORT ExecSpanIterator {\n   /// \\param[in] batch the input ExecBatch\n   /// \\param[in] max_chunksize the maximum length of each ExecSpan. Depending\n   /// on the chunk layout of ChunkedArray.\n-  Status Init(const ExecBatch& batch, int64_t max_chunksize = kDefaultMaxChunksize);\n+  /// \\param[in] promote_if_all_scalars if all of the values are scalars,\n+  /// return them in each ExecSpan as ArraySpan of length 1\n\nReview Comment:\n   I'm adding a comment that it should be set to true for scalar/vector executors and false for scalar/hash aggregation execution\n\n\n\n",
                    "created": "2022-07-19T13:28:41.169+0000",
                    "updated": "2022-07-19T13:28:41.169+0000",
                    "started": "2022-07-19T13:28:41.169+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "792685",
                    "issueId": "13450698"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13450698/worklog/792687",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "wesm commented on code in PR #13630:\nURL: https://github.com/apache/arrow/pull/13630#discussion_r924503533\n\n\n##########\ncpp/src/arrow/compute/exec_internal.h:\n##########\n@@ -110,6 +80,7 @@ class ARROW_EXPORT ExecSpanIterator {\n   bool initialized_ = false;\n   bool have_chunked_arrays_ = false;\n   bool have_all_scalars_ = false;\n+  bool promote_if_all_scalars_ = false;\n\nReview Comment:\n   +1\n\n\n\n",
                    "created": "2022-07-19T13:28:56.142+0000",
                    "updated": "2022-07-19T13:28:56.142+0000",
                    "started": "2022-07-19T13:28:56.142+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "792687",
                    "issueId": "13450698"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13450698/worklog/792690",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "wesm commented on code in PR #13630:\nURL: https://github.com/apache/arrow/pull/13630#discussion_r924506361\n\n\n##########\ncpp/src/arrow/compute/kernels/aggregate_basic_internal.h:\n##########\n@@ -448,9 +449,12 @@ struct MinMaxImpl : public ScalarAggregator {\n     return Status::OK();\n   }\n \n-  Status ConsumeArray(const ArrayType& arr) {\n+  Status ConsumeArray(const ArraySpan& arr_span) {\n     StateType local;\n \n+    // TODO(wesm): do not use ToArrayData\n+    ArrayType arr(arr_span.ToArrayData());\n\nReview Comment:\n   It can be done later, non-urgently. The span has to be \"boxed\" in order to use `ArrayType::GetView`, but we could make that unnecessary in a subsequent PR. I'm removing the TODO comment since usages of `ToArrayData` can be found easily\n\n\n\n",
                    "created": "2022-07-19T13:31:16.409+0000",
                    "updated": "2022-07-19T13:31:16.409+0000",
                    "started": "2022-07-19T13:31:16.409+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "792690",
                    "issueId": "13450698"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13450698/worklog/792693",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "wesm commented on code in PR #13630:\nURL: https://github.com/apache/arrow/pull/13630#discussion_r924508277\n\n\n##########\ncpp/src/arrow/compute/kernels/hash_aggregate_test.cc:\n##########\n@@ -202,14 +202,16 @@ Result<Datum> GroupByUsingExecPlan(const std::vector<Datum>& arguments,\n   inputs.reserve(inputs.size() + keys.size());\n   inputs.insert(inputs.end(), keys.begin(), keys.end());\n \n-  ARROW_ASSIGN_OR_RAISE(auto batch_iterator,\n-                        ExecBatchIterator::Make(inputs, ctx->exec_chunksize()));\n+  ExecSpanIterator span_iterator;\n+  ARROW_ASSIGN_OR_RAISE(auto batch, ExecBatch::Make(inputs));\n+  RETURN_NOT_OK(span_iterator.Init(batch, ctx->exec_chunksize()));\n   BatchesWithSchema input;\n   input.schema = schema(std::move(scan_fields));\n-  ExecBatch batch;\n-  while (batch_iterator->Next(&batch)) {\n-    if (batch.length == 0) continue;\n-    input.batches.push_back(std::move(batch));\n+  ExecSpan span;\n+  while (span_iterator.Next(&span)) {\n+    if (span.length == 0) continue;\n+    // TODO(wesm): investigate possibility of ExecPlans using ExecSpan\n\nReview Comment:\n   Removing this comment ",
                    "created": "2022-07-19T13:32:51.646+0000",
                    "updated": "2022-07-19T13:32:51.646+0000",
                    "started": "2022-07-19T13:32:51.645+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "792693",
                    "issueId": "13450698"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13450698/worklog/792700",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "wesm commented on code in PR #13630:\nURL: https://github.com/apache/arrow/pull/13630#discussion_r924520932\n\n\n##########\ncpp/src/arrow/compute/row/grouper.cc:\n##########\n@@ -294,20 +282,21 @@ struct GrouperFastImpl : Grouper {\n                                     ctx_->memory_pool()));\n           }\n         }\n-        return ConsumeImpl(expanded);\n+        return ConsumeImpl(ExecSpan(expanded));\n       }\n     }\n     return ConsumeImpl(batch);\n   }\n \n-  Result<Datum> ConsumeImpl(const ExecBatch& batch) {\n+  Result<Datum> ConsumeImpl(const ExecSpan& batch) {\n     int64_t num_rows = batch.length;\n     int num_columns = batch.num_values();\n     // Process dictionaries\n     for (int icol = 0; icol < num_columns; ++icol) {\n       if (key_types_[icol].id() == Type::DICTIONARY) {\n-        auto data = batch[icol].array();\n-        auto dict = MakeArray(data->dictionary);\n+        const ArraySpan& data = batch[icol].array;\n+        // TODO(wesm): do not require ToArrayData here\n\nReview Comment:\n   Removed the comment for now, each of the usages of `ToArrayData` can be given consideration in the future\n\n\n\n",
                    "created": "2022-07-19T13:43:42.804+0000",
                    "updated": "2022-07-19T13:43:42.804+0000",
                    "started": "2022-07-19T13:43:42.803+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "792700",
                    "issueId": "13450698"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13450698/worklog/792701",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "wesm commented on PR #13630:\nURL: https://github.com/apache/arrow/pull/13630#issuecomment-1189072689\n\n   Thanks for the review. Will merge when CI green\n\n\n",
                    "created": "2022-07-19T13:43:45.066+0000",
                    "updated": "2022-07-19T13:43:45.066+0000",
                    "started": "2022-07-19T13:43:45.066+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "792701",
                    "issueId": "13450698"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13450698/worklog/792921",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "wesm commented on PR #13630:\nURL: https://github.com/apache/arrow/pull/13630#issuecomment-1189567050\n\n   Merging. The CI issues look like assorted flakiness to me\r\n   \n\n\n",
                    "created": "2022-07-19T21:26:14.220+0000",
                    "updated": "2022-07-19T21:26:14.220+0000",
                    "started": "2022-07-19T21:26:14.220+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "792921",
                    "issueId": "13450698"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13450698/worklog/792922",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "wesm merged PR #13630:\nURL: https://github.com/apache/arrow/pull/13630\n\n\n",
                    "created": "2022-07-19T21:26:49.032+0000",
                    "updated": "2022-07-19T21:26:49.032+0000",
                    "started": "2022-07-19T21:26:49.032+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "792922",
                    "issueId": "13450698"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13450698/worklog/793422",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "ursabot commented on PR #13630:\nURL: https://github.com/apache/arrow/pull/13630#issuecomment-1190718846\n\n   Benchmark runs are scheduled for baseline = c445243a1455a7e06c7bed95596499e348056bac and contender = 4d931ff1c0f5661a9b134c514555c8d769001759. 4d931ff1c0f5661a9b134c514555c8d769001759 is a master commit associated with this PR. Results will be available as each benchmark for each run completes.\n   Conbench compare runs links:\n   [Failed :arrow_down:0.0% :arrow_up:0.0%] [ec2-t3-xlarge-us-east-2](https://conbench.ursa.dev/compare/runs/e236dc0baca944c39aba0b10373ee78d...416d0f20e0a7464aa2298b095ec0e24e/)\n   [Failed :arrow_down:2.19% :arrow_up:0.21%] [test-mac-arm](https://conbench.ursa.dev/compare/runs/6ca53824b9bb4138b82381c91d3f5287...df1a70fbca9a4fd699797283645f1dcf/)\n   [Failed] [ursa-i9-9960x](https://conbench.ursa.dev/compare/runs/78939a04be7e4e6b9c0047ad92848c03...2cbbc47be7b348beb9e905a8f589c4bb/)\n   [Finished :arrow_down:1.03% :arrow_up:0.43%] [ursa-thinkcentre-m75q](https://conbench.ursa.dev/compare/runs/e39359f410b843cf967af5fa572cbc08...342374c3c2a04d398df9e01cf22cde4a/)\n   Buildkite builds:\n   [Failed] [`4d931ff1` ec2-t3-xlarge-us-east-2](https://buildkite.com/apache-arrow/arrow-bci-benchmark-on-ec2-t3-xlarge-us-east-2/builds/1151)\n   [Failed] [`4d931ff1` test-mac-arm](https://buildkite.com/apache-arrow/arrow-bci-benchmark-on-test-mac-arm/builds/1156)\n   [Failed] [`4d931ff1` ursa-i9-9960x](https://buildkite.com/apache-arrow/arrow-bci-benchmark-on-ursa-i9-9960x/builds/1143)\n   [Finished] [`4d931ff1` ursa-thinkcentre-m75q](https://buildkite.com/apache-arrow/arrow-bci-benchmark-on-ursa-thinkcentre-m75q/builds/1160)\n   [Failed] [`c445243a` ec2-t3-xlarge-us-east-2](https://buildkite.com/apache-arrow/arrow-bci-benchmark-on-ec2-t3-xlarge-us-east-2/builds/1150)\n   [Failed] [`c445243a` test-mac-arm](https://buildkite.com/apache-arrow/arrow-bci-benchmark-on-test-mac-arm/builds/1155)\n   [Failed] [`c445243a` ursa-i9-9960x](https://buildkite.com/apache-arrow/arrow-bci-benchmark-on-ursa-i9-9960x/builds/1142)\n   [Finished] [`c445243a` ursa-thinkcentre-m75q](https://buildkite.com/apache-arrow/arrow-bci-benchmark-on-ursa-thinkcentre-m75q/builds/1159)\n   Supported benchmarks:\n   ec2-t3-xlarge-us-east-2: Supported benchmark langs: Python, R. Runs only benchmarks with cloud = True\n   test-mac-arm: Supported benchmark langs: C++, Python, R\n   ursa-i9-9960x: Supported benchmark langs: Python, R, JavaScript\n   ursa-thinkcentre-m75q: Supported benchmark langs: C++, Java\n   \n\n\n",
                    "created": "2022-07-20T20:21:46.618+0000",
                    "updated": "2022-07-20T20:21:46.618+0000",
                    "started": "2022-07-20T20:21:46.617+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "793422",
                    "issueId": "13450698"
                }
            ]
        },
        "customfield_12313920": null,
        "issuetype": {
            "self": "https://issues.apache.org/jira/rest/api/2/issuetype/4",
            "id": "4",
            "description": "An improvement or enhancement to an existing feature or task.",
            "iconUrl": "https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21140&avatarType=issuetype",
            "name": "Improvement",
            "subtask": false,
            "avatarId": 21140
        },
        "timespent": 7800,
        "customfield_12314020": "{summaryBean=com.atlassian.jira.plugin.devstatus.rest.SummaryBean@6f60e102[summary={pullrequest=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@512afd7e[overall=PullRequestOverallBean{stateCount=0, state='OPEN', details=PullRequestOverallDetails{openCount=0, mergedCount=0, declinedCount=0}},byInstanceType={}], build=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@50bd6c2f[overall=com.atlassian.jira.plugin.devstatus.summary.beans.BuildOverallBean@567aaa4b[failedBuildCount=0,successfulBuildCount=0,unknownBuildCount=0,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], review=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@52c67c42[overall=com.atlassian.jira.plugin.devstatus.summary.beans.ReviewsOverallBean@53ae77b[stateCount=0,state=<null>,dueDate=<null>,overDue=false,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], deployment-environment=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@3e5d2fe7[overall=com.atlassian.jira.plugin.devstatus.summary.beans.DeploymentOverallBean@3df6e295[topEnvironments=[],showProjects=false,successfulCount=0,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], repository=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@5c33ad05[overall=com.atlassian.jira.plugin.devstatus.summary.beans.CommitOverallBean@ee088c7[count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], branch=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@5995bceb[overall=com.atlassian.jira.plugin.devstatus.summary.beans.BranchOverallBean@53fd1f06[count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}]},errors=[],configErrors=[]], devSummaryJson={\"cachedValue\":{\"errors\":[],\"configErrors\":[],\"summary\":{\"pullrequest\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"stateCount\":0,\"state\":\"OPEN\",\"details\":{\"openCount\":0,\"mergedCount\":0,\"declinedCount\":0,\"total\":0},\"open\":true},\"byInstanceType\":{}},\"build\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"failedBuildCount\":0,\"successfulBuildCount\":0,\"unknownBuildCount\":0},\"byInstanceType\":{}},\"review\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"stateCount\":0,\"state\":null,\"dueDate\":null,\"overDue\":false,\"completed\":false},\"byInstanceType\":{}},\"deployment-environment\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"topEnvironments\":[],\"showProjects\":false,\"successfulCount\":0},\"byInstanceType\":{}},\"repository\":{\"overall\":{\"count\":0,\"lastUpdated\":null},\"byInstanceType\":{}},\"branch\":{\"overall\":{\"count\":0,\"lastUpdated\":null},\"byInstanceType\":{}}}},\"isStale\":false}}",
        "customfield_12314141": null,
        "customfield_12314140": null,
        "project": {
            "self": "https://issues.apache.org/jira/rest/api/2/project/12319525",
            "id": "12319525",
            "key": "ARROW",
            "name": "Apache Arrow",
            "projectTypeKey": "software",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/projectavatar?pid=12319525&avatarId=10011",
                "24x24": "https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12319525&avatarId=10011",
                "16x16": "https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12319525&avatarId=10011",
                "32x32": "https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12319525&avatarId=10011"
            },
            "projectCategory": {
                "self": "https://issues.apache.org/jira/rest/api/2/projectCategory/13960",
                "id": "13960",
                "description": "Apache Arrow",
                "name": "Arrow"
            }
        },
        "aggregatetimespent": 7800,
        "customfield_12312520": null,
        "customfield_12312521": "Tue Jul 19 21:26:49 UTC 2022",
        "customfield_12314422": null,
        "customfield_12314421": null,
        "customfield_12314146": null,
        "customfield_12314420": null,
        "customfield_12314145": null,
        "customfield_12314144": null,
        "customfield_12314143": null,
        "resolutiondate": "2022-07-19T21:26:49.000+0000",
        "workratio": -1,
        "customfield_12312923": null,
        "customfield_12312920": null,
        "customfield_12312921": null,
        "watches": {
            "self": "https://issues.apache.org/jira/rest/api/2/issue/ARROW-16852/watchers",
            "watchCount": 1,
            "isWatching": false
        },
        "created": "2022-06-18T01:08:57.000+0000",
        "updated": "2022-07-20T20:21:46.000+0000",
        "timeoriginalestimate": null,
        "description": "Following work in ARROW-16824",
        "customfield_10010": null,
        "timetracking": {
            "remainingEstimate": "0h",
            "timeSpent": "2h 10m",
            "remainingEstimateSeconds": 0,
            "timeSpentSeconds": 7800
        },
        "customfield_12314523": null,
        "customfield_12314127": null,
        "customfield_12314522": null,
        "customfield_12314126": null,
        "customfield_12314521": null,
        "customfield_12314125": null,
        "customfield_12314520": null,
        "customfield_12314124": null,
        "attachment": [],
        "customfield_12312340": null,
        "customfield_12314123": null,
        "customfield_12312341": null,
        "customfield_12312220": null,
        "customfield_12314122": null,
        "customfield_12314121": null,
        "customfield_12314120": null,
        "customfield_12314129": null,
        "customfield_12314524": null,
        "customfield_12314128": null,
        "summary": "[C++] Migrate SCALAR_AGGREGATE, HASH_AGGREGATE functions to use ExecSpan",
        "customfield_12314130": null,
        "customfield_12310291": null,
        "customfield_12310290": null,
        "customfield_12314138": null,
        "customfield_12314137": null,
        "environment": null,
        "customfield_12314136": null,
        "customfield_12314135": null,
        "customfield_12311020": null,
        "customfield_12314134": null,
        "duedate": null,
        "customfield_12314132": null,
        "customfield_12314131": null,
        "comment": {
            "comments": [
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13450698/comment/17568741",
                    "id": "17568741",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=wesm",
                        "name": "wesm",
                        "key": "wesmckinn",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=wesmckinn&avatarId=29931",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=wesmckinn&avatarId=29931",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=wesmckinn&avatarId=29931",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=wesmckinn&avatarId=29931"
                        },
                        "displayName": "Wes McKinney",
                        "active": true,
                        "timeZone": "America/New_York"
                    },
                    "body": "Issue resolved by pull request 13630\n[https://github.com/apache/arrow/pull/13630]",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=wesm",
                        "name": "wesm",
                        "key": "wesmckinn",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=wesmckinn&avatarId=29931",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=wesmckinn&avatarId=29931",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=wesmckinn&avatarId=29931",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=wesmckinn&avatarId=29931"
                        },
                        "displayName": "Wes McKinney",
                        "active": true,
                        "timeZone": "America/New_York"
                    },
                    "created": "2022-07-19T21:26:49.574+0000",
                    "updated": "2022-07-19T21:26:49.574+0000"
                }
            ],
            "maxResults": 1,
            "total": 1,
            "startAt": 0
        },
        "customfield_12311820": "0|z13cd4:",
        "customfield_12314139": null
    }
}