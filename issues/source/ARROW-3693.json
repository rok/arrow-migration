{
    "expand": "operations,versionedRepresentations,editmeta,changelog,renderedFields",
    "id": "13196027",
    "self": "https://issues.apache.org/jira/rest/api/2/issue/13196027",
    "key": "ARROW-3693",
    "fields": {
        "fixVersions": [
            {
                "self": "https://issues.apache.org/jira/rest/api/2/version/12343858",
                "id": "12343858",
                "description": "",
                "name": "0.12.0",
                "archived": false,
                "released": true,
                "releaseDate": "2019-01-20"
            }
        ],
        "resolution": {
            "self": "https://issues.apache.org/jira/rest/api/2/resolution/1",
            "id": "1",
            "description": "A fix for this issue is checked into the tree and tested.",
            "name": "Fixed"
        },
        "customfield_12312322": null,
        "customfield_12312323": null,
        "customfield_12312320": null,
        "customfield_12310420": "9223372036854775807",
        "customfield_12312321": null,
        "customfield_12312328": null,
        "customfield_12312329": null,
        "customfield_12312326": null,
        "customfield_12310300": null,
        "customfield_12312327": null,
        "customfield_12312324": null,
        "customfield_12312720": null,
        "customfield_12312325": null,
        "lastViewed": null,
        "priority": {
            "self": "https://issues.apache.org/jira/rest/api/2/priority/3",
            "iconUrl": "https://issues.apache.org/jira/images/icons/priorities/major.svg",
            "name": "Major",
            "id": "3"
        },
        "labels": [
            "pull-request-available"
        ],
        "customfield_12312333": null,
        "customfield_12312334": null,
        "customfield_12313422": "false",
        "customfield_12310310": "1.0",
        "customfield_12312331": null,
        "customfield_12312332": null,
        "aggregatetimeoriginalestimate": null,
        "timeestimate": 0,
        "customfield_12312330": null,
        "versions": [],
        "customfield_12311120": null,
        "customfield_12313826": null,
        "customfield_12312339": null,
        "issuelinks": [],
        "customfield_12313825": null,
        "assignee": {
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=romainfrancois",
            "name": "romainfrancois",
            "key": "romainfrancois",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=romainfrancois&avatarId=35092",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=romainfrancois&avatarId=35092",
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=romainfrancois&avatarId=35092",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=romainfrancois&avatarId=35092"
            },
            "displayName": "Romain Francois",
            "active": true,
            "timeZone": "Etc/UTC"
        },
        "customfield_12312337": null,
        "customfield_12313823": null,
        "customfield_12312338": null,
        "customfield_12311920": null,
        "customfield_12313822": null,
        "customfield_12312335": null,
        "customfield_12313821": null,
        "customfield_12312336": null,
        "customfield_12313820": null,
        "status": {
            "self": "https://issues.apache.org/jira/rest/api/2/status/5",
            "description": "A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.",
            "iconUrl": "https://issues.apache.org/jira/images/icons/statuses/resolved.png",
            "name": "Resolved",
            "id": "5",
            "statusCategory": {
                "self": "https://issues.apache.org/jira/rest/api/2/statuscategory/3",
                "id": 3,
                "key": "done",
                "colorName": "green",
                "name": "Done"
            }
        },
        "components": [
            {
                "self": "https://issues.apache.org/jira/rest/api/2/component/12333008",
                "id": "12333008",
                "name": "R"
            }
        ],
        "customfield_12312026": null,
        "customfield_12312023": null,
        "customfield_12312024": null,
        "aggregatetimeestimate": 0,
        "customfield_12312022": null,
        "customfield_12310921": null,
        "customfield_12310920": "9223372036854775807",
        "customfield_12312823": null,
        "creator": {
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=javierluraschi",
            "name": "javierluraschi",
            "key": "javierluraschi",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
            },
            "displayName": "Javier Luraschi",
            "active": true,
            "timeZone": "Etc/UTC"
        },
        "subtasks": [],
        "reporter": {
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=javierluraschi",
            "name": "javierluraschi",
            "key": "javierluraschi",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
            },
            "displayName": "Javier Luraschi",
            "active": true,
            "timeZone": "Etc/UTC"
        },
        "aggregateprogress": {
            "progress": 16200,
            "total": 16200,
            "percent": 100
        },
        "customfield_12313520": null,
        "customfield_12310250": null,
        "progress": {
            "progress": 16200,
            "total": 16200,
            "percent": 100
        },
        "customfield_12313924": null,
        "votes": {
            "self": "https://issues.apache.org/jira/rest/api/2/issue/ARROW-3693/votes",
            "votes": 0,
            "hasVoted": false
        },
        "worklog": {
            "startAt": 0,
            "maxResults": 20,
            "total": 27,
            "worklogs": [
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13196027/worklog/162190",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "javierluraschi opened a new pull request #2896: ARROW-3693: [R] Invalid buffer for empty characters with null data\nURL: https://github.com/apache/arrow/pull/2896\n \n \n   Fix for https://issues.apache.org/jira/browse/ARROW-3693.\r\n   \r\n   Found a case while retrieving nullable-strings from Spark into R where a table like:\r\n   \r\n   ```\r\n   <database>   <name>    <temp>\r\n   \"\"           \"A\"       TRUE\r\n   ```\r\n   \r\n   Triggers: `error: Failed to fetch data: invalid data in buffer`.\r\n   \r\n   The issue seems to be that is valid to return a `NULL` array for the data buffer when there are only empty strings, the nulls array won't contain NULLs since the entries are not null, they are just empty and the offsets are set to 0s, since all entries are empty string that start and end at offset 0. There is a memory dump in the JIRA issue which explains this in more detail.\r\n   \r\n   CC: @romainfrancois \n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2018-11-03T05:42:01.159+0000",
                    "updated": "2018-11-03T05:42:01.159+0000",
                    "started": "2018-11-03T05:42:01.158+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "162190",
                    "issueId": "13196027"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13196027/worklog/162332",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "wesm commented on a change in pull request #2896: ARROW-3693: [R] Invalid buffer for empty characters with null data\nURL: https://github.com/apache/arrow/pull/2896#discussion_r230598805\n \n \n\n ##########\n File path: r/src/array.cpp\n ##########\n @@ -539,7 +539,7 @@ inline SEXP StringArray_to_Vector(const std::shared_ptr<arrow::Array>& array) {\n \n   Rcpp::CharacterVector res(no_init(n));\n   auto p_offset = GetValuesSafely<int32_t>(array->data(), 1, array->offset());\n-  auto p_data = GetValuesSafely<char>(array->data(), 2, *p_offset);\n+  auto p_data = GetValuesOrNull<char>(array->data(), 2, *p_offset);\n \n Review comment:\n   I'm not sure what the purpose of `GetValuesSafely` is now\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2018-11-04T18:05:19.038+0000",
                    "updated": "2018-11-04T18:05:19.038+0000",
                    "started": "2018-11-04T18:05:19.038+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "162332",
                    "issueId": "13196027"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13196027/worklog/162333",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "wesm commented on a change in pull request #2896: ARROW-3693: [R] Invalid buffer for empty characters with null data\nURL: https://github.com/apache/arrow/pull/2896#discussion_r230598828\n \n \n\n ##########\n File path: r/src/array.cpp\n ##########\n @@ -539,7 +539,7 @@ inline SEXP StringArray_to_Vector(const std::shared_ptr<arrow::Array>& array) {\n \n   Rcpp::CharacterVector res(no_init(n));\n   auto p_offset = GetValuesSafely<int32_t>(array->data(), 1, array->offset());\n-  auto p_data = GetValuesSafely<char>(array->data(), 2, *p_offset);\n+  auto p_data = GetValuesOrNull<char>(array->data(), 2, *p_offset);\n \n Review comment:\n   I think the correct behavior is always to return null (for length-0 arrays), not to have an error\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2018-11-04T18:05:51.103+0000",
                    "updated": "2018-11-04T18:05:51.103+0000",
                    "started": "2018-11-04T18:05:51.097+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "162333",
                    "issueId": "13196027"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13196027/worklog/162545",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "romainfrancois commented on a change in pull request #2896: ARROW-3693: [R] Invalid buffer for empty characters with null data\nURL: https://github.com/apache/arrow/pull/2896#discussion_r230786131\n \n \n\n ##########\n File path: r/src/arrow_types.h\n ##########\n @@ -137,6 +137,17 @@ inline const T* GetValuesSafely(const std::shared_ptr<ArrayData>& data, int i,\n   return reinterpret_cast<const T*>(buffer->data()) + offset;\n }\n \n+template <typename T>\n+inline const T* GetValuesOrNull(const std::shared_ptr<ArrayData>& data, int i,\n+                                int64_t offset) {\n+  auto buffer = data->buffers[i];\n+  if (!buffer) {\n+    return reinterpret_cast<const T*>(NULL);\n \n Review comment:\n   that can just be `return nullptr; `\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2018-11-05T15:13:36.755+0000",
                    "updated": "2018-11-05T15:13:36.755+0000",
                    "started": "2018-11-05T15:13:36.754+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "162545",
                    "issueId": "13196027"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13196027/worklog/162889",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "javierluraschi commented on a change in pull request #2896: ARROW-3693: [R] Invalid buffer for empty characters with null data\nURL: https://github.com/apache/arrow/pull/2896#discussion_r230995286\n \n \n\n ##########\n File path: r/src/array.cpp\n ##########\n @@ -539,7 +539,7 @@ inline SEXP StringArray_to_Vector(const std::shared_ptr<arrow::Array>& array) {\n \n   Rcpp::CharacterVector res(no_init(n));\n   auto p_offset = GetValuesSafely<int32_t>(array->data(), 1, array->offset());\n-  auto p_data = GetValuesSafely<char>(array->data(), 2, *p_offset);\n+  auto p_data = GetValuesOrNull<char>(array->data(), 2, *p_offset);\n \n Review comment:\n   Makes sense, changed. Ran the tests, so far so good; but would definitely wait for @romainfrancois feedback before merging.\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2018-11-06T04:19:09.038+0000",
                    "updated": "2018-11-06T04:19:09.038+0000",
                    "started": "2018-11-06T04:19:09.037+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "162889",
                    "issueId": "13196027"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13196027/worklog/162929",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "romainfrancois commented on issue #2896: ARROW-3693: [R] Invalid buffer for empty characters with null data\nURL: https://github.com/apache/arrow/pull/2896#issuecomment-436156690\n \n \n   We need to find a way to add a test for this. \n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2018-11-06T07:31:11.061+0000",
                    "updated": "2018-11-06T07:31:11.061+0000",
                    "started": "2018-11-06T07:31:11.060+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "162929",
                    "issueId": "13196027"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13196027/worklog/162955",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "wesm commented on issue #2896: ARROW-3693: [R] Invalid buffer for empty characters with null data\nURL: https://github.com/apache/arrow/pull/2896#issuecomment-436178793\n \n \n   It it possible to create a googletest executable that can run these functions from the C++ side? e.g. we have https://github.com/apache/arrow/blob/master/cpp/src/arrow/python/python-test.cc\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2018-11-06T09:01:47.012+0000",
                    "updated": "2018-11-06T09:01:47.012+0000",
                    "started": "2018-11-06T09:01:47.011+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "162955",
                    "issueId": "13196027"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13196027/worklog/163012",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "romainfrancois opened a new pull request #2910: ARROW-3693: [R] Invalid buffer for empty characters with null data\nURL: https://github.com/apache/arrow/pull/2910\n \n \n   This follows up (and replaces) #2896\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2018-11-06T12:00:56.798+0000",
                    "updated": "2018-11-06T12:00:56.798+0000",
                    "started": "2018-11-06T12:00:56.797+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "163012",
                    "issueId": "13196027"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13196027/worklog/163013",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "romainfrancois commented on issue #2896: ARROW-3693: [R] Invalid buffer for empty characters with null data\nURL: https://github.com/apache/arrow/pull/2896#issuecomment-436229072\n \n \n   See #2910 for a follow up\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2018-11-06T12:01:36.013+0000",
                    "updated": "2018-11-06T12:01:36.013+0000",
                    "started": "2018-11-06T12:01:36.011+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "163013",
                    "issueId": "13196027"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13196027/worklog/163014",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "wesm commented on issue #2910: ARROW-3693: [R] Invalid buffer for empty characters with null data\nURL: https://github.com/apache/arrow/pull/2910#issuecomment-436229844\n \n \n   It isn't invalid for the pointer to be null if the array's length is 0\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2018-11-06T12:04:56.386+0000",
                    "updated": "2018-11-06T12:04:56.386+0000",
                    "started": "2018-11-06T12:04:56.385+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "163014",
                    "issueId": "13196027"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13196027/worklog/163015",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "romainfrancois commented on issue #2910: ARROW-3693: [R] Invalid buffer for empty characters with null data\nURL: https://github.com/apache/arrow/pull/2910#issuecomment-436230001\n \n \n   Since `GetValuesSalefy` does not abort anymore, I've added `R_ERROR_IF_NULL` to do so in cases when the buffers are invalid. \r\n   \r\n   For the specific case described in https://issues.apache.org/jira/browse/ARROW-3693 I followed up on @javierluraschi initial commits with code that allows null value buffers when all the strings are either empty of nulls. \r\n   \r\n   Took it as an opportunity to also expose the `buffers` field of `ArrayData` so that we can test this, e.g. : \r\n   \r\n   ``` r\r\n   library(arrow)\r\n   #> \r\n   #> Attaching package: 'arrow'\r\n   #> The following object is masked from 'package:utils':\r\n   #> \r\n   #>     timestamp\r\n   #> The following objects are masked from 'package:base':\r\n   #> \r\n   #>     array, table\r\n   a <- array(\"\")\r\n   a$data()$buffers\r\n   #> [[1]]\r\n   #> NULL\r\n   #> \r\n   #> [[2]]\r\n   #> arrow::Buffer <0x7fadae666ca0> \r\n   #> \r\n   #> [[3]]\r\n   #> NULL\r\n   ```\r\n   \r\n   <sup>Created on 2018-11-06 by the [reprex package](https://reprex.tidyverse.org) (v0.2.1.9000)</sup>\r\n   \n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2018-11-06T12:05:37.038+0000",
                    "updated": "2018-11-06T12:05:37.038+0000",
                    "started": "2018-11-06T12:05:37.037+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "163015",
                    "issueId": "13196027"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13196027/worklog/163016",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "romainfrancois commented on issue #2910: ARROW-3693: [R] Invalid buffer for empty characters with null data\nURL: https://github.com/apache/arrow/pull/2910#issuecomment-436230428\n \n \n   I understand that @wesm calls to `R_ERROR_IF_NULL` typically appear after handling the special cases: \r\n   \r\n   - the array is 0 sized\r\n   - the array is only made of nulls\r\n   \n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2018-11-06T12:07:24.819+0000",
                    "updated": "2018-11-06T12:07:24.819+0000",
                    "started": "2018-11-06T12:07:24.818+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "163016",
                    "issueId": "13196027"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13196027/worklog/163017",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "romainfrancois edited a comment on issue #2910: ARROW-3693: [R] Invalid buffer for empty characters with null data\nURL: https://github.com/apache/arrow/pull/2910#issuecomment-436230428\n \n \n   I understand that @wesm, and calls to `R_ERROR_IF_NULL` typically appear after handling the special cases: \r\n   \r\n   - the array is 0 sized\r\n   - the array is only made of nulls\r\n   \n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2018-11-06T12:07:43.011+0000",
                    "updated": "2018-11-06T12:07:43.011+0000",
                    "started": "2018-11-06T12:07:43.010+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "163017",
                    "issueId": "13196027"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13196027/worklog/163039",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "romainfrancois commented on issue #2910: ARROW-3693: [R] Invalid buffer for empty characters with null data\nURL: https://github.com/apache/arrow/pull/2910#issuecomment-436242481\n \n \n   The error is unrelated\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2018-11-06T12:54:28.213+0000",
                    "updated": "2018-11-06T12:54:28.213+0000",
                    "started": "2018-11-06T12:54:28.212+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "163039",
                    "issueId": "13196027"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13196027/worklog/163201",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "javierluraschi commented on a change in pull request #2910: ARROW-3693: [R] Invalid buffer for empty characters with null data\nURL: https://github.com/apache/arrow/pull/2910#discussion_r231299023\n \n \n\n ##########\n File path: r/src/arrow_types.h\n ##########\n @@ -32,6 +32,11 @@\n     if (!s.ok()) Rcpp::stop(s.ToString()); \\\n   } while (0);\n \n+#define R_ERROR_IF_NULL(buf)              \\\n+  do {                                    \\\n+    if (!buf) Rcpp::stop(\"invalid data\"); \\\n+  } while (0);\n \n Review comment:\n   We might want to remove the `;` to enforce the `;` gets added in each line that uses `R_ERROR_IF_NULL`. However, my preference would be to not use macros and define functions instead.\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2018-11-06T21:26:50.073+0000",
                    "updated": "2018-11-06T21:26:50.073+0000",
                    "started": "2018-11-06T21:26:50.072+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "163201",
                    "issueId": "13196027"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13196027/worklog/163390",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "romainfrancois commented on a change in pull request #2910: ARROW-3693: [R] Invalid buffer for empty characters with null data\nURL: https://github.com/apache/arrow/pull/2910#discussion_r231436930\n \n \n\n ##########\n File path: r/src/arrow_types.h\n ##########\n @@ -32,6 +32,11 @@\n     if (!s.ok()) Rcpp::stop(s.ToString()); \\\n   } while (0);\n \n+#define R_ERROR_IF_NULL(buf)              \\\n+  do {                                    \\\n+    if (!buf) Rcpp::stop(\"invalid data\"); \\\n+  } while (0);\n \n Review comment:\n   This was macros initially as a sibling to the `RETURN_NOT_OK`, which has to be a macro to maintain the core arrow code succinct. \r\n   \r\n   However, you're right, `R_ERROR_NOT_OK` and `R_ERROR_IF_NULL` can be functions. \n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2018-11-07T09:41:25.098+0000",
                    "updated": "2018-11-07T09:41:25.098+0000",
                    "started": "2018-11-07T09:41:25.097+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "163390",
                    "issueId": "13196027"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13196027/worklog/163668",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "wesm commented on a change in pull request #2910: ARROW-3693: [R] Invalid buffer for empty characters with null data\nURL: https://github.com/apache/arrow/pull/2910#discussion_r231686150\n \n \n\n ##########\n File path: r/src/arrow_types.h\n ##########\n @@ -32,6 +32,11 @@\n     if (!s.ok()) Rcpp::stop(s.ToString()); \\\n   } while (0);\n \n+#define R_ERROR_IF_NULL(buf)              \\\n+  do {                                    \\\n+    if (!buf) Rcpp::stop(\"invalid data\"); \\\n+  } while (0);\n \n Review comment:\n   I would use here the function-like macro pattern with do...while(0) (with the semicolon omitted)\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2018-11-07T21:38:03.544+0000",
                    "updated": "2018-11-07T21:38:03.544+0000",
                    "started": "2018-11-07T21:38:03.544+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "163668",
                    "issueId": "13196027"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13196027/worklog/163888",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "romainfrancois commented on a change in pull request #2910: ARROW-3693: [R] Invalid buffer for empty characters with null data\nURL: https://github.com/apache/arrow/pull/2910#discussion_r231868459\n \n \n\n ##########\n File path: r/src/arrow_types.h\n ##########\n @@ -32,6 +32,11 @@\n     if (!s.ok()) Rcpp::stop(s.ToString()); \\\n   } while (0);\n \n+#define R_ERROR_IF_NULL(buf)              \\\n+  do {                                    \\\n+    if (!buf) Rcpp::stop(\"invalid data\"); \\\n+  } while (0);\n \n Review comment:\n   I remove the trailing `;` in both, and renamed them `STOP_IF_NOT_OK` and `STOP_IF_NULL`. \r\n   \r\n   Unless objections, this is ready to go. \n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2018-11-08T12:28:00.503+0000",
                    "updated": "2018-11-08T12:28:00.503+0000",
                    "started": "2018-11-08T12:28:00.502+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "163888",
                    "issueId": "13196027"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13196027/worklog/163889",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "romainfrancois commented on issue #2910: ARROW-3693: [R] Invalid buffer for empty characters with null data\nURL: https://github.com/apache/arrow/pull/2910#issuecomment-436978073\n \n \n   closes #2896\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2018-11-08T12:29:27.731+0000",
                    "updated": "2018-11-08T12:29:27.731+0000",
                    "started": "2018-11-08T12:29:27.730+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "163889",
                    "issueId": "13196027"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13196027/worklog/164122",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "wesm commented on a change in pull request #2910: ARROW-3693: [R] Invalid buffer for empty characters with null data\nURL: https://github.com/apache/arrow/pull/2910#discussion_r232089101\n \n \n\n ##########\n File path: r/src/array.cpp\n ##########\n @@ -516,6 +520,7 @@ inline SEXP simple_Array_to_Vector(const std::shared_ptr<arrow::Array>& array) {\n \n   // first copy all the data\n   auto p_values = GetValuesSafely<value_type>(array->data(), 1, array->offset());\n+  STOP_IF_NULL(p_values);\n \n Review comment:\n   We could add an option to `GetValuesSafely` to abort if the pointer is null, would save some code duplication in this file\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2018-11-08T22:50:14.535+0000",
                    "updated": "2018-11-08T22:50:14.535+0000",
                    "started": "2018-11-08T22:50:14.534+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "164122",
                    "issueId": "13196027"
                }
            ]
        },
        "customfield_12313920": null,
        "issuetype": {
            "self": "https://issues.apache.org/jira/rest/api/2/issuetype/4",
            "id": "4",
            "description": "An improvement or enhancement to an existing feature or task.",
            "iconUrl": "https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21140&avatarType=issuetype",
            "name": "Improvement",
            "subtask": false,
            "avatarId": 21140
        },
        "timespent": 16200,
        "customfield_12314020": "{summaryBean=com.atlassian.jira.plugin.devstatus.rest.SummaryBean@6bc4b8ec[summary={pullrequest=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@70b262bb[overall=PullRequestOverallBean{stateCount=0, state='OPEN', details=PullRequestOverallDetails{openCount=0, mergedCount=0, declinedCount=0}},byInstanceType={}], build=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@52f7cd75[overall=com.atlassian.jira.plugin.devstatus.summary.beans.BuildOverallBean@3133da2a[failedBuildCount=0,successfulBuildCount=0,unknownBuildCount=0,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], review=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@3848267d[overall=com.atlassian.jira.plugin.devstatus.summary.beans.ReviewsOverallBean@74908007[stateCount=0,state=<null>,dueDate=<null>,overDue=false,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], deployment-environment=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@18e07785[overall=com.atlassian.jira.plugin.devstatus.summary.beans.DeploymentOverallBean@37ad0c39[topEnvironments=[],showProjects=false,successfulCount=0,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], repository=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@4e2fbf7f[overall=com.atlassian.jira.plugin.devstatus.summary.beans.CommitOverallBean@3e4f8e05[count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], branch=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@25888a16[overall=com.atlassian.jira.plugin.devstatus.summary.beans.BranchOverallBean@7a1b965a[count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}]},errors=[],configErrors=[]], devSummaryJson={\"cachedValue\":{\"errors\":[],\"configErrors\":[],\"summary\":{\"pullrequest\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"stateCount\":0,\"state\":\"OPEN\",\"details\":{\"openCount\":0,\"mergedCount\":0,\"declinedCount\":0,\"total\":0},\"open\":true},\"byInstanceType\":{}},\"build\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"failedBuildCount\":0,\"successfulBuildCount\":0,\"unknownBuildCount\":0},\"byInstanceType\":{}},\"review\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"stateCount\":0,\"state\":null,\"dueDate\":null,\"overDue\":false,\"completed\":false},\"byInstanceType\":{}},\"deployment-environment\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"topEnvironments\":[],\"showProjects\":false,\"successfulCount\":0},\"byInstanceType\":{}},\"repository\":{\"overall\":{\"count\":0,\"lastUpdated\":null},\"byInstanceType\":{}},\"branch\":{\"overall\":{\"count\":0,\"lastUpdated\":null},\"byInstanceType\":{}}}},\"isStale\":false}}",
        "customfield_12314141": null,
        "customfield_12314140": null,
        "project": {
            "self": "https://issues.apache.org/jira/rest/api/2/project/12319525",
            "id": "12319525",
            "key": "ARROW",
            "name": "Apache Arrow",
            "projectTypeKey": "software",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/projectavatar?pid=12319525&avatarId=10011",
                "24x24": "https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12319525&avatarId=10011",
                "16x16": "https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12319525&avatarId=10011",
                "32x32": "https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12319525&avatarId=10011"
            },
            "projectCategory": {
                "self": "https://issues.apache.org/jira/rest/api/2/projectCategory/13960",
                "id": "13960",
                "description": "Apache Arrow",
                "name": "Arrow"
            }
        },
        "aggregatetimespent": 16200,
        "customfield_12312520": null,
        "customfield_12312521": "Thu Nov 08 22:50:36 UTC 2018",
        "customfield_12314422": null,
        "customfield_12314421": null,
        "customfield_12314146": null,
        "customfield_12314420": null,
        "customfield_12314145": null,
        "customfield_12314144": null,
        "customfield_12314143": null,
        "resolutiondate": "2018-11-08T22:50:36.000+0000",
        "workratio": -1,
        "customfield_12312923": null,
        "customfield_12312920": null,
        "customfield_12312921": null,
        "watches": {
            "self": "https://issues.apache.org/jira/rest/api/2/issue/ARROW-3693/watchers",
            "watchCount": 1,
            "isWatching": false
        },
        "created": "2018-11-03T05:34:57.000+0000",
        "updated": "2020-02-04T14:19:06.000+0000",
        "timeoriginalestimate": null,
        "description": "I'm hitting this from data coming from Spark while retrieving this data frame:\r\n\r\n\u00a0\r\n\r\n\u00a0\r\n{code:java}\r\n<database>\u00a0 \u00a0<name>\u00a0 \u00a0 <temp>\r\ndefault\u00a0 \u00a0 \u00a0 a\u00a0 \u00a0 \u00a0 \u00a0 \u00a0TRUE\r\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0b         TRUE\r\n{code}\r\n\u00a0\r\n\r\nError:\r\n{code:java}\r\nerror: Failed to fetch data: invalid data in buffer 2\r\n{code}\r\nThe problem is that is possible to have a NULL character array with offsets set to 0, notice that in the example above Spark returns two batches, so effectively, we are trying to parse:\r\n\r\n\u00a0\r\n{code:java}\r\n<database>\u00a0 \u00a0<name>\u00a0 \u00a0 <temp>\r\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0b         TRUE\r\n{code}\r\n\u00a0\r\n\r\nWhere the data array is NULL and the offsets 0s for the <database> columns.\r\n\r\nHere is a snapshot\u00a0while debugging StringArray_to_Vector:\r\n\r\n!Screen Shot 2018-11-02 at 10.27.11 PM.png!",
        "customfield_10010": null,
        "timetracking": {
            "remainingEstimate": "0h",
            "timeSpent": "4.5h",
            "remainingEstimateSeconds": 0,
            "timeSpentSeconds": 16200
        },
        "customfield_12314523": null,
        "customfield_12314127": null,
        "customfield_12314522": null,
        "customfield_12314126": null,
        "customfield_12314521": null,
        "customfield_12314125": null,
        "customfield_12314520": null,
        "customfield_12314124": null,
        "attachment": [
            {
                "self": "https://issues.apache.org/jira/rest/api/2/attachment/12946775",
                "id": "12946775",
                "filename": "Screen Shot 2018-11-02 at 10.27.11 PM.png",
                "author": {
                    "self": "https://issues.apache.org/jira/rest/api/2/user?username=javierluraschi",
                    "name": "javierluraschi",
                    "key": "javierluraschi",
                    "avatarUrls": {
                        "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                        "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                        "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                        "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                    },
                    "displayName": "Javier Luraschi",
                    "active": true,
                    "timeZone": "Etc/UTC"
                },
                "created": "2018-11-03T05:32:23.669+0000",
                "size": 226790,
                "mimeType": "image/png",
                "content": "https://issues.apache.org/jira/secure/attachment/12946775/Screen+Shot+2018-11-02+at+10.27.11+PM.png"
            }
        ],
        "customfield_12312340": null,
        "customfield_12314123": null,
        "customfield_12312341": null,
        "customfield_12312220": null,
        "customfield_12314122": null,
        "customfield_12314121": null,
        "customfield_12314120": null,
        "customfield_12314129": null,
        "customfield_12314524": null,
        "customfield_12314128": null,
        "summary": "[R] Invalid buffer for empty characters with null data",
        "customfield_12314130": null,
        "customfield_12310291": null,
        "customfield_12310290": null,
        "customfield_12314138": null,
        "customfield_12314137": null,
        "environment": null,
        "customfield_12314136": null,
        "customfield_12314135": null,
        "customfield_12311020": null,
        "customfield_12314134": null,
        "duedate": null,
        "customfield_12314132": null,
        "customfield_12314131": null,
        "comment": {
            "comments": [
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13196027/comment/16680535",
                    "id": "16680535",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=wesm",
                        "name": "wesm",
                        "key": "wesmckinn",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=wesmckinn&avatarId=29931",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=wesmckinn&avatarId=29931",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=wesmckinn&avatarId=29931",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=wesmckinn&avatarId=29931"
                        },
                        "displayName": "Wes McKinney",
                        "active": true,
                        "timeZone": "America/New_York"
                    },
                    "body": "Issue resolved by pull request 2910\n[https://github.com/apache/arrow/pull/2910]",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=wesm",
                        "name": "wesm",
                        "key": "wesmckinn",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=wesmckinn&avatarId=29931",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=wesmckinn&avatarId=29931",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=wesmckinn&avatarId=29931",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=wesmckinn&avatarId=29931"
                        },
                        "displayName": "Wes McKinney",
                        "active": true,
                        "timeZone": "America/New_York"
                    },
                    "created": "2018-11-08T22:50:36.067+0000",
                    "updated": "2018-11-08T22:50:36.067+0000"
                }
            ],
            "maxResults": 1,
            "total": 1,
            "startAt": 0
        },
        "customfield_12311820": "0|s0036o:",
        "customfield_12314139": null
    }
}