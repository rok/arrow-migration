{
    "expand": "operations,versionedRepresentations,editmeta,changelog,renderedFields",
    "id": "13391901",
    "self": "https://issues.apache.org/jira/rest/api/2/issue/13391901",
    "key": "ARROW-13448",
    "fields": {
        "fixVersions": [
            {
                "self": "https://issues.apache.org/jira/rest/api/2/version/12350323",
                "id": "12350323",
                "description": "",
                "name": "6.0.0",
                "archived": false,
                "released": true,
                "releaseDate": "2021-10-26"
            }
        ],
        "resolution": {
            "self": "https://issues.apache.org/jira/rest/api/2/resolution/1",
            "id": "1",
            "description": "A fix for this issue is checked into the tree and tested.",
            "name": "Fixed"
        },
        "customfield_12312322": null,
        "customfield_12312323": null,
        "customfield_12312320": null,
        "customfield_12310420": "9223372036854775807",
        "customfield_12312321": null,
        "customfield_12312328": null,
        "customfield_12312329": null,
        "customfield_12312326": null,
        "customfield_12310300": null,
        "customfield_12312327": null,
        "customfield_12312324": null,
        "customfield_12312720": null,
        "customfield_12312325": null,
        "lastViewed": null,
        "priority": {
            "self": "https://issues.apache.org/jira/rest/api/2/priority/3",
            "iconUrl": "https://issues.apache.org/jira/images/icons/priorities/major.svg",
            "name": "Major",
            "id": "3"
        },
        "labels": [
            "pull-request-available"
        ],
        "customfield_12312333": null,
        "customfield_12312334": null,
        "customfield_12313422": "false",
        "customfield_12310310": "0.0",
        "customfield_12312331": null,
        "customfield_12312332": null,
        "aggregatetimeoriginalestimate": null,
        "timeestimate": 0,
        "customfield_12312330": null,
        "versions": [],
        "customfield_12311120": null,
        "customfield_12313826": null,
        "customfield_12312339": null,
        "issuelinks": [
            {
                "id": "12622488",
                "self": "https://issues.apache.org/jira/rest/api/2/issueLink/12622488",
                "type": {
                    "id": "12310000",
                    "name": "Duplicate",
                    "inward": "is duplicated by",
                    "outward": "duplicates",
                    "self": "https://issues.apache.org/jira/rest/api/2/issueLinkType/12310000"
                },
                "inwardIssue": {
                    "id": "13395938",
                    "key": "ARROW-13666",
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13395938",
                    "fields": {
                        "summary": "[R] strftime bindings",
                        "status": {
                            "self": "https://issues.apache.org/jira/rest/api/2/status/6",
                            "description": "The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.",
                            "iconUrl": "https://issues.apache.org/jira/images/icons/statuses/closed.png",
                            "name": "Closed",
                            "id": "6",
                            "statusCategory": {
                                "self": "https://issues.apache.org/jira/rest/api/2/statuscategory/3",
                                "id": 3,
                                "key": "done",
                                "colorName": "green",
                                "name": "Done"
                            }
                        },
                        "priority": {
                            "self": "https://issues.apache.org/jira/rest/api/2/priority/3",
                            "iconUrl": "https://issues.apache.org/jira/images/icons/priorities/major.svg",
                            "name": "Major",
                            "id": "3"
                        },
                        "issuetype": {
                            "self": "https://issues.apache.org/jira/rest/api/2/issuetype/4",
                            "id": "4",
                            "description": "An improvement or enhancement to an existing feature or task.",
                            "iconUrl": "https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21140&avatarType=issuetype",
                            "name": "Improvement",
                            "subtask": false,
                            "avatarId": 21140
                        }
                    }
                }
            }
        ],
        "customfield_12313825": null,
        "assignee": {
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=rokm",
            "name": "rokm",
            "key": "rokm",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=34044",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34044",
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34044",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34044"
            },
            "displayName": "Rok Mihevc",
            "active": true,
            "timeZone": "Europe/Amsterdam"
        },
        "customfield_12312337": null,
        "customfield_12313823": null,
        "customfield_12312338": null,
        "customfield_12311920": null,
        "customfield_12313822": null,
        "customfield_12312335": null,
        "customfield_12313821": null,
        "customfield_12312336": null,
        "customfield_12313820": null,
        "status": {
            "self": "https://issues.apache.org/jira/rest/api/2/status/5",
            "description": "A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.",
            "iconUrl": "https://issues.apache.org/jira/images/icons/statuses/resolved.png",
            "name": "Resolved",
            "id": "5",
            "statusCategory": {
                "self": "https://issues.apache.org/jira/rest/api/2/statuscategory/3",
                "id": 3,
                "key": "done",
                "colorName": "green",
                "name": "Done"
            }
        },
        "components": [
            {
                "self": "https://issues.apache.org/jira/rest/api/2/component/12333008",
                "id": "12333008",
                "name": "R"
            }
        ],
        "customfield_12312026": null,
        "customfield_12312023": null,
        "customfield_12312024": null,
        "aggregatetimeestimate": 0,
        "customfield_12312022": null,
        "customfield_12310921": null,
        "customfield_12310920": "9223372036854775807",
        "customfield_12312823": null,
        "creator": {
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=npr",
            "name": "npr",
            "key": "npr",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=34045",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34045",
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34045",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34045"
            },
            "displayName": "Neal Richardson",
            "active": true,
            "timeZone": "America/Los_Angeles"
        },
        "subtasks": [],
        "reporter": {
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=npr",
            "name": "npr",
            "key": "npr",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=34045",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34045",
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34045",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34045"
            },
            "displayName": "Neal Richardson",
            "active": true,
            "timeZone": "America/Los_Angeles"
        },
        "aggregateprogress": {
            "progress": 33600,
            "total": 33600,
            "percent": 100
        },
        "customfield_12313520": null,
        "customfield_12310250": null,
        "progress": {
            "progress": 33600,
            "total": 33600,
            "percent": 100
        },
        "customfield_12313924": null,
        "votes": {
            "self": "https://issues.apache.org/jira/rest/api/2/issue/ARROW-13448/votes",
            "votes": 0,
            "hasVoted": false
        },
        "worklog": {
            "startAt": 0,
            "maxResults": 20,
            "total": 56,
            "worklogs": [
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13391901/worklog/647556",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "rok opened a new pull request #11105:\nURL: https://github.com/apache/arrow/pull/11105\n\n\n   This is to resolve [ARROW-13448](https://issues.apache.org/jira/browse/ARROW-13448).\n\n\n-- \nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nTo unsubscribe, e-mail: github-unsubscribe@arrow.apache.org\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2021-09-07T20:13:59.663+0000",
                    "updated": "2021-09-07T20:13:59.663+0000",
                    "started": "2021-09-07T20:13:59.663+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "647556",
                    "issueId": "13391901"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13391901/worklog/647557",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "github-actions[bot] commented on pull request #11105:\nURL: https://github.com/apache/arrow/pull/11105#issuecomment-914593596\n\n\n\n\n\n\n-- \nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nTo unsubscribe, e-mail: github-unsubscribe@arrow.apache.org\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2021-09-07T20:14:15.565+0000",
                    "updated": "2021-09-07T20:14:15.565+0000",
                    "started": "2021-09-07T20:14:15.565+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "647557",
                    "issueId": "13391901"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13391901/worklog/651906",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "thisisnic commented on a change in pull request #11105:\nURL: https://github.com/apache/arrow/pull/11105#discussion_r710319132\n\n\n\n##########\nFile path: r/tests/testthat/test-dplyr-string-functions.R\n##########\n@@ -719,6 +719,55 @@ test_that(\"errors in strptime\", {\n   )\n })\n \n+test_that(\"strftime\", {\n+  # TODO: consider reevaluating this workaround after ARROW-12980\n+  withr::local_timezone(\"UTC\")\n+  t_stamp <- tibble(x = c(lubridate::ymd_hms(\"2018-10-07 19:04:05\"), NA))\n+  t_string <- tibble(x = c(\"2018-10-07 19:04:05.000000\", NA))\n+  t_string_2 <- tibble(x = c(\"07 October 2018 19:04:05.000000 UTC\", NA))\n+\n+  # TODO: remove once we have tz support on windows ARROW-13168\n+  if (tolower(Sys.info()[[\"sysname\"]]) != \"windows\") {\n+    expect_equal(\n\nReview comment:\n       We've got a custom function `expect_dplyr_equal()`, which we tend to use with a lot of these functions - they make it easier to ensure that the behaviour of the implemented Arrow function matches that of the equivalent base R or tidyverse function.  Would you mind updating these tests to use that helper function?\n\n##########\nFile path: r/src/compute.cpp\n##########\n@@ -325,6 +325,19 @@ std::shared_ptr<arrow::compute::FunctionOptions> make_compute_options(\n         cpp11::as_cpp<arrow::TimeUnit::type>(options[\"unit\"]));\n   }\n \n+  if (func_name == \"strftime\") {\n+    using Options = arrow::compute::StrftimeOptions;\n+    std::string format = \"%Y-%m-%dT%H:%M:%S\";\n\nReview comment:\n       As there are no default values for `format` in the C++ code, you probably don't want to set this here - the R code should either supply a value for `format` or this should fail.  See the way that the options are implemented for the `extract_regex` kernel (in this file) as an example of this.\n\n##########\nFile path: r/R/dplyr-functions.R\n##########\n@@ -672,6 +672,10 @@ nse_funcs$strptime <- function(x, format = \"%Y-%m-%d %H:%M:%S\", tz = NULL, unit\n   Expression$create(\"strptime\", x, options = list(format = format, unit = unit))\n }\n \n+nse_funcs$strftime <- function(x, format = \"%Y-%m-%d %H:%M:%S\", locale=\"C\") {\n\nReview comment:\n       In the R bindings for these functions, the arguments and values should match the base R or tidyverse function that is being implemented.  This doesn't quite match - here are the docs for base R's `strftime()`: https://stat.ethz.ch/R-manual/R-devel/library/base/html/strptime.html\n\n##########\nFile path: r/tests/testthat/test-dplyr-string-functions.R\n##########\n@@ -719,6 +719,55 @@ test_that(\"errors in strptime\", {\n   )\n })\n \n+test_that(\"strftime\", {\n+  # TODO: consider reevaluating this workaround after ARROW-12980\n+  withr::local_timezone(\"UTC\")\n+  t_stamp <- tibble(x = c(lubridate::ymd_hms(\"2018-10-07 19:04:05\"), NA))\n+  t_string <- tibble(x = c(\"2018-10-07 19:04:05.000000\", NA))\n+  t_string_2 <- tibble(x = c(\"07 October 2018 19:04:05.000000 UTC\", NA))\n+\n+  # TODO: remove once we have tz support on windows ARROW-13168\n+  if (tolower(Sys.info()[[\"sysname\"]]) != \"windows\") {\n+    expect_equal(\n+      t_stamp %>%\n+        Table$create() %>%\n+        mutate(\n+          x = strftime(x)\n+        ) %>%\n+        collect(),\n+      t_string\n+    )\n+\n+    expect_equal(\n+      t_stamp %>%\n+        Table$create() %>%\n+        mutate(\n+          x = strftime(x, format = \"%Y-%m-%d %H:%M:%S\")\n+        ) %>%\n+        collect(),\n+      t_string\n+    )\n+\n+    expect_equal(\n+      t_stamp %>%\n+        Table$create() %>%\n+        mutate(\n+          x = strftime(x, format = \"%d %B %Y %H:%M:%S %Z\", locale = \"C\")\n+        ) %>%\n+        collect(),\n+      t_string_2\n+    )\n+  } else {\n+    expect_error(\n+      t_stamp %>%\n+        Table$create() %>%\n+        mutate(x = strftime(x)) %>%\n+        collect(),\n+      \"Strftime not yet implemented on windows.\"\n+    )\n+  }\n\nReview comment:\n       Please can you refactor this block to, instead of using a conditional, use the `skip()` function.  There should be some examples in other test files you can follow, but let me know if it's not clear :)\n\n\n\n\n-- \nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nTo unsubscribe, e-mail: github-unsubscribe@arrow.apache.org\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2021-09-16T17:29:51.884+0000",
                    "updated": "2021-09-16T17:29:51.884+0000",
                    "started": "2021-09-16T17:29:51.884+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "651906",
                    "issueId": "13391901"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13391901/worklog/651961",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "rok commented on pull request #11105:\nURL: https://github.com/apache/arrow/pull/11105#issuecomment-921177398\n\n\n   Thanks for the review @thisisnic!\n\n\n-- \nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nTo unsubscribe, e-mail: github-unsubscribe@arrow.apache.org\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2021-09-16T19:15:51.609+0000",
                    "updated": "2021-09-16T19:15:51.609+0000",
                    "started": "2021-09-16T19:15:51.609+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "651961",
                    "issueId": "13391901"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13391901/worklog/651962",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "rok commented on a change in pull request #11105:\nURL: https://github.com/apache/arrow/pull/11105#discussion_r710408421\n\n\n\n##########\nFile path: r/R/dplyr-functions.R\n##########\n@@ -672,6 +672,10 @@ nse_funcs$strptime <- function(x, format = \"%Y-%m-%d %H:%M:%S\", tz = NULL, unit\n   Expression$create(\"strptime\", x, options = list(format = format, unit = unit))\n }\n \n+nse_funcs$strftime <- function(x, format = \"%Y-%m-%d %H:%M:%S\", locale=\"C\") {\n\nReview comment:\n       Done, please check if I got it right. Note that `strftime` kernel doesn't support `tz` parameter at the moment.\n\n\n\n\n-- \nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nTo unsubscribe, e-mail: github-unsubscribe@arrow.apache.org\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2021-09-16T19:17:06.383+0000",
                    "updated": "2021-09-16T19:17:06.383+0000",
                    "started": "2021-09-16T19:17:06.382+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "651962",
                    "issueId": "13391901"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13391901/worklog/651963",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "rok commented on a change in pull request #11105:\nURL: https://github.com/apache/arrow/pull/11105#discussion_r710408833\n\n\n\n##########\nFile path: r/tests/testthat/test-dplyr-string-functions.R\n##########\n@@ -719,6 +719,55 @@ test_that(\"errors in strptime\", {\n   )\n })\n \n+test_that(\"strftime\", {\n+  # TODO: consider reevaluating this workaround after ARROW-12980\n+  withr::local_timezone(\"UTC\")\n+  t_stamp <- tibble(x = c(lubridate::ymd_hms(\"2018-10-07 19:04:05\"), NA))\n+  t_string <- tibble(x = c(\"2018-10-07 19:04:05.000000\", NA))\n+  t_string_2 <- tibble(x = c(\"07 October 2018 19:04:05.000000 UTC\", NA))\n+\n+  # TODO: remove once we have tz support on windows ARROW-13168\n+  if (tolower(Sys.info()[[\"sysname\"]]) != \"windows\") {\n+    expect_equal(\n\nReview comment:\n       Good point! switched to `skip_on_os(\"windows\")`.\n\n\n\n\n-- \nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nTo unsubscribe, e-mail: github-unsubscribe@arrow.apache.org\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2021-09-16T19:17:49.792+0000",
                    "updated": "2021-09-16T19:17:49.792+0000",
                    "started": "2021-09-16T19:17:49.792+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "651963",
                    "issueId": "13391901"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13391901/worklog/651964",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "rok commented on a change in pull request #11105:\nURL: https://github.com/apache/arrow/pull/11105#discussion_r710408833\n\n\n\n##########\nFile path: r/tests/testthat/test-dplyr-string-functions.R\n##########\n@@ -719,6 +719,55 @@ test_that(\"errors in strptime\", {\n   )\n })\n \n+test_that(\"strftime\", {\n+  # TODO: consider reevaluating this workaround after ARROW-12980\n+  withr::local_timezone(\"UTC\")\n+  t_stamp <- tibble(x = c(lubridate::ymd_hms(\"2018-10-07 19:04:05\"), NA))\n+  t_string <- tibble(x = c(\"2018-10-07 19:04:05.000000\", NA))\n+  t_string_2 <- tibble(x = c(\"07 October 2018 19:04:05.000000 UTC\", NA))\n+\n+  # TODO: remove once we have tz support on windows ARROW-13168\n+  if (tolower(Sys.info()[[\"sysname\"]]) != \"windows\") {\n+    expect_equal(\n\nReview comment:\n       Good point! switched to `expect_dplyr_equal`.\n\n\n\n\n-- \nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nTo unsubscribe, e-mail: github-unsubscribe@arrow.apache.org\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2021-09-16T19:18:45.187+0000",
                    "updated": "2021-09-16T19:18:45.187+0000",
                    "started": "2021-09-16T19:18:45.187+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "651964",
                    "issueId": "13391901"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13391901/worklog/651965",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "rok commented on a change in pull request #11105:\nURL: https://github.com/apache/arrow/pull/11105#discussion_r710409644\n\n\n\n##########\nFile path: r/tests/testthat/test-dplyr-string-functions.R\n##########\n@@ -719,6 +719,55 @@ test_that(\"errors in strptime\", {\n   )\n })\n \n+test_that(\"strftime\", {\n+  # TODO: consider reevaluating this workaround after ARROW-12980\n+  withr::local_timezone(\"UTC\")\n+  t_stamp <- tibble(x = c(lubridate::ymd_hms(\"2018-10-07 19:04:05\"), NA))\n+  t_string <- tibble(x = c(\"2018-10-07 19:04:05.000000\", NA))\n+  t_string_2 <- tibble(x = c(\"07 October 2018 19:04:05.000000 UTC\", NA))\n+\n+  # TODO: remove once we have tz support on windows ARROW-13168\n+  if (tolower(Sys.info()[[\"sysname\"]]) != \"windows\") {\n+    expect_equal(\n+      t_stamp %>%\n+        Table$create() %>%\n+        mutate(\n+          x = strftime(x)\n+        ) %>%\n+        collect(),\n+      t_string\n+    )\n+\n+    expect_equal(\n+      t_stamp %>%\n+        Table$create() %>%\n+        mutate(\n+          x = strftime(x, format = \"%Y-%m-%d %H:%M:%S\")\n+        ) %>%\n+        collect(),\n+      t_string\n+    )\n+\n+    expect_equal(\n+      t_stamp %>%\n+        Table$create() %>%\n+        mutate(\n+          x = strftime(x, format = \"%d %B %Y %H:%M:%S %Z\", locale = \"C\")\n+        ) %>%\n+        collect(),\n+      t_string_2\n+    )\n+  } else {\n+    expect_error(\n+      t_stamp %>%\n+        Table$create() %>%\n+        mutate(x = strftime(x)) %>%\n+        collect(),\n+      \"Strftime not yet implemented on windows.\"\n+    )\n+  }\n\nReview comment:\n       Switched to `skip_on_os(\"windows\")`.\n\n\n\n\n-- \nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nTo unsubscribe, e-mail: github-unsubscribe@arrow.apache.org\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2021-09-16T19:19:08.490+0000",
                    "updated": "2021-09-16T19:19:08.490+0000",
                    "started": "2021-09-16T19:19:08.490+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "651965",
                    "issueId": "13391901"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13391901/worklog/651966",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "rok commented on a change in pull request #11105:\nURL: https://github.com/apache/arrow/pull/11105#discussion_r710409833\n\n\n\n##########\nFile path: r/src/compute.cpp\n##########\n@@ -325,6 +325,19 @@ std::shared_ptr<arrow::compute::FunctionOptions> make_compute_options(\n         cpp11::as_cpp<arrow::TimeUnit::type>(options[\"unit\"]));\n   }\n \n+  if (func_name == \"strftime\") {\n+    using Options = arrow::compute::StrftimeOptions;\n+    std::string format = \"%Y-%m-%dT%H:%M:%S\";\n\nReview comment:\n       Done, please see if it makes sense now.\n\n\n\n\n-- \nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nTo unsubscribe, e-mail: github-unsubscribe@arrow.apache.org\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2021-09-16T19:19:31.837+0000",
                    "updated": "2021-09-16T19:19:31.837+0000",
                    "started": "2021-09-16T19:19:31.837+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "651966",
                    "issueId": "13391901"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13391901/worklog/651969",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "rok commented on pull request #11105:\nURL: https://github.com/apache/arrow/pull/11105#issuecomment-921185627\n\n\n   Another thing to note here is that behavior of the `%S` flag is different in arrow:\r\n   \r\n   > Output precision of %S (seconds) flag depends on the input timestamp precision. Timestamps with second precision are represented as integers while milliseconds, microsecond and nanoseconds are represented as fixed floating point numbers with 3, 6 and 9 decimal places respectively. To obtain integer seconds, cast to timestamp with second resolution. The character for the decimal point is localized according to the locale. See detailed formatting documentation for descriptions of other flags.\r\n   \r\n   This is already tested in c++ and we test it in Python [like so](https://github.com/apache/arrow/blob/376cb450392fcfc2c4e3c5487358f4906c3383da/python/pyarrow/tests/test_compute.py#L1589). I'm not sure there's a point in testing it in R but it could look like this:\r\n   ```R\r\n     arr <- Array$create(c(lubridate::ymd_hms(\"2018-10-07 19:04:05\"), NA), type = timestamp(\"s\"))\r\n     expect_dplyr_equal(\r\n       input %>%\r\n         mutate(x = strftime(x, format = \"%S\")) %>%\r\n         collect(),\r\n       arr\r\n     )\r\n   ```\r\n   Except this wouldn't work for type reasons:\r\n   ```R\r\n   Error (test-dplyr-string-functions.R:756:3): strftime\r\n   Error: no applicable method for 'mutate' applied to an object of class \"c('Array', 'ArrowDatum', 'ArrowObject', 'R6')\"\r\n   ```\n\n\n-- \nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nTo unsubscribe, e-mail: github-unsubscribe@arrow.apache.org\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2021-09-16T19:28:57.285+0000",
                    "updated": "2021-09-16T19:28:57.285+0000",
                    "started": "2021-09-16T19:28:57.285+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "651969",
                    "issueId": "13391901"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13391901/worklog/652008",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "thisisnic commented on a change in pull request #11105:\nURL: https://github.com/apache/arrow/pull/11105#discussion_r710505110\n\n\n\n##########\nFile path: r/src/compute.cpp\n##########\n@@ -332,6 +332,13 @@ std::shared_ptr<arrow::compute::FunctionOptions> make_compute_options(\n         cpp11::as_cpp<arrow::TimeUnit::type>(options[\"unit\"]));\n   }\n \n+  if (func_name == \"strftime\") {\n+    using Options = arrow::compute::StrftimeOptions;\n+    return std::make_shared<Options>(\n+        Options(cpp11::as_cpp<std::string>(options[\"format\"]),\n+                cpp11::as_cpp<std::string>(options[\"locale\"])));\n+  }\n\nReview comment:\n       This bit LGTM now!\n\n##########\nFile path: r/tests/testthat/test-dplyr-string-functions.R\n##########\n@@ -719,6 +719,40 @@ test_that(\"errors in strptime\", {\n   )\n })\n \n+test_that(\"strftime\", {\n+  skip_on_os(\"windows\") # https://issues.apache.org/jira/browse/ARROW-13168\n+\n+  # TODO: consider reevaluating this workaround after ARROW-12980\n+  withr::local_timezone(\"UTC\")\n+  times <- tibble(x = c(lubridate::ymd_hms(\"2018-10-07 19:04:05\"), NA))\n+\n+  formats = c(\"%a\", \"%A\", \"%w\", \"%d\", \"%b\", \"%B\", \"%m\", \"%y\", \"%Y\", \"%H\",\n+             \"%I\", \"%p\", \"%M\", \"%z\", \"%Z\", \"%j\", \"%U\", \"%W\", \"%c\", \"%x\",\n+             \"%X\", \"%%\", \"%G\", \"%V\", \"%u\")\n+\n+  for (format in formats) {\n+    expect_dplyr_equal(\n+      input %>%\n+        mutate(x = strftime(x, format = format)) %>%\n+        collect(),\n+      times\n+    )\n+\n+    expect_dplyr_equal(\n+      input %>%\n+        mutate(x = strftime(x, format = format, usetz = TRUE)) %>%\n+        collect(),\n+      times\n+    )\n+\n+    x <- Expression$field_ref(\"x\")\n+    expect_error(\n+      nse_funcs$strftime(x, format = format, tz=\"Mars/Mariner_Valley\"),\n+      \"tz argument not supported by Arrow\"\n+    )\n+  }\n+})\n\nReview comment:\n       This is looking a lot more along the right lines, but I reckon that this could be refactored further to be more efficient, and easier to diagnose what's happening if any of the tests fail.  \r\n   \r\n   Please would you refactor so that you remove the `for` loop, and have `format` as a column in the tibble (you won't need to change the `mutate` statement), so we just run each of those `expect_*` functions once?  \n\n\n\n\n-- \nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nTo unsubscribe, e-mail: github-unsubscribe@arrow.apache.org\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2021-09-16T21:33:45.747+0000",
                    "updated": "2021-09-16T21:33:45.747+0000",
                    "started": "2021-09-16T21:33:45.747+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "652008",
                    "issueId": "13391901"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13391901/worklog/652012",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "thisisnic commented on pull request #11105:\nURL: https://github.com/apache/arrow/pull/11105#issuecomment-921279899\n\n\n   > behavior of the %S flag is different in arrow\r\n   \r\n   So, the R \"%S\" returns an integer, so you're right in highlighting the difference between Arrow and R.  We have other time-related functions which return slightly different values, which we allow for, e.g.\r\n   \r\n   https://github.com/apache/arrow/blob/5260fd5970d34c62e0ae7680f606b29eab56d96b/r/tests/testthat/test-dplyr-lubridate.R#L155-L164\r\n   \r\n   The function `expect_dplyr_equal()`, as you've pointed out, won't work on Array objects.  However, you could write a test like the one shown above, which just adds a tolerance (given that the user is being returned a *more* precise answer than they would have, the tolerance is justified).\r\n   \r\n   \n\n\n-- \nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nTo unsubscribe, e-mail: github-unsubscribe@arrow.apache.org\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2021-09-16T21:51:46.266+0000",
                    "updated": "2021-09-16T21:51:46.266+0000",
                    "started": "2021-09-16T21:51:46.265+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "652012",
                    "issueId": "13391901"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13391901/worklog/652050",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "rok commented on a change in pull request #11105:\nURL: https://github.com/apache/arrow/pull/11105#discussion_r710620172\n\n\n\n##########\nFile path: r/tests/testthat/test-dplyr-string-functions.R\n##########\n@@ -719,6 +719,40 @@ test_that(\"errors in strptime\", {\n   )\n })\n \n+test_that(\"strftime\", {\n+  skip_on_os(\"windows\") # https://issues.apache.org/jira/browse/ARROW-13168\n+\n+  # TODO: consider reevaluating this workaround after ARROW-12980\n+  withr::local_timezone(\"UTC\")\n+  times <- tibble(x = c(lubridate::ymd_hms(\"2018-10-07 19:04:05\"), NA))\n+\n+  formats = c(\"%a\", \"%A\", \"%w\", \"%d\", \"%b\", \"%B\", \"%m\", \"%y\", \"%Y\", \"%H\",\n+             \"%I\", \"%p\", \"%M\", \"%z\", \"%Z\", \"%j\", \"%U\", \"%W\", \"%c\", \"%x\",\n+             \"%X\", \"%%\", \"%G\", \"%V\", \"%u\")\n+\n+  for (format in formats) {\n+    expect_dplyr_equal(\n+      input %>%\n+        mutate(x = strftime(x, format = format)) %>%\n+        collect(),\n+      times\n+    )\n+\n+    expect_dplyr_equal(\n+      input %>%\n+        mutate(x = strftime(x, format = format, usetz = TRUE)) %>%\n+        collect(),\n+      times\n+    )\n+\n+    x <- Expression$field_ref(\"x\")\n+    expect_error(\n+      nse_funcs$strftime(x, format = format, tz=\"Mars/Mariner_Valley\"),\n+      \"tz argument not supported by Arrow\"\n+    )\n+  }\n+})\n\nReview comment:\n       You mean like this?\r\n   ```R\r\n     df <- tibble(\r\n       x = lubridate::ymd_hms(\"2019-02-03 12:34:56\"),\r\n       y = c(\"%a\", \"%A\", \"%w\", \"%d\", \"%b\", \"%B\", \"%m\", \"%y\", \"%Y\", \"%H\",\r\n             \"%I\", \"%p\", \"%M\", \"%z\", \"%Z\", \"%j\", \"%U\", \"%W\", \"%c\", \"%x\",\r\n             \"%X\", \"%%\", \"%G\", \"%V\", \"%u\")\r\n     )\r\n   \r\n     expect_dplyr_equal(\r\n       input %>%\r\n         mutate(x = strftime(x, format = y)) %>%\r\n         collect(),\r\n       df\r\n     )\r\n   ```\r\n   \r\n   It's failing with:\r\n   ```bash\r\n    Failure (test-dplyr-string-functions.R:735:3): strftime\r\n   `via_batch <- rlang::eval_tidy(expr, rlang::new_data_mask(rlang::env(input = record_batch(tbl))))` generated warnings:\r\n   * Expression strftime(x, y) not supported in Arrow; pulling data into R\r\n   Backtrace:\r\n    1. expect_dplyr_equal(...) test-dplyr-string-functions.R:735:2\r\n    2. testthat::expect_warning(...) helper-expectation.R:101:4\r\n   ```\r\n   \r\n   My R is not enough. I'll try again tomorrow.\n\n\n\n\n-- \nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nTo unsubscribe, e-mail: github-unsubscribe@arrow.apache.org\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2021-09-17T00:58:03.432+0000",
                    "updated": "2021-09-17T00:58:03.432+0000",
                    "started": "2021-09-17T00:58:03.432+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "652050",
                    "issueId": "13391901"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13391901/worklog/652164",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "thisisnic commented on a change in pull request #11105:\nURL: https://github.com/apache/arrow/pull/11105#discussion_r710842031\n\n\n\n##########\nFile path: r/tests/testthat/test-dplyr-string-functions.R\n##########\n@@ -719,6 +719,40 @@ test_that(\"errors in strptime\", {\n   )\n })\n \n+test_that(\"strftime\", {\n+  skip_on_os(\"windows\") # https://issues.apache.org/jira/browse/ARROW-13168\n+\n+  # TODO: consider reevaluating this workaround after ARROW-12980\n+  withr::local_timezone(\"UTC\")\n+  times <- tibble(x = c(lubridate::ymd_hms(\"2018-10-07 19:04:05\"), NA))\n+\n+  formats = c(\"%a\", \"%A\", \"%w\", \"%d\", \"%b\", \"%B\", \"%m\", \"%y\", \"%Y\", \"%H\",\n+             \"%I\", \"%p\", \"%M\", \"%z\", \"%Z\", \"%j\", \"%U\", \"%W\", \"%c\", \"%x\",\n+             \"%X\", \"%%\", \"%G\", \"%V\", \"%u\")\n+\n+  for (format in formats) {\n+    expect_dplyr_equal(\n+      input %>%\n+        mutate(x = strftime(x, format = format)) %>%\n+        collect(),\n+      times\n+    )\n+\n+    expect_dplyr_equal(\n+      input %>%\n+        mutate(x = strftime(x, format = format, usetz = TRUE)) %>%\n+        collect(),\n+      times\n+    )\n+\n+    x <- Expression$field_ref(\"x\")\n+    expect_error(\n+      nse_funcs$strftime(x, format = format, tz=\"Mars/Mariner_Valley\"),\n+      \"tz argument not supported by Arrow\"\n+    )\n+  }\n+})\n\nReview comment:\n       Apologies, my mistake; I'd presumed that we can use a column of a table as something to pass into the `options` param, but it appears we can't. \r\n   \r\n   Perhaps the solution here is writing multiple separate tests, though I don't see why you couldn't combine multiple format markers in one test to have a smaller subset of tests.  \n\n\n\n\n-- \nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nTo unsubscribe, e-mail: github-unsubscribe@arrow.apache.org\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2021-09-17T08:04:00.068+0000",
                    "updated": "2021-09-17T08:04:00.068+0000",
                    "started": "2021-09-17T08:04:00.067+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "652164",
                    "issueId": "13391901"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13391901/worklog/652197",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "thisisnic edited a comment on pull request #11105:\nURL: https://github.com/apache/arrow/pull/11105#issuecomment-921279899\n\n\n   > behavior of the %S flag is different in arrow\r\n   \r\n   So, the R \"%S\" returns an integer, so you're right in highlighting the difference between Arrow and R.  We have other time-related functions which return slightly different values, which we allow for, e.g.\r\n   \r\n   https://github.com/apache/arrow/blob/5260fd5970d34c62e0ae7680f606b29eab56d96b/r/tests/testthat/test-dplyr-lubridate.R#L155-L164\r\n   \r\n   The function `expect_dplyr_equal()`, as you've pointed out, won't work on Array objects.  However, you could write a test like the one shown above, which just adds a tolerance (given that the user is being returned a *more* precise answer than they would have, the tolerance is justified).\r\n   \r\n   I suppose the difficulty lies in the fact that the output is a string not a number, but there will be workarounds.\r\n   \n\n\n-- \nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nTo unsubscribe, e-mail: github-unsubscribe@arrow.apache.org\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2021-09-17T08:36:20.545+0000",
                    "updated": "2021-09-17T08:36:20.545+0000",
                    "started": "2021-09-17T08:36:20.545+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "652197",
                    "issueId": "13391901"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13391901/worklog/652199",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "thisisnic commented on a change in pull request #11105:\nURL: https://github.com/apache/arrow/pull/11105#discussion_r710868139\n\n\n\n##########\nFile path: r/tests/testthat/test-dplyr-string-functions.R\n##########\n@@ -719,6 +719,40 @@ test_that(\"errors in strptime\", {\n   )\n })\n \n+test_that(\"strftime\", {\n+  skip_on_os(\"windows\") # https://issues.apache.org/jira/browse/ARROW-13168\n+\n+  # TODO: consider reevaluating this workaround after ARROW-12980\n+  withr::local_timezone(\"UTC\")\n+  times <- tibble(x = c(lubridate::ymd_hms(\"2018-10-07 19:04:05\"), NA))\n+\n+  formats = c(\"%a\", \"%A\", \"%w\", \"%d\", \"%b\", \"%B\", \"%m\", \"%y\", \"%Y\", \"%H\",\n+             \"%I\", \"%p\", \"%M\", \"%z\", \"%Z\", \"%j\", \"%U\", \"%W\", \"%c\", \"%x\",\n+             \"%X\", \"%%\", \"%G\", \"%V\", \"%u\")\n+\n+  for (format in formats) {\n+    expect_dplyr_equal(\n+      input %>%\n+        mutate(x = strftime(x, format = format)) %>%\n+        collect(),\n+      times\n+    )\n+\n+    expect_dplyr_equal(\n+      input %>%\n+        mutate(x = strftime(x, format = format, usetz = TRUE)) %>%\n+        collect(),\n+      times\n+    )\n+\n+    x <- Expression$field_ref(\"x\")\n+    expect_error(\n+      nse_funcs$strftime(x, format = format, tz=\"Mars/Mariner_Valley\"),\n+      \"tz argument not supported by Arrow\"\n+    )\n+  }\n+})\n\nReview comment:\n       How about something like this?  It's not complete - the final two tests are still causing problems, but it's a starting point.\r\n   \r\n   ```suggestion\r\n   df <- tibble(x = c(lubridate::ymd_hms(\"2019-02-03 12:34:56\"),  NA))\r\n   \r\n   expect_dplyr_equal(\r\n     input %>%\r\n       mutate(x = strftime(x, format = \"%a %A %w %d %b\")) %>%\r\n       collect(),\r\n     df\r\n   )\r\n    \r\n   expect_dplyr_equal(\r\n     input %>%\r\n       mutate(x = strftime(x, format = \"%B %m %y %Y %H\")) %>%\r\n       collect(),\r\n     df\r\n   )\r\n   \r\n   expect_dplyr_equal(\r\n     input %>%\r\n       mutate(x = strftime(x, format = \"%I %p %M %j\")) %>%\r\n       collect(),\r\n     df\r\n   )\r\n   \r\n   expect_dplyr_equal(\r\n     input %>%\r\n       mutate(x = strftime(x, format = \"%U %W %c %x\")) %>%\r\n       collect(),\r\n     df\r\n   )\r\n   \r\n   expect_dplyr_equal(\r\n     input %>%\r\n       mutate(x = strftime(x, format = \"%X %% %G %V %u\")) %>%\r\n       collect(),\r\n     df\r\n   )\r\n   \r\n   # Needs updating to deal with the difference in precision\r\n   expect_dplyr_equal(\r\n     input %>%\r\n       mutate(x = strftime(x, format = \"%S\")) %>%\r\n       collect(),\r\n     df\r\n   )\r\n   \r\n   # we should do something around documenting or dealing with this difference too\r\n   withr::with_timezone(\"Pacific/Marquesas\",\r\n    expect_dplyr_equal(\r\n       input %>%\r\n         mutate(x = strftime(x, format = \"%z %Z \")) %>%\r\n         collect(),\r\n       df\r\n     )\r\n   )\r\n   \r\n   })\r\n   ```\n\n\n\n\n-- \nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nTo unsubscribe, e-mail: github-unsubscribe@arrow.apache.org\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2021-09-17T08:41:07.709+0000",
                    "updated": "2021-09-17T08:41:07.709+0000",
                    "started": "2021-09-17T08:41:07.709+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "652199",
                    "issueId": "13391901"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13391901/worklog/652202",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "thisisnic commented on a change in pull request #11105:\nURL: https://github.com/apache/arrow/pull/11105#discussion_r710868139\n\n\n\n##########\nFile path: r/tests/testthat/test-dplyr-string-functions.R\n##########\n@@ -719,6 +719,40 @@ test_that(\"errors in strptime\", {\n   )\n })\n \n+test_that(\"strftime\", {\n+  skip_on_os(\"windows\") # https://issues.apache.org/jira/browse/ARROW-13168\n+\n+  # TODO: consider reevaluating this workaround after ARROW-12980\n+  withr::local_timezone(\"UTC\")\n+  times <- tibble(x = c(lubridate::ymd_hms(\"2018-10-07 19:04:05\"), NA))\n+\n+  formats = c(\"%a\", \"%A\", \"%w\", \"%d\", \"%b\", \"%B\", \"%m\", \"%y\", \"%Y\", \"%H\",\n+             \"%I\", \"%p\", \"%M\", \"%z\", \"%Z\", \"%j\", \"%U\", \"%W\", \"%c\", \"%x\",\n+             \"%X\", \"%%\", \"%G\", \"%V\", \"%u\")\n+\n+  for (format in formats) {\n+    expect_dplyr_equal(\n+      input %>%\n+        mutate(x = strftime(x, format = format)) %>%\n+        collect(),\n+      times\n+    )\n+\n+    expect_dplyr_equal(\n+      input %>%\n+        mutate(x = strftime(x, format = format, usetz = TRUE)) %>%\n+        collect(),\n+      times\n+    )\n+\n+    x <- Expression$field_ref(\"x\")\n+    expect_error(\n+      nse_funcs$strftime(x, format = format, tz=\"Mars/Mariner_Valley\"),\n+      \"tz argument not supported by Arrow\"\n+    )\n+  }\n+})\n\nReview comment:\n       How about something like this?  It's not complete - the final two format tests are still causing problems, but it's a starting point.\r\n   \r\n   ```suggestion\r\n   df <- tibble(x = c(lubridate::ymd_hms(\"2019-02-03 12:34:56\"),  NA))\r\n   \r\n   expect_dplyr_equal(\r\n     input %>%\r\n       mutate(x = strftime(x, format = \"%a %A %w %d %b\")) %>%\r\n       collect(),\r\n     df\r\n   )\r\n    \r\n   expect_dplyr_equal(\r\n     input %>%\r\n       mutate(x = strftime(x, format = \"%B %m %y %Y %H\")) %>%\r\n       collect(),\r\n     df\r\n   )\r\n   \r\n   expect_dplyr_equal(\r\n     input %>%\r\n       mutate(x = strftime(x, format = \"%I %p %M %j\")) %>%\r\n       collect(),\r\n     df\r\n   )\r\n   \r\n   expect_dplyr_equal(\r\n     input %>%\r\n       mutate(x = strftime(x, format = \"%U %W %c %x\")) %>%\r\n       collect(),\r\n     df\r\n   )\r\n   \r\n   expect_dplyr_equal(\r\n     input %>%\r\n       mutate(x = strftime(x, format = \"%X %% %G %V %u\")) %>%\r\n       collect(),\r\n     df\r\n   )\r\n   \r\n   # Needs updating to deal with the difference in precision\r\n   expect_dplyr_equal(\r\n     input %>%\r\n       mutate(x = strftime(x, format = \"%S\")) %>%\r\n       collect(),\r\n     df\r\n   )\r\n   \r\n   # we should do something around documenting or dealing with this difference too\r\n   withr::with_timezone(\"Pacific/Marquesas\",\r\n    expect_dplyr_equal(\r\n       input %>%\r\n         mutate(x = strftime(x, format = \"%z %Z \")) %>%\r\n         collect(),\r\n       df\r\n     )\r\n   )\r\n   \r\n   # we also need to do something about this\r\n   withr::with_timezone(\"Pacific/Marquesas\",\r\n     expect_dplyr_equal(\r\n       input %>% \r\n         mutate(x = strftime(x, format = \"%H\", usetz = TRUE)) %>%\r\n         collect(),\r\n       df\r\n     )\r\n   )\r\n   \r\n   \r\n     x <- Expression$field_ref(\"x\")\r\n     expect_error(\r\n       nse_funcs$strftime(x, format = format, tz=\"Mars/Mariner_Valley\"),\r\n       \"tz argument not supported by Arrow\"\r\n     )\r\n   \r\n   })\r\n   ```\n\n\n\n\n-- \nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nTo unsubscribe, e-mail: github-unsubscribe@arrow.apache.org\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2021-09-17T08:48:24.767+0000",
                    "updated": "2021-09-17T08:48:24.767+0000",
                    "started": "2021-09-17T08:48:24.767+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "652202",
                    "issueId": "13391901"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13391901/worklog/652212",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "rok commented on a change in pull request #11105:\nURL: https://github.com/apache/arrow/pull/11105#discussion_r710887284\n\n\n\n##########\nFile path: r/tests/testthat/test-dplyr-string-functions.R\n##########\n@@ -719,6 +719,40 @@ test_that(\"errors in strptime\", {\n   )\n })\n \n+test_that(\"strftime\", {\n+  skip_on_os(\"windows\") # https://issues.apache.org/jira/browse/ARROW-13168\n+\n+  # TODO: consider reevaluating this workaround after ARROW-12980\n+  withr::local_timezone(\"UTC\")\n+  times <- tibble(x = c(lubridate::ymd_hms(\"2018-10-07 19:04:05\"), NA))\n+\n+  formats = c(\"%a\", \"%A\", \"%w\", \"%d\", \"%b\", \"%B\", \"%m\", \"%y\", \"%Y\", \"%H\",\n+             \"%I\", \"%p\", \"%M\", \"%z\", \"%Z\", \"%j\", \"%U\", \"%W\", \"%c\", \"%x\",\n+             \"%X\", \"%%\", \"%G\", \"%V\", \"%u\")\n+\n+  for (format in formats) {\n+    expect_dplyr_equal(\n+      input %>%\n+        mutate(x = strftime(x, format = format)) %>%\n+        collect(),\n+      times\n+    )\n+\n+    expect_dplyr_equal(\n+      input %>%\n+        mutate(x = strftime(x, format = format, usetz = TRUE)) %>%\n+        collect(),\n+      times\n+    )\n+\n+    x <- Expression$field_ref(\"x\")\n+    expect_error(\n+      nse_funcs$strftime(x, format = format, tz=\"Mars/Mariner_Valley\"),\n+      \"tz argument not supported by Arrow\"\n+    )\n+  }\n+})\n\nReview comment:\n       Oh yeah indeed. We can also just do a single string with all the flags :)\n\n\n\n\n-- \nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nTo unsubscribe, e-mail: github-unsubscribe@arrow.apache.org\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2021-09-17T09:08:06.657+0000",
                    "updated": "2021-09-17T09:08:06.657+0000",
                    "started": "2021-09-17T09:08:06.656+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "652212",
                    "issueId": "13391901"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13391901/worklog/652215",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "edponce commented on a change in pull request #11105:\nURL: https://github.com/apache/arrow/pull/11105#discussion_r710894307\n\n\n\n##########\nFile path: r/tests/testthat/test-dplyr-string-functions.R\n##########\n@@ -719,6 +719,40 @@ test_that(\"errors in strptime\", {\n   )\n })\n \n+test_that(\"strftime\", {\n+  skip_on_os(\"windows\") # https://issues.apache.org/jira/browse/ARROW-13168\n+\n+  # TODO: consider reevaluating this workaround after ARROW-12980\n+  withr::local_timezone(\"UTC\")\n+  times <- tibble(x = c(lubridate::ymd_hms(\"2018-10-07 19:04:05\"), NA))\n+\n+  formats = c(\"%a\", \"%A\", \"%w\", \"%d\", \"%b\", \"%B\", \"%m\", \"%y\", \"%Y\", \"%H\",\n+             \"%I\", \"%p\", \"%M\", \"%z\", \"%Z\", \"%j\", \"%U\", \"%W\", \"%c\", \"%x\",\n+             \"%X\", \"%%\", \"%G\", \"%V\", \"%u\")\n+\n+  for (format in formats) {\n+    expect_dplyr_equal(\n+      input %>%\n+        mutate(x = strftime(x, format = format)) %>%\n+        collect(),\n+      times\n+    )\n+\n+    expect_dplyr_equal(\n+      input %>%\n+        mutate(x = strftime(x, format = format, usetz = TRUE)) %>%\n+        collect(),\n+      times\n+    )\n+\n+    x <- Expression$field_ref(\"x\")\n+    expect_error(\n+      nse_funcs$strftime(x, format = format, tz=\"Mars/Mariner_Valley\"),\n\nReview comment:\n       Nit: Missing spaces before/after assignment for `tz`.\n\n\n\n\n-- \nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nTo unsubscribe, e-mail: github-unsubscribe@arrow.apache.org\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2021-09-17T09:17:30.906+0000",
                    "updated": "2021-09-17T09:17:30.906+0000",
                    "started": "2021-09-17T09:17:30.905+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "652215",
                    "issueId": "13391901"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13391901/worklog/652221",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "edponce commented on a change in pull request #11105:\nURL: https://github.com/apache/arrow/pull/11105#discussion_r710900429\n\n\n\n##########\nFile path: r/R/dplyr-functions.R\n##########\n@@ -672,6 +672,16 @@ nse_funcs$strptime <- function(x, format = \"%Y-%m-%d %H:%M:%S\", tz = NULL, unit\n   Expression$create(\"strptime\", x, options = list(format = format, unit = unit))\n }\n \n+nse_funcs$strftime <- function(x, format = \"\", tz = \"\", usetz = FALSE) {\n+  if (tz != \"\") {\n+    arrow_not_supported(\"tz argument\")\n+  }\n+  if (usetz) {\n+    format = paste(format, \"%Z\")\n\nReview comment:\n       What if `format` already contains the timezone (%Z) specifier? `paste` command would duplicate it.\r\n   Nevertheless, R's `strftime` does not performs these type of validations:\r\n   ```r\r\n   > strftime(\"2021-9-17\", format=\"%Y-%m-%dd\")  # note the extra 'd'\r\n   [1] \"2021-09-17d\"\r\n   > strftime(\"2021-9-17\", format=\"%Y-%m-%d %Z\", usetz=TRUE)  # note the use of '%Z' and usetz\r\n   [1] \"2021-09-17 EDT EDT\"\r\n   ```\r\n   So it is ok that this has the same behavior.\n\n\n\n\n-- \nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nTo unsubscribe, e-mail: github-unsubscribe@arrow.apache.org\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2021-09-17T09:26:19.219+0000",
                    "updated": "2021-09-17T09:26:19.219+0000",
                    "started": "2021-09-17T09:26:19.218+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "652221",
                    "issueId": "13391901"
                }
            ]
        },
        "customfield_12313920": null,
        "issuetype": {
            "self": "https://issues.apache.org/jira/rest/api/2/issuetype/2",
            "id": "2",
            "description": "A new feature of the product, which has yet to be developed.",
            "iconUrl": "https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21141&avatarType=issuetype",
            "name": "New Feature",
            "subtask": false,
            "avatarId": 21141
        },
        "timespent": 33600,
        "customfield_12314020": "{summaryBean=com.atlassian.jira.plugin.devstatus.rest.SummaryBean@28da3c1e[summary={pullrequest=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@17334235[overall=PullRequestOverallBean{stateCount=0, state='OPEN', details=PullRequestOverallDetails{openCount=0, mergedCount=0, declinedCount=0}},byInstanceType={}], build=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@74cb3b47[overall=com.atlassian.jira.plugin.devstatus.summary.beans.BuildOverallBean@79e4fd01[failedBuildCount=0,successfulBuildCount=0,unknownBuildCount=0,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], review=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@cef42b4[overall=com.atlassian.jira.plugin.devstatus.summary.beans.ReviewsOverallBean@474d56e1[stateCount=0,state=<null>,dueDate=<null>,overDue=false,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], deployment-environment=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@6a715c4c[overall=com.atlassian.jira.plugin.devstatus.summary.beans.DeploymentOverallBean@3423b8f6[topEnvironments=[],showProjects=false,successfulCount=0,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], repository=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@422fb624[overall=com.atlassian.jira.plugin.devstatus.summary.beans.CommitOverallBean@6f781ade[count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], branch=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@f8ba841[overall=com.atlassian.jira.plugin.devstatus.summary.beans.BranchOverallBean@26c6554e[count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}]},errors=[],configErrors=[]], devSummaryJson={\"cachedValue\":{\"errors\":[],\"configErrors\":[],\"summary\":{\"pullrequest\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"stateCount\":0,\"state\":\"OPEN\",\"details\":{\"openCount\":0,\"mergedCount\":0,\"declinedCount\":0,\"total\":0},\"open\":true},\"byInstanceType\":{}},\"build\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"failedBuildCount\":0,\"successfulBuildCount\":0,\"unknownBuildCount\":0},\"byInstanceType\":{}},\"review\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"stateCount\":0,\"state\":null,\"dueDate\":null,\"overDue\":false,\"completed\":false},\"byInstanceType\":{}},\"deployment-environment\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"topEnvironments\":[],\"showProjects\":false,\"successfulCount\":0},\"byInstanceType\":{}},\"repository\":{\"overall\":{\"count\":0,\"lastUpdated\":null},\"byInstanceType\":{}},\"branch\":{\"overall\":{\"count\":0,\"lastUpdated\":null},\"byInstanceType\":{}}}},\"isStale\":false}}",
        "customfield_12314141": null,
        "customfield_12314140": null,
        "project": {
            "self": "https://issues.apache.org/jira/rest/api/2/project/12319525",
            "id": "12319525",
            "key": "ARROW",
            "name": "Apache Arrow",
            "projectTypeKey": "software",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/projectavatar?pid=12319525&avatarId=10011",
                "24x24": "https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12319525&avatarId=10011",
                "16x16": "https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12319525&avatarId=10011",
                "32x32": "https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12319525&avatarId=10011"
            },
            "projectCategory": {
                "self": "https://issues.apache.org/jira/rest/api/2/projectCategory/13960",
                "id": "13960",
                "description": "Apache Arrow",
                "name": "Arrow"
            }
        },
        "aggregatetimespent": 33600,
        "customfield_12312520": null,
        "customfield_12312521": "Thu Sep 23 18:41:48 UTC 2021",
        "customfield_12314422": null,
        "customfield_12314421": null,
        "customfield_12314146": null,
        "customfield_12314420": null,
        "customfield_12314145": null,
        "customfield_12314144": null,
        "customfield_12314143": null,
        "resolutiondate": "2021-09-23T18:41:48.000+0000",
        "workratio": -1,
        "customfield_12312923": null,
        "customfield_12312920": null,
        "customfield_12312921": null,
        "watches": {
            "self": "https://issues.apache.org/jira/rest/api/2/issue/ARROW-13448/watchers",
            "watchCount": 2,
            "isWatching": false
        },
        "created": "2021-07-26T14:10:46.000+0000",
        "updated": "2021-09-23T18:43:04.000+0000",
        "timeoriginalestimate": null,
        "description": "Following ARROW-13174",
        "customfield_10010": null,
        "timetracking": {
            "remainingEstimate": "0h",
            "timeSpent": "9h 20m",
            "remainingEstimateSeconds": 0,
            "timeSpentSeconds": 33600
        },
        "customfield_12314523": null,
        "customfield_12314127": null,
        "customfield_12314522": null,
        "customfield_12314126": null,
        "customfield_12314521": null,
        "customfield_12314125": null,
        "customfield_12314520": null,
        "customfield_12314124": null,
        "attachment": [],
        "customfield_12312340": null,
        "customfield_12314123": null,
        "customfield_12312341": null,
        "customfield_12312220": null,
        "customfield_12314122": null,
        "customfield_12314121": null,
        "customfield_12314120": null,
        "customfield_12314129": null,
        "customfield_12314524": null,
        "customfield_12314128": null,
        "summary": "[R] Bindings for strftime",
        "customfield_12314130": null,
        "customfield_12310291": null,
        "customfield_12310290": null,
        "customfield_12314138": null,
        "customfield_12314137": null,
        "environment": null,
        "customfield_12314136": null,
        "customfield_12314135": null,
        "customfield_12311020": null,
        "customfield_12314134": null,
        "duedate": null,
        "customfield_12314132": null,
        "customfield_12314131": null,
        "comment": {
            "comments": [
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13391901/comment/17387386",
                    "id": "17387386",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=rokm",
                        "name": "rokm",
                        "key": "rokm",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=34044",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34044",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34044",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34044"
                        },
                        "displayName": "Rok Mihevc",
                        "active": true,
                        "timeZone": "Europe/Amsterdam"
                    },
                    "body": "I'd suggest the following binding for StrftimeOptions in compute.cpp:\r\n{code:cpp}\r\n  if (func_name == \"strftime\") {\r\n    using Options = arrow::compute::StrftimeOptions;\r\n    std::string format = \"%Y-%m-%dT%H:%M:%SZ\";\r\n    std::string locale = \"C\";\r\n    if (!Rf_isNull(options[\"format\"])) {\r\n      format = cpp11::as_cpp<std::string>(options[\"format\"]);\r\n    }\r\n    if (!Rf_isNull(options[\"locale\"])) {\r\n      locale = cpp11::as_cpp<std::string>(options[\"locale\"]);\r\n    }\r\n    return std::make_shared<Options>(Options(format, locale));\r\n  }\r\n{code}",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=rokm",
                        "name": "rokm",
                        "key": "rokm",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=34044",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34044",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34044",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34044"
                        },
                        "displayName": "Rok Mihevc",
                        "active": true,
                        "timeZone": "Europe/Amsterdam"
                    },
                    "created": "2021-07-26T14:32:49.989+0000",
                    "updated": "2021-07-26T14:32:49.989+0000"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13391901/comment/17419402",
                    "id": "17419402",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=jonkeane",
                        "name": "jonkeane",
                        "key": "jonkeane",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=34057",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34057",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34057",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34057"
                        },
                        "displayName": "Jonathan Keane",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "body": "Issue resolved by pull request 11105\n[https://github.com/apache/arrow/pull/11105]",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=jonkeane",
                        "name": "jonkeane",
                        "key": "jonkeane",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=34057",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34057",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34057",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34057"
                        },
                        "displayName": "Jonathan Keane",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "created": "2021-09-23T18:41:48.082+0000",
                    "updated": "2021-09-23T18:41:48.082+0000"
                }
            ],
            "maxResults": 2,
            "total": 2,
            "startAt": 0
        },
        "customfield_12311820": "0|z0tc14:",
        "customfield_12314139": null
    }
}