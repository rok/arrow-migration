{
    "expand": "operations,versionedRepresentations,editmeta,changelog,renderedFields",
    "id": "13337799",
    "self": "https://issues.apache.org/jira/rest/api/2/issue/13337799",
    "key": "ARROW-10417",
    "fields": {
        "fixVersions": [],
        "resolution": {
            "self": "https://issues.apache.org/jira/rest/api/2/resolution/5",
            "id": "5",
            "description": "All attempts at reproducing this issue failed, or not enough information was available to reproduce the issue. Reading the code produces no clues as to why this behavior would occur. If more information appears later, please reopen the issue.",
            "name": "Cannot Reproduce"
        },
        "customfield_12312322": null,
        "customfield_12312323": null,
        "customfield_12312320": null,
        "customfield_12310420": "9223372036854775807",
        "customfield_12312321": null,
        "customfield_12312328": null,
        "customfield_12312329": null,
        "customfield_12312326": null,
        "customfield_12310300": null,
        "customfield_12312327": null,
        "customfield_12312324": null,
        "customfield_12312720": null,
        "customfield_12312325": null,
        "lastViewed": null,
        "priority": {
            "self": "https://issues.apache.org/jira/rest/api/2/priority/3",
            "iconUrl": "https://issues.apache.org/jira/images/icons/priorities/major.svg",
            "name": "Major",
            "id": "3"
        },
        "labels": [],
        "customfield_12312333": null,
        "customfield_12312334": null,
        "customfield_12313422": "false",
        "customfield_12310310": "4.0",
        "customfield_12312331": null,
        "customfield_12312332": null,
        "aggregatetimeoriginalestimate": null,
        "timeestimate": null,
        "customfield_12312330": null,
        "versions": [
            {
                "self": "https://issues.apache.org/jira/rest/api/2/version/12346358",
                "id": "12346358",
                "description": "",
                "name": "0.15.1",
                "archived": false,
                "released": true,
                "releaseDate": "2019-11-01"
            },
            {
                "self": "https://issues.apache.org/jira/rest/api/2/version/12345977",
                "id": "12345977",
                "description": "",
                "name": "2.0.0",
                "archived": false,
                "released": true,
                "releaseDate": "2020-10-19"
            }
        ],
        "customfield_12311120": null,
        "customfield_12313826": null,
        "customfield_12312339": null,
        "issuelinks": [],
        "customfield_12313825": null,
        "assignee": null,
        "customfield_12312337": null,
        "customfield_12313823": null,
        "customfield_12312338": null,
        "customfield_12311920": null,
        "customfield_12313822": null,
        "customfield_12312335": null,
        "customfield_12313821": null,
        "customfield_12312336": null,
        "customfield_12313820": null,
        "status": {
            "self": "https://issues.apache.org/jira/rest/api/2/status/6",
            "description": "The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.",
            "iconUrl": "https://issues.apache.org/jira/images/icons/statuses/closed.png",
            "name": "Closed",
            "id": "6",
            "statusCategory": {
                "self": "https://issues.apache.org/jira/rest/api/2/statuscategory/3",
                "id": 3,
                "key": "done",
                "colorName": "green",
                "name": "Done"
            }
        },
        "components": [
            {
                "self": "https://issues.apache.org/jira/rest/api/2/component/12328935",
                "id": "12328935",
                "name": "C++"
            },
            {
                "self": "https://issues.apache.org/jira/rest/api/2/component/12328936",
                "id": "12328936",
                "name": "Python"
            }
        ],
        "customfield_12312026": null,
        "customfield_12312023": null,
        "customfield_12312024": null,
        "aggregatetimeestimate": null,
        "customfield_12312022": null,
        "customfield_12310921": null,
        "customfield_12310920": "9223372036854775807",
        "customfield_12312823": null,
        "creator": {
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=shouheng",
            "name": "shouheng",
            "key": "shouheng",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=shouheng&avatarId=44777",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=shouheng&avatarId=44777",
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=shouheng&avatarId=44777",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=shouheng&avatarId=44777"
            },
            "displayName": "Shouheng Yi",
            "active": true,
            "timeZone": "Etc/UTC"
        },
        "subtasks": [],
        "reporter": {
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=shouheng",
            "name": "shouheng",
            "key": "shouheng",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=shouheng&avatarId=44777",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=shouheng&avatarId=44777",
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=shouheng&avatarId=44777",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=shouheng&avatarId=44777"
            },
            "displayName": "Shouheng Yi",
            "active": true,
            "timeZone": "Etc/UTC"
        },
        "aggregateprogress": {
            "progress": 0,
            "total": 0
        },
        "customfield_12313520": null,
        "customfield_12310250": null,
        "progress": {
            "progress": 0,
            "total": 0
        },
        "customfield_12313924": null,
        "votes": {
            "self": "https://issues.apache.org/jira/rest/api/2/issue/ARROW-10417/votes",
            "votes": 0,
            "hasVoted": false
        },
        "worklog": {
            "startAt": 0,
            "maxResults": 20,
            "total": 0,
            "worklogs": []
        },
        "customfield_12313920": null,
        "issuetype": {
            "self": "https://issues.apache.org/jira/rest/api/2/issuetype/1",
            "id": "1",
            "description": "A problem which impairs or prevents the functions of the product.",
            "iconUrl": "https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype",
            "name": "Bug",
            "subtask": false,
            "avatarId": 21133
        },
        "timespent": null,
        "customfield_12314020": "{summaryBean=com.atlassian.jira.plugin.devstatus.rest.SummaryBean@7f68a1c7[summary={pullrequest=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@18d63eab[overall=PullRequestOverallBean{stateCount=0, state='OPEN', details=PullRequestOverallDetails{openCount=0, mergedCount=0, declinedCount=0}},byInstanceType={}], build=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@74156a0a[overall=com.atlassian.jira.plugin.devstatus.summary.beans.BuildOverallBean@5d9f3145[failedBuildCount=0,successfulBuildCount=0,unknownBuildCount=0,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], review=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@6d2a4709[overall=com.atlassian.jira.plugin.devstatus.summary.beans.ReviewsOverallBean@6f0593d5[stateCount=0,state=<null>,dueDate=<null>,overDue=false,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], deployment-environment=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@301fe105[overall=com.atlassian.jira.plugin.devstatus.summary.beans.DeploymentOverallBean@14aeeb5a[topEnvironments=[],showProjects=false,successfulCount=0,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], repository=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@2b83e4c9[overall=com.atlassian.jira.plugin.devstatus.summary.beans.CommitOverallBean@685b5157[count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], branch=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@27839290[overall=com.atlassian.jira.plugin.devstatus.summary.beans.BranchOverallBean@44945901[count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}]},errors=[],configErrors=[]], devSummaryJson={\"cachedValue\":{\"errors\":[],\"configErrors\":[],\"summary\":{\"pullrequest\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"stateCount\":0,\"state\":\"OPEN\",\"details\":{\"openCount\":0,\"mergedCount\":0,\"declinedCount\":0,\"total\":0},\"open\":true},\"byInstanceType\":{}},\"build\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"failedBuildCount\":0,\"successfulBuildCount\":0,\"unknownBuildCount\":0},\"byInstanceType\":{}},\"review\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"stateCount\":0,\"state\":null,\"dueDate\":null,\"overDue\":false,\"completed\":false},\"byInstanceType\":{}},\"deployment-environment\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"topEnvironments\":[],\"showProjects\":false,\"successfulCount\":0},\"byInstanceType\":{}},\"repository\":{\"overall\":{\"count\":0,\"lastUpdated\":null},\"byInstanceType\":{}},\"branch\":{\"overall\":{\"count\":0,\"lastUpdated\":null},\"byInstanceType\":{}}}},\"isStale\":false}}",
        "customfield_12314141": null,
        "customfield_12314140": null,
        "project": {
            "self": "https://issues.apache.org/jira/rest/api/2/project/12319525",
            "id": "12319525",
            "key": "ARROW",
            "name": "Apache Arrow",
            "projectTypeKey": "software",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/projectavatar?pid=12319525&avatarId=10011",
                "24x24": "https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12319525&avatarId=10011",
                "16x16": "https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12319525&avatarId=10011",
                "32x32": "https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12319525&avatarId=10011"
            },
            "projectCategory": {
                "self": "https://issues.apache.org/jira/rest/api/2/projectCategory/13960",
                "id": "13960",
                "description": "Apache Arrow",
                "name": "Arrow"
            }
        },
        "aggregatetimespent": null,
        "customfield_12312520": null,
        "customfield_12312521": "Mon Mar 22 22:10:51 UTC 2021",
        "customfield_12314422": null,
        "customfield_12314421": null,
        "customfield_12314146": null,
        "customfield_12314420": null,
        "customfield_12314145": null,
        "customfield_12314144": null,
        "customfield_12314143": null,
        "resolutiondate": "2021-03-22T22:10:51.000+0000",
        "workratio": -1,
        "customfield_12312923": null,
        "customfield_12312920": null,
        "customfield_12312921": null,
        "watches": {
            "self": "https://issues.apache.org/jira/rest/api/2/issue/ARROW-10417/watchers",
            "watchCount": 8,
            "isWatching": false
        },
        "created": "2020-10-29T04:55:43.000+0000",
        "updated": "2021-03-22T22:10:51.000+0000",
        "timeoriginalestimate": null,
        "description": "There might be a memory leak in the {{RecordBatchStreamWriter}}. The memory resources were not released. It always hit the memory limit and started doing virtual memory swapping. See the picture below:\r\n\r\n!Screen Shot 2020-10-28 at 9.43.32 PM.png!\r\n\r\nThis was the code:\r\n{code:python}\r\nimport tempfile\r\nimport os\r\nimport sys\r\n\r\nimport pyarrow as pa\r\n\r\nB = 1\r\nKB = 1024 * B\r\nMB = 1024 * KB\r\n\r\nschema = pa.schema(\r\n    [\r\n        pa.field(\"a_string\", pa.string()),\r\n        pa.field(\"an_int\", pa.int32()),\r\n        pa.field(\"a_float\", pa.float32()),\r\n        pa.field(\"a_list_of_floats\", pa.list_(pa.float32())),\r\n    ]\r\n)\r\n\r\nnrows_in_a_batch = 1000\r\nnbatches_in_a_table = 1000\r\n\r\ncolumn_arrays = [\r\n    [\"string\"] * nrows_in_a_batch,\r\n    [123] * nrows_in_a_batch,\r\n    [456.789] * nrows_in_a_batch,\r\n    [range(1000)] * nrows_in_a_batch,\r\n]\r\n\r\ndef main(sys_args) -> None:\r\n    batch = pa.RecordBatch.from_arrays(column_arrays, schema=schema)\r\n    table = pa.Table.from_batches([batch] * nbatches_in_a_table, schema=schema)\r\n\r\n    with tempfile.TemporaryDirectory() as tmpdir:\r\n        filename_template = \"file-{n}.arror\"\r\n        i = 0\r\n\r\n        while True:\r\n            path = os.path.join(tmpdir, filename_template.format(n=i))\r\n            i += 1\r\n\r\n            with pa.OSFile(path, \"w\") as sink:\r\n                with pa.RecordBatchStreamWriter(sink, schema) as writer:\r\n                    writer.write_table(table)\r\n                    print(f\"pa.total_allocated_bytes(): {pa.total_allocated_bytes() / MB} mb\")\r\n\r\nif __name__ == \"__main__\":\r\n    main(sys.argv[1:])\r\n{code}\r\nStrangely enough, printing {{total_allocated_bytes}}, it seemed normal.\r\n{code:python}\r\npa.total_allocated_bytes(): 3.95556640625 mb\r\npa.total_allocated_bytes(): 3.95556640625 mb\r\npa.total_allocated_bytes(): 3.95556640625 mb\r\npa.total_allocated_bytes(): 3.95556640625 mb\r\npa.total_allocated_bytes(): 3.95556640625 mb\r\n{code}\r\n\r\nAm I using {{RecordBatchStreamWriter}} incorrectly? If not, how can I release the resources?\r\n\r\n[Updates 10/29/2020]\r\n\r\nI tested on {{pyarrow==2.0.0}}. I still see the same issue.\r\n!Screen Shot 2020-10-29 at 9.22.58 AM.png! \r\n\r\nI changed {{RecordBatchStreamWriter}} to {{RecordBatchFileWriter}} in my code, i.e.:\r\n\r\n{code:python}\r\n...\r\n            with pa.OSFile(path, \"w\") as sink:\r\n                with pa.RecordBatchFileWriter(sink, schema) as writer:\r\n                    writer.write_table(table)\r\n                    print(f\"pa.total_allocated_bytes(): {pa.total_allocated_bytes() / MB} mb\")\r\n...\r\n{code}\r\n\r\nI observed the same memory profile. I'm wondering if it is caused by [WriteRecordBatch |https://github.com/apache/arrow/blob/maint-0.15.x/cpp/src/arrow/ipc/writer.cc#L594] not being able to release memory.",
        "customfield_10010": null,
        "timetracking": {},
        "customfield_12314523": null,
        "customfield_12314127": null,
        "customfield_12314522": null,
        "customfield_12314126": null,
        "customfield_12314521": null,
        "customfield_12314125": null,
        "customfield_12314520": null,
        "customfield_12314124": null,
        "attachment": [
            {
                "self": "https://issues.apache.org/jira/rest/api/2/attachment/13018565",
                "id": "13018565",
                "filename": "arrow-10417-memtest-1.png",
                "author": {
                    "self": "https://issues.apache.org/jira/rest/api/2/user?username=westonpace",
                    "name": "westonpace",
                    "key": "westonpace",
                    "avatarUrls": {
                        "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=34045",
                        "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34045",
                        "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34045",
                        "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34045"
                    },
                    "displayName": "Weston Pace",
                    "active": true,
                    "timeZone": "America/Los_Angeles"
                },
                "created": "2021-01-11T21:50:38.212+0000",
                "size": 243950,
                "mimeType": "image/png",
                "content": "https://issues.apache.org/jira/secure/attachment/13018565/arrow-10417-memtest-1.png"
            },
            {
                "self": "https://issues.apache.org/jira/rest/api/2/attachment/13014324",
                "id": "13014324",
                "filename": "Screen Shot 2020-10-28 at 9.43.32 PM.png",
                "author": {
                    "self": "https://issues.apache.org/jira/rest/api/2/user?username=shouheng",
                    "name": "shouheng",
                    "key": "shouheng",
                    "avatarUrls": {
                        "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=shouheng&avatarId=44777",
                        "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=shouheng&avatarId=44777",
                        "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=shouheng&avatarId=44777",
                        "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=shouheng&avatarId=44777"
                    },
                    "displayName": "Shouheng Yi",
                    "active": true,
                    "timeZone": "Etc/UTC"
                },
                "created": "2020-10-29T04:48:11.502+0000",
                "size": 39437,
                "mimeType": "image/png",
                "content": "https://issues.apache.org/jira/secure/attachment/13014324/Screen+Shot+2020-10-28+at+9.43.32+PM.png"
            },
            {
                "self": "https://issues.apache.org/jira/rest/api/2/attachment/13014323",
                "id": "13014323",
                "filename": "Screen Shot 2020-10-28 at 9.43.40 PM.png",
                "author": {
                    "self": "https://issues.apache.org/jira/rest/api/2/user?username=shouheng",
                    "name": "shouheng",
                    "key": "shouheng",
                    "avatarUrls": {
                        "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=shouheng&avatarId=44777",
                        "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=shouheng&avatarId=44777",
                        "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=shouheng&avatarId=44777",
                        "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=shouheng&avatarId=44777"
                    },
                    "displayName": "Shouheng Yi",
                    "active": true,
                    "timeZone": "Etc/UTC"
                },
                "created": "2020-10-29T04:55:32.418+0000",
                "size": 32056,
                "mimeType": "image/png",
                "content": "https://issues.apache.org/jira/secure/attachment/13014323/Screen+Shot+2020-10-28+at+9.43.40+PM.png"
            },
            {
                "self": "https://issues.apache.org/jira/rest/api/2/attachment/13014364",
                "id": "13014364",
                "filename": "Screen Shot 2020-10-29 at 9.22.58 AM.png",
                "author": {
                    "self": "https://issues.apache.org/jira/rest/api/2/user?username=shouheng",
                    "name": "shouheng",
                    "key": "shouheng",
                    "avatarUrls": {
                        "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=shouheng&avatarId=44777",
                        "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=shouheng&avatarId=44777",
                        "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=shouheng&avatarId=44777",
                        "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=shouheng&avatarId=44777"
                    },
                    "displayName": "Shouheng Yi",
                    "active": true,
                    "timeZone": "Etc/UTC"
                },
                "created": "2020-10-29T16:23:27.804+0000",
                "size": 6430,
                "mimeType": "image/png",
                "content": "https://issues.apache.org/jira/secure/attachment/13014364/Screen+Shot+2020-10-29+at+9.22.58+AM.png"
            }
        ],
        "customfield_12312340": null,
        "customfield_12314123": null,
        "customfield_12312341": null,
        "customfield_12312220": null,
        "customfield_12314122": null,
        "customfield_12314121": null,
        "customfield_12314120": null,
        "customfield_12314129": null,
        "customfield_12314524": null,
        "customfield_12314128": null,
        "summary": "[Python][C++] Possible Memory Leak in RecordBatchStreamWriter and RecordBatchFileWriter",
        "customfield_12314130": null,
        "customfield_12310291": null,
        "customfield_12310290": null,
        "customfield_12314138": null,
        "customfield_12314137": null,
        "environment": "This is the config for my worker node:\r\nresources:\r\n    - cpus: 1\r\n    - maxMemoryMb: 4096\r\n    - reservedMemoryMb: 2048",
        "customfield_12314136": null,
        "customfield_12314135": null,
        "customfield_12311020": null,
        "customfield_12314134": null,
        "duedate": null,
        "customfield_12314132": null,
        "customfield_12314131": null,
        "comment": {
            "comments": [
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13337799/comment/17222969",
                    "id": "17222969",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=wesm",
                        "name": "wesm",
                        "key": "wesmckinn",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=wesmckinn&avatarId=29931",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=wesmckinn&avatarId=29931",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=wesmckinn&avatarId=29931",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=wesmckinn&avatarId=29931"
                        },
                        "displayName": "Wes McKinney",
                        "active": true,
                        "timeZone": "America/New_York"
                    },
                    "body": "Is this issue still present in 2.0.0 or on master? If so, [~jorisvandenbossche] or [~bkietz] can you take a look?",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=wesm",
                        "name": "wesm",
                        "key": "wesmckinn",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=wesmckinn&avatarId=29931",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=wesmckinn&avatarId=29931",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=wesmckinn&avatarId=29931",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=wesmckinn&avatarId=29931"
                        },
                        "displayName": "Wes McKinney",
                        "active": true,
                        "timeZone": "America/New_York"
                    },
                    "created": "2020-10-29T15:41:07.946+0000",
                    "updated": "2020-10-29T15:41:07.946+0000"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13337799/comment/17222998",
                    "id": "17222998",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=shouheng",
                        "name": "shouheng",
                        "key": "shouheng",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=shouheng&avatarId=44777",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=shouheng&avatarId=44777",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=shouheng&avatarId=44777",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=shouheng&avatarId=44777"
                        },
                        "displayName": "Shouheng Yi",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "body": "[~wesm] See the [Updates] in the description section. TLDR; {{pyarrow 2.0.0}} has the same memory profile. I swapped {{RecordBatchStreamWriter}} with {{RecordBatchFileWriter}} and the profile looks the same.\r\n\r\nI suspect [WriteRecordBatch |https://github.com/apache/arrow/blob/maint-0.15.x/cpp/src/arrow/ipc/writer.cc#L594] is not releasing the memory.",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=shouheng",
                        "name": "shouheng",
                        "key": "shouheng",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=shouheng&avatarId=44777",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=shouheng&avatarId=44777",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=shouheng&avatarId=44777",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=shouheng&avatarId=44777"
                        },
                        "displayName": "Shouheng Yi",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "created": "2020-10-29T16:21:48.099+0000",
                    "updated": "2020-10-29T16:22:26.843+0000"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13337799/comment/17262950",
                    "id": "17262950",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=westonpace",
                        "name": "westonpace",
                        "key": "westonpace",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=34045",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34045",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34045",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34045"
                        },
                        "displayName": "Weston Pace",
                        "active": true,
                        "timeZone": "America/Los_Angeles"
                    },
                    "body": "[~shouheng] I'm having trouble reproducing this with the file you've provided.\u00a0 I am running on an Ubuntu 20.04.1 desktop and RAM usage stays constant.\u00a0 Can you provide me some more details around the environment you are running in?\u00a0 From the charts it appears you might be submitting some kind of batch job?\u00a0 Do you know any details about what kind of OS is running or how it is configured?\r\n\r\nIf you put...\r\n{code:java}\r\npa.jemalloc_set_decay_ms(10000)\r\n{code}\r\n..in your script (immediately after import pyarrow) does it change the behavior?\r\n\r\nAlso, do you see this kind of memory growth with other calls or is it specifically the record batch writer calls?\u00a0 For example, can you try the following similar program and see if you see the same kind of growth?\r\n{code:java}\r\nimport tempfile\r\nimport os\r\nimport sys\r\n\r\nimport pyarrow as pa\r\n\r\nB = 1\r\nKB = 1024 * B\r\nMB = 1024 * KB\r\n\r\nschema = pa.schema(\r\n    [\r\n        pa.field(\"a_string\", pa.string()),\r\n        pa.field(\"an_int\", pa.int32()),\r\n        pa.field(\"a_float\", pa.float32()),\r\n        pa.field(\"a_list_of_floats\", pa.list_(pa.float32())),\r\n    ]\r\n)\r\n\r\nnrows_in_a_batch = 1000\r\nnbatches_in_a_table = 1000\r\n\r\ncolumn_arrays = [\r\n    [\"string\"] * nrows_in_a_batch,\r\n    [123] * nrows_in_a_batch,\r\n    [456.789] * nrows_in_a_batch,\r\n    [range(1000)] * nrows_in_a_batch,\r\n]\r\n\r\ndef main(sys_args) -> None:\r\n\r\n    for iteration in range(1000):\r\n        if iteration % 100 == 0:\r\n            print(f'Percent complete: {100*iteration/1000.0}')\r\n        batch = pa.RecordBatch.from_arrays(column_arrays, schema=schema)\r\n        table = pa.Table.from_batches([batch] * nbatches_in_a_table, schema=schema)\r\n\r\nif __name__ == \"__main__\":\r\n    main(sys.argv[1:])\r\n{code}\r\n!arrow-10417-memtest-1.png!",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=westonpace",
                        "name": "westonpace",
                        "key": "westonpace",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=34045",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34045",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34045",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34045"
                        },
                        "displayName": "Weston Pace",
                        "active": true,
                        "timeZone": "America/Los_Angeles"
                    },
                    "created": "2021-01-11T21:50:42.717+0000",
                    "updated": "2021-01-11T21:54:18.775+0000"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13337799/comment/17306347",
                    "id": "17306347",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=apitrou",
                        "name": "apitrou",
                        "key": "pitrou",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=pitrou&avatarId=35049",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=pitrou&avatarId=35049",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=pitrou&avatarId=35049",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=pitrou&avatarId=35049"
                        },
                        "displayName": "Antoine Pitrou",
                        "active": true,
                        "timeZone": "Europe/Paris"
                    },
                    "body": "[~shouheng] would you like to provide feedback to [~westonpace] 's questions?",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=apitrou",
                        "name": "apitrou",
                        "key": "pitrou",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=pitrou&avatarId=35049",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=pitrou&avatarId=35049",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=pitrou&avatarId=35049",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=pitrou&avatarId=35049"
                        },
                        "displayName": "Antoine Pitrou",
                        "active": true,
                        "timeZone": "Europe/Paris"
                    },
                    "created": "2021-03-22T16:29:39.667+0000",
                    "updated": "2021-03-22T16:29:39.667+0000"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13337799/comment/17306600",
                    "id": "17306600",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=shouhengyi",
                        "name": "shouhengyi",
                        "key": "shouhengyi",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "Shouheng Yi",
                        "active": true,
                        "timeZone": "America/Los_Angeles"
                    },
                    "body": "Hi [~westonpace]\u00a0and [~apitrou]. Thank you for the investigation. I was running my job on AWS Batch when I encountered the aforementioned memory issue. Currently I don't have the access to that cluster anymore. Therefore I can't reproduce it. I tested your script locally and it worked as expected. I think we can close this ticket for now, since I can't access the compute environment or the code at the moment.",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=shouhengyi",
                        "name": "shouhengyi",
                        "key": "shouhengyi",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "Shouheng Yi",
                        "active": true,
                        "timeZone": "America/Los_Angeles"
                    },
                    "created": "2021-03-22T21:40:40.970+0000",
                    "updated": "2021-03-22T21:40:40.970+0000"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13337799/comment/17306612",
                    "id": "17306612",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=apitrou",
                        "name": "apitrou",
                        "key": "pitrou",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=pitrou&avatarId=35049",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=pitrou&avatarId=35049",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=pitrou&avatarId=35049",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=pitrou&avatarId=35049"
                        },
                        "displayName": "Antoine Pitrou",
                        "active": true,
                        "timeZone": "Europe/Paris"
                    },
                    "body": "Thanks for the feedback [~shouheng]! Closing now.",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=apitrou",
                        "name": "apitrou",
                        "key": "pitrou",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=pitrou&avatarId=35049",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=pitrou&avatarId=35049",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=pitrou&avatarId=35049",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=pitrou&avatarId=35049"
                        },
                        "displayName": "Antoine Pitrou",
                        "active": true,
                        "timeZone": "Europe/Paris"
                    },
                    "created": "2021-03-22T22:10:51.166+0000",
                    "updated": "2021-03-22T22:10:51.166+0000"
                }
            ],
            "maxResults": 6,
            "total": 6,
            "startAt": 0
        },
        "customfield_12311820": "0|z0k3ug:",
        "customfield_12314139": null
    }
}