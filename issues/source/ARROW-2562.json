{
    "expand": "operations,versionedRepresentations,editmeta,changelog,renderedFields",
    "id": "13158177",
    "self": "https://issues.apache.org/jira/rest/api/2/issue/13158177",
    "key": "ARROW-2562",
    "fields": {
        "fixVersions": [
            {
                "self": "https://issues.apache.org/jira/rest/api/2/version/12342562",
                "id": "12342562",
                "description": "",
                "name": "0.10.0",
                "archived": false,
                "released": true,
                "releaseDate": "2018-08-06"
            }
        ],
        "resolution": {
            "self": "https://issues.apache.org/jira/rest/api/2/resolution/1",
            "id": "1",
            "description": "A fix for this issue is checked into the tree and tested.",
            "name": "Fixed"
        },
        "customfield_12312322": null,
        "customfield_12312323": null,
        "customfield_12312320": null,
        "customfield_12310420": "9223372036854775807",
        "customfield_12312321": null,
        "customfield_12312328": null,
        "customfield_12312329": null,
        "customfield_12312326": null,
        "customfield_12310300": null,
        "customfield_12312327": null,
        "customfield_12312324": null,
        "customfield_12312720": null,
        "customfield_12312325": null,
        "lastViewed": null,
        "priority": {
            "self": "https://issues.apache.org/jira/rest/api/2/priority/3",
            "iconUrl": "https://issues.apache.org/jira/images/icons/priorities/major.svg",
            "name": "Major",
            "id": "3"
        },
        "labels": [
            "pull-request-available"
        ],
        "customfield_12312333": null,
        "customfield_12312334": null,
        "customfield_12313422": "false",
        "customfield_12310310": "0.0",
        "customfield_12312331": null,
        "customfield_12312332": null,
        "aggregatetimeoriginalestimate": null,
        "timeestimate": 0,
        "customfield_12312330": null,
        "versions": [],
        "customfield_12311120": null,
        "customfield_12313826": null,
        "customfield_12312339": null,
        "issuelinks": [],
        "customfield_12313825": null,
        "assignee": {
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=apitrou",
            "name": "apitrou",
            "key": "pitrou",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=pitrou&avatarId=35049",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=pitrou&avatarId=35049",
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=pitrou&avatarId=35049",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=pitrou&avatarId=35049"
            },
            "displayName": "Antoine Pitrou",
            "active": true,
            "timeZone": "Europe/Paris"
        },
        "customfield_12312337": null,
        "customfield_12313823": null,
        "customfield_12312338": null,
        "customfield_12311920": null,
        "customfield_12313822": null,
        "customfield_12312335": null,
        "customfield_12313821": null,
        "customfield_12312336": null,
        "customfield_12313820": null,
        "status": {
            "self": "https://issues.apache.org/jira/rest/api/2/status/5",
            "description": "A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.",
            "iconUrl": "https://issues.apache.org/jira/images/icons/statuses/resolved.png",
            "name": "Resolved",
            "id": "5",
            "statusCategory": {
                "self": "https://issues.apache.org/jira/rest/api/2/statuscategory/3",
                "id": 3,
                "key": "done",
                "colorName": "green",
                "name": "Done"
            }
        },
        "components": [
            {
                "self": "https://issues.apache.org/jira/rest/api/2/component/12328935",
                "id": "12328935",
                "name": "C++"
            }
        ],
        "customfield_12312026": null,
        "customfield_12312023": null,
        "customfield_12312024": null,
        "aggregatetimeestimate": 0,
        "customfield_12312022": null,
        "customfield_12310921": null,
        "customfield_12310920": "9223372036854775807",
        "customfield_12312823": null,
        "creator": {
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=apitrou",
            "name": "apitrou",
            "key": "pitrou",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=pitrou&avatarId=35049",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=pitrou&avatarId=35049",
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=pitrou&avatarId=35049",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=pitrou&avatarId=35049"
            },
            "displayName": "Antoine Pitrou",
            "active": true,
            "timeZone": "Europe/Paris"
        },
        "subtasks": [],
        "reporter": {
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=apitrou",
            "name": "apitrou",
            "key": "pitrou",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=pitrou&avatarId=35049",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=pitrou&avatarId=35049",
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=pitrou&avatarId=35049",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=pitrou&avatarId=35049"
            },
            "displayName": "Antoine Pitrou",
            "active": true,
            "timeZone": "Europe/Paris"
        },
        "aggregateprogress": {
            "progress": 3000,
            "total": 3000,
            "percent": 100
        },
        "customfield_12313520": null,
        "customfield_12310250": null,
        "progress": {
            "progress": 3000,
            "total": 3000,
            "percent": 100
        },
        "customfield_12313924": null,
        "votes": {
            "self": "https://issues.apache.org/jira/rest/api/2/issue/ARROW-2562/votes",
            "votes": 0,
            "hasVoted": false
        },
        "worklog": {
            "startAt": 0,
            "maxResults": 20,
            "total": 5,
            "worklogs": [
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13158177/worklog/100550",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "pitrou opened a new pull request #2023: ARROW-2562: [CI] C++ and Rust code coverage using codecov.io\nURL: https://github.com/apache/arrow/pull/2023\n \n \n   Collect C++ and Rust coverage info on Travis-CI build, and upload it to codecov.io.\r\n   The C++ coverage info is gathered from both the C++ and Python test suites.\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2018-05-10T11:06:59.230+0000",
                    "updated": "2018-05-10T11:06:59.230+0000",
                    "started": "2018-05-10T11:06:59.230+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "100550",
                    "issueId": "13158177"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13158177/worklog/100551",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "pitrou commented on issue #2023: ARROW-2562: [CI] C++ and Rust code coverage using codecov.io\nURL: https://github.com/apache/arrow/pull/2023#issuecomment-388023775\n \n \n   This probably needs an Apache Arrow account on codecov.io.\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2018-05-10T11:07:18.153+0000",
                    "updated": "2018-05-10T11:07:18.153+0000",
                    "started": "2018-05-10T11:07:18.152+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "100551",
                    "issueId": "13158177"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13158177/worklog/100572",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "pitrou commented on issue #2023: ARROW-2562: [CI] C++ and Rust code coverage using codecov.io\nURL: https://github.com/apache/arrow/pull/2023#issuecomment-388023775\n \n \n   This probably needs an Apache Arrow account on codecov.io. Edit: doesn't, or the account already exists, as can be seen in https://codecov.io/gh/apache/arrow/list/8804ab50118f46139986acc435d740cb536f08f4/\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2018-05-10T11:58:12.498+0000",
                    "updated": "2018-05-10T11:58:12.498+0000",
                    "started": "2018-05-10T11:58:12.497+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "100572",
                    "issueId": "13158177"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13158177/worklog/100629",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "xhochy commented on issue #2023: ARROW-2562: [CI] C++ and Rust code coverage using codecov.io\nURL: https://github.com/apache/arrow/pull/2023#issuecomment-388078781\n \n \n   Nice, feel free to merge this. We should close https://github.com/apache/arrow/pull/1241 then.\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2018-05-10T14:56:01.230+0000",
                    "updated": "2018-05-10T14:56:01.230+0000",
                    "started": "2018-05-10T14:56:01.229+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "100629",
                    "issueId": "13158177"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13158177/worklog/100637",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "pitrou closed pull request #2023: ARROW-2562: [CI] C++ and Rust code coverage using codecov.io\nURL: https://github.com/apache/arrow/pull/2023\n \n \n   \n\nThis is a PR merged from a forked repository.\nAs GitHub hides the original diff on merge, it is displayed below for\nthe sake of provenance:\n\nAs this is a foreign pull request (from a fork), the diff is supplied\nbelow (as it won't show otherwise due to GitHub magic):\n\ndiff --git a/.travis.yml b/.travis.yml\nindex b4ec6ff1aa..e91d7b166a 100644\n--- a/.travis.yml\n+++ b/.travis.yml\n@@ -52,6 +52,7 @@ matrix:\n     - ARROW_TRAVIS_PLASMA=1\n     - ARROW_TRAVIS_ORC=1\n     - ARROW_TRAVIS_CLANG_FORMAT=1\n+    - ARROW_TRAVIS_COVERAGE=1\n     - ARROW_TRAVIS_PYTHON_BENCHMARKS=1\n     - ARROW_TRAVIS_PYTHON_DOCS=1\n     - ARROW_BUILD_WARNING_LEVEL=CHECKIN\n@@ -68,10 +69,12 @@ matrix:\n     # If either C++ or Python changed, we must install the C++ libraries\n     - $TRAVIS_BUILD_DIR/ci/travis_before_script_cpp.sh\n     script:\n-    - if [ $ARROW_CI_CPP_AFFECTED == \"1\" ]; then $TRAVIS_BUILD_DIR/ci/travis_script_cpp.sh; fi\n+    # All test steps are required for accurate C++ coverage info\n+    - $TRAVIS_BUILD_DIR/ci/travis_script_cpp.sh\n     - $TRAVIS_BUILD_DIR/ci/travis_build_parquet_cpp.sh\n     - $TRAVIS_BUILD_DIR/ci/travis_script_python.sh 2.7\n     - $TRAVIS_BUILD_DIR/ci/travis_script_python.sh 3.6\n+    - $TRAVIS_BUILD_DIR/ci/travis_upload_cpp_coverage.sh\n   # [OS X] C++ & Python w/ XCode 6.4\n   - compiler: clang\n     language: cpp\n@@ -178,6 +181,7 @@ matrix:\n     - $TRAVIS_BUILD_DIR/ci/travis_before_script_c_glib.sh\n     script:\n     - $TRAVIS_BUILD_DIR/ci/travis_script_c_glib.sh\n+  # Rust\n   - language: rust\n     cache: cargo\n     rust: stable\n@@ -197,7 +201,11 @@ matrix:\n     - $TRAVIS_BUILD_DIR/ci/travis_script_rust.sh\n     after_success:\n     - pushd ${TRAVIS_BUILD_DIR}/rust\n-    - cargo coveralls --verbose\n+    # Run coverage for codecov.io\n+    - RUST_BACKTRACE=1 cargo coverage --verbose\n+    - bash <(curl -s https://codecov.io/bash) || echo \"Codecov did not collect coverage reports\"\n+    # Run coverage for coveralls.io\n+    #- cargo coveralls --verbose\n \n after_failure:\n - COREFILE=$(find . -maxdepth 2 -name \"core*\" | head -n 1)\ndiff --git a/ci/travis_before_script_cpp.sh b/ci/travis_before_script_cpp.sh\nindex b9afbee786..379007d5bf 100755\n--- a/ci/travis_before_script_cpp.sh\n+++ b/ci/travis_before_script_cpp.sh\n@@ -17,7 +17,6 @@\n # specific language governing permissions and limitations\n # under the License.\n \n-\n set -ex\n \n source $TRAVIS_BUILD_DIR/ci/travis_env_common.sh\n@@ -83,6 +82,10 @@ if [ $ARROW_TRAVIS_VALGRIND == \"1\" ]; then\n   CMAKE_COMMON_FLAGS=\"$CMAKE_COMMON_FLAGS -DARROW_TEST_MEMCHECK=ON\"\n fi\n \n+if [ $ARROW_TRAVIS_COVERAGE == \"1\" ]; then\n+  CMAKE_COMMON_FLAGS=\"$CMAKE_COMMON_FLAGS -DARROW_GENERATE_COVERAGE=ON\"\n+fi\n+\n if [ $TRAVIS_OS_NAME == \"linux\" ]; then\n     cmake $CMAKE_COMMON_FLAGS \\\n           $CMAKE_LINUX_FLAGS \\\ndiff --git a/ci/travis_env_common.sh b/ci/travis_env_common.sh\nindex c8c19ed5b6..a4ae5bd271 100755\n--- a/ci/travis_env_common.sh\n+++ b/ci/travis_env_common.sh\n@@ -29,6 +29,10 @@ export ARROW_JS_DIR=${TRAVIS_BUILD_DIR}/js\n export ARROW_INTEGRATION_DIR=$TRAVIS_BUILD_DIR/integration\n export ARROW_RUST_DIR=${TRAVIS_BUILD_DIR}/rust\n \n+if [ $ARROW_TRAVIS_COVERAGE == \"1\" ]; then\n+    export ARROW_CPP_COVERAGE_FILE=${TRAVIS_BUILD_DIR}/coverage.info\n+fi\n+\n export CPP_BUILD_DIR=$TRAVIS_BUILD_DIR/cpp-build\n \n export ARROW_CPP_INSTALL=$TRAVIS_BUILD_DIR/cpp-install\ndiff --git a/ci/travis_install_linux.sh b/ci/travis_install_linux.sh\nindex 74fde27741..b1e21ea8d6 100755\n--- a/ci/travis_install_linux.sh\n+++ b/ci/travis_install_linux.sh\n@@ -24,3 +24,7 @@ sudo apt-get install -y -q \\\n if [ \"$ARROW_TRAVIS_VALGRIND\" == \"1\" ]; then\n     sudo apt-get install -y -q valgrind\n fi\n+\n+if [ $ARROW_TRAVIS_COVERAGE == \"1\" ]; then\n+    sudo apt-get install -y -q lcov\n+fi\ndiff --git a/ci/travis_install_toolchain.sh b/ci/travis_install_toolchain.sh\nindex 31076b2e73..a153d893dd 100755\n--- a/ci/travis_install_toolchain.sh\n+++ b/ci/travis_install_toolchain.sh\n@@ -23,7 +23,7 @@ source $TRAVIS_BUILD_DIR/ci/travis_install_conda.sh\n \n if [ ! -e $CPP_TOOLCHAIN ]; then\n     # Set up C++ toolchain from conda-forge packages for faster builds\n-    conda create -y -q -p $CPP_TOOLCHAIN python=2.7 \\\n+    conda create -y -q -p $CPP_TOOLCHAIN python=3.6 \\\n         nomkl \\\n         boost-cpp \\\n         libprotobuf \\\ndiff --git a/ci/travis_script_cpp.sh b/ci/travis_script_cpp.sh\nindex 455a6766f9..02e58cd72c 100755\n--- a/ci/travis_script_cpp.sh\n+++ b/ci/travis_script_cpp.sh\n@@ -26,3 +26,10 @@ pushd $CPP_BUILD_DIR\n ctest -j2 --output-on-failure -L unittest\n \n popd\n+\n+# Capture C++ coverage info (we wipe the build dir in travis_script_python.sh)\n+if [ $ARROW_TRAVIS_COVERAGE == \"1\" ]; then\n+    pushd $TRAVIS_BUILD_DIR\n+    lcov --quiet --directory . --capture --no-external --output-file $ARROW_CPP_COVERAGE_FILE\n+    popd\n+fi\ndiff --git a/ci/travis_script_python.sh b/ci/travis_script_python.sh\nindex 5177a6c622..aaca3fdba6 100755\n--- a/ci/travis_script_python.sh\n+++ b/ci/travis_script_python.sh\n@@ -52,15 +52,23 @@ conda install -y -q pip \\\n #   conda install -y -q pytorch torchvision -c soumith\n # fi\n \n-# Build C++ libraries\n+# Re-build C++ libraries with the right Python setup\n mkdir -p $ARROW_CPP_BUILD_DIR\n pushd $ARROW_CPP_BUILD_DIR\n \n # Clear out prior build files\n rm -rf *\n \n+# XXX Can we simply reuse CMAKE_COMMON_FLAGS from travis_before_script_cpp.sh?\n+CMAKE_COMMON_FLAGS=\"-DARROW_EXTRA_ERROR_CONTEXT=ON\"\n+\n+if [ $ARROW_TRAVIS_COVERAGE == \"1\" ]; then\n+  CMAKE_COMMON_FLAGS=\"$CMAKE_COMMON_FLAGS -DARROW_GENERATE_COVERAGE=ON\"\n+fi\n+\n cmake -GNinja \\\n-      -DARROW_BUILD_TESTS=off \\\n+      $CMAKE_COMMON_FLAGS \\\n+      -DARROW_BUILD_TESTS=on \\\n       -DARROW_BUILD_UTILITIES=off \\\n       -DARROW_PLASMA=on \\\n       -DARROW_PYTHON=on \\\n@@ -74,6 +82,9 @@ ninja install\n \n popd\n \n+# python-test isn't run by travis_script_cpp.sh, exercise it here\n+$ARROW_CPP_BUILD_DIR/$ARROW_BUILD_TYPE/python-test\n+\n # Other stuff pip install\n pushd $ARROW_PYTHON_DIR\n \n@@ -107,6 +118,17 @@ fi\n PYARROW_PATH=$CONDA_PREFIX/lib/python$PYTHON_VERSION/site-packages/pyarrow\n python -m pytest -r sxX --durations=15 $PYARROW_PATH --parquet\n \n+# Capture C++ coverage info and combine with previous coverage file\n+if [ $ARROW_TRAVIS_COVERAGE == \"1\" ]; then\n+    pushd $TRAVIS_BUILD_DIR\n+    lcov --quiet --directory . --capture --no-external --output-file coverage-python-tests.info\n+    lcov --add-tracefile coverage-python-tests.info \\\n+        --add-tracefile $ARROW_CPP_COVERAGE_FILE \\\n+        --output-file $ARROW_CPP_COVERAGE_FILE\n+    rm coverage-python-tests.info\n+    popd\n+fi\n+\n if [ \"$ARROW_TRAVIS_PYTHON_DOCS\" == \"1\" ] && [ \"$PYTHON_VERSION\" == \"3.6\" ]; then\n   # Build documentation once\n   conda install -y -q \\\ndiff --git a/ci/travis_upload_cpp_coverage.sh b/ci/travis_upload_cpp_coverage.sh\nnew file mode 100755\nindex 0000000000..20b7e1bdd0\n--- /dev/null\n+++ b/ci/travis_upload_cpp_coverage.sh\n@@ -0,0 +1,31 @@\n+#!/usr/bin/env bash\n+\n+# Licensed to the Apache Software Foundation (ASF) under one\n+# or more contributor license agreements.  See the NOTICE file\n+# distributed with this work for additional information\n+# regarding copyright ownership.  The ASF licenses this file\n+# to you under the Apache License, Version 2.0 (the\n+# \"License\"); you may not use this file except in compliance\n+# with the License.  You may obtain a copy of the License at\n+#\n+#   http://www.apache.org/licenses/LICENSE-2.0\n+#\n+# Unless required by applicable law or agreed to in writing,\n+# software distributed under the License is distributed on an\n+# \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+# KIND, either express or implied.  See the License for the\n+# specific language governing permissions and limitations\n+# under the License.\n+\n+set -e\n+\n+source $TRAVIS_BUILD_DIR/ci/travis_env_common.sh\n+\n+pushd $TRAVIS_BUILD_DIR\n+\n+# Display summary\n+lcov --list $ARROW_CPP_COVERAGE_FILE\n+# Upload report to CodeCov\n+bash <(curl -s https://codecov.io/bash) || echo \"Codecov did not collect coverage reports\"\n+\n+popd\ndiff --git a/cpp/src/plasma/test/client_tests.cc b/cpp/src/plasma/test/client_tests.cc\nindex 53743cad2d..547a749556 100644\n--- a/cpp/src/plasma/test/client_tests.cc\n+++ b/cpp/src/plasma/test/client_tests.cc\n@@ -22,7 +22,9 @@\n #include <sys/types.h>\n #include <unistd.h>\n \n+#include <chrono>\n #include <random>\n+#include <thread>\n \n #include \"arrow/test-util.h\"\n \n@@ -67,7 +69,13 @@ class TestPlasmaStore : public ::testing::Test {\n     ARROW_CHECK_OK(client2_.Disconnect());\n     // Kill all plasma_store processes\n     // TODO should only kill the processes we launched\n-    system(\"killall -9 plasma_store\");\n+#ifdef COVERAGE_BUILD\n+    // Ask plasma_store to exit gracefully and give it time to write out\n+    // coverage files\n+    system(\"killall -TERM plasma_store\");\n+    std::this_thread::sleep_for(std::chrono::milliseconds(200));\n+#endif\n+    system(\"killall -KILL plasma_store\");\n   }\n \n   void CreateObject(PlasmaClient& client, const ObjectID& object_id,\ndiff --git a/python/pyarrow/tests/test_plasma.py b/python/pyarrow/tests/test_plasma.py\nindex 1589c1bb30..de11eb6e5f 100644\n--- a/python/pyarrow/tests/test_plasma.py\n+++ b/python/pyarrow/tests/test_plasma.py\n@@ -25,6 +25,7 @@\n import random\n import shutil\n import signal\n+import sys\n import subprocess\n import tempfile\n import time\n@@ -196,11 +197,13 @@ def teardown_method(self, test_method):\n         try:\n             # Check that the Plasma store is still alive.\n             assert self.p.poll() is None\n-            # Ensure Valgrind detected no issues\n-            if USE_VALGRIND:\n-                self.p.send_signal(signal.SIGTERM)\n+            # Ensure Valgrind and/or coverage have a clean exit\n+            self.p.send_signal(signal.SIGTERM)\n+            if sys.version_info >= (3, 3):\n+                self.p.wait(timeout=5)\n+            else:\n                 self.p.wait()\n-                assert self.p.returncode == 0\n+            assert self.p.returncode == 0\n         finally:\n             self.plasma_store_ctx.__exit__(None, None, None)\n \n\n\n \n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2018-05-10T15:10:27.792+0000",
                    "updated": "2018-05-10T15:10:27.792+0000",
                    "started": "2018-05-10T15:10:27.791+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "100637",
                    "issueId": "13158177"
                }
            ]
        },
        "customfield_12313920": null,
        "issuetype": {
            "self": "https://issues.apache.org/jira/rest/api/2/issuetype/3",
            "id": "3",
            "description": "A task that needs to be done.",
            "iconUrl": "https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21148&avatarType=issuetype",
            "name": "Task",
            "subtask": false,
            "avatarId": 21148
        },
        "timespent": 3000,
        "customfield_12314020": "{summaryBean=com.atlassian.jira.plugin.devstatus.rest.SummaryBean@468047df[summary={pullrequest=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@703e6bbc[overall=PullRequestOverallBean{stateCount=0, state='OPEN', details=PullRequestOverallDetails{openCount=0, mergedCount=0, declinedCount=0}},byInstanceType={}], build=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@15f5cb77[overall=com.atlassian.jira.plugin.devstatus.summary.beans.BuildOverallBean@161521fe[failedBuildCount=0,successfulBuildCount=0,unknownBuildCount=0,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], review=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@5df6834a[overall=com.atlassian.jira.plugin.devstatus.summary.beans.ReviewsOverallBean@72d7f6b2[stateCount=0,state=<null>,dueDate=<null>,overDue=false,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], deployment-environment=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@49c225ec[overall=com.atlassian.jira.plugin.devstatus.summary.beans.DeploymentOverallBean@76e7f7fb[topEnvironments=[],showProjects=false,successfulCount=0,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], repository=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@1fe2d6be[overall=com.atlassian.jira.plugin.devstatus.summary.beans.CommitOverallBean@524dd196[count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], branch=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@a786376[overall=com.atlassian.jira.plugin.devstatus.summary.beans.BranchOverallBean@43e915ed[count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}]},errors=[],configErrors=[]], devSummaryJson={\"cachedValue\":{\"errors\":[],\"configErrors\":[],\"summary\":{\"pullrequest\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"stateCount\":0,\"state\":\"OPEN\",\"details\":{\"openCount\":0,\"mergedCount\":0,\"declinedCount\":0,\"total\":0},\"open\":true},\"byInstanceType\":{}},\"build\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"failedBuildCount\":0,\"successfulBuildCount\":0,\"unknownBuildCount\":0},\"byInstanceType\":{}},\"review\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"stateCount\":0,\"state\":null,\"dueDate\":null,\"overDue\":false,\"completed\":false},\"byInstanceType\":{}},\"deployment-environment\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"topEnvironments\":[],\"showProjects\":false,\"successfulCount\":0},\"byInstanceType\":{}},\"repository\":{\"overall\":{\"count\":0,\"lastUpdated\":null},\"byInstanceType\":{}},\"branch\":{\"overall\":{\"count\":0,\"lastUpdated\":null},\"byInstanceType\":{}}}},\"isStale\":false}}",
        "customfield_12314141": null,
        "customfield_12314140": null,
        "project": {
            "self": "https://issues.apache.org/jira/rest/api/2/project/12319525",
            "id": "12319525",
            "key": "ARROW",
            "name": "Apache Arrow",
            "projectTypeKey": "software",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/projectavatar?pid=12319525&avatarId=10011",
                "24x24": "https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12319525&avatarId=10011",
                "16x16": "https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12319525&avatarId=10011",
                "32x32": "https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12319525&avatarId=10011"
            },
            "projectCategory": {
                "self": "https://issues.apache.org/jira/rest/api/2/projectCategory/13960",
                "id": "13960",
                "description": "Apache Arrow",
                "name": "Arrow"
            }
        },
        "aggregatetimespent": 3000,
        "customfield_12312520": null,
        "customfield_12312521": "Thu May 10 15:10:22 UTC 2018",
        "customfield_12314422": null,
        "customfield_12314421": null,
        "customfield_12314146": null,
        "customfield_12314420": null,
        "customfield_12314145": null,
        "customfield_12314144": null,
        "customfield_12314143": null,
        "resolutiondate": "2018-05-10T15:10:22.000+0000",
        "workratio": -1,
        "customfield_12312923": null,
        "customfield_12312920": null,
        "customfield_12312921": null,
        "watches": {
            "self": "https://issues.apache.org/jira/rest/api/2/issue/ARROW-2562/watchers",
            "watchCount": 1,
            "isWatching": false
        },
        "created": "2018-05-09T12:17:36.000+0000",
        "updated": "2018-05-10T15:10:27.000+0000",
        "timeoriginalestimate": null,
        "description": "ARROW-27 (upload coverage data to coveralls.io) has failed moving forward. We can try codecov.io instead, another free code coverage hosting service.",
        "customfield_10010": null,
        "timetracking": {
            "remainingEstimate": "0h",
            "timeSpent": "50m",
            "remainingEstimateSeconds": 0,
            "timeSpentSeconds": 3000
        },
        "customfield_12314523": null,
        "customfield_12314127": null,
        "customfield_12314522": null,
        "customfield_12314126": null,
        "customfield_12314521": null,
        "customfield_12314125": null,
        "customfield_12314520": null,
        "customfield_12314124": null,
        "attachment": [],
        "customfield_12312340": null,
        "customfield_12314123": null,
        "customfield_12312341": null,
        "customfield_12312220": null,
        "customfield_12314122": null,
        "customfield_12314121": null,
        "customfield_12314120": null,
        "customfield_12314129": null,
        "customfield_12314524": null,
        "customfield_12314128": null,
        "summary": "[C++] Upload coverage data to codecov.io",
        "customfield_12314130": null,
        "customfield_12310291": null,
        "customfield_12310290": null,
        "customfield_12314138": null,
        "customfield_12314137": null,
        "environment": null,
        "customfield_12314136": null,
        "customfield_12314135": null,
        "customfield_12311020": null,
        "customfield_12314134": null,
        "duedate": null,
        "customfield_12314132": null,
        "customfield_12314131": null,
        "comment": {
            "comments": [
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13158177/comment/16469216",
                    "id": "16469216",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=apitrou",
                        "name": "apitrou",
                        "key": "pitrou",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=pitrou&avatarId=35049",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=pitrou&avatarId=35049",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=pitrou&avatarId=35049",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=pitrou&avatarId=35049"
                        },
                        "displayName": "Antoine Pitrou",
                        "active": true,
                        "timeZone": "Europe/Paris"
                    },
                    "body": "Here is an example coverage report. It shows the combined coverage results of running the C++, Python and Rust test suites:\r\n\r\nhttps://codecov.io/gh/pitrou/arrow/list/b143005404c2af16cbb3f40c3f1564c3758f4fdb/\r\n\r\n[~wesmckinn]",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=apitrou",
                        "name": "apitrou",
                        "key": "pitrou",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=pitrou&avatarId=35049",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=pitrou&avatarId=35049",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=pitrou&avatarId=35049",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=pitrou&avatarId=35049"
                        },
                        "displayName": "Antoine Pitrou",
                        "active": true,
                        "timeZone": "Europe/Paris"
                    },
                    "created": "2018-05-09T18:06:25.617+0000",
                    "updated": "2018-05-09T18:06:25.617+0000"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13158177/comment/16470523",
                    "id": "16470523",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=apitrou",
                        "name": "apitrou",
                        "key": "pitrou",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=pitrou&avatarId=35049",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=pitrou&avatarId=35049",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=pitrou&avatarId=35049",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=pitrou&avatarId=35049"
                        },
                        "displayName": "Antoine Pitrou",
                        "active": true,
                        "timeZone": "Europe/Paris"
                    },
                    "body": "Issue resolved by pull request 2023\n[https://github.com/apache/arrow/pull/2023]",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=apitrou",
                        "name": "apitrou",
                        "key": "pitrou",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=pitrou&avatarId=35049",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=pitrou&avatarId=35049",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=pitrou&avatarId=35049",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=pitrou&avatarId=35049"
                        },
                        "displayName": "Antoine Pitrou",
                        "active": true,
                        "timeZone": "Europe/Paris"
                    },
                    "created": "2018-05-10T15:10:22.692+0000",
                    "updated": "2018-05-10T15:10:22.692+0000"
                }
            ],
            "maxResults": 2,
            "total": 2,
            "startAt": 0
        },
        "customfield_12311820": "0|i3tinz:",
        "customfield_12314139": null
    }
}