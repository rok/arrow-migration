{
    "expand": "operations,versionedRepresentations,editmeta,changelog,renderedFields",
    "id": "13375669",
    "self": "https://issues.apache.org/jira/rest/api/2/issue/13375669",
    "key": "ARROW-12592",
    "fields": {
        "fixVersions": [],
        "resolution": {
            "self": "https://issues.apache.org/jira/rest/api/2/resolution/3",
            "id": "3",
            "description": "The problem is a duplicate of an existing issue.",
            "name": "Duplicate"
        },
        "customfield_12312322": null,
        "customfield_12312323": null,
        "customfield_12312320": null,
        "customfield_12310420": "9223372036854775807",
        "customfield_12312321": null,
        "customfield_12312328": null,
        "customfield_12312329": null,
        "customfield_12312326": null,
        "customfield_12310300": null,
        "customfield_12312327": null,
        "customfield_12312324": null,
        "customfield_12312720": null,
        "customfield_12312325": null,
        "lastViewed": null,
        "priority": {
            "self": "https://issues.apache.org/jira/rest/api/2/priority/5",
            "iconUrl": "https://issues.apache.org/jira/images/icons/priorities/trivial.svg",
            "name": "Trivial",
            "id": "5"
        },
        "labels": [
            "pull-request-available"
        ],
        "customfield_12312333": null,
        "customfield_12312334": null,
        "customfield_12313422": "false",
        "customfield_12310310": "0.0",
        "customfield_12312331": null,
        "customfield_12312332": null,
        "aggregatetimeoriginalestimate": null,
        "timeestimate": 0,
        "customfield_12312330": null,
        "versions": [],
        "customfield_12311120": null,
        "customfield_12313826": null,
        "customfield_12312339": null,
        "issuelinks": [
            {
                "id": "12614950",
                "self": "https://issues.apache.org/jira/rest/api/2/issueLink/12614950",
                "type": {
                    "id": "12310361",
                    "name": "Blocked",
                    "inward": "Blocked",
                    "outward": "Blocked",
                    "self": "https://issues.apache.org/jira/rest/api/2/issueLinkType/12310361"
                },
                "inwardIssue": {
                    "id": "13357660",
                    "key": "ARROW-11565",
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13357660",
                    "fields": {
                        "summary": "[C++][Gandiva] Modify upper()/lower() to work with UTF8 and add INIT_CAP function",
                        "status": {
                            "self": "https://issues.apache.org/jira/rest/api/2/status/5",
                            "description": "A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.",
                            "iconUrl": "https://issues.apache.org/jira/images/icons/statuses/resolved.png",
                            "name": "Resolved",
                            "id": "5",
                            "statusCategory": {
                                "self": "https://issues.apache.org/jira/rest/api/2/statuscategory/3",
                                "id": 3,
                                "key": "done",
                                "colorName": "green",
                                "name": "Done"
                            }
                        },
                        "priority": {
                            "self": "https://issues.apache.org/jira/rest/api/2/priority/3",
                            "iconUrl": "https://issues.apache.org/jira/images/icons/priorities/major.svg",
                            "name": "Major",
                            "id": "3"
                        },
                        "issuetype": {
                            "self": "https://issues.apache.org/jira/rest/api/2/issuetype/3",
                            "id": "3",
                            "description": "A task that needs to be done.",
                            "iconUrl": "https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21148&avatarType=issuetype",
                            "name": "Task",
                            "subtask": false,
                            "avatarId": 21148
                        }
                    }
                }
            }
        ],
        "customfield_12313825": null,
        "assignee": {
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=anthonylouis",
            "name": "anthonylouis",
            "key": "anthonylouis",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=anthonylouis&avatarId=46146",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=anthonylouis&avatarId=46146",
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=anthonylouis&avatarId=46146",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=anthonylouis&avatarId=46146"
            },
            "displayName": "Anthony Louis Gotlib Ferreira",
            "active": true,
            "timeZone": "Etc/UTC"
        },
        "customfield_12312337": null,
        "customfield_12313823": null,
        "customfield_12312338": null,
        "customfield_12311920": null,
        "customfield_12313822": null,
        "customfield_12312335": null,
        "customfield_12313821": null,
        "customfield_12312336": null,
        "customfield_12313820": null,
        "status": {
            "self": "https://issues.apache.org/jira/rest/api/2/status/6",
            "description": "The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.",
            "iconUrl": "https://issues.apache.org/jira/images/icons/statuses/closed.png",
            "name": "Closed",
            "id": "6",
            "statusCategory": {
                "self": "https://issues.apache.org/jira/rest/api/2/statuscategory/3",
                "id": 3,
                "key": "done",
                "colorName": "green",
                "name": "Done"
            }
        },
        "components": [
            {
                "self": "https://issues.apache.org/jira/rest/api/2/component/12334626",
                "id": "12334626",
                "name": "C++ - Gandiva"
            }
        ],
        "customfield_12312026": null,
        "customfield_12312023": null,
        "customfield_12312024": null,
        "aggregatetimeestimate": 0,
        "customfield_12312022": null,
        "customfield_12310921": null,
        "customfield_12310920": "9223372036854775807",
        "customfield_12312823": null,
        "creator": {
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=anthonylouis",
            "name": "anthonylouis",
            "key": "anthonylouis",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=anthonylouis&avatarId=46146",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=anthonylouis&avatarId=46146",
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=anthonylouis&avatarId=46146",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=anthonylouis&avatarId=46146"
            },
            "displayName": "Anthony Louis Gotlib Ferreira",
            "active": true,
            "timeZone": "Etc/UTC"
        },
        "subtasks": [],
        "reporter": {
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=anthonylouis",
            "name": "anthonylouis",
            "key": "anthonylouis",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=anthonylouis&avatarId=46146",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=anthonylouis&avatarId=46146",
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=anthonylouis&avatarId=46146",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=anthonylouis&avatarId=46146"
            },
            "displayName": "Anthony Louis Gotlib Ferreira",
            "active": true,
            "timeZone": "Etc/UTC"
        },
        "aggregateprogress": {
            "progress": 3600,
            "total": 3600,
            "percent": 100
        },
        "customfield_12313520": null,
        "customfield_12310250": null,
        "progress": {
            "progress": 3600,
            "total": 3600,
            "percent": 100
        },
        "customfield_12313924": null,
        "votes": {
            "self": "https://issues.apache.org/jira/rest/api/2/issue/ARROW-12592/votes",
            "votes": 0,
            "hasVoted": false
        },
        "worklog": {
            "startAt": 0,
            "maxResults": 20,
            "total": 6,
            "worklogs": [
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13375669/worklog/590689",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "anthonylouisbsb opened a new pull request #10193:\nURL: https://github.com/apache/arrow/pull/10193\n\n\n   The function capitalizes the first letter in each word of a given text.\n\n\n-- \nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2021-04-28T21:33:52.662+0000",
                    "updated": "2021-04-28T21:33:52.662+0000",
                    "started": "2021-04-28T21:33:52.662+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "590689",
                    "issueId": "13375669"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13375669/worklog/590691",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "github-actions[bot] commented on pull request #10193:\nURL: https://github.com/apache/arrow/pull/10193#issuecomment-828794782\n\n\n   https://issues.apache.org/jira/browse/ARROW-12592\n\n\n-- \nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2021-04-28T21:34:21.341+0000",
                    "updated": "2021-04-28T21:34:21.341+0000",
                    "started": "2021-04-28T21:34:21.341+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "590691",
                    "issueId": "13375669"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13375669/worklog/590882",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "projjal commented on a change in pull request #10193:\nURL: https://github.com/apache/arrow/pull/10193#discussion_r622821739\n\n\n\n##########\nFile path: cpp/src/gandiva/gdv_function_stubs.cc\n##########\n@@ -386,6 +389,142 @@ GDV_FN_CAST_VARCHAR_REAL(float64, DoubleType)\n \n #undef GDV_FN_CAST_VARCHAR_INTEGER\n #undef GDV_FN_CAST_VARCHAR_REAL\n+\n+GANDIVA_EXPORT\n+int32_t gdv_fn_utf8_char_length(char c) {\n+  if ((signed char)c >= 0) {  // 1-byte char (0x00 ~ 0x7F)\n+    return 1;\n+  } else if ((c & 0xE0) == 0xC0) {  // 2-byte char\n+    return 2;\n+  } else if ((c & 0xF0) == 0xE0) {  // 3-byte char\n+    return 3;\n+  } else if ((c & 0xF8) == 0xF0) {  // 4-byte char\n+    return 4;\n+  }\n+  // invalid char\n+  return 0;\n+}\n+\n+GANDIVA_EXPORT\n+void gdv_fn_set_error_for_invalid_utf8(int64_t execution_context, char val) {\n+  char const* fmt = \"unexpected byte \\\\%02hhx encountered while decoding utf8 string\";\n+  int size = static_cast<int>(strlen(fmt)) + 64;\n+  char* error = reinterpret_cast<char*>(malloc(size));\n+  snprintf(error, size, fmt, (unsigned char)val);\n+  gdv_fn_context_set_error_msg(execution_context, error);\n+  free(error);\n+}\n+\n+// Checks if the character is a whitespace by its code point. To check the list\n+// of the existent whitespaces characters in UTF8, take a look at this link\n+// https://en.wikipedia.org/wiki/Whitespace_character#Unicode\n+//\n+// The Unicode characters also are divided between categories. This link\n+// https://en.wikipedia.org/wiki/Unicode_character_property#General_Category shows\n+// more information about characters categories.\n+GANDIVA_EXPORT\n+bool gdv_fn_is_codepoint_for_space(uint32_t val) {\n+  auto category = utf8proc_category(val);\n+\n+  return category == utf8proc_category_t::UTF8PROC_CATEGORY_ZS ||\n+         category == utf8proc_category_t::UTF8PROC_CATEGORY_ZL ||\n+         category == utf8proc_category_t::UTF8PROC_CATEGORY_ZP;\n+}\n+\n+// For a given text, initialize the first letter of each word, e.g:\n+//     - \"it is a text str\" -> \"It Is A Text Str\"\n+GANDIVA_EXPORT\n+const char* gdv_fn_initcap_utf8(int64_t context, const char* data, int32_t data_len,\n+                                int32_t* out_len) {\n+  if (data_len == 0) {\n+    *out_len = data_len;\n+    return \"\";\n+  }\n+\n+  // If it is a single-byte character (ASCII), corresponding uppercase is always 1-byte\n+  // long; if it is >= 2 bytes long, uppercase can be at most 4 bytes long, so length of\n+  // the output can be at most twice the length of the input\n+  char* out = reinterpret_cast<char*>(gdv_fn_context_arena_malloc(context, 2 * data_len));\n+  if (out == nullptr) {\n+    gdv_fn_context_set_error_msg(context, \"Could not allocate memory for output string\");\n+    *out_len = 0;\n+    return \"\";\n+  }\n+\n+  int32_t char_len = 0;\n+  int32_t out_char_len = 0;\n+  int32_t out_idx = 0;\n+  uint32_t char_codepoint;\n+  bool last_char_was_space = true;\n+\n+  for (int32_t i = 0; i < data_len; i += char_len) {\n+    char_len = gdv_fn_utf8_char_length(data[i]);\n+    // For single byte characters:\n+    // If it is a lowercase ASCII character, set the output to its corresponding uppercase\n+    // character; else, set the output to the read character\n+    if (char_len == 1) {\n+      char cur = data[i];\n+\n+      if (cur >= 0x61 && cur <= 0x7a && last_char_was_space) {\n+        // 'A' - 'Z' : 0x41 - 0x5a\n+        // 'a' - 'z' : 0x61 - 0x7a\n+        out[out_idx++] = static_cast<char>(cur - 0x20);\n+        last_char_was_space = false;\n+      } else {\n+        // Check if the ASCII character is one of these:\n+        // - space : 0x20\n+        // - character tabulation : 0x9\n+        // - line feed : 0xA\n+        // - line tabulation : 0xB\n+        // - form feed : 0xC\n+        // - carriage return : 0xD\n+        last_char_was_space = cur <= 0x20;\n+        out[out_idx++] = cur;\n+      }\n+      continue;\n+    }\n+\n+    // Control reaches here when we encounter a multibyte character\n+    const auto* in_char = (const uint8_t*)(data + i);\n+\n+    // Decode the multibyte character\n+    bool is_valid_utf8_char =\n+        arrow::util::UTF8Decode((const uint8_t**)&in_char, &char_codepoint);\n+\n+    // If it is an invalid utf8 character, UTF8Decode evaluates to false\n+    if (!is_valid_utf8_char) {\n+      gdv_fn_set_error_for_invalid_utf8(context, data[i]);\n+      *out_len = 0;\n+      return \"\";\n+    }\n+\n+    bool is_char_space = gdv_fn_is_codepoint_for_space(char_codepoint);\n+\n+    int32_t formatted_codepoint;\n+    if (last_char_was_space && !is_char_space) {\n+      // Convert the encoded codepoint to its uppercase codepoint\n+      formatted_codepoint = utf8proc_toupper(char_codepoint);\n+    } else {\n+      // Leave\n+      formatted_codepoint = static_cast<int32_t>(char_codepoint);\n\nReview comment:\n       why extra cast here\n\n\n\n\n-- \nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2021-04-29T08:10:57.310+0000",
                    "updated": "2021-04-29T08:10:57.310+0000",
                    "started": "2021-04-29T08:10:57.309+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "590882",
                    "issueId": "13375669"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13375669/worklog/590946",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "anthonylouisbsb commented on a change in pull request #10193:\nURL: https://github.com/apache/arrow/pull/10193#discussion_r622989639\n\n\n\n##########\nFile path: cpp/src/gandiva/gdv_function_stubs.cc\n##########\n@@ -386,6 +389,142 @@ GDV_FN_CAST_VARCHAR_REAL(float64, DoubleType)\n \n #undef GDV_FN_CAST_VARCHAR_INTEGER\n #undef GDV_FN_CAST_VARCHAR_REAL\n+\n+GANDIVA_EXPORT\n+int32_t gdv_fn_utf8_char_length(char c) {\n+  if ((signed char)c >= 0) {  // 1-byte char (0x00 ~ 0x7F)\n+    return 1;\n+  } else if ((c & 0xE0) == 0xC0) {  // 2-byte char\n+    return 2;\n+  } else if ((c & 0xF0) == 0xE0) {  // 3-byte char\n+    return 3;\n+  } else if ((c & 0xF8) == 0xF0) {  // 4-byte char\n+    return 4;\n+  }\n+  // invalid char\n+  return 0;\n+}\n+\n+GANDIVA_EXPORT\n+void gdv_fn_set_error_for_invalid_utf8(int64_t execution_context, char val) {\n+  char const* fmt = \"unexpected byte \\\\%02hhx encountered while decoding utf8 string\";\n+  int size = static_cast<int>(strlen(fmt)) + 64;\n+  char* error = reinterpret_cast<char*>(malloc(size));\n+  snprintf(error, size, fmt, (unsigned char)val);\n+  gdv_fn_context_set_error_msg(execution_context, error);\n+  free(error);\n+}\n+\n+// Checks if the character is a whitespace by its code point. To check the list\n+// of the existent whitespaces characters in UTF8, take a look at this link\n+// https://en.wikipedia.org/wiki/Whitespace_character#Unicode\n+//\n+// The Unicode characters also are divided between categories. This link\n+// https://en.wikipedia.org/wiki/Unicode_character_property#General_Category shows\n+// more information about characters categories.\n+GANDIVA_EXPORT\n+bool gdv_fn_is_codepoint_for_space(uint32_t val) {\n+  auto category = utf8proc_category(val);\n+\n+  return category == utf8proc_category_t::UTF8PROC_CATEGORY_ZS ||\n+         category == utf8proc_category_t::UTF8PROC_CATEGORY_ZL ||\n+         category == utf8proc_category_t::UTF8PROC_CATEGORY_ZP;\n+}\n+\n+// For a given text, initialize the first letter of each word, e.g:\n+//     - \"it is a text str\" -> \"It Is A Text Str\"\n+GANDIVA_EXPORT\n+const char* gdv_fn_initcap_utf8(int64_t context, const char* data, int32_t data_len,\n+                                int32_t* out_len) {\n+  if (data_len == 0) {\n+    *out_len = data_len;\n+    return \"\";\n+  }\n+\n+  // If it is a single-byte character (ASCII), corresponding uppercase is always 1-byte\n+  // long; if it is >= 2 bytes long, uppercase can be at most 4 bytes long, so length of\n+  // the output can be at most twice the length of the input\n+  char* out = reinterpret_cast<char*>(gdv_fn_context_arena_malloc(context, 2 * data_len));\n+  if (out == nullptr) {\n+    gdv_fn_context_set_error_msg(context, \"Could not allocate memory for output string\");\n+    *out_len = 0;\n+    return \"\";\n+  }\n+\n+  int32_t char_len = 0;\n+  int32_t out_char_len = 0;\n+  int32_t out_idx = 0;\n+  uint32_t char_codepoint;\n+  bool last_char_was_space = true;\n+\n+  for (int32_t i = 0; i < data_len; i += char_len) {\n+    char_len = gdv_fn_utf8_char_length(data[i]);\n+    // For single byte characters:\n+    // If it is a lowercase ASCII character, set the output to its corresponding uppercase\n+    // character; else, set the output to the read character\n+    if (char_len == 1) {\n+      char cur = data[i];\n+\n+      if (cur >= 0x61 && cur <= 0x7a && last_char_was_space) {\n+        // 'A' - 'Z' : 0x41 - 0x5a\n+        // 'a' - 'z' : 0x61 - 0x7a\n+        out[out_idx++] = static_cast<char>(cur - 0x20);\n+        last_char_was_space = false;\n+      } else {\n+        // Check if the ASCII character is one of these:\n+        // - space : 0x20\n+        // - character tabulation : 0x9\n+        // - line feed : 0xA\n+        // - line tabulation : 0xB\n+        // - form feed : 0xC\n+        // - carriage return : 0xD\n+        last_char_was_space = cur <= 0x20;\n+        out[out_idx++] = cur;\n+      }\n+      continue;\n+    }\n+\n+    // Control reaches here when we encounter a multibyte character\n+    const auto* in_char = (const uint8_t*)(data + i);\n+\n+    // Decode the multibyte character\n+    bool is_valid_utf8_char =\n+        arrow::util::UTF8Decode((const uint8_t**)&in_char, &char_codepoint);\n+\n+    // If it is an invalid utf8 character, UTF8Decode evaluates to false\n+    if (!is_valid_utf8_char) {\n+      gdv_fn_set_error_for_invalid_utf8(context, data[i]);\n+      *out_len = 0;\n+      return \"\";\n+    }\n+\n+    bool is_char_space = gdv_fn_is_codepoint_for_space(char_codepoint);\n+\n+    int32_t formatted_codepoint;\n+    if (last_char_was_space && !is_char_space) {\n+      // Convert the encoded codepoint to its uppercase codepoint\n+      formatted_codepoint = utf8proc_toupper(char_codepoint);\n+    } else {\n+      // Leave\n+      formatted_codepoint = static_cast<int32_t>(char_codepoint);\n\nReview comment:\n       cast removed, I will put the PR changes in the upper/lower PR\n\n\n\n\n-- \nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2021-04-29T12:07:30.646+0000",
                    "updated": "2021-04-29T12:07:30.646+0000",
                    "started": "2021-04-29T12:07:30.645+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "590946",
                    "issueId": "13375669"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13375669/worklog/590956",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "anthonylouisbsb commented on pull request #10193:\nURL: https://github.com/apache/arrow/pull/10193#issuecomment-829200303\n\n\n   The PR will be closed and all the changes will be added in the https://github.com/apache/arrow/pull/10040 PR\n\n\n-- \nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2021-04-29T12:33:47.208+0000",
                    "updated": "2021-04-29T12:33:47.208+0000",
                    "started": "2021-04-29T12:33:47.207+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "590956",
                    "issueId": "13375669"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13375669/worklog/590957",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "anthonylouisbsb closed pull request #10193:\nURL: https://github.com/apache/arrow/pull/10193\n\n\n   \n\n\n-- \nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2021-04-29T12:33:51.803+0000",
                    "updated": "2021-04-29T12:33:51.803+0000",
                    "started": "2021-04-29T12:33:51.802+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "590957",
                    "issueId": "13375669"
                }
            ]
        },
        "customfield_12313920": null,
        "issuetype": {
            "self": "https://issues.apache.org/jira/rest/api/2/issuetype/2",
            "id": "2",
            "description": "A new feature of the product, which has yet to be developed.",
            "iconUrl": "https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21141&avatarType=issuetype",
            "name": "New Feature",
            "subtask": false,
            "avatarId": 21141
        },
        "timespent": 3600,
        "customfield_12314020": "{summaryBean=com.atlassian.jira.plugin.devstatus.rest.SummaryBean@5b32bc31[summary={pullrequest=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@673e0a69[overall=PullRequestOverallBean{stateCount=0, state='OPEN', details=PullRequestOverallDetails{openCount=0, mergedCount=0, declinedCount=0}},byInstanceType={}], build=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@3a7b3e55[overall=com.atlassian.jira.plugin.devstatus.summary.beans.BuildOverallBean@2d811631[failedBuildCount=0,successfulBuildCount=0,unknownBuildCount=0,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], review=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@2d308205[overall=com.atlassian.jira.plugin.devstatus.summary.beans.ReviewsOverallBean@6f2a68d8[stateCount=0,state=<null>,dueDate=<null>,overDue=false,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], deployment-environment=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@c407afe[overall=com.atlassian.jira.plugin.devstatus.summary.beans.DeploymentOverallBean@29d5c5d9[topEnvironments=[],showProjects=false,successfulCount=0,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], repository=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@5c4a4c[overall=com.atlassian.jira.plugin.devstatus.summary.beans.CommitOverallBean@3c0c9e37[count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], branch=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@331494c2[overall=com.atlassian.jira.plugin.devstatus.summary.beans.BranchOverallBean@34686474[count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}]},errors=[],configErrors=[]], devSummaryJson={\"cachedValue\":{\"errors\":[],\"configErrors\":[],\"summary\":{\"pullrequest\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"stateCount\":0,\"state\":\"OPEN\",\"details\":{\"openCount\":0,\"mergedCount\":0,\"declinedCount\":0,\"total\":0},\"open\":true},\"byInstanceType\":{}},\"build\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"failedBuildCount\":0,\"successfulBuildCount\":0,\"unknownBuildCount\":0},\"byInstanceType\":{}},\"review\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"stateCount\":0,\"state\":null,\"dueDate\":null,\"overDue\":false,\"completed\":false},\"byInstanceType\":{}},\"deployment-environment\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"topEnvironments\":[],\"showProjects\":false,\"successfulCount\":0},\"byInstanceType\":{}},\"repository\":{\"overall\":{\"count\":0,\"lastUpdated\":null},\"byInstanceType\":{}},\"branch\":{\"overall\":{\"count\":0,\"lastUpdated\":null},\"byInstanceType\":{}}}},\"isStale\":false}}",
        "customfield_12314141": null,
        "customfield_12314140": null,
        "project": {
            "self": "https://issues.apache.org/jira/rest/api/2/project/12319525",
            "id": "12319525",
            "key": "ARROW",
            "name": "Apache Arrow",
            "projectTypeKey": "software",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/projectavatar?pid=12319525&avatarId=10011",
                "24x24": "https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12319525&avatarId=10011",
                "16x16": "https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12319525&avatarId=10011",
                "32x32": "https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12319525&avatarId=10011"
            },
            "projectCategory": {
                "self": "https://issues.apache.org/jira/rest/api/2/projectCategory/13960",
                "id": "13960",
                "description": "Apache Arrow",
                "name": "Arrow"
            }
        },
        "aggregatetimespent": 3600,
        "customfield_12312520": null,
        "customfield_12312521": "2021-04-28 18:35:49.0",
        "customfield_12314422": null,
        "customfield_12314421": null,
        "customfield_12314146": null,
        "customfield_12314420": null,
        "customfield_12314145": null,
        "customfield_12314144": null,
        "customfield_12314143": null,
        "resolutiondate": "2021-04-30T23:13:46.000+0000",
        "workratio": -1,
        "customfield_12312923": null,
        "customfield_12312920": null,
        "customfield_12312921": null,
        "watches": {
            "self": "https://issues.apache.org/jira/rest/api/2/issue/ARROW-12592/watchers",
            "watchCount": 1,
            "isWatching": false
        },
        "created": "2021-04-28T18:35:49.000+0000",
        "updated": "2021-04-30T23:13:46.000+0000",
        "timeoriginalestimate": null,
        "description": "The function capitalizes the first letter in each word of a given text.",
        "customfield_10010": null,
        "timetracking": {
            "remainingEstimate": "0h",
            "timeSpent": "1h",
            "remainingEstimateSeconds": 0,
            "timeSpentSeconds": 3600
        },
        "customfield_12314523": null,
        "customfield_12314127": null,
        "customfield_12314522": null,
        "customfield_12314126": null,
        "customfield_12314521": null,
        "customfield_12314125": null,
        "customfield_12314520": null,
        "customfield_12314124": null,
        "attachment": [],
        "customfield_12312340": null,
        "customfield_12314123": null,
        "customfield_12312341": null,
        "customfield_12312220": null,
        "customfield_12314122": null,
        "customfield_12314121": null,
        "customfield_12314120": null,
        "customfield_12314129": null,
        "customfield_12314524": null,
        "customfield_12314128": null,
        "summary": "[C++][Gandiva] Implement INIT_CAP function",
        "customfield_12314130": null,
        "customfield_12310291": null,
        "customfield_12310290": null,
        "customfield_12314138": null,
        "customfield_12314137": null,
        "environment": null,
        "customfield_12314136": null,
        "customfield_12314135": null,
        "customfield_12311020": null,
        "customfield_12314134": null,
        "duedate": null,
        "customfield_12314132": null,
        "customfield_12314131": null,
        "comment": {
            "comments": [],
            "maxResults": 0,
            "total": 0,
            "startAt": 0
        },
        "customfield_12311820": "0|z0qk2g:",
        "customfield_12314139": null
    }
}