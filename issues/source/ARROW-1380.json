{
    "expand": "operations,versionedRepresentations,editmeta,changelog,renderedFields",
    "id": "13096259",
    "self": "https://issues.apache.org/jira/rest/api/2/issue/13096259",
    "key": "ARROW-1380",
    "fields": {
        "fixVersions": [
            {
                "self": "https://issues.apache.org/jira/rest/api/2/version/12343066",
                "id": "12343066",
                "description": "",
                "name": "0.11.0",
                "archived": false,
                "released": true,
                "releaseDate": "2018-10-08"
            }
        ],
        "resolution": {
            "self": "https://issues.apache.org/jira/rest/api/2/resolution/1",
            "id": "1",
            "description": "A fix for this issue is checked into the tree and tested.",
            "name": "Fixed"
        },
        "customfield_12312322": null,
        "customfield_12312323": null,
        "customfield_12312320": null,
        "customfield_12310420": "9223372036854775807",
        "customfield_12312321": null,
        "customfield_12312328": null,
        "customfield_12312329": null,
        "customfield_12312326": null,
        "customfield_12310300": null,
        "customfield_12312327": null,
        "customfield_12312324": null,
        "customfield_12312720": null,
        "customfield_12312325": null,
        "lastViewed": null,
        "priority": {
            "self": "https://issues.apache.org/jira/rest/api/2/priority/3",
            "iconUrl": "https://issues.apache.org/jira/images/icons/priorities/major.svg",
            "name": "Major",
            "id": "3"
        },
        "labels": [
            "pull-request-available"
        ],
        "customfield_12312333": null,
        "customfield_12312334": null,
        "customfield_12313422": "false",
        "customfield_12310310": "2.0",
        "customfield_12312331": null,
        "customfield_12312332": null,
        "aggregatetimeoriginalestimate": null,
        "timeestimate": 0,
        "customfield_12312330": null,
        "versions": [],
        "customfield_12311120": null,
        "customfield_12313826": null,
        "customfield_12312339": null,
        "issuelinks": [],
        "customfield_12313825": null,
        "assignee": {
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=lbartnik",
            "name": "lbartnik",
            "key": "lbartnik",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=lbartnik&avatarId=36547",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=lbartnik&avatarId=36547",
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=lbartnik&avatarId=36547",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=lbartnik&avatarId=36547"
            },
            "displayName": "Lukasz Bartnik",
            "active": true,
            "timeZone": "America/Los_Angeles"
        },
        "customfield_12312337": null,
        "customfield_12313823": null,
        "customfield_12312338": null,
        "customfield_12311920": null,
        "customfield_12313822": null,
        "customfield_12312335": null,
        "customfield_12313821": null,
        "customfield_12312336": null,
        "customfield_12313820": null,
        "status": {
            "self": "https://issues.apache.org/jira/rest/api/2/status/5",
            "description": "A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.",
            "iconUrl": "https://issues.apache.org/jira/images/icons/statuses/resolved.png",
            "name": "Resolved",
            "id": "5",
            "statusCategory": {
                "self": "https://issues.apache.org/jira/rest/api/2/statuscategory/3",
                "id": 3,
                "key": "done",
                "colorName": "green",
                "name": "Done"
            }
        },
        "components": [
            {
                "self": "https://issues.apache.org/jira/rest/api/2/component/12332956",
                "id": "12332956",
                "name": "C++ - Plasma"
            }
        ],
        "customfield_12312026": null,
        "customfield_12312023": null,
        "customfield_12312024": null,
        "aggregatetimeestimate": 0,
        "customfield_12312022": null,
        "customfield_12310921": null,
        "customfield_12310920": "9223372036854775807",
        "customfield_12312823": null,
        "creator": {
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=wesm",
            "name": "wesm",
            "key": "wesmckinn",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=wesmckinn&avatarId=29931",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=wesmckinn&avatarId=29931",
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=wesmckinn&avatarId=29931",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=wesmckinn&avatarId=29931"
            },
            "displayName": "Wes McKinney",
            "active": true,
            "timeZone": "America/New_York"
        },
        "subtasks": [],
        "reporter": {
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=wesm",
            "name": "wesm",
            "key": "wesmckinn",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=wesmckinn&avatarId=29931",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=wesmckinn&avatarId=29931",
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=wesmckinn&avatarId=29931",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=wesmckinn&avatarId=29931"
            },
            "displayName": "Wes McKinney",
            "active": true,
            "timeZone": "America/New_York"
        },
        "aggregateprogress": {
            "progress": 7200,
            "total": 7200,
            "percent": 100
        },
        "customfield_12313520": null,
        "customfield_12310250": null,
        "progress": {
            "progress": 7200,
            "total": 7200,
            "percent": 100
        },
        "customfield_12313924": null,
        "votes": {
            "self": "https://issues.apache.org/jira/rest/api/2/issue/ARROW-1380/votes",
            "votes": 0,
            "hasVoted": false
        },
        "worklog": {
            "startAt": 0,
            "maxResults": 20,
            "total": 12,
            "worklogs": [
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13096259/worklog/137232",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "lbartnik opened a new pull request #2466: Fix ARROW-1380\nURL: https://github.com/apache/arrow/pull/2466\n \n \n   ARROW-1380: Fix \"still reachable\" valgrind warnings when PLASMA_VALGRIND=1\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2018-08-23T02:23:11.187+0000",
                    "updated": "2018-08-23T02:23:11.187+0000",
                    "started": "2018-08-23T02:23:11.186+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "137232",
                    "issueId": "13096259"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13096259/worklog/137257",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "kou commented on issue #2466: Fix ARROW-1380\nURL: https://github.com/apache/arrow/pull/2466#issuecomment-415298461\n \n \n   Can you use \"ARROW-1380: Summary...\" format for pull request title?\r\n   See also: https://cwiki.apache.org/confluence/display/ARROW/Contributing+to+Apache+Arrow\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2018-08-23T05:44:40.745+0000",
                    "updated": "2018-08-23T05:44:40.745+0000",
                    "started": "2018-08-23T05:44:40.744+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "137257",
                    "issueId": "13096259"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13096259/worklog/137269",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "codecov-io commented on issue #2466: ARROW-1380: Fix \"still reachable\" valgrind warnings when PLASMA_VALGRIND=1\nURL: https://github.com/apache/arrow/pull/2466#issuecomment-415310028\n \n \n   # [Codecov](https://codecov.io/gh/apache/arrow/pull/2466?src=pr&el=h1) Report\n   > Merging [#2466](https://codecov.io/gh/apache/arrow/pull/2466?src=pr&el=desc) into [master](https://codecov.io/gh/apache/arrow/commit/23045d2b5be37df5cd990f5932576eb701e14b18?src=pr&el=desc) will **increase** coverage by `1.29%`.\n   > The diff coverage is `92.85%`.\n   \n   [![Impacted file tree graph](https://codecov.io/gh/apache/arrow/pull/2466/graphs/tree.svg?token=LpTCFbqVT1&width=650&height=150&src=pr)](https://codecov.io/gh/apache/arrow/pull/2466?src=pr&el=tree)\n   \n   ```diff\n   @@            Coverage Diff             @@\n   ##           master    #2466      +/-   ##\n   ==========================================\n   + Coverage   86.14%   87.44%   +1.29%     \n   ==========================================\n     Files         306      244      -62     \n     Lines       46691    43028    -3663     \n   ==========================================\n   - Hits        40224    37624    -2600     \n   + Misses       6393     5404     -989     \n   + Partials       74        0      -74\n   ```\n   \n   \n   | [Impacted Files](https://codecov.io/gh/apache/arrow/pull/2466?src=pr&el=tree) | Coverage \u0394 | |\n   |---|---|---|\n   | [cpp/src/plasma/events.h](https://codecov.io/gh/apache/arrow/pull/2466/diff?src=pr&el=tree#diff-Y3BwL3NyYy9wbGFzbWEvZXZlbnRzLmg=) | `100% <\u00f8> (\u00f8)` | :arrow_up: |\n   | [cpp/src/plasma/events.cc](https://codecov.io/gh/apache/arrow/pull/2466/diff?src=pr&el=tree#diff-Y3BwL3NyYy9wbGFzbWEvZXZlbnRzLmNj) | `87.5% <100%> (-0.6%)` | :arrow_down: |\n   | [python/pyarrow/tests/test\\_plasma.py](https://codecov.io/gh/apache/arrow/pull/2466/diff?src=pr&el=tree#diff-cHl0aG9uL3B5YXJyb3cvdGVzdHMvdGVzdF9wbGFzbWEucHk=) | `96.31% <100%> (+0.01%)` | :arrow_up: |\n   | [cpp/src/plasma/store.cc](https://codecov.io/gh/apache/arrow/pull/2466/diff?src=pr&el=tree#diff-Y3BwL3NyYy9wbGFzbWEvc3RvcmUuY2M=) | `90.54% <100%> (+0.9%)` | :arrow_up: |\n   | [cpp/src/plasma/malloc.cc](https://codecov.io/gh/apache/arrow/pull/2466/diff?src=pr&el=tree#diff-Y3BwL3NyYy9wbGFzbWEvbWFsbG9jLmNj) | `68.05% <75%> (+0.4%)` | :arrow_up: |\n   | [go/arrow/array/bufferbuilder\\_byte.go](https://codecov.io/gh/apache/arrow/pull/2466/diff?src=pr&el=tree#diff-Z28vYXJyb3cvYXJyYXkvYnVmZmVyYnVpbGRlcl9ieXRlLmdv) | | |\n   | [go/arrow/datatype\\_nested.go](https://codecov.io/gh/apache/arrow/pull/2466/diff?src=pr&el=tree#diff-Z28vYXJyb3cvZGF0YXR5cGVfbmVzdGVkLmdv) | | |\n   | [go/arrow/math/float64\\_sse4\\_amd64.go](https://codecov.io/gh/apache/arrow/pull/2466/diff?src=pr&el=tree#diff-Z28vYXJyb3cvbWF0aC9mbG9hdDY0X3NzZTRfYW1kNjQuZ28=) | | |\n   | [rust/src/util/test\\_util.rs](https://codecov.io/gh/apache/arrow/pull/2466/diff?src=pr&el=tree#diff-cnVzdC9zcmMvdXRpbC90ZXN0X3V0aWwucnM=) | | |\n   | [go/arrow/array/list.go](https://codecov.io/gh/apache/arrow/pull/2466/diff?src=pr&el=tree#diff-Z28vYXJyb3cvYXJyYXkvbGlzdC5nbw==) | | |\n   | ... and [58 more](https://codecov.io/gh/apache/arrow/pull/2466/diff?src=pr&el=tree-more) | |\n   \n   ------\n   \n   [Continue to review full report at Codecov](https://codecov.io/gh/apache/arrow/pull/2466?src=pr&el=continue).\n   > **Legend** - [Click here to learn more](https://docs.codecov.io/docs/codecov-delta)\n   > `\u0394 = absolute <relative> (impact)`, `\u00f8 = not affected`, `? = missing data`\n   > Powered by [Codecov](https://codecov.io/gh/apache/arrow/pull/2466?src=pr&el=footer). Last update [23045d2...be8cc6c](https://codecov.io/gh/apache/arrow/pull/2466?src=pr&el=lastupdated). Read the [comment docs](https://docs.codecov.io/docs/pull-request-comments).\n   \n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2018-08-23T06:47:20.099+0000",
                    "updated": "2018-08-23T06:47:20.099+0000",
                    "started": "2018-08-23T06:47:20.098+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "137269",
                    "issueId": "13096259"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13096259/worklog/138069",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "pcmoritz commented on a change in pull request #2466: ARROW-1380: Fix \"still reachable\" valgrind warnings when PLASMA_VALGRIND=1\nURL: https://github.com/apache/arrow/pull/2466#discussion_r212788267\n \n \n\n ##########\n File path: cpp/src/plasma/malloc.cc\n ##########\n @@ -122,6 +122,13 @@ int create_buffer(int64_t size) {\n       return -1;\n     }\n   }\n+  int ret = dup(fd);\n \n Review comment:\n   Can you describe why this is needed?\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2018-08-25T04:17:19.828+0000",
                    "updated": "2018-08-25T04:17:19.828+0000",
                    "started": "2018-08-25T04:17:19.827+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "138069",
                    "issueId": "13096259"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13096259/worklog/138072",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "lbartnik commented on a change in pull request #2466: ARROW-1380: Fix \"still reachable\" valgrind warnings when PLASMA_VALGRIND=1\nURL: https://github.com/apache/arrow/pull/2466#discussion_r212789376\n \n \n\n ##########\n File path: cpp/src/plasma/malloc.cc\n ##########\n @@ -122,6 +122,13 @@ int create_buffer(int64_t size) {\n       return -1;\n     }\n   }\n+  int ret = dup(fd);\n \n Review comment:\n   Sure. `file` needs to be closed, otherwise it is a memory leak. Closing it closes the descriptor `fd` but the descriptor is what this function is supposed to return. So we need a copy, close `file` and thus `fd`, and return the copy.\r\n   The real question is: why do we even need `file`? But there's a check based on that stream so I assume there is a good reason.\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2018-08-25T05:31:20.731+0000",
                    "updated": "2018-08-25T05:31:20.731+0000",
                    "started": "2018-08-25T05:31:20.730+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "138072",
                    "issueId": "13096259"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13096259/worklog/138476",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "pitrou commented on a change in pull request #2466: ARROW-1380: [Plasma] Fix \"still reachable\" valgrind warnings when PLASMA_VALGRIND=1\nURL: https://github.com/apache/arrow/pull/2466#discussion_r213048742\n \n \n\n ##########\n File path: cpp/src/plasma/malloc.cc\n ##########\n @@ -122,6 +122,13 @@ int create_buffer(int64_t size) {\n       return -1;\n     }\n   }\n+  int ret = dup(fd);\n \n Review comment:\n   Yeah, I don't think the `fopen` call is useful. I think you can just call `open` on Unix, and `_open` on Windows (see https://docs.microsoft.com/fr-fr/cpp/c-runtime-library/reference/open-wopen for the latter).\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2018-08-27T17:19:13.526+0000",
                    "updated": "2018-08-27T17:19:13.526+0000",
                    "started": "2018-08-27T17:19:13.525+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "138476",
                    "issueId": "13096259"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13096259/worklog/138486",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "pitrou commented on a change in pull request #2466: ARROW-1380: [Plasma] Fix \"still reachable\" valgrind warnings when PLASMA_VALGRIND=1\nURL: https://github.com/apache/arrow/pull/2466#discussion_r213049350\n \n \n\n ##########\n File path: python/pyarrow/tests/test_plasma.py\n ##########\n @@ -124,6 +125,10 @@ def teardown_method(self, test_method):\n             # Check that the Plasma store is still alive.\n             assert self.p.poll() is None\n             # Ensure Valgrind and/or coverage have a clean exit\n+            # Valgrind misses SIGTERM if it is delivered before the\n+            # event loop is ready; this race condition is mitigated\n+            # but not solved by time.sleep().\n+            time.sleep(1.0)\n \n Review comment:\n   Can this be conditioned on PLASMA_VALGRIND? We don't want to make this test suite slower than this is in the nominal case, IMHO.\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2018-08-27T17:21:55.800+0000",
                    "updated": "2018-08-27T17:21:55.800+0000",
                    "started": "2018-08-27T17:21:55.799+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "138486",
                    "issueId": "13096259"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13096259/worklog/140349",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "lbartnik commented on a change in pull request #2466: ARROW-1380: [Plasma] Fix \"still reachable\" valgrind warnings when PLASMA_VALGRIND=1\nURL: https://github.com/apache/arrow/pull/2466#discussion_r214523839\n \n \n\n ##########\n File path: cpp/src/plasma/malloc.cc\n ##########\n @@ -122,6 +122,13 @@ int create_buffer(int64_t size) {\n       return -1;\n     }\n   }\n+  int ret = dup(fd);\n \n Review comment:\n   IMHO we could remove the call to `fopen` and the related check entirely. The resulting `file` is never used for reading/writing. It seems that replacing `fopen` with `open`/`_open` will give us a duplicate descriptor, and thus we will still have to close one of them: the new one of `fd`. If that's OK, before I replace `fopen` with `open`, could you please tell me why is it needed there in the first place?\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2018-09-01T21:53:42.057+0000",
                    "updated": "2018-09-01T21:53:42.057+0000",
                    "started": "2018-09-01T21:53:42.056+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "140349",
                    "issueId": "13096259"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13096259/worklog/140351",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "lbartnik commented on a change in pull request #2466: ARROW-1380: [Plasma] Fix \"still reachable\" valgrind warnings when PLASMA_VALGRIND=1\nURL: https://github.com/apache/arrow/pull/2466#discussion_r214523900\n \n \n\n ##########\n File path: python/pyarrow/tests/test_plasma.py\n ##########\n @@ -124,6 +125,10 @@ def teardown_method(self, test_method):\n             # Check that the Plasma store is still alive.\n             assert self.p.poll() is None\n             # Ensure Valgrind and/or coverage have a clean exit\n+            # Valgrind misses SIGTERM if it is delivered before the\n+            # event loop is ready; this race condition is mitigated\n+            # but not solved by time.sleep().\n+            time.sleep(1.0)\n \n Review comment:\n   Done.\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2018-09-01T21:57:08.620+0000",
                    "updated": "2018-09-01T21:57:08.620+0000",
                    "started": "2018-09-01T21:57:08.619+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "140351",
                    "issueId": "13096259"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13096259/worklog/140356",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "codecov-io edited a comment on issue #2466: ARROW-1380: [Plasma] Fix \"still reachable\" valgrind warnings when PLASMA_VALGRIND=1\nURL: https://github.com/apache/arrow/pull/2466#issuecomment-415310028\n \n \n   # [Codecov](https://codecov.io/gh/apache/arrow/pull/2466?src=pr&el=h1) Report\n   > Merging [#2466](https://codecov.io/gh/apache/arrow/pull/2466?src=pr&el=desc) into [master](https://codecov.io/gh/apache/arrow/commit/23045d2b5be37df5cd990f5932576eb701e14b18?src=pr&el=desc) will **increase** coverage by `1.3%`.\n   > The diff coverage is `81.81%`.\n   \n   [![Impacted file tree graph](https://codecov.io/gh/apache/arrow/pull/2466/graphs/tree.svg?width=650&token=LpTCFbqVT1&height=150&src=pr)](https://codecov.io/gh/apache/arrow/pull/2466?src=pr&el=tree)\n   \n   ```diff\n   @@            Coverage Diff            @@\n   ##           master    #2466     +/-   ##\n   =========================================\n   + Coverage   86.14%   87.45%   +1.3%     \n   =========================================\n     Files         306      246     -60     \n     Lines       46691    43427   -3264     \n   =========================================\n   - Hits        40224    37978   -2246     \n   + Misses       6393     5449    -944     \n   + Partials       74        0     -74\n   ```\n   \n   \n   | [Impacted Files](https://codecov.io/gh/apache/arrow/pull/2466?src=pr&el=tree) | Coverage \u0394 | |\n   |---|---|---|\n   | [cpp/src/plasma/events.h](https://codecov.io/gh/apache/arrow/pull/2466/diff?src=pr&el=tree#diff-Y3BwL3NyYy9wbGFzbWEvZXZlbnRzLmg=) | `100% <\u00f8> (\u00f8)` | :arrow_up: |\n   | [cpp/src/plasma/events.cc](https://codecov.io/gh/apache/arrow/pull/2466/diff?src=pr&el=tree#diff-Y3BwL3NyYy9wbGFzbWEvZXZlbnRzLmNj) | `87.5% <100%> (-0.6%)` | :arrow_down: |\n   | [python/pyarrow/tests/test\\_plasma.py](https://codecov.io/gh/apache/arrow/pull/2466/diff?src=pr&el=tree#diff-cHl0aG9uL3B5YXJyb3cvdGVzdHMvdGVzdF9wbGFzbWEucHk=) | `96.61% <100%> (+0.31%)` | :arrow_up: |\n   | [cpp/src/plasma/store.cc](https://codecov.io/gh/apache/arrow/pull/2466/diff?src=pr&el=tree#diff-Y3BwL3NyYy9wbGFzbWEvc3RvcmUuY2M=) | `90.04% <66.66%> (+0.4%)` | :arrow_up: |\n   | [cpp/src/plasma/malloc.cc](https://codecov.io/gh/apache/arrow/pull/2466/diff?src=pr&el=tree#diff-Y3BwL3NyYy9wbGFzbWEvbWFsbG9jLmNj) | `68.05% <75%> (+0.4%)` | :arrow_up: |\n   | [cpp/src/arrow/util/thread-pool.h](https://codecov.io/gh/apache/arrow/pull/2466/diff?src=pr&el=tree#diff-Y3BwL3NyYy9hcnJvdy91dGlsL3RocmVhZC1wb29sLmg=) | `85.71% <0%> (-6.6%)` | :arrow_down: |\n   | [cpp/src/plasma/protocol.cc](https://codecov.io/gh/apache/arrow/pull/2466/diff?src=pr&el=tree#diff-Y3BwL3NyYy9wbGFzbWEvcHJvdG9jb2wuY2M=) | `95.36% <0%> (-3.31%)` | :arrow_down: |\n   | [cpp/src/arrow/adapters/orc/adapter.cc](https://codecov.io/gh/apache/arrow/pull/2466/diff?src=pr&el=tree#diff-Y3BwL3NyYy9hcnJvdy9hZGFwdGVycy9vcmMvYWRhcHRlci5jYw==) | `72.98% <0%> (-2.5%)` | :arrow_down: |\n   | [cpp/src/arrow/test-util.h](https://codecov.io/gh/apache/arrow/pull/2466/diff?src=pr&el=tree#diff-Y3BwL3NyYy9hcnJvdy90ZXN0LXV0aWwuaA==) | `76.74% <0%> (-1.56%)` | :arrow_down: |\n   | [cpp/src/plasma/common.cc](https://codecov.io/gh/apache/arrow/pull/2466/diff?src=pr&el=tree#diff-Y3BwL3NyYy9wbGFzbWEvY29tbW9uLmNj) | `93.47% <0%> (-0.97%)` | :arrow_down: |\n   | ... and [82 more](https://codecov.io/gh/apache/arrow/pull/2466/diff?src=pr&el=tree-more) | |\n   \n   ------\n   \n   [Continue to review full report at Codecov](https://codecov.io/gh/apache/arrow/pull/2466?src=pr&el=continue).\n   > **Legend** - [Click here to learn more](https://docs.codecov.io/docs/codecov-delta)\n   > `\u0394 = absolute <relative> (impact)`, `\u00f8 = not affected`, `? = missing data`\n   > Powered by [Codecov](https://codecov.io/gh/apache/arrow/pull/2466?src=pr&el=footer). Last update [23045d2...10672c1](https://codecov.io/gh/apache/arrow/pull/2466?src=pr&el=lastupdated). Read the [comment docs](https://docs.codecov.io/docs/pull-request-comments).\n   \n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2018-09-01T22:27:12.372+0000",
                    "updated": "2018-09-01T22:27:12.372+0000",
                    "started": "2018-09-01T22:27:12.371+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "140356",
                    "issueId": "13096259"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13096259/worklog/143974",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "wesm commented on issue #2466: ARROW-1380: [Plasma] Fix \"still reachable\" valgrind warnings when PLASMA_VALGRIND=1\nURL: https://github.com/apache/arrow/pull/2466#issuecomment-421023377\n \n \n   +1. I am going to rebase and merge this now. Thanks @lbartnik!\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2018-09-13T14:17:19.166+0000",
                    "updated": "2018-09-13T14:17:19.166+0000",
                    "started": "2018-09-13T14:17:19.166+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "143974",
                    "issueId": "13096259"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13096259/worklog/143975",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "wesm closed pull request #2466: ARROW-1380: [Plasma] Fix \"still reachable\" valgrind warnings when PLASMA_VALGRIND=1\nURL: https://github.com/apache/arrow/pull/2466\n \n \n   \n\nThis is a PR merged from a forked repository.\nAs GitHub hides the original diff on merge, it is displayed below for\nthe sake of provenance:\n\nAs this is a foreign pull request (from a fork), the diff is supplied\nbelow (as it won't show otherwise due to GitHub magic):\n\ndiff --git a/cpp/src/plasma/events.cc b/cpp/src/plasma/events.cc\nindex ce29e6c321..44637dad32 100644\n--- a/cpp/src/plasma/events.cc\n+++ b/cpp/src/plasma/events.cc\n@@ -68,10 +68,9 @@ void EventLoop::RemoveFileEvent(int fd) {\n \n void EventLoop::Start() { aeMain(loop_); }\n \n-void EventLoop::Stop() {\n-  aeStop(loop_);\n-  aeDeleteEventLoop(loop_);\n-}\n+void EventLoop::Stop() { aeStop(loop_); }\n+\n+void EventLoop::Shutdown() { aeDeleteEventLoop(loop_); }\n \n int64_t EventLoop::AddTimer(int64_t timeout, const TimerCallback& callback) {\n   auto data = std::unique_ptr<TimerCallback>(new TimerCallback(callback));\ndiff --git a/cpp/src/plasma/events.h b/cpp/src/plasma/events.h\nindex 419c2ebfba..5b697432b2 100644\n--- a/cpp/src/plasma/events.h\n+++ b/cpp/src/plasma/events.h\n@@ -88,6 +88,8 @@ class EventLoop {\n   /// \\brief Stop the event loop\n   void Stop();\n \n+  void Shutdown();\n+\n  private:\n   static void FileEventCallback(aeEventLoop* loop, int fd, void* context, int events);\n \ndiff --git a/cpp/src/plasma/malloc.cc b/cpp/src/plasma/malloc.cc\nindex 3df089288a..32e2a822bb 100644\n--- a/cpp/src/plasma/malloc.cc\n+++ b/cpp/src/plasma/malloc.cc\n@@ -122,6 +122,13 @@ int create_buffer(int64_t size) {\n       return -1;\n     }\n   }\n+  int ret = dup(fd);\n+  if (ret < 0) {\n+    ARROW_LOG(FATAL) << \"failed to dup the descriptor\";\n+  } else {\n+    fclose(file);\n+    fd = ret;\n+  }\n #endif\n   return fd;\n }\ndiff --git a/cpp/src/plasma/store.cc b/cpp/src/plasma/store.cc\nindex 58f8d0193c..a2bf3b0e2c 100644\n--- a/cpp/src/plasma/store.cc\n+++ b/cpp/src/plasma/store.cc\n@@ -857,8 +857,10 @@ class PlasmaStoreRunner {\n     loop_->Start();\n   }\n \n+  void Stop() { loop_->Stop(); }\n+\n   void Shutdown() {\n-    loop_->Stop();\n+    loop_->Shutdown();\n     loop_ = nullptr;\n     store_ = nullptr;\n   }\n@@ -873,10 +875,8 @@ static std::unique_ptr<PlasmaStoreRunner> g_runner = nullptr;\n void HandleSignal(int signal) {\n   if (signal == SIGTERM) {\n     if (g_runner != nullptr) {\n-      g_runner->Shutdown();\n+      g_runner->Stop();\n     }\n-    // Report \"success\" to valgrind.\n-    exit(0);\n   }\n }\n \n@@ -981,4 +981,8 @@ int main(int argc, char* argv[]) {\n   ARROW_LOG(DEBUG) << \"starting server listening on \" << socket_name;\n   plasma::StartServer(socket_name, system_memory, plasma_directory, hugepages_enabled,\n                       use_one_memory_mapped_file);\n+  plasma::g_runner->Shutdown();\n+  plasma::g_runner = nullptr;\n+\n+  return 0;\n }\ndiff --git a/python/pyarrow/tests/test_plasma.py b/python/pyarrow/tests/test_plasma.py\nindex 25102984e2..061acd5593 100644\n--- a/python/pyarrow/tests/test_plasma.py\n+++ b/python/pyarrow/tests/test_plasma.py\n@@ -127,6 +127,11 @@ def teardown_method(self, test_method):\n             # Check that the Plasma store is still alive.\n             assert self.p.poll() is None\n             # Ensure Valgrind and/or coverage have a clean exit\n+            # Valgrind misses SIGTERM if it is delivered before the\n+            # event loop is ready; this race condition is mitigated\n+            # but not solved by time.sleep().\n+            if USE_VALGRIND:\n+                time.sleep(1.0)\n             self.p.send_signal(signal.SIGTERM)\n             if sys.version_info >= (3, 3):\n                 self.p.wait(timeout=5)\n\n\n \n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2018-09-13T14:18:29.870+0000",
                    "updated": "2018-09-13T14:18:29.870+0000",
                    "started": "2018-09-13T14:18:29.870+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "143975",
                    "issueId": "13096259"
                }
            ]
        },
        "customfield_12313920": null,
        "issuetype": {
            "self": "https://issues.apache.org/jira/rest/api/2/issuetype/1",
            "id": "1",
            "description": "A problem which impairs or prevents the functions of the product.",
            "iconUrl": "https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype",
            "name": "Bug",
            "subtask": false,
            "avatarId": 21133
        },
        "timespent": 7200,
        "customfield_12314020": "{summaryBean=com.atlassian.jira.plugin.devstatus.rest.SummaryBean@f76baf4[summary={pullrequest=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@4f9c3d79[overall=PullRequestOverallBean{stateCount=0, state='OPEN', details=PullRequestOverallDetails{openCount=0, mergedCount=0, declinedCount=0}},byInstanceType={}], build=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@13f1a37b[overall=com.atlassian.jira.plugin.devstatus.summary.beans.BuildOverallBean@3da83389[failedBuildCount=0,successfulBuildCount=0,unknownBuildCount=0,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], review=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@50c76464[overall=com.atlassian.jira.plugin.devstatus.summary.beans.ReviewsOverallBean@29b92489[stateCount=0,state=<null>,dueDate=<null>,overDue=false,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], deployment-environment=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@374da0be[overall=com.atlassian.jira.plugin.devstatus.summary.beans.DeploymentOverallBean@4b85f9a5[topEnvironments=[],showProjects=false,successfulCount=0,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], repository=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@208a50f5[overall=com.atlassian.jira.plugin.devstatus.summary.beans.CommitOverallBean@4077b501[count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], branch=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@1ae5b5e1[overall=com.atlassian.jira.plugin.devstatus.summary.beans.BranchOverallBean@7ec92fc9[count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}]},errors=[],configErrors=[]], devSummaryJson={\"cachedValue\":{\"errors\":[],\"configErrors\":[],\"summary\":{\"pullrequest\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"stateCount\":0,\"state\":\"OPEN\",\"details\":{\"openCount\":0,\"mergedCount\":0,\"declinedCount\":0,\"total\":0},\"open\":true},\"byInstanceType\":{}},\"build\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"failedBuildCount\":0,\"successfulBuildCount\":0,\"unknownBuildCount\":0},\"byInstanceType\":{}},\"review\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"stateCount\":0,\"state\":null,\"dueDate\":null,\"overDue\":false,\"completed\":false},\"byInstanceType\":{}},\"deployment-environment\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"topEnvironments\":[],\"showProjects\":false,\"successfulCount\":0},\"byInstanceType\":{}},\"repository\":{\"overall\":{\"count\":0,\"lastUpdated\":null},\"byInstanceType\":{}},\"branch\":{\"overall\":{\"count\":0,\"lastUpdated\":null},\"byInstanceType\":{}}}},\"isStale\":false}}",
        "customfield_12314141": null,
        "customfield_12314140": null,
        "project": {
            "self": "https://issues.apache.org/jira/rest/api/2/project/12319525",
            "id": "12319525",
            "key": "ARROW",
            "name": "Apache Arrow",
            "projectTypeKey": "software",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/projectavatar?pid=12319525&avatarId=10011",
                "24x24": "https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12319525&avatarId=10011",
                "16x16": "https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12319525&avatarId=10011",
                "32x32": "https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12319525&avatarId=10011"
            },
            "projectCategory": {
                "self": "https://issues.apache.org/jira/rest/api/2/projectCategory/13960",
                "id": "13960",
                "description": "Apache Arrow",
                "name": "Arrow"
            }
        },
        "aggregatetimespent": 7200,
        "customfield_12312520": null,
        "customfield_12312521": "Thu Sep 13 14:18:20 UTC 2018",
        "customfield_12314422": null,
        "customfield_12314421": null,
        "customfield_12314146": null,
        "customfield_12314420": null,
        "customfield_12314145": null,
        "customfield_12314144": null,
        "customfield_12314143": null,
        "resolutiondate": "2018-09-13T14:18:20.000+0000",
        "workratio": -1,
        "customfield_12312923": null,
        "customfield_12312920": null,
        "customfield_12312921": null,
        "watches": {
            "self": "https://issues.apache.org/jira/rest/api/2/issue/ARROW-1380/watchers",
            "watchCount": 2,
            "isWatching": false
        },
        "created": "2017-08-20T03:49:16.000+0000",
        "updated": "2018-09-13T14:18:29.000+0000",
        "timeoriginalestimate": null,
        "description": "I thought I fixed this, but they seem to have recurred:\n\nhttps://travis-ci.org/apache/arrow/jobs/266421430#L5220",
        "customfield_10010": null,
        "timetracking": {
            "remainingEstimate": "0h",
            "timeSpent": "2h",
            "remainingEstimateSeconds": 0,
            "timeSpentSeconds": 7200
        },
        "customfield_12314523": null,
        "customfield_12314127": null,
        "customfield_12314522": null,
        "customfield_12314126": null,
        "customfield_12314521": null,
        "customfield_12314125": null,
        "customfield_12314520": null,
        "customfield_12314124": null,
        "attachment": [
            {
                "self": "https://issues.apache.org/jira/rest/api/2/attachment/12935958",
                "id": "12935958",
                "filename": "LastTest.log",
                "author": {
                    "self": "https://issues.apache.org/jira/rest/api/2/user?username=lbartnik",
                    "name": "lbartnik",
                    "key": "lbartnik",
                    "avatarUrls": {
                        "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=lbartnik&avatarId=36547",
                        "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=lbartnik&avatarId=36547",
                        "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=lbartnik&avatarId=36547",
                        "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=lbartnik&avatarId=36547"
                    },
                    "displayName": "Lukasz Bartnik",
                    "active": true,
                    "timeZone": "America/Los_Angeles"
                },
                "created": "2018-08-17T02:22:35.953+0000",
                "size": 231128,
                "mimeType": "text/x-log",
                "content": "https://issues.apache.org/jira/secure/attachment/12935958/LastTest.log"
            },
            {
                "self": "https://issues.apache.org/jira/rest/api/2/attachment/12936363",
                "id": "12936363",
                "filename": "valgrind.supp_",
                "author": {
                    "self": "https://issues.apache.org/jira/rest/api/2/user?username=lbartnik",
                    "name": "lbartnik",
                    "key": "lbartnik",
                    "avatarUrls": {
                        "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=lbartnik&avatarId=36547",
                        "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=lbartnik&avatarId=36547",
                        "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=lbartnik&avatarId=36547",
                        "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=lbartnik&avatarId=36547"
                    },
                    "displayName": "Lukasz Bartnik",
                    "active": true,
                    "timeZone": "America/Los_Angeles"
                },
                "created": "2018-08-21T02:34:06.833+0000",
                "size": 320,
                "mimeType": "application/octet-stream",
                "content": "https://issues.apache.org/jira/secure/attachment/12936363/valgrind.supp_"
            }
        ],
        "customfield_12312340": null,
        "customfield_12314123": null,
        "customfield_12312341": null,
        "customfield_12312220": null,
        "customfield_12314122": null,
        "customfield_12314121": null,
        "customfield_12314120": null,
        "customfield_12314129": null,
        "customfield_12314524": null,
        "customfield_12314128": null,
        "summary": "[C++] Fix \"still reachable\" valgrind warnings when PLASMA_VALGRIND=1",
        "customfield_12314130": null,
        "customfield_12310291": null,
        "customfield_12310290": null,
        "customfield_12314138": null,
        "customfield_12314137": null,
        "environment": null,
        "customfield_12314136": null,
        "customfield_12314135": null,
        "customfield_12311020": null,
        "customfield_12314134": null,
        "duedate": null,
        "customfield_12314132": null,
        "customfield_12314131": null,
        "comment": {
            "comments": [
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13096259/comment/16196420",
                    "id": "16196420",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=wesm",
                        "name": "wesm",
                        "key": "wesmckinn",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=wesmckinn&avatarId=29931",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=wesmckinn&avatarId=29931",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=wesmckinn&avatarId=29931",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=wesmckinn&avatarId=29931"
                        },
                        "displayName": "Wes McKinney",
                        "active": true,
                        "timeZone": "America/New_York"
                    },
                    "body": "I am not sure if these are harmful, but definitely unsightly. I moved off 0.8.0 for now",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=wesm",
                        "name": "wesm",
                        "key": "wesmckinn",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=wesmckinn&avatarId=29931",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=wesmckinn&avatarId=29931",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=wesmckinn&avatarId=29931",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=wesmckinn&avatarId=29931"
                        },
                        "displayName": "Wes McKinney",
                        "active": true,
                        "timeZone": "America/New_York"
                    },
                    "created": "2017-10-09T01:18:07.530+0000",
                    "updated": "2017-10-09T01:18:07.530+0000"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13096259/comment/16583276",
                    "id": "16583276",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=lbartnik",
                        "name": "lbartnik",
                        "key": "lbartnik",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=lbartnik&avatarId=36547",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=lbartnik&avatarId=36547",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=lbartnik&avatarId=36547",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=lbartnik&avatarId=36547"
                        },
                        "displayName": "Lukasz Bartnik",
                        "active": true,
                        "timeZone": "America/Los_Angeles"
                    },
                    "body": "I took a quick look at a recent build ([https://travis-ci.org/apache/arrow/builds/417014924).]\u00a0Neither of its C++ jobs ([https://travis-ci.org/apache/arrow/jobs/417014931]\u00a0and [https://travis-ci.org/apache/arrow/jobs/417014927)]\u00a0seem to use valgrind. The only job that\u00a0seems to use valgrind is the openjdk8/gcc one ([https://travis-ci.org/apache/arrow/jobs/417014925)]\u00a0but there are no reports from valgrind in the log; in fact, valgrind doesn't seem to be used there at all.\r\n\r\nLooking at job descriptions: the original job where \"still reachable\" blocks are reported was a \"gcc C++\" one, but there were two such jobs back then (3786.1 and 3786.8) whereas there's only one now (9492.7).\r\n\r\nIt seem that the error has been fixed between builds 3786 and 9492.\r\n\r\nI'm attaching the LastTest.log which does not contain any valgrind alarms: every \"HEAP SUMMARY\" line is followed by a \"in use at exit: 0 bytes in 0 blocks\" line.",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=lbartnik",
                        "name": "lbartnik",
                        "key": "lbartnik",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=lbartnik&avatarId=36547",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=lbartnik&avatarId=36547",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=lbartnik&avatarId=36547",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=lbartnik&avatarId=36547"
                        },
                        "displayName": "Lukasz Bartnik",
                        "active": true,
                        "timeZone": "America/Los_Angeles"
                    },
                    "created": "2018-08-17T02:21:51.566+0000",
                    "updated": "2018-08-17T02:21:51.566+0000"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13096259/comment/16583408",
                    "id": "16583408",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=wesm",
                        "name": "wesm",
                        "key": "wesmckinn",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=wesmckinn&avatarId=29931",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=wesmckinn&avatarId=29931",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=wesmckinn&avatarId=29931",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=wesmckinn&avatarId=29931"
                        },
                        "displayName": "Wes McKinney",
                        "active": true,
                        "timeZone": "America/New_York"
                    },
                    "body": "The valgrind output for the Python unit tests where this occurs is being suppressed\r\n\r\nsee https://github.com/apache/arrow/pull/1883",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=wesm",
                        "name": "wesm",
                        "key": "wesmckinn",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=wesmckinn&avatarId=29931",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=wesmckinn&avatarId=29931",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=wesmckinn&avatarId=29931",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=wesmckinn&avatarId=29931"
                        },
                        "displayName": "Wes McKinney",
                        "active": true,
                        "timeZone": "America/New_York"
                    },
                    "created": "2018-08-17T05:58:34.712+0000",
                    "updated": "2018-08-17T05:58:34.712+0000"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13096259/comment/16586818",
                    "id": "16586818",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=lbartnik",
                        "name": "lbartnik",
                        "key": "lbartnik",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=lbartnik&avatarId=36547",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=lbartnik&avatarId=36547",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=lbartnik&avatarId=36547",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=lbartnik&avatarId=36547"
                        },
                        "displayName": "Lukasz Bartnik",
                        "active": true,
                        "timeZone": "America/Los_Angeles"
                    },
                    "body": "All Valgrind errors seem to originate in libpython. I re-ran:\r\n\r\n{code}export PLASMA_VALGRIND=1\r\npython \\-m\u00a0pytest\u00a0\\-vv\u00a0\\-r\u00a0sxX\u00a0--durations=15 -s $PYARROW_PATH --parquet{code}\r\n\r\nwith a suppression file aiming at {code}obj:*/libpython3.6m.so*{code} (attached) and all errors\u00a0got\u00a0suppressed. Another way to show it is to extract all suppressions from Valgrind: there are no C++ related context filters among those extracted suppressions.",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=lbartnik",
                        "name": "lbartnik",
                        "key": "lbartnik",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=lbartnik&avatarId=36547",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=lbartnik&avatarId=36547",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=lbartnik&avatarId=36547",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=lbartnik&avatarId=36547"
                        },
                        "displayName": "Lukasz Bartnik",
                        "active": true,
                        "timeZone": "America/Los_Angeles"
                    },
                    "created": "2018-08-21T02:38:59.824+0000",
                    "updated": "2018-08-21T02:43:32.055+0000"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13096259/comment/16587666",
                    "id": "16587666",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=wesm",
                        "name": "wesm",
                        "key": "wesmckinn",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=wesmckinn&avatarId=29931",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=wesmckinn&avatarId=29931",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=wesmckinn&avatarId=29931",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=wesmckinn&avatarId=29931"
                        },
                        "displayName": "Wes McKinney",
                        "active": true,
                        "timeZone": "America/New_York"
                    },
                    "body": "I'm still seeing \"still reachable\" warnings. Note that the thing that is being valgrinded is the Plasma store not the Python process. Sorry that the JIRA was not more clear\r\n\r\n{code}\r\n$ export PLASMA_VALGRIND=1\r\n$ py.test pyarrow/tests/test_plasma.py -s -v\r\n=================================================== test session starts ====================================================\r\nplatform linux -- Python 3.6.5, pytest-3.6.0, py-1.5.3, pluggy-0.6.0 -- /home/wesm/miniconda/envs/arrow-dev/bin/python\r\ncachedir: .pytest_cache\r\nrootdir: /home/wesm/code/arrow/python, inifile: setup.cfg\r\ncollected 24 items                                                                                                         \r\n\r\npyarrow/tests/test_plasma.py::TestPlasmaClient::test_connection_failure_raises_exception ==32111== Memcheck, a memory error detector\r\n==32111== Copyright (C) 2002-2017, and GNU GPL'd, by Julian Seward et al.\r\n==32111== Using Valgrind-3.13.0 and LibVEX; rerun with -h for copyright info\r\n==32111== Command: /home/wesm/code/arrow/python/pyarrow/plasma_store -s /tmp/test_plasma-im2a8xhc/plasma.sock -m 100000000\r\n==32111== \r\nAllowing the Plasma store to use up to 0.1GB of memory.\r\nStarting object store with directory /dev/shm and huge page support disabled\r\nConnection to IPC socket failed for pathname unknown-store-name, retrying 1 more times\r\nPASSED==32111== \r\n==32111== HEAP SUMMARY:\r\n==32111==     in use at exit: 33 bytes in 1 blocks\r\n==32111==   total heap usage: 33 allocs, 32 frees, 129,757 bytes allocated\r\n==32111== \r\n==32111== 33 bytes in 1 blocks are still reachable in loss record 1 of 1\r\n==32111==    at 0x4C3017F: operator new(unsigned long) (in /usr/lib/valgrind/vgpreload_memcheck-amd64-linux.so)\r\n==32111==    by 0x5739BBE: allocate (new_allocator.h:111)\r\n==32111==    by 0x5739BBE: std::string::_Rep::_S_create(unsigned long, unsigned long, std::allocator<char> const&) (basic_string.tcc:1057)\r\n==32111==    by 0x5739D47: std::string::_M_mutate(unsigned long, unsigned long, unsigned long) (basic_string.tcc:929)\r\n==32111==    by 0x573A16B: std::string::_M_replace_safe(unsigned long, unsigned long, char const*, unsigned long) (basic_string.tcc:1134)\r\n==32111==    by 0x47E54D: main (store.cc:937)\r\n==32111== \r\n==32111== LEAK SUMMARY:\r\n==32111==    definitely lost: 0 bytes in 0 blocks\r\n==32111==    indirectly lost: 0 bytes in 0 blocks\r\n==32111==      possibly lost: 0 bytes in 0 blocks\r\n==32111==    still reachable: 33 bytes in 1 blocks\r\n==32111==                       of which reachable via heuristic:\r\n==32111==                         stdstring          : 33 bytes in 1 blocks\r\n==32111==         suppressed: 0 bytes in 0 blocks\r\n==32111== \r\n==32111== For counts of detected and suppressed errors, rerun with: -v\r\n==32111== ERROR SUMMARY: 0 errors from 0 contexts (suppressed: 0 from 0)\r\n{code}",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=wesm",
                        "name": "wesm",
                        "key": "wesmckinn",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=wesmckinn&avatarId=29931",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=wesmckinn&avatarId=29931",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=wesmckinn&avatarId=29931",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=wesmckinn&avatarId=29931"
                        },
                        "displayName": "Wes McKinney",
                        "active": true,
                        "timeZone": "America/New_York"
                    },
                    "created": "2018-08-21T16:14:57.534+0000",
                    "updated": "2018-08-21T16:14:57.534+0000"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13096259/comment/16588313",
                    "id": "16588313",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=lbartnik",
                        "name": "lbartnik",
                        "key": "lbartnik",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=lbartnik&avatarId=36547",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=lbartnik&avatarId=36547",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=lbartnik&avatarId=36547",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=lbartnik&avatarId=36547"
                        },
                        "displayName": "Lukasz Bartnik",
                        "active": true,
                        "timeZone": "America/Los_Angeles"
                    },
                    "body": "The first of these\u00a0warnings could be probably addressed by not calling exit(0) from the signal handler. My impression is that after a signal is caught and exit() is called, main() never returns, and thus destructors for its local objects are not called. Below is the valgrind warning in question.\r\n\r\n{code:java}\r\n==1990== 33 bytes in 1 blocks are still reachable in loss record 1 of 2\r\n==1990== at 0x4C3017F: operator new(unsigned long) (in /usr/lib/valgrind/vgpreload_memcheck-amd64-linux.so)\r\n==1990== by 0x513088C: std::string::_Rep::_S_create(unsigned long, unsigned long, std::allocator<char> const&) (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.25)\r\n==1990== by 0x5130C55: std::string::_M_mutate(unsigned long, unsigned long, unsigned long) (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.25)\r\n==1990== by 0x5131321: std::string::_M_replace_safe(unsigned long, unsigned long, char const*, unsigned long) (in /usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.25)\r\n==1990== by 0x198A23: main (store.cc:937)\r\n{code}\r\n\r\nWith changes as in https://github.com/lbartnik/arrow/commit/089153d518c081d7b9c1b3fb839463bca9ac1a35 I can reduce warnings to\u00a0the one below. Looking at the code it's not clear if CreateObject() should be paired with a delete operation of if there is an internal pool/tracking mechanism.\r\n\r\n{code}\r\npyarrow/tests/test_plasma.py::TestPlasmaClient::test_put_and_get command:  valgrind --track-origins=yes --leak-check=full --show-leak-kinds=all --leak-check-heuristics=stdstring --error-exitcode=1 /io/arrow/python/pyarrow/plasma_store_server -s /tmp/test_plasma-k6wtcvi4/plasma.sock -m 100000000\r\n==575== Memcheck, a memory error detector\r\n==575== Copyright (C) 2002-2017, and GNU GPL'd, by Julian Seward et al.\r\n==575== Using Valgrind-3.13.0 and LibVEX; rerun with -h for copyright info\r\n==575== Command: /io/arrow/python/pyarrow/plasma_store_server -s /tmp/test_plasma-k6wtcvi4/plasma.sock -m 100000000\r\n==575== \r\nAllowing the Plasma store to use up to 0.1GB of memory.\r\nStarting object store with directory /dev/shm and huge page support disabled\r\nPASSED==575== \r\n==575== HEAP SUMMARY:\r\n==575==     in use at exit: 552 bytes in 1 blocks\r\n==575==   total heap usage: 178 allocs, 177 frees, 143,037 bytes allocated\r\n==575== \r\n==575== 552 bytes in 1 blocks are still reachable in loss record 1 of 1\r\n==575==    at 0x4C2FB0F: malloc (in /usr/lib/valgrind/vgpreload_memcheck-amd64-linux.so)\r\n==575==    by 0x567F5F7: fdopen@@GLIBC_2.2.5 (iofdopen.c:122)\r\n==575==    by 0x1BD47F: create_buffer(long) (malloc.cc:105)\r\n==575==    by 0x1BFF17: fake_mmap (malloc.cc:135)\r\n==575==    by 0x1C077B: sys_alloc (dlmalloc.c:4155)\r\n==575==    by 0x1C077B: dlmalloc (dlmalloc.c:4680)\r\n==575==    by 0x1C2850: internal_memalign.constprop.98 (dlmalloc.c:4917)\r\n==575==    by 0x19391A: plasma::PlasmaStore::CreateObject(plasma::UniqueID const&, long, long, int, plasma::Client*, plasma::PlasmaObject*) (store.cc:178)\r\n==575==    by 0x197337: plasma::PlasmaStore::ProcessMessage(plasma::Client*) (store.cc:740)\r\n==575==    by 0x195E02: plasma::PlasmaStore::ConnectClient(int)::{lambda(int)#1}::operator()(int) const (store.cc:544)\r\n==575==    by 0x19927B: std::_Function_handler<void (int), plasma::PlasmaStore::ConnectClient(int)::{lambda(int)#1}>::_M_invoke(std::_Any_data const&, int&&) (std_function.h:297)\r\n==575==    by 0x1B75FD: std::function<void (int)>::operator()(int) const (std_function.h:687)\r\n==575==    by 0x1B6F4E: plasma::EventLoop::FileEventCallback(aeEventLoop*, int, void*, int) (events.cc:28)\r\n==575== \r\n==575== LEAK SUMMARY:\r\n==575==    definitely lost: 0 bytes in 0 blocks\r\n==575==    indirectly lost: 0 bytes in 0 blocks\r\n==575==      possibly lost: 0 bytes in 0 blocks\r\n==575==    still reachable: 552 bytes in 1 blocks\r\n==575==         suppressed: 0 bytes in 0 blocks\r\n==575== \r\n==575== For counts of detected and suppressed errors, rerun with: -v\r\n==575== ERROR SUMMARY: 0 errors from 0 contexts (suppressed: 0 from 0)\r\n{code}",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=lbartnik",
                        "name": "lbartnik",
                        "key": "lbartnik",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=lbartnik&avatarId=36547",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=lbartnik&avatarId=36547",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=lbartnik&avatarId=36547",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=lbartnik&avatarId=36547"
                        },
                        "displayName": "Lukasz Bartnik",
                        "active": true,
                        "timeZone": "America/Los_Angeles"
                    },
                    "created": "2018-08-22T03:01:15.473+0000",
                    "updated": "2018-08-22T08:48:51.217+0000"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13096259/comment/16613559",
                    "id": "16613559",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=wesm",
                        "name": "wesm",
                        "key": "wesmckinn",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=wesmckinn&avatarId=29931",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=wesmckinn&avatarId=29931",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=wesmckinn&avatarId=29931",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=wesmckinn&avatarId=29931"
                        },
                        "displayName": "Wes McKinney",
                        "active": true,
                        "timeZone": "America/New_York"
                    },
                    "body": "Issue resolved by pull request 2466\n[https://github.com/apache/arrow/pull/2466]",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=wesm",
                        "name": "wesm",
                        "key": "wesmckinn",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=wesmckinn&avatarId=29931",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=wesmckinn&avatarId=29931",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=wesmckinn&avatarId=29931",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=wesmckinn&avatarId=29931"
                        },
                        "displayName": "Wes McKinney",
                        "active": true,
                        "timeZone": "America/New_York"
                    },
                    "created": "2018-09-13T14:18:20.999+0000",
                    "updated": "2018-09-13T14:18:20.999+0000"
                }
            ],
            "maxResults": 7,
            "total": 7,
            "startAt": 0
        },
        "customfield_12311820": "0|i3j28f:",
        "customfield_12314139": null
    }
}