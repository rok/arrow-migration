{
    "expand": "operations,versionedRepresentations,editmeta,changelog,renderedFields",
    "id": "13413604",
    "self": "https://issues.apache.org/jira/rest/api/2/issue/13413604",
    "key": "ARROW-14817",
    "fields": {
        "parent": {
            "id": "13413587",
            "key": "ARROW-14806",
            "self": "https://issues.apache.org/jira/rest/api/2/issue/13413587",
            "fields": {
                "summary": "[R] Implement bindings for lubridate component extraction functions",
                "status": {
                    "self": "https://issues.apache.org/jira/rest/api/2/status/5",
                    "description": "A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.",
                    "iconUrl": "https://issues.apache.org/jira/images/icons/statuses/resolved.png",
                    "name": "Resolved",
                    "id": "5",
                    "statusCategory": {
                        "self": "https://issues.apache.org/jira/rest/api/2/statuscategory/3",
                        "id": 3,
                        "key": "done",
                        "colorName": "green",
                        "name": "Done"
                    }
                },
                "priority": {
                    "self": "https://issues.apache.org/jira/rest/api/2/priority/3",
                    "iconUrl": "https://issues.apache.org/jira/images/icons/priorities/major.svg",
                    "name": "Major",
                    "id": "3"
                },
                "issuetype": {
                    "self": "https://issues.apache.org/jira/rest/api/2/issuetype/2",
                    "id": "2",
                    "description": "A new feature of the product, which has yet to be developed.",
                    "iconUrl": "https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21141&avatarType=issuetype",
                    "name": "New Feature",
                    "subtask": false,
                    "avatarId": 21141
                }
            }
        },
        "fixVersions": [
            {
                "self": "https://issues.apache.org/jira/rest/api/2/version/12351051",
                "id": "12351051",
                "description": "",
                "name": "8.0.0",
                "archived": false,
                "released": true,
                "releaseDate": "2022-05-06"
            }
        ],
        "resolution": {
            "self": "https://issues.apache.org/jira/rest/api/2/resolution/1",
            "id": "1",
            "description": "A fix for this issue is checked into the tree and tested.",
            "name": "Fixed"
        },
        "customfield_12312322": null,
        "customfield_12312323": null,
        "customfield_12312320": null,
        "customfield_12310420": "9223372036854775807",
        "customfield_12312321": null,
        "customfield_12312328": null,
        "customfield_12312329": null,
        "customfield_12312326": null,
        "customfield_12310300": null,
        "customfield_12312327": null,
        "customfield_12312324": null,
        "customfield_12312720": null,
        "customfield_12312325": null,
        "lastViewed": null,
        "priority": {
            "self": "https://issues.apache.org/jira/rest/api/2/priority/3",
            "iconUrl": "https://issues.apache.org/jira/images/icons/priorities/major.svg",
            "name": "Major",
            "id": "3"
        },
        "labels": [
            "good-first-issue",
            "pull-request-available"
        ],
        "customfield_12312333": null,
        "customfield_12312334": null,
        "customfield_12313422": "false",
        "customfield_12310310": "0.0",
        "customfield_12312331": null,
        "customfield_12312332": null,
        "aggregatetimeoriginalestimate": null,
        "timeestimate": 0,
        "customfield_12312330": null,
        "versions": [],
        "customfield_12311120": null,
        "customfield_12313826": null,
        "customfield_12312339": null,
        "issuelinks": [
            {
                "id": "12633810",
                "self": "https://issues.apache.org/jira/rest/api/2/issueLink/12633810",
                "type": {
                    "id": "12310760",
                    "name": "Testing",
                    "inward": "Discovered while testing",
                    "outward": "Testing discovered",
                    "self": "https://issues.apache.org/jira/rest/api/2/issueLinkType/12310760"
                },
                "outwardIssue": {
                    "id": "13429041",
                    "key": "ARROW-15712",
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13429041",
                    "fields": {
                        "summary": "[R] Add a type method for Expression ",
                        "status": {
                            "self": "https://issues.apache.org/jira/rest/api/2/status/5",
                            "description": "A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.",
                            "iconUrl": "https://issues.apache.org/jira/images/icons/statuses/resolved.png",
                            "name": "Resolved",
                            "id": "5",
                            "statusCategory": {
                                "self": "https://issues.apache.org/jira/rest/api/2/statuscategory/3",
                                "id": 3,
                                "key": "done",
                                "colorName": "green",
                                "name": "Done"
                            }
                        },
                        "priority": {
                            "self": "https://issues.apache.org/jira/rest/api/2/priority/3",
                            "iconUrl": "https://issues.apache.org/jira/images/icons/priorities/major.svg",
                            "name": "Major",
                            "id": "3"
                        },
                        "issuetype": {
                            "self": "https://issues.apache.org/jira/rest/api/2/issuetype/4",
                            "id": "4",
                            "description": "An improvement or enhancement to an existing feature or task.",
                            "iconUrl": "https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21140&avatarType=issuetype",
                            "name": "Improvement",
                            "subtask": false,
                            "avatarId": 21140
                        }
                    }
                }
            }
        ],
        "customfield_12313825": null,
        "assignee": {
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=dragosmg",
            "name": "dragosmg",
            "key": "dragosmg",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=34061",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34061",
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34061",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34061"
            },
            "displayName": "Drago\u0219 Moldovan-Gr\u00fcnfeld",
            "active": true,
            "timeZone": "Etc/UTC"
        },
        "customfield_12312337": null,
        "customfield_12313823": null,
        "customfield_12312338": null,
        "customfield_12311920": null,
        "customfield_12313822": null,
        "customfield_12312335": null,
        "customfield_12313821": null,
        "customfield_12312336": null,
        "customfield_12313820": null,
        "status": {
            "self": "https://issues.apache.org/jira/rest/api/2/status/5",
            "description": "A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.",
            "iconUrl": "https://issues.apache.org/jira/images/icons/statuses/resolved.png",
            "name": "Resolved",
            "id": "5",
            "statusCategory": {
                "self": "https://issues.apache.org/jira/rest/api/2/statuscategory/3",
                "id": 3,
                "key": "done",
                "colorName": "green",
                "name": "Done"
            }
        },
        "components": [
            {
                "self": "https://issues.apache.org/jira/rest/api/2/component/12333008",
                "id": "12333008",
                "name": "R"
            }
        ],
        "customfield_12312026": null,
        "customfield_12312023": null,
        "customfield_12312024": null,
        "aggregatetimeestimate": 0,
        "customfield_12312022": null,
        "customfield_12310921": null,
        "customfield_12310920": "9223372036854775807",
        "customfield_12312823": null,
        "creator": {
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=thisisnic",
            "name": "thisisnic",
            "key": "thisisnic",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=39937",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=39937",
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=39937",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=39937"
            },
            "displayName": "Nicola Crane",
            "active": true,
            "timeZone": "Africa/Casablanca"
        },
        "subtasks": [],
        "reporter": {
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=thisisnic",
            "name": "thisisnic",
            "key": "thisisnic",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=39937",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=39937",
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=39937",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=39937"
            },
            "displayName": "Nicola Crane",
            "active": true,
            "timeZone": "Africa/Casablanca"
        },
        "aggregateprogress": {
            "progress": 31200,
            "total": 31200,
            "percent": 100
        },
        "customfield_12313520": null,
        "customfield_12310250": null,
        "progress": {
            "progress": 31200,
            "total": 31200,
            "percent": 100
        },
        "customfield_12313924": null,
        "votes": {
            "self": "https://issues.apache.org/jira/rest/api/2/issue/ARROW-14817/votes",
            "votes": 0,
            "hasVoted": false
        },
        "worklog": {
            "startAt": 0,
            "maxResults": 20,
            "total": 52,
            "worklogs": [
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13413604/worklog/721988",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "dragosmg opened a new pull request #12357:\nURL: https://github.com/apache/arrow/pull/12357\n\n\n   This PR should make the following snippets of code equivalent:\r\n   ``` r\r\n   df <- tibble::tibble(\r\n     x = as.POSIXct(c(\"2022-02-07\", \"2022-03-04\"), tz = \"Pacific/Marquesas\")  \r\n   )\r\n   \r\n   df %>%\r\n   mutate(timezone = tz(x))\r\n   # A tibble: 2 \u00d7 2\r\n     x                   timezone         \r\n     <dttm>              <chr>            \r\n   1 2022-02-07 00:00:00 Pacific/Marquesas\r\n   2 2022-03-04 00:00:00 Pacific/Marquesas\r\n   ```\r\n   and\r\n   ```r\r\n   dr %>%\r\n     record_batch() %>%\r\n     mutate(timezone = tz(x) %>%\r\n     collect()\r\n   ```\n\n\n-- \nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nTo unsubscribe, e-mail: github-unsubscribe@arrow.apache.org\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2022-02-07T15:34:48.470+0000",
                    "updated": "2022-02-07T15:34:48.470+0000",
                    "started": "2022-02-07T15:34:48.470+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "721988",
                    "issueId": "13413604"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13413604/worklog/721989",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "github-actions[bot] commented on pull request #12357:\nURL: https://github.com/apache/arrow/pull/12357#issuecomment-1031601572\n\n\n\n\n\n\n-- \nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nTo unsubscribe, e-mail: github-unsubscribe@arrow.apache.org\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2022-02-07T15:35:20.992+0000",
                    "updated": "2022-02-07T15:35:20.992+0000",
                    "started": "2022-02-07T15:35:20.992+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "721989",
                    "issueId": "13413604"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13413604/worklog/722026",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "dragosmg commented on pull request #12357:\nURL: https://github.com/apache/arrow/pull/12357#issuecomment-1031661846\n\n\n   `lubridate::tz()` supports a bunch of types of inputs, for example character:\r\n   ``` r\r\n   suppressMessages(library(lubridate))\r\n   suppressMessages(library(dplyr))\r\n   tibble(\r\n     a = \"2022-02-07\"\r\n   ) %>% \r\n     mutate(timezone = tz(a))\r\n   #> # A tibble: 1 \u00d7 2\r\n   #>   a          timezone\r\n   #>   <chr>      <chr>   \r\n   #> 1 2022-02-07 UTC\r\n   ```\r\n   \r\n   <sup>Created on 2022-02-07 by the [reprex package](https://reprex.tidyverse.org) (v2.0.1)</sup>\n\n\n-- \nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nTo unsubscribe, e-mail: github-unsubscribe@arrow.apache.org\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2022-02-07T16:27:10.588+0000",
                    "updated": "2022-02-07T16:27:10.588+0000",
                    "started": "2022-02-07T16:27:10.588+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "722026",
                    "issueId": "13413604"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13413604/worklog/722029",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "dragosmg edited a comment on pull request #12357:\nURL: https://github.com/apache/arrow/pull/12357#issuecomment-1031661846\n\n\n   `lubridate::tz()` supports a bunch of types of inputs, for example character:\r\n   ``` r\r\n   suppressMessages(library(lubridate))\r\n   suppressMessages(library(dplyr))\r\n   tibble(\r\n     a = \"2022-02-07\"\r\n   ) %>% \r\n     mutate(timezone = tz(a))\r\n   #> # A tibble: 1 \u00d7 2\r\n   #>   a          timezone\r\n   #>   <chr>      <chr>   \r\n   #> 1 2022-02-07 UTC\r\n   ```\r\n   \r\n   <sup>Created on 2022-02-07 by the [reprex package](https://reprex.tidyverse.org) (v2.0.1)</sup>\r\n   \r\n   Not sure we want to support all of them. Albeit, it defaults to `\"UTC\"` when extracting the timezone from a character.\n\n\n-- \nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nTo unsubscribe, e-mail: github-unsubscribe@arrow.apache.org\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2022-02-07T16:27:55.867+0000",
                    "updated": "2022-02-07T16:27:55.867+0000",
                    "started": "2022-02-07T16:27:55.867+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "722029",
                    "issueId": "13413604"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13413604/worklog/723107",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "jonkeane commented on a change in pull request #12357:\nURL: https://github.com/apache/arrow/pull/12357#discussion_r801986202\n\n\n\n##########\nFile path: r/R/dplyr-funcs-datetime.R\n##########\n@@ -147,5 +147,12 @@ register_bindings_datetime <- function() {\n   register_binding(\"pm\", function(x) {\n     !call_binding(\"am\", x)\n   })\n-\n+  register_binding(\"tz\", function(x) {\n+    if (call_binding(\"is.character\", x) ||\n+        call_binding(\"is.Date\", x)) {\n+      return(\"UTC\")\n\nReview comment:\n       Hmm, I know that this is supported in lubridate, though it looks like even there it's only for backwards compatibility: \r\n   \r\n   https://github.com/tidyverse/lubridate/blob/566590f51364e6c42251cc1721f37c314ddf7e5f/R/accessors-tz.r#L21-L22\r\n   \r\n   I wonder if we should add this and keep on maintaining compatibility with lubridate on a feature that they only have to maintain backwards compatibility is the right way to go... It is especially strange that something like `tz(\"foo\")` or `tz(NA)` would return `UTC`, but even dates don't really line up to UTC (or rather: you can imagine conceptualizing a date with a timezone attached, so asserting that they are all UTC isn't quite right...)\n\n##########\nFile path: r/R/dplyr-funcs-datetime.R\n##########\n@@ -147,5 +147,12 @@ register_bindings_datetime <- function() {\n   register_binding(\"pm\", function(x) {\n     !call_binding(\"am\", x)\n   })\n-\n+  register_binding(\"tz\", function(x) {\n+    if (call_binding(\"is.character\", x) ||\n+        call_binding(\"is.Date\", x)) {\n+      return(\"UTC\")\n+    } else {\n+      return(x$type()$timezone())\n+    }\n\nReview comment:\n       What happens if you call this binding on an integer or a float? \n\n\n\n\n-- \nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nTo unsubscribe, e-mail: github-unsubscribe@arrow.apache.org\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2022-02-08T19:31:38.818+0000",
                    "updated": "2022-02-08T19:31:38.818+0000",
                    "started": "2022-02-08T19:31:38.818+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "723107",
                    "issueId": "13413604"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13413604/worklog/724382",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "dragosmg commented on a change in pull request #12357:\nURL: https://github.com/apache/arrow/pull/12357#discussion_r803472886\n\n\n\n##########\nFile path: r/R/dplyr-funcs-datetime.R\n##########\n@@ -147,5 +147,12 @@ register_bindings_datetime <- function() {\n   register_binding(\"pm\", function(x) {\n     !call_binding(\"am\", x)\n   })\n-\n+  register_binding(\"tz\", function(x) {\n+    if (call_binding(\"is.character\", x) ||\n+        call_binding(\"is.Date\", x)) {\n+      return(\"UTC\")\n\nReview comment:\n       Yep, my initial implementation did not return `\"UTC\"` for strings, etc. and FWIW I think that is the way to go. I then proceeded to implement it in a `lubridate`-like manner. That allows us to decide if we want to pair it back or not. My vote would go for return timezone when timezone exists, otherwise return `NA`. \n\n\n\n\n-- \nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nTo unsubscribe, e-mail: github-unsubscribe@arrow.apache.org\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2022-02-10T09:34:28.618+0000",
                    "updated": "2022-02-10T09:34:28.618+0000",
                    "started": "2022-02-10T09:34:28.618+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "724382",
                    "issueId": "13413604"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13413604/worklog/724389",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "dragosmg commented on a change in pull request #12357:\nURL: https://github.com/apache/arrow/pull/12357#discussion_r803478315\n\n\n\n##########\nFile path: r/R/dplyr-funcs-datetime.R\n##########\n@@ -147,5 +147,12 @@ register_bindings_datetime <- function() {\n   register_binding(\"pm\", function(x) {\n     !call_binding(\"am\", x)\n   })\n-\n+  register_binding(\"tz\", function(x) {\n+    if (call_binding(\"is.character\", x) ||\n+        call_binding(\"is.Date\", x)) {\n+      return(\"UTC\")\n\nReview comment:\n       Moreover, `lubridate` will stop returning `\"UTC\"` in the next update:\r\n   > Don't know how to compute timezone for object of class numeric; returning \"UTC\". This warning will become an error in the next major version of lubridate.\n\n\n\n\n-- \nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nTo unsubscribe, e-mail: github-unsubscribe@arrow.apache.org\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2022-02-10T09:40:14.500+0000",
                    "updated": "2022-02-10T09:40:14.500+0000",
                    "started": "2022-02-10T09:40:14.500+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "724389",
                    "issueId": "13413604"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13413604/worklog/724391",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "dragosmg commented on a change in pull request #12357:\nURL: https://github.com/apache/arrow/pull/12357#discussion_r803480656\n\n\n\n##########\nFile path: r/R/dplyr-funcs-datetime.R\n##########\n@@ -147,5 +147,12 @@ register_bindings_datetime <- function() {\n   register_binding(\"pm\", function(x) {\n     !call_binding(\"am\", x)\n   })\n-\n+  register_binding(\"tz\", function(x) {\n+    if (call_binding(\"is.character\", x) ||\n+        call_binding(\"is.Date\", x)) {\n+      return(\"UTC\")\n+    } else {\n+      return(x$type()$timezone())\n+    }\n\nReview comment:\n       It abandons ship and pulls data into R, when `lubridate` returns `\"UTC\"`.\n\n\n\n\n-- \nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nTo unsubscribe, e-mail: github-unsubscribe@arrow.apache.org\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2022-02-10T09:42:45.754+0000",
                    "updated": "2022-02-10T09:42:45.754+0000",
                    "started": "2022-02-10T09:42:45.753+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "724391",
                    "issueId": "13413604"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13413604/worklog/724407",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "dragosmg commented on pull request #12357:\nURL: https://github.com/apache/arrow/pull/12357#issuecomment-1034722439\n\n\n   To add to the conversation above. I think the right way to go is to extract timezone from the timestamp metadata and not look at each individual value. However, that could in a situation where a value is NA, but the column is a `timestamp` which will result in something like:\r\n   \r\n   ``` r\r\n   suppressMessages(library(arrow))\r\n   suppressMessages(library(dplyr))\r\n   df <- tibble(\r\n     x = as.POSIXct(c(\"2022-02-07\", NA), tz = \"Pacific/Marquesas\")\r\n   )\r\n   \r\n   df %>% \r\n     record_batch() %>% \r\n     mutate(timezone_x = tz(x)) %>% \r\n     collect()\r\n   #> A tibble: 2 \u00d7 2\r\n   #>   x                   timezone_x       \r\n   #>   <dttm>              <chr>            \r\n   #> 1 2022-02-07 00:00:00 Pacific/Marquesas\r\n   #> 2 NA                  Pacific/Marquesas\r\n   ```\r\n   \r\n   <sup>Created on 2022-02-10 by the [reprex package](https://reprex.tidyverse.org) (v2.0.1)</sup>\n\n\n-- \nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nTo unsubscribe, e-mail: github-unsubscribe@arrow.apache.org\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2022-02-10T10:01:42.151+0000",
                    "updated": "2022-02-10T10:01:42.151+0000",
                    "started": "2022-02-10T10:01:42.151+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "724407",
                    "issueId": "13413604"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13413604/worklog/724421",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "dragosmg commented on a change in pull request #12357:\nURL: https://github.com/apache/arrow/pull/12357#discussion_r803535644\n\n\n\n##########\nFile path: r/R/dplyr-funcs-datetime.R\n##########\n@@ -147,5 +147,12 @@ register_bindings_datetime <- function() {\n   register_binding(\"pm\", function(x) {\n     !call_binding(\"am\", x)\n   })\n-\n+  register_binding(\"tz\", function(x) {\n+    if (call_binding(\"is.character\", x) ||\n+        call_binding(\"is.Date\", x)) {\n+      return(\"UTC\")\n+    } else {\n+      return(x$type()$timezone())\n+    }\n\nReview comment:\n       We could go back to my first variant, which was also the simplest:\r\n   ```r\r\n     register_binding(\"tz\", function(x) {\r\n         x$type()$timezone()\r\n     })\r\n   ```\r\n   \r\n   I can't figure out how to surface an error from `tz()` as it gets caught by the dplyr query and then the dplyr-equivalent expression still gets evaluated in R.\n\n\n\n\n-- \nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nTo unsubscribe, e-mail: github-unsubscribe@arrow.apache.org\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2022-02-10T10:43:18.718+0000",
                    "updated": "2022-02-10T10:43:18.718+0000",
                    "started": "2022-02-10T10:43:18.718+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "724421",
                    "issueId": "13413604"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13413604/worklog/724505",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "jonkeane commented on a change in pull request #12357:\nURL: https://github.com/apache/arrow/pull/12357#discussion_r803682442\n\n\n\n##########\nFile path: r/R/dplyr-funcs-datetime.R\n##########\n@@ -147,5 +147,12 @@ register_bindings_datetime <- function() {\n   register_binding(\"pm\", function(x) {\n     !call_binding(\"am\", x)\n   })\n-\n+  register_binding(\"tz\", function(x) {\n+    if (call_binding(\"is.character\", x) ||\n+        call_binding(\"is.Date\", x)) {\n+      return(\"UTC\")\n\nReview comment:\n       Sounds good \ud83d\udc4d \n\n\n\n\n-- \nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nTo unsubscribe, e-mail: github-unsubscribe@arrow.apache.org\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2022-02-10T13:38:37.029+0000",
                    "updated": "2022-02-10T13:38:37.029+0000",
                    "started": "2022-02-10T13:38:37.029+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "724505",
                    "issueId": "13413604"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13413604/worklog/724517",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "jonkeane commented on pull request #12357:\nURL: https://github.com/apache/arrow/pull/12357#issuecomment-1034947201\n\n\n   I'm going to answer these two points below together, since they are similar. Both have tradeoffs, but what I do in circumstances like this is to look through our other bindings and see if I can find examples that do similar things.\r\n   \r\n   > To add to the conversation above. I think the right way to go is to extract timezone from the timestamp metadata and not look at each individual value. However, that could in a situation where a value is NA\r\n   \r\n   I agree that we should use the column metadata here (which is what it looks like you're doing), but then wrap it in an if_else detection if any elements are `NA` (one example is how we implemented `if_else()`(\ud83d\ude02) https://github.com/apache/arrow/blob/af33dd1157eb8d7d9bfac25ebf61445b793b7943/r/R/dplyr-funcs-conditional.R#L51-L61 we also do similar with `is.finite()` and `is.infinite()` https://github.com/apache/arrow/blob/af33dd1157eb8d7d9bfac25ebf61445b793b7943/r/R/dplyr-funcs-type.R#L239-L249\r\n   \r\n   \r\n   > I can't figure out how to surface an error from tz() as it gets caught by the dplyr query and then the dplyr-equivalent expression still gets evaluated in R.\r\n   \r\n   One example of having an error in a binding is https://github.com/apache/arrow/blob/af33dd1157eb8d7d9bfac25ebf61445b793b7943/r/R/dplyr-funcs-conditional.R#L86-L88 \n\n\n-- \nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nTo unsubscribe, e-mail: github-unsubscribe@arrow.apache.org\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2022-02-10T13:53:09.350+0000",
                    "updated": "2022-02-10T13:53:09.350+0000",
                    "started": "2022-02-10T13:53:09.349+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "724517",
                    "issueId": "13413604"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13413604/worklog/724730",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "dragosmg edited a comment on pull request #12357:\nURL: https://github.com/apache/arrow/pull/12357#issuecomment-1034722439\n\n\n   To add to the conversation above. I think the right way to go is to extract timezone from the timestamp metadata and not look at each individual value. However, that could result in a situation where a value is NA, but the column is a `timestamp` which will result in something like:\r\n   \r\n   ``` r\r\n   suppressMessages(library(arrow))\r\n   suppressMessages(library(dplyr))\r\n   df <- tibble(\r\n     x = as.POSIXct(c(\"2022-02-07\", NA), tz = \"Pacific/Marquesas\")\r\n   )\r\n   \r\n   df %>% \r\n     record_batch() %>% \r\n     mutate(timezone_x = tz(x)) %>% \r\n     collect()\r\n   #> A tibble: 2 \u00d7 2\r\n   #>   x                   timezone_x       \r\n   #>   <dttm>              <chr>            \r\n   #> 1 2022-02-07 00:00:00 Pacific/Marquesas\r\n   #> 2 NA                  Pacific/Marquesas\r\n   ```\r\n   \r\n   <sup>Created on 2022-02-10 by the [reprex package](https://reprex.tidyverse.org) (v2.0.1)</sup>\n\n\n-- \nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nTo unsubscribe, e-mail: github-unsubscribe@arrow.apache.org\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2022-02-10T20:22:07.551+0000",
                    "updated": "2022-02-10T20:22:07.551+0000",
                    "started": "2022-02-10T20:22:07.551+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "724730",
                    "issueId": "13413604"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13413604/worklog/724774",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "dragosmg commented on pull request #12357:\nURL: https://github.com/apache/arrow/pull/12357#issuecomment-1035520619\n\n\n   On surfacing errors: for example, I used `abort()` when working out how to implement `format()` (https://github.com/dragosmg/arrow/blob/9c99c03d4bdd5b80dea8acf88a3949808662bd32/r/R/dplyr-funcs-type.R#L259), but that error never surfaces as it is intercepted by the `mutate()` \"context\" and data is pulled into R.  \n\n\n-- \nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nTo unsubscribe, e-mail: github-unsubscribe@arrow.apache.org\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2022-02-10T21:10:12.142+0000",
                    "updated": "2022-02-10T21:10:12.142+0000",
                    "started": "2022-02-10T21:10:12.142+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "724774",
                    "issueId": "13413604"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13413604/worklog/724775",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "dragosmg edited a comment on pull request #12357:\nURL: https://github.com/apache/arrow/pull/12357#issuecomment-1035520619\n\n\n   @jonkeane Thanks for your comments. On surfacing errors: for example, I used `abort()` when working out how to implement `format()` (https://github.com/dragosmg/arrow/blob/9c99c03d4bdd5b80dea8acf88a3949808662bd32/r/R/dplyr-funcs-type.R#L259), but that error never surfaces as it is intercepted by the `mutate()` \"context\" and data is pulled into R.  \n\n\n-- \nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nTo unsubscribe, e-mail: github-unsubscribe@arrow.apache.org\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2022-02-10T21:10:34.626+0000",
                    "updated": "2022-02-10T21:10:34.626+0000",
                    "started": "2022-02-10T21:10:34.626+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "724775",
                    "issueId": "13413604"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13413604/worklog/724776",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "dragosmg commented on pull request #12357:\nURL: https://github.com/apache/arrow/pull/12357#issuecomment-1035525325\n\n\n   Worth noting that the current implementation diverges from `lubridate::tz()` as indicated in the conversation, namely it does not return `\"UTC\"` for strings, numerics or NAs.\r\n   ``` r\r\n   suppressMessages(library(lubridate))\r\n   tz(NA)\r\n   #> [1] \"UTC\"\r\n   tz(2)\r\n   #> Warning: tz(): Don't know how to compute timezone for object of class numeric;\r\n   #> returning \"UTC\". This warning will become an error in the next major version of\r\n   #> lubridate.\r\n   #> [1] \"UTC\"\r\n   tz(2.2)\r\n   #> Warning: tz(): Don't know how to compute timezone for object of class numeric;\r\n   #> returning \"UTC\". This warning will become an error in the next major version of\r\n   #> lubridate.\r\n   #> [1] \"UTC\"\r\n   tz(\"string\")\r\n   #> [1] \"UTC\"\r\n   ```\r\n   \r\n   <sup>Created on 2022-02-10 by the [reprex package](https://reprex.tidyverse.org) (v2.0.1)</sup>\n\n\n-- \nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nTo unsubscribe, e-mail: github-unsubscribe@arrow.apache.org\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2022-02-10T21:15:22.731+0000",
                    "updated": "2022-02-10T21:15:22.731+0000",
                    "started": "2022-02-10T21:15:22.731+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "724776",
                    "issueId": "13413604"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13413604/worklog/724780",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "dragosmg commented on pull request #12357:\nURL: https://github.com/apache/arrow/pull/12357#issuecomment-1035531392\n\n\n   `NA` will be \"contagious\" in arrow's `tz()` binding (as opposed to `lubridate::tz()` where they aren't):\r\n   ``` r\r\n   suppressMessages(library(arrow))\r\n   suppressMessages(library(lubridate))\r\n   suppressMessages(library(dplyr))\r\n   \r\n   df <- tibble(\r\n     x = as.POSIXct(c(\"2022-02-07\", NA), tz = \"Pacific/Marquesas\")\r\n   )\r\n   \r\n   df %>% \r\n     record_batch() %>% \r\n     mutate(timezone_x = tz(x)) %>%\r\n     collect()\r\n   #> # A tibble: 2 \u00d7 2\r\n   #>   x                   timezone_x\r\n   #>   <dttm>              <chr>     \r\n   #> 1 2022-02-07 00:00:00 UTC       \r\n   #> 2 NA                  NA\r\n    \r\n   df %>% \r\n     mutate(timezone_x = tz(x))\r\n   #> # A tibble: 2 \u00d7 2\r\n   #>   x                   timezone_x       \r\n   #>   <dttm>              <chr>            \r\n   #> 1 2022-02-07 00:00:00 Pacific/Marquesas\r\n   #> 2 NA                  Pacific/Marquesas\r\n   \r\n   \r\n   \r\n   ```\r\n   \r\n   <sup>Created on 2022-02-10 by the [reprex package](https://reprex.tidyverse.org) (v2.0.1)</sup>\n\n\n-- \nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nTo unsubscribe, e-mail: github-unsubscribe@arrow.apache.org\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2022-02-10T21:21:56.256+0000",
                    "updated": "2022-02-10T21:21:56.256+0000",
                    "started": "2022-02-10T21:21:56.256+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "724780",
                    "issueId": "13413604"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13413604/worklog/724812",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "jonkeane commented on pull request #12357:\nURL: https://github.com/apache/arrow/pull/12357#issuecomment-1035575913\n\n\n   > Worth noting that the current implementation diverges from lubridate::tz() as indicated in the conversation, namely it does not return \"UTC\" for strings, numerics or NAs.\r\n   \r\n   I think this is totally fine. For at least the numerics, lubridate will soon be doing what we do. For the others (strings, and bare NAs) it doesn't look like they are going to deprecate them, but I don't think we need to also follow that. We should note that (at least in a comment in the code, or in our documentation for the bindings if there's a place to put it).\r\n   \r\n   >  NA will be \"contagious\" in arrow's tz() binding (as opposed to lubridate::tz() where they aren't):\r\n   \r\n   Yeah, we have a choice here. I'm actually a bit surprised that `lubridate::tz()` returns a timezone that's not `UTC` there given the docs(!). But actually that behavior seems right. A bare `NA` either shouldn't produce a timezone (or produce a default UTC for backwards compatibility). But if the NA has a timezone attribute, that should be used.\r\n   \r\n   Given that, we probably should take out the `is.na()` bit in our binding since that will match what `lubridate::tz()` here. I only suggested adding it if we were aiming to mimic the `lubridate::tz(NA)` behavior here (which I thought would be `UTC`, but turns out, it's not!). That has the added benefit that we don't do by-element comparison, which is nice!\n\n\n-- \nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nTo unsubscribe, e-mail: github-unsubscribe@arrow.apache.org\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2022-02-10T22:03:27.806+0000",
                    "updated": "2022-02-10T22:03:27.806+0000",
                    "started": "2022-02-10T22:03:27.805+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "724812",
                    "issueId": "13413604"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13413604/worklog/724814",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "jonkeane commented on a change in pull request #12357:\nURL: https://github.com/apache/arrow/pull/12357#discussion_r804164292\n\n\n\n##########\nFile path: r/tests/testthat/_snaps/dplyr-funcs-datetime.md\n##########\n@@ -0,0 +1,15 @@\n+# extract tz\n+\n+    Code\n+      compare_dplyr_binding(.input %>% mutate(timezone_y = tz(x), timezone_z = tz(z),\n+      timezone_w = tz(w), timezone_v = tz(v)) %>% collect(), df)\n+    Warning <simpleWarning>\n+      tz(): Don't know how to compute timezone for object of class integer; returning \"UTC\". This warning will become an error in the next major version of lubridate.\n+      tz(): Don't know how to compute timezone for object of class numeric; returning \"UTC\". This warning will become an error in the next major version of lubridate.\n+      tz(): Don't know how to compute timezone for object of class integer; returning \"UTC\". This warning will become an error in the next major version of lubridate.\n+      tz(): Don't know how to compute timezone for object of class numeric; returning \"UTC\". This warning will become an error in the next major version of lubridate.\n+    Error <expectation_failure>\n+      `via_batch <- rlang::eval_tidy(expr, rlang::new_data_mask(rlang::env(.input = record_batch(tbl))))` threw an unexpected warning.\n+      Message: Expression tz(z) not supported in Arrow; pulling data into R\n\nReview comment:\n       > Thanks for your comments. On surfacing errors: for example, I used abort() when working out how to implement format() (https://github.com/dragosmg/arrow/blob/9c99c03d4bdd5b80dea8acf88a3949808662bd32/r/R/dplyr-funcs-type.R#L259), but that error never surfaces as it is intercepted by the mutate() \"context\" and data is pulled into R.\r\n   \r\n   Yup, that's expected, this message right here (at the front before `not supported in Arrow; pulling data into R` is the error message that I was asking about when I asked \"What happens if you call this binding on an integer or a float?\" \r\n   \r\n   I believe this is ultimately coming from https://github.com/apache/arrow/blob/fa699117091917f0992225aff4e8d4c08910162a/r/R/dplyr-eval.R#L58 \r\n   \r\n   which might not be the best message. If we `abort()` when we get types we know won't work we might be able to give a bit more informative errors than `Expression tz(z) not supported`\n\n\n\n\n-- \nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nTo unsubscribe, e-mail: github-unsubscribe@arrow.apache.org\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2022-02-10T22:09:56.283+0000",
                    "updated": "2022-02-10T22:09:56.283+0000",
                    "started": "2022-02-10T22:09:56.283+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "724814",
                    "issueId": "13413604"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13413604/worklog/724830",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "jonkeane commented on a change in pull request #12357:\nURL: https://github.com/apache/arrow/pull/12357#discussion_r804190644\n\n\n\n##########\nFile path: r/tests/testthat/_snaps/dplyr-funcs-datetime.md\n##########\n@@ -0,0 +1,15 @@\n+# extract tz\n+\n+    Code\n+      compare_dplyr_binding(.input %>% mutate(timezone_y = tz(x), timezone_z = tz(z),\n+      timezone_w = tz(w), timezone_v = tz(v)) %>% collect(), df)\n+    Warning <simpleWarning>\n+      tz(): Don't know how to compute timezone for object of class integer; returning \"UTC\". This warning will become an error in the next major version of lubridate.\n+      tz(): Don't know how to compute timezone for object of class numeric; returning \"UTC\". This warning will become an error in the next major version of lubridate.\n+      tz(): Don't know how to compute timezone for object of class integer; returning \"UTC\". This warning will become an error in the next major version of lubridate.\n+      tz(): Don't know how to compute timezone for object of class numeric; returning \"UTC\". This warning will become an error in the next major version of lubridate.\n+    Error <expectation_failure>\n+      `via_batch <- rlang::eval_tidy(expr, rlang::new_data_mask(rlang::env(.input = record_batch(tbl))))` threw an unexpected warning.\n+      Message: Expression tz(z) not supported in Arrow; pulling data into R\n\nReview comment:\n       And, for when you're looking at this tomorrow, check out https://github.com/apache/arrow/blob/fa699117091917f0992225aff4e8d4c08910162a/r/R/dplyr-eval.R#L18-L60\r\n   \r\n   There are a few bits in there relevant to error messages + how to surface them to see what's going on as a developer + how you might craft an error message that will be percolated up\n\n\n\n\n-- \nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nTo unsubscribe, e-mail: github-unsubscribe@arrow.apache.org\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2022-02-10T22:38:07.544+0000",
                    "updated": "2022-02-10T22:38:07.544+0000",
                    "started": "2022-02-10T22:38:07.543+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "724830",
                    "issueId": "13413604"
                }
            ]
        },
        "customfield_12313920": null,
        "issuetype": {
            "self": "https://issues.apache.org/jira/rest/api/2/issuetype/7",
            "id": "7",
            "description": "The sub-task of the issue",
            "iconUrl": "https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21146&avatarType=issuetype",
            "name": "Sub-task",
            "subtask": true,
            "avatarId": 21146
        },
        "timespent": 31200,
        "customfield_12314020": "{summaryBean=com.atlassian.jira.plugin.devstatus.rest.SummaryBean@b79d36[summary={pullrequest=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@6cf945d5[overall=PullRequestOverallBean{stateCount=0, state='OPEN', details=PullRequestOverallDetails{openCount=0, mergedCount=0, declinedCount=0}},byInstanceType={}], build=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@102b55bf[overall=com.atlassian.jira.plugin.devstatus.summary.beans.BuildOverallBean@36da7d82[failedBuildCount=0,successfulBuildCount=0,unknownBuildCount=0,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], review=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@7cc3160b[overall=com.atlassian.jira.plugin.devstatus.summary.beans.ReviewsOverallBean@19760265[stateCount=0,state=<null>,dueDate=<null>,overDue=false,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], deployment-environment=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@533a2a59[overall=com.atlassian.jira.plugin.devstatus.summary.beans.DeploymentOverallBean@36696bd1[topEnvironments=[],showProjects=false,successfulCount=0,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], repository=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@527e4059[overall=com.atlassian.jira.plugin.devstatus.summary.beans.CommitOverallBean@7bb21559[count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], branch=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@79d89094[overall=com.atlassian.jira.plugin.devstatus.summary.beans.BranchOverallBean@4124b9d[count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}]},errors=[],configErrors=[]], devSummaryJson={\"cachedValue\":{\"errors\":[],\"configErrors\":[],\"summary\":{\"pullrequest\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"stateCount\":0,\"state\":\"OPEN\",\"details\":{\"openCount\":0,\"mergedCount\":0,\"declinedCount\":0,\"total\":0},\"open\":true},\"byInstanceType\":{}},\"build\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"failedBuildCount\":0,\"successfulBuildCount\":0,\"unknownBuildCount\":0},\"byInstanceType\":{}},\"review\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"stateCount\":0,\"state\":null,\"dueDate\":null,\"overDue\":false,\"completed\":false},\"byInstanceType\":{}},\"deployment-environment\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"topEnvironments\":[],\"showProjects\":false,\"successfulCount\":0},\"byInstanceType\":{}},\"repository\":{\"overall\":{\"count\":0,\"lastUpdated\":null},\"byInstanceType\":{}},\"branch\":{\"overall\":{\"count\":0,\"lastUpdated\":null},\"byInstanceType\":{}}}},\"isStale\":false}}",
        "customfield_12314141": null,
        "customfield_12314140": null,
        "project": {
            "self": "https://issues.apache.org/jira/rest/api/2/project/12319525",
            "id": "12319525",
            "key": "ARROW",
            "name": "Apache Arrow",
            "projectTypeKey": "software",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/projectavatar?pid=12319525&avatarId=10011",
                "24x24": "https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12319525&avatarId=10011",
                "16x16": "https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12319525&avatarId=10011",
                "32x32": "https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12319525&avatarId=10011"
            },
            "projectCategory": {
                "self": "https://issues.apache.org/jira/rest/api/2/projectCategory/13960",
                "id": "13960",
                "description": "Apache Arrow",
                "name": "Arrow"
            }
        },
        "aggregatetimespent": 31200,
        "customfield_12312520": null,
        "customfield_12312521": "Tue Feb 22 13:57:49 UTC 2022",
        "customfield_12314422": null,
        "customfield_12314421": null,
        "customfield_12314146": null,
        "customfield_12314420": null,
        "customfield_12314145": null,
        "customfield_12314144": null,
        "customfield_12314143": null,
        "resolutiondate": "2022-02-22T13:57:49.000+0000",
        "workratio": -1,
        "customfield_12312923": null,
        "customfield_12312920": null,
        "customfield_12312921": null,
        "watches": {
            "self": "https://issues.apache.org/jira/rest/api/2/issue/ARROW-14817/watchers",
            "watchCount": 2,
            "isWatching": false
        },
        "created": "2021-11-24T12:08:05.000+0000",
        "updated": "2022-02-22T16:41:58.000+0000",
        "timeoriginalestimate": null,
        "description": "This can be achieved via strftime",
        "customfield_10010": null,
        "timetracking": {
            "remainingEstimate": "0h",
            "timeSpent": "8h 40m",
            "remainingEstimateSeconds": 0,
            "timeSpentSeconds": 31200
        },
        "customfield_12314523": null,
        "customfield_12314127": null,
        "customfield_12314522": null,
        "customfield_12314126": null,
        "customfield_12314521": null,
        "customfield_12314125": null,
        "customfield_12314520": null,
        "customfield_12314124": null,
        "attachment": [],
        "customfield_12312340": null,
        "customfield_12314123": null,
        "customfield_12312341": null,
        "customfield_12312220": null,
        "customfield_12314122": null,
        "customfield_12314121": null,
        "customfield_12314120": null,
        "customfield_12314129": null,
        "customfield_12314524": null,
        "customfield_12314128": null,
        "summary": "[R] Implement bindings for lubridate::tz",
        "customfield_12314130": null,
        "customfield_12310291": null,
        "customfield_12310290": null,
        "customfield_12314138": null,
        "customfield_12314137": null,
        "environment": null,
        "customfield_12314136": null,
        "customfield_12314135": null,
        "customfield_12311020": null,
        "customfield_12314134": null,
        "duedate": null,
        "customfield_12314132": null,
        "customfield_12314131": null,
        "comment": {
            "comments": [
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13413604/comment/17452126",
                    "id": "17452126",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=westonpace",
                        "name": "westonpace",
                        "key": "westonpace",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=34045",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34045",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34045",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34045"
                        },
                        "displayName": "Weston Pace",
                        "active": true,
                        "timeZone": "America/Los_Angeles"
                    },
                    "body": "I don't think you even need strftime.  For example, strftime will run an operation on every item in the array.  So if you have an array with 1 million elements you will string-format 1 million items.\r\n\r\nOn the other hand, in Arrow, we know the time zone will be consistent across the entire array.  So we only need to take the time zone from the array's dtype.  For example, in python, I could do...\r\n\r\n{noformat}\r\n>>> a = pa.array([0, 1, 2], type=pa.timestamp('us', 'America/Denver'))\r\n>>> print(a.type.tz)\r\n'America/Denver'\r\n{noformat}\r\n\r\nAlthough, if you then wanted to take that value and feed it further in the query engine...I'm not sure what the right way to go about that would be.  Basically you should know the value at query production time so I think you can just feed it in as a constant value in the query plan.  For example...\r\n\r\n{noformat}\r\nSELECT score, 'America/Denver' FROM my_table\r\n{noformat}",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=westonpace",
                        "name": "westonpace",
                        "key": "westonpace",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=34045",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34045",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34045",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34045"
                        },
                        "displayName": "Weston Pace",
                        "active": true,
                        "timeZone": "America/Los_Angeles"
                    },
                    "created": "2021-12-02T02:29:21.719+0000",
                    "updated": "2021-12-02T02:29:21.719+0000"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13413604/comment/17496102",
                    "id": "17496102",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=jonkeane",
                        "name": "jonkeane",
                        "key": "jonkeane",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=34057",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34057",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34057",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34057"
                        },
                        "displayName": "Jonathan Keane",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "body": "Issue resolved by pull request 12357\n[https://github.com/apache/arrow/pull/12357]",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=jonkeane",
                        "name": "jonkeane",
                        "key": "jonkeane",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=34057",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34057",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34057",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34057"
                        },
                        "displayName": "Jonathan Keane",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "created": "2022-02-22T13:57:49.462+0000",
                    "updated": "2022-02-22T13:57:49.462+0000"
                }
            ],
            "maxResults": 2,
            "total": 2,
            "startAt": 0
        },
        "customfield_12311820": "0|z0x1qo:",
        "customfield_12314139": null
    }
}