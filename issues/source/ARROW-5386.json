{
    "expand": "operations,versionedRepresentations,editmeta,changelog,renderedFields",
    "id": "13234555",
    "self": "https://issues.apache.org/jira/rest/api/2/issue/13234555",
    "key": "ARROW-5386",
    "fields": {
        "fixVersions": [],
        "resolution": {
            "self": "https://issues.apache.org/jira/rest/api/2/resolution/10005",
            "id": "10005",
            "description": "Workaround",
            "name": "Workaround"
        },
        "customfield_12312322": null,
        "customfield_12312323": null,
        "customfield_12312320": null,
        "customfield_12310420": "9223372036854775807",
        "customfield_12312321": null,
        "customfield_12312328": null,
        "customfield_12312329": null,
        "customfield_12312326": null,
        "customfield_12310300": null,
        "customfield_12312327": null,
        "customfield_12312324": null,
        "customfield_12312720": null,
        "customfield_12312325": null,
        "lastViewed": null,
        "priority": {
            "self": "https://issues.apache.org/jira/rest/api/2/priority/3",
            "iconUrl": "https://issues.apache.org/jira/images/icons/priorities/major.svg",
            "name": "Major",
            "id": "3"
        },
        "labels": [
            "pull-request-available"
        ],
        "customfield_12312333": null,
        "customfield_12312334": null,
        "customfield_12313422": "false",
        "customfield_12310310": "0.0",
        "customfield_12312331": null,
        "customfield_12312332": null,
        "aggregatetimeoriginalestimate": null,
        "timeestimate": 0,
        "customfield_12312330": null,
        "versions": [],
        "customfield_12311120": null,
        "customfield_12313826": null,
        "customfield_12312339": null,
        "issuelinks": [
            {
                "id": "12561737",
                "self": "https://issues.apache.org/jira/rest/api/2/issueLink/12561737",
                "type": {
                    "id": "10030",
                    "name": "Reference",
                    "inward": "is related to",
                    "outward": "relates to",
                    "self": "https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"
                },
                "outwardIssue": {
                    "id": "13235894",
                    "key": "ARROW-5429",
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13235894",
                    "fields": {
                        "summary": "[Java] Provide alternative buffer allocation policy",
                        "status": {
                            "self": "https://issues.apache.org/jira/rest/api/2/status/5",
                            "description": "A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.",
                            "iconUrl": "https://issues.apache.org/jira/images/icons/statuses/resolved.png",
                            "name": "Resolved",
                            "id": "5",
                            "statusCategory": {
                                "self": "https://issues.apache.org/jira/rest/api/2/statuscategory/3",
                                "id": 3,
                                "key": "done",
                                "colorName": "green",
                                "name": "Done"
                            }
                        },
                        "priority": {
                            "self": "https://issues.apache.org/jira/rest/api/2/priority/3",
                            "iconUrl": "https://issues.apache.org/jira/images/icons/priorities/major.svg",
                            "name": "Major",
                            "id": "3"
                        },
                        "issuetype": {
                            "self": "https://issues.apache.org/jira/rest/api/2/issuetype/4",
                            "id": "4",
                            "description": "An improvement or enhancement to an existing feature or task.",
                            "iconUrl": "https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21140&avatarType=issuetype",
                            "name": "Improvement",
                            "subtask": false,
                            "avatarId": 21140
                        }
                    }
                }
            }
        ],
        "customfield_12313825": null,
        "assignee": {
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=fan_li_ya",
            "name": "fan_li_ya",
            "key": "fan_li_ya",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=34045",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34045",
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34045",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34045"
            },
            "displayName": "Liya Fan",
            "active": true,
            "timeZone": "Asia/Shanghai"
        },
        "customfield_12312337": null,
        "customfield_12313823": null,
        "customfield_12312338": null,
        "customfield_12311920": null,
        "customfield_12313822": null,
        "customfield_12312335": null,
        "customfield_12313821": null,
        "customfield_12312336": null,
        "customfield_12313820": null,
        "status": {
            "self": "https://issues.apache.org/jira/rest/api/2/status/6",
            "description": "The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.",
            "iconUrl": "https://issues.apache.org/jira/images/icons/statuses/closed.png",
            "name": "Closed",
            "id": "6",
            "statusCategory": {
                "self": "https://issues.apache.org/jira/rest/api/2/statuscategory/3",
                "id": 3,
                "key": "done",
                "colorName": "green",
                "name": "Done"
            }
        },
        "components": [
            {
                "self": "https://issues.apache.org/jira/rest/api/2/component/12328933",
                "id": "12328933",
                "name": "Java"
            }
        ],
        "customfield_12312026": null,
        "customfield_12312023": null,
        "customfield_12312024": null,
        "aggregatetimeestimate": 0,
        "customfield_12312022": null,
        "customfield_12310921": null,
        "customfield_12310920": "9223372036854775807",
        "customfield_12312823": null,
        "creator": {
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=fan_li_ya",
            "name": "fan_li_ya",
            "key": "fan_li_ya",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=34045",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34045",
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34045",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34045"
            },
            "displayName": "Liya Fan",
            "active": true,
            "timeZone": "Asia/Shanghai"
        },
        "subtasks": [],
        "reporter": {
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=fan_li_ya",
            "name": "fan_li_ya",
            "key": "fan_li_ya",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=34045",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34045",
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34045",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34045"
            },
            "displayName": "Liya Fan",
            "active": true,
            "timeZone": "Asia/Shanghai"
        },
        "aggregateprogress": {
            "progress": 27600,
            "total": 27600,
            "percent": 100
        },
        "customfield_12313520": null,
        "customfield_12310250": null,
        "progress": {
            "progress": 27600,
            "total": 27600,
            "percent": 100
        },
        "customfield_12313924": null,
        "votes": {
            "self": "https://issues.apache.org/jira/rest/api/2/issue/ARROW-5386/votes",
            "votes": 0,
            "hasVoted": false
        },
        "worklog": {
            "startAt": 0,
            "maxResults": 20,
            "total": 47,
            "worklogs": [
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13234555/worklog/245922",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "liyafan82 commented on pull request #4358: [ARROW-5386][Java]Making the rounding behavior of the buffer capacity configurable\nURL: https://github.com/apache/arrow/pull/4358\n \n \n   In our scenario, the following code snippet is frequent in our code base:\r\n   \r\n   int requestSize = ...;\r\n   if (requestSize <= allocator.getLimit() - allocator.getAllocatedMemory()){\r\n     ArrowBuf buffer = allocator.buffer(requestSize); \r\n   }\r\n   However, it often causes OutOfMemoryException, due to Arrow's rounding behavior.\r\n   \r\n   For example, we have only 12 MB memory left, and we request a buffer with size 10 MB. Appearantly, there is sufficient memory to meet the request. However, the rounding behavior rounds the request size from 10 MB to 16 MB, and there is no 16 MB memory, so an OutOfMemoryException will be thrown.\r\n   \r\n   We propose two ways to solve this problem:\r\n   \r\n   1. We provide a rounding option as an argument to the BaseAllocator#buffer method. There are two possible values for the rounding option: rounding up and rounding down. In the above scenario, the rounding down option can solve the problem.\r\n   \r\n   2. We add a method to the allocator:\r\n   \r\n   int getRoundedSize(final int size, BaseAllocator.AllocationRoundingOption roundingOption)\r\n   \r\n   This method will give the rounded buffer size, given the initial request size. With this method, the user can freely adjust their request size to avoid OOM.\r\n   \r\n   To make it more convenient to use Arrow, we implement both solutions in this PR.\n \n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2019-05-21T10:45:59.831+0000",
                    "updated": "2019-05-21T10:45:59.831+0000",
                    "started": "2019-05-21T10:45:59.831+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "245922",
                    "issueId": "13234555"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13234555/worklog/245974",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "praveenbingo commented on issue #4358: ARROW-5386: [Java]Making the rounding behavior of the buffer capacity configurable\nURL: https://github.com/apache/arrow/pull/4358#issuecomment-494358377\n \n \n   @liyafan82 some minor checkstyle fixes are needed, before we can merge.\n \n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2019-05-21T11:51:45.398+0000",
                    "updated": "2019-05-21T11:51:45.398+0000",
                    "started": "2019-05-21T11:51:45.397+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "245974",
                    "issueId": "13234555"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13234555/worklog/246003",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "liyafan82 commented on issue #4358: ARROW-5386: [Java]Making the rounding behavior of the buffer capacity configurable\nURL: https://github.com/apache/arrow/pull/4358#issuecomment-494373403\n \n \n   > @liyafan82 some minor checkstyle fixes are needed, before we can merge.\r\n   \r\n   @praveenbingo Thank you so much for your review. \r\n   I have fixed the style issues. Hope it will pass the Travis CI build. \n \n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2019-05-21T12:38:30.278+0000",
                    "updated": "2019-05-21T12:38:30.278+0000",
                    "started": "2019-05-21T12:38:30.277+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "246003",
                    "issueId": "13234555"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13234555/worklog/246042",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "codecov-io commented on issue #4358: ARROW-5386: [Java]Making the rounding behavior of the buffer capacity configurable\nURL: https://github.com/apache/arrow/pull/4358#issuecomment-494393582\n \n \n   # [Codecov](https://codecov.io/gh/apache/arrow/pull/4358?src=pr&el=h1) Report\n   > Merging [#4358](https://codecov.io/gh/apache/arrow/pull/4358?src=pr&el=desc) into [master](https://codecov.io/gh/apache/arrow/commit/81e401305f1ec17a8c25b705d6ffff5b4aeff3ae?src=pr&el=desc) will **increase** coverage by `0.96%`.\n   > The diff coverage is `n/a`.\n   \n   [![Impacted file tree graph](https://codecov.io/gh/apache/arrow/pull/4358/graphs/tree.svg?width=650&token=LpTCFbqVT1&height=150&src=pr)](https://codecov.io/gh/apache/arrow/pull/4358?src=pr&el=tree)\n   \n   ```diff\n   @@            Coverage Diff             @@\n   ##           master    #4358      +/-   ##\n   ==========================================\n   + Coverage    88.3%   89.27%   +0.96%     \n   ==========================================\n     Files         780      635     -145     \n     Lines       98400    86998   -11402     \n     Branches     1251        0    -1251     \n   ==========================================\n   - Hits        86889    77664    -9225     \n   + Misses      11275     9334    -1941     \n   + Partials      236        0     -236\n   ```\n   \n   \n   | [Impacted Files](https://codecov.io/gh/apache/arrow/pull/4358?src=pr&el=tree) | Coverage \u0394 | |\n   |---|---|---|\n   | [go/arrow/ipc/writer.go](https://codecov.io/gh/apache/arrow/pull/4358/diff?src=pr&el=tree#diff-Z28vYXJyb3cvaXBjL3dyaXRlci5nbw==) | | |\n   | [go/arrow/math/uint64\\_amd64.go](https://codecov.io/gh/apache/arrow/pull/4358/diff?src=pr&el=tree#diff-Z28vYXJyb3cvbWF0aC91aW50NjRfYW1kNjQuZ28=) | | |\n   | [go/arrow/memory/memory\\_avx2\\_amd64.go](https://codecov.io/gh/apache/arrow/pull/4358/diff?src=pr&el=tree#diff-Z28vYXJyb3cvbWVtb3J5L21lbW9yeV9hdngyX2FtZDY0Lmdv) | | |\n   | [go/arrow/ipc/file\\_reader.go](https://codecov.io/gh/apache/arrow/pull/4358/diff?src=pr&el=tree#diff-Z28vYXJyb3cvaXBjL2ZpbGVfcmVhZGVyLmdv) | | |\n   | [js/src/enum.ts](https://codecov.io/gh/apache/arrow/pull/4358/diff?src=pr&el=tree#diff-anMvc3JjL2VudW0udHM=) | | |\n   | [go/arrow/array/builder.go](https://codecov.io/gh/apache/arrow/pull/4358/diff?src=pr&el=tree#diff-Z28vYXJyb3cvYXJyYXkvYnVpbGRlci5nbw==) | | |\n   | [js/src/Arrow.node.ts](https://codecov.io/gh/apache/arrow/pull/4358/diff?src=pr&el=tree#diff-anMvc3JjL0Fycm93Lm5vZGUudHM=) | | |\n   | [js/src/schema.ts](https://codecov.io/gh/apache/arrow/pull/4358/diff?src=pr&el=tree#diff-anMvc3JjL3NjaGVtYS50cw==) | | |\n   | [go/arrow/type\\_traits\\_boolean.go](https://codecov.io/gh/apache/arrow/pull/4358/diff?src=pr&el=tree#diff-Z28vYXJyb3cvdHlwZV90cmFpdHNfYm9vbGVhbi5nbw==) | | |\n   | [js/src/ipc/node/writer.ts](https://codecov.io/gh/apache/arrow/pull/4358/diff?src=pr&el=tree#diff-anMvc3JjL2lwYy9ub2RlL3dyaXRlci50cw==) | | |\n   | ... and [136 more](https://codecov.io/gh/apache/arrow/pull/4358/diff?src=pr&el=tree-more) | |\n   \n   ------\n   \n   [Continue to review full report at Codecov](https://codecov.io/gh/apache/arrow/pull/4358?src=pr&el=continue).\n   > **Legend** - [Click here to learn more](https://docs.codecov.io/docs/codecov-delta)\n   > `\u0394 = absolute <relative> (impact)`, `\u00f8 = not affected`, `? = missing data`\n   > Powered by [Codecov](https://codecov.io/gh/apache/arrow/pull/4358?src=pr&el=footer). Last update [81e4013...7c064f3](https://codecov.io/gh/apache/arrow/pull/4358?src=pr&el=lastupdated). Read the [comment docs](https://docs.codecov.io/docs/pull-request-comments).\n   \n \n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2019-05-21T13:35:01.550+0000",
                    "updated": "2019-05-21T13:35:01.550+0000",
                    "started": "2019-05-21T13:35:01.549+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "246042",
                    "issueId": "13234555"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13234555/worklog/246117",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "emkornfield commented on pull request #4358: ARROW-5386: [Java]Making the rounding behavior of the buffer capacity configurable\nURL: https://github.com/apache/arrow/pull/4358#discussion_r286084656\n \n \n\n ##########\n File path: java/memory/src/main/java/org/apache/arrow/memory/BaseAllocator.java\n ##########\n @@ -266,6 +301,11 @@ private ArrowBuf createEmpty() {\n \n   @Override\n   public ArrowBuf buffer(final int initialRequestSize, BufferManager manager) {\n+    return buffer(initialRequestSize, manager, AllocationRoundingOption.ROUND_UP);\n+  }\n+\n+  @Override\n \n Review comment:\n   Is the use-case to dynamically round up or down?  Or would it be sufficient to construct the object with this value?\n \n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2019-05-21T15:22:05.291+0000",
                    "updated": "2019-05-21T15:22:05.291+0000",
                    "started": "2019-05-21T15:22:05.290+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "246117",
                    "issueId": "13234555"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13234555/worklog/246118",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "emkornfield commented on pull request #4358: ARROW-5386: [Java]Making the rounding behavior of the buffer capacity configurable\nURL: https://github.com/apache/arrow/pull/4358#discussion_r286085055\n \n \n\n ##########\n File path: java/memory/src/main/java/org/apache/arrow/memory/BaseAllocator.java\n ##########\n @@ -276,9 +316,7 @@ public ArrowBuf buffer(final int initialRequestSize, BufferManager manager) {\n \n     // round to next largest power of two if we're within a chunk since that is how our allocator\n \n Review comment:\n   this comment is out of date?\n \n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2019-05-21T15:22:45.312+0000",
                    "updated": "2019-05-21T15:22:45.312+0000",
                    "started": "2019-05-21T15:22:45.312+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "246118",
                    "issueId": "13234555"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13234555/worklog/246122",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "emkornfield commented on pull request #4358: ARROW-5386: [Java]Making the rounding behavior of the buffer capacity configurable\nURL: https://github.com/apache/arrow/pull/4358#discussion_r286086258\n \n \n\n ##########\n File path: java/memory/src/main/java/org/apache/arrow/memory/BaseAllocator.java\n ##########\n @@ -143,6 +143,20 @@ public static int nextPowerOfTwo(int val) {\n     }\n   }\n \n+  /**\n+   * Rounds down the provided value to the nearest power of two.\n+   *\n+   * @param val An integer value.\n+   * @return The closest power of two of that value.\n+   */\n+  public static int prevPowerOfTwo(int val) {\n \n Review comment:\n   please add tests explicitly for this method?\n \n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2019-05-21T15:24:52.545+0000",
                    "updated": "2019-05-21T15:24:52.545+0000",
                    "started": "2019-05-21T15:24:52.545+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "246122",
                    "issueId": "13234555"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13234555/worklog/246125",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "emkornfield commented on pull request #4358: ARROW-5386: [Java]Making the rounding behavior of the buffer capacity configurable\nURL: https://github.com/apache/arrow/pull/4358#discussion_r286087864\n \n \n\n ##########\n File path: java/memory/src/main/java/org/apache/arrow/memory/BufferAllocator.java\n ##########\n @@ -50,6 +50,27 @@\n    */\n   public ArrowBuf buffer(int size, BufferManager manager);\n \n+  /**\n+   * Allocate a new or reused buffer of the provided size. Note that the buffer may technically\n \n Review comment:\n   nit: Allocates (https://google.github.io/styleguide/javaguide.html#s7.2-summary-fragment)\n \n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2019-05-21T15:29:18.821+0000",
                    "updated": "2019-05-21T15:29:18.821+0000",
                    "started": "2019-05-21T15:29:18.820+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "246125",
                    "issueId": "13234555"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13234555/worklog/246126",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "emkornfield commented on pull request #4358: ARROW-5386: [Java]Making the rounding behavior of the buffer capacity configurable\nURL: https://github.com/apache/arrow/pull/4358#discussion_r286088146\n \n \n\n ##########\n File path: java/memory/src/main/java/org/apache/arrow/memory/BufferAllocator.java\n ##########\n @@ -50,6 +50,27 @@\n    */\n   public ArrowBuf buffer(int size, BufferManager manager);\n \n+  /**\n+   * Allocate a new or reused buffer of the provided size. Note that the buffer may technically\n+   * be larger or smaller than the  requested size, depending on the rounding option.\n+   * However, the buffer's capacity will be set to the configured size.\n+   *\n+   * @param size The size in bytes.\n+   * @param manager A buffer manager to manage reallocation.\n+   * @param roundingOption The rounding option.\n+   * @return a new ArrowBuf, or null if the request can't be satisfied\n+   * @throws OutOfMemoryException if buffer cannot be allocated\n+   */\n+  public ArrowBuf buffer(int size, BufferManager manager, BaseAllocator.AllocationRoundingOption roundingOption);\n+\n+  /**\n+   * Get the rounded buffer size.\n+   * @param size The requested buffer size.\n+   * @param roundingOption The rounding option.\n+   * @return the buffer size after rounding.\n+   */\n+  public int getRoundedSize(final int size, BaseAllocator.AllocationRoundingOption roundingOption);\n \n Review comment:\n   does this need to be in the interface?\n \n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2019-05-21T15:29:18.869+0000",
                    "updated": "2019-05-21T15:29:18.869+0000",
                    "started": "2019-05-21T15:29:18.869+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "246126",
                    "issueId": "13234555"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13234555/worklog/246127",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "emkornfield commented on pull request #4358: ARROW-5386: [Java]Making the rounding behavior of the buffer capacity configurable\nURL: https://github.com/apache/arrow/pull/4358#discussion_r286087750\n \n \n\n ##########\n File path: java/memory/src/main/java/org/apache/arrow/memory/BufferAllocator.java\n ##########\n @@ -50,6 +50,27 @@\n    */\n   public ArrowBuf buffer(int size, BufferManager manager);\n \n+  /**\n+   * Allocate a new or reused buffer of the provided size. Note that the buffer may technically\n+   * be larger or smaller than the  requested size, depending on the rounding option.\n+   * However, the buffer's capacity will be set to the configured size.\n+   *\n+   * @param size The size in bytes.\n+   * @param manager A buffer manager to manage reallocation.\n+   * @param roundingOption The rounding option.\n+   * @return a new ArrowBuf, or null if the request can't be satisfied\n+   * @throws OutOfMemoryException if buffer cannot be allocated\n+   */\n+  public ArrowBuf buffer(int size, BufferManager manager, BaseAllocator.AllocationRoundingOption roundingOption);\n+\n+  /**\n+   * Get the rounded buffer size.\n \n Review comment:\n   nit: Gets (https://google.github.io/styleguide/javaguide.html#s7.2-summary-fragment)\n \n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2019-05-21T15:29:18.870+0000",
                    "updated": "2019-05-21T15:29:18.870+0000",
                    "started": "2019-05-21T15:29:18.869+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "246127",
                    "issueId": "13234555"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13234555/worklog/246128",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "emkornfield commented on pull request #4358: ARROW-5386: [Java]Making the rounding behavior of the buffer capacity configurable\nURL: https://github.com/apache/arrow/pull/4358#discussion_r286088475\n \n \n\n ##########\n File path: java/memory/src/main/java/org/apache/arrow/memory/BufferAllocator.java\n ##########\n @@ -50,6 +50,27 @@\n    */\n   public ArrowBuf buffer(int size, BufferManager manager);\n \n+  /**\n+   * Allocate a new or reused buffer of the provided size. Note that the buffer may technically\n+   * be larger or smaller than the  requested size, depending on the rounding option.\n+   * However, the buffer's capacity will be set to the configured size.\n+   *\n+   * @param size The size in bytes.\n+   * @param manager A buffer manager to manage reallocation.\n+   * @param roundingOption The rounding option.\n+   * @return a new ArrowBuf, or null if the request can't be satisfied\n+   * @throws OutOfMemoryException if buffer cannot be allocated\n+   */\n+  public ArrowBuf buffer(int size, BufferManager manager, BaseAllocator.AllocationRoundingOption roundingOption);\n \n Review comment:\n   See question above, is changing rounding behavior dynamically something we specifically want to support, or can objects be created with the rounding option?\n \n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2019-05-21T15:29:18.891+0000",
                    "updated": "2019-05-21T15:29:18.891+0000",
                    "started": "2019-05-21T15:29:18.891+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "246128",
                    "issueId": "13234555"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13234555/worklog/246544",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "liyafan82 commented on pull request #4358: ARROW-5386: [Java] Making the rounding behavior of the buffer capacity configurable\nURL: https://github.com/apache/arrow/pull/4358#discussion_r286293567\n \n \n\n ##########\n File path: java/memory/src/main/java/org/apache/arrow/memory/BaseAllocator.java\n ##########\n @@ -266,6 +301,11 @@ private ArrowBuf createEmpty() {\n \n   @Override\n   public ArrowBuf buffer(final int initialRequestSize, BufferManager manager) {\n+    return buffer(initialRequestSize, manager, AllocationRoundingOption.ROUND_UP);\n+  }\n+\n+  @Override\n \n Review comment:\n   Good question.\r\n   I think it is a dynamic use case, for 2 reasons:\r\n   1. We need to allocate buffers by rounding up or rounding down dynamically, depending on, e.g. the amount of available memory.\r\n   2. The rounding behavior only affects the adjusted buffer size which is requested internally. So it does not affect any internal state of the buffer allocator.\n \n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2019-05-22T02:39:12.032+0000",
                    "updated": "2019-05-22T02:39:12.032+0000",
                    "started": "2019-05-22T02:39:12.031+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "246544",
                    "issueId": "13234555"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13234555/worklog/246545",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "liyafan82 commented on pull request #4358: ARROW-5386: [Java] Making the rounding behavior of the buffer capacity configurable\nURL: https://github.com/apache/arrow/pull/4358#discussion_r286293567\n \n \n\n ##########\n File path: java/memory/src/main/java/org/apache/arrow/memory/BaseAllocator.java\n ##########\n @@ -266,6 +301,11 @@ private ArrowBuf createEmpty() {\n \n   @Override\n   public ArrowBuf buffer(final int initialRequestSize, BufferManager manager) {\n+    return buffer(initialRequestSize, manager, AllocationRoundingOption.ROUND_UP);\n+  }\n+\n+  @Override\n \n Review comment:\n   @emkornfield Good question.\r\n   I think it is a dynamic use case, for 2 reasons:\r\n   1. We need to allocate buffers by rounding up or rounding down dynamically, depending on, e.g. the amount of available memory.\r\n   2. The rounding behavior only affects the adjusted buffer size which is requested internally. So it does not affect any internal state of the buffer allocator.\n \n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2019-05-22T02:39:32.882+0000",
                    "updated": "2019-05-22T02:39:32.882+0000",
                    "started": "2019-05-22T02:39:32.882+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "246545",
                    "issueId": "13234555"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13234555/worklog/246546",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "liyafan82 commented on pull request #4358: ARROW-5386: [Java] Making the rounding behavior of the buffer capacity configurable\nURL: https://github.com/apache/arrow/pull/4358#discussion_r286293707\n \n \n\n ##########\n File path: java/memory/src/main/java/org/apache/arrow/memory/BaseAllocator.java\n ##########\n @@ -276,9 +316,7 @@ public ArrowBuf buffer(final int initialRequestSize, BufferManager manager) {\n \n     // round to next largest power of two if we're within a chunk since that is how our allocator\n \n Review comment:\n   @emkornfield Thank you for your careful review. I have revised it accordingly.\n \n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2019-05-22T02:40:15.022+0000",
                    "updated": "2019-05-22T02:40:15.022+0000",
                    "started": "2019-05-22T02:40:15.021+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "246546",
                    "issueId": "13234555"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13234555/worklog/246547",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "liyafan82 commented on pull request #4358: ARROW-5386: [Java] Making the rounding behavior of the buffer capacity configurable\nURL: https://github.com/apache/arrow/pull/4358#discussion_r286293846\n \n \n\n ##########\n File path: java/memory/src/main/java/org/apache/arrow/memory/BaseAllocator.java\n ##########\n @@ -143,6 +143,20 @@ public static int nextPowerOfTwo(int val) {\n     }\n   }\n \n+  /**\n+   * Rounds down the provided value to the nearest power of two.\n+   *\n+   * @param val An integer value.\n+   * @return The closest power of two of that value.\n+   */\n+  public static int prevPowerOfTwo(int val) {\n \n Review comment:\n   @emkornfield Good suggestion. I have added tests for this method and nextPowerOfTwo.\n \n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2019-05-22T02:41:22.552+0000",
                    "updated": "2019-05-22T02:41:22.552+0000",
                    "started": "2019-05-22T02:41:22.551+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "246547",
                    "issueId": "13234555"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13234555/worklog/246548",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "liyafan82 commented on pull request #4358: ARROW-5386: [Java] Making the rounding behavior of the buffer capacity configurable\nURL: https://github.com/apache/arrow/pull/4358#discussion_r286293935\n \n \n\n ##########\n File path: java/memory/src/main/java/org/apache/arrow/memory/BufferAllocator.java\n ##########\n @@ -50,6 +50,27 @@\n    */\n   public ArrowBuf buffer(int size, BufferManager manager);\n \n+  /**\n+   * Allocate a new or reused buffer of the provided size. Note that the buffer may technically\n+   * be larger or smaller than the  requested size, depending on the rounding option.\n+   * However, the buffer's capacity will be set to the configured size.\n+   *\n+   * @param size The size in bytes.\n+   * @param manager A buffer manager to manage reallocation.\n+   * @param roundingOption The rounding option.\n+   * @return a new ArrowBuf, or null if the request can't be satisfied\n+   * @throws OutOfMemoryException if buffer cannot be allocated\n+   */\n+  public ArrowBuf buffer(int size, BufferManager manager, BaseAllocator.AllocationRoundingOption roundingOption);\n+\n+  /**\n+   * Get the rounded buffer size.\n \n Review comment:\n   @emkornfield Thank you for your carefully review. I have revised it accordingly.\n \n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2019-05-22T02:41:46.786+0000",
                    "updated": "2019-05-22T02:41:46.786+0000",
                    "started": "2019-05-22T02:41:46.786+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "246548",
                    "issueId": "13234555"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13234555/worklog/246549",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "liyafan82 commented on pull request #4358: ARROW-5386: [Java] Making the rounding behavior of the buffer capacity configurable\nURL: https://github.com/apache/arrow/pull/4358#discussion_r286294015\n \n \n\n ##########\n File path: java/memory/src/main/java/org/apache/arrow/memory/BufferAllocator.java\n ##########\n @@ -50,6 +50,27 @@\n    */\n   public ArrowBuf buffer(int size, BufferManager manager);\n \n+  /**\n+   * Allocate a new or reused buffer of the provided size. Note that the buffer may technically\n \n Review comment:\n   @emkornfield Thanks for your careful review. I have revised it accordingly.\n \n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2019-05-22T02:42:18.781+0000",
                    "updated": "2019-05-22T02:42:18.781+0000",
                    "started": "2019-05-22T02:42:18.780+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "246549",
                    "issueId": "13234555"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13234555/worklog/246550",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "liyafan82 commented on pull request #4358: ARROW-5386: [Java] Making the rounding behavior of the buffer capacity configurable\nURL: https://github.com/apache/arrow/pull/4358#discussion_r286294488\n \n \n\n ##########\n File path: java/memory/src/main/java/org/apache/arrow/memory/BufferAllocator.java\n ##########\n @@ -50,6 +50,27 @@\n    */\n   public ArrowBuf buffer(int size, BufferManager manager);\n \n+  /**\n+   * Allocate a new or reused buffer of the provided size. Note that the buffer may technically\n+   * be larger or smaller than the  requested size, depending on the rounding option.\n+   * However, the buffer's capacity will be set to the configured size.\n+   *\n+   * @param size The size in bytes.\n+   * @param manager A buffer manager to manage reallocation.\n+   * @param roundingOption The rounding option.\n+   * @return a new ArrowBuf, or null if the request can't be satisfied\n+   * @throws OutOfMemoryException if buffer cannot be allocated\n+   */\n+  public ArrowBuf buffer(int size, BufferManager manager, BaseAllocator.AllocationRoundingOption roundingOption);\n+\n+  /**\n+   * Get the rounded buffer size.\n+   * @param size The requested buffer size.\n+   * @param roundingOption The rounding option.\n+   * @return the buffer size after rounding.\n+   */\n+  public int getRoundedSize(final int size, BaseAllocator.AllocationRoundingOption roundingOption);\n \n Review comment:\n   @emkornfield Good question.\r\n   In this PR, we provide two solutions to the problem of OOM when there is sufficient memory:\r\n   1. By providing a rounding option when allocating Arrow buffer.\r\n   2. By allowing the users to estimate the buffer size, and adjust the buffer size accordingly to avoid OOM.\r\n   \r\n   The two new methods in this interface corresponds to the two solutions above. So I think it may be better to provide this method in the interface.  \n \n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2019-05-22T02:45:35.683+0000",
                    "updated": "2019-05-22T02:45:35.683+0000",
                    "started": "2019-05-22T02:45:35.682+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "246550",
                    "issueId": "13234555"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13234555/worklog/246551",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "liyafan82 commented on pull request #4358: ARROW-5386: [Java] Making the rounding behavior of the buffer capacity configurable\nURL: https://github.com/apache/arrow/pull/4358#discussion_r286294727\n \n \n\n ##########\n File path: java/memory/src/main/java/org/apache/arrow/memory/BufferAllocator.java\n ##########\n @@ -50,6 +50,27 @@\n    */\n   public ArrowBuf buffer(int size, BufferManager manager);\n \n+  /**\n+   * Allocate a new or reused buffer of the provided size. Note that the buffer may technically\n+   * be larger or smaller than the  requested size, depending on the rounding option.\n+   * However, the buffer's capacity will be set to the configured size.\n+   *\n+   * @param size The size in bytes.\n+   * @param manager A buffer manager to manage reallocation.\n+   * @param roundingOption The rounding option.\n+   * @return a new ArrowBuf, or null if the request can't be satisfied\n+   * @throws OutOfMemoryException if buffer cannot be allocated\n+   */\n+  public ArrowBuf buffer(int size, BufferManager manager, BaseAllocator.AllocationRoundingOption roundingOption);\n \n Review comment:\n   @emkornfield Good question.\r\n   I think changing the rounding behavior dynamically is better, according to the analysis above. \n \n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2019-05-22T02:46:59.359+0000",
                    "updated": "2019-05-22T02:46:59.359+0000",
                    "started": "2019-05-22T02:46:59.358+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "246551",
                    "issueId": "13234555"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13234555/worklog/246557",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "codecov-io commented on issue #4358: ARROW-5386: [Java] Making the rounding behavior of the buffer capacity configurable\nURL: https://github.com/apache/arrow/pull/4358#issuecomment-494393582\n \n \n   # [Codecov](https://codecov.io/gh/apache/arrow/pull/4358?src=pr&el=h1) Report\n   > Merging [#4358](https://codecov.io/gh/apache/arrow/pull/4358?src=pr&el=desc) into [master](https://codecov.io/gh/apache/arrow/commit/81e401305f1ec17a8c25b705d6ffff5b4aeff3ae?src=pr&el=desc) will **increase** coverage by `0.96%`.\n   > The diff coverage is `n/a`.\n   \n   [![Impacted file tree graph](https://codecov.io/gh/apache/arrow/pull/4358/graphs/tree.svg?width=650&token=LpTCFbqVT1&height=150&src=pr)](https://codecov.io/gh/apache/arrow/pull/4358?src=pr&el=tree)\n   \n   ```diff\n   @@            Coverage Diff             @@\n   ##           master    #4358      +/-   ##\n   ==========================================\n   + Coverage    88.3%   89.26%   +0.96%     \n   ==========================================\n     Files         780      635     -145     \n     Lines       98400    87002   -11398     \n     Branches     1251        0    -1251     \n   ==========================================\n   - Hits        86889    77666    -9223     \n   + Misses      11275     9336    -1939     \n   + Partials      236        0     -236\n   ```\n   \n   \n   | [Impacted Files](https://codecov.io/gh/apache/arrow/pull/4358?src=pr&el=tree) | Coverage \u0394 | |\n   |---|---|---|\n   | [go/arrow/ipc/writer.go](https://codecov.io/gh/apache/arrow/pull/4358/diff?src=pr&el=tree#diff-Z28vYXJyb3cvaXBjL3dyaXRlci5nbw==) | | |\n   | [go/arrow/math/uint64\\_amd64.go](https://codecov.io/gh/apache/arrow/pull/4358/diff?src=pr&el=tree#diff-Z28vYXJyb3cvbWF0aC91aW50NjRfYW1kNjQuZ28=) | | |\n   | [go/arrow/memory/memory\\_avx2\\_amd64.go](https://codecov.io/gh/apache/arrow/pull/4358/diff?src=pr&el=tree#diff-Z28vYXJyb3cvbWVtb3J5L21lbW9yeV9hdngyX2FtZDY0Lmdv) | | |\n   | [go/arrow/ipc/file\\_reader.go](https://codecov.io/gh/apache/arrow/pull/4358/diff?src=pr&el=tree#diff-Z28vYXJyb3cvaXBjL2ZpbGVfcmVhZGVyLmdv) | | |\n   | [js/src/enum.ts](https://codecov.io/gh/apache/arrow/pull/4358/diff?src=pr&el=tree#diff-anMvc3JjL2VudW0udHM=) | | |\n   | [go/arrow/array/builder.go](https://codecov.io/gh/apache/arrow/pull/4358/diff?src=pr&el=tree#diff-Z28vYXJyb3cvYXJyYXkvYnVpbGRlci5nbw==) | | |\n   | [js/src/Arrow.node.ts](https://codecov.io/gh/apache/arrow/pull/4358/diff?src=pr&el=tree#diff-anMvc3JjL0Fycm93Lm5vZGUudHM=) | | |\n   | [js/src/schema.ts](https://codecov.io/gh/apache/arrow/pull/4358/diff?src=pr&el=tree#diff-anMvc3JjL3NjaGVtYS50cw==) | | |\n   | [go/arrow/type\\_traits\\_boolean.go](https://codecov.io/gh/apache/arrow/pull/4358/diff?src=pr&el=tree#diff-Z28vYXJyb3cvdHlwZV90cmFpdHNfYm9vbGVhbi5nbw==) | | |\n   | [js/src/ipc/node/writer.ts](https://codecov.io/gh/apache/arrow/pull/4358/diff?src=pr&el=tree#diff-anMvc3JjL2lwYy9ub2RlL3dyaXRlci50cw==) | | |\n   | ... and [137 more](https://codecov.io/gh/apache/arrow/pull/4358/diff?src=pr&el=tree-more) | |\n   \n   ------\n   \n   [Continue to review full report at Codecov](https://codecov.io/gh/apache/arrow/pull/4358?src=pr&el=continue).\n   > **Legend** - [Click here to learn more](https://docs.codecov.io/docs/codecov-delta)\n   > `\u0394 = absolute <relative> (impact)`, `\u00f8 = not affected`, `? = missing data`\n   > Powered by [Codecov](https://codecov.io/gh/apache/arrow/pull/4358?src=pr&el=footer). Last update [81e4013...e6df969](https://codecov.io/gh/apache/arrow/pull/4358?src=pr&el=lastupdated). Read the [comment docs](https://docs.codecov.io/docs/pull-request-comments).\n   \n \n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2019-05-22T03:21:23.384+0000",
                    "updated": "2019-05-22T03:21:23.384+0000",
                    "started": "2019-05-22T03:21:23.383+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "246557",
                    "issueId": "13234555"
                }
            ]
        },
        "customfield_12313920": null,
        "issuetype": {
            "self": "https://issues.apache.org/jira/rest/api/2/issuetype/4",
            "id": "4",
            "description": "An improvement or enhancement to an existing feature or task.",
            "iconUrl": "https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21140&avatarType=issuetype",
            "name": "Improvement",
            "subtask": false,
            "avatarId": 21140
        },
        "timespent": 27600,
        "customfield_12314020": "{summaryBean=com.atlassian.jira.plugin.devstatus.rest.SummaryBean@655285f9[summary={pullrequest=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@20523440[overall=PullRequestOverallBean{stateCount=0, state='OPEN', details=PullRequestOverallDetails{openCount=0, mergedCount=0, declinedCount=0}},byInstanceType={}], build=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@597ed404[overall=com.atlassian.jira.plugin.devstatus.summary.beans.BuildOverallBean@68bf1b5f[failedBuildCount=0,successfulBuildCount=0,unknownBuildCount=0,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], review=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@219eb037[overall=com.atlassian.jira.plugin.devstatus.summary.beans.ReviewsOverallBean@1e5ecaab[stateCount=0,state=<null>,dueDate=<null>,overDue=false,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], deployment-environment=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@312fe390[overall=com.atlassian.jira.plugin.devstatus.summary.beans.DeploymentOverallBean@21da7309[topEnvironments=[],showProjects=false,successfulCount=0,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], repository=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@7591600d[overall=com.atlassian.jira.plugin.devstatus.summary.beans.CommitOverallBean@1d72f786[count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], branch=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@538fb4db[overall=com.atlassian.jira.plugin.devstatus.summary.beans.BranchOverallBean@213fc798[count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}]},errors=[],configErrors=[]], devSummaryJson={\"cachedValue\":{\"errors\":[],\"configErrors\":[],\"summary\":{\"pullrequest\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"stateCount\":0,\"state\":\"OPEN\",\"details\":{\"openCount\":0,\"mergedCount\":0,\"declinedCount\":0,\"total\":0},\"open\":true},\"byInstanceType\":{}},\"build\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"failedBuildCount\":0,\"successfulBuildCount\":0,\"unknownBuildCount\":0},\"byInstanceType\":{}},\"review\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"stateCount\":0,\"state\":null,\"dueDate\":null,\"overDue\":false,\"completed\":false},\"byInstanceType\":{}},\"deployment-environment\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"topEnvironments\":[],\"showProjects\":false,\"successfulCount\":0},\"byInstanceType\":{}},\"repository\":{\"overall\":{\"count\":0,\"lastUpdated\":null},\"byInstanceType\":{}},\"branch\":{\"overall\":{\"count\":0,\"lastUpdated\":null},\"byInstanceType\":{}}}},\"isStale\":false}}",
        "customfield_12314141": null,
        "customfield_12314140": null,
        "project": {
            "self": "https://issues.apache.org/jira/rest/api/2/project/12319525",
            "id": "12319525",
            "key": "ARROW",
            "name": "Apache Arrow",
            "projectTypeKey": "software",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/projectavatar?pid=12319525&avatarId=10011",
                "24x24": "https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12319525&avatarId=10011",
                "16x16": "https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12319525&avatarId=10011",
                "32x32": "https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12319525&avatarId=10011"
            },
            "projectCategory": {
                "self": "https://issues.apache.org/jira/rest/api/2/projectCategory/13960",
                "id": "13960",
                "description": "Apache Arrow",
                "name": "Arrow"
            }
        },
        "aggregatetimespent": 27600,
        "customfield_12312520": null,
        "customfield_12312521": "Wed Jun 12 06:35:44 UTC 2019",
        "customfield_12314422": null,
        "customfield_12314421": null,
        "customfield_12314146": null,
        "customfield_12314420": null,
        "customfield_12314145": null,
        "customfield_12314144": null,
        "customfield_12314143": null,
        "resolutiondate": "2019-06-12T06:35:44.000+0000",
        "workratio": -1,
        "customfield_12312923": null,
        "customfield_12312920": null,
        "customfield_12312921": null,
        "watches": {
            "self": "https://issues.apache.org/jira/rest/api/2/issue/ARROW-5386/watchers",
            "watchCount": 1,
            "isWatching": false
        },
        "created": "2019-05-21T10:17:24.000+0000",
        "updated": "2019-06-12T06:35:44.000+0000",
        "timeoriginalestimate": null,
        "description": "In our scenario, the following code snippet is frequent in our code base:\r\n\r\nint requestSize = ...;\r\n if (requestSize <= allocator.getLimit() - allocator.getAllocatedMemory())\r\n\r\n{ ArrowBuf buffer = allocator.buffer(requestSize); }\r\n\r\nHowever, it often causes OutOfMemoryException, due to Arrow's rounding behavior.\r\n\r\nFor example, we have only 12 MB memory left, and we request a buffer with size 10 MB. Appearantly, there is sufficient memory to meet the request. However, the rounding behavior rounds the request size from 10 MB to 16 MB, and there is no 16 MB memory, so an OutOfMemoryException will be thrown.\r\n\r\nWe propose two ways to solve this problem:\r\n\r\n1. We provide a rounding option as an argument to the BaseAllocator#buffer method. There are two possible values for the rounding option: rounding up and rounding down. In the above scenario, the rounding down option can solve the problem.\r\n\r\n2. We add a method to the allocator:\r\n\r\nint getRoundedSize(final int size, BaseAllocator.AllocationRoundingOption roundingOption)\r\n\r\nThis method will give the rounded buffer size, given the initial request size. With this method, the user can freely adjust their request size to avoid OOM.\r\n\r\nTo make it more convenient to use Arrow, we think both solutions\u00a0should be implemented.\r\n\r\n\u00a0",
        "customfield_10010": null,
        "timetracking": {
            "remainingEstimate": "0h",
            "timeSpent": "7h 40m",
            "remainingEstimateSeconds": 0,
            "timeSpentSeconds": 27600
        },
        "customfield_12314523": null,
        "customfield_12314127": null,
        "customfield_12314522": null,
        "customfield_12314126": null,
        "customfield_12314521": null,
        "customfield_12314125": null,
        "customfield_12314520": null,
        "customfield_12314124": null,
        "attachment": [],
        "customfield_12312340": null,
        "customfield_12314123": null,
        "customfield_12312341": null,
        "customfield_12312220": null,
        "customfield_12314122": null,
        "customfield_12314121": null,
        "customfield_12314120": null,
        "customfield_12314129": null,
        "customfield_12314524": null,
        "customfield_12314128": null,
        "summary": "Making the rounding behavior of the buffer capacity configurable",
        "customfield_12314130": null,
        "customfield_12310291": null,
        "customfield_12310290": null,
        "customfield_12314138": null,
        "customfield_12314137": null,
        "environment": null,
        "customfield_12314136": null,
        "customfield_12314135": null,
        "customfield_12311020": null,
        "customfield_12314134": null,
        "duedate": null,
        "customfield_12314132": null,
        "customfield_12314131": null,
        "comment": {
            "comments": [
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13234555/comment/16861796",
                    "id": "16861796",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=fan_li_ya",
                        "name": "fan_li_ya",
                        "key": "fan_li_ya",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=34045",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34045",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34045",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34045"
                        },
                        "displayName": "Liya Fan",
                        "active": true,
                        "timeZone": "Asia/Shanghai"
                    },
                    "body": "ARROW-5429 provides a workaround for this issue. \r\n\r\nThat is, the user can get to know the actual buffer size through the RoundingStrategy object. So OOM can be avoided by adjusting the request buffer size. ",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=fan_li_ya",
                        "name": "fan_li_ya",
                        "key": "fan_li_ya",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=34045",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34045",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34045",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34045"
                        },
                        "displayName": "Liya Fan",
                        "active": true,
                        "timeZone": "Asia/Shanghai"
                    },
                    "created": "2019-06-12T06:35:44.510+0000",
                    "updated": "2019-06-12T06:35:44.510+0000"
                }
            ],
            "maxResults": 1,
            "total": 1,
            "startAt": 0
        },
        "customfield_12311820": "0|z02weg:",
        "customfield_12314139": null
    }
}