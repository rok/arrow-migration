{
    "expand": "operations,versionedRepresentations,editmeta,changelog,renderedFields",
    "id": "13472150",
    "self": "https://issues.apache.org/jira/rest/api/2/issue/13472150",
    "key": "ARROW-17114",
    "fields": {
        "fixVersions": [],
        "resolution": {
            "self": "https://issues.apache.org/jira/rest/api/2/resolution/3",
            "id": "3",
            "description": "The problem is a duplicate of an existing issue.",
            "name": "Duplicate"
        },
        "customfield_12312322": null,
        "customfield_12312323": null,
        "customfield_12312320": null,
        "customfield_12310420": "9223372036854775807",
        "customfield_12312321": null,
        "customfield_12312328": null,
        "customfield_12312329": null,
        "customfield_12312326": null,
        "customfield_12310300": null,
        "customfield_12312327": null,
        "customfield_12312324": null,
        "customfield_12312720": null,
        "customfield_12312325": null,
        "lastViewed": null,
        "priority": {
            "self": "https://issues.apache.org/jira/rest/api/2/priority/4",
            "iconUrl": "https://issues.apache.org/jira/images/icons/priorities/minor.svg",
            "name": "Minor",
            "id": "4"
        },
        "labels": [
            "pull-request-available"
        ],
        "customfield_12312333": null,
        "customfield_12312334": null,
        "customfield_12313422": "false",
        "customfield_12310310": "0.0",
        "customfield_12312331": null,
        "customfield_12312332": null,
        "aggregatetimeoriginalestimate": null,
        "timeestimate": 0,
        "customfield_12312330": null,
        "versions": [],
        "customfield_12311120": null,
        "customfield_12313826": null,
        "customfield_12312339": null,
        "issuelinks": [
            {
                "id": "12648599",
                "self": "https://issues.apache.org/jira/rest/api/2/issueLink/12648599",
                "type": {
                    "id": "12310051",
                    "name": "Supercedes",
                    "inward": "is superceded by",
                    "outward": "supercedes",
                    "self": "https://issues.apache.org/jira/rest/api/2/issueLinkType/12310051"
                },
                "inwardIssue": {
                    "id": "13410708",
                    "key": "ARROW-14635",
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13410708",
                    "fields": {
                        "summary": "[C++][Dataset] Devise a mechanism to limit the total \"system ram\" (process + cache) used by dataset writes",
                        "status": {
                            "self": "https://issues.apache.org/jira/rest/api/2/status/3",
                            "description": "This issue is being actively worked on at the moment by the assignee.",
                            "iconUrl": "https://issues.apache.org/jira/images/icons/statuses/inprogress.png",
                            "name": "In Progress",
                            "id": "3",
                            "statusCategory": {
                                "self": "https://issues.apache.org/jira/rest/api/2/statuscategory/4",
                                "id": 4,
                                "key": "indeterminate",
                                "colorName": "yellow",
                                "name": "In Progress"
                            }
                        },
                        "priority": {
                            "self": "https://issues.apache.org/jira/rest/api/2/priority/3",
                            "iconUrl": "https://issues.apache.org/jira/images/icons/priorities/major.svg",
                            "name": "Major",
                            "id": "3"
                        },
                        "issuetype": {
                            "self": "https://issues.apache.org/jira/rest/api/2/issuetype/4",
                            "id": "4",
                            "description": "An improvement or enhancement to an existing feature or task.",
                            "iconUrl": "https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21140&avatarType=issuetype",
                            "name": "Improvement",
                            "subtask": false,
                            "avatarId": 21140
                        }
                    }
                }
            }
        ],
        "customfield_12313825": null,
        "assignee": {
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=marsupialtail",
            "name": "marsupialtail",
            "key": "JIRAUSER287162",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=34045",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34045",
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34045",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34045"
            },
            "displayName": "Ziheng Wang",
            "active": true,
            "timeZone": "Etc/UTC"
        },
        "customfield_12312337": null,
        "customfield_12313823": null,
        "customfield_12312338": null,
        "customfield_12311920": null,
        "customfield_12313822": null,
        "customfield_12312335": null,
        "customfield_12313821": null,
        "customfield_12312336": null,
        "customfield_12313820": null,
        "status": {
            "self": "https://issues.apache.org/jira/rest/api/2/status/6",
            "description": "The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.",
            "iconUrl": "https://issues.apache.org/jira/images/icons/statuses/closed.png",
            "name": "Closed",
            "id": "6",
            "statusCategory": {
                "self": "https://issues.apache.org/jira/rest/api/2/statuscategory/3",
                "id": 3,
                "key": "done",
                "colorName": "green",
                "name": "Done"
            }
        },
        "components": [
            {
                "self": "https://issues.apache.org/jira/rest/api/2/component/12328935",
                "id": "12328935",
                "name": "C++"
            }
        ],
        "customfield_12312026": null,
        "customfield_12312023": null,
        "customfield_12312024": null,
        "aggregatetimeestimate": 0,
        "customfield_12312022": null,
        "customfield_12310921": null,
        "customfield_12310920": "9223372036854775807",
        "customfield_12312823": null,
        "creator": {
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=marsupialtail",
            "name": "marsupialtail",
            "key": "JIRAUSER287162",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=34045",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34045",
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34045",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34045"
            },
            "displayName": "Ziheng Wang",
            "active": true,
            "timeZone": "Etc/UTC"
        },
        "subtasks": [],
        "reporter": {
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=marsupialtail",
            "name": "marsupialtail",
            "key": "JIRAUSER287162",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=34045",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34045",
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34045",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34045"
            },
            "displayName": "Ziheng Wang",
            "active": true,
            "timeZone": "Etc/UTC"
        },
        "aggregateprogress": {
            "progress": 5400,
            "total": 5400,
            "percent": 100
        },
        "customfield_12313520": null,
        "customfield_12310250": null,
        "progress": {
            "progress": 5400,
            "total": 5400,
            "percent": 100
        },
        "customfield_12313924": null,
        "votes": {
            "self": "https://issues.apache.org/jira/rest/api/2/issue/ARROW-17114/votes",
            "votes": 0,
            "hasVoted": false
        },
        "worklog": {
            "startAt": 0,
            "maxResults": 20,
            "total": 9,
            "worklogs": [
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13472150/worklog/792362",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "github-actions[bot] commented on PR #13640:\nURL: https://github.com/apache/arrow/pull/13640#issuecomment-1188354680\n\n   https://issues.apache.org/jira/browse/ARROW-17114\n\n\n",
                    "created": "2022-07-18T21:48:58.293+0000",
                    "updated": "2022-07-18T21:48:58.293+0000",
                    "started": "2022-07-18T21:48:58.292+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "792362",
                    "issueId": "13472150"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13472150/worklog/792363",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "github-actions[bot] commented on PR #13640:\nURL: https://github.com/apache/arrow/pull/13640#issuecomment-1188354696\n\n   :warning: Ticket **has no components in JIRA**, make sure you assign one.\n\n\n",
                    "created": "2022-07-18T21:48:59.600+0000",
                    "updated": "2022-07-18T21:48:59.600+0000",
                    "started": "2022-07-18T21:48:59.599+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "792363",
                    "issueId": "13472150"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13472150/worklog/792364",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "github-actions[bot] commented on PR #13640:\nURL: https://github.com/apache/arrow/pull/13640#issuecomment-1188354709\n\n   :warning: Ticket **has not been started in JIRA**, please click 'Start Progress'.\n\n\n",
                    "created": "2022-07-18T21:49:01.128+0000",
                    "updated": "2022-07-18T21:49:01.128+0000",
                    "started": "2022-07-18T21:49:01.128+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "792364",
                    "issueId": "13472150"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13472150/worklog/792452",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "cyb70289 commented on code in PR #13640:\nURL: https://github.com/apache/arrow/pull/13640#discussion_r924058255\n\n\n##########\ncpp/src/arrow/io/file.cc:\n##########\n@@ -378,6 +378,77 @@ Status FileOutputStream::Write(const void* data, int64_t length) {\n \n int FileOutputStream::file_descriptor() const { return impl_->fd(); }\n \n+// ----------------------------------------------------------------------\n+// DirectFileOutputStream, change the Open, Write and Close methods from FileOutputStream\n+// Uses DirectIO for writes. Will only write out things in 4096 byte blocks. Buffers leftover bytes\n+// in an internal data structure, which will be padded to 4096 bytes and flushed upon call to close.\n+\n+class DirectFileOutputStream::DirectFileOutputStreamImpl : public OSFile {\n+ public:\n+  Status Open(const std::string& path, bool append) {\n+    const bool truncate = !append;\n+    return OpenWritable(path, truncate, append, true /* write_only */, true);\n+  }\n+  Status Open(int fd) { return OpenWritable(fd); }\n+};\n+\n+DirectFileOutputStream::DirectFileOutputStream() { \n+  uintptr_t mask = (uintptr_t)(4095);\n+  uint8_t *mem = static_cast<uint8_t *>(malloc(4096 + 4095));\n+  cached_data = reinterpret_cast<uint8_t *>( reinterpret_cast<uintptr_t>(mem+4095) & ~(mask));\n\nReview Comment:\n   `posix_memalign`?\r\n   \r\n   Actually, I'm not sure if an internal buffer is beneficial. AFAIK, direct IO is only for advanced apps like DMBS which implements their own buffer management and dislikes additional buffering (e.g., OS page cache). Looks to me Arrow as a library should not change this behaviour. Another issue is that we'd better leave IO alignment to the apps, as it depends heavily on OS and hardware, hardcode to 4096 implicitly is not good.\n\n\n\n",
                    "created": "2022-07-19T04:55:52.440+0000",
                    "updated": "2022-07-19T04:55:52.440+0000",
                    "started": "2022-07-19T04:55:52.440+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "792452",
                    "issueId": "13472150"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13472150/worklog/792453",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "cyb70289 commented on code in PR #13640:\nURL: https://github.com/apache/arrow/pull/13640#discussion_r924061697\n\n\n##########\ncpp/src/arrow/io/file.cc:\n##########\n@@ -378,6 +378,77 @@ Status FileOutputStream::Write(const void* data, int64_t length) {\n \n int FileOutputStream::file_descriptor() const { return impl_->fd(); }\n \n+// ----------------------------------------------------------------------\n+// DirectFileOutputStream, change the Open, Write and Close methods from FileOutputStream\n+// Uses DirectIO for writes. Will only write out things in 4096 byte blocks. Buffers leftover bytes\n+// in an internal data structure, which will be padded to 4096 bytes and flushed upon call to close.\n+\n+class DirectFileOutputStream::DirectFileOutputStreamImpl : public OSFile {\n+ public:\n+  Status Open(const std::string& path, bool append) {\n+    const bool truncate = !append;\n+    return OpenWritable(path, truncate, append, true /* write_only */, true);\n+  }\n+  Status Open(int fd) { return OpenWritable(fd); }\n+};\n+\n+DirectFileOutputStream::DirectFileOutputStream() { \n+  uintptr_t mask = (uintptr_t)(4095);\n+  uint8_t *mem = static_cast<uint8_t *>(malloc(4096 + 4095));\n+  cached_data = reinterpret_cast<uint8_t *>( reinterpret_cast<uintptr_t>(mem+4095) & ~(mask));\n\nReview Comment:\n   Also, the biggest advantage of direct IO is to transfer data directly between the user mode buffer and disk controller. This additional buffering may render the advantage useless IIUC.\n\n\n\n",
                    "created": "2022-07-19T05:03:48.234+0000",
                    "updated": "2022-07-19T05:03:48.234+0000",
                    "started": "2022-07-19T05:03:48.233+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "792453",
                    "issueId": "13472150"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13472150/worklog/792495",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "pitrou commented on code in PR #13640:\nURL: https://github.com/apache/arrow/pull/13640#discussion_r924195380\n\n\n##########\ncpp/src/arrow/io/file.cc:\n##########\n@@ -378,6 +378,77 @@ Status FileOutputStream::Write(const void* data, int64_t length) {\n \n int FileOutputStream::file_descriptor() const { return impl_->fd(); }\n \n+// ----------------------------------------------------------------------\n+// DirectFileOutputStream, change the Open, Write and Close methods from FileOutputStream\n+// Uses DirectIO for writes. Will only write out things in 4096 byte blocks. Buffers leftover bytes\n+// in an internal data structure, which will be padded to 4096 bytes and flushed upon call to close.\n+\n+class DirectFileOutputStream::DirectFileOutputStreamImpl : public OSFile {\n+ public:\n+  Status Open(const std::string& path, bool append) {\n+    const bool truncate = !append;\n+    return OpenWritable(path, truncate, append, true /* write_only */, true);\n+  }\n+  Status Open(int fd) { return OpenWritable(fd); }\n+};\n+\n+DirectFileOutputStream::DirectFileOutputStream() { \n+  uintptr_t mask = (uintptr_t)(4095);\n+  uint8_t *mem = static_cast<uint8_t *>(malloc(4096 + 4095));\n+  cached_data = reinterpret_cast<uint8_t *>( reinterpret_cast<uintptr_t>(mem+4095) & ~(mask));\n\nReview Comment:\n   Indeed, the `open` man page says this about `O_DIRECT`:\r\n   > Try to minimize cache effects of the I/O to and from this file.  In general this will degrade performance, but it is useful in special situations, such as when applications do their own caching.\r\n   \r\n   @marsupialtail Are you seeing any actual benefits from this? In which situations?\n\n\n\n",
                    "created": "2022-07-19T08:12:24.573+0000",
                    "updated": "2022-07-19T08:12:24.573+0000",
                    "started": "2022-07-19T08:12:24.572+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "792495",
                    "issueId": "13472150"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13472150/worklog/792744",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "westonpace commented on code in PR #13640:\nURL: https://github.com/apache/arrow/pull/13640#discussion_r924621904\n\n\n##########\ncpp/src/arrow/io/file.cc:\n##########\n@@ -378,6 +378,77 @@ Status FileOutputStream::Write(const void* data, int64_t length) {\n \n int FileOutputStream::file_descriptor() const { return impl_->fd(); }\n \n+// ----------------------------------------------------------------------\n+// DirectFileOutputStream, change the Open, Write and Close methods from FileOutputStream\n+// Uses DirectIO for writes. Will only write out things in 4096 byte blocks. Buffers leftover bytes\n+// in an internal data structure, which will be padded to 4096 bytes and flushed upon call to close.\n+\n+class DirectFileOutputStream::DirectFileOutputStreamImpl : public OSFile {\n+ public:\n+  Status Open(const std::string& path, bool append) {\n+    const bool truncate = !append;\n+    return OpenWritable(path, truncate, append, true /* write_only */, true);\n+  }\n+  Status Open(int fd) { return OpenWritable(fd); }\n+};\n+\n+DirectFileOutputStream::DirectFileOutputStream() { \n+  uintptr_t mask = (uintptr_t)(4095);\n+  uint8_t *mem = static_cast<uint8_t *>(malloc(4096 + 4095));\n+  cached_data = reinterpret_cast<uint8_t *>( reinterpret_cast<uintptr_t>(mem+4095) & ~(mask));\n\nReview Comment:\n   @marsupialtail this should maybe be linked against the JIRA https://issues.apache.org/jira/browse/ARROW-14635 which explains the goals a bit better.  The problem we are trying to solve here is not a performance problem. Instead, we are trying to keep large writes out of the OS cache.\r\n   \r\n   An example use case is converting a large (~400GB) CSV dataset to parquet (maybe 100GB).  Another example might be repartitioning a large parquet dataset.  In both cases the user is unlikely to turn around and read the entire dataset and so there is no need to put the entire dataset into the OS cache, and this has detrimental effects.\r\n   \r\n   What I've seen happen in these cases is that all of the data being written is stored in the page cache and writes return immediately (after the memcpy into the OS cache and before the data is persisted to disk).  Writes don't actually become blocking until the OS cache fills up.  The OS cache will use all available RAM and then the system grinds to a halt.  Furthermore, in the face of such memory pressure, even mildly inactive processes end up swapping, which increases the disk pressure.\r\n   \r\n   As I mention in the JIRA, direct I/O is only one way to solve this problem.  Another way is by using sync writes and aggressively marking pages as DONTNEED.  @save-buffer did an experiment a while back and found that the sync/fadvise approach was considerably slower than the direct I/O approach (though I don't recall if this experiment involved caching on the direct I/O approach or not) and so we opted to go with direct I/O.\n\n\n\n",
                    "created": "2022-07-19T15:07:27.347+0000",
                    "updated": "2022-07-19T15:07:27.347+0000",
                    "started": "2022-07-19T15:07:27.347+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "792744",
                    "issueId": "13472150"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13472150/worklog/792749",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "pitrou commented on code in PR #13640:\nURL: https://github.com/apache/arrow/pull/13640#discussion_r924638408\n\n\n##########\ncpp/src/arrow/io/file.cc:\n##########\n@@ -378,6 +378,77 @@ Status FileOutputStream::Write(const void* data, int64_t length) {\n \n int FileOutputStream::file_descriptor() const { return impl_->fd(); }\n \n+// ----------------------------------------------------------------------\n+// DirectFileOutputStream, change the Open, Write and Close methods from FileOutputStream\n+// Uses DirectIO for writes. Will only write out things in 4096 byte blocks. Buffers leftover bytes\n+// in an internal data structure, which will be padded to 4096 bytes and flushed upon call to close.\n+\n+class DirectFileOutputStream::DirectFileOutputStreamImpl : public OSFile {\n+ public:\n+  Status Open(const std::string& path, bool append) {\n+    const bool truncate = !append;\n+    return OpenWritable(path, truncate, append, true /* write_only */, true);\n+  }\n+  Status Open(int fd) { return OpenWritable(fd); }\n+};\n+\n+DirectFileOutputStream::DirectFileOutputStream() { \n+  uintptr_t mask = (uintptr_t)(4095);\n+  uint8_t *mem = static_cast<uint8_t *>(malloc(4096 + 4095));\n+  cached_data = reinterpret_cast<uint8_t *>( reinterpret_cast<uintptr_t>(mem+4095) & ~(mask));\n\nReview Comment:\n   I have trouble believing that `posix_fadvise` is really that much slower. You can also choose whatever granularity for `posix_fadvise` calls if you want to amortize the system call cost.\n\n\n\n",
                    "created": "2022-07-19T15:16:58.388+0000",
                    "updated": "2022-07-19T15:16:58.388+0000",
                    "started": "2022-07-19T15:16:58.387+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "792749",
                    "issueId": "13472150"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13472150/worklog/792751",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "pitrou commented on code in PR #13640:\nURL: https://github.com/apache/arrow/pull/13640#discussion_r924639199\n\n\n##########\ncpp/src/arrow/io/file.cc:\n##########\n@@ -378,6 +378,77 @@ Status FileOutputStream::Write(const void* data, int64_t length) {\n \n int FileOutputStream::file_descriptor() const { return impl_->fd(); }\n \n+// ----------------------------------------------------------------------\n+// DirectFileOutputStream, change the Open, Write and Close methods from FileOutputStream\n+// Uses DirectIO for writes. Will only write out things in 4096 byte blocks. Buffers leftover bytes\n+// in an internal data structure, which will be padded to 4096 bytes and flushed upon call to close.\n+\n+class DirectFileOutputStream::DirectFileOutputStreamImpl : public OSFile {\n+ public:\n+  Status Open(const std::string& path, bool append) {\n+    const bool truncate = !append;\n+    return OpenWritable(path, truncate, append, true /* write_only */, true);\n+  }\n+  Status Open(int fd) { return OpenWritable(fd); }\n+};\n+\n+DirectFileOutputStream::DirectFileOutputStream() { \n+  uintptr_t mask = (uintptr_t)(4095);\n+  uint8_t *mem = static_cast<uint8_t *>(malloc(4096 + 4095));\n+  cached_data = reinterpret_cast<uint8_t *>( reinterpret_cast<uintptr_t>(mem+4095) & ~(mask));\n\nReview Comment:\n   And `posix_fadvise` is a much more generally applicable solution than `O_DIRECT`, which might very well be detrimental in many use cases.\n\n\n\n",
                    "created": "2022-07-19T15:17:23.470+0000",
                    "updated": "2022-07-19T15:17:23.470+0000",
                    "started": "2022-07-19T15:17:23.470+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "792751",
                    "issueId": "13472150"
                }
            ]
        },
        "customfield_12313920": null,
        "issuetype": {
            "self": "https://issues.apache.org/jira/rest/api/2/issuetype/2",
            "id": "2",
            "description": "A new feature of the product, which has yet to be developed.",
            "iconUrl": "https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21141&avatarType=issuetype",
            "name": "New Feature",
            "subtask": false,
            "avatarId": 21141
        },
        "timespent": 5400,
        "customfield_12314020": "{summaryBean=com.atlassian.jira.plugin.devstatus.rest.SummaryBean@482a61d7[summary={pullrequest=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@642848f0[overall=PullRequestOverallBean{stateCount=0, state='OPEN', details=PullRequestOverallDetails{openCount=0, mergedCount=0, declinedCount=0}},byInstanceType={}], build=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@9b09bfd[overall=com.atlassian.jira.plugin.devstatus.summary.beans.BuildOverallBean@2f792df3[failedBuildCount=0,successfulBuildCount=0,unknownBuildCount=0,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], review=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@2ba7465e[overall=com.atlassian.jira.plugin.devstatus.summary.beans.ReviewsOverallBean@42e48d6c[stateCount=0,state=<null>,dueDate=<null>,overDue=false,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], deployment-environment=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@4f8689be[overall=com.atlassian.jira.plugin.devstatus.summary.beans.DeploymentOverallBean@29763308[topEnvironments=[],showProjects=false,successfulCount=0,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], repository=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@387215ce[overall=com.atlassian.jira.plugin.devstatus.summary.beans.CommitOverallBean@5e1b6041[count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], branch=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@252bd945[overall=com.atlassian.jira.plugin.devstatus.summary.beans.BranchOverallBean@3d5d509b[count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}]},errors=[],configErrors=[]], devSummaryJson={\"cachedValue\":{\"errors\":[],\"configErrors\":[],\"summary\":{\"pullrequest\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"stateCount\":0,\"state\":\"OPEN\",\"details\":{\"openCount\":0,\"mergedCount\":0,\"declinedCount\":0,\"total\":0},\"open\":true},\"byInstanceType\":{}},\"build\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"failedBuildCount\":0,\"successfulBuildCount\":0,\"unknownBuildCount\":0},\"byInstanceType\":{}},\"review\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"stateCount\":0,\"state\":null,\"dueDate\":null,\"overDue\":false,\"completed\":false},\"byInstanceType\":{}},\"deployment-environment\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"topEnvironments\":[],\"showProjects\":false,\"successfulCount\":0},\"byInstanceType\":{}},\"repository\":{\"overall\":{\"count\":0,\"lastUpdated\":null},\"byInstanceType\":{}},\"branch\":{\"overall\":{\"count\":0,\"lastUpdated\":null},\"byInstanceType\":{}}}},\"isStale\":false}}",
        "customfield_12314141": null,
        "customfield_12314140": null,
        "project": {
            "self": "https://issues.apache.org/jira/rest/api/2/project/12319525",
            "id": "12319525",
            "key": "ARROW",
            "name": "Apache Arrow",
            "projectTypeKey": "software",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/projectavatar?pid=12319525&avatarId=10011",
                "24x24": "https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12319525&avatarId=10011",
                "16x16": "https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12319525&avatarId=10011",
                "32x32": "https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12319525&avatarId=10011"
            },
            "projectCategory": {
                "self": "https://issues.apache.org/jira/rest/api/2/projectCategory/13960",
                "id": "13960",
                "description": "Apache Arrow",
                "name": "Arrow"
            }
        },
        "aggregatetimespent": 5400,
        "customfield_12312520": null,
        "customfield_12312521": "2022-07-18 21:47:51.0",
        "customfield_12314422": null,
        "customfield_12314421": null,
        "customfield_12314146": null,
        "customfield_12314420": null,
        "customfield_12314145": null,
        "customfield_12314144": null,
        "customfield_12314143": null,
        "resolutiondate": "2022-07-19T15:20:41.000+0000",
        "workratio": -1,
        "customfield_12312923": null,
        "customfield_12312920": null,
        "customfield_12312921": null,
        "watches": {
            "self": "https://issues.apache.org/jira/rest/api/2/issue/ARROW-17114/watchers",
            "watchCount": 1,
            "isWatching": false
        },
        "created": "2022-07-18T21:47:51.000+0000",
        "updated": "2022-10-03T16:55:14.000+0000",
        "timeoriginalestimate": null,
        "description": "Add support for O_DIRECT on Ubuntu in OutputStream writes to save page cache RAM for large writes.",
        "customfield_10010": null,
        "timetracking": {
            "remainingEstimate": "0h",
            "timeSpent": "1.5h",
            "remainingEstimateSeconds": 0,
            "timeSpentSeconds": 5400
        },
        "customfield_12314523": null,
        "customfield_12314127": null,
        "customfield_12314522": null,
        "customfield_12314126": null,
        "customfield_12314521": null,
        "customfield_12314125": null,
        "customfield_12314520": null,
        "customfield_12314124": null,
        "attachment": [],
        "customfield_12312340": null,
        "customfield_12314123": null,
        "customfield_12312341": null,
        "customfield_12312220": null,
        "customfield_12314122": null,
        "customfield_12314121": null,
        "customfield_12314120": null,
        "customfield_12314129": null,
        "customfield_12314524": null,
        "customfield_12314128": null,
        "summary": "[Python][C++] O_DIRECT write support ",
        "customfield_12314130": null,
        "customfield_12310291": null,
        "customfield_12310290": null,
        "customfield_12314138": null,
        "customfield_12314137": null,
        "environment": null,
        "customfield_12314136": null,
        "customfield_12314135": null,
        "customfield_12311020": null,
        "customfield_12314134": null,
        "duedate": null,
        "customfield_12314132": null,
        "customfield_12314131": null,
        "comment": {
            "comments": [],
            "maxResults": 0,
            "total": 0,
            "startAt": 0
        },
        "customfield_12311820": "0|z16ykg:",
        "customfield_12314139": null
    }
}