{
    "expand": "operations,versionedRepresentations,editmeta,changelog,renderedFields",
    "id": "13139761",
    "self": "https://issues.apache.org/jira/rest/api/2/issue/13139761",
    "key": "ARROW-2191",
    "fields": {
        "fixVersions": [
            {
                "self": "https://issues.apache.org/jira/rest/api/2/version/12341707",
                "id": "12341707",
                "description": "",
                "name": "0.9.0",
                "archived": false,
                "released": true,
                "releaseDate": "2018-03-19"
            }
        ],
        "resolution": {
            "self": "https://issues.apache.org/jira/rest/api/2/resolution/1",
            "id": "1",
            "description": "A fix for this issue is checked into the tree and tested.",
            "name": "Fixed"
        },
        "customfield_12312322": null,
        "customfield_12312323": null,
        "customfield_12312320": null,
        "customfield_12310420": "9223372036854775807",
        "customfield_12312321": null,
        "customfield_12312328": null,
        "customfield_12312329": null,
        "customfield_12312326": null,
        "customfield_12310300": null,
        "customfield_12312327": null,
        "customfield_12312324": null,
        "customfield_12312720": null,
        "customfield_12312325": null,
        "lastViewed": null,
        "priority": {
            "self": "https://issues.apache.org/jira/rest/api/2/priority/3",
            "iconUrl": "https://issues.apache.org/jira/images/icons/priorities/major.svg",
            "name": "Major",
            "id": "3"
        },
        "labels": [
            "pull-request-available"
        ],
        "customfield_12312333": null,
        "customfield_12312334": null,
        "customfield_12313422": "false",
        "customfield_12310310": "0.0",
        "customfield_12312331": null,
        "customfield_12312332": null,
        "aggregatetimeoriginalestimate": null,
        "timeestimate": null,
        "customfield_12312330": null,
        "versions": [],
        "customfield_12311120": null,
        "customfield_12313826": null,
        "customfield_12312339": null,
        "issuelinks": [],
        "customfield_12313825": null,
        "assignee": {
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=uwe",
            "name": "uwe",
            "key": "xhochy",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=xhochy&avatarId=30652",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=xhochy&avatarId=30652",
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=xhochy&avatarId=30652",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=xhochy&avatarId=30652"
            },
            "displayName": "Uwe Korn",
            "active": true,
            "timeZone": "Europe/Berlin"
        },
        "customfield_12312337": null,
        "customfield_12313823": null,
        "customfield_12312338": null,
        "customfield_12311920": null,
        "customfield_12313822": null,
        "customfield_12312335": null,
        "customfield_12313821": null,
        "customfield_12312336": null,
        "customfield_12313820": null,
        "status": {
            "self": "https://issues.apache.org/jira/rest/api/2/status/5",
            "description": "A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.",
            "iconUrl": "https://issues.apache.org/jira/images/icons/statuses/resolved.png",
            "name": "Resolved",
            "id": "5",
            "statusCategory": {
                "self": "https://issues.apache.org/jira/rest/api/2/statuscategory/3",
                "id": 3,
                "key": "done",
                "colorName": "green",
                "name": "Done"
            }
        },
        "components": [
            {
                "self": "https://issues.apache.org/jira/rest/api/2/component/12328935",
                "id": "12328935",
                "name": "C++"
            }
        ],
        "customfield_12312026": null,
        "customfield_12312023": null,
        "customfield_12312024": null,
        "aggregatetimeestimate": null,
        "customfield_12312022": null,
        "customfield_12310921": null,
        "customfield_12310920": "9223372036854775807",
        "customfield_12312823": null,
        "creator": {
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=uwe",
            "name": "uwe",
            "key": "xhochy",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=xhochy&avatarId=30652",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=xhochy&avatarId=30652",
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=xhochy&avatarId=30652",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=xhochy&avatarId=30652"
            },
            "displayName": "Uwe Korn",
            "active": true,
            "timeZone": "Europe/Berlin"
        },
        "subtasks": [],
        "reporter": {
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=uwe",
            "name": "uwe",
            "key": "xhochy",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=xhochy&avatarId=30652",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=xhochy&avatarId=30652",
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=xhochy&avatarId=30652",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=xhochy&avatarId=30652"
            },
            "displayName": "Uwe Korn",
            "active": true,
            "timeZone": "Europe/Berlin"
        },
        "aggregateprogress": {
            "progress": 0,
            "total": 0
        },
        "customfield_12313520": null,
        "customfield_12310250": null,
        "progress": {
            "progress": 0,
            "total": 0
        },
        "customfield_12313924": null,
        "votes": {
            "self": "https://issues.apache.org/jira/rest/api/2/issue/ARROW-2191/votes",
            "votes": 0,
            "hasVoted": false
        },
        "worklog": {
            "startAt": 0,
            "maxResults": 20,
            "total": 0,
            "worklogs": []
        },
        "customfield_12313920": null,
        "issuetype": {
            "self": "https://issues.apache.org/jira/rest/api/2/issuetype/4",
            "id": "4",
            "description": "An improvement or enhancement to an existing feature or task.",
            "iconUrl": "https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21140&avatarType=issuetype",
            "name": "Improvement",
            "subtask": false,
            "avatarId": 21140
        },
        "timespent": null,
        "customfield_12314020": "{summaryBean=com.atlassian.jira.plugin.devstatus.rest.SummaryBean@3a98823d[summary={pullrequest=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@2fa898a4[overall=PullRequestOverallBean{stateCount=0, state='OPEN', details=PullRequestOverallDetails{openCount=0, mergedCount=0, declinedCount=0}},byInstanceType={}], build=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@24109e32[overall=com.atlassian.jira.plugin.devstatus.summary.beans.BuildOverallBean@4f165fac[failedBuildCount=0,successfulBuildCount=0,unknownBuildCount=0,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], review=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@76213558[overall=com.atlassian.jira.plugin.devstatus.summary.beans.ReviewsOverallBean@1716430b[stateCount=0,state=<null>,dueDate=<null>,overDue=false,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], deployment-environment=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@37d7bed5[overall=com.atlassian.jira.plugin.devstatus.summary.beans.DeploymentOverallBean@4a417cbc[topEnvironments=[],showProjects=false,successfulCount=0,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], repository=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@35b51b59[overall=com.atlassian.jira.plugin.devstatus.summary.beans.CommitOverallBean@109e18ff[count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], branch=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@1ab53d2f[overall=com.atlassian.jira.plugin.devstatus.summary.beans.BranchOverallBean@5bd01659[count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}]},errors=[],configErrors=[]], devSummaryJson={\"cachedValue\":{\"errors\":[],\"configErrors\":[],\"summary\":{\"pullrequest\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"stateCount\":0,\"state\":\"OPEN\",\"details\":{\"openCount\":0,\"mergedCount\":0,\"declinedCount\":0,\"total\":0},\"open\":true},\"byInstanceType\":{}},\"build\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"failedBuildCount\":0,\"successfulBuildCount\":0,\"unknownBuildCount\":0},\"byInstanceType\":{}},\"review\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"stateCount\":0,\"state\":null,\"dueDate\":null,\"overDue\":false,\"completed\":false},\"byInstanceType\":{}},\"deployment-environment\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"topEnvironments\":[],\"showProjects\":false,\"successfulCount\":0},\"byInstanceType\":{}},\"repository\":{\"overall\":{\"count\":0,\"lastUpdated\":null},\"byInstanceType\":{}},\"branch\":{\"overall\":{\"count\":0,\"lastUpdated\":null},\"byInstanceType\":{}}}},\"isStale\":false}}",
        "customfield_12314141": null,
        "customfield_12314140": null,
        "project": {
            "self": "https://issues.apache.org/jira/rest/api/2/project/12319525",
            "id": "12319525",
            "key": "ARROW",
            "name": "Apache Arrow",
            "projectTypeKey": "software",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/projectavatar?pid=12319525&avatarId=10011",
                "24x24": "https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12319525&avatarId=10011",
                "16x16": "https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12319525&avatarId=10011",
                "32x32": "https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12319525&avatarId=10011"
            },
            "projectCategory": {
                "self": "https://issues.apache.org/jira/rest/api/2/projectCategory/13960",
                "id": "13960",
                "description": "Apache Arrow",
                "name": "Arrow"
            }
        },
        "aggregatetimespent": null,
        "customfield_12312520": null,
        "customfield_12312521": "Sat Feb 24 23:56:00 UTC 2018",
        "customfield_12314422": null,
        "customfield_12314421": null,
        "customfield_12314146": null,
        "customfield_12314420": null,
        "customfield_12314145": null,
        "customfield_12314144": null,
        "customfield_12314143": null,
        "resolutiondate": "2018-02-24T23:56:00.000+0000",
        "workratio": -1,
        "customfield_12312923": null,
        "customfield_12312920": null,
        "customfield_12312921": null,
        "watches": {
            "self": "https://issues.apache.org/jira/rest/api/2/issue/ARROW-2191/watchers",
            "watchCount": 2,
            "isWatching": false
        },
        "created": "2018-02-20T20:52:19.000+0000",
        "updated": "2018-02-24T23:56:00.000+0000",
        "timeoriginalestimate": null,
        "description": "As we want to avoid conflicts with system copies of jemalloc that are either outdated or are incompatible (known bugs, known shortcomings, or don't compile)\u00a0with older compilers, we want to only use our own prefixed version of jemalloc.",
        "customfield_10010": null,
        "timetracking": {},
        "customfield_12314523": null,
        "customfield_12314127": null,
        "customfield_12314522": null,
        "customfield_12314126": null,
        "customfield_12314521": null,
        "customfield_12314125": null,
        "customfield_12314520": null,
        "customfield_12314124": null,
        "attachment": [],
        "customfield_12312340": null,
        "customfield_12314123": null,
        "customfield_12312341": null,
        "customfield_12312220": null,
        "customfield_12314122": null,
        "customfield_12314121": null,
        "customfield_12314120": null,
        "customfield_12314129": null,
        "customfield_12314524": null,
        "customfield_12314128": null,
        "summary": "[C++]\u00a0Only use specific version of jemalloc",
        "customfield_12314130": null,
        "customfield_12310291": null,
        "customfield_12310290": null,
        "customfield_12314138": null,
        "customfield_12314137": null,
        "environment": null,
        "customfield_12314136": null,
        "customfield_12314135": null,
        "customfield_12311020": null,
        "customfield_12314134": null,
        "duedate": null,
        "customfield_12314132": null,
        "customfield_12314131": null,
        "comment": {
            "comments": [
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13139761/comment/16370611",
                    "id": "16370611",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "body": "xhochy opened a new pull request #1633: ARROW-2191: [C++]\u00a0Only use specific version of jemalloc\nURL: https://github.com/apache/arrow/pull/1633\n \n \n   \n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "created": "2018-02-20T21:19:06.854+0000",
                    "updated": "2018-02-20T21:19:06.854+0000"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13139761/comment/16372193",
                    "id": "16372193",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "body": "wesm commented on issue #1633: ARROW-2191: [C++]\u00a0Only use specific version of jemalloc\nURL: https://github.com/apache/arrow/pull/1633#issuecomment-367511562\n \n \n   rebased\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "created": "2018-02-21T23:17:42.104+0000",
                    "updated": "2018-02-21T23:17:42.104+0000"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13139761/comment/16375791",
                    "id": "16375791",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "body": "xhochy commented on issue #1633: ARROW-2191: [C++]\u00a0Only use specific version of jemalloc\nURL: https://github.com/apache/arrow/pull/1633#issuecomment-368263851\n \n \n   Travis is happy (but red to the manylinux problem) and AppVeyor passed at https://ci.appveyor.com/project/xhochy/arrow/build/1.0.586\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "created": "2018-02-24T22:04:39.202+0000",
                    "updated": "2018-02-24T22:04:39.202+0000"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13139761/comment/16375855",
                    "id": "16375855",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=wesm",
                        "name": "wesm",
                        "key": "wesmckinn",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=wesmckinn&avatarId=29931",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=wesmckinn&avatarId=29931",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=wesmckinn&avatarId=29931",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=wesmckinn&avatarId=29931"
                        },
                        "displayName": "Wes McKinney",
                        "active": true,
                        "timeZone": "America/New_York"
                    },
                    "body": "Issue resolved by pull request 1633\n[https://github.com/apache/arrow/pull/1633]",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=wesm",
                        "name": "wesm",
                        "key": "wesmckinn",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=wesmckinn&avatarId=29931",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=wesmckinn&avatarId=29931",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=wesmckinn&avatarId=29931",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=wesmckinn&avatarId=29931"
                        },
                        "displayName": "Wes McKinney",
                        "active": true,
                        "timeZone": "America/New_York"
                    },
                    "created": "2018-02-24T23:56:00.324+0000",
                    "updated": "2018-02-24T23:56:00.324+0000"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13139761/comment/16375856",
                    "id": "16375856",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "body": "wesm closed pull request #1633: ARROW-2191: [C++]\u00a0Only use specific version of jemalloc\nURL: https://github.com/apache/arrow/pull/1633\n \n \n   \n\nThis is a PR merged from a forked repository.\nAs GitHub hides the original diff on merge, it is displayed below for\nthe sake of provenance:\n\nAs this is a foreign pull request (from a fork), the diff is supplied\nbelow (as it won't show otherwise due to GitHub magic):\n\ndiff --git a/ci/travis_install_toolchain.sh b/ci/travis_install_toolchain.sh\nindex 60cdc36a2..b5eb137ba 100755\n--- a/ci/travis_install_toolchain.sh\n+++ b/ci/travis_install_toolchain.sh\n@@ -24,7 +24,6 @@ source $TRAVIS_BUILD_DIR/ci/travis_install_conda.sh\n if [ ! -e $CPP_TOOLCHAIN ]; then\n     # Set up C++ toolchain from conda-forge packages for faster builds\n     conda create -y -q -p $CPP_TOOLCHAIN python=2.7 \\\n-        jemalloc=4.5.0.post \\\n         nomkl \\\n         boost-cpp \\\n         rapidjson \\\ndiff --git a/cpp/CMakeLists.txt b/cpp/CMakeLists.txt\nindex 42c1ec8f0..b9221414b 100644\n--- a/cpp/CMakeLists.txt\n+++ b/cpp/CMakeLists.txt\n@@ -127,10 +127,6 @@ if(\"${CMAKE_SOURCE_DIR}\" STREQUAL \"${CMAKE_CURRENT_SOURCE_DIR}\")\n     \"Build the Arrow jemalloc-based allocator\"\n     OFF)\n \n-  option(ARROW_JEMALLOC_USE_SHARED\n-    \"Rely on jemalloc shared libraries where relevant\"\n-    ON)\n-\n   option(ARROW_HDFS\n     \"Build the Arrow HDFS bridge\"\n     ON)\n@@ -605,44 +601,28 @@ set(ARROW_TEST_LINK_LIBS ${ARROW_MIN_TEST_LIBS})\n \n if (ARROW_JEMALLOC)\n   add_definitions(-DARROW_JEMALLOC)\n-  # In the case that jemalloc is only available as a shared library also use it to\n-  # link it in the static requirements. In contrast to other libraries we try in\n-  # most cases to use the system provided version of jemalloc to better align with\n-  # other potential users of jemalloc.\n-  if (JEMALLOC_STATIC_LIB AND NOT ARROW_JEMALLOC_USE_SHARED)\n-    set(ARROW_JEMALLOC_STATIC_LINK_LIBS jemalloc_static)\n-  else()\n-    set(ARROW_JEMALLOC_STATIC_LINK_LIBS jemalloc_shared)\n-  endif()\n-\n-  if (NOT APPLE)\n-      set(ARROW_JEMALLOC_STATIC_LINK_LIBS ${ARROW_JEMALLOC_STATIC_LINK_LIBS} ${PTHREAD_LIBRARY} rt)\n-  endif()\n-\n-  if (ARROW_JEMALLOC_USE_SHARED)\n-    set(ARROW_JEMALLOC_SHARED_LINK_LIBS jemalloc_shared)\n+  add_definitions(-DARROW_JEMALLOC_INCLUDE_DIR=${JEMALLOC_INCLUDE_DIR})\n+\n+  if (CMAKE_COMPILER_IS_GNUCXX)\n+    set(ARROW_JEMALLOC_LINK_LIBS\n+      jemalloc_static\n+      # For glibc <2.17 we need to link to librt.\n+      # As we compile with --as-needed by default, the linker will omit this\n+      # dependency if not required.\n+      ${PTHREAD_LIBRARY}\n+      rt\n+      )\n   else()\n-    if (CMAKE_COMPILER_IS_GNUCXX)\n-      set(ARROW_JEMALLOC_SHARED_LINK_LIBS\n-        jemalloc_static\n-        # For glibc <2.17 we need to link to librt.\n-        # As we compile with --as-needed by default, the linker will omit this\n-        # dependency if not required.\n-        ${PTHREAD_LIBRARY}\n-        rt\n-        )\n-    else()\n-      set(ARROW_JEMALLOC_SHARED_LINK_LIBS\n-        jemalloc_static\n-        )\n-    endif()\n+    set(ARROW_JEMALLOC_LINK_LIBS\n+      jemalloc_static\n+      )\n   endif()\n   set(ARROW_SHARED_PRIVATE_LINK_LIBS\n     ${ARROW_SHARED_PRIVATE_LINK_LIBS}\n-    ${ARROW_JEMALLOC_SHARED_LINK_LIBS})\n+    ${ARROW_JEMALLOC_LINK_LIBS})\n   set(ARROW_STATIC_LINK_LIBS\n     ${ARROW_STATIC_LINK_LIBS}\n-    ${ARROW_JEMALLOC_STATIC_LINK_LIBS})\n+    ${ARROW_JEMALLOC_LINK_LIBS})\n elseif (NOT MSVC)\n   # We need to separate this as otherwise CMake would mess with the library\n   # linking order.\ndiff --git a/cpp/cmake_modules/ThirdpartyToolchain.cmake b/cpp/cmake_modules/ThirdpartyToolchain.cmake\nindex 3511d40d4..e64284cf0 100644\n--- a/cpp/cmake_modules/ThirdpartyToolchain.cmake\n+++ b/cpp/cmake_modules/ThirdpartyToolchain.cmake\n@@ -82,10 +82,6 @@ if (DEFINED ENV{RAPIDJSON_HOME})\n   set(RAPIDJSON_HOME \"$ENV{RAPIDJSON_HOME}\")\n endif()\n \n-if (DEFINED ENV{JEMALLOC_HOME})\n-  set(JEMALLOC_HOME \"$ENV{JEMALLOC_HOME}\")\n-endif()\n-\n if (DEFINED ENV{GFLAGS_HOME})\n   set(GFLAGS_HOME \"$ENV{GFLAGS_HOME}\")\n endif()\n@@ -474,33 +470,37 @@ if (MSVC)\n endif()\n \n if (ARROW_JEMALLOC)\n-  find_package(jemalloc)\n-\n-  if(NOT JEMALLOC_FOUND)\n-    set(ARROW_JEMALLOC_USE_SHARED OFF)\n-    set(JEMALLOC_PREFIX \"${CMAKE_CURRENT_BINARY_DIR}/jemalloc_ep-prefix/src/jemalloc_ep/dist/\")\n-    set(JEMALLOC_HOME \"${JEMALLOC_PREFIX}\")\n-    set(JEMALLOC_INCLUDE_DIR \"${JEMALLOC_PREFIX}/include\")\n-    set(JEMALLOC_SHARED_LIB \"${JEMALLOC_PREFIX}/lib/libjemalloc${CMAKE_SHARED_LIBRARY_SUFFIX}\")\n-    set(JEMALLOC_STATIC_LIB \"${JEMALLOC_PREFIX}/lib/libjemalloc_pic${CMAKE_STATIC_LIBRARY_SUFFIX}\")\n-    set(JEMALLOC_VENDORED 1)\n-    ExternalProject_Add(jemalloc_ep\n-      URL ${CMAKE_CURRENT_SOURCE_DIR}/thirdparty/jemalloc/${JEMALLOC_VERSION}.tar.gz\n-      CONFIGURE_COMMAND ./autogen.sh \"--prefix=${JEMALLOC_PREFIX}\" \"--with-jemalloc-prefix=je_arrow_\" \"--with-private-namespace=je_arrow_private_\" && touch doc/jemalloc.html && touch doc/jemalloc.3\n-      ${EP_LOG_OPTIONS}\n-      BUILD_IN_SOURCE 1\n-      BUILD_COMMAND ${MAKE}\n-      BUILD_BYPRODUCTS \"${JEMALLOC_STATIC_LIB}\" \"${JEMALLOC_SHARED_LIB}\"\n-      INSTALL_COMMAND ${MAKE} -j1 install)\n-  else()\n-    set(JEMALLOC_VENDORED 0)\n-  endif()\n+  # We only use a vendored jemalloc as we want to control its version.\n+  # Also our build of jemalloc is specially prefixed so that it will not \n+  # conflict with the default allocator as well as other jemalloc\n+  # installations.\n+  # find_package(jemalloc)\n+\n+  set(ARROW_JEMALLOC_USE_SHARED OFF)\n+  set(JEMALLOC_PREFIX \"${CMAKE_CURRENT_BINARY_DIR}/jemalloc_ep-prefix/src/jemalloc_ep/dist/\")\n+  set(JEMALLOC_HOME \"${JEMALLOC_PREFIX}\")\n+  set(JEMALLOC_INCLUDE_DIR \"${JEMALLOC_PREFIX}/include\")\n+  set(JEMALLOC_SHARED_LIB \"${JEMALLOC_PREFIX}/lib/libjemalloc${CMAKE_SHARED_LIBRARY_SUFFIX}\")\n+  set(JEMALLOC_STATIC_LIB \"${JEMALLOC_PREFIX}/lib/libjemalloc_pic${CMAKE_STATIC_LIBRARY_SUFFIX}\")\n+  set(JEMALLOC_VENDORED 1)\n+  ExternalProject_Add(jemalloc_ep\n+    URL ${CMAKE_CURRENT_SOURCE_DIR}/thirdparty/jemalloc/${JEMALLOC_VERSION}.tar.gz\n+    PATCH_COMMAND touch doc/jemalloc.3 doc/jemalloc.html\n+    CONFIGURE_COMMAND ./autogen.sh \"--prefix=${JEMALLOC_PREFIX}\" \"--with-jemalloc-prefix=je_arrow_\" \"--with-private-namespace=je_arrow_private_\"\n+    ${EP_LOG_OPTIONS}\n+    BUILD_IN_SOURCE 1\n+    BUILD_COMMAND ${MAKE}\n+    BUILD_BYPRODUCTS \"${JEMALLOC_STATIC_LIB}\" \"${JEMALLOC_SHARED_LIB}\"\n+    INSTALL_COMMAND ${MAKE} -j1 install)\n \n-  include_directories(SYSTEM ${JEMALLOC_INCLUDE_DIR})\n+  # Don't use the include directory directly so that we can point to a path\n+  # that is unique to our codebase.\n+  include_directories(SYSTEM \"${CMAKE_CURRENT_BINARY_DIR}/jemalloc_ep-prefix/src/\")\n   ADD_THIRDPARTY_LIB(jemalloc\n     STATIC_LIB ${JEMALLOC_STATIC_LIB}\n     SHARED_LIB ${JEMALLOC_SHARED_LIB}\n     DEPS ${PTHREAD_LIBRARY})\n+  add_dependencies(jemalloc_static jemalloc_ep)\n endif()\n \n ## Google PerfTools\ndiff --git a/cpp/src/arrow/CMakeLists.txt b/cpp/src/arrow/CMakeLists.txt\nindex 74674bebb..5fd925670 100644\n--- a/cpp/src/arrow/CMakeLists.txt\n+++ b/cpp/src/arrow/CMakeLists.txt\n@@ -65,6 +65,10 @@ if (ARROW_GPU)\n   add_subdirectory(gpu)\n endif()\n \n+if (ARROW_JEMALLOC AND JEMALLOC_VENDORED)\n+  add_dependencies(arrow_dependencies jemalloc_static)\n+endif()\n+\n if (ARROW_WITH_BROTLI)\n   add_definitions(-DARROW_WITH_BROTLI)\n   SET(ARROW_SRCS util/compression_brotli.cc ${ARROW_SRCS})\ndiff --git a/cpp/src/arrow/memory_pool.cc b/cpp/src/arrow/memory_pool.cc\nindex 99530432c..b8cd9c2fc 100644\n--- a/cpp/src/arrow/memory_pool.cc\n+++ b/cpp/src/arrow/memory_pool.cc\n@@ -31,7 +31,8 @@\n #ifdef ARROW_JEMALLOC\n // Needed to support jemalloc 3 and 4\n #define JEMALLOC_MANGLE\n-#include <jemalloc/jemalloc.h>\n+// Explicitly link to our version of jemalloc\n+#include \"jemalloc_ep/dist/include/jemalloc/jemalloc.h\"\n #endif\n \n namespace arrow {\n\n\n \n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "created": "2018-02-24T23:56:00.699+0000",
                    "updated": "2018-02-24T23:56:00.699+0000"
                }
            ],
            "maxResults": 5,
            "total": 5,
            "startAt": 0
        },
        "customfield_12311820": "0|i3qean:",
        "customfield_12314139": null
    }
}