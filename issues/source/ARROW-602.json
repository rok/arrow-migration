{
    "expand": "operations,versionedRepresentations,editmeta,changelog,renderedFields",
    "id": "13048263",
    "self": "https://issues.apache.org/jira/rest/api/2/issue/13048263",
    "key": "ARROW-602",
    "fields": {
        "fixVersions": [
            {
                "self": "https://issues.apache.org/jira/rest/api/2/version/12351550",
                "id": "12351550",
                "name": "9.0.0",
                "archived": false,
                "released": true,
                "releaseDate": "2022-08-03"
            }
        ],
        "resolution": {
            "self": "https://issues.apache.org/jira/rest/api/2/resolution/1",
            "id": "1",
            "description": "A fix for this issue is checked into the tree and tested.",
            "name": "Fixed"
        },
        "customfield_12312322": null,
        "customfield_12312323": null,
        "customfield_12312320": null,
        "customfield_12310420": "9223372036854775807",
        "customfield_12312321": null,
        "customfield_12312328": null,
        "customfield_12312329": null,
        "customfield_12312326": null,
        "customfield_12310300": null,
        "customfield_12312327": null,
        "customfield_12312324": null,
        "customfield_12312720": null,
        "customfield_12312325": null,
        "lastViewed": null,
        "priority": {
            "self": "https://issues.apache.org/jira/rest/api/2/priority/3",
            "iconUrl": "https://issues.apache.org/jira/images/icons/priorities/major.svg",
            "name": "Major",
            "id": "3"
        },
        "labels": [
            "beginner",
            "good-first-issue",
            "newbie",
            "pull-request-available"
        ],
        "customfield_12312333": null,
        "customfield_12312334": null,
        "customfield_12313422": "false",
        "customfield_12310310": "0.0",
        "customfield_12312331": null,
        "customfield_12312332": null,
        "aggregatetimeoriginalestimate": null,
        "timeestimate": 0,
        "customfield_12312330": null,
        "versions": [],
        "customfield_12311120": null,
        "customfield_12313826": null,
        "customfield_12312339": null,
        "issuelinks": [
            {
                "id": "12603002",
                "self": "https://issues.apache.org/jira/rest/api/2/issueLink/12603002",
                "type": {
                    "id": "10030",
                    "name": "Reference",
                    "inward": "is related to",
                    "outward": "relates to",
                    "self": "https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"
                },
                "outwardIssue": {
                    "id": "13273571",
                    "key": "ARROW-7363",
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13273571",
                    "fields": {
                        "summary": "[Python] Add combine_chunks method to ChunkedArray",
                        "status": {
                            "self": "https://issues.apache.org/jira/rest/api/2/status/5",
                            "description": "A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.",
                            "iconUrl": "https://issues.apache.org/jira/images/icons/statuses/resolved.png",
                            "name": "Resolved",
                            "id": "5",
                            "statusCategory": {
                                "self": "https://issues.apache.org/jira/rest/api/2/statuscategory/3",
                                "id": 3,
                                "key": "done",
                                "colorName": "green",
                                "name": "Done"
                            }
                        },
                        "priority": {
                            "self": "https://issues.apache.org/jira/rest/api/2/priority/3",
                            "iconUrl": "https://issues.apache.org/jira/images/icons/priorities/major.svg",
                            "name": "Major",
                            "id": "3"
                        },
                        "issuetype": {
                            "self": "https://issues.apache.org/jira/rest/api/2/issuetype/1",
                            "id": "1",
                            "description": "A problem which impairs or prevents the functions of the product.",
                            "iconUrl": "https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype",
                            "name": "Bug",
                            "subtask": false,
                            "avatarId": 21133
                        }
                    }
                }
            }
        ],
        "customfield_12313825": null,
        "assignee": {
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=alvinj15",
            "name": "alvinj15",
            "key": "JIRAUSER280323",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
            },
            "displayName": "Alvin Chunga Mamani",
            "active": true,
            "timeZone": "Etc/UTC"
        },
        "customfield_12312337": null,
        "customfield_12313823": null,
        "customfield_12312338": null,
        "customfield_12311920": null,
        "customfield_12313822": null,
        "customfield_12312335": null,
        "customfield_12313821": null,
        "customfield_12312336": null,
        "customfield_12313820": null,
        "status": {
            "self": "https://issues.apache.org/jira/rest/api/2/status/5",
            "description": "A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.",
            "iconUrl": "https://issues.apache.org/jira/images/icons/statuses/resolved.png",
            "name": "Resolved",
            "id": "5",
            "statusCategory": {
                "self": "https://issues.apache.org/jira/rest/api/2/statuscategory/3",
                "id": 3,
                "key": "done",
                "colorName": "green",
                "name": "Done"
            }
        },
        "components": [
            {
                "self": "https://issues.apache.org/jira/rest/api/2/component/12328935",
                "id": "12328935",
                "name": "C++"
            }
        ],
        "customfield_12312026": null,
        "customfield_12312023": null,
        "customfield_12312024": null,
        "aggregatetimeestimate": 0,
        "customfield_12312022": null,
        "customfield_12310921": null,
        "customfield_12310920": "9223372036854775807",
        "customfield_12312823": null,
        "creator": {
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=uwe",
            "name": "uwe",
            "key": "xhochy",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=xhochy&avatarId=30652",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=xhochy&avatarId=30652",
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=xhochy&avatarId=30652",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=xhochy&avatarId=30652"
            },
            "displayName": "Uwe Korn",
            "active": true,
            "timeZone": "Europe/Berlin"
        },
        "subtasks": [],
        "reporter": {
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=uwe",
            "name": "uwe",
            "key": "xhochy",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=xhochy&avatarId=30652",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=xhochy&avatarId=30652",
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=xhochy&avatarId=30652",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=xhochy&avatarId=30652"
            },
            "displayName": "Uwe Korn",
            "active": true,
            "timeZone": "Europe/Berlin"
        },
        "aggregateprogress": {
            "progress": 45000,
            "total": 45000,
            "percent": 100
        },
        "customfield_12313520": null,
        "customfield_12310250": null,
        "progress": {
            "progress": 45000,
            "total": 45000,
            "percent": 100
        },
        "customfield_12313924": null,
        "votes": {
            "self": "https://issues.apache.org/jira/rest/api/2/issue/ARROW-602/votes",
            "votes": 0,
            "hasVoted": false
        },
        "worklog": {
            "startAt": 0,
            "maxResults": 20,
            "total": 75,
            "worklogs": [
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13048263/worklog/762712",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "AlvinJ15 opened a new pull request, #13009:\nURL: https://github.com/apache/arrow/pull/13009\n\n   Create Iterator method in stl for Array and ChunkedArray\n\n\n",
                    "created": "2022-04-27T05:18:46.068+0000",
                    "updated": "2022-04-27T05:18:46.068+0000",
                    "started": "2022-04-27T05:18:46.068+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "762712",
                    "issueId": "13048263"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13048263/worklog/762718",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "github-actions[bot] commented on PR #13009:\nURL: https://github.com/apache/arrow/pull/13009#issuecomment-1110563745\n\n   https://issues.apache.org/jira/browse/ARROW-602\n\n\n",
                    "created": "2022-04-27T05:36:35.494+0000",
                    "updated": "2022-04-27T05:36:35.494+0000",
                    "started": "2022-04-27T05:36:35.493+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "762718",
                    "issueId": "13048263"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13048263/worklog/762957",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "edponce commented on code in PR #13009:\nURL: https://github.com/apache/arrow/pull/13009#discussion_r859921831\n\n\n##########\ncpp/src/arrow/stl_iterator.h:\n##########\n@@ -128,6 +131,215 @@ class ArrayIterator {\n   int64_t index_;\n };\n \n+template <typename ArrayType,\n+          typename ValueAccessor = detail::DefaultValueAccessor<ArrayType>>\n+class ChunkedArrayIterator {\n+ public:\n+  using value_type = arrow::util::optional<typename ValueAccessor::ValueType>;\n+  using difference_type = int64_t;\n+  using pointer = value_type*;\n+  using reference = value_type&;\n+  using iterator_category = std::random_access_iterator_tag;\n+\n+  // Some algorithms need to default-construct an iterator\n+  ChunkedArrayIterator() : chunked_array_(NULLPTR), index_(0), current_chunk_index_(0) {}\n+\n+  explicit ChunkedArrayIterator(const ChunkedArray& chunked_array, int64_t index = 0)\n+      : chunked_array_(&chunked_array), index_(index) {\n+    InitializeComponents(*this);\n+  }\n+\n+  // Value access\n+  value_type operator*() const { return *iterators_list_[current_chunk_index_]; }\n+\n+  value_type operator[](difference_type n) const {\n+    int64_t chunk_index = GetChunkIndex(index_ + n);\n+    int64_t index_in_chunk =\n+        chunk_index ? index_ + n - chunks_lengths_[chunk_index - 1] : index_ + n;\n+    return iterators_list_[chunk_index]\n+                          [index_in_chunk - iterators_list_[chunk_index].index()];\n\nReview Comment:\n   [`ChunkedArray`](https://github.com/apache/arrow/blob/master/cpp/src/arrow/chunked_array.h#L145) already has `GetScalar(index)` which is efficient for accessing sequential scalars at particular logical indices. I would expect this iterator to make use of it.\n\n\n\n",
                    "created": "2022-04-27T15:11:00.651+0000",
                    "updated": "2022-04-27T15:11:00.651+0000",
                    "started": "2022-04-27T15:11:00.651+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "762957",
                    "issueId": "13048263"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13048263/worklog/762958",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "edponce commented on code in PR #13009:\nURL: https://github.com/apache/arrow/pull/13009#discussion_r859921831\n\n\n##########\ncpp/src/arrow/stl_iterator.h:\n##########\n@@ -128,6 +131,215 @@ class ArrayIterator {\n   int64_t index_;\n };\n \n+template <typename ArrayType,\n+          typename ValueAccessor = detail::DefaultValueAccessor<ArrayType>>\n+class ChunkedArrayIterator {\n+ public:\n+  using value_type = arrow::util::optional<typename ValueAccessor::ValueType>;\n+  using difference_type = int64_t;\n+  using pointer = value_type*;\n+  using reference = value_type&;\n+  using iterator_category = std::random_access_iterator_tag;\n+\n+  // Some algorithms need to default-construct an iterator\n+  ChunkedArrayIterator() : chunked_array_(NULLPTR), index_(0), current_chunk_index_(0) {}\n+\n+  explicit ChunkedArrayIterator(const ChunkedArray& chunked_array, int64_t index = 0)\n+      : chunked_array_(&chunked_array), index_(index) {\n+    InitializeComponents(*this);\n+  }\n+\n+  // Value access\n+  value_type operator*() const { return *iterators_list_[current_chunk_index_]; }\n+\n+  value_type operator[](difference_type n) const {\n+    int64_t chunk_index = GetChunkIndex(index_ + n);\n+    int64_t index_in_chunk =\n+        chunk_index ? index_ + n - chunks_lengths_[chunk_index - 1] : index_ + n;\n+    return iterators_list_[chunk_index]\n+                          [index_in_chunk - iterators_list_[chunk_index].index()];\n\nReview Comment:\n   [`ChunkedArray` already has `GetScalar(index)`](https://github.com/apache/arrow/blob/master/cpp/src/arrow/chunked_array.h#L145) which is efficient for accessing sequential scalars at particular logical indices. I suggest to use it for the iteration.\n\n\n\n",
                    "created": "2022-04-27T15:12:15.844+0000",
                    "updated": "2022-04-27T15:12:15.844+0000",
                    "started": "2022-04-27T15:12:15.843+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "762958",
                    "issueId": "13048263"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13048263/worklog/762959",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "edponce commented on code in PR #13009:\nURL: https://github.com/apache/arrow/pull/13009#discussion_r859921831\n\n\n##########\ncpp/src/arrow/stl_iterator.h:\n##########\n@@ -128,6 +131,215 @@ class ArrayIterator {\n   int64_t index_;\n };\n \n+template <typename ArrayType,\n+          typename ValueAccessor = detail::DefaultValueAccessor<ArrayType>>\n+class ChunkedArrayIterator {\n+ public:\n+  using value_type = arrow::util::optional<typename ValueAccessor::ValueType>;\n+  using difference_type = int64_t;\n+  using pointer = value_type*;\n+  using reference = value_type&;\n+  using iterator_category = std::random_access_iterator_tag;\n+\n+  // Some algorithms need to default-construct an iterator\n+  ChunkedArrayIterator() : chunked_array_(NULLPTR), index_(0), current_chunk_index_(0) {}\n+\n+  explicit ChunkedArrayIterator(const ChunkedArray& chunked_array, int64_t index = 0)\n+      : chunked_array_(&chunked_array), index_(index) {\n+    InitializeComponents(*this);\n+  }\n+\n+  // Value access\n+  value_type operator*() const { return *iterators_list_[current_chunk_index_]; }\n+\n+  value_type operator[](difference_type n) const {\n+    int64_t chunk_index = GetChunkIndex(index_ + n);\n+    int64_t index_in_chunk =\n+        chunk_index ? index_ + n - chunks_lengths_[chunk_index - 1] : index_ + n;\n+    return iterators_list_[chunk_index]\n+                          [index_in_chunk - iterators_list_[chunk_index].index()];\n\nReview Comment:\n   [`ChunkedArray` already has `GetScalar(index)`](https://github.com/apache/arrow/blob/master/cpp/src/arrow/chunked_array.h#L145) which is efficient for accessing sequential scalars at particular logical indices. I suggest to use it for the iteration. There is no need to perform complex index calculations/checks in the iterator. This would be somewhat analogous to the [`Array` iterator`](https://github.com/apache/arrow/blob/master/cpp/src/arrow/stl_iterator.h#L61-L67).\n\n\n\n",
                    "created": "2022-04-27T15:15:46.442+0000",
                    "updated": "2022-04-27T15:15:46.442+0000",
                    "started": "2022-04-27T15:15:46.442+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "762959",
                    "issueId": "13048263"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13048263/worklog/762960",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "edponce commented on code in PR #13009:\nURL: https://github.com/apache/arrow/pull/13009#discussion_r859921831\n\n\n##########\ncpp/src/arrow/stl_iterator.h:\n##########\n@@ -128,6 +131,215 @@ class ArrayIterator {\n   int64_t index_;\n };\n \n+template <typename ArrayType,\n+          typename ValueAccessor = detail::DefaultValueAccessor<ArrayType>>\n+class ChunkedArrayIterator {\n+ public:\n+  using value_type = arrow::util::optional<typename ValueAccessor::ValueType>;\n+  using difference_type = int64_t;\n+  using pointer = value_type*;\n+  using reference = value_type&;\n+  using iterator_category = std::random_access_iterator_tag;\n+\n+  // Some algorithms need to default-construct an iterator\n+  ChunkedArrayIterator() : chunked_array_(NULLPTR), index_(0), current_chunk_index_(0) {}\n+\n+  explicit ChunkedArrayIterator(const ChunkedArray& chunked_array, int64_t index = 0)\n+      : chunked_array_(&chunked_array), index_(index) {\n+    InitializeComponents(*this);\n+  }\n+\n+  // Value access\n+  value_type operator*() const { return *iterators_list_[current_chunk_index_]; }\n+\n+  value_type operator[](difference_type n) const {\n+    int64_t chunk_index = GetChunkIndex(index_ + n);\n+    int64_t index_in_chunk =\n+        chunk_index ? index_ + n - chunks_lengths_[chunk_index - 1] : index_ + n;\n+    return iterators_list_[chunk_index]\n+                          [index_in_chunk - iterators_list_[chunk_index].index()];\n\nReview Comment:\n   [`ChunkedArray` already has `GetScalar(index)`](https://github.com/apache/arrow/blob/master/cpp/src/arrow/chunked_array.h#L145) which is efficient for accessing sequential scalars at particular logical indices. I suggest to use it for the iteration. There is no need to perform complex index calculations/checks in the iterator. This would be somewhat analogous to the [`Array` iterator](https://github.com/apache/arrow/blob/master/cpp/src/arrow/stl_iterator.h#L61-L67).\n\n\n\n",
                    "created": "2022-04-27T15:16:21.478+0000",
                    "updated": "2022-04-27T15:16:21.478+0000",
                    "started": "2022-04-27T15:16:21.478+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "762960",
                    "issueId": "13048263"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13048263/worklog/762977",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "pitrou commented on code in PR #13009:\nURL: https://github.com/apache/arrow/pull/13009#discussion_r859945687\n\n\n##########\ncpp/src/arrow/stl_iterator.h:\n##########\n@@ -128,6 +131,215 @@ class ArrayIterator {\n   int64_t index_;\n };\n \n+template <typename ArrayType,\n+          typename ValueAccessor = detail::DefaultValueAccessor<ArrayType>>\n+class ChunkedArrayIterator {\n+ public:\n+  using value_type = arrow::util::optional<typename ValueAccessor::ValueType>;\n+  using difference_type = int64_t;\n+  using pointer = value_type*;\n+  using reference = value_type&;\n+  using iterator_category = std::random_access_iterator_tag;\n+\n+  // Some algorithms need to default-construct an iterator\n+  ChunkedArrayIterator() : chunked_array_(NULLPTR), index_(0), current_chunk_index_(0) {}\n+\n+  explicit ChunkedArrayIterator(const ChunkedArray& chunked_array, int64_t index = 0)\n+      : chunked_array_(&chunked_array), index_(index) {\n+    InitializeComponents(*this);\n+  }\n+\n+  // Value access\n+  value_type operator*() const { return *iterators_list_[current_chunk_index_]; }\n+\n+  value_type operator[](difference_type n) const {\n+    int64_t chunk_index = GetChunkIndex(index_ + n);\n+    int64_t index_in_chunk =\n+        chunk_index ? index_ + n - chunks_lengths_[chunk_index - 1] : index_ + n;\n+    return iterators_list_[chunk_index]\n+                          [index_in_chunk - iterators_list_[chunk_index].index()];\n\nReview Comment:\n   @edponce The `GetScalar` suggestion doesn't seem right to me. The iterator should just yield C values, not boxed scalars which are much more expensive.\n\n\n\n",
                    "created": "2022-04-27T15:32:43.166+0000",
                    "updated": "2022-04-27T15:32:43.166+0000",
                    "started": "2022-04-27T15:32:43.166+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "762977",
                    "issueId": "13048263"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13048263/worklog/762991",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "edponce commented on code in PR #13009:\nURL: https://github.com/apache/arrow/pull/13009#discussion_r859953533\n\n\n##########\ncpp/src/arrow/stl_iterator.h:\n##########\n@@ -128,6 +131,215 @@ class ArrayIterator {\n   int64_t index_;\n };\n \n+template <typename ArrayType,\n+          typename ValueAccessor = detail::DefaultValueAccessor<ArrayType>>\n+class ChunkedArrayIterator {\n+ public:\n+  using value_type = arrow::util::optional<typename ValueAccessor::ValueType>;\n+  using difference_type = int64_t;\n+  using pointer = value_type*;\n+  using reference = value_type&;\n+  using iterator_category = std::random_access_iterator_tag;\n+\n+  // Some algorithms need to default-construct an iterator\n+  ChunkedArrayIterator() : chunked_array_(NULLPTR), index_(0), current_chunk_index_(0) {}\n+\n+  explicit ChunkedArrayIterator(const ChunkedArray& chunked_array, int64_t index = 0)\n+      : chunked_array_(&chunked_array), index_(index) {\n+    InitializeComponents(*this);\n+  }\n+\n+  // Value access\n+  value_type operator*() const { return *iterators_list_[current_chunk_index_]; }\n+\n+  value_type operator[](difference_type n) const {\n+    int64_t chunk_index = GetChunkIndex(index_ + n);\n+    int64_t index_in_chunk =\n+        chunk_index ? index_ + n - chunks_lengths_[chunk_index - 1] : index_ + n;\n+    return iterators_list_[chunk_index]\n+                          [index_in_chunk - iterators_list_[chunk_index].index()];\n\nReview Comment:\n   Ok, well what about adding a `GetView` method to `ChunkedArray` which invokes the `GetView` of the underlying `Arrays` and use the [`ChunkedResolver` to resolve the index](https://github.com/apache/arrow/blob/master/cpp/src/arrow/chunked_array.cc#L152-L157)?\n\n\n\n",
                    "created": "2022-04-27T15:40:03.786+0000",
                    "updated": "2022-04-27T15:40:03.786+0000",
                    "started": "2022-04-27T15:40:03.786+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "762991",
                    "issueId": "13048263"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13048263/worklog/762992",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "edponce commented on code in PR #13009:\nURL: https://github.com/apache/arrow/pull/13009#discussion_r859953533\n\n\n##########\ncpp/src/arrow/stl_iterator.h:\n##########\n@@ -128,6 +131,215 @@ class ArrayIterator {\n   int64_t index_;\n };\n \n+template <typename ArrayType,\n+          typename ValueAccessor = detail::DefaultValueAccessor<ArrayType>>\n+class ChunkedArrayIterator {\n+ public:\n+  using value_type = arrow::util::optional<typename ValueAccessor::ValueType>;\n+  using difference_type = int64_t;\n+  using pointer = value_type*;\n+  using reference = value_type&;\n+  using iterator_category = std::random_access_iterator_tag;\n+\n+  // Some algorithms need to default-construct an iterator\n+  ChunkedArrayIterator() : chunked_array_(NULLPTR), index_(0), current_chunk_index_(0) {}\n+\n+  explicit ChunkedArrayIterator(const ChunkedArray& chunked_array, int64_t index = 0)\n+      : chunked_array_(&chunked_array), index_(index) {\n+    InitializeComponents(*this);\n+  }\n+\n+  // Value access\n+  value_type operator*() const { return *iterators_list_[current_chunk_index_]; }\n+\n+  value_type operator[](difference_type n) const {\n+    int64_t chunk_index = GetChunkIndex(index_ + n);\n+    int64_t index_in_chunk =\n+        chunk_index ? index_ + n - chunks_lengths_[chunk_index - 1] : index_ + n;\n+    return iterators_list_[chunk_index]\n+                          [index_in_chunk - iterators_list_[chunk_index].index()];\n\nReview Comment:\n   Ok, well what about adding a `GetView` method to `ChunkedArray` which invokes the `GetView` of the underlying `Arrays` and use the [`ChunkedResolver` to resolve the logical index](https://github.com/apache/arrow/blob/master/cpp/src/arrow/chunked_array.cc#L152-L157)?\n\n\n\n",
                    "created": "2022-04-27T15:41:03.919+0000",
                    "updated": "2022-04-27T15:41:03.919+0000",
                    "started": "2022-04-27T15:41:03.918+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "762992",
                    "issueId": "13048263"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13048263/worklog/762995",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "pitrou commented on code in PR #13009:\nURL: https://github.com/apache/arrow/pull/13009#discussion_r859948262\n\n\n##########\ncpp/src/arrow/stl_iterator.h:\n##########\n@@ -128,6 +131,215 @@ class ArrayIterator {\n   int64_t index_;\n };\n \n+template <typename ArrayType,\n+          typename ValueAccessor = detail::DefaultValueAccessor<ArrayType>>\n+class ChunkedArrayIterator {\n+ public:\n+  using value_type = arrow::util::optional<typename ValueAccessor::ValueType>;\n+  using difference_type = int64_t;\n+  using pointer = value_type*;\n+  using reference = value_type&;\n+  using iterator_category = std::random_access_iterator_tag;\n+\n+  // Some algorithms need to default-construct an iterator\n+  ChunkedArrayIterator() : chunked_array_(NULLPTR), index_(0), current_chunk_index_(0) {}\n+\n+  explicit ChunkedArrayIterator(const ChunkedArray& chunked_array, int64_t index = 0)\n+      : chunked_array_(&chunked_array), index_(index) {\n+    InitializeComponents(*this);\n+  }\n+\n+  // Value access\n+  value_type operator*() const { return *iterators_list_[current_chunk_index_]; }\n+\n+  value_type operator[](difference_type n) const {\n+    int64_t chunk_index = GetChunkIndex(index_ + n);\n+    int64_t index_in_chunk =\n+        chunk_index ? index_ + n - chunks_lengths_[chunk_index - 1] : index_ + n;\n+    return iterators_list_[chunk_index]\n+                          [index_in_chunk - iterators_list_[chunk_index].index()];\n+  }\n+\n+  int64_t index() const { return index_; }\n+\n+  // Forward / backward\n+  ChunkedArrayIterator& operator++() {\n+    ++index_;\n+    if (iterators_list_[current_chunk_index_].index() ==\n+        static_cast<int64_t>(\n+            chunked_array_->chunk(static_cast<int>(current_chunk_index_))->length()) -\n+            1) {\n+      iterators_list_[current_chunk_index_] -=\n+          iterators_list_[current_chunk_index_].index();\n+      current_chunk_index_++;\n+      if (!static_cast<int64_t>(\n+              chunked_array_->chunk(static_cast<int>(current_chunk_index_))->length())) {\n+        current_chunk_index_ = GetChunkIndex(index_);\n+      }\n+      iterators_list_[current_chunk_index_] -=\n+          iterators_list_[current_chunk_index_].index();\n+    } else {\n+      iterators_list_[current_chunk_index_]++;\n+    }\n+    return *this;\n+  }\n+  ChunkedArrayIterator& operator--() {\n+    --index_;\n+    if (iterators_list_[current_chunk_index_].index()) {\n+      iterators_list_[current_chunk_index_]--;\n+    } else {\n+      iterators_list_[current_chunk_index_] -=\n+          iterators_list_[current_chunk_index_].index();\n+      current_chunk_index_--;\n+      if (!static_cast<int64_t>(\n+              chunked_array_->chunk(static_cast<int>(current_chunk_index_))->length())) {\n+        current_chunk_index_ = GetChunkIndex(index_);\n+      }\n+      iterators_list_[current_chunk_index_] -=\n+          iterators_list_[current_chunk_index_].index();\n+      iterators_list_[current_chunk_index_] +=\n+          static_cast<int64_t>(\n+              chunked_array_->chunk(static_cast<int>(current_chunk_index_))->length()) -\n+          1;\n+    }\n+    return *this;\n+  }\n+\n+  ChunkedArrayIterator operator++(int) {\n+    ChunkedArrayIterator tmp(*this);\n+    ++*this;\n+    return tmp;\n+  }\n+  ChunkedArrayIterator operator--(int) {\n+    ChunkedArrayIterator tmp(*this);\n+    --*this;\n+    return tmp;\n+  }\n+\n+  // Arithmetic\n+  difference_type operator-(const ChunkedArrayIterator& other) const {\n+    return index_ - other.index_;\n+  }\n+  ChunkedArrayIterator operator+(difference_type n) const {\n+    return ChunkedArrayIterator(*chunked_array_, index_ + n);\n+  }\n+  ChunkedArrayIterator operator-(difference_type n) const {\n+    return ChunkedArrayIterator(*chunked_array_, index_ - n);\n+  }\n+  friend inline ChunkedArrayIterator operator+(difference_type diff,\n+                                               const ChunkedArrayIterator& other) {\n+    return ChunkedArrayIterator(*other.chunked_array_, diff + other.index_);\n+  }\n+  friend inline ChunkedArrayIterator operator-(difference_type diff,\n+                                               const ChunkedArrayIterator& other) {\n+    return ChunkedArrayIterator(*other.chunked_array_, diff - other.index_);\n+  }\n+  ChunkedArrayIterator& operator+=(difference_type n) {\n+    if (n < static_cast<int64_t>(\n+                chunked_array_->chunk(static_cast<int>(current_chunk_index_))->length()) -\n+                iterators_list_[current_chunk_index_].index()) {\n+      index_ += n;\n+      iterators_list_[current_chunk_index_] += n;\n+      return *this;\n+    } else {\n+      iterators_list_[current_chunk_index_] -=\n+          iterators_list_[current_chunk_index_].index();\n+      index_ += n;\n+      InitializeComponents(*this, true);\n+      return *this;\n+    }\n+  }\n+  ChunkedArrayIterator& operator-=(difference_type n) {\n+    if (n <= iterators_list_[current_chunk_index_].index()) {\n+      index_ -= n;\n+      iterators_list_[current_chunk_index_] -= n;\n+      return *this;\n+    } else {\n+      iterators_list_[current_chunk_index_] -=\n+          iterators_list_[current_chunk_index_].index();\n+      index_ -= n;\n+      InitializeComponents(*this, true);\n+      return *this;\n+    }\n+  }\n+\n+  // Comparisons\n+  bool operator==(const ChunkedArrayIterator& other) const {\n+    return index_ == other.index_;\n+  }\n+  bool operator!=(const ChunkedArrayIterator& other) const {\n+    return index_ != other.index_;\n+  }\n+  bool operator<(const ChunkedArrayIterator& other) const {\n+    return index_ < other.index_;\n+  }\n+  bool operator>(const ChunkedArrayIterator& other) const {\n+    return index_ > other.index_;\n+  }\n+  bool operator<=(const ChunkedArrayIterator& other) const {\n+    return index_ <= other.index_;\n+  }\n+  bool operator>=(const ChunkedArrayIterator& other) const {\n+    return index_ >= other.index_;\n+  }\n+\n+ private:\n+  int64_t GetChunkIndex(int64_t index) const {\n+    return static_cast<int64_t>(\n+        std::upper_bound(chunks_lengths_.begin(), chunks_lengths_.end(), index) -\n+        chunks_lengths_.begin());\n\nReview Comment:\n   We have `ChunkResolver` now which can be used without needing to reinvent it (and which should generally be faster).\n\n\n\n",
                    "created": "2022-04-27T15:42:19.004+0000",
                    "updated": "2022-04-27T15:42:19.004+0000",
                    "started": "2022-04-27T15:42:19.004+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "762995",
                    "issueId": "13048263"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13048263/worklog/762996",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "edponce commented on code in PR #13009:\nURL: https://github.com/apache/arrow/pull/13009#discussion_r859956356\n\n\n##########\ncpp/src/arrow/stl_iterator.h:\n##########\n@@ -128,6 +131,215 @@ class ArrayIterator {\n   int64_t index_;\n };\n \n+template <typename ArrayType,\n+          typename ValueAccessor = detail::DefaultValueAccessor<ArrayType>>\n+class ChunkedArrayIterator {\n+ public:\n+  using value_type = arrow::util::optional<typename ValueAccessor::ValueType>;\n+  using difference_type = int64_t;\n+  using pointer = value_type*;\n+  using reference = value_type&;\n+  using iterator_category = std::random_access_iterator_tag;\n+\n+  // Some algorithms need to default-construct an iterator\n+  ChunkedArrayIterator() : chunked_array_(NULLPTR), index_(0), current_chunk_index_(0) {}\n+\n+  explicit ChunkedArrayIterator(const ChunkedArray& chunked_array, int64_t index = 0)\n+      : chunked_array_(&chunked_array), index_(index) {\n+    InitializeComponents(*this);\n+  }\n+\n+  // Value access\n+  value_type operator*() const { return *iterators_list_[current_chunk_index_]; }\n+\n+  value_type operator[](difference_type n) const {\n+    int64_t chunk_index = GetChunkIndex(index_ + n);\n+    int64_t index_in_chunk =\n+        chunk_index ? index_ + n - chunks_lengths_[chunk_index - 1] : index_ + n;\n+    return iterators_list_[chunk_index]\n+                          [index_in_chunk - iterators_list_[chunk_index].index()];\n+  }\n+\n+  int64_t index() const { return index_; }\n+\n+  // Forward / backward\n+  ChunkedArrayIterator& operator++() {\n+    ++index_;\n+    if (iterators_list_[current_chunk_index_].index() ==\n+        static_cast<int64_t>(\n+            chunked_array_->chunk(static_cast<int>(current_chunk_index_))->length()) -\n+            1) {\n+      iterators_list_[current_chunk_index_] -=\n+          iterators_list_[current_chunk_index_].index();\n+      current_chunk_index_++;\n+      if (!static_cast<int64_t>(\n+              chunked_array_->chunk(static_cast<int>(current_chunk_index_))->length())) {\n+        current_chunk_index_ = GetChunkIndex(index_);\n+      }\n+      iterators_list_[current_chunk_index_] -=\n+          iterators_list_[current_chunk_index_].index();\n+    } else {\n+      iterators_list_[current_chunk_index_]++;\n+    }\n+    return *this;\n+  }\n+  ChunkedArrayIterator& operator--() {\n+    --index_;\n+    if (iterators_list_[current_chunk_index_].index()) {\n+      iterators_list_[current_chunk_index_]--;\n+    } else {\n+      iterators_list_[current_chunk_index_] -=\n+          iterators_list_[current_chunk_index_].index();\n+      current_chunk_index_--;\n+      if (!static_cast<int64_t>(\n+              chunked_array_->chunk(static_cast<int>(current_chunk_index_))->length())) {\n+        current_chunk_index_ = GetChunkIndex(index_);\n+      }\n+      iterators_list_[current_chunk_index_] -=\n+          iterators_list_[current_chunk_index_].index();\n+      iterators_list_[current_chunk_index_] +=\n+          static_cast<int64_t>(\n+              chunked_array_->chunk(static_cast<int>(current_chunk_index_))->length()) -\n+          1;\n+    }\n+    return *this;\n+  }\n+\n+  ChunkedArrayIterator operator++(int) {\n+    ChunkedArrayIterator tmp(*this);\n+    ++*this;\n+    return tmp;\n+  }\n+  ChunkedArrayIterator operator--(int) {\n+    ChunkedArrayIterator tmp(*this);\n+    --*this;\n+    return tmp;\n+  }\n+\n+  // Arithmetic\n+  difference_type operator-(const ChunkedArrayIterator& other) const {\n+    return index_ - other.index_;\n+  }\n+  ChunkedArrayIterator operator+(difference_type n) const {\n+    return ChunkedArrayIterator(*chunked_array_, index_ + n);\n+  }\n+  ChunkedArrayIterator operator-(difference_type n) const {\n+    return ChunkedArrayIterator(*chunked_array_, index_ - n);\n+  }\n+  friend inline ChunkedArrayIterator operator+(difference_type diff,\n+                                               const ChunkedArrayIterator& other) {\n+    return ChunkedArrayIterator(*other.chunked_array_, diff + other.index_);\n+  }\n+  friend inline ChunkedArrayIterator operator-(difference_type diff,\n+                                               const ChunkedArrayIterator& other) {\n+    return ChunkedArrayIterator(*other.chunked_array_, diff - other.index_);\n+  }\n+  ChunkedArrayIterator& operator+=(difference_type n) {\n+    if (n < static_cast<int64_t>(\n+                chunked_array_->chunk(static_cast<int>(current_chunk_index_))->length()) -\n+                iterators_list_[current_chunk_index_].index()) {\n+      index_ += n;\n+      iterators_list_[current_chunk_index_] += n;\n+      return *this;\n+    } else {\n+      iterators_list_[current_chunk_index_] -=\n+          iterators_list_[current_chunk_index_].index();\n+      index_ += n;\n+      InitializeComponents(*this, true);\n+      return *this;\n+    }\n+  }\n+  ChunkedArrayIterator& operator-=(difference_type n) {\n+    if (n <= iterators_list_[current_chunk_index_].index()) {\n+      index_ -= n;\n+      iterators_list_[current_chunk_index_] -= n;\n+      return *this;\n+    } else {\n+      iterators_list_[current_chunk_index_] -=\n+          iterators_list_[current_chunk_index_].index();\n+      index_ -= n;\n+      InitializeComponents(*this, true);\n+      return *this;\n+    }\n+  }\n+\n+  // Comparisons\n+  bool operator==(const ChunkedArrayIterator& other) const {\n+    return index_ == other.index_;\n+  }\n+  bool operator!=(const ChunkedArrayIterator& other) const {\n+    return index_ != other.index_;\n+  }\n+  bool operator<(const ChunkedArrayIterator& other) const {\n+    return index_ < other.index_;\n+  }\n+  bool operator>(const ChunkedArrayIterator& other) const {\n+    return index_ > other.index_;\n+  }\n+  bool operator<=(const ChunkedArrayIterator& other) const {\n+    return index_ <= other.index_;\n+  }\n+  bool operator>=(const ChunkedArrayIterator& other) const {\n+    return index_ >= other.index_;\n+  }\n+\n+ private:\n+  int64_t GetChunkIndex(int64_t index) const {\n+    return static_cast<int64_t>(\n+        std::upper_bound(chunks_lengths_.begin(), chunks_lengths_.end(), index) -\n+        chunks_lengths_.begin());\n+  }\n+\n+  void InitializeComponents(ChunkedArrayIterator<ArrayType>& chunked_array_iterator,\n\nReview Comment:\n   Maybe call this `UpdateComponents` as it doesn't only initialize but is also used for updates.\n\n\n\n",
                    "created": "2022-04-27T15:42:44.055+0000",
                    "updated": "2022-04-27T15:42:44.055+0000",
                    "started": "2022-04-27T15:42:44.055+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "762996",
                    "issueId": "13048263"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13048263/worklog/762997",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "edponce commented on code in PR #13009:\nURL: https://github.com/apache/arrow/pull/13009#discussion_r859959406\n\n\n##########\ncpp/src/arrow/stl_iterator.h:\n##########\n@@ -128,6 +131,215 @@ class ArrayIterator {\n   int64_t index_;\n };\n \n+template <typename ArrayType,\n+          typename ValueAccessor = detail::DefaultValueAccessor<ArrayType>>\n+class ChunkedArrayIterator {\n+ public:\n+  using value_type = arrow::util::optional<typename ValueAccessor::ValueType>;\n+  using difference_type = int64_t;\n+  using pointer = value_type*;\n+  using reference = value_type&;\n+  using iterator_category = std::random_access_iterator_tag;\n+\n+  // Some algorithms need to default-construct an iterator\n+  ChunkedArrayIterator() : chunked_array_(NULLPTR), index_(0), current_chunk_index_(0) {}\n+\n+  explicit ChunkedArrayIterator(const ChunkedArray& chunked_array, int64_t index = 0)\n+      : chunked_array_(&chunked_array), index_(index) {\n+    InitializeComponents(*this);\n+  }\n+\n+  // Value access\n+  value_type operator*() const { return *iterators_list_[current_chunk_index_]; }\n+\n+  value_type operator[](difference_type n) const {\n+    int64_t chunk_index = GetChunkIndex(index_ + n);\n+    int64_t index_in_chunk =\n+        chunk_index ? index_ + n - chunks_lengths_[chunk_index - 1] : index_ + n;\n+    return iterators_list_[chunk_index]\n+                          [index_in_chunk - iterators_list_[chunk_index].index()];\n\nReview Comment:\n   Well, ok I see that it is using the `Array` iterators.\n\n\n\n",
                    "created": "2022-04-27T15:45:39.385+0000",
                    "updated": "2022-04-27T15:45:39.385+0000",
                    "started": "2022-04-27T15:45:39.384+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "762997",
                    "issueId": "13048263"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13048263/worklog/762998",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "edponce commented on code in PR #13009:\nURL: https://github.com/apache/arrow/pull/13009#discussion_r859959406\n\n\n##########\ncpp/src/arrow/stl_iterator.h:\n##########\n@@ -128,6 +131,215 @@ class ArrayIterator {\n   int64_t index_;\n };\n \n+template <typename ArrayType,\n+          typename ValueAccessor = detail::DefaultValueAccessor<ArrayType>>\n+class ChunkedArrayIterator {\n+ public:\n+  using value_type = arrow::util::optional<typename ValueAccessor::ValueType>;\n+  using difference_type = int64_t;\n+  using pointer = value_type*;\n+  using reference = value_type&;\n+  using iterator_category = std::random_access_iterator_tag;\n+\n+  // Some algorithms need to default-construct an iterator\n+  ChunkedArrayIterator() : chunked_array_(NULLPTR), index_(0), current_chunk_index_(0) {}\n+\n+  explicit ChunkedArrayIterator(const ChunkedArray& chunked_array, int64_t index = 0)\n+      : chunked_array_(&chunked_array), index_(index) {\n+    InitializeComponents(*this);\n+  }\n+\n+  // Value access\n+  value_type operator*() const { return *iterators_list_[current_chunk_index_]; }\n+\n+  value_type operator[](difference_type n) const {\n+    int64_t chunk_index = GetChunkIndex(index_ + n);\n+    int64_t index_in_chunk =\n+        chunk_index ? index_ + n - chunks_lengths_[chunk_index - 1] : index_ + n;\n+    return iterators_list_[chunk_index]\n+                          [index_in_chunk - iterators_list_[chunk_index].index()];\n\nReview Comment:\n   Well, ok I see now that it is using the `Array` iterators.\n\n\n\n",
                    "created": "2022-04-27T15:45:54.426+0000",
                    "updated": "2022-04-27T15:45:54.426+0000",
                    "started": "2022-04-27T15:45:54.425+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "762998",
                    "issueId": "13048263"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13048263/worklog/763010",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "edponce commented on code in PR #13009:\nURL: https://github.com/apache/arrow/pull/13009#discussion_r859978529\n\n\n##########\ncpp/src/arrow/stl_iterator.h:\n##########\n@@ -128,6 +131,215 @@ class ArrayIterator {\n   int64_t index_;\n };\n \n+template <typename ArrayType,\n+          typename ValueAccessor = detail::DefaultValueAccessor<ArrayType>>\n+class ChunkedArrayIterator {\n+ public:\n+  using value_type = arrow::util::optional<typename ValueAccessor::ValueType>;\n+  using difference_type = int64_t;\n+  using pointer = value_type*;\n+  using reference = value_type&;\n+  using iterator_category = std::random_access_iterator_tag;\n+\n+  // Some algorithms need to default-construct an iterator\n+  ChunkedArrayIterator() : chunked_array_(NULLPTR), index_(0), current_chunk_index_(0) {}\n+\n+  explicit ChunkedArrayIterator(const ChunkedArray& chunked_array, int64_t index = 0)\n+      : chunked_array_(&chunked_array), index_(index) {\n+    InitializeComponents(*this);\n+  }\n+\n+  // Value access\n+  value_type operator*() const { return *iterators_list_[current_chunk_index_]; }\n+\n+  value_type operator[](difference_type n) const {\n+    int64_t chunk_index = GetChunkIndex(index_ + n);\n+    int64_t index_in_chunk =\n+        chunk_index ? index_ + n - chunks_lengths_[chunk_index - 1] : index_ + n;\n+    return iterators_list_[chunk_index]\n+                          [index_in_chunk - iterators_list_[chunk_index].index()];\n+  }\n+\n+  int64_t index() const { return index_; }\n+\n+  // Forward / backward\n+  ChunkedArrayIterator& operator++() {\n+    ++index_;\n+    if (iterators_list_[current_chunk_index_].index() ==\n+        static_cast<int64_t>(\n+            chunked_array_->chunk(static_cast<int>(current_chunk_index_))->length()) -\n+            1) {\n+      iterators_list_[current_chunk_index_] -=\n+          iterators_list_[current_chunk_index_].index();\n+      current_chunk_index_++;\n+      if (!static_cast<int64_t>(\n+              chunked_array_->chunk(static_cast<int>(current_chunk_index_))->length())) {\n+        current_chunk_index_ = GetChunkIndex(index_);\n+      }\n+      iterators_list_[current_chunk_index_] -=\n+          iterators_list_[current_chunk_index_].index();\n+    } else {\n+      iterators_list_[current_chunk_index_]++;\n+    }\n+    return *this;\n+  }\n+  ChunkedArrayIterator& operator--() {\n+    --index_;\n+    if (iterators_list_[current_chunk_index_].index()) {\n+      iterators_list_[current_chunk_index_]--;\n+    } else {\n+      iterators_list_[current_chunk_index_] -=\n+          iterators_list_[current_chunk_index_].index();\n+      current_chunk_index_--;\n+      if (!static_cast<int64_t>(\n+              chunked_array_->chunk(static_cast<int>(current_chunk_index_))->length())) {\n+        current_chunk_index_ = GetChunkIndex(index_);\n+      }\n+      iterators_list_[current_chunk_index_] -=\n+          iterators_list_[current_chunk_index_].index();\n+      iterators_list_[current_chunk_index_] +=\n+          static_cast<int64_t>(\n+              chunked_array_->chunk(static_cast<int>(current_chunk_index_))->length()) -\n+          1;\n+    }\n+    return *this;\n+  }\n+\n+  ChunkedArrayIterator operator++(int) {\n+    ChunkedArrayIterator tmp(*this);\n+    ++*this;\n+    return tmp;\n+  }\n+  ChunkedArrayIterator operator--(int) {\n+    ChunkedArrayIterator tmp(*this);\n+    --*this;\n+    return tmp;\n+  }\n+\n+  // Arithmetic\n+  difference_type operator-(const ChunkedArrayIterator& other) const {\n+    return index_ - other.index_;\n+  }\n+  ChunkedArrayIterator operator+(difference_type n) const {\n+    return ChunkedArrayIterator(*chunked_array_, index_ + n);\n+  }\n+  ChunkedArrayIterator operator-(difference_type n) const {\n+    return ChunkedArrayIterator(*chunked_array_, index_ - n);\n+  }\n+  friend inline ChunkedArrayIterator operator+(difference_type diff,\n+                                               const ChunkedArrayIterator& other) {\n+    return ChunkedArrayIterator(*other.chunked_array_, diff + other.index_);\n+  }\n+  friend inline ChunkedArrayIterator operator-(difference_type diff,\n+                                               const ChunkedArrayIterator& other) {\n+    return ChunkedArrayIterator(*other.chunked_array_, diff - other.index_);\n+  }\n+  ChunkedArrayIterator& operator+=(difference_type n) {\n+    if (n < static_cast<int64_t>(\n+                chunked_array_->chunk(static_cast<int>(current_chunk_index_))->length()) -\n+                iterators_list_[current_chunk_index_].index()) {\n+      index_ += n;\n+      iterators_list_[current_chunk_index_] += n;\n+      return *this;\n+    } else {\n+      iterators_list_[current_chunk_index_] -=\n+          iterators_list_[current_chunk_index_].index();\n+      index_ += n;\n+      InitializeComponents(*this, true);\n+      return *this;\n+    }\n+  }\n+  ChunkedArrayIterator& operator-=(difference_type n) {\n+    if (n <= iterators_list_[current_chunk_index_].index()) {\n+      index_ -= n;\n+      iterators_list_[current_chunk_index_] -= n;\n+      return *this;\n+    } else {\n+      iterators_list_[current_chunk_index_] -=\n+          iterators_list_[current_chunk_index_].index();\n+      index_ -= n;\n+      InitializeComponents(*this, true);\n+      return *this;\n+    }\n+  }\n+\n+  // Comparisons\n+  bool operator==(const ChunkedArrayIterator& other) const {\n+    return index_ == other.index_;\n+  }\n+  bool operator!=(const ChunkedArrayIterator& other) const {\n+    return index_ != other.index_;\n+  }\n+  bool operator<(const ChunkedArrayIterator& other) const {\n+    return index_ < other.index_;\n+  }\n+  bool operator>(const ChunkedArrayIterator& other) const {\n+    return index_ > other.index_;\n+  }\n+  bool operator<=(const ChunkedArrayIterator& other) const {\n+    return index_ <= other.index_;\n+  }\n+  bool operator>=(const ChunkedArrayIterator& other) const {\n+    return index_ >= other.index_;\n+  }\n+\n+ private:\n+  int64_t GetChunkIndex(int64_t index) const {\n+    return static_cast<int64_t>(\n+        std::upper_bound(chunks_lengths_.begin(), chunks_lengths_.end(), index) -\n+        chunks_lengths_.begin());\n+  }\n+\n+  void InitializeComponents(ChunkedArrayIterator<ArrayType>& chunked_array_iterator,\n+                            bool update = false) {\n+    if (!update) {\n+      int64_t chunk_index = 0;\n+      for (const auto& array : chunked_array_iterator.chunked_array_->chunks()) {\n+        chunked_array_iterator.iterators_list_.emplace_back(\n+            *arrow::internal::checked_pointer_cast<ArrayType>(array));\n+        auto chunk_length = static_cast<int64_t>(array->length());\n+        if (chunk_index) {\n+          chunked_array_iterator.chunks_lengths_.push_back(\n+              chunk_length + chunked_array_iterator.chunks_lengths_[chunk_index - 1]);\n+        } else {\n+          chunked_array_iterator.chunks_lengths_.push_back(chunk_length);\n+        }\n+        chunk_index++;\n\nReview Comment:\n   Nit: Factor out the push_back operation from the `if-else`\r\n   ```c++\r\n   auto chunk_length = ...;\r\n   if (chunk_index) {\r\n      chunk_length += chunked_array_iterator.chunks_lengths_[chunk_index - 1]);\r\n   }\r\n   chunked_array_iterator.chunks_lengths_.push_back(chunk_length);\r\n   ```\n\n\n\n",
                    "created": "2022-04-27T16:03:27.774+0000",
                    "updated": "2022-04-27T16:03:27.774+0000",
                    "started": "2022-04-27T16:03:27.773+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "763010",
                    "issueId": "13048263"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13048263/worklog/763015",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "edponce commented on code in PR #13009:\nURL: https://github.com/apache/arrow/pull/13009#discussion_r859983654\n\n\n##########\ncpp/src/arrow/stl_iterator.h:\n##########\n@@ -128,6 +131,215 @@ class ArrayIterator {\n   int64_t index_;\n };\n \n+template <typename ArrayType,\n+          typename ValueAccessor = detail::DefaultValueAccessor<ArrayType>>\n+class ChunkedArrayIterator {\n+ public:\n+  using value_type = arrow::util::optional<typename ValueAccessor::ValueType>;\n+  using difference_type = int64_t;\n+  using pointer = value_type*;\n+  using reference = value_type&;\n+  using iterator_category = std::random_access_iterator_tag;\n+\n+  // Some algorithms need to default-construct an iterator\n+  ChunkedArrayIterator() : chunked_array_(NULLPTR), index_(0), current_chunk_index_(0) {}\n+\n+  explicit ChunkedArrayIterator(const ChunkedArray& chunked_array, int64_t index = 0)\n+      : chunked_array_(&chunked_array), index_(index) {\n+    InitializeComponents(*this);\n+  }\n+\n+  // Value access\n+  value_type operator*() const { return *iterators_list_[current_chunk_index_]; }\n+\n+  value_type operator[](difference_type n) const {\n+    int64_t chunk_index = GetChunkIndex(index_ + n);\n+    int64_t index_in_chunk =\n+        chunk_index ? index_ + n - chunks_lengths_[chunk_index - 1] : index_ + n;\n+    return iterators_list_[chunk_index]\n+                          [index_in_chunk - iterators_list_[chunk_index].index()];\n+  }\n+\n+  int64_t index() const { return index_; }\n+\n+  // Forward / backward\n+  ChunkedArrayIterator& operator++() {\n+    ++index_;\n+    if (iterators_list_[current_chunk_index_].index() ==\n+        static_cast<int64_t>(\n+            chunked_array_->chunk(static_cast<int>(current_chunk_index_))->length()) -\n+            1) {\n+      iterators_list_[current_chunk_index_] -=\n+          iterators_list_[current_chunk_index_].index();\n+      current_chunk_index_++;\n+      if (!static_cast<int64_t>(\n+              chunked_array_->chunk(static_cast<int>(current_chunk_index_))->length())) {\n+        current_chunk_index_ = GetChunkIndex(index_);\n+      }\n+      iterators_list_[current_chunk_index_] -=\n+          iterators_list_[current_chunk_index_].index();\n+    } else {\n+      iterators_list_[current_chunk_index_]++;\n+    }\n+    return *this;\n+  }\n+  ChunkedArrayIterator& operator--() {\n+    --index_;\n+    if (iterators_list_[current_chunk_index_].index()) {\n+      iterators_list_[current_chunk_index_]--;\n+    } else {\n+      iterators_list_[current_chunk_index_] -=\n+          iterators_list_[current_chunk_index_].index();\n+      current_chunk_index_--;\n+      if (!static_cast<int64_t>(\n+              chunked_array_->chunk(static_cast<int>(current_chunk_index_))->length())) {\n+        current_chunk_index_ = GetChunkIndex(index_);\n+      }\n+      iterators_list_[current_chunk_index_] -=\n+          iterators_list_[current_chunk_index_].index();\n+      iterators_list_[current_chunk_index_] +=\n+          static_cast<int64_t>(\n+              chunked_array_->chunk(static_cast<int>(current_chunk_index_))->length()) -\n+          1;\n+    }\n+    return *this;\n+  }\n+\n+  ChunkedArrayIterator operator++(int) {\n+    ChunkedArrayIterator tmp(*this);\n+    ++*this;\n+    return tmp;\n+  }\n+  ChunkedArrayIterator operator--(int) {\n+    ChunkedArrayIterator tmp(*this);\n+    --*this;\n+    return tmp;\n+  }\n+\n+  // Arithmetic\n+  difference_type operator-(const ChunkedArrayIterator& other) const {\n+    return index_ - other.index_;\n+  }\n+  ChunkedArrayIterator operator+(difference_type n) const {\n+    return ChunkedArrayIterator(*chunked_array_, index_ + n);\n+  }\n+  ChunkedArrayIterator operator-(difference_type n) const {\n+    return ChunkedArrayIterator(*chunked_array_, index_ - n);\n+  }\n+  friend inline ChunkedArrayIterator operator+(difference_type diff,\n+                                               const ChunkedArrayIterator& other) {\n+    return ChunkedArrayIterator(*other.chunked_array_, diff + other.index_);\n+  }\n+  friend inline ChunkedArrayIterator operator-(difference_type diff,\n+                                               const ChunkedArrayIterator& other) {\n+    return ChunkedArrayIterator(*other.chunked_array_, diff - other.index_);\n+  }\n+  ChunkedArrayIterator& operator+=(difference_type n) {\n+    if (n < static_cast<int64_t>(\n+                chunked_array_->chunk(static_cast<int>(current_chunk_index_))->length()) -\n+                iterators_list_[current_chunk_index_].index()) {\n+      index_ += n;\n+      iterators_list_[current_chunk_index_] += n;\n+      return *this;\n+    } else {\n+      iterators_list_[current_chunk_index_] -=\n+          iterators_list_[current_chunk_index_].index();\n+      index_ += n;\n+      InitializeComponents(*this, true);\n+      return *this;\n+    }\n+  }\n+  ChunkedArrayIterator& operator-=(difference_type n) {\n+    if (n <= iterators_list_[current_chunk_index_].index()) {\n+      index_ -= n;\n+      iterators_list_[current_chunk_index_] -= n;\n+      return *this;\n+    } else {\n+      iterators_list_[current_chunk_index_] -=\n+          iterators_list_[current_chunk_index_].index();\n+      index_ -= n;\n+      InitializeComponents(*this, true);\n+      return *this;\n+    }\n+  }\n+\n+  // Comparisons\n+  bool operator==(const ChunkedArrayIterator& other) const {\n+    return index_ == other.index_;\n+  }\n+  bool operator!=(const ChunkedArrayIterator& other) const {\n+    return index_ != other.index_;\n+  }\n+  bool operator<(const ChunkedArrayIterator& other) const {\n+    return index_ < other.index_;\n+  }\n+  bool operator>(const ChunkedArrayIterator& other) const {\n+    return index_ > other.index_;\n+  }\n+  bool operator<=(const ChunkedArrayIterator& other) const {\n+    return index_ <= other.index_;\n+  }\n+  bool operator>=(const ChunkedArrayIterator& other) const {\n+    return index_ >= other.index_;\n+  }\n+\n+ private:\n+  int64_t GetChunkIndex(int64_t index) const {\n+    return static_cast<int64_t>(\n+        std::upper_bound(chunks_lengths_.begin(), chunks_lengths_.end(), index) -\n+        chunks_lengths_.begin());\n+  }\n+\n+  void InitializeComponents(ChunkedArrayIterator<ArrayType>& chunked_array_iterator,\n+                            bool update = false) {\n+    if (!update) {\n+      int64_t chunk_index = 0;\n+      for (const auto& array : chunked_array_iterator.chunked_array_->chunks()) {\n+        chunked_array_iterator.iterators_list_.emplace_back(\n+            *arrow::internal::checked_pointer_cast<ArrayType>(array));\n+        auto chunk_length = static_cast<int64_t>(array->length());\n+        if (chunk_index) {\n+          chunked_array_iterator.chunks_lengths_.push_back(\n+              chunk_length + chunked_array_iterator.chunks_lengths_[chunk_index - 1]);\n+        } else {\n+          chunked_array_iterator.chunks_lengths_.push_back(chunk_length);\n+        }\n+        chunk_index++;\n+      }\n+    }\n+\n+    chunked_array_iterator.current_chunk_index_ =\n+        GetChunkIndex(chunked_array_iterator.index_);\n+    auto& current_iterator =\n+        chunked_array_iterator\n+            .iterators_list_[chunked_array_iterator.current_chunk_index_];\n+    current_iterator -= current_iterator.index();\n+    if (chunked_array_iterator.current_chunk_index_)\n+      current_iterator +=\n+          chunked_array_iterator.index_ -\n+          chunked_array_iterator\n+              .chunks_lengths_[chunked_array_iterator.current_chunk_index_ - 1];\n+    else\n+      current_iterator += chunked_array_iterator.index_;\n+  }\n\nReview Comment:\n   Not sure if this is enforced in Arrow but I suggest to always use curly-braces for `if-else` blocks.\r\n   Nit: This can be simplified to\r\n   ```c++\r\n   auto& current_iterator = chunked_array_iterator.iterators_list_[chunked_array_iterator.current_chunk_index_] - current_iterator.index() + chunked_array_iterator.index_;\r\n   if (chunked_array_iterator.current_chunk_index_) {\r\n     current_iterator += chunked_array_iterator.chunks_lengths_[chunked_array_iterator.current_chunk_index_ - 1];\r\n   }\r\n   ```\n\n\n\n",
                    "created": "2022-04-27T16:08:42.714+0000",
                    "updated": "2022-04-27T16:08:42.714+0000",
                    "started": "2022-04-27T16:08:42.713+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "763015",
                    "issueId": "13048263"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13048263/worklog/763019",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "edponce commented on code in PR #13009:\nURL: https://github.com/apache/arrow/pull/13009#discussion_r859988212\n\n\n##########\ncpp/src/arrow/stl_iterator.h:\n##########\n@@ -128,6 +131,215 @@ class ArrayIterator {\n   int64_t index_;\n };\n \n+template <typename ArrayType,\n+          typename ValueAccessor = detail::DefaultValueAccessor<ArrayType>>\n+class ChunkedArrayIterator {\n+ public:\n+  using value_type = arrow::util::optional<typename ValueAccessor::ValueType>;\n+  using difference_type = int64_t;\n+  using pointer = value_type*;\n+  using reference = value_type&;\n+  using iterator_category = std::random_access_iterator_tag;\n+\n+  // Some algorithms need to default-construct an iterator\n+  ChunkedArrayIterator() : chunked_array_(NULLPTR), index_(0), current_chunk_index_(0) {}\n+\n+  explicit ChunkedArrayIterator(const ChunkedArray& chunked_array, int64_t index = 0)\n+      : chunked_array_(&chunked_array), index_(index) {\n+    InitializeComponents(*this);\n+  }\n+\n+  // Value access\n+  value_type operator*() const { return *iterators_list_[current_chunk_index_]; }\n+\n+  value_type operator[](difference_type n) const {\n+    int64_t chunk_index = GetChunkIndex(index_ + n);\n+    int64_t index_in_chunk =\n+        chunk_index ? index_ + n - chunks_lengths_[chunk_index - 1] : index_ + n;\n+    return iterators_list_[chunk_index]\n+                          [index_in_chunk - iterators_list_[chunk_index].index()];\n+  }\n+\n+  int64_t index() const { return index_; }\n+\n+  // Forward / backward\n+  ChunkedArrayIterator& operator++() {\n+    ++index_;\n+    if (iterators_list_[current_chunk_index_].index() ==\n+        static_cast<int64_t>(\n+            chunked_array_->chunk(static_cast<int>(current_chunk_index_))->length()) -\n+            1) {\n+      iterators_list_[current_chunk_index_] -=\n+          iterators_list_[current_chunk_index_].index();\n+      current_chunk_index_++;\n+      if (!static_cast<int64_t>(\n+              chunked_array_->chunk(static_cast<int>(current_chunk_index_))->length())) {\n+        current_chunk_index_ = GetChunkIndex(index_);\n+      }\n+      iterators_list_[current_chunk_index_] -=\n+          iterators_list_[current_chunk_index_].index();\n+    } else {\n+      iterators_list_[current_chunk_index_]++;\n+    }\n+    return *this;\n+  }\n+  ChunkedArrayIterator& operator--() {\n+    --index_;\n+    if (iterators_list_[current_chunk_index_].index()) {\n+      iterators_list_[current_chunk_index_]--;\n+    } else {\n+      iterators_list_[current_chunk_index_] -=\n+          iterators_list_[current_chunk_index_].index();\n+      current_chunk_index_--;\n+      if (!static_cast<int64_t>(\n+              chunked_array_->chunk(static_cast<int>(current_chunk_index_))->length())) {\n+        current_chunk_index_ = GetChunkIndex(index_);\n+      }\n+      iterators_list_[current_chunk_index_] -=\n+          iterators_list_[current_chunk_index_].index();\n+      iterators_list_[current_chunk_index_] +=\n+          static_cast<int64_t>(\n+              chunked_array_->chunk(static_cast<int>(current_chunk_index_))->length()) -\n+          1;\n+    }\n+    return *this;\n+  }\n+\n+  ChunkedArrayIterator operator++(int) {\n+    ChunkedArrayIterator tmp(*this);\n+    ++*this;\n+    return tmp;\n+  }\n+  ChunkedArrayIterator operator--(int) {\n+    ChunkedArrayIterator tmp(*this);\n+    --*this;\n+    return tmp;\n+  }\n+\n+  // Arithmetic\n+  difference_type operator-(const ChunkedArrayIterator& other) const {\n+    return index_ - other.index_;\n+  }\n+  ChunkedArrayIterator operator+(difference_type n) const {\n+    return ChunkedArrayIterator(*chunked_array_, index_ + n);\n+  }\n+  ChunkedArrayIterator operator-(difference_type n) const {\n+    return ChunkedArrayIterator(*chunked_array_, index_ - n);\n+  }\n+  friend inline ChunkedArrayIterator operator+(difference_type diff,\n+                                               const ChunkedArrayIterator& other) {\n+    return ChunkedArrayIterator(*other.chunked_array_, diff + other.index_);\n+  }\n+  friend inline ChunkedArrayIterator operator-(difference_type diff,\n+                                               const ChunkedArrayIterator& other) {\n+    return ChunkedArrayIterator(*other.chunked_array_, diff - other.index_);\n+  }\n+  ChunkedArrayIterator& operator+=(difference_type n) {\n+    if (n < static_cast<int64_t>(\n+                chunked_array_->chunk(static_cast<int>(current_chunk_index_))->length()) -\n+                iterators_list_[current_chunk_index_].index()) {\n+      index_ += n;\n+      iterators_list_[current_chunk_index_] += n;\n+      return *this;\n+    } else {\n+      iterators_list_[current_chunk_index_] -=\n+          iterators_list_[current_chunk_index_].index();\n+      index_ += n;\n+      InitializeComponents(*this, true);\n+      return *this;\n+    }\n+  }\n+  ChunkedArrayIterator& operator-=(difference_type n) {\n+    if (n <= iterators_list_[current_chunk_index_].index()) {\n+      index_ -= n;\n+      iterators_list_[current_chunk_index_] -= n;\n+      return *this;\n+    } else {\n+      iterators_list_[current_chunk_index_] -=\n+          iterators_list_[current_chunk_index_].index();\n+      index_ -= n;\n+      InitializeComponents(*this, true);\n+      return *this;\n+    }\n+  }\n\nReview Comment:\n   This can be simplified to have a single impl because `operator-=(n) == operator+=(-n)`\n\n\n\n",
                    "created": "2022-04-27T16:13:13.283+0000",
                    "updated": "2022-04-27T16:13:13.283+0000",
                    "started": "2022-04-27T16:13:13.283+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "763019",
                    "issueId": "13048263"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13048263/worklog/763020",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "edponce commented on code in PR #13009:\nURL: https://github.com/apache/arrow/pull/13009#discussion_r859988212\n\n\n##########\ncpp/src/arrow/stl_iterator.h:\n##########\n@@ -128,6 +131,215 @@ class ArrayIterator {\n   int64_t index_;\n };\n \n+template <typename ArrayType,\n+          typename ValueAccessor = detail::DefaultValueAccessor<ArrayType>>\n+class ChunkedArrayIterator {\n+ public:\n+  using value_type = arrow::util::optional<typename ValueAccessor::ValueType>;\n+  using difference_type = int64_t;\n+  using pointer = value_type*;\n+  using reference = value_type&;\n+  using iterator_category = std::random_access_iterator_tag;\n+\n+  // Some algorithms need to default-construct an iterator\n+  ChunkedArrayIterator() : chunked_array_(NULLPTR), index_(0), current_chunk_index_(0) {}\n+\n+  explicit ChunkedArrayIterator(const ChunkedArray& chunked_array, int64_t index = 0)\n+      : chunked_array_(&chunked_array), index_(index) {\n+    InitializeComponents(*this);\n+  }\n+\n+  // Value access\n+  value_type operator*() const { return *iterators_list_[current_chunk_index_]; }\n+\n+  value_type operator[](difference_type n) const {\n+    int64_t chunk_index = GetChunkIndex(index_ + n);\n+    int64_t index_in_chunk =\n+        chunk_index ? index_ + n - chunks_lengths_[chunk_index - 1] : index_ + n;\n+    return iterators_list_[chunk_index]\n+                          [index_in_chunk - iterators_list_[chunk_index].index()];\n+  }\n+\n+  int64_t index() const { return index_; }\n+\n+  // Forward / backward\n+  ChunkedArrayIterator& operator++() {\n+    ++index_;\n+    if (iterators_list_[current_chunk_index_].index() ==\n+        static_cast<int64_t>(\n+            chunked_array_->chunk(static_cast<int>(current_chunk_index_))->length()) -\n+            1) {\n+      iterators_list_[current_chunk_index_] -=\n+          iterators_list_[current_chunk_index_].index();\n+      current_chunk_index_++;\n+      if (!static_cast<int64_t>(\n+              chunked_array_->chunk(static_cast<int>(current_chunk_index_))->length())) {\n+        current_chunk_index_ = GetChunkIndex(index_);\n+      }\n+      iterators_list_[current_chunk_index_] -=\n+          iterators_list_[current_chunk_index_].index();\n+    } else {\n+      iterators_list_[current_chunk_index_]++;\n+    }\n+    return *this;\n+  }\n+  ChunkedArrayIterator& operator--() {\n+    --index_;\n+    if (iterators_list_[current_chunk_index_].index()) {\n+      iterators_list_[current_chunk_index_]--;\n+    } else {\n+      iterators_list_[current_chunk_index_] -=\n+          iterators_list_[current_chunk_index_].index();\n+      current_chunk_index_--;\n+      if (!static_cast<int64_t>(\n+              chunked_array_->chunk(static_cast<int>(current_chunk_index_))->length())) {\n+        current_chunk_index_ = GetChunkIndex(index_);\n+      }\n+      iterators_list_[current_chunk_index_] -=\n+          iterators_list_[current_chunk_index_].index();\n+      iterators_list_[current_chunk_index_] +=\n+          static_cast<int64_t>(\n+              chunked_array_->chunk(static_cast<int>(current_chunk_index_))->length()) -\n+          1;\n+    }\n+    return *this;\n+  }\n+\n+  ChunkedArrayIterator operator++(int) {\n+    ChunkedArrayIterator tmp(*this);\n+    ++*this;\n+    return tmp;\n+  }\n+  ChunkedArrayIterator operator--(int) {\n+    ChunkedArrayIterator tmp(*this);\n+    --*this;\n+    return tmp;\n+  }\n+\n+  // Arithmetic\n+  difference_type operator-(const ChunkedArrayIterator& other) const {\n+    return index_ - other.index_;\n+  }\n+  ChunkedArrayIterator operator+(difference_type n) const {\n+    return ChunkedArrayIterator(*chunked_array_, index_ + n);\n+  }\n+  ChunkedArrayIterator operator-(difference_type n) const {\n+    return ChunkedArrayIterator(*chunked_array_, index_ - n);\n+  }\n+  friend inline ChunkedArrayIterator operator+(difference_type diff,\n+                                               const ChunkedArrayIterator& other) {\n+    return ChunkedArrayIterator(*other.chunked_array_, diff + other.index_);\n+  }\n+  friend inline ChunkedArrayIterator operator-(difference_type diff,\n+                                               const ChunkedArrayIterator& other) {\n+    return ChunkedArrayIterator(*other.chunked_array_, diff - other.index_);\n+  }\n+  ChunkedArrayIterator& operator+=(difference_type n) {\n+    if (n < static_cast<int64_t>(\n+                chunked_array_->chunk(static_cast<int>(current_chunk_index_))->length()) -\n+                iterators_list_[current_chunk_index_].index()) {\n+      index_ += n;\n+      iterators_list_[current_chunk_index_] += n;\n+      return *this;\n+    } else {\n+      iterators_list_[current_chunk_index_] -=\n+          iterators_list_[current_chunk_index_].index();\n+      index_ += n;\n+      InitializeComponents(*this, true);\n+      return *this;\n+    }\n+  }\n+  ChunkedArrayIterator& operator-=(difference_type n) {\n+    if (n <= iterators_list_[current_chunk_index_].index()) {\n+      index_ -= n;\n+      iterators_list_[current_chunk_index_] -= n;\n+      return *this;\n+    } else {\n+      iterators_list_[current_chunk_index_] -=\n+          iterators_list_[current_chunk_index_].index();\n+      index_ -= n;\n+      InitializeComponents(*this, true);\n+      return *this;\n+    }\n+  }\n\nReview Comment:\n   These operators can be simplified to have a single impl and reuse it because `operator-=(n) == operator+=(-n)`\n\n\n\n",
                    "created": "2022-04-27T16:14:58.413+0000",
                    "updated": "2022-04-27T16:14:58.413+0000",
                    "started": "2022-04-27T16:14:58.413+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "763020",
                    "issueId": "13048263"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13048263/worklog/763392",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "pitrou commented on code in PR #13009:\nURL: https://github.com/apache/arrow/pull/13009#discussion_r860697542\n\n\n##########\ncpp/src/arrow/stl_iterator.h:\n##########\n@@ -128,6 +131,215 @@ class ArrayIterator {\n   int64_t index_;\n };\n \n+template <typename ArrayType,\n+          typename ValueAccessor = detail::DefaultValueAccessor<ArrayType>>\n+class ChunkedArrayIterator {\n+ public:\n+  using value_type = arrow::util::optional<typename ValueAccessor::ValueType>;\n+  using difference_type = int64_t;\n+  using pointer = value_type*;\n+  using reference = value_type&;\n+  using iterator_category = std::random_access_iterator_tag;\n+\n+  // Some algorithms need to default-construct an iterator\n+  ChunkedArrayIterator() : chunked_array_(NULLPTR), index_(0), current_chunk_index_(0) {}\n+\n+  explicit ChunkedArrayIterator(const ChunkedArray& chunked_array, int64_t index = 0)\n+      : chunked_array_(&chunked_array), index_(index) {\n+    InitializeComponents(*this);\n+  }\n+\n+  // Value access\n+  value_type operator*() const { return *iterators_list_[current_chunk_index_]; }\n+\n+  value_type operator[](difference_type n) const {\n+    int64_t chunk_index = GetChunkIndex(index_ + n);\n+    int64_t index_in_chunk =\n+        chunk_index ? index_ + n - chunks_lengths_[chunk_index - 1] : index_ + n;\n+    return iterators_list_[chunk_index]\n+                          [index_in_chunk - iterators_list_[chunk_index].index()];\n+  }\n+\n+  int64_t index() const { return index_; }\n+\n+  // Forward / backward\n+  ChunkedArrayIterator& operator++() {\n+    ++index_;\n+    if (iterators_list_[current_chunk_index_].index() ==\n+        static_cast<int64_t>(\n+            chunked_array_->chunk(static_cast<int>(current_chunk_index_))->length()) -\n+            1) {\n+      iterators_list_[current_chunk_index_] -=\n+          iterators_list_[current_chunk_index_].index();\n+      current_chunk_index_++;\n+      if (!static_cast<int64_t>(\n+              chunked_array_->chunk(static_cast<int>(current_chunk_index_))->length())) {\n+        current_chunk_index_ = GetChunkIndex(index_);\n+      }\n+      iterators_list_[current_chunk_index_] -=\n+          iterators_list_[current_chunk_index_].index();\n+    } else {\n+      iterators_list_[current_chunk_index_]++;\n+    }\n+    return *this;\n+  }\n+  ChunkedArrayIterator& operator--() {\n+    --index_;\n+    if (iterators_list_[current_chunk_index_].index()) {\n+      iterators_list_[current_chunk_index_]--;\n+    } else {\n+      iterators_list_[current_chunk_index_] -=\n+          iterators_list_[current_chunk_index_].index();\n+      current_chunk_index_--;\n+      if (!static_cast<int64_t>(\n+              chunked_array_->chunk(static_cast<int>(current_chunk_index_))->length())) {\n+        current_chunk_index_ = GetChunkIndex(index_);\n+      }\n+      iterators_list_[current_chunk_index_] -=\n+          iterators_list_[current_chunk_index_].index();\n+      iterators_list_[current_chunk_index_] +=\n+          static_cast<int64_t>(\n+              chunked_array_->chunk(static_cast<int>(current_chunk_index_))->length()) -\n+          1;\n+    }\n+    return *this;\n+  }\n+\n+  ChunkedArrayIterator operator++(int) {\n+    ChunkedArrayIterator tmp(*this);\n+    ++*this;\n+    return tmp;\n+  }\n+  ChunkedArrayIterator operator--(int) {\n+    ChunkedArrayIterator tmp(*this);\n+    --*this;\n+    return tmp;\n+  }\n+\n+  // Arithmetic\n+  difference_type operator-(const ChunkedArrayIterator& other) const {\n+    return index_ - other.index_;\n+  }\n+  ChunkedArrayIterator operator+(difference_type n) const {\n+    return ChunkedArrayIterator(*chunked_array_, index_ + n);\n+  }\n+  ChunkedArrayIterator operator-(difference_type n) const {\n+    return ChunkedArrayIterator(*chunked_array_, index_ - n);\n+  }\n+  friend inline ChunkedArrayIterator operator+(difference_type diff,\n+                                               const ChunkedArrayIterator& other) {\n+    return ChunkedArrayIterator(*other.chunked_array_, diff + other.index_);\n+  }\n+  friend inline ChunkedArrayIterator operator-(difference_type diff,\n+                                               const ChunkedArrayIterator& other) {\n+    return ChunkedArrayIterator(*other.chunked_array_, diff - other.index_);\n+  }\n+  ChunkedArrayIterator& operator+=(difference_type n) {\n+    if (n < static_cast<int64_t>(\n+                chunked_array_->chunk(static_cast<int>(current_chunk_index_))->length()) -\n+                iterators_list_[current_chunk_index_].index()) {\n+      index_ += n;\n+      iterators_list_[current_chunk_index_] += n;\n+      return *this;\n+    } else {\n+      iterators_list_[current_chunk_index_] -=\n+          iterators_list_[current_chunk_index_].index();\n+      index_ += n;\n+      InitializeComponents(*this, true);\n+      return *this;\n+    }\n+  }\n+  ChunkedArrayIterator& operator-=(difference_type n) {\n+    if (n <= iterators_list_[current_chunk_index_].index()) {\n+      index_ -= n;\n+      iterators_list_[current_chunk_index_] -= n;\n+      return *this;\n+    } else {\n+      iterators_list_[current_chunk_index_] -=\n+          iterators_list_[current_chunk_index_].index();\n+      index_ -= n;\n+      InitializeComponents(*this, true);\n+      return *this;\n+    }\n+  }\n+\n+  // Comparisons\n+  bool operator==(const ChunkedArrayIterator& other) const {\n+    return index_ == other.index_;\n+  }\n+  bool operator!=(const ChunkedArrayIterator& other) const {\n+    return index_ != other.index_;\n+  }\n+  bool operator<(const ChunkedArrayIterator& other) const {\n+    return index_ < other.index_;\n+  }\n+  bool operator>(const ChunkedArrayIterator& other) const {\n+    return index_ > other.index_;\n+  }\n+  bool operator<=(const ChunkedArrayIterator& other) const {\n+    return index_ <= other.index_;\n+  }\n+  bool operator>=(const ChunkedArrayIterator& other) const {\n+    return index_ >= other.index_;\n+  }\n+\n+ private:\n+  int64_t GetChunkIndex(int64_t index) const {\n+    return static_cast<int64_t>(\n+        std::upper_bound(chunks_lengths_.begin(), chunks_lengths_.end(), index) -\n+        chunks_lengths_.begin());\n+  }\n+\n+  void InitializeComponents(ChunkedArrayIterator<ArrayType>& chunked_array_iterator,\n+                            bool update = false) {\n+    if (!update) {\n+      int64_t chunk_index = 0;\n+      for (const auto& array : chunked_array_iterator.chunked_array_->chunks()) {\n+        chunked_array_iterator.iterators_list_.emplace_back(\n+            *arrow::internal::checked_pointer_cast<ArrayType>(array));\n+        auto chunk_length = static_cast<int64_t>(array->length());\n+        if (chunk_index) {\n+          chunked_array_iterator.chunks_lengths_.push_back(\n+              chunk_length + chunked_array_iterator.chunks_lengths_[chunk_index - 1]);\n+        } else {\n+          chunked_array_iterator.chunks_lengths_.push_back(chunk_length);\n+        }\n+        chunk_index++;\n+      }\n+    }\n+\n+    chunked_array_iterator.current_chunk_index_ =\n+        GetChunkIndex(chunked_array_iterator.index_);\n+    auto& current_iterator =\n+        chunked_array_iterator\n+            .iterators_list_[chunked_array_iterator.current_chunk_index_];\n+    current_iterator -= current_iterator.index();\n+    if (chunked_array_iterator.current_chunk_index_)\n+      current_iterator +=\n+          chunked_array_iterator.index_ -\n+          chunked_array_iterator\n+              .chunks_lengths_[chunked_array_iterator.current_chunk_index_ - 1];\n+    else\n+      current_iterator += chunked_array_iterator.index_;\n+  }\n\nReview Comment:\n   I agree with this suggestion for the record. We don't enforce it but we try to maintain it.\n\n\n\n",
                    "created": "2022-04-28T09:48:55.076+0000",
                    "updated": "2022-04-28T09:48:55.076+0000",
                    "started": "2022-04-28T09:48:55.076+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "763392",
                    "issueId": "13048263"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13048263/worklog/763396",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "pitrou commented on code in PR #13009:\nURL: https://github.com/apache/arrow/pull/13009#discussion_r860702668\n\n\n##########\ncpp/src/arrow/chunked_array.h:\n##########\n@@ -141,6 +141,9 @@ class ARROW_EXPORT ChunkedArray {\n   /// \\brief Return the type of the chunked array\n   const std::shared_ptr<DataType>& type() const { return type_; }\n \n+  /// \\brief Return chunk resolver of the chunked array\n+  const internal::ChunkResolver& GetChunkResolver() const { return chunk_resolver_; }\n\nReview Comment:\n   This is exposing an internal facility as a public member API. I don't know what our API hygiene for this should be. @westonpace @xhochy @lidavidm Thoughts?\r\n   \r\n   (we could also make this private and use a `friend` declaration for the consuming class)\n\n\n\n",
                    "created": "2022-04-28T09:54:25.893+0000",
                    "updated": "2022-04-28T09:54:25.893+0000",
                    "started": "2022-04-28T09:54:25.893+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "763396",
                    "issueId": "13048263"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13048263/worklog/763399",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "pitrou commented on code in PR #13009:\nURL: https://github.com/apache/arrow/pull/13009#discussion_r860704871\n\n\n##########\ncpp/src/arrow/stl_iterator.h:\n##########\n@@ -128,6 +131,199 @@ class ArrayIterator {\n   int64_t index_;\n };\n \n+template <typename ArrayType,\n+          typename ValueAccessor = detail::DefaultValueAccessor<ArrayType>>\n+class ChunkedArrayIterator {\n+ public:\n+  using value_type = arrow::util::optional<typename ValueAccessor::ValueType>;\n+  using difference_type = int64_t;\n+  using pointer = value_type*;\n+  using reference = value_type&;\n+  using iterator_category = std::random_access_iterator_tag;\n+\n+  // Some algorithms need to default-construct an iterator\n+  ChunkedArrayIterator() : chunked_array_(NULLPTR), index_(0), current_chunk_index_(0) {}\n+\n+  explicit ChunkedArrayIterator(const ChunkedArray& chunked_array, int64_t index = 0)\n+      : chunked_array_(&chunked_array), index_(index) {\n+    UpdateComponents(*this);\n+  }\n+\n+  // Value access\n+  value_type operator*() const { return *iterators_list_[current_chunk_index_]; }\n+\n+  value_type operator[](difference_type n) const {\n+    auto chunk_location = GetChunkLocation(index_ + n);\n+    return iterators_list_[chunk_location.chunk_index]\n+                          [chunk_location.index_in_chunk -\n+                           iterators_list_[chunk_location.chunk_index].index()];\n+  }\n+\n+  int64_t index() const { return index_; }\n+\n+  // Forward / backward\n+  ChunkedArrayIterator& operator++() {\n+    ++index_;\n+    if (iterators_list_[current_chunk_index_].index() ==\n+        chunked_array_->chunk(static_cast<int>(current_chunk_index_))->length() - 1) {\n+      iterators_list_[current_chunk_index_] -=\n+          iterators_list_[current_chunk_index_].index();\n+      current_chunk_index_++;\n+      if (!chunked_array_->chunk(static_cast<int>(current_chunk_index_))->length()) {\n+        current_chunk_index_ = GetChunkLocation(index_).chunk_index;\n+      }\n+      iterators_list_[current_chunk_index_] -=\n+          iterators_list_[current_chunk_index_].index();\n+    } else {\n+      iterators_list_[current_chunk_index_]++;\n+    }\n+    return *this;\n+  }\n+  ChunkedArrayIterator& operator--() {\n+    --index_;\n+    if (iterators_list_[current_chunk_index_].index()) {\n+      iterators_list_[current_chunk_index_]--;\n+    } else {\n+      iterators_list_[current_chunk_index_] -=\n+          iterators_list_[current_chunk_index_].index();\n+      current_chunk_index_--;\n+      if (!chunked_array_->chunk(static_cast<int>(current_chunk_index_))->length()) {\n+        current_chunk_index_ = GetChunkLocation(index_).chunk_index;\n+      }\n+      iterators_list_[current_chunk_index_] -=\n+          iterators_list_[current_chunk_index_].index();\n+      iterators_list_[current_chunk_index_] +=\n+          chunked_array_->chunk(static_cast<int>(current_chunk_index_))->length() - 1;\n+    }\n+    return *this;\n+  }\n+\n+  ChunkedArrayIterator operator++(int) {\n+    ChunkedArrayIterator tmp(*this);\n+    ++*this;\n+    return tmp;\n+  }\n+  ChunkedArrayIterator operator--(int) {\n+    ChunkedArrayIterator tmp(*this);\n+    --*this;\n+    return tmp;\n+  }\n+\n+  // Arithmetic\n+  difference_type operator-(const ChunkedArrayIterator& other) const {\n+    return index_ - other.index_;\n+  }\n+  ChunkedArrayIterator operator+(difference_type n) const {\n+    return ChunkedArrayIterator(*chunked_array_, index_ + n);\n+  }\n+  ChunkedArrayIterator operator-(difference_type n) const {\n+    return ChunkedArrayIterator(*chunked_array_, index_ - n);\n+  }\n+  friend inline ChunkedArrayIterator operator+(difference_type diff,\n+                                               const ChunkedArrayIterator& other) {\n+    return ChunkedArrayIterator(*other.chunked_array_, diff + other.index_);\n+  }\n+  friend inline ChunkedArrayIterator operator-(difference_type diff,\n+                                               const ChunkedArrayIterator& other) {\n+    return ChunkedArrayIterator(*other.chunked_array_, diff - other.index_);\n+  }\n+  ChunkedArrayIterator& operator+=(difference_type n) {\n+    bool in_current_chunk;\n+    auto& current_iterator = iterators_list_[current_chunk_index_];\n+    if (n >= 0) {\n+      in_current_chunk =\n+          n < chunked_array_->chunk(static_cast<int>(current_chunk_index_))->length() -\n+                  current_iterator.index();\n+    } else {\n+      in_current_chunk = n > current_iterator.index();\n+    }\n+    if (in_current_chunk) {\n+      index_ += n;\n+      current_iterator += n;\n+      return *this;\n+    } else {\n+      current_iterator -= current_iterator.index();\n+      index_ += n;\n+      UpdateComponents(*this, true);\n+      return *this;\n+    }\n+  }\n+  ChunkedArrayIterator& operator-=(difference_type n) {\n+    (*this) += -n;\n+    return *this;\n+  }\n+\n+  // Comparisons\n+  bool operator==(const ChunkedArrayIterator& other) const {\n+    return index_ == other.index_;\n+  }\n+  bool operator!=(const ChunkedArrayIterator& other) const {\n+    return index_ != other.index_;\n+  }\n+  bool operator<(const ChunkedArrayIterator& other) const {\n+    return index_ < other.index_;\n+  }\n+  bool operator>(const ChunkedArrayIterator& other) const {\n+    return index_ > other.index_;\n+  }\n+  bool operator<=(const ChunkedArrayIterator& other) const {\n+    return index_ <= other.index_;\n+  }\n+  bool operator>=(const ChunkedArrayIterator& other) const {\n+    return index_ >= other.index_;\n+  }\n+\n+ private:\n+  arrow::internal::ChunkLocation GetChunkLocation(int64_t index) const {\n+    return chunked_array_->GetChunkResolver().Resolve(index);\n+  }\n+\n+  void UpdateComponents(ChunkedArrayIterator<ArrayType>& chunked_array_iterator,\n+                        bool update = false) {\n+    if (!update) {\n+      int64_t chunk_index = 0;\n+      for (const auto& array : chunked_array_iterator.chunked_array_->chunks()) {\n+        chunked_array_iterator.iterators_list_.emplace_back(\n+            *arrow::internal::checked_pointer_cast<ArrayType>(array));\n+        auto chunk_length = array->length();\n+        if (chunk_index) {\n+          chunk_length += chunked_array_iterator.chunks_lengths_[chunk_index - 1];\n+        }\n+        chunked_array_iterator.chunks_lengths_.push_back(chunk_length);\n+        chunk_index++;\n+      }\n+    }\n+\n+    chunked_array_iterator.current_chunk_index_ =\n+        GetChunkLocation(chunked_array_iterator.index_).chunk_index;\n+    auto& current_iterator =\n+        chunked_array_iterator\n+            .iterators_list_[chunked_array_iterator.current_chunk_index_];\n+    current_iterator -= current_iterator.index() - chunked_array_iterator.index_;\n+    if (chunked_array_iterator.current_chunk_index_) {\n+      current_iterator -=\n+          chunked_array_iterator\n+              .chunks_lengths_[chunked_array_iterator.current_chunk_index_ - 1];\n+    }\n+  }\n+\n+  const ChunkedArray* chunked_array_;\n+  int64_t index_;\n+  int64_t current_chunk_index_;\n+  std::vector<int64_t> chunks_lengths_;\n+  std::vector<ArrayIterator<ArrayType>> iterators_list_;\n\nReview Comment:\n   I'm a bit surprised, are these members still needed? Ideally, everything can be done using the ChunkResolver...\n\n\n\n",
                    "created": "2022-04-28T09:57:01.215+0000",
                    "updated": "2022-04-28T09:57:01.215+0000",
                    "started": "2022-04-28T09:57:01.215+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "763399",
                    "issueId": "13048263"
                }
            ]
        },
        "customfield_12313920": null,
        "issuetype": {
            "self": "https://issues.apache.org/jira/rest/api/2/issuetype/4",
            "id": "4",
            "description": "An improvement or enhancement to an existing feature or task.",
            "iconUrl": "https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21140&avatarType=issuetype",
            "name": "Improvement",
            "subtask": false,
            "avatarId": 21140
        },
        "timespent": 45000,
        "customfield_12314020": "{summaryBean=com.atlassian.jira.plugin.devstatus.rest.SummaryBean@333465ec[summary={pullrequest=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@74964baf[overall=PullRequestOverallBean{stateCount=0, state='OPEN', details=PullRequestOverallDetails{openCount=0, mergedCount=0, declinedCount=0}},byInstanceType={}], build=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@7517a287[overall=com.atlassian.jira.plugin.devstatus.summary.beans.BuildOverallBean@339a54b9[failedBuildCount=0,successfulBuildCount=0,unknownBuildCount=0,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], review=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@44965cd3[overall=com.atlassian.jira.plugin.devstatus.summary.beans.ReviewsOverallBean@440c96d4[stateCount=0,state=<null>,dueDate=<null>,overDue=false,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], deployment-environment=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@cc71748[overall=com.atlassian.jira.plugin.devstatus.summary.beans.DeploymentOverallBean@6d19b5f5[topEnvironments=[],showProjects=false,successfulCount=0,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], repository=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@1b1f1c41[overall=com.atlassian.jira.plugin.devstatus.summary.beans.CommitOverallBean@3b0583c0[count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], branch=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@f4caebf[overall=com.atlassian.jira.plugin.devstatus.summary.beans.BranchOverallBean@2fda04be[count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}]},errors=[],configErrors=[]], devSummaryJson={\"cachedValue\":{\"errors\":[],\"configErrors\":[],\"summary\":{\"pullrequest\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"stateCount\":0,\"state\":\"OPEN\",\"details\":{\"openCount\":0,\"mergedCount\":0,\"declinedCount\":0,\"total\":0},\"open\":true},\"byInstanceType\":{}},\"build\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"failedBuildCount\":0,\"successfulBuildCount\":0,\"unknownBuildCount\":0},\"byInstanceType\":{}},\"review\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"stateCount\":0,\"state\":null,\"dueDate\":null,\"overDue\":false,\"completed\":false},\"byInstanceType\":{}},\"deployment-environment\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"topEnvironments\":[],\"showProjects\":false,\"successfulCount\":0},\"byInstanceType\":{}},\"repository\":{\"overall\":{\"count\":0,\"lastUpdated\":null},\"byInstanceType\":{}},\"branch\":{\"overall\":{\"count\":0,\"lastUpdated\":null},\"byInstanceType\":{}}}},\"isStale\":false}}",
        "customfield_12314141": null,
        "customfield_12314140": null,
        "project": {
            "self": "https://issues.apache.org/jira/rest/api/2/project/12319525",
            "id": "12319525",
            "key": "ARROW",
            "name": "Apache Arrow",
            "projectTypeKey": "software",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/projectavatar?pid=12319525&avatarId=10011",
                "24x24": "https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12319525&avatarId=10011",
                "16x16": "https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12319525&avatarId=10011",
                "32x32": "https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12319525&avatarId=10011"
            },
            "projectCategory": {
                "self": "https://issues.apache.org/jira/rest/api/2/projectCategory/13960",
                "id": "13960",
                "description": "Apache Arrow",
                "name": "Arrow"
            }
        },
        "aggregatetimespent": 45000,
        "customfield_12312520": null,
        "customfield_12312521": "Wed May 11 16:54:37 UTC 2022",
        "customfield_12314422": null,
        "customfield_12314421": null,
        "customfield_12314146": null,
        "customfield_12314420": null,
        "customfield_12314145": null,
        "customfield_12314144": null,
        "customfield_12314143": null,
        "resolutiondate": "2022-05-11T16:54:37.000+0000",
        "workratio": -1,
        "customfield_12312923": null,
        "customfield_12312920": null,
        "customfield_12312921": null,
        "watches": {
            "self": "https://issues.apache.org/jira/rest/api/2/issue/ARROW-602/watchers",
            "watchCount": 7,
            "isWatching": false
        },
        "created": "2017-03-04T08:23:00.000+0000",
        "updated": "2022-05-13T08:41:27.000+0000",
        "timeoriginalestimate": null,
        "description": "Given a ChunkedArray, an Arrow user must currently iterate over all its chunks and then cast them to their types to extract the primitive memory regions to access the values. A convenient way to access the underlying values would be to offer a function that takes a ChunkedArray and returns a C++ iterator over all elements.\n\nWhile this may not be the most performant way to access the underlying data, it should have sufficient performance and adds a convenience layer for new users.",
        "customfield_10010": null,
        "timetracking": {
            "remainingEstimate": "0h",
            "timeSpent": "12.5h",
            "remainingEstimateSeconds": 0,
            "timeSpentSeconds": 45000
        },
        "customfield_12314523": null,
        "customfield_12314127": null,
        "customfield_12314522": null,
        "customfield_12314126": null,
        "customfield_12314521": null,
        "customfield_12314125": null,
        "customfield_12314520": null,
        "customfield_12314124": null,
        "attachment": [],
        "customfield_12312340": null,
        "customfield_12314123": null,
        "customfield_12312341": null,
        "customfield_12312220": null,
        "customfield_12314122": null,
        "customfield_12314121": null,
        "customfield_12314120": null,
        "customfield_12314129": null,
        "customfield_12314524": null,
        "customfield_12314128": null,
        "summary": "[C++] Provide iterator access to primitive elements inside a ChunkedArray",
        "customfield_12314130": null,
        "customfield_12310291": null,
        "customfield_12310290": null,
        "customfield_12314138": null,
        "customfield_12314137": null,
        "environment": null,
        "customfield_12314136": null,
        "customfield_12314135": null,
        "customfield_12311020": null,
        "customfield_12314134": null,
        "duedate": null,
        "customfield_12314132": null,
        "customfield_12314131": null,
        "comment": {
            "comments": [
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13048263/comment/15929943",
                    "id": "15929943",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=JohanMabille",
                        "name": "JohanMabille",
                        "key": "johanmabille",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "Johan Mabille",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "body": "The problem is a C++ iterator assumes that all the elements of the underlying container have the same type, whereas it may not be the case for elements in a ChunkedArray. I couldn't find the specification of ChunkedArray, but I guess you don't want to force the chunks to have the same value type ?",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=JohanMabille",
                        "name": "JohanMabille",
                        "key": "johanmabille",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "Johan Mabille",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "created": "2017-03-17T13:12:21.510+0000",
                    "updated": "2017-03-17T13:12:21.510+0000"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13048263/comment/15929977",
                    "id": "15929977",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=uwe",
                        "name": "uwe",
                        "key": "xhochy",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=xhochy&avatarId=30652",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=xhochy&avatarId=30652",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=xhochy&avatarId=30652",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=xhochy&avatarId=30652"
                        },
                        "displayName": "Uwe Korn",
                        "active": true,
                        "timeZone": "Europe/Berlin"
                    },
                    "body": "A chunked array is just a collection of arrays of the same type, so we should be able to construct instances of {{std::iterator<int64_t, ...>}}. The iterator would then iterate over all the values in all these underlying arrays.\n\nAs Arrow arrays are nullable, the iterator must either be on {{std::pair<bool, value_type>}} or we would have to specify that the iterator only iterates over all non-null values.",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=uwe",
                        "name": "uwe",
                        "key": "xhochy",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=xhochy&avatarId=30652",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=xhochy&avatarId=30652",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=xhochy&avatarId=30652",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=xhochy&avatarId=30652"
                        },
                        "displayName": "Uwe Korn",
                        "active": true,
                        "timeZone": "Europe/Berlin"
                    },
                    "created": "2017-03-17T13:33:54.440+0000",
                    "updated": "2017-03-17T13:33:54.440+0000"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13048263/comment/15929991",
                    "id": "15929991",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=JohanMabille",
                        "name": "JohanMabille",
                        "key": "johanmabille",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "Johan Mabille",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "body": "Ok, so it is possible to provide an STL compliant iterator. Cool !\nEDIT: still a little problem, the value_type is unknown at compilation, so it might be usefull to add it as a template parameter of ChunkedArray. Besides, that would allow type checking in its constructor.\n\nI think most of the use cases would be to apply STL-like algorithms, so it makes sense to iterate over non-null values only. Later we can provide a \"full\" iteration interface for the case where iteration over null values is required, what do you think ?",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=JohanMabille",
                        "name": "JohanMabille",
                        "key": "johanmabille",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "Johan Mabille",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "created": "2017-03-17T13:47:41.996+0000",
                    "updated": "2017-03-20T01:19:00.604+0000"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13048263/comment/15931401",
                    "id": "15931401",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=wesm",
                        "name": "wesm",
                        "key": "wesmckinn",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=wesmckinn&avatarId=29931",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=wesmckinn&avatarId=29931",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=wesmckinn&avatarId=29931",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=wesmckinn&avatarId=29931"
                        },
                        "displayName": "Wes McKinney",
                        "active": true,
                        "timeZone": "America/New_York"
                    },
                    "body": "Since we don't have a 100% consistent scalar value model, this would probably only be useful for types that have a {{c_type}} member. You could also have an iterator that yields a sequence of {{const ARRAY_TYPE& chunk, int64_t relative_offset}} pairs, so at least you don't have to do the chunk boundary jumping by hand each time",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=wesm",
                        "name": "wesm",
                        "key": "wesmckinn",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=wesmckinn&avatarId=29931",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=wesmckinn&avatarId=29931",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=wesmckinn&avatarId=29931",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=wesmckinn&avatarId=29931"
                        },
                        "displayName": "Wes McKinney",
                        "active": true,
                        "timeZone": "America/New_York"
                    },
                    "created": "2017-03-18T21:48:30.107+0000",
                    "updated": "2017-03-18T21:48:30.107+0000"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13048263/comment/15934324",
                    "id": "15934324",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=JohanMabille",
                        "name": "JohanMabille",
                        "key": "johanmabille",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "Johan Mabille",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "body": "Is that something you're open to change ? I mean, providing an interface a la std::vector (that is typedefs + iterators and access operators) for numerical arrays could make Arrow interoperable with the algorithms of the STL and other libraries that follow its idioms.\n\nI understand the need for Arrow arrays to have a entity semantic, so the changes I mention would only apply to leaf classes in the arrays hierarchy (this wouldn't break anything, that would be additional members only). And with the visitor pattern you already provide, I'm pretty sure we could dispatch STL-like algorithms that would rebind to the static ones of the STL, that would be awesome! Let me know your fellings about it, if you think it might be a good idea, I can open a dedicated issue and start to implement it.",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=JohanMabille",
                        "name": "JohanMabille",
                        "key": "johanmabille",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "Johan Mabille",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "created": "2017-03-21T09:26:37.786+0000",
                    "updated": "2017-03-21T09:35:26.064+0000"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13048263/comment/15934618",
                    "id": "15934618",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=wesm",
                        "name": "wesm",
                        "key": "wesmckinn",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=wesmckinn&avatarId=29931",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=wesmckinn&avatarId=29931",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=wesmckinn&avatarId=29931",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=wesmckinn&avatarId=29931"
                        },
                        "displayName": "Wes McKinney",
                        "active": true,
                        "timeZone": "America/New_York"
                    },
                    "body": "I'm definitely open to this at a high level, but we would need to write a design document to work through the questions/problems. It feels like a deep rabbit hole. For example, \n\n* do arrays return {{std::optional<T>}} or {{std::pair<bool, T}}?\n* what is {{T}} for non-numeric data?\n* what about nested data (list, struct, union)?",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=wesm",
                        "name": "wesm",
                        "key": "wesmckinn",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=wesmckinn&avatarId=29931",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=wesmckinn&avatarId=29931",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=wesmckinn&avatarId=29931",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=wesmckinn&avatarId=29931"
                        },
                        "displayName": "Wes McKinney",
                        "active": true,
                        "timeZone": "America/New_York"
                    },
                    "created": "2017-03-21T13:23:12.969+0000",
                    "updated": "2017-03-21T13:23:12.969+0000"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13048263/comment/15934712",
                    "id": "15934712",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=JohanMabille",
                        "name": "JohanMabille",
                        "key": "johanmabille",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "Johan Mabille",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "body": "I thought I would add this interface to numerical arrays for a start, but I agree it might be complicated to go back if we experience any problem in adding this interface to the other array classes in the future.\n\nBy the way I guess your first question is adressing the handling of missing values ? Sylvain has done some work on it for xtensor, you might be interested in [https://github.com/QuantStack/xtensor/pull/196].\n\nMore generally, what would be the best process for you? I can open a dedicated issue for this topic, so that we can identify all the possible problems and start trying to solve them. Or I can start a draft and we can iterate (or maybe you already started something I can contribute to). I guess this document could go into arrow/cpp/doc, so I may open a PR with an initial draft.",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=JohanMabille",
                        "name": "JohanMabille",
                        "key": "johanmabille",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "Johan Mabille",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "created": "2017-03-21T14:30:31.999+0000",
                    "updated": "2017-03-21T14:32:20.957+0000"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13048263/comment/15934723",
                    "id": "15934723",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=wesm",
                        "name": "wesm",
                        "key": "wesmckinn",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=wesmckinn&avatarId=29931",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=wesmckinn&avatarId=29931",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=wesmckinn&avatarId=29931",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=wesmckinn&avatarId=29931"
                        },
                        "displayName": "Wes McKinney",
                        "active": true,
                        "timeZone": "America/New_York"
                    },
                    "body": "It's also OK (and maybe simpler) to start a public Google document and link to on this issue ",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=wesm",
                        "name": "wesm",
                        "key": "wesmckinn",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=wesmckinn&avatarId=29931",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=wesmckinn&avatarId=29931",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=wesmckinn&avatarId=29931",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=wesmckinn&avatarId=29931"
                        },
                        "displayName": "Wes McKinney",
                        "active": true,
                        "timeZone": "America/New_York"
                    },
                    "created": "2017-03-21T14:43:34.552+0000",
                    "updated": "2017-03-21T14:43:34.552+0000"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13048263/comment/15936532",
                    "id": "15936532",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=JohanMabille",
                        "name": "JohanMabille",
                        "key": "johanmabille",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "Johan Mabille",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "body": "Ok, I start a Google doc as soon as I can (probably this week end or the beginning of next week).",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=JohanMabille",
                        "name": "JohanMabille",
                        "key": "johanmabille",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "Johan Mabille",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "created": "2017-03-22T15:30:21.144+0000",
                    "updated": "2017-03-22T15:48:52.586+0000"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13048263/comment/15950806",
                    "id": "15950806",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=JohanMabille",
                        "name": "JohanMabille",
                        "key": "johanmabille",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "Johan Mabille",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "body": "Here is a first attempt to specify the interface: https://docs.google.com/document/d/1Jz-DH5KHEBn5SmBaKx67ktEp4NYOx7HRWOqVABleTjo/edit?usp=sharing\n",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=JohanMabille",
                        "name": "JohanMabille",
                        "key": "johanmabille",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "Johan Mabille",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "created": "2017-03-31T12:53:01.174+0000",
                    "updated": "2017-03-31T12:53:01.174+0000"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13048263/comment/15954254",
                    "id": "15954254",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=wesm",
                        "name": "wesm",
                        "key": "wesmckinn",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=wesmckinn&avatarId=29931",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=wesmckinn&avatarId=29931",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=wesmckinn&avatarId=29931",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=wesmckinn&avatarId=29931"
                        },
                        "displayName": "Wes McKinney",
                        "active": true,
                        "timeZone": "America/New_York"
                    },
                    "body": "hi [~JohanMabille], thank you very much for writing this spec document. \n\nI think using an STL-compatible interface to Arrow data structures would be really useful. As far as the data structures defined in https://github.com/apache/arrow/blob/master/cpp/src/arrow/array.h, my feeling is that they should remain as \"plain old data\" with as few features as necessary beyond access to their metadata and data buffers -- there are a couple of convenience methods on {{arrow::Array}} and its subclasses for equality, slicing, and simple value access, but beyond that I am not sure we should add very much to these classes (I'd be more in favor of making {{array.h}} smaller than making it bigger}}. \n\nWhat I'm envisioning is something like:\n\n{code}\nstd::shared_ptr<Array> my_data = ...;\n\narrow::ArrayAccessor<Int64Type> container(*my_data);\n{code}\n\nFrom here, {{container}} would unbox the memory in {{my_data}} and implement the interfaces which you've described in your document. We'll have to make decisions about the return value for {{operator[]}}, like perhaps it will return {{std::optional<int64_t>}} for this example, but the return type for nested types may be more complicated. \n\nWhile Arrow memory is intended to be immutable for most applications, if the buffers in an array are mutable (e.g. {{my_data->data()->is_mutable()}} is true) then this container could permit mutation, subject to const-ness. \n\nDoes this make sense? ",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=wesm",
                        "name": "wesm",
                        "key": "wesmckinn",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=wesmckinn&avatarId=29931",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=wesmckinn&avatarId=29931",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=wesmckinn&avatarId=29931",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=wesmckinn&avatarId=29931"
                        },
                        "displayName": "Wes McKinney",
                        "active": true,
                        "timeZone": "America/New_York"
                    },
                    "created": "2017-04-03T22:26:02.391+0000",
                    "updated": "2017-04-03T22:26:02.391+0000"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13048263/comment/15958583",
                    "id": "15958583",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=JohanMabille",
                        "name": "JohanMabille",
                        "key": "johanmabille",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "Johan Mabille",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "body": "Hi [~wesmckinn], thanks for your comment, I see your point. I think this approach could reconciliate the need for a class hierarchy for arrays and the need for value semantic for a container interface (a la STL). I'm very busy because of pydata this weekend, I will make a more detailed answer after our talk on sunday.",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=JohanMabille",
                        "name": "JohanMabille",
                        "key": "johanmabille",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "Johan Mabille",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "created": "2017-04-06T08:53:19.854+0000",
                    "updated": "2017-04-06T08:53:19.854+0000"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13048263/comment/15972949",
                    "id": "15972949",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=JohanMabille",
                        "name": "JohanMabille",
                        "key": "johanmabille",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "Johan Mabille",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "body": "Hi [~wesmckinn],\n\nSo, as I previously said, this approach would make sense if the wrappers that provide STL-like interface to the array classes are independent, that is, there is no inheritance relation between them. This way they would have pure value semantic, just liske STL-containers. However, some questions:\n\n- how do we handle mutable methods on non-mutable arrays ? Methods such as resize must be in the interface, even when the array is not mutable (since this information cannot be known at compile time). Would you consider throwing an exception as an acceptable behavior ?\n- why using a flag fo handling mutability instead or relying on const-correctness only ? (this is more for my understanding of the design)\n- why do you want to keep arrays the smallest possible ? (again, this is more for my understanding of the design)\n\nAbout the return type for supporting missing values, I am not sure that std::optional is what we need; I assume that we want to read the flag telling if the value is missing or not from the null bitmap, and we do not want to copy that bitmap for performance considerations. In the case of a mutable array, if a missing value becomes available (or the contrary), the corresponding bit in the bitmap must be updated. However, std::optional does not permit this, so we may end up with coding a dedicated type for missing values (a type that allows reference proxy on boolean). This type can provide a similar interface to the one of std::optional.\n",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=JohanMabille",
                        "name": "JohanMabille",
                        "key": "johanmabille",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "Johan Mabille",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "created": "2017-04-18T15:52:19.065+0000",
                    "updated": "2017-04-18T15:52:19.065+0000"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13048263/comment/16738172",
                    "id": "16738172",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=apitrou",
                        "name": "apitrou",
                        "key": "pitrou",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=pitrou&avatarId=35049",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=pitrou&avatarId=35049",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=pitrou&avatarId=35049",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=pitrou&avatarId=35049"
                        },
                        "displayName": "Antoine Pitrou",
                        "active": true,
                        "timeZone": "Europe/Paris"
                    },
                    "body": "We have {{ArrayDataVisitor}} now that will tackle many of the use cases of iterator access (though with inversion of control, so you have to define a visitor class which may feel like boilerplate).\r\n\r\nThe nice thing with the inversion of control is that we may for example optimize {{ArrayDataVisitor}} by unrolling the null bitmap reading loop 8 times.",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=apitrou",
                        "name": "apitrou",
                        "key": "pitrou",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=pitrou&avatarId=35049",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=pitrou&avatarId=35049",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=pitrou&avatarId=35049",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=pitrou&avatarId=35049"
                        },
                        "displayName": "Antoine Pitrou",
                        "active": true,
                        "timeZone": "Europe/Paris"
                    },
                    "created": "2019-01-09T12:28:34.109+0000",
                    "updated": "2019-01-09T12:28:34.109+0000"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13048263/comment/16738261",
                    "id": "16738261",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=uwe",
                        "name": "uwe",
                        "key": "xhochy",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=xhochy&avatarId=30652",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=xhochy&avatarId=30652",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=xhochy&avatarId=30652",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=xhochy&avatarId=30652"
                        },
                        "displayName": "Uwe Korn",
                        "active": true,
                        "timeZone": "Europe/Berlin"
                    },
                    "body": "[~pitrou] I think we should document this is the faster path but having the STL-compliant will still be a good thing for a first time adoption of Arrow inside of an STL codebase.",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=uwe",
                        "name": "uwe",
                        "key": "xhochy",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=xhochy&avatarId=30652",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=xhochy&avatarId=30652",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=xhochy&avatarId=30652",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=xhochy&avatarId=30652"
                        },
                        "displayName": "Uwe Korn",
                        "active": true,
                        "timeZone": "Europe/Berlin"
                    },
                    "created": "2019-01-09T13:47:53.037+0000",
                    "updated": "2019-01-09T13:47:53.037+0000"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13048263/comment/17086017",
                    "id": "17086017",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=swilson314",
                        "name": "swilson314",
                        "key": "swilson314",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=34057",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34057",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34057",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34057"
                        },
                        "displayName": "Scott Wilson",
                        "active": true,
                        "timeZone": "America/Los_Angeles"
                    },
                    "body": "[~wesm] I've taken a stab at implementing ChunkedArray covers and iterators to support STL interfaces. My initial implementation returned std::optional<T>, but I didn't like the way this interacted with most stl numeric algorithms which expect iterator dereferences to be double or the like, and std::optional<double> doesn't automatically cast to double. I added a IsNull() member to the iterators, so at least this info is accessible.\r\n\r\nI'm not quite sure how to handle the issue of mutability, so I've simply punted. (Is there some description of the expected semantics of immutability? Is it really the case that I shouldn't write into a raw_value if the array is immutable?) Arrays that return proxys for the underlying memory, e.g. string, require a strange _cached variable in order to return a dereferenced iterator.\r\n\r\nThis my first pass at this code. I've done little testing, and it is not comprehensive. I just wanted to verify that I'm not doing something abnormally stupid ;)\r\n{code:c++}\r\n#include <cstdint>\r\n#include <memory>\r\n#include <numeric>\r\n#include <string>\r\n#include <iostream>\r\n#include <optional>\r\n#include <vector>\r\n#include <xutility>\r\n\r\n#include <arrow/api.h>\r\n#include <arrow/filesystem/localfs.h>\r\n#include <arrow/csv/api.h>\r\n#include <arrow/result.h>\r\n#include <arrow/builder.h>\r\n\r\n#include <boost/iterator/iterator_facade.hpp>\r\n#include <boost/range/iterator_range.hpp>\r\n\r\nusing namespace std;\r\nusing namespace arrow;\r\n\r\n// SBW 2020.04.15 For ArrayCoverRaw::iterator, we can simply use the the pointer interface.\r\n// Wes suggests returning std::optional<T>, but sizeof(double) < sizeof(std::optional<double>) and\r\n// is not a drop-in replacement for T, i.e. optional<T> can't be used in expression, need optional<T>.value().\r\n\r\n// STL container-like cover for arrow::Array.\r\n// Only works for Array types that support raw_values().\r\ntemplate<typename ArrType>\r\nclass ArrayCoverRaw\r\n{\r\npublic:\r\n\tusing T = typename ArrType::value_type;\r\n\tusing pointer = T*;\r\n\tusing const_pointer = const T*;\r\n\tusing reference = T&;\r\n\tusing const_reference = const T&;\r\n\t// Match size_type to Array offsets rather than using size_t and ptrdiff_t.\r\n\tusing size_type = int64_t;\r\n\tusing difference_type = int64_t;\r\n\tusing iterator = pointer;\r\n\tusing const_iterator = const_pointer;\r\n\tusing reverse_iterator = pointer;\r\n\tusing const_reverse_iterator = const_pointer;\r\n\r\n\tArrayCoverRaw(std::shared_ptr<ArrType>& array) : _array(array) {}\r\n\r\n\tsize_type size() const { return _array->length(); }\r\n\r\n\t// Should non-const versions fail if Array is immutable?\r\n\titerator begin() { return const_cast<pointer>(_array->raw_values()); }\r\n\titerator end() { return const_cast<pointer>(_array->raw_values()+_array->length()); }\r\n\treverse_iterator rbegin() { return const_cast<pointer>(_array->raw_values()+_array->length()-1); }\r\n\treverse_iterator rend() { return const_cast<pointer>(_array->raw_values()-1); }\r\n\tconst_iterator cbegin() const { return _array->raw_values(); }\r\n\tconst_iterator cend() const { return _array->raw_values()+_array->length(); }\r\n\tconst_reverse_iterator crbegin() const { return _array->raw_values()+_array->length()-1; }\r\n\tconst_reverse_iterator crend() const { return _array->raw_values()-1; }\r\n\r\n\t// We could return std::optional<T> to encapsulate IsNull() info, but this would seem to break the expected semantics.\r\n\treference operator[](const difference_type off) { assert(_array->data()->is_mutable()); return _array->raw_values()+off; }\r\n\tconst_reference operator[](const difference_type off) const { return _array->raw_values()+off; }\r\n\t// ISSUE: is there an interface for setting IsNull() if array is mutable.\r\n\tbool IsNull(difference_type off) const { return _array->IsNull(off); }\r\n\r\nprotected:\r\n\tstd::shared_ptr<ArrType> _array;\r\n};\r\n\r\n// TODO: Add ArrayCoverString and iterators, perhaps others.\r\n\r\n// Use template on Value so we can create iterator and const_iterator by changing Value.\r\n// Only works for Array types that support raw_values().\r\ntemplate <typename ArrType, class Value>\r\nclass ChunkedArrayIteratorRaw\r\n\t: public boost::iterator_facade<ChunkedArrayIteratorRaw<ArrType, Value>, Value, boost::random_access_traversal_tag>\r\n{\r\npublic:\r\n\tusing difference_type = int64_t;\r\n\tusing T = typename ArrType::value_type;\r\n\tusing pointer = T*;\r\n\r\n\texplicit ChunkedArrayIteratorRaw(std::shared_ptr<arrow::ChunkedArray> ch_arr = 0, difference_type pos = 0)\r\n\t\t: _ch_arr(ch_arr)\r\n\t{\r\n\t\tset_position(pos);\r\n\t}\r\n\r\n\tbool IsNull() const\r\n\t{\r\n\t\tauto arr = _ch_arr->chunk(_chunk_index);\r\n\t\treturn arr->IsNull(_current-_first);\r\n\t}\r\n\r\nprivate:\r\n\tfriend class boost::iterator_core_access;\r\n\r\n    bool equal(ChunkedArrayIteratorRaw<ArrType, Value> const& other) const\r\n    {\r\n        return this->_position == other._position;\r\n    }\r\n\r\n    void increment()\r\n\t{\r\n\t\t_position++;\r\n\t\t// Need to move to next chunk?\r\n\t\tif ((_current == _last) && ((_chunk_index+1) < _ch_arr->num_chunks()))\r\n\t\t{\r\n\t\t\t_chunk_index++;\r\n\t\t\tauto arr = _ch_arr->chunk(_chunk_index);\r\n\t\t\tauto typed_arr = std::static_pointer_cast<ArrType>(arr);\r\n\t\t\t_first = const_cast<pointer>(typed_arr->raw_values());\r\n\t\t\t_last = _first + arr->length() - 1;\r\n\t\t\t_current = _first;\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\t_current++;\r\n\t\t}\r\n\t}\r\n\r\n\tvoid decrement()\r\n\t{\r\n\t\t_position--;\r\n\t\t// Need to move to previous chunk?\r\n\t\tif ((_current == _first) && (_chunk_index > 0))\r\n\t\t{\r\n\t\t\t_chunk_index--;\r\n\t\t\tauto arr = _ch_arr->chunk(_chunk_index);\r\n\t\t\tauto typed_arr = std::static_pointer_cast<ArrType>(arr);\r\n\t\t\t_first = const_cast<pointer>(typed_arr->raw_values());\r\n\t\t\t_last = _first + arr->length() - 1;\r\n\t\t\t_current = _last;\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\t_current--;\r\n\t\t}\r\n\t}\r\n\r\n    Value& dereference() const { return *_current; }\r\n\r\n\tvoid advance(difference_type n)\r\n\t{\r\n\t\t_position += n;\r\n\t\twhile (n > 0)\r\n\t\t{\r\n\t\t\tdifference_type max_delta = _last - _current;\r\n\t\t\tif ((max_delta >= n) || ((_chunk_index+1) == _ch_arr->num_chunks()))\r\n\t\t\t{\r\n\t\t\t\t_current += n;\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\t// Move to next chunk.\r\n\t\t\tn -= max_delta;\r\n\t\t\t_chunk_index++;\r\n\t\t\tauto arr = _ch_arr->chunk(_chunk_index);\r\n\t\t\tauto typed_arr = std::static_pointer_cast<ArrType>(arr);\r\n\t\t\t_first = const_cast<pointer>(typed_arr->raw_values());\r\n\t\t\t_last = _first + arr->length() - 1;\r\n\t\t\t_current = _first;\r\n\t\t}\r\n\t\twhile (n < 0)\r\n\t\t{\r\n\t\t\tdifference_type max_delta = _first - _current;\r\n\t\t\tif ((max_delta <= n) || (_chunk_index == 0))\r\n\t\t\t{\r\n\t\t\t\t_current += n;\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\t// Move to previous chunk.\r\n\t\t\tn -= max_delta;\r\n\t\t\t_chunk_index--;\r\n\t\t\tassert(_chunk_index >= 0);\r\n\t\t\tauto arr = _ch_arr->chunk(_chunk_index);\r\n\t\t\tauto typed_arr = std::static_pointer_cast<ArrType>(arr);\r\n\t\t\t_first = const_cast<pointer>(typed_arr->raw_values());\r\n\t\t\t_last = _first + arr->length() - 1;\r\n\t\t\t_current = _last;\r\n\t\t}\r\n\t}\r\n\r\n\tdifference_type distance_to(ChunkedArrayIteratorRaw<ArrType, Value> const& other)\r\n\t{\r\n\t\treturn other._position - this->_position;\r\n\t}\r\n\r\n\t// Helper\r\n\tvoid set_position(difference_type pos)\r\n\t{\r\n\t\t_position = pos;\r\n\t\tconst int nchunks = _ch_arr->num_chunks();\r\n\t\tint64_t offset = 0;\r\n\t\tfor (_chunk_index = 0; _chunk_index < nchunks; _chunk_index++)\r\n\t\t{\r\n\t\t\tauto arr = _ch_arr->chunk(_chunk_index);\r\n\t\t\tint64_t arr_rows = arr->length();\r\n\t\t\tif (((offset+arr_rows) > pos) || ((_chunk_index+1)==nchunks))\r\n\t\t\t{\r\n\t\t\t\tauto typed_arr = std::static_pointer_cast<ArrType>(arr);\r\n\t\t\t\t_first = const_cast<T*>(typed_arr->raw_values());\r\n\t\t\t\t_last = _first + arr_rows - 1;\r\n\t\t\t\t_current = _first + (pos-offset);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\toffset += arr_rows;\r\n\t\t}\r\n\t\tassert(false);\r\n\t}\r\n\r\n\tstd::shared_ptr<arrow::ChunkedArray> _ch_arr;\r\n\t// Which Array we're looking at.\r\n\tint _chunk_index = 0;\r\n\t// Pointers into current Array. Use first/last rather than begin/end for symmetry of moving forward/backward.\r\n\tpointer _first = 0;\r\n\tpointer _current = 0;\r\n\tpointer _last = 0;\r\n\t// Cache position across all chunks for support of random access.\r\n\tdifference_type _position = 0;\r\n};\r\n\r\n// This implementation is a subclass for Arrays that use GetView(i), GetString(i), etc.\r\n// Concrete subclass only needs to implement dereference(i).\r\ntemplate <typename ArrType>\r\nclass ChunkedArrayIteratorIndexImpl\r\n{\r\npublic:\r\n\tusing difference_type = int64_t;\r\n\r\n\texplicit ChunkedArrayIteratorIndexImpl(std::shared_ptr<arrow::ChunkedArray> ch_arr = 0, difference_type pos = 0)\r\n\t\t: _ch_arr(ch_arr)\r\n\t{\r\n\t\tset_position(pos);\r\n\t}\r\n\r\n\tbool IsNull() const\r\n\t{\r\n\t\tauto arr = _ch_arr->chunk(_chunk_index);\r\n\t\treturn arr->IsNull(_current);\r\n\t}\r\n\r\nprotected:\r\n\tfriend class boost::iterator_core_access;\r\n\r\n    bool equal(ChunkedArrayIteratorIndexImpl<ArrType> const& other) const\r\n    {\r\n        return this->_position == other._position;\r\n    }\r\n\r\n    void increment()\r\n\t{\r\n\t\t_position++;\r\n\t\t// Need to move to next chunk?\r\n\t\tif ((_current == _last) && ((_chunk_index+1) < _ch_arr->num_chunks()))\r\n\t\t{\r\n\t\t\t_chunk_index++;\r\n\t\t\tauto arr = _ch_arr->chunk(_chunk_index);\r\n\t\t\t_typed_arr = std::static_pointer_cast<ArrType>(arr);\r\n\t\t\t_last = arr->length() - 1;\r\n\t\t\t_current = 0;\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\t_current++;\r\n\t\t}\r\n\t}\r\n\r\n\tvoid decrement()\r\n\t{\r\n\t\t_position--;\r\n\t\t// Need to move to previous chunk?\r\n\t\tif ((_current == _first) && (_chunk_index > 0))\r\n\t\t{\r\n\t\t\t_chunk_index--;\r\n\t\t\tauto arr = _ch_arr->chunk(_chunk_index);\r\n\t\t\t_typed_arr = std::static_pointer_cast<ArrType>(arr);\r\n\t\t\t_last = arr->length() - 1;\r\n\t\t\t_current = _last;\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\t_current--;\r\n\t\t}\r\n\t}\r\n\r\n    // Value& dereference() const { return *_current; }\r\n\r\n\tvoid advance(difference_type n)\r\n\t{\r\n\t\t_position += n;\r\n\t\twhile (n > 0)\r\n\t\t{\r\n\t\t\tdifference_type max_delta = _last - _current;\r\n\t\t\tif ((max_delta >= n) || ((_chunk_index+1) == _ch_arr->num_chunks()))\r\n\t\t\t{\r\n\t\t\t\t_current += n;\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\t// Move to next chunk.\r\n\t\t\tn -= max_delta;\r\n\t\t\t_chunk_index++;\r\n\t\t\tauto arr = _ch_arr->chunk(_chunk_index);\r\n\t\t\t_typed_arr = std::static_pointer_cast<ArrType>(arr);\r\n\t\t\t_last = arr->length() - 1;\r\n\t\t\t_current = 0;\r\n\t\t}\r\n\t\twhile (n < 0)\r\n\t\t{\r\n\t\t\tdifference_type max_delta = 0 - _current;\r\n\t\t\tif ((max_delta <= n) || (_chunk_index == 0))\r\n\t\t\t{\r\n\t\t\t\t_current += n;\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\t// Move to previous chunk.\r\n\t\t\tn -= max_delta;\r\n\t\t\t_chunk_index--;\r\n\t\t\tauto arr = _ch_arr->chunk(_chunk_index);\r\n\t\t\t_typed_arr = std::static_pointer_cast<ArrType>(arr);\r\n\t\t\t_last = arr->length() - 1;\r\n\t\t\t_current = _last;\r\n\t\t}\r\n\t}\r\n\r\n\tdifference_type distance_to(ChunkedArrayIteratorIndexImpl<ArrType> const& other)\r\n\t{\r\n\t\treturn other._position - this->_position;\r\n\t}\r\n\r\n\t// Helper\r\n\tvoid set_position(difference_type pos)\r\n\t{\r\n\t\t_position = pos;\r\n\t\tconst int nchunks = _ch_arr->num_chunks();\r\n\t\tint64_t offset = 0;\r\n\t\tfor (_chunk_index = 0; _chunk_index < nchunks; _chunk_index++)\r\n\t\t{\r\n\t\t\tauto arr = _ch_arr->chunk(_chunk_index);\r\n\t\t\tint64_t arr_rows = arr->length();\r\n\t\t\tif (((offset+arr_rows) > pos) || ((_chunk_index+1)==nchunks))\r\n\t\t\t{\r\n\t\t\t\t_typed_arr = std::static_pointer_cast<ArrType>(arr);\r\n\t\t\t\t_last = arr_rows - 1;\r\n\t\t\t\t_current = (pos-offset);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\toffset += arr_rows;\r\n\t\t}\r\n\t\tassert(false);\r\n\t}\r\n\r\n\tstd::shared_ptr<arrow::ChunkedArray> _ch_arr;\r\n\t// Which Array we're looking at.\r\n\tint _chunk_index = 0;\r\n\t// Current Array. Use first/last rather than begin/end for symmetry of moving forward/backward.\r\n\tstd::shared_ptr<ArrType> _typed_arr;\r\n\tdifference_type _current = 0;\r\n\tdifference_type _last = 0;\r\n\t// Cache position across all chunks for support of random access.\r\n\tdifference_type _position = 0;\r\n};\r\n\r\nclass ChunkedArrayIteratorString :\r\n\tpublic ChunkedArrayIteratorIndexImpl<StringArray>,\r\n\tpublic boost::iterator_facade<ChunkedArrayIteratorString, const std::string, boost::random_access_traversal_tag>\r\n{\r\npublic:\r\n\tusing difference_type = int64_t;\r\n\tusing Value = const std::string;\r\n\r\n\texplicit ChunkedArrayIteratorString(std::shared_ptr<arrow::ChunkedArray> ch_arr = 0, difference_type pos = 0)\r\n\t\t: ChunkedArrayIteratorIndexImpl(ch_arr, pos)\r\n\t{\r\n\t}\r\n\r\n\t// Cache value to avoid returning pointer to temp.\r\n    Value& dereference() const { _cached = _typed_arr->GetString(_current); return _cached; }\r\n\r\nprivate:\r\n\tmutable std::string _cached;\r\n};\r\n\r\nclass ChunkedArrayIteratorBoolean :\r\n\tpublic ChunkedArrayIteratorIndexImpl<BooleanArray>,\r\n\tpublic boost::iterator_facade<ChunkedArrayIteratorBoolean, const bool, boost::random_access_traversal_tag>\r\n{\r\npublic:\r\n\tusing difference_type = int64_t;\r\n\tusing Value = const bool;\r\n\r\n\texplicit ChunkedArrayIteratorBoolean(std::shared_ptr<arrow::ChunkedArray> ch_arr = 0, difference_type pos = 0)\r\n\t\t: ChunkedArrayIteratorIndexImpl(ch_arr, pos)\r\n\t{\r\n\t}\r\n\r\n\t// Cache value to avoid returning pointer to temp.\r\n    Value& dereference() const { _cached = _typed_arr->GetView(_current); return _cached; }\r\n\r\nprivate:\r\n\tmutable bool _cached;\r\n};\r\n\r\n// STL container-like cover for arrow::ChunkedArray.\r\n// Only works for ChunkedArrays composed of Array types that support raw_values().\r\ntemplate<typename ArrType>\r\nclass ChunkedArrayCoverRaw\r\n{\r\npublic:\r\n\tusing T = typename ArrType::value_type;\r\n\t// Match size_type to Array offsets rather than using size_t and ptrdiff_t.\r\n\tusing size_type = int64_t;\r\n\tusing difference_type = int64_t;\r\n\tusing iterator = typename ChunkedArrayIteratorRaw<ArrType, T>;\r\n\tusing const_iterator = typename ChunkedArrayIteratorRaw<ArrType, const T>;;\r\n\tusing reverse_iterator = iterator;\r\n\tusing const_reverse_iterator = const_iterator;\r\n\r\n\tChunkedArrayCoverRaw(std::shared_ptr<ChunkedArray>& array) : _array(array) {}\r\n\r\n\tsize_type size() const { return _array->length(); }\r\n\r\n\t// Should non-const versions fail if Array is immutable?\r\n\titerator begin() { return iterator(_array); }\r\n\titerator end() { return iterator(_array, size()); }\r\n\treverse_iterator rbegin() { return iterator(_array, size()-1); }\r\n\treverse_iterator rend() { return iterator(_array, -1); }\r\n\tconst_iterator cbegin() const { return const_iterator(_array); }\r\n\tconst_iterator cend() const { return const_iterator(_array, size()); }\r\n\tconst_reverse_iterator crbegin() const { return const_iterator(_array, size()-1); }\r\n\tconst_reverse_iterator crend() const { return const_iterator(_array, -1); }\r\n\r\nprotected:\r\n\tstd::shared_ptr<ChunkedArray> _array;\r\n};\r\n\r\n\r\nint main(int argc, char *argv[])\r\n{\r\n\tauto fs = make_shared<fs::LocalFileSystem>();\r\n\tauto r_input = fs->OpenInputStream(\"c:/temp/_DatasetP14Seizures.csv\");\r\n\r\n\tauto pool = default_memory_pool();\r\n\tauto read_options = arrow::csv::ReadOptions::Defaults();\r\n\tauto parse_options = arrow::csv::ParseOptions::Defaults();\r\n\tauto convert_options = arrow::csv::ConvertOptions::Defaults();\r\n\r\n\tauto r_table_reader = csv::TableReader::Make(pool, r_input.ValueOrDie(),\r\n\t\tread_options, parse_options, convert_options);\r\n\tauto r_read = r_table_reader.ValueOrDie()->Read();\r\n\tauto pTable = r_read.ValueOrDie();\r\n\r\n\tPrettyPrintOptions options{0};\r\n\tarrow::PrettyPrint(*pTable, options, &std::cout);\r\n\r\n\t// Test covers and iterators.\r\n\tconst Table& tlb = *pTable;\r\n\tconst int64_t rows = tlb.num_rows();\r\n\tconst int cols = tlb.num_columns();\r\n\tfor (int c = 0; c < cols; c++)\r\n\t{\r\n\t\tauto f = tlb.field(c);\r\n\t\tconst string& name = f->name();\r\n\t\tint type_id = f->type()->id();\r\n\t\tauto ch_arr = tlb.column(c);\r\n\t\tswitch (type_id)\r\n\t\t{\r\n\t\tcase Type::DOUBLE:\r\n\t\t\t{\r\n#if 0\r\n\t\t\t\tusing iterator = ChunkedArrayIteratorRaw<arrow::DoubleArray, double>;\r\n\t\t\t\titerator it(ch_arr, 2);\r\n\t\t\t\tcout << it.IsNull() << endl;\r\n\t\t\t\tboost::iterator_range<iterator> range(it-2, it+8);\r\n\t\t\t\tfor (double val : range)\r\n\t\t\t\t \tcout << val << endl;\r\n#else\r\n\t\t\t\tusing cover = ChunkedArrayCoverRaw<arrow::DoubleArray>;\r\n\t\t\t\tusing iterator = typename cover::iterator;\r\n\t\t\t\tusing range = typename boost::iterator_range<iterator>;\r\n\t\t\t\tcover cvr(ch_arr);\r\n\t\t\t\tauto begin = cvr.begin();\r\n\t\t\t\tauto end = cvr.end();\r\n\t\t\t\tauto rbegin = cvr.rbegin();\r\n\t\t\t\tauto rend = cvr.rend();\r\n\t\t\t\tauto it = begin;\r\n\t\t\t\tit += 2;\r\n\t\t\t\tcout << it.IsNull() << endl;\r\n\t\t\t\trange rng(it-2, it+8);\r\n\t\t\t\tfor (double val : rng)\r\n\t\t\t\t \tcout << val << endl;\r\n#endif\r\n\t\t\t}\r\n\t\t\tbreak;\r\n\t\tcase Type::STRING:\r\n\t\t\t{\r\n\t\t\t\tusing iterator = ChunkedArrayIteratorString;\r\n\t\t\t\titerator it(ch_arr, 2);\r\n\t\t\t\tcout << it.IsNull() << endl;\r\n\t\t\t\tboost::iterator_range<iterator> range(it-2, it+8);\r\n\t\t\t\tfor (std::string val : range)\r\n\t\t\t\t \tcout << val << endl;\r\n\t\t\t}\r\n\t\t\tbreak;\r\n\t\tcase Type::BOOL:\r\n\t\t\t{\r\n\t\t\t\tusing iterator = ChunkedArrayIteratorBoolean;\r\n\t\t\t\titerator it(ch_arr, 2);\r\n\t\t\t\tcout << it.IsNull() << endl;\r\n\t\t\t\tboost::iterator_range<iterator> range(it-2, it+8);\r\n\t\t\t\tfor (bool val : range)\r\n\t\t\t\t \tcout << val << endl;\r\n\t\t\t}\r\n\t\t\tbreak;\r\n\r\n\t\tdefault:\r\n\t\t\tbreak;\r\n\t\t}\r\n\t}\r\n\r\n\treturn 1;\r\n}\r\n\r\n\r\n{code}",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=swilson314",
                        "name": "swilson314",
                        "key": "swilson314",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=34057",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34057",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34057",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34057"
                        },
                        "displayName": "Scott Wilson",
                        "active": true,
                        "timeZone": "America/Los_Angeles"
                    },
                    "created": "2020-04-17T19:37:48.363+0000",
                    "updated": "2020-04-17T19:37:48.363+0000"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13048263/comment/17240948",
                    "id": "17240948",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=apitrou",
                        "name": "apitrou",
                        "key": "pitrou",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=pitrou&avatarId=35049",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=pitrou&avatarId=35049",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=pitrou&avatarId=35049",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=pitrou&avatarId=35049"
                        },
                        "displayName": "Antoine Pitrou",
                        "active": true,
                        "timeZone": "Europe/Paris"
                    },
                    "body": "See also ARROW-10776",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=apitrou",
                        "name": "apitrou",
                        "key": "pitrou",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=pitrou&avatarId=35049",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=pitrou&avatarId=35049",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=pitrou&avatarId=35049",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=pitrou&avatarId=35049"
                        },
                        "displayName": "Antoine Pitrou",
                        "active": true,
                        "timeZone": "Europe/Paris"
                    },
                    "created": "2020-11-30T18:13:55.081+0000",
                    "updated": "2020-11-30T18:13:55.081+0000"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13048263/comment/17458338",
                    "id": "17458338",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=apitrou",
                        "name": "apitrou",
                        "key": "pitrou",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=pitrou&avatarId=35049",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=pitrou&avatarId=35049",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=pitrou&avatarId=35049",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=pitrou&avatarId=35049"
                        },
                        "displayName": "Antoine Pitrou",
                        "active": true,
                        "timeZone": "Europe/Paris"
                    },
                    "body": "There will be an API and code organization aspect to this.\r\n\r\n* API question: there are no typed subclasses for {{ChunkedArray}}, so we need another solution than simply putting {{begin()}} and {{end()}} methods on ChunkedArray\r\n* code organization issue: we don't want {{chunked_array.h}} to imply the inclusion of all type-specific array declarations, so probably need another solution\r\n\r\nMy proposal would be to add a generic function {{Iterate<Type>}} in {{stl_iterator.h}}:\r\n{code:c++}\r\ntemplate <Type>\r\n<some return type> Iterate(const Array&) { ... }\r\n\r\ntemplate <Type>\r\n<some return type> Iterate(const ChunkedArray&) { ... }\r\n{code}\r\n\r\nWriting the implementation should be reasonably easy.",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=apitrou",
                        "name": "apitrou",
                        "key": "pitrou",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=pitrou&avatarId=35049",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=pitrou&avatarId=35049",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=pitrou&avatarId=35049",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=pitrou&avatarId=35049"
                        },
                        "displayName": "Antoine Pitrou",
                        "active": true,
                        "timeZone": "Europe/Paris"
                    },
                    "created": "2021-12-13T11:48:58.891+0000",
                    "updated": "2021-12-13T11:48:58.891+0000"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13048263/comment/17535016",
                    "id": "17535016",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=apitrou",
                        "name": "apitrou",
                        "key": "pitrou",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=pitrou&avatarId=35049",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=pitrou&avatarId=35049",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=pitrou&avatarId=35049",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=pitrou&avatarId=35049"
                        },
                        "displayName": "Antoine Pitrou",
                        "active": true,
                        "timeZone": "Europe/Paris"
                    },
                    "body": "Issue resolved by pull request 13009\n[https://github.com/apache/arrow/pull/13009]",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=apitrou",
                        "name": "apitrou",
                        "key": "pitrou",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=pitrou&avatarId=35049",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=pitrou&avatarId=35049",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=pitrou&avatarId=35049",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=pitrou&avatarId=35049"
                        },
                        "displayName": "Antoine Pitrou",
                        "active": true,
                        "timeZone": "Europe/Paris"
                    },
                    "created": "2022-05-11T16:54:37.769+0000",
                    "updated": "2022-05-11T16:54:37.769+0000"
                }
            ],
            "maxResults": 19,
            "total": 19,
            "startAt": 0
        },
        "customfield_12311820": "0|i3aybr:",
        "customfield_12314139": null
    }
}