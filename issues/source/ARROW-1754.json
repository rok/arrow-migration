{
    "expand": "operations,versionedRepresentations,editmeta,changelog,renderedFields",
    "id": "13113026",
    "self": "https://issues.apache.org/jira/rest/api/2/issue/13113026",
    "key": "ARROW-1754",
    "fields": {
        "fixVersions": [
            {
                "self": "https://issues.apache.org/jira/rest/api/2/version/12341352",
                "id": "12341352",
                "name": "0.8.0",
                "archived": false,
                "released": true,
                "releaseDate": "2017-12-18"
            }
        ],
        "resolution": {
            "self": "https://issues.apache.org/jira/rest/api/2/resolution/1",
            "id": "1",
            "description": "A fix for this issue is checked into the tree and tested.",
            "name": "Fixed"
        },
        "customfield_12312322": null,
        "customfield_12312323": null,
        "customfield_12312320": null,
        "customfield_12310420": "9223372036854775807",
        "customfield_12312321": null,
        "customfield_12312328": null,
        "customfield_12312329": null,
        "customfield_12312326": null,
        "customfield_12310300": null,
        "customfield_12312327": null,
        "customfield_12312324": null,
        "customfield_12312720": null,
        "customfield_12312325": null,
        "lastViewed": null,
        "priority": {
            "self": "https://issues.apache.org/jira/rest/api/2/priority/3",
            "iconUrl": "https://issues.apache.org/jira/images/icons/priorities/major.svg",
            "name": "Major",
            "id": "3"
        },
        "labels": [
            "pull-request-available"
        ],
        "customfield_12312333": null,
        "customfield_12312334": null,
        "customfield_12313422": "false",
        "customfield_12310310": "0.0",
        "customfield_12312331": null,
        "customfield_12312332": null,
        "aggregatetimeoriginalestimate": null,
        "timeestimate": null,
        "customfield_12312330": null,
        "versions": [
            {
                "self": "https://issues.apache.org/jira/rest/api/2/version/12341666",
                "id": "12341666",
                "name": "0.7.1",
                "archived": false,
                "released": true,
                "releaseDate": "2017-10-01"
            }
        ],
        "customfield_12311120": null,
        "customfield_12313826": null,
        "customfield_12312339": null,
        "issuelinks": [],
        "customfield_12313825": null,
        "assignee": {
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=cpcloud",
            "name": "cpcloud",
            "key": "cpcloud",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=cpcloud&avatarId=31265",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=cpcloud&avatarId=31265",
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=cpcloud&avatarId=31265",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=cpcloud&avatarId=31265"
            },
            "displayName": "Phillip Cloud",
            "active": true,
            "timeZone": "America/New_York"
        },
        "customfield_12312337": null,
        "customfield_12313823": null,
        "customfield_12312338": null,
        "customfield_12311920": null,
        "customfield_12313822": null,
        "customfield_12312335": null,
        "customfield_12313821": null,
        "customfield_12312336": null,
        "customfield_12313820": null,
        "status": {
            "self": "https://issues.apache.org/jira/rest/api/2/status/5",
            "description": "A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.",
            "iconUrl": "https://issues.apache.org/jira/images/icons/statuses/resolved.png",
            "name": "Resolved",
            "id": "5",
            "statusCategory": {
                "self": "https://issues.apache.org/jira/rest/api/2/statuscategory/3",
                "id": 3,
                "key": "done",
                "colorName": "green",
                "name": "Done"
            }
        },
        "components": [
            {
                "self": "https://issues.apache.org/jira/rest/api/2/component/12328936",
                "id": "12328936",
                "name": "Python"
            }
        ],
        "customfield_12312026": null,
        "customfield_12312023": null,
        "customfield_12312024": null,
        "aggregatetimeestimate": null,
        "customfield_12312022": null,
        "customfield_12310921": null,
        "customfield_12310920": "9223372036854775807",
        "customfield_12312823": null,
        "creator": {
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=wesm",
            "name": "wesm",
            "key": "wesmckinn",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=wesmckinn&avatarId=29931",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=wesmckinn&avatarId=29931",
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=wesmckinn&avatarId=29931",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=wesmckinn&avatarId=29931"
            },
            "displayName": "Wes McKinney",
            "active": true,
            "timeZone": "America/New_York"
        },
        "subtasks": [],
        "reporter": {
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=wesm",
            "name": "wesm",
            "key": "wesmckinn",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=wesmckinn&avatarId=29931",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=wesmckinn&avatarId=29931",
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=wesmckinn&avatarId=29931",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=wesmckinn&avatarId=29931"
            },
            "displayName": "Wes McKinney",
            "active": true,
            "timeZone": "America/New_York"
        },
        "aggregateprogress": {
            "progress": 0,
            "total": 0
        },
        "customfield_12313520": null,
        "customfield_12310250": null,
        "progress": {
            "progress": 0,
            "total": 0
        },
        "customfield_12313924": null,
        "votes": {
            "self": "https://issues.apache.org/jira/rest/api/2/issue/ARROW-1754/votes",
            "votes": 0,
            "hasVoted": false
        },
        "worklog": {
            "startAt": 0,
            "maxResults": 20,
            "total": 0,
            "worklogs": []
        },
        "customfield_12313920": null,
        "issuetype": {
            "self": "https://issues.apache.org/jira/rest/api/2/issuetype/1",
            "id": "1",
            "description": "A problem which impairs or prevents the functions of the product.",
            "iconUrl": "https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype",
            "name": "Bug",
            "subtask": false,
            "avatarId": 21133
        },
        "timespent": null,
        "customfield_12314020": "{summaryBean=com.atlassian.jira.plugin.devstatus.rest.SummaryBean@59564c8d[summary={pullrequest=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@b019a9[overall=PullRequestOverallBean{stateCount=0, state='OPEN', details=PullRequestOverallDetails{openCount=0, mergedCount=0, declinedCount=0}},byInstanceType={}], build=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@1362fae4[overall=com.atlassian.jira.plugin.devstatus.summary.beans.BuildOverallBean@139fc470[failedBuildCount=0,successfulBuildCount=0,unknownBuildCount=0,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], review=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@48ce88af[overall=com.atlassian.jira.plugin.devstatus.summary.beans.ReviewsOverallBean@6f48835f[stateCount=0,state=<null>,dueDate=<null>,overDue=false,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], deployment-environment=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@6b79e188[overall=com.atlassian.jira.plugin.devstatus.summary.beans.DeploymentOverallBean@62804d3[topEnvironments=[],showProjects=false,successfulCount=0,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], repository=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@3a9f7f49[overall=com.atlassian.jira.plugin.devstatus.summary.beans.CommitOverallBean@11e6513e[count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], branch=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@35b7872b[overall=com.atlassian.jira.plugin.devstatus.summary.beans.BranchOverallBean@73ff13d2[count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}]},errors=[],configErrors=[]], devSummaryJson={\"cachedValue\":{\"errors\":[],\"configErrors\":[],\"summary\":{\"pullrequest\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"stateCount\":0,\"state\":\"OPEN\",\"details\":{\"openCount\":0,\"mergedCount\":0,\"declinedCount\":0,\"total\":0},\"open\":true},\"byInstanceType\":{}},\"build\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"failedBuildCount\":0,\"successfulBuildCount\":0,\"unknownBuildCount\":0},\"byInstanceType\":{}},\"review\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"stateCount\":0,\"state\":null,\"dueDate\":null,\"overDue\":false,\"completed\":false},\"byInstanceType\":{}},\"deployment-environment\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"topEnvironments\":[],\"showProjects\":false,\"successfulCount\":0},\"byInstanceType\":{}},\"repository\":{\"overall\":{\"count\":0,\"lastUpdated\":null},\"byInstanceType\":{}},\"branch\":{\"overall\":{\"count\":0,\"lastUpdated\":null},\"byInstanceType\":{}}}},\"isStale\":false}}",
        "customfield_12314141": null,
        "customfield_12314140": null,
        "project": {
            "self": "https://issues.apache.org/jira/rest/api/2/project/12319525",
            "id": "12319525",
            "key": "ARROW",
            "name": "Apache Arrow",
            "projectTypeKey": "software",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/projectavatar?pid=12319525&avatarId=10011",
                "24x24": "https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12319525&avatarId=10011",
                "16x16": "https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12319525&avatarId=10011",
                "32x32": "https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12319525&avatarId=10011"
            },
            "projectCategory": {
                "self": "https://issues.apache.org/jira/rest/api/2/projectCategory/13960",
                "id": "13960",
                "description": "Apache Arrow",
                "name": "Arrow"
            }
        },
        "aggregatetimespent": null,
        "customfield_12312520": null,
        "customfield_12312521": "Fri Feb 02 19:50:48 UTC 2018",
        "customfield_12314422": null,
        "customfield_12314421": null,
        "customfield_12314146": null,
        "customfield_12314420": null,
        "customfield_12314145": null,
        "customfield_12314144": null,
        "customfield_12314143": null,
        "resolutiondate": "2017-10-31T16:51:15.000+0000",
        "workratio": -1,
        "customfield_12312923": null,
        "customfield_12312920": null,
        "customfield_12312921": null,
        "watches": {
            "self": "https://issues.apache.org/jira/rest/api/2/issue/ARROW-1754/watchers",
            "watchCount": 3,
            "isWatching": false
        },
        "created": "2017-10-30T13:52:33.000+0000",
        "updated": "2018-02-02T19:50:48.000+0000",
        "timeoriginalestimate": null,
        "description": "See upstream report https://stackoverflow.com/questions/47013052/issue-with-pyarrow-when-loading-parquet-file-where-index-has-redundant-column",
        "customfield_10010": null,
        "timetracking": {},
        "customfield_12314523": null,
        "customfield_12314127": null,
        "customfield_12314522": null,
        "customfield_12314126": null,
        "customfield_12314521": null,
        "customfield_12314125": null,
        "customfield_12314520": null,
        "customfield_12314124": null,
        "attachment": [],
        "customfield_12312340": null,
        "customfield_12314123": null,
        "customfield_12312341": null,
        "customfield_12312220": null,
        "customfield_12314122": null,
        "customfield_12314121": null,
        "customfield_12314120": null,
        "customfield_12314129": null,
        "customfield_12314524": null,
        "customfield_12314128": null,
        "summary": "[Python] Fix buggy Parquet roundtrip when an index name is the same as a column name",
        "customfield_12314130": null,
        "customfield_12310291": null,
        "customfield_12310290": null,
        "customfield_12314138": null,
        "customfield_12314137": null,
        "environment": null,
        "customfield_12314136": null,
        "customfield_12314135": null,
        "customfield_12311020": null,
        "customfield_12314134": null,
        "duedate": null,
        "customfield_12314132": null,
        "customfield_12314131": null,
        "comment": {
            "comments": [
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13113026/comment/16224988",
                    "id": "16224988",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=wesm",
                        "name": "wesm",
                        "key": "wesmckinn",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=wesmckinn&avatarId=29931",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=wesmckinn&avatarId=29931",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=wesmckinn&avatarId=29931",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=wesmckinn&avatarId=29931"
                        },
                        "displayName": "Wes McKinney",
                        "active": true,
                        "timeZone": "America/New_York"
                    },
                    "body": "[~cpcloud] could you take a look at this?",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=wesm",
                        "name": "wesm",
                        "key": "wesmckinn",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=wesmckinn&avatarId=29931",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=wesmckinn&avatarId=29931",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=wesmckinn&avatarId=29931",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=wesmckinn&avatarId=29931"
                        },
                        "displayName": "Wes McKinney",
                        "active": true,
                        "timeZone": "America/New_York"
                    },
                    "created": "2017-10-30T13:52:43.120+0000",
                    "updated": "2017-10-30T13:52:43.120+0000"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13113026/comment/16225799",
                    "id": "16225799",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=cpcloud",
                        "name": "cpcloud",
                        "key": "cpcloud",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=cpcloud&avatarId=31265",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=cpcloud&avatarId=31265",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=cpcloud&avatarId=31265",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=cpcloud&avatarId=31265"
                        },
                        "displayName": "Phillip Cloud",
                        "active": true,
                        "timeZone": "America/New_York"
                    },
                    "body": "I think we should solve this by always making index column name follow the pattern for unnamed columns, namely, {{\\_\\_index\\_level\\_<N>\\_\\_}}. Along with changing {{index_columns}} to be a list of dictionaries mapping the raw arrow column name to either {{None}} or the actual column name.\r\n\r\nI'll update the pandas metadata spec accordingly.",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=cpcloud",
                        "name": "cpcloud",
                        "key": "cpcloud",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=cpcloud&avatarId=31265",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=cpcloud&avatarId=31265",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=cpcloud&avatarId=31265",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=cpcloud&avatarId=31265"
                        },
                        "displayName": "Phillip Cloud",
                        "active": true,
                        "timeZone": "America/New_York"
                    },
                    "created": "2017-10-30T21:48:54.092+0000",
                    "updated": "2017-10-30T23:29:27.032+0000"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13113026/comment/16227096",
                    "id": "16227096",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=wesm",
                        "name": "wesm",
                        "key": "wesmckinn",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=wesmckinn&avatarId=29931",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=wesmckinn&avatarId=29931",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=wesmckinn&avatarId=29931",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=wesmckinn&avatarId=29931"
                        },
                        "displayName": "Wes McKinney",
                        "active": true,
                        "timeZone": "America/New_York"
                    },
                    "body": "Issue resolved by pull request 1271\n[https://github.com/apache/arrow/pull/1271]",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=wesm",
                        "name": "wesm",
                        "key": "wesmckinn",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=wesmckinn&avatarId=29931",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=wesmckinn&avatarId=29931",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=wesmckinn&avatarId=29931",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=wesmckinn&avatarId=29931"
                        },
                        "displayName": "Wes McKinney",
                        "active": true,
                        "timeZone": "America/New_York"
                    },
                    "created": "2017-10-31T16:51:15.735+0000",
                    "updated": "2017-10-31T16:51:15.735+0000"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13113026/comment/16227097",
                    "id": "16227097",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "body": "wesm closed pull request #1271: ARROW-1754: [Python] Fix buggy Parquet roundtrip when an index name is the same as a column name\nURL: https://github.com/apache/arrow/pull/1271\n \n \n   \n\nThis is a PR merged from a forked repository.\nAs GitHub hides the original diff on merge, it is displayed below for\nthe sake of provenance:\n\nAs this is a foreign pull request (from a fork), the diff is supplied\nbelow (as it won't show otherwise due to GitHub magic):\n\ndiff --git a/cpp/src/arrow/ipc/metadata-internal.cc b/cpp/src/arrow/ipc/metadata-internal.cc\nindex f04e9b05a..f0f0f6758 100644\n--- a/cpp/src/arrow/ipc/metadata-internal.cc\n+++ b/cpp/src/arrow/ipc/metadata-internal.cc\n@@ -72,7 +72,7 @@ MetadataVersion GetMetadataVersion(flatbuf::MetadataVersion version) {\n     case flatbuf::MetadataVersion_V4:\n       // Arrow >= 0.8\n       return MetadataVersion::V4;\n-      // Add cases as other versions become available\n+    // Add cases as other versions become available\n     default:\n       return MetadataVersion::V4;\n   }\ndiff --git a/python/pyarrow/pandas_compat.py b/python/pyarrow/pandas_compat.py\nindex d6c844c84..1984598ff 100644\n--- a/python/pyarrow/pandas_compat.py\n+++ b/python/pyarrow/pandas_compat.py\n@@ -18,7 +18,6 @@\n import ast\n import collections\n import json\n-import re\n \n import numpy as np\n import pandas as pd\n@@ -29,13 +28,6 @@\n from pyarrow.compat import PY2, zip_longest  # noqa\n \n \n-INDEX_LEVEL_NAME_REGEX = re.compile(r'^__index_level_\\d+__$')\n-\n-\n-def is_unnamed_index_level(name):\n-    return INDEX_LEVEL_NAME_REGEX.match(name) is not None\n-\n-\n def infer_dtype(column):\n     try:\n         return pd.api.types.infer_dtype(column)\n@@ -143,7 +135,7 @@ def get_column_metadata(column, name, arrow_type):\n \n     Parameters\n     ----------\n-    column : pandas.Series\n+    column : pandas.Series or pandas.Index\n     name : str\n     arrow_type : pyarrow.DataType\n \n@@ -161,7 +153,7 @@ def get_column_metadata(column, name, arrow_type):\n         }\n         string_dtype = 'object'\n \n-    if not isinstance(name, six.string_types):\n+    if name is not None and not isinstance(name, six.string_types):\n         raise TypeError(\n             'Column name must be a string. Got column {} of type {}'.format(\n                 name, type(name).__name__\n@@ -176,23 +168,7 @@ def get_column_metadata(column, name, arrow_type):\n     }\n \n \n-def index_level_name(index, i):\n-    \"\"\"Return the name of an index level or a default name if `index.name` is\n-    None.\n-\n-    Parameters\n-    ----------\n-    index : pandas.Index\n-    i : int\n-\n-    Returns\n-    -------\n-    name : str\n-    \"\"\"\n-    if index.name is not None:\n-        return index.name\n-    else:\n-        return '__index_level_{:d}__'.format(i)\n+index_level_name = '__index_level_{:d}__'.format\n \n \n def construct_metadata(df, column_names, index_levels, preserve_index, types):\n@@ -222,11 +198,11 @@ def construct_metadata(df, column_names, index_levels, preserve_index, types):\n     ]\n \n     if preserve_index:\n-        index_column_names = [index_level_name(level, i)\n-                              for i, level in enumerate(index_levels)]\n+        index_column_names = list(map(\n+            index_level_name, range(len(index_levels))\n+        ))\n         index_column_metadata = [\n-            get_column_metadata(level, name=index_level_name(level, i),\n-                                arrow_type=arrow_type)\n+            get_column_metadata(level, name=level.name, arrow_type=arrow_type)\n             for i, (level, arrow_type) in enumerate(\n                 zip(index_levels, index_types)\n             )\n@@ -317,7 +293,7 @@ def dataframe_to_arrays(df, schema, preserve_index, nthreads=1):\n     for i, column in enumerate(index_columns):\n         columns_to_convert.append(column)\n         convert_types.append(None)\n-        names.append(index_level_name(column, i))\n+        names.append(index_level_name(i))\n \n     # NOTE(wesm): If nthreads=None, then we use a heuristic to decide whether\n     # using a thread pool is worth it. Currently the heuristic is whether the\n@@ -378,6 +354,7 @@ def table_to_blockmanager(options, table, memory_pool, nthreads=1):\n     import pyarrow.lib as lib\n \n     index_columns = []\n+    columns = []\n     column_indexes = []\n     index_arrays = []\n     index_names = []\n@@ -390,6 +367,7 @@ def table_to_blockmanager(options, table, memory_pool, nthreads=1):\n     if has_pandas_metadata:\n         pandas_metadata = json.loads(metadata[b'pandas'].decode('utf8'))\n         index_columns = pandas_metadata['index_columns']\n+        columns = pandas_metadata['columns']\n         column_indexes = pandas_metadata.get('column_indexes', [])\n         table = _add_any_metadata(table, pandas_metadata)\n \n@@ -397,11 +375,11 @@ def table_to_blockmanager(options, table, memory_pool, nthreads=1):\n \n     # Build up a list of index columns and names while removing those columns\n     # from the original table\n-    for name in index_columns:\n-        i = schema.get_field_index(name)\n+    logical_index_names = [c['name'] for c in columns[-len(index_columns):]]\n+    for raw_name, logical_name in zip(index_columns, logical_index_names):\n+        i = schema.get_field_index(raw_name)\n         if i != -1:\n             col = table.column(i)\n-            index_name = None if is_unnamed_index_level(name) else name\n             col_pandas = col.to_pandas()\n             values = col_pandas.values\n             if not values.flags.writeable:\n@@ -410,9 +388,9 @@ def table_to_blockmanager(options, table, memory_pool, nthreads=1):\n                 values = values.copy()\n \n             index_arrays.append(pd.Series(values, dtype=col_pandas.dtype))\n-            index_names.append(index_name)\n+            index_names.append(logical_name)\n             block_table = block_table.remove_column(\n-                block_table.schema.get_field_index(name)\n+                block_table.schema.get_field_index(raw_name)\n             )\n \n     # Convert an arrow table to Block from the internal pandas API\ndiff --git a/python/pyarrow/tests/test_parquet.py b/python/pyarrow/tests/test_parquet.py\nindex a7fe98ce7..95dd6a471 100644\n--- a/python/pyarrow/tests/test_parquet.py\n+++ b/python/pyarrow/tests/test_parquet.py\n@@ -1171,7 +1171,8 @@ def test_dataset_read_pandas(tmpdir):\n \n \n @parquet\n-def test_dataset_read_pandas_common_metadata(tmpdir):\n+@pytest.mark.parametrize('preserve_index', [True, False])\n+def test_dataset_read_pandas_common_metadata(tmpdir, preserve_index):\n     # ARROW-1103\n     import pyarrow.parquet as pq\n \n@@ -1186,15 +1187,11 @@ def test_dataset_read_pandas_common_metadata(tmpdir):\n     paths = []\n     for i in range(nfiles):\n         df = _test_dataframe(size, seed=i)\n-        df.index = pd.Index(np.arange(i * size, (i + 1) * size))\n-        df.index.name = 'index'\n+        df.index = pd.Index(np.arange(i * size, (i + 1) * size), name='index')\n \n-        path = pjoin(dirpath, '{0}.parquet'.format(i))\n+        path = pjoin(dirpath, '{:d}.parquet'.format(i))\n \n-        df_ex_index = df.reset_index(drop=True)\n-        df_ex_index['index'] = df.index\n-        table = pa.Table.from_pandas(df_ex_index,\n-                                     preserve_index=False)\n+        table = pa.Table.from_pandas(df, preserve_index=preserve_index)\n \n         # Obliterate metadata\n         table = table.replace_schema_metadata(None)\n@@ -1206,7 +1203,9 @@ def test_dataset_read_pandas_common_metadata(tmpdir):\n         paths.append(path)\n \n     # Write _metadata common file\n-    table_for_metadata = pa.Table.from_pandas(df)\n+    table_for_metadata = pa.Table.from_pandas(\n+        df, preserve_index=preserve_index\n+    )\n     pq.write_metadata(table_for_metadata.schema,\n                       pjoin(dirpath, '_metadata'))\n \n@@ -1214,7 +1213,7 @@ def test_dataset_read_pandas_common_metadata(tmpdir):\n     columns = ['uint8', 'strings']\n     result = dataset.read_pandas(columns=columns).to_pandas()\n     expected = pd.concat([x[columns] for x in frames])\n-\n+    expected.index.name = df.index.name if preserve_index else None\n     tm.assert_frame_equal(result, expected)\n \n \n@@ -1387,3 +1386,27 @@ def test_large_table_int32_overflow():\n     table = pa.Table.from_arrays([parr], names=['one'])\n     f = io.BytesIO()\n     _write_table(table, f)\n+\n+\n+def test_index_column_name_duplicate(tmpdir):\n+    data = {\n+        'close': {\n+            pd.Timestamp('2017-06-30 01:31:00'): 154.99958999999998,\n+            pd.Timestamp('2017-06-30 01:32:00'): 154.99958999999998,\n+        },\n+        'time': {\n+            pd.Timestamp('2017-06-30 01:31:00'): pd.Timestamp(\n+                '2017-06-30 01:31:00'\n+            ),\n+            pd.Timestamp('2017-06-30 01:32:00'): pd.Timestamp(\n+                '2017-06-30 01:32:00'\n+            ),\n+        }\n+    }\n+    path = str(tmpdir / 'data.parquet')\n+    dfx = pd.DataFrame(data).set_index('time', drop=False)\n+    tdfx = pa.Table.from_pandas(dfx)\n+    _write_table(tdfx, path)\n+    arrow_table = _read_table(path)\n+    result_df = arrow_table.to_pandas()\n+    tm.assert_frame_equal(result_df, dfx)\n\n\n \n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "created": "2017-10-31T16:51:18.559+0000",
                    "updated": "2017-10-31T16:51:18.559+0000"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13113026/comment/16227098",
                    "id": "16227098",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "body": "wesm commented on issue #1271: ARROW-1754: [Python] Fix buggy Parquet roundtrip when an index name is the same as a column name\nURL: https://github.com/apache/arrow/pull/1271#issuecomment-340827241\n \n \n   thanks @cpcloud!\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "created": "2017-10-31T16:51:26.606+0000",
                    "updated": "2017-10-31T16:51:26.606+0000"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13113026/comment/16248173",
                    "id": "16248173",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "body": "pjdufour commented on issue #1271: ARROW-1754: [Python] Fix buggy Parquet roundtrip when an index name is the same as a column name\nURL: https://github.com/apache/arrow/pull/1271#issuecomment-343614629\n \n \n   Yes!\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "created": "2017-11-10T23:33:39.485+0000",
                    "updated": "2017-11-10T23:33:39.485+0000"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13113026/comment/16285395",
                    "id": "16285395",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "body": "jorisvandenbossche opened a new pull request #1408: ARROW-1754: [Python] alternative fix for duplicate index/column name that preserves index name if available\nURL: https://github.com/apache/arrow/pull/1408\n \n \n   Related to the discussion about the pandas metadata specification in https://github.com/pandas-dev/pandas/pull/18201, and an alternative to https://github.com/apache/arrow/pull/1271.\r\n   \r\n   I don't open this PR because it should necessarily be merged, I just want to show that it is not that difficult to both fix [ARROW-1754](https://issues.apache.org/jira/browse/ARROW-1754) and preserve index names as field names when possible (as this was mentioned in https://github.com/pandas-dev/pandas/pull/18201 as the reason to make this change to not preserve index names). \r\n   The diff is partly a revert of https://github.com/apache/arrow/pull/1271, but then adapted to the current codebase.\r\n   \r\n   Main reasons I prefer to preserve index names: 1) usability in pyarrow itself (if you would want to work with pyarrow Tables created from pandas) and 2) when interchanging parquet files with other people / other non-pandas systems, then it would be much nicer to not have `__index_level_n__` column names if possible.\r\n   \n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "created": "2017-12-10T21:58:57.517+0000",
                    "updated": "2017-12-10T21:58:57.517+0000"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13113026/comment/16329059",
                    "id": "16329059",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "body": "wesm commented on issue #1408: ARROW-1754: [Python] alternative fix for duplicate index/column name that preserves index name if available\nURL: https://github.com/apache/arrow/pull/1408#issuecomment-358378386\n \n \n   Can this be closed?\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "created": "2018-01-17T17:24:45.454+0000",
                    "updated": "2018-01-17T17:24:45.454+0000"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13113026/comment/16329066",
                    "id": "16329066",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "body": "jorisvandenbossche commented on issue #1408: ARROW-1754: [Python] alternative fix for duplicate index/column name that preserves index name if available\nURL: https://github.com/apache/arrow/pull/1408#issuecomment-358380263\n \n \n   My opinion is to merge this, but I had the feeling nobody else was feeling strongly in favor of it. See the top-level post for my reasoning.\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "created": "2018-01-17T17:30:44.327+0000",
                    "updated": "2018-01-17T17:30:44.327+0000"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13113026/comment/16329328",
                    "id": "16329328",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "body": "wesm commented on issue #1408: ARROW-1754: [Python] alternative fix for duplicate index/column name that preserves index name if available\nURL: https://github.com/apache/arrow/pull/1408#issuecomment-358423209\n \n \n   OK, if @cpcloud could take a look at this and advise (since he worked on this code most recently) I'm fine with merging\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "created": "2018-01-17T19:51:50.680+0000",
                    "updated": "2018-01-17T19:51:50.680+0000"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13113026/comment/16329718",
                    "id": "16329718",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "body": "cpcloud commented on issue #1408: ARROW-1754: [Python] alternative fix for duplicate index/column name that preserves index name if available\nURL: https://github.com/apache/arrow/pull/1408#issuecomment-358490397\n \n \n   Looking now.\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "created": "2018-01-17T23:58:14.532+0000",
                    "updated": "2018-01-17T23:58:14.532+0000"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13113026/comment/16329725",
                    "id": "16329725",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "body": "cpcloud commented on a change in pull request #1408: ARROW-1754: [Python] alternative fix for duplicate index/column name that preserves index name if available\nURL: https://github.com/apache/arrow/pull/1408#discussion_r162216610\n \n \n\n ##########\n File path: python/pyarrow/pandas_compat.py\n ##########\n @@ -294,9 +288,29 @@ def _column_name_to_strings(name):\n     return str(name)\n \n \n+def _index_level_name(index, i, column_names):\n+    \"\"\"Return the name of an index level or a default name if `index.name` is\n+    None or is already a column name.\n+\n+    Parameters\n+    ----------\n+    index : pandas.Index\n+    i : int\n+\n+    Returns\n+    -------\n+    name : str\n+    \"\"\"\n+    if index.name is not None and index.name not in column_names:\n \n Review comment:\n   Should we be concerned about the linear search for `index.name not in column_names`? If so, let's create a set outside the loop below that we can check so that we don't need to do a full scan of the column names for every index column.\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "created": "2018-01-18T00:03:52.132+0000",
                    "updated": "2018-01-18T00:03:52.132+0000"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13113026/comment/16329727",
                    "id": "16329727",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "body": "cpcloud commented on issue #1408: ARROW-1754: [Python] alternative fix for duplicate index/column name that preserves index name if available\nURL: https://github.com/apache/arrow/pull/1408#issuecomment-358491875\n \n \n   LGTM other than the comment. Should be rebased to run tests against current master.\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "created": "2018-01-18T00:05:25.142+0000",
                    "updated": "2018-01-18T00:05:25.142+0000"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13113026/comment/16329749",
                    "id": "16329749",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "body": "wesm commented on issue #1408: ARROW-1754: [Python] alternative fix for duplicate index/column name that preserves index name if available\nURL: https://github.com/apache/arrow/pull/1408#issuecomment-358495585\n \n \n   Rebased\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "created": "2018-01-18T00:24:30.403+0000",
                    "updated": "2018-01-18T00:24:30.403+0000"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13113026/comment/16338295",
                    "id": "16338295",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "body": "jorisvandenbossche commented on a change in pull request #1408: ARROW-1754: [Python] alternative fix for duplicate index/column name that preserves index name if available\nURL: https://github.com/apache/arrow/pull/1408#discussion_r163692020\n \n \n\n ##########\n File path: python/pyarrow/pandas_compat.py\n ##########\n @@ -294,9 +288,29 @@ def _column_name_to_strings(name):\n     return str(name)\n \n \n+def _index_level_name(index, i, column_names):\n+    \"\"\"Return the name of an index level or a default name if `index.name` is\n+    None or is already a column name.\n+\n+    Parameters\n+    ----------\n+    index : pandas.Index\n+    i : int\n+\n+    Returns\n+    -------\n+    name : str\n+    \"\"\"\n+    if index.name is not None and index.name not in column_names:\n \n Review comment:\n   I did some timings, and conversion to a set typically takes twice the time of a single search in the list. So you already need to have 3 index levels to benefit from this, and I don't think this is the typical use case? \r\n   So I would personally leave it as is, but can certainly also easily add the suggestion.\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "created": "2018-01-24T22:00:34.113+0000",
                    "updated": "2018-01-24T22:00:34.113+0000"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13113026/comment/16338322",
                    "id": "16338322",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "body": "cpcloud commented on a change in pull request #1408: ARROW-1754: [Python] alternative fix for duplicate index/column name that preserves index name if available\nURL: https://github.com/apache/arrow/pull/1408#discussion_r163696046\n \n \n\n ##########\n File path: python/pyarrow/pandas_compat.py\n ##########\n @@ -294,9 +288,29 @@ def _column_name_to_strings(name):\n     return str(name)\n \n \n+def _index_level_name(index, i, column_names):\n+    \"\"\"Return the name of an index level or a default name if `index.name` is\n+    None or is already a column name.\n+\n+    Parameters\n+    ----------\n+    index : pandas.Index\n+    i : int\n+\n+    Returns\n+    -------\n+    name : str\n+    \"\"\"\n+    if index.name is not None and index.name not in column_names:\n \n Review comment:\n   Fine by me.\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "created": "2018-01-24T22:16:59.471+0000",
                    "updated": "2018-01-24T22:16:59.471+0000"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13113026/comment/16338325",
                    "id": "16338325",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "body": "cpcloud commented on issue #1408: ARROW-1754: [Python] alternative fix for duplicate index/column name that preserves index name if available\nURL: https://github.com/apache/arrow/pull/1408#issuecomment-360292671\n \n \n   LGTM\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "created": "2018-01-24T22:17:49.655+0000",
                    "updated": "2018-01-24T22:17:49.655+0000"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13113026/comment/16349282",
                    "id": "16349282",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "body": "jorisvandenbossche commented on issue #1408: ARROW-1754: [Python] alternative fix for duplicate index/column name that preserves index name if available\nURL: https://github.com/apache/arrow/pull/1408#issuecomment-362403901\n \n \n   Regarding the PR backlog, given the comments above I think there was agreement to merge this. \r\n   There are no merge conflicts yet, but should I update with master to ensure tests are still passing?\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "created": "2018-02-01T21:15:06.198+0000",
                    "updated": "2018-02-01T21:15:06.198+0000"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13113026/comment/16349284",
                    "id": "16349284",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "body": "cpcloud commented on issue #1408: ARROW-1754: [Python] alternative fix for duplicate index/column name that preserves index name if available\nURL: https://github.com/apache/arrow/pull/1408#issuecomment-362404429\n \n \n   @jorisvandenbossche Yep that's a good idea, I can merge on green.\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "created": "2018-02-01T21:17:13.628+0000",
                    "updated": "2018-02-01T21:17:13.628+0000"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13113026/comment/16349378",
                    "id": "16349378",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "body": "wesm commented on issue #1408: ARROW-1754: [Python] alternative fix for duplicate index/column name that preserves index name if available\nURL: https://github.com/apache/arrow/pull/1408#issuecomment-362421304\n \n \n   Seems like this could be a stale merge -- doesn't look like it got the ARROW-2062 patch\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "created": "2018-02-01T22:19:24.644+0000",
                    "updated": "2018-02-01T22:19:24.644+0000"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13113026/comment/16349388",
                    "id": "16349388",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "body": "jorisvandenbossche commented on issue #1408: ARROW-1754: [Python] alternative fix for duplicate index/column name that preserves index name if available\nURL: https://github.com/apache/arrow/pull/1408#issuecomment-362422663\n \n \n   I see the ARROW-2062 commit in the history of this branch: https://github.com/jorisvandenbossche/arrow/commits/index-names (I fetched upstream master just before I merged / pushed)\r\n   \r\n   But, it is failing on travis (amongst others, a timeout for the first (gcc) build), is that the reason you were thinking this is not up to date?\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "created": "2018-02-01T22:25:07.679+0000",
                    "updated": "2018-02-01T22:25:07.679+0000"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13113026/comment/16349778",
                    "id": "16349778",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "body": "wesm commented on issue #1408: ARROW-1754: [Python] alternative fix for duplicate index/column name that preserves index name if available\nURL: https://github.com/apache/arrow/pull/1408#issuecomment-362485027\n \n \n   It looked a lot like the failure that was happening before ARROW-2062, I triggered a new build to see if it's transient\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "created": "2018-02-02T04:43:54.028+0000",
                    "updated": "2018-02-02T04:43:54.028+0000"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13113026/comment/16349945",
                    "id": "16349945",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "body": "jorisvandenbossche commented on issue #1408: ARROW-1754: [Python] alternative fix for duplicate index/column name that preserves index name if available\nURL: https://github.com/apache/arrow/pull/1408#issuecomment-362516006\n \n \n   Hmm, still timing out on the first one (but the other failures seems resolved)\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "created": "2018-02-02T08:13:54.206+0000",
                    "updated": "2018-02-02T08:13:54.206+0000"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13113026/comment/16350692",
                    "id": "16350692",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "body": "wesm commented on issue #1408: ARROW-1754: [Python] alternative fix for duplicate index/column name that preserves index name if available\nURL: https://github.com/apache/arrow/pull/1408#issuecomment-362649378\n \n \n   No problem, I'm merging this, thanks @jorisvandenbossche!\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "created": "2018-02-02T17:25:13.978+0000",
                    "updated": "2018-02-02T17:25:13.978+0000"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13113026/comment/16350694",
                    "id": "16350694",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "body": "wesm closed pull request #1408: ARROW-1754: [Python] alternative fix for duplicate index/column name that preserves index name if available\nURL: https://github.com/apache/arrow/pull/1408\n \n \n   \n\nThis is a PR merged from a forked repository.\nAs GitHub hides the original diff on merge, it is displayed below for\nthe sake of provenance:\n\nAs this is a foreign pull request (from a fork), the diff is supplied\nbelow (as it won't show otherwise due to GitHub magic):\n\ndiff --git a/python/pyarrow/pandas_compat.py b/python/pyarrow/pandas_compat.py\nindex 4a30fb3b4..240cccdaf 100644\n--- a/python/pyarrow/pandas_compat.py\n+++ b/python/pyarrow/pandas_compat.py\n@@ -179,10 +179,8 @@ def get_column_metadata(column, name, arrow_type, field_name):\n     }\n \n \n-index_level_name = '__index_level_{:d}__'.format\n-\n-\n-def construct_metadata(df, column_names, index_levels, preserve_index, types):\n+def construct_metadata(df, column_names, index_levels, index_column_names,\n+                       preserve_index, types):\n     \"\"\"Returns a dictionary containing enough metadata to reconstruct a pandas\n     DataFrame as an Arrow Table, including index columns.\n \n@@ -197,9 +195,8 @@ def construct_metadata(df, column_names, index_levels, preserve_index, types):\n     -------\n     dict\n     \"\"\"\n-    ncolumns = len(column_names)\n-    df_types = types[:ncolumns - len(index_levels)]\n-    index_types = types[ncolumns - len(index_levels):]\n+    df_types = types[:-len(index_levels)]\n+    index_types = types[-len(index_levels):]\n \n     column_metadata = [\n         get_column_metadata(\n@@ -213,9 +210,6 @@ def construct_metadata(df, column_names, index_levels, preserve_index, types):\n     ]\n \n     if preserve_index:\n-        index_column_names = list(map(\n-            index_level_name, range(len(index_levels))\n-        ))\n         index_column_metadata = [\n             get_column_metadata(\n                 level,\n@@ -294,9 +288,29 @@ def _column_name_to_strings(name):\n     return str(name)\n \n \n+def _index_level_name(index, i, column_names):\n+    \"\"\"Return the name of an index level or a default name if `index.name` is\n+    None or is already a column name.\n+\n+    Parameters\n+    ----------\n+    index : pandas.Index\n+    i : int\n+\n+    Returns\n+    -------\n+    name : str\n+    \"\"\"\n+    if index.name is not None and index.name not in column_names:\n+        return index.name\n+    else:\n+        return '__index_level_{:d}__'.format(i)\n+\n+\n def dataframe_to_arrays(df, schema, preserve_index, nthreads=1):\n-    names = []\n+    column_names = []\n     index_columns = []\n+    index_column_names = []\n     type = None\n \n     if preserve_index:\n@@ -324,12 +338,13 @@ def dataframe_to_arrays(df, schema, preserve_index, nthreads=1):\n \n         columns_to_convert.append(col)\n         convert_types.append(type)\n-        names.append(name)\n+        column_names.append(name)\n \n     for i, column in enumerate(index_columns):\n         columns_to_convert.append(column)\n         convert_types.append(None)\n-        names.append(index_level_name(i))\n+        name = _index_level_name(column, i, column_names)\n+        index_column_names.append(name)\n \n     # NOTE(wesm): If nthreads=None, then we use a heuristic to decide whether\n     # using a thread pool is worth it. Currently the heuristic is whether the\n@@ -358,8 +373,10 @@ def convert_column(col, ty):\n     types = [x.type for x in arrays]\n \n     metadata = construct_metadata(\n-        df, names, index_columns, preserve_index, types\n+        df, column_names, index_columns, index_column_names, preserve_index,\n+        types\n     )\n+    names = column_names + index_column_names\n     return names, arrays, metadata\n \n \ndiff --git a/python/pyarrow/tests/test_convert_pandas.py b/python/pyarrow/tests/test_convert_pandas.py\nindex ca2f1e361..f1f40a695 100644\n--- a/python/pyarrow/tests/test_convert_pandas.py\n+++ b/python/pyarrow/tests/test_convert_pandas.py\n@@ -191,8 +191,9 @@ def test_index_metadata_field_name(self):\n         assert idx0['field_name'] == idx0_name\n         assert idx0['name'] is None\n \n-        assert foo_name == '__index_level_1__'\n-        assert foo['name'] == 'foo'\n+        assert foo_name == 'foo'\n+        assert foo['field_name'] == foo_name\n+        assert foo['name'] == foo_name\n \n     def test_categorical_column_index(self):\n         df = pd.DataFrame(\n\n\n \n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "created": "2018-02-02T17:25:38.942+0000",
                    "updated": "2018-02-02T17:25:38.942+0000"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13113026/comment/16350868",
                    "id": "16350868",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "body": "jorisvandenbossche commented on issue #1408: ARROW-1754: [Python] alternative fix for duplicate index/column name that preserves index name if available\nURL: https://github.com/apache/arrow/pull/1408#issuecomment-362688457\n \n \n   Thanks for merging!\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "created": "2018-02-02T19:50:48.904+0000",
                    "updated": "2018-02-02T19:50:48.904+0000"
                }
            ],
            "maxResults": 26,
            "total": 26,
            "startAt": 0
        },
        "customfield_12311820": "0|i3lv7r:",
        "customfield_12314139": null
    }
}