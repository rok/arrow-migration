{
    "expand": "operations,versionedRepresentations,editmeta,changelog,renderedFields",
    "id": "13338435",
    "self": "https://issues.apache.org/jira/rest/api/2/issue/13338435",
    "key": "ARROW-10464",
    "fields": {
        "fixVersions": [
            {
                "self": "https://issues.apache.org/jira/rest/api/2/version/12348823",
                "id": "12348823",
                "description": "",
                "name": "3.0.0",
                "archived": false,
                "released": true,
                "releaseDate": "2021-01-25"
            }
        ],
        "resolution": {
            "self": "https://issues.apache.org/jira/rest/api/2/resolution/1",
            "id": "1",
            "description": "A fix for this issue is checked into the tree and tested.",
            "name": "Fixed"
        },
        "customfield_12312322": null,
        "customfield_12312323": null,
        "customfield_12312320": null,
        "customfield_12310420": "9223372036854775807",
        "customfield_12312321": null,
        "customfield_12312328": null,
        "customfield_12312329": null,
        "customfield_12312326": null,
        "customfield_12310300": null,
        "customfield_12312327": null,
        "customfield_12312324": null,
        "customfield_12312720": null,
        "customfield_12312325": null,
        "lastViewed": null,
        "priority": {
            "self": "https://issues.apache.org/jira/rest/api/2/priority/3",
            "iconUrl": "https://issues.apache.org/jira/images/icons/priorities/major.svg",
            "name": "Major",
            "id": "3"
        },
        "labels": [
            "pull-request-available"
        ],
        "customfield_12312333": null,
        "customfield_12312334": null,
        "customfield_12313422": "false",
        "customfield_12310310": "0.0",
        "customfield_12312331": null,
        "customfield_12312332": null,
        "aggregatetimeoriginalestimate": null,
        "timeestimate": 0,
        "customfield_12312330": null,
        "versions": [],
        "customfield_12311120": null,
        "customfield_12313826": null,
        "customfield_12312339": null,
        "issuelinks": [],
        "customfield_12313825": null,
        "assignee": {
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=andygrove",
            "name": "andygrove",
            "key": "andygrove",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=andygrove&avatarId=28239",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=andygrove&avatarId=28239",
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=andygrove&avatarId=28239",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=andygrove&avatarId=28239"
            },
            "displayName": "Andy Grove",
            "active": true,
            "timeZone": "America/Denver"
        },
        "customfield_12312337": null,
        "customfield_12313823": null,
        "customfield_12312338": null,
        "customfield_12311920": null,
        "customfield_12313822": null,
        "customfield_12312335": null,
        "customfield_12313821": null,
        "customfield_12312336": null,
        "customfield_12313820": null,
        "status": {
            "self": "https://issues.apache.org/jira/rest/api/2/status/5",
            "description": "A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.",
            "iconUrl": "https://issues.apache.org/jira/images/icons/statuses/resolved.png",
            "name": "Resolved",
            "id": "5",
            "statusCategory": {
                "self": "https://issues.apache.org/jira/rest/api/2/statuscategory/3",
                "id": 3,
                "key": "done",
                "colorName": "green",
                "name": "Done"
            }
        },
        "components": [
            {
                "self": "https://issues.apache.org/jira/rest/api/2/component/12333773",
                "id": "12333773",
                "name": "Rust"
            }
        ],
        "customfield_12312026": null,
        "customfield_12312023": null,
        "customfield_12312024": null,
        "aggregatetimeestimate": 0,
        "customfield_12312022": null,
        "customfield_12310921": null,
        "customfield_12310920": "9223372036854775807",
        "customfield_12312823": null,
        "creator": {
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=andygrove",
            "name": "andygrove",
            "key": "andygrove",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=andygrove&avatarId=28239",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=andygrove&avatarId=28239",
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=andygrove&avatarId=28239",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=andygrove&avatarId=28239"
            },
            "displayName": "Andy Grove",
            "active": true,
            "timeZone": "America/Denver"
        },
        "subtasks": [],
        "reporter": {
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=andygrove",
            "name": "andygrove",
            "key": "andygrove",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=andygrove&avatarId=28239",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=andygrove&avatarId=28239",
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=andygrove&avatarId=28239",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=andygrove&avatarId=28239"
            },
            "displayName": "Andy Grove",
            "active": true,
            "timeZone": "America/Denver"
        },
        "aggregateprogress": {
            "progress": 5400,
            "total": 5400,
            "percent": 100
        },
        "customfield_12313520": null,
        "customfield_12310250": null,
        "progress": {
            "progress": 5400,
            "total": 5400,
            "percent": 100
        },
        "customfield_12313924": null,
        "votes": {
            "self": "https://issues.apache.org/jira/rest/api/2/issue/ARROW-10464/votes",
            "votes": 0,
            "hasVoted": false
        },
        "worklog": {
            "startAt": 0,
            "maxResults": 20,
            "total": 9,
            "worklogs": [
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13338435/worklog/513615",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "andygrove opened a new pull request #8705:\nURL: https://github.com/apache/arrow/pull/8705\n\n\n   \n\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2020-11-18T16:25:42.412+0000",
                    "updated": "2020-11-18T16:25:42.412+0000",
                    "started": "2020-11-18T16:25:42.412+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "513615",
                    "issueId": "13338435"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13338435/worklog/513622",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "github-actions[bot] commented on pull request #8705:\nURL: https://github.com/apache/arrow/pull/8705#issuecomment-729801386\n\n\n   https://issues.apache.org/jira/browse/ARROW-10464\n\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2020-11-18T16:39:32.375+0000",
                    "updated": "2020-11-18T16:39:32.375+0000",
                    "started": "2020-11-18T16:39:32.375+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "513622",
                    "issueId": "13338435"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13338435/worklog/513644",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "andygrove commented on pull request #8705:\nURL: https://github.com/apache/arrow/pull/8705#issuecomment-729825709\n\n\n   @jorgecarleitao @alamb This adds the Rust-native utility to convert the TPC-H data to CSV and Parquet.\r\n   \r\n   I will create follow-on PRs to add support for re-partitioning the data.\r\n   \r\n   @nevi-me It's really nice to see the Parquet writer in action!\n\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2020-11-18T17:18:22.949+0000",
                    "updated": "2020-11-18T17:18:22.949+0000",
                    "started": "2020-11-18T17:18:22.949+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "513644",
                    "issueId": "13338435"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13338435/worklog/513656",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "andygrove commented on pull request #8705:\nURL: https://github.com/apache/arrow/pull/8705#issuecomment-729838339\n\n\n   Build error seems unrelated to these changes.\n\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2020-11-18T17:39:16.717+0000",
                    "updated": "2020-11-18T17:39:16.717+0000",
                    "started": "2020-11-18T17:39:16.717+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "513656",
                    "issueId": "13338435"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13338435/worklog/513802",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "alamb commented on a change in pull request #8705:\nURL: https://github.com/apache/arrow/pull/8705#discussion_r526432425\n\n\n\n##########\nFile path: rust/benchmarks/README.md\n##########\n@@ -49,45 +49,16 @@ data. This value can be increased to generate larger data sets.\n The benchmark can then be run (assuming the data created from `dbgen` is in `/mnt/tpch-dbgen`) with a command such as:\n \n ```bash\n-cargo run --release --bin tpch -- --iterations 3 --path /mnt/tpch-dbgen --format tbl --query 1 --batch-size 4096\n+cargo run --release --bin tpch -- benchmark --iterations 3 --path /mnt/tpch-dbgen --format tbl --query 1 --batch-size 4096\n ```\n \n-The benchmark program also supports CSV and Parquet input file formats.\n-\n-This crate does not currently provide a method for converting the generated tbl format to CSV or Parquet so it is \n-necessary to use other tools to perform this conversion.\n-\n-One option is to use the following Docker image to perform the conversion from `tbl` files to CSV or Parquet.\n-\n-```bash\n-docker run -it ballistacompute/spark-benchmarks:0.4.0-SNAPSHOT \n-  -h, --help   Show help message\n-\n-Subcommand: convert-tpch\n-  -i, --input  <arg>\n-      --input-format  <arg>\n-  -o, --output  <arg>\n-      --output-format  <arg>\n-  -p, --partitions  <arg>\n-  -h, --help                   Show help message\n-```\n-\n-Note that it is necessary to mount volumes into the Docker container as appropriate so that the file conversion process\n-can access files on the host system.\n-\n-Here is a full example that assumes that data is stored in the `/mnt` path on the host system.\n+The benchmark program also supports CSV and Parquet input file formats and a utility is provided to convert from `tbl`\n+to CSV and Parquet.\n\nReview comment:\n       ```suggestion\r\n   (generated by the `dbgen` utility) to CSV and Parquet.\r\n   ```\n\n##########\nFile path: rust/benchmarks/src/bin/tpch.rs\n##########\n@@ -180,6 +207,33 @@ async fn execute_sql(ctx: &mut ExecutionContext, sql: &str, debug: bool) -> Resu\n     Ok(())\n }\n \n+async fn convert_tbl(opt: ConvertOpt) -> Result<()> {\n+    let schema = lineitem_schema();\n+\n+    let path = format!(\"{}/lineitem.tbl\", opt.input_path.to_str().unwrap());\n+    let options = CsvReadOptions::new()\n+        .schema(&schema)\n+        .delimiter(b'|')\n+        .file_extension(\".tbl\");\n+\n+    let ctx = ExecutionContext::new();\n+    let csv = Arc::new(CsvExec::try_new(&path, options, None, 4096)?);\n+    let output_path = opt.output_path.to_str().unwrap().to_owned();\n+\n+    match opt.file_format.as_str() {\n+        \"csv\" => ctx.write_csv(csv, output_path).await?,\n+        \"parquet\" => ctx.write_parquet(csv, output_path).await?,\n\nReview comment:\n       this is pretty cool\n\n##########\nFile path: rust/datafusion/src/execution/context.rs\n##########\n@@ -390,6 +391,37 @@ impl ExecutionContext {\n         Ok(())\n     }\n \n+    /// Execute a query and write the results to a partitioned Parquet file\n+    pub async fn write_parquet(\n\nReview comment:\n       eventually it would be cool to write this out with some pattern that is more controllable by the user\n\n##########\nFile path: rust/datafusion/src/execution/context.rs\n##########\n@@ -390,6 +391,37 @@ impl ExecutionContext {\n         Ok(())\n     }\n \n+    /// Execute a query and write the results to a partitioned Parquet file\n+    pub async fn write_parquet(\n+        &self,\n+        plan: Arc<dyn ExecutionPlan>,\n+        path: String,\n+    ) -> Result<()> {\n+        // create directory to contain the CSV files (one per partition)\n+        let path = path.to_owned();\n+        fs::create_dir(&path)?;\n+\n+        for i in 0..plan.output_partitioning().partition_count() {\n+            let path = path.clone();\n+            let plan = plan.clone();\n+            let filename = format!(\"part-{}.parquet\", i);\n+            let path = Path::new(&path).join(&filename);\n+            let file = fs::File::create(path)?;\n+            let mut writer =\n+                ArrowWriter::try_new(file.try_clone().unwrap(), plan.schema(), None)?;\n+            let stream = plan.execute(i).await?;\n+\n+            stream\n+                .map(|batch| writer.write(&batch?))\n+                .try_collect()\n+                .await\n+                .map_err(|e| DataFusionError::from(e))?;\n+\n+            writer.close()?;\n+        }\n+        Ok(())\n\nReview comment:\n       I suggest a test for this function (just for the basic functionality) that it is wired up correctly\n\n\n\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2020-11-18T21:43:32.511+0000",
                    "updated": "2020-11-18T21:43:32.511+0000",
                    "started": "2020-11-18T21:43:32.511+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "513802",
                    "issueId": "13338435"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13338435/worklog/513803",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "alamb commented on a change in pull request #8705:\nURL: https://github.com/apache/arrow/pull/8705#discussion_r526441242\n\n\n\n##########\nFile path: rust/benchmarks/README.md\n##########\n@@ -49,45 +49,16 @@ data. This value can be increased to generate larger data sets.\n The benchmark can then be run (assuming the data created from `dbgen` is in `/mnt/tpch-dbgen`) with a command such as:\n \n ```bash\n-cargo run --release --bin tpch -- --iterations 3 --path /mnt/tpch-dbgen --format tbl --query 1 --batch-size 4096\n+cargo run --release --bin tpch -- benchmark --iterations 3 --path /mnt/tpch-dbgen --format tbl --query 1 --batch-size 4096\n ```\n \n-The benchmark program also supports CSV and Parquet input file formats.\n-\n-This crate does not currently provide a method for converting the generated tbl format to CSV or Parquet so it is \n-necessary to use other tools to perform this conversion.\n-\n-One option is to use the following Docker image to perform the conversion from `tbl` files to CSV or Parquet.\n-\n-```bash\n-docker run -it ballistacompute/spark-benchmarks:0.4.0-SNAPSHOT \n-  -h, --help   Show help message\n-\n-Subcommand: convert-tpch\n-  -i, --input  <arg>\n-      --input-format  <arg>\n-  -o, --output  <arg>\n-      --output-format  <arg>\n-  -p, --partitions  <arg>\n\nReview comment:\n       FWIW the Rust version doesn't seem to have any option to create partitions, which is fine for the first version. However, it might be worth it to leave these instructions in until we have added the `-p` option to the Rust creator. \n\n\n\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2020-11-18T21:44:36.610+0000",
                    "updated": "2020-11-18T21:44:36.610+0000",
                    "started": "2020-11-18T21:44:36.610+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "513803",
                    "issueId": "13338435"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13338435/worklog/513816",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "andygrove commented on a change in pull request #8705:\nURL: https://github.com/apache/arrow/pull/8705#discussion_r526460805\n\n\n\n##########\nFile path: rust/benchmarks/README.md\n##########\n@@ -49,45 +49,16 @@ data. This value can be increased to generate larger data sets.\n The benchmark can then be run (assuming the data created from `dbgen` is in `/mnt/tpch-dbgen`) with a command such as:\n \n ```bash\n-cargo run --release --bin tpch -- --iterations 3 --path /mnt/tpch-dbgen --format tbl --query 1 --batch-size 4096\n+cargo run --release --bin tpch -- benchmark --iterations 3 --path /mnt/tpch-dbgen --format tbl --query 1 --batch-size 4096\n ```\n \n-The benchmark program also supports CSV and Parquet input file formats.\n-\n-This crate does not currently provide a method for converting the generated tbl format to CSV or Parquet so it is \n-necessary to use other tools to perform this conversion.\n-\n-One option is to use the following Docker image to perform the conversion from `tbl` files to CSV or Parquet.\n-\n-```bash\n-docker run -it ballistacompute/spark-benchmarks:0.4.0-SNAPSHOT \n-  -h, --help   Show help message\n-\n-Subcommand: convert-tpch\n-  -i, --input  <arg>\n-      --input-format  <arg>\n-  -o, --output  <arg>\n-      --output-format  <arg>\n-  -p, --partitions  <arg>\n\nReview comment:\n       Good point. I have added these instructions back to the README.\n\n##########\nFile path: rust/datafusion/src/execution/context.rs\n##########\n@@ -390,6 +391,37 @@ impl ExecutionContext {\n         Ok(())\n     }\n \n+    /// Execute a query and write the results to a partitioned Parquet file\n+    pub async fn write_parquet(\n+        &self,\n+        plan: Arc<dyn ExecutionPlan>,\n+        path: String,\n+    ) -> Result<()> {\n+        // create directory to contain the CSV files (one per partition)\n+        let path = path.to_owned();\n+        fs::create_dir(&path)?;\n+\n+        for i in 0..plan.output_partitioning().partition_count() {\n+            let path = path.clone();\n+            let plan = plan.clone();\n+            let filename = format!(\"part-{}.parquet\", i);\n+            let path = Path::new(&path).join(&filename);\n+            let file = fs::File::create(path)?;\n+            let mut writer =\n+                ArrowWriter::try_new(file.try_clone().unwrap(), plan.schema(), None)?;\n+            let stream = plan.execute(i).await?;\n+\n+            stream\n+                .map(|batch| writer.write(&batch?))\n+                .try_collect()\n+                .await\n+                .map_err(|e| DataFusionError::from(e))?;\n+\n+            writer.close()?;\n+        }\n+        Ok(())\n\nReview comment:\n       Added.\n\n\n\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2020-11-18T22:19:10.379+0000",
                    "updated": "2020-11-18T22:19:10.379+0000",
                    "started": "2020-11-18T22:19:10.379+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "513816",
                    "issueId": "13338435"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13338435/worklog/513830",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "alamb commented on a change in pull request #8705:\nURL: https://github.com/apache/arrow/pull/8705#discussion_r526473525\n\n\n\n##########\nFile path: rust/datafusion/src/execution/context.rs\n##########\n@@ -1187,6 +1219,47 @@ mod tests {\n         Ok(())\n     }\n \n+    #[tokio::test]\n+    async fn write_parquet_results() -> Result<()> {\n+        // create partitioned input file and context\n+        let tmp_dir = TempDir::new()?;\n+        let mut ctx = create_ctx(&tmp_dir, 4)?;\n+\n+        // execute a simple query and write the results to CSV\n+        let out_dir = tmp_dir.as_ref().to_str().unwrap().to_string() + \"/out\";\n+        write_parquet(&mut ctx, \"SELECT c1, c2 FROM test\", &out_dir).await?;\n+\n+        // create a new context and verify that the results were saved to a partitioned csv file\n+        let mut ctx = ExecutionContext::new();\n+\n+        // register each partition as well as the top level dir\n\nReview comment:\n       this is cool\n\n\n\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2020-11-18T22:45:24.150+0000",
                    "updated": "2020-11-18T22:45:24.150+0000",
                    "started": "2020-11-18T22:45:24.150+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "513830",
                    "issueId": "13338435"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13338435/worklog/513841",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "alamb closed pull request #8705:\nURL: https://github.com/apache/arrow/pull/8705\n\n\n   \n\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2020-11-18T23:25:14.084+0000",
                    "updated": "2020-11-18T23:25:14.084+0000",
                    "started": "2020-11-18T23:25:14.083+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "513841",
                    "issueId": "13338435"
                }
            ]
        },
        "customfield_12313920": null,
        "issuetype": {
            "self": "https://issues.apache.org/jira/rest/api/2/issuetype/2",
            "id": "2",
            "description": "A new feature of the product, which has yet to be developed.",
            "iconUrl": "https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21141&avatarType=issuetype",
            "name": "New Feature",
            "subtask": false,
            "avatarId": 21141
        },
        "timespent": 5400,
        "customfield_12314020": "{summaryBean=com.atlassian.jira.plugin.devstatus.rest.SummaryBean@6ce02404[summary={pullrequest=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@5b2881c[overall=PullRequestOverallBean{stateCount=0, state='OPEN', details=PullRequestOverallDetails{openCount=0, mergedCount=0, declinedCount=0}},byInstanceType={}], build=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@66437ed7[overall=com.atlassian.jira.plugin.devstatus.summary.beans.BuildOverallBean@77a0e86b[failedBuildCount=0,successfulBuildCount=0,unknownBuildCount=0,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], review=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@61c837cb[overall=com.atlassian.jira.plugin.devstatus.summary.beans.ReviewsOverallBean@1f057333[stateCount=0,state=<null>,dueDate=<null>,overDue=false,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], deployment-environment=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@62cd13c2[overall=com.atlassian.jira.plugin.devstatus.summary.beans.DeploymentOverallBean@125e5c40[topEnvironments=[],showProjects=false,successfulCount=0,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], repository=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@320857af[overall=com.atlassian.jira.plugin.devstatus.summary.beans.CommitOverallBean@6203636[count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], branch=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@cf96633[overall=com.atlassian.jira.plugin.devstatus.summary.beans.BranchOverallBean@6c2597b0[count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}]},errors=[],configErrors=[]], devSummaryJson={\"cachedValue\":{\"errors\":[],\"configErrors\":[],\"summary\":{\"pullrequest\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"stateCount\":0,\"state\":\"OPEN\",\"details\":{\"openCount\":0,\"mergedCount\":0,\"declinedCount\":0,\"total\":0},\"open\":true},\"byInstanceType\":{}},\"build\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"failedBuildCount\":0,\"successfulBuildCount\":0,\"unknownBuildCount\":0},\"byInstanceType\":{}},\"review\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"stateCount\":0,\"state\":null,\"dueDate\":null,\"overDue\":false,\"completed\":false},\"byInstanceType\":{}},\"deployment-environment\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"topEnvironments\":[],\"showProjects\":false,\"successfulCount\":0},\"byInstanceType\":{}},\"repository\":{\"overall\":{\"count\":0,\"lastUpdated\":null},\"byInstanceType\":{}},\"branch\":{\"overall\":{\"count\":0,\"lastUpdated\":null},\"byInstanceType\":{}}}},\"isStale\":false}}",
        "customfield_12314141": null,
        "customfield_12314140": null,
        "project": {
            "self": "https://issues.apache.org/jira/rest/api/2/project/12319525",
            "id": "12319525",
            "key": "ARROW",
            "name": "Apache Arrow",
            "projectTypeKey": "software",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/projectavatar?pid=12319525&avatarId=10011",
                "24x24": "https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12319525&avatarId=10011",
                "16x16": "https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12319525&avatarId=10011",
                "32x32": "https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12319525&avatarId=10011"
            },
            "projectCategory": {
                "self": "https://issues.apache.org/jira/rest/api/2/projectCategory/13960",
                "id": "13960",
                "description": "Apache Arrow",
                "name": "Arrow"
            }
        },
        "aggregatetimespent": 5400,
        "customfield_12312520": null,
        "customfield_12312521": "Wed Nov 18 23:04:26 UTC 2020",
        "customfield_12314422": null,
        "customfield_12314421": null,
        "customfield_12314146": null,
        "customfield_12314420": null,
        "customfield_12314145": null,
        "customfield_12314144": null,
        "customfield_12314143": null,
        "resolutiondate": "2020-11-18T23:04:26.000+0000",
        "workratio": -1,
        "customfield_12312923": null,
        "customfield_12312920": null,
        "customfield_12312921": null,
        "watches": {
            "self": "https://issues.apache.org/jira/rest/api/2/issue/ARROW-10464/watchers",
            "watchCount": 1,
            "isWatching": false
        },
        "created": "2020-11-02T14:32:29.000+0000",
        "updated": "2020-11-18T23:25:15.000+0000",
        "timeoriginalestimate": null,
        "description": "It would be convenient to have a utility as part of the benchmark crate for converting generated TPC-H tbl files into CSV and Parquet files so that we can easily run benchmarks on these different file formats without relying on third party software to perform the conversions.\r\n\r\nIdeally, the tool would also perform re-partitioning of the data so that the user can specify how many partitions to generate.",
        "customfield_10010": null,
        "timetracking": {
            "remainingEstimate": "0h",
            "timeSpent": "1.5h",
            "remainingEstimateSeconds": 0,
            "timeSpentSeconds": 5400
        },
        "customfield_12314523": null,
        "customfield_12314127": null,
        "customfield_12314522": null,
        "customfield_12314126": null,
        "customfield_12314521": null,
        "customfield_12314125": null,
        "customfield_12314520": null,
        "customfield_12314124": null,
        "attachment": [],
        "customfield_12312340": null,
        "customfield_12314123": null,
        "customfield_12312341": null,
        "customfield_12312220": null,
        "customfield_12314122": null,
        "customfield_12314121": null,
        "customfield_12314120": null,
        "customfield_12314129": null,
        "customfield_12314524": null,
        "customfield_12314128": null,
        "summary": "[Rust] Implement utility to convert TPC-H tbl files to CSV and Parquet",
        "customfield_12314130": null,
        "customfield_12310291": null,
        "customfield_12310290": null,
        "customfield_12314138": null,
        "customfield_12314137": null,
        "environment": null,
        "customfield_12314136": null,
        "customfield_12314135": null,
        "customfield_12311020": null,
        "customfield_12314134": null,
        "duedate": null,
        "customfield_12314132": null,
        "customfield_12314131": null,
        "comment": {
            "comments": [
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13338435/comment/17235043",
                    "id": "17235043",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=alamb",
                        "name": "alamb",
                        "key": "alamb",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=alamb&avatarId=43364",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=alamb&avatarId=43364",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=alamb&avatarId=43364",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=alamb&avatarId=43364"
                        },
                        "displayName": "Andrew Lamb",
                        "active": true,
                        "timeZone": "America/New_York"
                    },
                    "body": "Issue resolved by pull request 8705\n[https://github.com/apache/arrow/pull/8705]",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=alamb",
                        "name": "alamb",
                        "key": "alamb",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=alamb&avatarId=43364",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=alamb&avatarId=43364",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=alamb&avatarId=43364",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=alamb&avatarId=43364"
                        },
                        "displayName": "Andrew Lamb",
                        "active": true,
                        "timeZone": "America/New_York"
                    },
                    "created": "2020-11-18T23:04:26.997+0000",
                    "updated": "2020-11-18T23:04:26.997+0000"
                }
            ],
            "maxResults": 1,
            "total": 1,
            "startAt": 0
        },
        "customfield_12311820": "0|z0k7rk:",
        "customfield_12314139": null
    }
}