{
    "expand": "operations,versionedRepresentations,editmeta,changelog,renderedFields",
    "id": "13446595",
    "self": "https://issues.apache.org/jira/rest/api/2/issue/13446595",
    "key": "ARROW-16642",
    "fields": {
        "fixVersions": [],
        "resolution": null,
        "customfield_12312322": null,
        "customfield_12312323": null,
        "customfield_12312320": null,
        "customfield_12310420": "9223372036854775807",
        "customfield_12312321": null,
        "customfield_12312328": null,
        "customfield_12312329": null,
        "customfield_12312326": null,
        "customfield_12310300": null,
        "customfield_12312327": null,
        "customfield_12312324": null,
        "customfield_12312720": null,
        "customfield_12312325": null,
        "lastViewed": null,
        "priority": {
            "self": "https://issues.apache.org/jira/rest/api/2/priority/3",
            "iconUrl": "https://issues.apache.org/jira/images/icons/priorities/major.svg",
            "name": "Major",
            "id": "3"
        },
        "labels": [
            "pull-request-available"
        ],
        "customfield_12312333": null,
        "customfield_12312334": null,
        "customfield_12313422": "false",
        "customfield_12310310": "1.0",
        "customfield_12312331": null,
        "customfield_12312332": null,
        "aggregatetimeoriginalestimate": 604800,
        "timeestimate": 604800,
        "customfield_12312330": null,
        "versions": [
            {
                "self": "https://issues.apache.org/jira/rest/api/2/version/12351051",
                "id": "12351051",
                "description": "",
                "name": "8.0.0",
                "archived": false,
                "released": true,
                "releaseDate": "2022-05-06"
            }
        ],
        "customfield_12311120": null,
        "customfield_12313826": null,
        "customfield_12312339": null,
        "issuelinks": [],
        "customfield_12313825": null,
        "assignee": null,
        "customfield_12312337": null,
        "customfield_12313823": null,
        "customfield_12312338": null,
        "customfield_12311920": null,
        "customfield_12313822": null,
        "customfield_12312335": null,
        "customfield_12313821": null,
        "customfield_12312336": null,
        "customfield_12313820": null,
        "status": {
            "self": "https://issues.apache.org/jira/rest/api/2/status/1",
            "description": "The issue is open and ready for the assignee to start work on it.",
            "iconUrl": "https://issues.apache.org/jira/images/icons/statuses/open.png",
            "name": "Open",
            "id": "1",
            "statusCategory": {
                "self": "https://issues.apache.org/jira/rest/api/2/statuscategory/2",
                "id": 2,
                "key": "new",
                "colorName": "blue-gray",
                "name": "To Do"
            }
        },
        "components": [
            {
                "self": "https://issues.apache.org/jira/rest/api/2/component/12328935",
                "id": "12328935",
                "name": "C++"
            }
        ],
        "customfield_12312026": null,
        "customfield_12312023": null,
        "customfield_12312024": null,
        "aggregatetimeestimate": 604800,
        "customfield_12312022": null,
        "customfield_12310921": null,
        "customfield_12310920": "9223372036854775807",
        "customfield_12312823": null,
        "creator": {
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=yurikoomiga",
            "name": "yurikoomiga",
            "key": "JIRAUSER289948",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=34058",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34058",
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34058",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34058"
            },
            "displayName": "yurikoomiga",
            "active": true,
            "timeZone": "Etc/UTC"
        },
        "subtasks": [],
        "reporter": {
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=yurikoomiga",
            "name": "yurikoomiga",
            "key": "JIRAUSER289948",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=34058",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34058",
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34058",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34058"
            },
            "displayName": "yurikoomiga",
            "active": true,
            "timeZone": "Etc/UTC"
        },
        "aggregateprogress": {
            "progress": 0,
            "total": 604800,
            "percent": 0
        },
        "customfield_12313520": null,
        "customfield_12310250": null,
        "progress": {
            "progress": 0,
            "total": 604800,
            "percent": 0
        },
        "customfield_12313924": null,
        "votes": {
            "self": "https://issues.apache.org/jira/rest/api/2/issue/ARROW-16642/votes",
            "votes": 0,
            "hasVoted": false
        },
        "worklog": {
            "startAt": 0,
            "maxResults": 20,
            "total": 0,
            "worklogs": []
        },
        "customfield_12313920": null,
        "issuetype": {
            "self": "https://issues.apache.org/jira/rest/api/2/issuetype/1",
            "id": "1",
            "description": "A problem which impairs or prevents the functions of the product.",
            "iconUrl": "https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype",
            "name": "Bug",
            "subtask": false,
            "avatarId": 21133
        },
        "timespent": null,
        "customfield_12314020": "{summaryBean=com.atlassian.jira.plugin.devstatus.rest.SummaryBean@461b9aa3[summary={pullrequest=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@4ce5a42b[overall=PullRequestOverallBean{stateCount=0, state='OPEN', details=PullRequestOverallDetails{openCount=0, mergedCount=0, declinedCount=0}},byInstanceType={}], build=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@4b89dcc8[overall=com.atlassian.jira.plugin.devstatus.summary.beans.BuildOverallBean@2aacfd6e[failedBuildCount=0,successfulBuildCount=0,unknownBuildCount=0,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], review=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@63074f4b[overall=com.atlassian.jira.plugin.devstatus.summary.beans.ReviewsOverallBean@5e31d273[stateCount=0,state=<null>,dueDate=<null>,overDue=false,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], deployment-environment=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@5bdb2ae1[overall=com.atlassian.jira.plugin.devstatus.summary.beans.DeploymentOverallBean@16d1fb79[topEnvironments=[],showProjects=false,successfulCount=0,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], repository=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@4ff583ff[overall=com.atlassian.jira.plugin.devstatus.summary.beans.CommitOverallBean@1f877238[count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], branch=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@1d09df0b[overall=com.atlassian.jira.plugin.devstatus.summary.beans.BranchOverallBean@41ae5e0[count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}]},errors=[],configErrors=[]], devSummaryJson={\"cachedValue\":{\"errors\":[],\"configErrors\":[],\"summary\":{\"pullrequest\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"stateCount\":0,\"state\":\"OPEN\",\"details\":{\"openCount\":0,\"mergedCount\":0,\"declinedCount\":0,\"total\":0},\"open\":true},\"byInstanceType\":{}},\"build\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"failedBuildCount\":0,\"successfulBuildCount\":0,\"unknownBuildCount\":0},\"byInstanceType\":{}},\"review\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"stateCount\":0,\"state\":null,\"dueDate\":null,\"overDue\":false,\"completed\":false},\"byInstanceType\":{}},\"deployment-environment\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"topEnvironments\":[],\"showProjects\":false,\"successfulCount\":0},\"byInstanceType\":{}},\"repository\":{\"overall\":{\"count\":0,\"lastUpdated\":null},\"byInstanceType\":{}},\"branch\":{\"overall\":{\"count\":0,\"lastUpdated\":null},\"byInstanceType\":{}}}},\"isStale\":false}}",
        "customfield_12314141": null,
        "customfield_12314140": null,
        "project": {
            "self": "https://issues.apache.org/jira/rest/api/2/project/12319525",
            "id": "12319525",
            "key": "ARROW",
            "name": "Apache Arrow",
            "projectTypeKey": "software",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/projectavatar?pid=12319525&avatarId=10011",
                "24x24": "https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12319525&avatarId=10011",
                "16x16": "https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12319525&avatarId=10011",
                "32x32": "https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12319525&avatarId=10011"
            },
            "projectCategory": {
                "self": "https://issues.apache.org/jira/rest/api/2/projectCategory/13960",
                "id": "13960",
                "description": "Apache Arrow",
                "name": "Arrow"
            }
        },
        "aggregatetimespent": null,
        "customfield_12312520": null,
        "customfield_12312521": "Wed May 25 21:20:23 UTC 2022",
        "customfield_12314422": null,
        "customfield_12314421": [
            "C++"
        ],
        "customfield_12314146": null,
        "customfield_12314420": null,
        "customfield_12314145": null,
        "customfield_12314144": null,
        "customfield_12314143": null,
        "resolutiondate": null,
        "workratio": 0,
        "customfield_12312923": null,
        "customfield_12312920": null,
        "customfield_12312921": null,
        "watches": {
            "self": "https://issues.apache.org/jira/rest/api/2/issue/ARROW-16642/watchers",
            "watchCount": 3,
            "isWatching": false
        },
        "created": "2022-05-24T14:48:43.000+0000",
        "updated": "2022-05-25T21:20:23.000+0000",
        "timeoriginalestimate": 604800,
        "description": "Hi All\r\n\r\nWhen I use Arrow Reading Parquet File like follow:\r\n\r\n\u00a0\r\n{code:java}\r\nauto st = parquet::arrow::FileReader::Make(\r\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 arrow::default_memory_pool(),\r\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 parquet::ParquetFileReader::Open(_parquet, _properties), &_reader); \u00a0\u00a0\r\narrow::Status status = _reader->GetRecordBatchReader({_current_group},_parquet_column_ids, &_rb_batch); \u00a0 \u00a0\r\n_reader->set_batch_size(65536); \u00a0 \u00a0 \u00a0\u00a0\r\n_reader->set_use_threads(true); \u00a0 \u00a0 \u00a0\r\nstatus = _rb_batch->ReadNext(&_batch);\u00a0 {code}\r\n{color:#172b4d}status is not ok and an error occured like this:{color}\r\n{code:java}\r\nIOError: Corrupt snappy compressed data. {code}\r\nWhen I comment out this statement\r\n{code:java}\r\n _reader->set_use_threads(true);{code}\r\nThe program runs normally and I can read parquet file well.\r\nProgram errors only occur when I read multiple columns and using _reader->set_use_threads(true); and a single column will not occur error\r\n\r\nThe testing parquet file is created by pyarrow\uff0cI use only 1 group and each group has 3000000 records.\r\nThe parquet file has 20 columns including int and string types\r\n\r\nyou can create a test parquet file using attachment python script\r\n\r\nIn my case,I read 0,1,2,3,4,5,6 index columns\r\n\r\nReading file using C++,arrow 7.0.0 ,snappy 1.1.8\r\n\r\nWritting file using python3.8 ,pyarrow 7.0.0\r\n\r\nLooking forward to your reply\r\n\r\nThank you!\r\n\r\n[~apitrou]\u00a0\r\n\r\n[~westonpace]\u00a0",
        "customfield_10010": null,
        "timetracking": {
            "originalEstimate": "168h",
            "remainingEstimate": "168h",
            "originalEstimateSeconds": 604800,
            "remainingEstimateSeconds": 604800
        },
        "customfield_12314523": null,
        "customfield_12314127": null,
        "customfield_12314522": null,
        "customfield_12314126": null,
        "customfield_12314521": null,
        "customfield_12314125": null,
        "customfield_12314520": null,
        "customfield_12314124": null,
        "attachment": [
            {
                "self": "https://issues.apache.org/jira/rest/api/2/attachment/13044142",
                "id": "13044142",
                "filename": "test_std_02.py",
                "author": {
                    "self": "https://issues.apache.org/jira/rest/api/2/user?username=yurikoomiga",
                    "name": "yurikoomiga",
                    "key": "JIRAUSER289948",
                    "avatarUrls": {
                        "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=34058",
                        "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34058",
                        "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34058",
                        "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34058"
                    },
                    "displayName": "yurikoomiga",
                    "active": true,
                    "timeZone": "Etc/UTC"
                },
                "created": "2022-05-24T14:46:22.429+0000",
                "size": 1757,
                "mimeType": "text/x-python",
                "content": "https://issues.apache.org/jira/secure/attachment/13044142/test_std_02.py"
            }
        ],
        "customfield_12312340": null,
        "customfield_12314123": null,
        "customfield_12312341": null,
        "customfield_12312220": null,
        "customfield_12314122": null,
        "customfield_12314121": null,
        "customfield_12314120": null,
        "customfield_12314129": null,
        "customfield_12314524": null,
        "customfield_12314128": null,
        "summary": "[C++] An Error Occured While Reading Parquet File Using C++ - GetRecordBatchReader -Corrupt snappy compressed data. ",
        "customfield_12314130": null,
        "customfield_12310291": null,
        "customfield_12310290": null,
        "customfield_12314138": null,
        "customfield_12314137": null,
        "environment": "C++,arrow 7.0.0 ,snappy 1.1.8, arrow 8.0.0\r\npyarrow 7.0.0 ubuntu 9.4.0  python3.8,\r\n",
        "customfield_12314136": null,
        "customfield_12314135": null,
        "customfield_12311020": "https://github.com/apache/arrow/issues/13186",
        "customfield_12314134": null,
        "duedate": null,
        "customfield_12314132": null,
        "customfield_12314131": null,
        "comment": {
            "comments": [
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13446595/comment/17542245",
                    "id": "17542245",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=westonpace",
                        "name": "westonpace",
                        "key": "westonpace",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=34045",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34045",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34045",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34045"
                        },
                        "displayName": "Weston Pace",
                        "active": true,
                        "timeZone": "America/Los_Angeles"
                    },
                    "body": "You might need to provide a few more details on how you are reading the parquet file.  I used the python script you provided to create a file {{/home/pace/test.parquet}} which I then tested with this script:\r\n\r\n{noformat}\r\n#include <iostream>\r\n\r\n#include \"arrow/filesystem/api.h\"\r\n#include \"arrow/record_batch.h\"\r\n\r\n#include \"parquet/api/reader.h\"\r\n#include \"parquet/arrow/reader.h\"\r\n\r\nint main() {\r\n  auto fs = std::make_unique<arrow::fs::LocalFileSystem>();\r\n  auto input_file = fs->OpenInputFile(\"/home/pace/test.parquet\").ValueOrDie();\r\n\r\n  std::unique_ptr<parquet::arrow::FileReader> file_reader;\r\n  arrow::Status st = parquet::arrow::FileReader::Make(\r\n      arrow::default_memory_pool(),\r\n      parquet::ParquetFileReader::Open(input_file), &file_reader);\r\n  if (!st.ok()) {\r\n    std::cerr << \"Error making file reader: \" << st << std::endl;\r\n    return -1;\r\n  }\r\n  std::vector<int> parquet_column_ids = {0, 1, 2, 3, 4, 5, 6};\r\n  std::cout << \"The file has \" << file_reader->num_row_groups() << \" row groups\"\r\n            << std::endl;\r\n  for (int row_group_idx = 0; row_group_idx < file_reader->num_row_groups();\r\n       row_group_idx++) {\r\n    std::cout << \"Reading row group: \" << row_group_idx << std::endl;\r\n    std::shared_ptr<arrow::RecordBatchReader> record_batch_reader;\r\n    st = file_reader->GetRecordBatchReader({row_group_idx}, parquet_column_ids,\r\n                                           &record_batch_reader);\r\n    file_reader->set_batch_size(65536);\r\n    file_reader->set_use_threads(true);\r\n    std::shared_ptr<arrow::RecordBatch> batch;\r\n    while (true) {\r\n      st = record_batch_reader->ReadNext(&batch);\r\n      if (st.ok()) {\r\n        if (!batch) {\r\n          // Reached the end of the row group\r\n          break;\r\n        }\r\n        std::cout << \"  Read in record batch with \" << batch->num_rows()\r\n                  << \" rows\" << std::endl;\r\n      } else {\r\n        std::cerr << \"Error encountered reading record batch: \" << st\r\n                  << std::endl;\r\n        return -2;\r\n      }\r\n    }\r\n  }\r\n}\r\n{noformat}\r\n\r\nI did not get any errors and got the expected output:\r\n\r\n{noformat}\r\nThe file has 1 row groups\r\nReading row group: 0\r\n  Read in record batch with 65536 rows\r\n  Read in record batch with 65536 rows\r\n  Read in record batch with 65536 rows\r\n  Read in record batch with 65536 rows\r\n  Read in record batch with 65536 rows\r\n  Read in record batch with 65536 rows\r\n  Read in record batch with 65536 rows\r\n  Read in record batch with 65536 rows\r\n  Read in record batch with 65536 rows\r\n  Read in record batch with 65536 rows\r\n  Read in record batch with 65536 rows\r\n  Read in record batch with 65536 rows\r\n  Read in record batch with 65536 rows\r\n  Read in record batch with 65536 rows\r\n  Read in record batch with 65536 rows\r\n  Read in record batch with 65536 rows\r\n  Read in record batch with 65536 rows\r\n  Read in record batch with 65536 rows\r\n  Read in record batch with 65536 rows\r\n  Read in record batch with 65536 rows\r\n  Read in record batch with 65536 rows\r\n  Read in record batch with 65536 rows\r\n  Read in record batch with 65536 rows\r\n  Read in record batch with 65536 rows\r\n  Read in record batch with 65536 rows\r\n  Read in record batch with 65536 rows\r\n  Read in record batch with 65536 rows\r\n  Read in record batch with 65536 rows\r\n  Read in record batch with 65536 rows\r\n  Read in record batch with 65536 rows\r\n  Read in record batch with 65536 rows\r\n  Read in record batch with 65536 rows\r\n  Read in record batch with 65536 rows\r\n  Read in record batch with 65536 rows\r\n  Read in record batch with 65536 rows\r\n  Read in record batch with 65536 rows\r\n  Read in record batch with 65536 rows\r\n  Read in record batch with 65536 rows\r\n  Read in record batch with 65536 rows\r\n  Read in record batch with 65536 rows\r\n  Read in record batch with 65536 rows\r\n  Read in record batch with 65536 rows\r\n  Read in record batch with 65536 rows\r\n  Read in record batch with 65536 rows\r\n  Read in record batch with 65536 rows\r\n  Read in record batch with 50880 rows\r\n{noformat}\r\n\r\nDoes my test program work in your environment?",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=westonpace",
                        "name": "westonpace",
                        "key": "westonpace",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=34045",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34045",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34045",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34045"
                        },
                        "displayName": "Weston Pace",
                        "active": true,
                        "timeZone": "America/Los_Angeles"
                    },
                    "created": "2022-05-25T21:20:23.878+0000",
                    "updated": "2022-05-25T21:20:23.878+0000"
                }
            ],
            "maxResults": 1,
            "total": 1,
            "startAt": 0
        },
        "customfield_12311820": "0|z12n68:",
        "customfield_12314139": null
    }
}