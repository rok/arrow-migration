{
    "expand": "operations,versionedRepresentations,editmeta,changelog,renderedFields",
    "id": "13236916",
    "self": "https://issues.apache.org/jira/rest/api/2/issue/13236916",
    "key": "ARROW-5471",
    "fields": {
        "fixVersions": [
            {
                "self": "https://issues.apache.org/jira/rest/api/2/version/12345978",
                "id": "12345978",
                "description": "",
                "name": "0.15.0",
                "archived": false,
                "released": true,
                "releaseDate": "2019-10-05"
            }
        ],
        "resolution": {
            "self": "https://issues.apache.org/jira/rest/api/2/resolution/1",
            "id": "1",
            "description": "A fix for this issue is checked into the tree and tested.",
            "name": "Fixed"
        },
        "customfield_12312322": null,
        "customfield_12312323": null,
        "customfield_12312320": null,
        "customfield_12310420": "9223372036854775807",
        "customfield_12312321": null,
        "customfield_12312328": null,
        "customfield_12312329": null,
        "customfield_12312326": null,
        "customfield_12310300": null,
        "customfield_12312327": null,
        "customfield_12312324": null,
        "customfield_12312720": null,
        "customfield_12312325": null,
        "lastViewed": null,
        "priority": {
            "self": "https://issues.apache.org/jira/rest/api/2/priority/3",
            "iconUrl": "https://issues.apache.org/jira/images/icons/priorities/major.svg",
            "name": "Major",
            "id": "3"
        },
        "labels": [
            "pull-request-available"
        ],
        "customfield_12312333": null,
        "customfield_12312334": null,
        "customfield_12313422": "false",
        "customfield_12310310": "0.0",
        "customfield_12312331": null,
        "customfield_12312332": null,
        "aggregatetimeoriginalestimate": null,
        "timeestimate": 0,
        "customfield_12312330": null,
        "versions": [],
        "customfield_12311120": null,
        "customfield_12313826": null,
        "customfield_12312339": null,
        "issuelinks": [],
        "customfield_12313825": null,
        "assignee": {
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=zeyuanxy",
            "name": "zeyuanxy",
            "key": "zeyuanxy",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=34061",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34061",
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34061",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34061"
            },
            "displayName": "Zeyuan Shang",
            "active": true,
            "timeZone": "Etc/UTC"
        },
        "customfield_12312337": null,
        "customfield_12313823": null,
        "customfield_12312338": null,
        "customfield_12311920": null,
        "customfield_12313822": null,
        "customfield_12312335": null,
        "customfield_12313821": null,
        "customfield_12312336": null,
        "customfield_12313820": null,
        "status": {
            "self": "https://issues.apache.org/jira/rest/api/2/status/5",
            "description": "A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.",
            "iconUrl": "https://issues.apache.org/jira/images/icons/statuses/resolved.png",
            "name": "Resolved",
            "id": "5",
            "statusCategory": {
                "self": "https://issues.apache.org/jira/rest/api/2/statuscategory/3",
                "id": 3,
                "key": "done",
                "colorName": "green",
                "name": "Done"
            }
        },
        "components": [
            {
                "self": "https://issues.apache.org/jira/rest/api/2/component/12334626",
                "id": "12334626",
                "name": "C++ - Gandiva"
            }
        ],
        "customfield_12312026": null,
        "customfield_12312023": null,
        "customfield_12312024": null,
        "aggregatetimeestimate": 0,
        "customfield_12312022": null,
        "customfield_12310921": null,
        "customfield_12310920": "9223372036854775807",
        "customfield_12312823": null,
        "creator": {
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=zeyuanxy",
            "name": "zeyuanxy",
            "key": "zeyuanxy",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=34061",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34061",
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34061",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34061"
            },
            "displayName": "Zeyuan Shang",
            "active": true,
            "timeZone": "Etc/UTC"
        },
        "subtasks": [],
        "reporter": {
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=zeyuanxy",
            "name": "zeyuanxy",
            "key": "zeyuanxy",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=34061",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34061",
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34061",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34061"
            },
            "displayName": "Zeyuan Shang",
            "active": true,
            "timeZone": "Etc/UTC"
        },
        "aggregateprogress": {
            "progress": 14400,
            "total": 14400,
            "percent": 100
        },
        "customfield_12313520": null,
        "customfield_12310250": null,
        "progress": {
            "progress": 14400,
            "total": 14400,
            "percent": 100
        },
        "customfield_12313924": null,
        "votes": {
            "self": "https://issues.apache.org/jira/rest/api/2/issue/ARROW-5471/votes",
            "votes": 0,
            "hasVoted": false
        },
        "worklog": {
            "startAt": 0,
            "maxResults": 20,
            "total": 27,
            "worklogs": [
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13236916/worklog/305310",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "zeyuanxy commented on pull request #5255: ARROW-5471: [C++][Gandiva]Array offset is ignored in Gandiva projector\nURL: https://github.com/apache/arrow/pull/5255\n \n \n   Fix for JIRA issue https://issues.apache.org/jira/browse/ARROW-5471\n \n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2019-09-02T20:09:05.324+0000",
                    "updated": "2019-09-02T20:09:05.324+0000",
                    "started": "2019-09-02T20:09:05.323+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "305310",
                    "issueId": "13236916"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13236916/worklog/305313",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "zeyuanxy commented on issue #5255: ARROW-5471: [C++][Gandiva]Array offset is ignored in Gandiva projector\nURL: https://github.com/apache/arrow/pull/5255#issuecomment-527240942\n \n \n   The failed test says \"Address already in use\" for Flight, which seems that it is not related with my changes. Is it possible to run the test again?\n \n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2019-09-02T20:49:57.619+0000",
                    "updated": "2019-09-02T20:49:57.619+0000",
                    "started": "2019-09-02T20:49:57.618+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "305313",
                    "issueId": "13236916"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13236916/worklog/305328",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "kou commented on issue #5255: ARROW-5471: [C++][Gandiva] Array offset is ignored in Gandiva projector\nURL: https://github.com/apache/arrow/pull/5255#issuecomment-527245565\n \n \n   #5253 will fix the Flight test failure.\n \n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2019-09-02T21:28:55.479+0000",
                    "updated": "2019-09-02T21:28:55.479+0000",
                    "started": "2019-09-02T21:28:55.479+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "305328",
                    "issueId": "13236916"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13236916/worklog/307066",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "pravindra commented on pull request #5255: ARROW-5471: [C++][Gandiva] Array offset is ignored in Gandiva projector\nURL: https://github.com/apache/arrow/pull/5255#discussion_r321191323\n \n \n\n ##########\n File path: cpp/src/gandiva/compiled_expr.h\n ##########\n @@ -25,7 +25,7 @@\n \n namespace gandiva {\n \n-using EvalFunc = int (*)(uint8_t** buffers, uint8_t** local_bitmaps,\n+using EvalFunc = int (*)(uint8_t** buffers, int64_t* offsets, uint8_t** local_bitmaps,\n \n Review comment:\n   there is a single offset for the batch. why have an array of offsets ?\n \n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2019-09-05T10:57:45.519+0000",
                    "updated": "2019-09-05T10:57:45.519+0000",
                    "started": "2019-09-05T10:57:45.519+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "307066",
                    "issueId": "13236916"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13236916/worklog/307184",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "zeyuanxy commented on pull request #5255: ARROW-5471: [C++][Gandiva] Array offset is ignored in Gandiva projector\nURL: https://github.com/apache/arrow/pull/5255#discussion_r321292479\n \n \n\n ##########\n File path: cpp/src/gandiva/compiled_expr.h\n ##########\n @@ -25,7 +25,7 @@\n \n namespace gandiva {\n \n-using EvalFunc = int (*)(uint8_t** buffers, uint8_t** local_bitmaps,\n+using EvalFunc = int (*)(uint8_t** buffers, int64_t* offsets, uint8_t** local_bitmaps,\n \n Review comment:\n   Thanks for reviewing! I probably misunderstood how the offset works. I used to add a single offset, but I realized that each column also has its own offset, like such a case (use pseudocode here)\r\n   \r\n   ```python\r\n   a = [1, 2, 3, 4]\r\n   b = [2, 3, 4]\r\n   r = MakeRecordBatch([a.slice(1), b])\r\n   rr = r.slice(1)\r\n   ```\r\n   will column `a` and `b` in record batch `rr` have different offsets?\r\n   \n \n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2019-09-05T14:19:17.979+0000",
                    "updated": "2019-09-05T14:19:17.979+0000",
                    "started": "2019-09-05T14:19:17.978+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "307184",
                    "issueId": "13236916"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13236916/worklog/307185",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "zeyuanxy commented on issue #5255: ARROW-5471: [C++][Gandiva] Array offset is ignored in Gandiva projector\nURL: https://github.com/apache/arrow/pull/5255#issuecomment-528387356\n \n \n   Thanks for reviewing! I replied the discussion of offset. And I will look at the output bitmap and add the filter test.\n \n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2019-09-05T14:21:04.132+0000",
                    "updated": "2019-09-05T14:21:04.132+0000",
                    "started": "2019-09-05T14:21:04.132+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "307185",
                    "issueId": "13236916"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13236916/worklog/307729",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "pravindra commented on pull request #5255: ARROW-5471: [C++][Gandiva] Array offset is ignored in Gandiva projector\nURL: https://github.com/apache/arrow/pull/5255#discussion_r321660438\n \n \n\n ##########\n File path: cpp/src/gandiva/compiled_expr.h\n ##########\n @@ -25,7 +25,7 @@\n \n namespace gandiva {\n \n-using EvalFunc = int (*)(uint8_t** buffers, uint8_t** local_bitmaps,\n+using EvalFunc = int (*)(uint8_t** buffers, int64_t* offsets, uint8_t** local_bitmaps,\n \n Review comment:\n   you are right, I didn't realise that the arrays can be sliced too. Can you please add a test for this case (similar to your example above) too ?\n \n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2019-09-06T09:48:52.322+0000",
                    "updated": "2019-09-06T09:48:52.322+0000",
                    "started": "2019-09-06T09:48:52.322+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "307729",
                    "issueId": "13236916"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13236916/worklog/308143",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "zeyuanxy commented on pull request #5255: ARROW-5471: [C++][Gandiva] Array offset is ignored in Gandiva projector\nURL: https://github.com/apache/arrow/pull/5255#discussion_r321902504\n \n \n\n ##########\n File path: cpp/src/gandiva/compiled_expr.h\n ##########\n @@ -25,7 +25,7 @@\n \n namespace gandiva {\n \n-using EvalFunc = int (*)(uint8_t** buffers, uint8_t** local_bitmaps,\n+using EvalFunc = int (*)(uint8_t** buffers, int64_t* offsets, uint8_t** local_bitmaps,\n \n Review comment:\n   No problem. Thanks again for reviewing!\n \n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2019-09-06T20:41:23.802+0000",
                    "updated": "2019-09-06T20:41:23.802+0000",
                    "started": "2019-09-06T20:41:23.802+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "308143",
                    "issueId": "13236916"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13236916/worklog/308299",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "pravindra commented on issue #5255: ARROW-5471: [C++][Gandiva] Array offset is ignored in Gandiva projector\nURL: https://github.com/apache/arrow/pull/5255#issuecomment-529072108\n \n \n   > @pravindra As for computing the bitmap, it seems a little bit complicated here, as with the offset, the bits may not be aligned any more. I am thinking maybe copy these source bit maps with offsets to make sure they are aligned, but this seems inefficient. Any suggestions here? Thanks!\r\n   \r\n   agree with you. For this PR, let's copy the unaligned ones - that way, there is no additional cost for the common case.\r\n   \n \n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2019-09-07T04:40:05.209+0000",
                    "updated": "2019-09-07T04:40:05.209+0000",
                    "started": "2019-09-07T04:40:05.208+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "308299",
                    "issueId": "13236916"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13236916/worklog/308314",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "pravindra commented on pull request #5255: ARROW-5471: [C++][Gandiva] Array offset is ignored in Gandiva projector\nURL: https://github.com/apache/arrow/pull/5255#discussion_r321959403\n \n \n\n ##########\n File path: cpp/src/gandiva/tests/projector_test.cc\n ##########\n @@ -747,10 +747,11 @@ TEST_F(TestProjector, TestOffset) {\n \n   // Create a row-batch with some sample data\n   int num_records = 4;\n-  auto array0 = MakeArrowArrayInt32({1, 2, 3, 4}, {true, true, true, true});\n+  auto array0 = MakeArrowArrayInt32({1, 2, 3, 4, 5}, {true, true, true, true, true});\n \n Review comment:\n   can you please make some of these invalid ? that'll exercise the bitmap code too.\n \n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2019-09-07T07:37:21.827+0000",
                    "updated": "2019-09-07T07:37:21.827+0000",
                    "started": "2019-09-07T07:37:21.827+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "308314",
                    "issueId": "13236916"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13236916/worklog/308316",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "pravindra commented on pull request #5255: ARROW-5471: [C++][Gandiva] Array offset is ignored in Gandiva projector\nURL: https://github.com/apache/arrow/pull/5255#discussion_r321959617\n \n \n\n ##########\n File path: cpp/src/gandiva/bitmap_accumulator.cc\n ##########\n @@ -28,15 +28,15 @@ void BitMapAccumulator::ComputeResult(uint8_t* dst_bitmap) {\n     // set all bits to 0.\n     memset(dst_bitmap, 0, arrow::BitUtil::BytesForBits(num_records));\n   } else {\n-    IntersectBitMaps(dst_bitmap, src_maps_, num_records);\n+    IntersectBitMaps(dst_bitmap, src_maps_, src_map_offsets_, num_records);\n   }\n }\n \n /// Compute the intersection of multiple bitmaps.\n void BitMapAccumulator::IntersectBitMaps(uint8_t* dst_map,\n \n Review comment:\n   i think you'll need to make a change in bitmap_accumulator_test.cc also for the extra arg ? can you please add a test there for \"buffers with offsets\" - that will be a good unit test for this. ?\n \n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2019-09-07T07:37:21.830+0000",
                    "updated": "2019-09-07T07:37:21.830+0000",
                    "started": "2019-09-07T07:37:21.830+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "308316",
                    "issueId": "13236916"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13236916/worklog/308315",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "pravindra commented on pull request #5255: ARROW-5471: [C++][Gandiva] Array offset is ignored in Gandiva projector\nURL: https://github.com/apache/arrow/pull/5255#discussion_r321959390\n \n \n\n ##########\n File path: cpp/src/gandiva/tests/filter_test.cc\n ##########\n @@ -292,4 +292,49 @@ TEST_F(TestFilter, TestSimpleSVInt32) {\n   EXPECT_ARROW_ARRAY_EQUALS(exp, selection_vector->ToArray());\n }\n \n+TEST_F(TestFilter, TestOffset) {\n+  // schema for input fields\n+  auto field0 = field(\"f0\", int32());\n+  auto field1 = field(\"f1\", int32());\n+  auto schema = arrow::schema({field0, field1});\n+\n+  // Build condition f0 + f1 < 10\n+  auto node_f0 = TreeExprBuilder::MakeField(field0);\n+  auto node_f1 = TreeExprBuilder::MakeField(field1);\n+  auto sum_func =\n+      TreeExprBuilder::MakeFunction(\"add\", {node_f0, node_f1}, arrow::int32());\n+  auto literal_10 = TreeExprBuilder::MakeLiteral((int32_t)10);\n+  auto less_than_10 = TreeExprBuilder::MakeFunction(\"less_than\", {sum_func, literal_10},\n+                                                    arrow::boolean());\n+  auto condition = TreeExprBuilder::MakeCondition(less_than_10);\n+\n+  std::shared_ptr<Filter> filter;\n+  auto status = Filter::Make(schema, condition, TestConfiguration(), &filter);\n+  EXPECT_TRUE(status.ok());\n+\n+  // Create a row-batch with some sample data\n+  int num_records = 5;\n+  auto array0 =\n+      MakeArrowArrayInt32({0, 1, 2, 3, 4, 6}, {true, true, true, true, true, true});\n+  array0 = array0->Slice(1);\n+  auto array1 = MakeArrowArrayInt32({5, 9, 6, 17, 3}, {true, true, true, true, true});\n \n Review comment:\n   can you please make some of these invalid ? that'll exercise the bitmap code too.\n \n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2019-09-07T07:37:21.830+0000",
                    "updated": "2019-09-07T07:37:21.830+0000",
                    "started": "2019-09-07T07:37:21.830+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "308315",
                    "issueId": "13236916"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13236916/worklog/308317",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "pravindra commented on pull request #5255: ARROW-5471: [C++][Gandiva] Array offset is ignored in Gandiva projector\nURL: https://github.com/apache/arrow/pull/5255#discussion_r321959311\n \n \n\n ##########\n File path: cpp/src/gandiva/bitmap_accumulator.cc\n ##########\n @@ -51,28 +51,18 @@ void BitMapAccumulator::IntersectBitMaps(uint8_t* dst_map,\n     case 1: {\n       // one src_maps_ bitmap. copy to dst_map\n       memcpy(dst_map, src_maps[0], num_bytes);\n \n Review comment:\n   we can remove this memcpy now. right ?.\n \n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2019-09-07T07:37:22.055+0000",
                    "updated": "2019-09-07T07:37:22.055+0000",
                    "started": "2019-09-07T07:37:22.054+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "308317",
                    "issueId": "13236916"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13236916/worklog/308346",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "codecov-io commented on issue #5255: ARROW-5471: [C++][Gandiva] Array offset is ignored in Gandiva projector\nURL: https://github.com/apache/arrow/pull/5255#issuecomment-529106628\n \n \n   # [Codecov](https://codecov.io/gh/apache/arrow/pull/5255?src=pr&el=h1) Report\n   > :exclamation: No coverage uploaded for pull request base (`master@d818299`). [Click here to learn what that means](https://docs.codecov.io/docs/error-reference#section-missing-base-commit).\n   > The diff coverage is `100%`.\n   \n   [![Impacted file tree graph](https://codecov.io/gh/apache/arrow/pull/5255/graphs/tree.svg?width=650&token=LpTCFbqVT1&height=150&src=pr)](https://codecov.io/gh/apache/arrow/pull/5255?src=pr&el=tree)\n   \n   ```diff\n   @@            Coverage Diff            @@\n   ##             master    #5255   +/-   ##\n   =========================================\n     Coverage          ?   89.27%           \n   =========================================\n     Files             ?      753           \n     Lines             ?   108810           \n     Branches          ?        0           \n   =========================================\n     Hits              ?    97140           \n     Misses            ?    11670           \n     Partials          ?        0\n   ```\n   \n   \n   | [Impacted Files](https://codecov.io/gh/apache/arrow/pull/5255?src=pr&el=tree) | Coverage \u0394 | |\n   |---|---|---|\n   | [cpp/src/gandiva/llvm\\_generator.h](https://codecov.io/gh/apache/arrow/pull/5255/diff?src=pr&el=tree#diff-Y3BwL3NyYy9nYW5kaXZhL2xsdm1fZ2VuZXJhdG9yLmg=) | `100% <\u00f8> (\u00f8)` | |\n   | [cpp/src/gandiva/compiled\\_expr.h](https://codecov.io/gh/apache/arrow/pull/5255/diff?src=pr&el=tree#diff-Y3BwL3NyYy9nYW5kaXZhL2NvbXBpbGVkX2V4cHIuaA==) | `100% <\u00f8> (\u00f8)` | |\n   | [cpp/src/gandiva/llvm\\_generator.cc](https://codecov.io/gh/apache/arrow/pull/5255/diff?src=pr&el=tree#diff-Y3BwL3NyYy9nYW5kaXZhL2xsdm1fZ2VuZXJhdG9yLmNj) | `89.09% <100%> (\u00f8)` | |\n   | [cpp/src/gandiva/filter.cc](https://codecov.io/gh/apache/arrow/pull/5255/diff?src=pr&el=tree#diff-Y3BwL3NyYy9nYW5kaXZhL2ZpbHRlci5jYw==) | `100% <100%> (\u00f8)` | |\n   | [cpp/src/gandiva/tests/projector\\_test.cc](https://codecov.io/gh/apache/arrow/pull/5255/diff?src=pr&el=tree#diff-Y3BwL3NyYy9nYW5kaXZhL3Rlc3RzL3Byb2plY3Rvcl90ZXN0LmNj) | `100% <100%> (\u00f8)` | |\n   | [cpp/src/gandiva/bitmap\\_accumulator.h](https://codecov.io/gh/apache/arrow/pull/5255/diff?src=pr&el=tree#diff-Y3BwL3NyYy9nYW5kaXZhL2JpdG1hcF9hY2N1bXVsYXRvci5o) | `100% <100%> (\u00f8)` | |\n   | [cpp/src/gandiva/annotator.cc](https://codecov.io/gh/apache/arrow/pull/5255/diff?src=pr&el=tree#diff-Y3BwL3NyYy9nYW5kaXZhL2Fubm90YXRvci5jYw==) | `100% <100%> (\u00f8)` | |\n   | [cpp/src/gandiva/eval\\_batch.h](https://codecov.io/gh/apache/arrow/pull/5255/diff?src=pr&el=tree#diff-Y3BwL3NyYy9nYW5kaXZhL2V2YWxfYmF0Y2guaA==) | `100% <100%> (\u00f8)` | |\n   | [cpp/src/gandiva/llvm\\_generator\\_test.cc](https://codecov.io/gh/apache/arrow/pull/5255/diff?src=pr&el=tree#diff-Y3BwL3NyYy9nYW5kaXZhL2xsdm1fZ2VuZXJhdG9yX3Rlc3QuY2M=) | `98.14% <100%> (\u00f8)` | |\n   | [cpp/src/gandiva/tests/filter\\_test.cc](https://codecov.io/gh/apache/arrow/pull/5255/diff?src=pr&el=tree#diff-Y3BwL3NyYy9nYW5kaXZhL3Rlc3RzL2ZpbHRlcl90ZXN0LmNj) | `100% <100%> (\u00f8)` | |\n   | ... and [1 more](https://codecov.io/gh/apache/arrow/pull/5255/diff?src=pr&el=tree-more) | |\n   \n   ------\n   \n   [Continue to review full report at Codecov](https://codecov.io/gh/apache/arrow/pull/5255?src=pr&el=continue).\n   > **Legend** - [Click here to learn more](https://docs.codecov.io/docs/codecov-delta)\n   > `\u0394 = absolute <relative> (impact)`, `\u00f8 = not affected`, `? = missing data`\n   > Powered by [Codecov](https://codecov.io/gh/apache/arrow/pull/5255?src=pr&el=footer). Last update [d818299...8c6c132](https://codecov.io/gh/apache/arrow/pull/5255?src=pr&el=lastupdated). Read the [comment docs](https://docs.codecov.io/docs/pull-request-comments).\n   \n \n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2019-09-07T13:05:21.838+0000",
                    "updated": "2019-09-07T13:05:21.838+0000",
                    "started": "2019-09-07T13:05:21.837+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "308346",
                    "issueId": "13236916"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13236916/worklog/308347",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "codecov-io commented on issue #5255: ARROW-5471: [C++][Gandiva] Array offset is ignored in Gandiva projector\nURL: https://github.com/apache/arrow/pull/5255#issuecomment-529106628\n \n \n   # [Codecov](https://codecov.io/gh/apache/arrow/pull/5255?src=pr&el=h1) Report\n   > :exclamation: No coverage uploaded for pull request base (`master@d818299`). [Click here to learn what that means](https://docs.codecov.io/docs/error-reference#section-missing-base-commit).\n   > The diff coverage is `100%`.\n   \n   [![Impacted file tree graph](https://codecov.io/gh/apache/arrow/pull/5255/graphs/tree.svg?width=650&token=LpTCFbqVT1&height=150&src=pr)](https://codecov.io/gh/apache/arrow/pull/5255?src=pr&el=tree)\n   \n   ```diff\n   @@            Coverage Diff            @@\n   ##             master    #5255   +/-   ##\n   =========================================\n     Coverage          ?   89.27%           \n   =========================================\n     Files             ?      753           \n     Lines             ?   108810           \n     Branches          ?        0           \n   =========================================\n     Hits              ?    97140           \n     Misses            ?    11670           \n     Partials          ?        0\n   ```\n   \n   \n   | [Impacted Files](https://codecov.io/gh/apache/arrow/pull/5255?src=pr&el=tree) | Coverage \u0394 | |\n   |---|---|---|\n   | [cpp/src/gandiva/llvm\\_generator.h](https://codecov.io/gh/apache/arrow/pull/5255/diff?src=pr&el=tree#diff-Y3BwL3NyYy9nYW5kaXZhL2xsdm1fZ2VuZXJhdG9yLmg=) | `100% <\u00f8> (\u00f8)` | |\n   | [cpp/src/gandiva/compiled\\_expr.h](https://codecov.io/gh/apache/arrow/pull/5255/diff?src=pr&el=tree#diff-Y3BwL3NyYy9nYW5kaXZhL2NvbXBpbGVkX2V4cHIuaA==) | `100% <\u00f8> (\u00f8)` | |\n   | [cpp/src/gandiva/llvm\\_generator.cc](https://codecov.io/gh/apache/arrow/pull/5255/diff?src=pr&el=tree#diff-Y3BwL3NyYy9nYW5kaXZhL2xsdm1fZ2VuZXJhdG9yLmNj) | `89.09% <100%> (\u00f8)` | |\n   | [cpp/src/gandiva/filter.cc](https://codecov.io/gh/apache/arrow/pull/5255/diff?src=pr&el=tree#diff-Y3BwL3NyYy9nYW5kaXZhL2ZpbHRlci5jYw==) | `100% <100%> (\u00f8)` | |\n   | [cpp/src/gandiva/tests/projector\\_test.cc](https://codecov.io/gh/apache/arrow/pull/5255/diff?src=pr&el=tree#diff-Y3BwL3NyYy9nYW5kaXZhL3Rlc3RzL3Byb2plY3Rvcl90ZXN0LmNj) | `100% <100%> (\u00f8)` | |\n   | [cpp/src/gandiva/bitmap\\_accumulator.h](https://codecov.io/gh/apache/arrow/pull/5255/diff?src=pr&el=tree#diff-Y3BwL3NyYy9nYW5kaXZhL2JpdG1hcF9hY2N1bXVsYXRvci5o) | `100% <100%> (\u00f8)` | |\n   | [cpp/src/gandiva/annotator.cc](https://codecov.io/gh/apache/arrow/pull/5255/diff?src=pr&el=tree#diff-Y3BwL3NyYy9nYW5kaXZhL2Fubm90YXRvci5jYw==) | `100% <100%> (\u00f8)` | |\n   | [cpp/src/gandiva/eval\\_batch.h](https://codecov.io/gh/apache/arrow/pull/5255/diff?src=pr&el=tree#diff-Y3BwL3NyYy9nYW5kaXZhL2V2YWxfYmF0Y2guaA==) | `100% <100%> (\u00f8)` | |\n   | [cpp/src/gandiva/llvm\\_generator\\_test.cc](https://codecov.io/gh/apache/arrow/pull/5255/diff?src=pr&el=tree#diff-Y3BwL3NyYy9nYW5kaXZhL2xsdm1fZ2VuZXJhdG9yX3Rlc3QuY2M=) | `98.14% <100%> (\u00f8)` | |\n   | [cpp/src/gandiva/tests/filter\\_test.cc](https://codecov.io/gh/apache/arrow/pull/5255/diff?src=pr&el=tree#diff-Y3BwL3NyYy9nYW5kaXZhL3Rlc3RzL2ZpbHRlcl90ZXN0LmNj) | `100% <100%> (\u00f8)` | |\n   | ... and [1 more](https://codecov.io/gh/apache/arrow/pull/5255/diff?src=pr&el=tree-more) | |\n   \n   ------\n   \n   [Continue to review full report at Codecov](https://codecov.io/gh/apache/arrow/pull/5255?src=pr&el=continue).\n   > **Legend** - [Click here to learn more](https://docs.codecov.io/docs/codecov-delta)\n   > `\u0394 = absolute <relative> (impact)`, `\u00f8 = not affected`, `? = missing data`\n   > Powered by [Codecov](https://codecov.io/gh/apache/arrow/pull/5255?src=pr&el=footer). Last update [d818299...8c6c132](https://codecov.io/gh/apache/arrow/pull/5255?src=pr&el=lastupdated). Read the [comment docs](https://docs.codecov.io/docs/pull-request-comments).\n   \n \n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2019-09-07T13:05:29.792+0000",
                    "updated": "2019-09-07T13:05:29.792+0000",
                    "started": "2019-09-07T13:05:29.792+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "308347",
                    "issueId": "13236916"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13236916/worklog/308348",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "zeyuanxy commented on pull request #5255: ARROW-5471: [C++][Gandiva] Array offset is ignored in Gandiva projector\nURL: https://github.com/apache/arrow/pull/5255#discussion_r321968460\n \n \n\n ##########\n File path: cpp/src/gandiva/bitmap_accumulator.cc\n ##########\n @@ -51,28 +51,18 @@ void BitMapAccumulator::IntersectBitMaps(uint8_t* dst_map,\n     case 1: {\n       // one src_maps_ bitmap. copy to dst_map\n       memcpy(dst_map, src_maps[0], num_bytes);\n \n Review comment:\n   yeah, you are right\n \n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2019-09-07T13:11:02.660+0000",
                    "updated": "2019-09-07T13:11:02.660+0000",
                    "started": "2019-09-07T13:11:02.659+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "308348",
                    "issueId": "13236916"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13236916/worklog/308650",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "pravindra commented on pull request #5255: ARROW-5471: [C++][Gandiva] Array offset is ignored in Gandiva projector\nURL: https://github.com/apache/arrow/pull/5255#discussion_r322077389\n \n \n\n ##########\n File path: cpp/src/arrow/util/bit_util.cc\n ##########\n @@ -285,6 +285,8 @@ void UnalignedBitmapOp(const uint8_t* left, int64_t left_offset, const uint8_t*\n   for (int64_t i = 0; i < length; ++i) {\n     if (op(left_reader.IsSet(), right_reader.IsSet())) {\n       writer.Set();\n+    } else {\n+      writer.Clear();\n \n Review comment:\n   this seems the right thing to do to. we can now implement a & b & c by doing \r\n    dst = a & b \r\n    dst = dst & c\r\n   \r\n   and it doesn't required the dst buffer to be zero-filled to begin with. however, it may impact perf for the compute kernels - @xhochy \n \n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2019-09-09T06:48:43.965+0000",
                    "updated": "2019-09-09T06:48:43.965+0000",
                    "started": "2019-09-09T06:48:43.965+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "308650",
                    "issueId": "13236916"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13236916/worklog/308651",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "pravindra commented on pull request #5255: ARROW-5471: [C++][Gandiva] Array offset is ignored in Gandiva projector\nURL: https://github.com/apache/arrow/pull/5255#discussion_r322084284\n \n \n\n ##########\n File path: cpp/src/gandiva/bitmap_accumulator.cc\n ##########\n @@ -50,29 +65,20 @@ void BitMapAccumulator::IntersectBitMaps(uint8_t* dst_map,\n \n     case 1: {\n       // one src_maps_ bitmap. copy to dst_map\n-      memcpy(dst_map, src_maps[0], num_bytes);\n-      break;\n-    }\n-\n-    case 2: {\n-      // two src_maps bitmaps. do 64-bit ANDs\n-      uint64_t* src_maps0_64 = reinterpret_cast<uint64_t*>(src_maps[0]);\n-      uint64_t* src_maps1_64 = reinterpret_cast<uint64_t*>(src_maps[1]);\n-      for (int64_t i = 0; i < num_words; ++i) {\n-        dst_map64[i] = src_maps0_64[i] & src_maps1_64[i];\n-      }\n+      arrow::internal::CopyBitmap(src_maps[0], src_map_offsets[0], num_records, dst_map,\n+                                  0);\n       break;\n     }\n \n     default: {\n-      /* > 2 src_maps bitmaps. do 64-bit ANDs */\n-      uint64_t* src_maps0_64 = reinterpret_cast<uint64_t*>(src_maps[0]);\n-      memcpy(dst_map64, src_maps0_64, num_bytes);\n-      for (int64_t m = 1; m < nmaps; ++m) {\n-        for (int64_t i = 0; i < num_words; ++i) {\n-          uint64_t* src_mapsm_64 = reinterpret_cast<uint64_t*>(src_maps[m]);\n-          dst_map64[i] &= src_mapsm_64[i];\n-        }\n+      // initialize all output bits to 0 (as required by BitmapAnd)\n+      arrow::BitUtil::SetBitsTo(dst_map, 0, num_records, false);\n \n Review comment:\n   if the zerofilling is no longer required (after your change to bit_util.cc), can we drop this line ?\n \n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2019-09-09T06:48:44.095+0000",
                    "updated": "2019-09-09T06:48:44.095+0000",
                    "started": "2019-09-09T06:48:44.095+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "308651",
                    "issueId": "13236916"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13236916/worklog/308652",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "pravindra commented on pull request #5255: ARROW-5471: [C++][Gandiva] Array offset is ignored in Gandiva projector\nURL: https://github.com/apache/arrow/pull/5255#discussion_r322080997\n \n \n\n ##########\n File path: cpp/src/gandiva/bitmap_accumulator.cc\n ##########\n @@ -28,15 +28,30 @@ void BitMapAccumulator::ComputeResult(uint8_t* dst_bitmap) {\n     // set all bits to 0.\n     memset(dst_bitmap, 0, arrow::BitUtil::BytesForBits(num_records));\n   } else {\n-    IntersectBitMaps(dst_bitmap, src_maps_, num_records);\n+    IntersectBitMaps(dst_bitmap, src_maps_, src_map_offsets_, num_records);\n+  }\n+}\n+\n+void BitmapAnd(uint8_t* left, int64_t left_offset, uint8_t* right, int64_t right_offset,\n+               int64_t length, uint8_t* out) {\n+  if (left_offset == 0 && right_offset == 0) {\n \n Review comment:\n   arrow::internal::BitmapAnd already has a special case for this (AlignedBitmapOp). can we depend on that instead ?\n \n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2019-09-09T06:48:44.105+0000",
                    "updated": "2019-09-09T06:48:44.105+0000",
                    "started": "2019-09-09T06:48:44.104+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "308652",
                    "issueId": "13236916"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13236916/worklog/308854",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "zeyuanxy commented on pull request #5255: ARROW-5471: [C++][Gandiva] Array offset is ignored in Gandiva projector\nURL: https://github.com/apache/arrow/pull/5255#discussion_r322245844\n \n \n\n ##########\n File path: cpp/src/gandiva/bitmap_accumulator.cc\n ##########\n @@ -28,15 +28,30 @@ void BitMapAccumulator::ComputeResult(uint8_t* dst_bitmap) {\n     // set all bits to 0.\n     memset(dst_bitmap, 0, arrow::BitUtil::BytesForBits(num_records));\n   } else {\n-    IntersectBitMaps(dst_bitmap, src_maps_, num_records);\n+    IntersectBitMaps(dst_bitmap, src_maps_, src_map_offsets_, num_records);\n+  }\n+}\n+\n+void BitmapAnd(uint8_t* left, int64_t left_offset, uint8_t* right, int64_t right_offset,\n+               int64_t length, uint8_t* out) {\n+  if (left_offset == 0 && right_offset == 0) {\n \n Review comment:\n   Yeah, that would be easier. The only reason I didn't use that is that the `AlignedBitmapOp` uses one byte as a time, while the previous implementation in `BitmapAccumulator` uses 8-byte at a time. If we switch to use one byte, I am not sure if the performance would degrade on certain platforms. Or maybe it doesn't matter that much?\n \n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2019-09-09T13:36:51.792+0000",
                    "updated": "2019-09-09T13:36:51.792+0000",
                    "started": "2019-09-09T13:36:51.792+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "308854",
                    "issueId": "13236916"
                }
            ]
        },
        "customfield_12313920": null,
        "issuetype": {
            "self": "https://issues.apache.org/jira/rest/api/2/issuetype/1",
            "id": "1",
            "description": "A problem which impairs or prevents the functions of the product.",
            "iconUrl": "https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype",
            "name": "Bug",
            "subtask": false,
            "avatarId": 21133
        },
        "timespent": 14400,
        "customfield_12314020": "{summaryBean=com.atlassian.jira.plugin.devstatus.rest.SummaryBean@45f46246[summary={pullrequest=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@22d6dcf9[overall=PullRequestOverallBean{stateCount=0, state='OPEN', details=PullRequestOverallDetails{openCount=0, mergedCount=0, declinedCount=0}},byInstanceType={}], build=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@2f7735db[overall=com.atlassian.jira.plugin.devstatus.summary.beans.BuildOverallBean@3b5215d8[failedBuildCount=0,successfulBuildCount=0,unknownBuildCount=0,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], review=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@6faf70a6[overall=com.atlassian.jira.plugin.devstatus.summary.beans.ReviewsOverallBean@1aeacda2[stateCount=0,state=<null>,dueDate=<null>,overDue=false,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], deployment-environment=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@ca5eac9[overall=com.atlassian.jira.plugin.devstatus.summary.beans.DeploymentOverallBean@27f2c250[topEnvironments=[],showProjects=false,successfulCount=0,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], repository=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@33ccbc48[overall=com.atlassian.jira.plugin.devstatus.summary.beans.CommitOverallBean@7f87f04e[count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], branch=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@5c57aed5[overall=com.atlassian.jira.plugin.devstatus.summary.beans.BranchOverallBean@6d86074d[count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}]},errors=[],configErrors=[]], devSummaryJson={\"cachedValue\":{\"errors\":[],\"configErrors\":[],\"summary\":{\"pullrequest\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"stateCount\":0,\"state\":\"OPEN\",\"details\":{\"openCount\":0,\"mergedCount\":0,\"declinedCount\":0,\"total\":0},\"open\":true},\"byInstanceType\":{}},\"build\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"failedBuildCount\":0,\"successfulBuildCount\":0,\"unknownBuildCount\":0},\"byInstanceType\":{}},\"review\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"stateCount\":0,\"state\":null,\"dueDate\":null,\"overDue\":false,\"completed\":false},\"byInstanceType\":{}},\"deployment-environment\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"topEnvironments\":[],\"showProjects\":false,\"successfulCount\":0},\"byInstanceType\":{}},\"repository\":{\"overall\":{\"count\":0,\"lastUpdated\":null},\"byInstanceType\":{}},\"branch\":{\"overall\":{\"count\":0,\"lastUpdated\":null},\"byInstanceType\":{}}}},\"isStale\":false}}",
        "customfield_12314141": null,
        "customfield_12314140": null,
        "project": {
            "self": "https://issues.apache.org/jira/rest/api/2/project/12319525",
            "id": "12319525",
            "key": "ARROW",
            "name": "Apache Arrow",
            "projectTypeKey": "software",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/projectavatar?pid=12319525&avatarId=10011",
                "24x24": "https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12319525&avatarId=10011",
                "16x16": "https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12319525&avatarId=10011",
                "32x32": "https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12319525&avatarId=10011"
            },
            "projectCategory": {
                "self": "https://issues.apache.org/jira/rest/api/2/projectCategory/13960",
                "id": "13960",
                "description": "Apache Arrow",
                "name": "Arrow"
            }
        },
        "aggregatetimespent": 14400,
        "customfield_12312520": null,
        "customfield_12312521": "Tue Sep 10 01:40:24 UTC 2019",
        "customfield_12314422": null,
        "customfield_12314421": null,
        "customfield_12314146": null,
        "customfield_12314420": null,
        "customfield_12314145": null,
        "customfield_12314144": null,
        "customfield_12314143": null,
        "resolutiondate": "2019-09-10T01:40:24.000+0000",
        "workratio": -1,
        "customfield_12312923": null,
        "customfield_12312920": null,
        "customfield_12312921": null,
        "watches": {
            "self": "https://issues.apache.org/jira/rest/api/2/issue/ARROW-5471/watchers",
            "watchCount": 1,
            "isWatching": false
        },
        "created": "2019-05-31T17:07:08.000+0000",
        "updated": "2019-09-10T01:40:24.000+0000",
        "timeoriginalestimate": null,
        "description": "I used the test case in\u00a0[https://github.com/apache/arrow/blob/master/python/pyarrow/tests/test_gandiva.py#L25], and found an issue when I was using the slice operator\u00a0{{input_batch[1:]}}. It seems that the offset is ignored in the Gandiva projector.\r\n{code:java}\r\nimport pyarrow as pa\r\nimport pyarrow.gandiva as gandiva\r\n\r\nbuilder = gandiva.TreeExprBuilder()\r\n\r\nfield_a = pa.field('a', pa.int32())\r\nfield_b = pa.field('b', pa.int32())\r\n\r\nschema = pa.schema([field_a, field_b])\r\n\r\nfield_result = pa.field('res', pa.int32())\r\n\r\nnode_a = builder.make_field(field_a)\r\nnode_b = builder.make_field(field_b)\r\n\r\ncondition = builder.make_function(\"greater_than\", [node_a, node_b],\r\npa.bool_())\r\nif_node = builder.make_if(condition, node_a, node_b, pa.int32())\r\n\r\nexpr = builder.make_expression(if_node, field_result)\r\n\r\nprojector = gandiva.make_projector(\r\nschema, [expr], pa.default_memory_pool())\r\n\r\na = pa.array([10, 12, -20, 5], type=pa.int32())\r\nb = pa.array([5, 15, 15, 17], type=pa.int32())\r\ne = pa.array([10, 15, 15, 17], type=pa.int32())\r\ninput_batch = pa.RecordBatch.from_arrays([a, b], names=['a', 'b'])\r\n\r\nr, = projector.evaluate(input_batch[1:])\r\nprint(r)\r\n{code}\r\nIf we use the full record batch\u00a0{{input_batch}}, the expected output is\u00a0{{[10, 15, 15, 17]}}. So if we use\u00a0{{input_batch[1:]}}, the expected output should be\u00a0{{[15, 15, 17]}}, however this script returned\u00a0{{[10, 15, 15]}}. It seems that the projector ignores the offset and always reads from 0.\r\n\r\n\u00a0\r\n\r\nA corresponding issue is created in GitHub as well\u00a0[https://github.com/apache/arrow/issues/4420]",
        "customfield_10010": null,
        "timetracking": {
            "remainingEstimate": "0h",
            "timeSpent": "4h",
            "remainingEstimateSeconds": 0,
            "timeSpentSeconds": 14400
        },
        "customfield_12314523": null,
        "customfield_12314127": null,
        "customfield_12314522": null,
        "customfield_12314126": null,
        "customfield_12314521": null,
        "customfield_12314125": null,
        "customfield_12314520": null,
        "customfield_12314124": null,
        "attachment": [],
        "customfield_12312340": null,
        "customfield_12314123": null,
        "customfield_12312341": null,
        "customfield_12312220": null,
        "customfield_12314122": null,
        "customfield_12314121": null,
        "customfield_12314120": null,
        "customfield_12314129": null,
        "customfield_12314524": null,
        "customfield_12314128": null,
        "summary": "[C++][Gandiva]Array offset is ignored in Gandiva projector",
        "customfield_12314130": null,
        "customfield_12310291": null,
        "customfield_12310290": null,
        "customfield_12314138": null,
        "customfield_12314137": null,
        "environment": null,
        "customfield_12314136": null,
        "customfield_12314135": null,
        "customfield_12311020": null,
        "customfield_12314134": null,
        "duedate": null,
        "customfield_12314132": null,
        "customfield_12314131": null,
        "comment": {
            "comments": [
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13236916/comment/16926239",
                    "id": "16926239",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=wesm",
                        "name": "wesm",
                        "key": "wesmckinn",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=wesmckinn&avatarId=29931",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=wesmckinn&avatarId=29931",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=wesmckinn&avatarId=29931",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=wesmckinn&avatarId=29931"
                        },
                        "displayName": "Wes McKinney",
                        "active": true,
                        "timeZone": "America/New_York"
                    },
                    "body": "Issue resolved by pull request 5255\n[https://github.com/apache/arrow/pull/5255]",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=wesm",
                        "name": "wesm",
                        "key": "wesmckinn",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=wesmckinn&avatarId=29931",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=wesmckinn&avatarId=29931",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=wesmckinn&avatarId=29931",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=wesmckinn&avatarId=29931"
                        },
                        "displayName": "Wes McKinney",
                        "active": true,
                        "timeZone": "America/New_York"
                    },
                    "created": "2019-09-10T01:40:24.449+0000",
                    "updated": "2019-09-10T01:40:24.449+0000"
                }
            ],
            "maxResults": 1,
            "total": 1,
            "startAt": 0
        },
        "customfield_12311820": "0|z03ayg:",
        "customfield_12314139": null
    }
}