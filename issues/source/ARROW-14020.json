{
    "expand": "operations,versionedRepresentations,editmeta,changelog,renderedFields",
    "id": "13401753",
    "self": "https://issues.apache.org/jira/rest/api/2/issue/13401753",
    "key": "ARROW-14020",
    "fields": {
        "fixVersions": [
            {
                "self": "https://issues.apache.org/jira/rest/api/2/version/12350323",
                "id": "12350323",
                "description": "",
                "name": "6.0.0",
                "archived": false,
                "released": true,
                "releaseDate": "2021-10-26"
            }
        ],
        "resolution": {
            "self": "https://issues.apache.org/jira/rest/api/2/resolution/1",
            "id": "1",
            "description": "A fix for this issue is checked into the tree and tested.",
            "name": "Fixed"
        },
        "customfield_12312322": null,
        "customfield_12312323": null,
        "customfield_12312320": null,
        "customfield_12310420": "9223372036854775807",
        "customfield_12312321": null,
        "customfield_12312328": null,
        "customfield_12312329": null,
        "customfield_12312326": null,
        "customfield_12310300": null,
        "customfield_12312327": null,
        "customfield_12312324": null,
        "customfield_12312720": null,
        "customfield_12312325": null,
        "lastViewed": null,
        "priority": {
            "self": "https://issues.apache.org/jira/rest/api/2/priority/3",
            "iconUrl": "https://issues.apache.org/jira/images/icons/priorities/major.svg",
            "name": "Major",
            "id": "3"
        },
        "labels": [
            "pull-request-available"
        ],
        "customfield_12312333": null,
        "customfield_12312334": null,
        "customfield_12313422": "false",
        "customfield_12310310": "0.0",
        "customfield_12312331": null,
        "customfield_12312332": null,
        "aggregatetimeoriginalestimate": null,
        "timeestimate": 0,
        "customfield_12312330": null,
        "versions": [
            {
                "self": "https://issues.apache.org/jira/rest/api/2/version/12349983",
                "id": "12349983",
                "description": "",
                "name": "5.0.0",
                "archived": false,
                "released": true,
                "releaseDate": "2021-07-28"
            }
        ],
        "customfield_12311120": null,
        "customfield_12313826": null,
        "customfield_12312339": null,
        "issuelinks": [],
        "customfield_12313825": null,
        "assignee": {
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=jonkeane",
            "name": "jonkeane",
            "key": "jonkeane",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=34057",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34057",
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34057",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34057"
            },
            "displayName": "Jonathan Keane",
            "active": true,
            "timeZone": "Etc/UTC"
        },
        "customfield_12312337": null,
        "customfield_12313823": null,
        "customfield_12312338": null,
        "customfield_12311920": null,
        "customfield_12313822": null,
        "customfield_12312335": null,
        "customfield_12313821": null,
        "customfield_12312336": null,
        "customfield_12313820": null,
        "status": {
            "self": "https://issues.apache.org/jira/rest/api/2/status/5",
            "description": "A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.",
            "iconUrl": "https://issues.apache.org/jira/images/icons/statuses/resolved.png",
            "name": "Resolved",
            "id": "5",
            "statusCategory": {
                "self": "https://issues.apache.org/jira/rest/api/2/statuscategory/3",
                "id": 3,
                "key": "done",
                "colorName": "green",
                "name": "Done"
            }
        },
        "components": [
            {
                "self": "https://issues.apache.org/jira/rest/api/2/component/12333008",
                "id": "12333008",
                "name": "R"
            }
        ],
        "customfield_12312026": null,
        "customfield_12312023": null,
        "customfield_12312024": null,
        "aggregatetimeestimate": 0,
        "customfield_12312022": null,
        "customfield_12310921": null,
        "customfield_12310920": "9223372036854775807",
        "customfield_12312823": null,
        "creator": {
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=milesmcbain",
            "name": "milesmcbain",
            "key": "milesmcbain",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
            },
            "displayName": "Miles McBain",
            "active": true,
            "timeZone": "Etc/UTC"
        },
        "subtasks": [],
        "reporter": {
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=milesmcbain",
            "name": "milesmcbain",
            "key": "milesmcbain",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
            },
            "displayName": "Miles McBain",
            "active": true,
            "timeZone": "Etc/UTC"
        },
        "aggregateprogress": {
            "progress": 14400,
            "total": 14400,
            "percent": 100
        },
        "customfield_12313520": null,
        "customfield_12310250": null,
        "progress": {
            "progress": 14400,
            "total": 14400,
            "percent": 100
        },
        "customfield_12313924": null,
        "votes": {
            "self": "https://issues.apache.org/jira/rest/api/2/issue/ARROW-14020/votes",
            "votes": 0,
            "hasVoted": false
        },
        "customfield_12313920": null,
        "issuetype": {
            "self": "https://issues.apache.org/jira/rest/api/2/issuetype/1",
            "id": "1",
            "description": "A problem which impairs or prevents the functions of the product.",
            "iconUrl": "https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype",
            "name": "Bug",
            "subtask": false,
            "avatarId": 21133
        },
        "timespent": 14400,
        "customfield_12314020": "{summaryBean=com.atlassian.jira.plugin.devstatus.rest.SummaryBean@74da56c8[summary={pullrequest=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@3fd209c3[overall=PullRequestOverallBean{stateCount=0, state='OPEN', details=PullRequestOverallDetails{openCount=0, mergedCount=0, declinedCount=0}},byInstanceType={}], build=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@5fe0497d[overall=com.atlassian.jira.plugin.devstatus.summary.beans.BuildOverallBean@7053df53[failedBuildCount=0,successfulBuildCount=0,unknownBuildCount=0,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], review=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@6c37d2c7[overall=com.atlassian.jira.plugin.devstatus.summary.beans.ReviewsOverallBean@44d11dcb[stateCount=0,state=<null>,dueDate=<null>,overDue=false,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], deployment-environment=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@19a71f8d[overall=com.atlassian.jira.plugin.devstatus.summary.beans.DeploymentOverallBean@7760e2ad[topEnvironments=[],showProjects=false,successfulCount=0,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], repository=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@2513b76c[overall=com.atlassian.jira.plugin.devstatus.summary.beans.CommitOverallBean@69e0c940[count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], branch=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@481af886[overall=com.atlassian.jira.plugin.devstatus.summary.beans.BranchOverallBean@389f0ea2[count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}]},errors=[],configErrors=[]], devSummaryJson={\"cachedValue\":{\"errors\":[],\"configErrors\":[],\"summary\":{\"pullrequest\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"stateCount\":0,\"state\":\"OPEN\",\"details\":{\"openCount\":0,\"mergedCount\":0,\"declinedCount\":0,\"total\":0},\"open\":true},\"byInstanceType\":{}},\"build\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"failedBuildCount\":0,\"successfulBuildCount\":0,\"unknownBuildCount\":0},\"byInstanceType\":{}},\"review\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"stateCount\":0,\"state\":null,\"dueDate\":null,\"overDue\":false,\"completed\":false},\"byInstanceType\":{}},\"deployment-environment\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"topEnvironments\":[],\"showProjects\":false,\"successfulCount\":0},\"byInstanceType\":{}},\"repository\":{\"overall\":{\"count\":0,\"lastUpdated\":null},\"byInstanceType\":{}},\"branch\":{\"overall\":{\"count\":0,\"lastUpdated\":null},\"byInstanceType\":{}}}},\"isStale\":false}}",
        "customfield_12314141": null,
        "customfield_12314140": null,
        "project": {
            "self": "https://issues.apache.org/jira/rest/api/2/project/12319525",
            "id": "12319525",
            "key": "ARROW",
            "name": "Apache Arrow",
            "projectTypeKey": "software",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/projectavatar?pid=12319525&avatarId=10011",
                "24x24": "https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12319525&avatarId=10011",
                "16x16": "https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12319525&avatarId=10011",
                "32x32": "https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12319525&avatarId=10011"
            },
            "projectCategory": {
                "self": "https://issues.apache.org/jira/rest/api/2/projectCategory/13960",
                "id": "13960",
                "description": "Apache Arrow",
                "name": "Arrow"
            }
        },
        "aggregatetimespent": 14400,
        "customfield_12312520": null,
        "customfield_12312521": "Mon Oct 04 21:36:39 UTC 2021",
        "customfield_12314422": null,
        "customfield_12314421": [
            "R"
        ],
        "customfield_12314146": null,
        "customfield_12314420": null,
        "customfield_12314145": null,
        "customfield_12314144": null,
        "customfield_12314143": null,
        "resolutiondate": "2021-10-04T21:36:39.000+0000",
        "workratio": -1,
        "customfield_12312923": null,
        "customfield_12312920": null,
        "customfield_12312921": null,
        "watches": {
            "self": "https://issues.apache.org/jira/rest/api/2/issue/ARROW-14020/watchers",
            "watchCount": 3,
            "isWatching": false
        },
        "created": "2021-09-17T01:18:59.000+0000",
        "updated": "2021-10-04T21:36:47.000+0000",
        "timeoriginalestimate": null,
        "description": "Writing data frames that contain list columns seems much slower than expected:\r\n\r\n``` r\r\n library(tidyverse)\r\n #> Warning: package 'tidyverse' was built under R version 4.1.1\r\n #> Warning: package 'tibble' was built under R version 4.1.1\r\n #> Warning: package 'readr' was built under R version 4.1.1\r\n library(arrow)\r\n #> Warning: package 'arrow' was built under R version 4.1.1\r\n #>\r\n #> Attaching package: 'arrow'\r\n #> The following object is masked from 'package:utils':\r\n #>\r\n #> timestamp\r\n dummy <- tibble(\r\n points = rep(list(seq(6)), 2e6),\r\n index = seq(2e6)\r\n )\r\n # very slooooooow\r\n system.time(write_parquet(dummy, \"dummy.parquet\"))\r\n #> user system elapsed\r\n #> 55.64 0.11 55.98\r\n\r\ndummy_txt <- mutate(dummy, points = map_chr(points, deparse))\r\n # orders of magnitude faster\r\n system.time(write_parquet(dummy_txt, \"dummytext.parquet\"))\r\n #> user system elapsed\r\n #> 0.24 0.02 0.25\r\n ```\r\n\r\n<sup>Created on 2021-09-17 by the [reprex package]([https://reprex.tidyverse.org|https://reprex.tidyverse.org/]) (v2.0.0)</sup>\r\n\r\n<details style=\"margin-bottom:10px;\">\r\n\r\n<summary>Session info</summary>\r\n\r\n``` r\r\n sessioninfo::session_info()\r\n #> - Session info ---------------------------------------------------------------\r\n #> setting value\r\n #> version R version 4.1.0 (2021-05-18)\r\n #> os Windows 10 x64\r\n #> system x86_64, mingw32\r\n #> ui RTerm\r\n #> language (EN)\r\n #> collate English_Australia.1252\r\n #> ctype English_Australia.1252\r\n #> tz Australia/Brisbane\r\n #> date 2021-09-17\r\n #>\r\n #> - Packages -------------------------------------------------------------------\r\n #> package * version date lib source\r\n #> arrow * 5.0.0.2 2021-09-05 [1] CRAN (R 4.1.1)\r\n #> assertthat 0.2.1 2019-03-21 [1] CRAN (R 4.1.0)\r\n #> backports 1.2.1 2020-12-09 [1] CRAN (R 4.1.0)\r\n #> bit 4.0.4 2020-08-04 [1] CRAN (R 4.1.0)\r\n #> bit64 4.0.5 2020-08-30 [1] CRAN (R 4.1.0)\r\n #> broom 0.7.7 2021-06-13 [1] CRAN (R 4.1.0)\r\n #> cellranger 1.1.0 2016-07-27 [1] CRAN (R 4.1.0)\r\n #> cli 3.0.1 2021-07-17 [1] CRAN (R 4.1.0)\r\n #> colorspace 2.0-2 2021-06-24 [1] CRAN (R 4.1.0)\r\n #> crayon 1.4.1 2021-02-08 [1] CRAN (R 4.1.0)\r\n #> DBI 1.1.1 2021-01-15 [1] CRAN (R 4.1.0)\r\n #> dbplyr 2.1.1 2021-04-06 [1] CRAN (R 4.1.0)\r\n #> digest 0.6.27 2020-10-24 [1] CRAN (R 4.1.0)\r\n #> dplyr * 1.0.7 2021-06-18 [1] CRAN (R 4.1.0)\r\n #> ellipsis 0.3.2 2021-04-29 [1] CRAN (R 4.1.0)\r\n #> evaluate 0.14 2019-05-28 [1] CRAN (R 4.1.0)\r\n #> fansi 0.5.0 2021-05-25 [1] CRAN (R 4.1.0)\r\n #> forcats * 0.5.1 2021-01-27 [1] CRAN (R 4.1.0)\r\n #> fs 1.5.0 2020-07-31 [1] CRAN (R 4.1.0)\r\n #> generics 0.1.0 2020-10-31 [1] CRAN (R 4.1.0)\r\n #> ggplot2 * 3.3.5 2021-06-25 [1] CRAN (R 4.1.0)\r\n #> glue 1.4.2 2020-08-27 [1] CRAN (R 4.1.0)\r\n #> gtable 0.3.0 2019-03-25 [1] CRAN (R 4.1.0)\r\n #> haven 2.4.1 2021-04-23 [1] CRAN (R 4.1.0)\r\n #> highr 0.9 2021-04-16 [1] CRAN (R 4.1.0)\r\n #> hms 1.1.0 2021-05-17 [1] CRAN (R 4.1.0)\r\n #> htmltools 0.5.1.1 2021-01-22 [1] CRAN (R 4.1.0)\r\n #> httr 1.4.2 2020-07-20 [1] CRAN (R 4.1.0)\r\n #> jsonlite 1.7.2 2020-12-09 [1] CRAN (R 4.1.0)\r\n #> knitr 1.33 2021-04-24 [1] CRAN (R 4.1.0)\r\n #> lifecycle 1.0.0 2021-02-15 [1] CRAN (R 4.1.0)\r\n #> lubridate 1.7.10 2021-02-26 [1] CRAN (R 4.1.0)\r\n #> magrittr 2.0.1 2020-11-17 [1] CRAN (R 4.1.0)\r\n #> modelr 0.1.8 2020-05-19 [1] CRAN (R 4.1.0)\r\n #> munsell 0.5.0 2018-06-12 [1] CRAN (R 4.1.0)\r\n #> pillar 1.6.2 2021-07-29 [1] CRAN (R 4.1.0)\r\n #> pkgconfig 2.0.3 2019-09-22 [1] CRAN (R 4.1.0)\r\n #> purrr * 0.3.4 2020-04-17 [1] CRAN (R 4.1.0)\r\n #> R6 2.5.1 2021-08-19 [1] CRAN (R 4.1.1)\r\n #> Rcpp 1.0.7 2021-07-07 [1] CRAN (R 4.1.0)\r\n #> readr * 2.0.1 2021-08-10 [1] CRAN (R 4.1.1)\r\n #> readxl 1.3.1 2019-03-13 [1] CRAN (R 4.1.0)\r\n #> reprex 2.0.0 2021-04-02 [1] CRAN (R 4.1.0)\r\n #> rlang 0.4.11 2021-04-30 [1] CRAN (R 4.1.0)\r\n #> rmarkdown 2.9 2021-06-15 [1] CRAN (R 4.1.0)\r\n #> rvest 1.0.1 2021-07-26 [1] CRAN (R 4.1.0)\r\n #> scales 1.1.1 2020-05-11 [1] CRAN (R 4.1.0)\r\n #> sessioninfo 1.1.1 2018-11-05 [1] CRAN (R 4.1.0)\r\n #> stringi 1.7.4 2021-08-25 [1] CRAN (R 4.1.1)\r\n #> stringr * 1.4.0 2019-02-10 [1] CRAN (R 4.1.0)\r\n #> styler 1.4.1 2021-03-30 [1] CRAN (R 4.1.0)\r\n #> tibble * 3.1.4 2021-08-25 [1] CRAN (R 4.1.1)\r\n #> tidyr * 1.1.3 2021-03-03 [1] CRAN (R 4.1.0)\r\n #> tidyselect 1.1.1 2021-04-30 [1] CRAN (R 4.1.0)\r\n #> tidyverse * 1.3.1 2021-04-15 [1] CRAN (R 4.1.1)\r\n #> tzdb 0.1.2 2021-07-20 [1] CRAN (R 4.1.0)\r\n #> utf8 1.2.2 2021-07-24 [1] CRAN (R 4.1.0)\r\n #> vctrs 0.3.8 2021-04-29 [1] CRAN (R 4.1.0)\r\n #> withr 2.4.2 2021-04-18 [1] CRAN (R 4.1.0)\r\n #> xfun 0.24 2021-06-15 [1] CRAN (R 4.1.0)\r\n #> xml2 1.3.2 2020-04-23 [1] CRAN (R 4.1.0)\r\n #> yaml 2.2.1 2020-02-01 [1] CRAN (R 4.1.0)\r\n #>\r\n #> [1] C:/Users/msmcbain/libs/R\r\n #> [2] C:/R/R-4.1.0/library\r\n ```\r\n\r\n</details>\r\n\r\nIn this case it's actually faster to convert the list columns to text and do the write, than to write with the list columns.\u00a0\r\n\r\nThis issue also affects write_arrow:\r\n\r\n``` r\r\n library(tidyverse)\r\n #> Warning: package 'tidyverse' was built under R version 4.1.1\r\n #> Warning: package 'tibble' was built under R version 4.1.1\r\n #> Warning: package 'readr' was built under R version 4.1.1\r\n library(arrow)\r\n #> Warning: package 'arrow' was built under R version 4.1.1\r\n #>\r\n #> Attaching package: 'arrow'\r\n #> The following object is masked from 'package:utils':\r\n #>\r\n #> timestamp\r\n dummy <- tibble(\r\n points = rep(list(seq(6)), 2e6),\r\n index = seq(2e6)\r\n )\r\n # very slooooooow\r\n system.time(write_arrow(dummy, \"dummy.parquet\"))\r\n #> Warning: Use 'write_ipc_stream' or 'write_feather' instead.\r\n #> user system elapsed\r\n #> 56.95 0.08 57.13\r\n\r\ndummy_txt <- mutate(dummy, points = map_chr(points, deparse))\r\n # orders of magnitude faster\r\n system.time(write_arrow(dummy_txt, \"dummytext.parquet\"))\r\n #> Warning: Use 'write_ipc_stream' or 'write_feather' instead.\r\n #> user system elapsed\r\n #> 0.06 0.01 0.10\r\n ```\r\n\r\n<sup>Created on 2021-09-17 by the [reprex package]([https://reprex.tidyverse.org|https://reprex.tidyverse.org/]) (v2.0.0)</sup>\r\n\r\nInterestingly the performance seems to degrade exponentially with the nesting level of the lists:\r\n\r\n```r\r\n\r\n#\u00a0add\u00a0a\u00a0level\u00a0of\u00a0nesting\r\n dummy2\u00a0<-\u00a0tibble(\r\n \u00a0\u00a0points\u00a0=\u00a0rep(list(list(seq(6))),\u00a02e6),\r\n \u00a0\u00a0index\u00a0=\u00a0seq(2e6)\r\n )\r\n\r\n#\u00a0order\u00a0of\u00a0magnitude\u00a0slower\u00a0again,\u00a0lost\u00a0patience\u00a0wating\u00a0for\u00a0it to\u00a0return\r\n system.time(write_parquet(dummy2,\u00a0\"dummy2.parquet\")\r\n ```\r\n\r\nThis has implications for \\{sf} dataframes which use list columns to represent spatial data structures. Arrow/parquet are pretty much not viable for moderate to large spatial data in R:\r\n\r\n```r\r\n # options(timeout = 1000)\r\n\r\nremotes::install_github(\"wfmackey/absmapsdata\")\r\n library(absmapsdata)\r\n # doesn't return in a resonable amount of time\r\n write_arrow(absmapsdata::sa12016, \"sa1.parquet\")\r\n\r\n # can use the same work around as above by converting geomtry to vector of well knowntext, but it takes time and bloats the files\r\n\r\n\u00a0```\r\n\r\nPossibly related to\u00a0https://issues.apache.org/jira/browse/ARROW-12529 ?\r\n\r\n\u00a0",
        "customfield_10010": null,
        "customfield_12314523": null,
        "customfield_12314127": null,
        "customfield_12314522": null,
        "customfield_12314126": null,
        "customfield_12314521": null,
        "customfield_12314125": null,
        "customfield_12314520": null,
        "customfield_12314124": null,
        "customfield_12312340": null,
        "customfield_12314123": null,
        "customfield_12312341": null,
        "customfield_12312220": null,
        "customfield_12314122": null,
        "customfield_12314121": null,
        "customfield_12314120": null,
        "customfield_12314129": null,
        "customfield_12314524": null,
        "customfield_12314128": null,
        "summary": "[R] Writing datafames with list columns is slow and scales poorly with nesting level",
        "customfield_12314130": null,
        "customfield_12310291": null,
        "customfield_12310290": null,
        "customfield_12314138": null,
        "customfield_12314137": null,
        "environment": "Windows 10 x64",
        "customfield_12314136": null,
        "customfield_12314135": null,
        "customfield_12311020": null,
        "customfield_12314134": null,
        "duedate": null,
        "customfield_12314132": null,
        "customfield_12314131": null,
        "customfield_12311820": "0|z0v0t4:",
        "customfield_12314139": null
    }
}