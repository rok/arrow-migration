{
    "expand": "operations,versionedRepresentations,editmeta,changelog,renderedFields",
    "id": "13421780",
    "self": "https://issues.apache.org/jira/rest/api/2/issue/13421780",
    "key": "ARROW-15291",
    "fields": {
        "fixVersions": [
            {
                "self": "https://issues.apache.org/jira/rest/api/2/version/12351051",
                "id": "12351051",
                "description": "",
                "name": "8.0.0",
                "archived": false,
                "released": true,
                "releaseDate": "2022-05-06"
            }
        ],
        "resolution": {
            "self": "https://issues.apache.org/jira/rest/api/2/resolution/1",
            "id": "1",
            "description": "A fix for this issue is checked into the tree and tested.",
            "name": "Fixed"
        },
        "customfield_12312322": null,
        "customfield_12312323": null,
        "customfield_12312320": null,
        "customfield_12310420": "9223372036854775807",
        "customfield_12312321": null,
        "customfield_12312328": null,
        "customfield_12312329": null,
        "customfield_12312326": null,
        "customfield_12310300": null,
        "customfield_12312327": null,
        "customfield_12312324": null,
        "customfield_12312720": null,
        "customfield_12312325": null,
        "lastViewed": null,
        "priority": {
            "self": "https://issues.apache.org/jira/rest/api/2/priority/3",
            "iconUrl": "https://issues.apache.org/jira/images/icons/priorities/major.svg",
            "name": "Major",
            "id": "3"
        },
        "labels": [
            "pull-request-available"
        ],
        "customfield_12312333": null,
        "customfield_12312334": null,
        "customfield_12313422": "false",
        "customfield_12310310": "0.0",
        "customfield_12312331": null,
        "customfield_12312332": null,
        "aggregatetimeoriginalestimate": null,
        "timeestimate": 0,
        "customfield_12312330": null,
        "versions": [
            {
                "self": "https://issues.apache.org/jira/rest/api/2/version/12350712",
                "id": "12350712",
                "description": "",
                "name": "6.0.1",
                "archived": false,
                "released": true,
                "releaseDate": "2021-11-18"
            }
        ],
        "customfield_12311120": null,
        "customfield_12313826": null,
        "customfield_12312339": null,
        "issuelinks": [],
        "customfield_12313825": null,
        "assignee": {
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=alenka",
            "name": "alenka",
            "key": "alenkaf",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=34058",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34058",
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34058",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34058"
            },
            "displayName": "Alenka Frim",
            "active": true,
            "timeZone": "Europe/Ljubljana"
        },
        "customfield_12312337": null,
        "customfield_12313823": null,
        "customfield_12312338": null,
        "customfield_12311920": null,
        "customfield_12313822": null,
        "customfield_12312335": null,
        "customfield_12313821": null,
        "customfield_12312336": null,
        "customfield_12313820": null,
        "status": {
            "self": "https://issues.apache.org/jira/rest/api/2/status/5",
            "description": "A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.",
            "iconUrl": "https://issues.apache.org/jira/images/icons/statuses/resolved.png",
            "name": "Resolved",
            "id": "5",
            "statusCategory": {
                "self": "https://issues.apache.org/jira/rest/api/2/statuscategory/3",
                "id": 3,
                "key": "done",
                "colorName": "green",
                "name": "Done"
            }
        },
        "components": [
            {
                "self": "https://issues.apache.org/jira/rest/api/2/component/12328935",
                "id": "12328935",
                "name": "C++"
            },
            {
                "self": "https://issues.apache.org/jira/rest/api/2/component/12328936",
                "id": "12328936",
                "name": "Python"
            }
        ],
        "customfield_12312026": null,
        "customfield_12312023": null,
        "customfield_12312024": null,
        "aggregatetimeestimate": 0,
        "customfield_12312022": null,
        "customfield_12310921": null,
        "customfield_12310920": "9223372036854775807",
        "customfield_12312823": null,
        "creator": {
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=lhoestq",
            "name": "lhoestq",
            "key": "lhoestq",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
            },
            "displayName": "quentin lhoest",
            "active": true,
            "timeZone": "Etc/UTC"
        },
        "subtasks": [],
        "reporter": {
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=lhoestq",
            "name": "lhoestq",
            "key": "lhoestq",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
            },
            "displayName": "quentin lhoest",
            "active": true,
            "timeZone": "Etc/UTC"
        },
        "aggregateprogress": {
            "progress": 9600,
            "total": 9600,
            "percent": 100
        },
        "customfield_12313520": null,
        "customfield_12310250": null,
        "progress": {
            "progress": 9600,
            "total": 9600,
            "percent": 100
        },
        "customfield_12313924": null,
        "votes": {
            "self": "https://issues.apache.org/jira/rest/api/2/issue/ARROW-15291/votes",
            "votes": 0,
            "hasVoted": false
        },
        "worklog": {
            "startAt": 0,
            "maxResults": 20,
            "total": 16,
            "worklogs": [
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13421780/worklog/732280",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "AlenkaF opened a new pull request #12505:\nURL: https://github.com/apache/arrow/pull/12505\n\n\n   This PR tries to solve [ARROW-15291](https://issues.apache.org/jira/browse/ARROW-15291).\r\n   \r\n   Not sure about `if/else` in the `arrow_to_pandas.cc`. Maybe there is a way to redefine a field `shared_ptr` and optimize a bit? @pitrou what do you think?\r\n   \r\n   cc @jorisvandenbossche \n\n\n-- \nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nTo unsubscribe, e-mail: github-unsubscribe@arrow.apache.org\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2022-02-24T13:14:41.636+0000",
                    "updated": "2022-02-24T13:14:41.636+0000",
                    "started": "2022-02-24T13:14:41.635+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "732280",
                    "issueId": "13421780"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13421780/worklog/732281",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "github-actions[bot] commented on pull request #12505:\nURL: https://github.com/apache/arrow/pull/12505#issuecomment-1049848395\n\n\n   https://issues.apache.org/jira/browse/ARROW-15291\n\n\n-- \nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nTo unsubscribe, e-mail: github-unsubscribe@arrow.apache.org\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2022-02-24T13:15:04.659+0000",
                    "updated": "2022-02-24T13:15:04.659+0000",
                    "started": "2022-02-24T13:15:04.659+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "732281",
                    "issueId": "13421780"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13421780/worklog/732337",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "pitrou commented on a change in pull request #12505:\nURL: https://github.com/apache/arrow/pull/12505#discussion_r813927745\n\n\n\n##########\nFile path: python/pyarrow/tests/test_extension_type.py\n##########\n@@ -360,6 +360,64 @@ def test_ext_array_conversion_to_pandas():\n     pd.testing.assert_series_equal(result, expected)\n \n \n+def test_struct_w_ext_array_to_numpy():\n+    # ARROW-15291\n+    # Check that we don't segfault when trying to build\n+    # a numpy array from a StructArray with a field being\n+    # an ExtensionArray\n+\n+    storage1 = pa.array([1, 2, 3], type=pa.int64())\n+    storage2 = pa.array([b\"123\", b\"456\", b\"789\"], type=pa.binary(3))\n+    ty1 = IntegerType()\n+    ty2 = ParamExtType(3)\n+\n+    arr1 = pa.ExtensionArray.from_storage(ty1, storage1)\n+    arr2 = pa.ExtensionArray.from_storage(ty2, storage2)\n+\n+    sarr1 = pa.StructArray.from_arrays([arr1], [\"f0\"])\n+    sarr2 = pa.StructArray.from_arrays([arr2], [\"f1\"])\n+\n+    result = sarr1.to_numpy(zero_copy_only=False)\n+    expected = np.array([{'f0': 1}, {'f0': 2},\n+                         {'f0': 3}], dtype=object)\n+    np.testing.assert_array_equal(result, expected)\n+\n+    result = sarr2.to_numpy(zero_copy_only=False)\n+    expected = np.array([{'f1': b'123'}, {'f1': b'456'},\n+                         {'f1': b'789'}], dtype=object)\n+    np.testing.assert_array_equal(result, expected)\n+\n+\n+@pytest.mark.pandas\n+def test_struct_w_ext_array_to_pandas():\n\nReview comment:\n       Perhaps you can share most of the code between the two cases?\n\n##########\nFile path: cpp/src/arrow/python/arrow_to_pandas.cc\n##########\n@@ -656,8 +656,19 @@ Status ConvertStruct(PandasOptions options, const ChunkedArray& data,\n     // Convert the struct arrays first\n     for (int32_t i = 0; i < num_fields; i++) {\n       const auto field = arr->field(static_cast<int>(i));\n-      RETURN_NOT_OK(ConvertArrayToPandas(options, field, nullptr,\n-                                         fields_data[i + fields_data_offset].ref()));\n+      // In case the field is an extension array, use .storage() to convert to Pandas\n+      if (field->type()->id() == Type::EXTENSION){\n+        // Save the field object as an Extension Array\n+        const ExtensionArray& arr_ext = checked_cast<const ExtensionArray&>(*field);\n+        // Save the storage Array and use it to convert to Pandas\n+        const std::shared_ptr<Array> field_ext = arr_ext.storage();\n+        RETURN_NOT_OK(ConvertArrayToPandas(options, field_ext, nullptr,\n+                                           fields_data[i + fields_data_offset].ref()));\n+      }\n+      else{\n+        RETURN_NOT_OK(ConvertArrayToPandas(options, field, nullptr,\n+                                           fields_data[i + fields_data_offset].ref()));\n+      }\n\nReview comment:\n       You might want to make this terser, e.g. (untested):\r\n   ```suggestion\r\n         // In case the field is an extension array, use .storage() to convert to Pandas\r\n         if (field->type()->id() == Type::EXTENSION){\r\n           const ExtensionArray& arr_ext = checked_cast<const ExtensionArray&>(*field);\r\n           field = arr_ext.storage();\r\n         }\r\n         RETURN_NOT_OK(ConvertArrayToPandas(options, field, nullptr,\r\n                                            fields_data[i + fields_data_offset].ref()));\r\n   ```\n\n\n\n\n-- \nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nTo unsubscribe, e-mail: github-unsubscribe@arrow.apache.org\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2022-02-24T14:24:16.330+0000",
                    "updated": "2022-02-24T14:24:16.330+0000",
                    "started": "2022-02-24T14:24:16.329+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "732337",
                    "issueId": "13421780"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13421780/worklog/732347",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "jorisvandenbossche commented on a change in pull request #12505:\nURL: https://github.com/apache/arrow/pull/12505#discussion_r813939597\n\n\n\n##########\nFile path: cpp/src/arrow/python/arrow_to_pandas.cc\n##########\n@@ -656,8 +656,19 @@ Status ConvertStruct(PandasOptions options, const ChunkedArray& data,\n     // Convert the struct arrays first\n     for (int32_t i = 0; i < num_fields; i++) {\n       const auto field = arr->field(static_cast<int>(i));\n-      RETURN_NOT_OK(ConvertArrayToPandas(options, field, nullptr,\n-                                         fields_data[i + fields_data_offset].ref()));\n+      // In case the field is an extension array, use .storage() to convert to Pandas\n+      if (field->type()->id() == Type::EXTENSION){\n+        // Save the field object as an Extension Array\n+        const ExtensionArray& arr_ext = checked_cast<const ExtensionArray&>(*field);\n+        // Save the storage Array and use it to convert to Pandas\n+        const std::shared_ptr<Array> field_ext = arr_ext.storage();\n+        RETURN_NOT_OK(ConvertArrayToPandas(options, field_ext, nullptr,\n+                                           fields_data[i + fields_data_offset].ref()));\n+      }\n+      else{\n+        RETURN_NOT_OK(ConvertArrayToPandas(options, field, nullptr,\n+                                           fields_data[i + fields_data_offset].ref()));\n+      }\n\nReview comment:\n       We tried that when we were pairing on this earlier, and that gives a compilation error (see below). I wasn't able to directly figure out how to \"overwrite\" the `field` variable, so that's why we for now used the repeated `ConvertArrayToPandas` in both if and else clause.\r\n   \r\n   <details>\r\n   \r\n   ```\r\n   FAILED: src/arrow/python/CMakeFiles/arrow_python_objlib.dir/arrow_to_pandas.cc.o \r\n   /home/joris/miniconda3/envs/arrow-dev/bin/ccache /home/joris/miniconda3/envs/arrow-dev/bin/x86_64-conda-linux-gnu-c++ -DARROW_EXTRA_ERROR_CONTEXT -DARROW_HAVE_RUNTIME_AVX2 -DARROW_HAVE_RUNTIME_AVX512 -DARROW_HAVE_RUNTIME_BMI2 -DARROW_HAVE_RUNTIME_SSE4_2 -DARROW_HAVE_SSE4_2 -DARROW_HDFS -DARROW_JEMALLOC -DARROW_JEMALLOC_INCLUDE_DIR=\"\" -DARROW_PYTHON_EXPORTING -DARROW_WITH_BROTLI -DARROW_WITH_BZ2 -DARROW_WITH_LZ4 -DARROW_WITH_RE2 -DARROW_WITH_SNAPPY -DARROW_WITH_TIMING_TESTS -DARROW_WITH_UTF8PROC -DARROW_WITH_ZLIB -DARROW_WITH_ZSTD -DURI_STATIC_BUILD -Isrc -I../src -I../src/generated -isystem ../thirdparty/flatbuffers/include -isystem jemalloc_ep-prefix/src -isystem xsimd_ep/src/xsimd_ep-install/include -isystem ../thirdparty/hadoop/include -isystem /home/joris/miniconda3/envs/arrow-dev/lib/python3.8/site-packages/numpy/core/include -isystem /home/joris/miniconda3/envs/arrow-dev/include/python3.8 -Wno-noexcept-type -fvisibility-inlines-hidden -std=c++17 -fmessage-length=0 -march=nocona -mtune=haswell -ftree-vectorize -fPIC -fstack-protector-strong -fno-plt -O2 -ffunction-sections -pipe -isystem /home/joris/miniconda3/envs/arrow-dev/include -fdiagnostics-color=always -ggdb -O0  -Wall -Wno-conversion -Wno-deprecated-declarations -Wno-sign-conversion -Wunused-result -Werror -fno-semantic-interposition -msse4.2  -g -fPIC -std=c++11 -MD -MT src/arrow/python/CMakeFiles/arrow_python_objlib.dir/arrow_to_pandas.cc.o -MF src/arrow/python/CMakeFiles/arrow_python_objlib.dir/arrow_to_pandas.cc.o.d -o src/arrow/python/CMakeFiles/arrow_python_objlib.dir/arrow_to_pandas.cc.o -c ../src/arrow/python/arrow_to_pandas.cc\r\n   ../src/arrow/python/arrow_to_pandas.cc: In function 'arrow::Status arrow::py::{anonymous}::ConvertStruct(arrow::py::PandasOptions, const arrow::ChunkedArray&, PyObject**)':\r\n   ../src/arrow/python/arrow_to_pandas.cc:662:33: error: no match for 'operator=' (operand types are 'const std::shared_ptr<arrow::Array>' and 'const std::shared_ptr<arrow::Array>')\r\n     662 |         field = arr_ext.storage();\r\n         |                                 ^\r\n   In file included from /home/joris/miniconda3/envs/arrow-dev/x86_64-conda-linux-gnu/include/c++/9.3.0/memory:81,\r\n                    from ../src/arrow/python/arrow_to_pandas.h:25,\r\n                    from ../src/arrow/python/arrow_to_pandas.cc:20:\r\n   /home/joris/miniconda3/envs/arrow-dev/x86_64-conda-linux-gnu/include/c++/9.3.0/bits/shared_ptr.h:309:19: note: candidate: 'std::shared_ptr<_Tp>& std::shared_ptr<_Tp>::operator=(const std::shared_ptr<_Tp>&) [with _Tp = arrow::Array]' <near match>\r\n     309 |       shared_ptr& operator=(const shared_ptr&) noexcept = default;\r\n         |                   ^~~~~~~~\r\n   /home/joris/miniconda3/envs/arrow-dev/x86_64-conda-linux-gnu/include/c++/9.3.0/bits/shared_ptr.h:309:19: note:   passing 'const std::shared_ptr<arrow::Array>*' as 'this' argument discards qualifiers\r\n   /home/joris/miniconda3/envs/arrow-dev/x86_64-conda-linux-gnu/include/c++/9.3.0/bits/shared_ptr.h:313:2: note: candidate: 'std::shared_ptr<_Tp>::_Assignable<const std::shared_ptr<_Yp>&> std::shared_ptr<_Tp>::operator=(const std::shared_ptr<_Yp>&) [with _Yp = arrow::Array; _Tp = arrow::Array; std::shared_ptr<_Tp>::_Assignable<const std::shared_ptr<_Yp>&> = std::shared_ptr<arrow::Array>&]' <near match>\r\n     313 |  operator=(const shared_ptr<_Yp>& __r) noexcept\r\n         |  ^~~~~~~~\r\n   /home/joris/miniconda3/envs/arrow-dev/x86_64-conda-linux-gnu/include/c++/9.3.0/bits/shared_ptr.h:313:2: note:   passing 'const std::shared_ptr<arrow::Array>*' as 'this' argument discards qualifiers\r\n   /home/joris/miniconda3/envs/arrow-dev/x86_64-conda-linux-gnu/include/c++/9.3.0/bits/shared_ptr.h:324:2: note: candidate: 'template<class _Yp> std::shared_ptr<_Tp>::_Assignable<std::auto_ptr<_Up> > std::shared_ptr<_Tp>::operator=(std::auto_ptr<_Up>&&) [with _Yp = _Yp; _Tp = arrow::Array]'\r\n     324 |  operator=(auto_ptr<_Yp>&& __r)\r\n         |  ^~~~~~~~\r\n   /home/joris/miniconda3/envs/arrow-dev/x86_64-conda-linux-gnu/include/c++/9.3.0/bits/shared_ptr.h:324:2: note:   template argument deduction/substitution failed:\r\n   ../src/arrow/python/arrow_to_pandas.cc:662:33: note:   types 'std::auto_ptr<_Up>' and 'const std::shared_ptr<arrow::Array>' have incompatible cv-qualifiers\r\n     662 |         field = arr_ext.storage();\r\n         |                                 ^\r\n   In file included from /home/joris/miniconda3/envs/arrow-dev/x86_64-conda-linux-gnu/include/c++/9.3.0/memory:81,\r\n                    from ../src/arrow/python/arrow_to_pandas.h:25,\r\n                    from ../src/arrow/python/arrow_to_pandas.cc:20:\r\n   /home/joris/miniconda3/envs/arrow-dev/x86_64-conda-linux-gnu/include/c++/9.3.0/bits/shared_ptr.h:333:7: note: candidate: 'std::shared_ptr<_Tp>& std::shared_ptr<_Tp>::operator=(std::shared_ptr<_Tp>&&) [with _Tp = arrow::Array]' <near match>\r\n     333 |       operator=(shared_ptr&& __r) noexcept\r\n         |       ^~~~~~~~\r\n   /home/joris/miniconda3/envs/arrow-dev/x86_64-conda-linux-gnu/include/c++/9.3.0/bits/shared_ptr.h:333:7: note:   conversion of argument 1 would be ill-formed:\r\n   ../src/arrow/python/arrow_to_pandas.cc:662:32: error: cannot bind rvalue reference of type 'std::shared_ptr<arrow::Array>&&' to lvalue of type 'const std::shared_ptr<arrow::Array>'\r\n     662 |         field = arr_ext.storage();\r\n         |                 ~~~~~~~~~~~~~~~^~\r\n   In file included from /home/joris/miniconda3/envs/arrow-dev/x86_64-conda-linux-gnu/include/c++/9.3.0/memory:81,\r\n                    from ../src/arrow/python/arrow_to_pandas.h:25,\r\n                    from ../src/arrow/python/arrow_to_pandas.cc:20:\r\n   /home/joris/miniconda3/envs/arrow-dev/x86_64-conda-linux-gnu/include/c++/9.3.0/bits/shared_ptr.h:341:2: note: candidate: 'template<class _Yp> std::shared_ptr<_Tp>::_Assignable<std::shared_ptr<_Yp> > std::shared_ptr<_Tp>::operator=(std::shared_ptr<_Yp>&&) [with _Yp = _Yp; _Tp = arrow::Array]'\r\n     341 |  operator=(shared_ptr<_Yp>&& __r) noexcept\r\n         |  ^~~~~~~~\r\n   /home/joris/miniconda3/envs/arrow-dev/x86_64-conda-linux-gnu/include/c++/9.3.0/bits/shared_ptr.h:341:2: note:   template argument deduction/substitution failed:\r\n   ../src/arrow/python/arrow_to_pandas.cc:662:33: note:   types 'std::shared_ptr<_Tp>' and 'const std::shared_ptr<arrow::Array>' have incompatible cv-qualifiers\r\n     662 |         field = arr_ext.storage();\r\n         |                                 ^\r\n   In file included from /home/joris/miniconda3/envs/arrow-dev/x86_64-conda-linux-gnu/include/c++/9.3.0/memory:81,\r\n                    from ../src/arrow/python/arrow_to_pandas.h:25,\r\n                    from ../src/arrow/python/arrow_to_pandas.cc:20:\r\n   /home/joris/miniconda3/envs/arrow-dev/x86_64-conda-linux-gnu/include/c++/9.3.0/bits/shared_ptr.h:349:2: note: candidate: 'template<class _Yp, class _Del> std::shared_ptr<_Tp>::_Assignable<std::unique_ptr<_Up, _Ep> > std::shared_ptr<_Tp>::operator=(std::unique_ptr<_Up, _Ep>&&) [with _Yp = _Yp; _Del = _Del; _Tp = arrow::Array]'\r\n     349 |  operator=(unique_ptr<_Yp, _Del>&& __r)\r\n         |  ^~~~~~~~\r\n   /home/joris/miniconda3/envs/arrow-dev/x86_64-conda-linux-gnu/include/c++/9.3.0/bits/shared_ptr.h:349:2: note:   template argument deduction/substitution failed:\r\n   ../src/arrow/python/arrow_to_pandas.cc:662:33: note:   types 'std::unique_ptr<_Tp, _Dp>' and 'const std::shared_ptr<arrow::Array>' have incompatible cv-qualifiers\r\n     662 |         field = arr_ext.storage();\r\n         |                                 ^\r\n   ninja: build stopped: subcommand failed.\r\n   [1/6] Building CXX object src/arrow/python/CMakeFiles/arrow_python_objlib.dir/arrow_to_pandas.cc.o\r\n   ```\r\n   \r\n   </details>\n\n\n\n\n-- \nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nTo unsubscribe, e-mail: github-unsubscribe@arrow.apache.org\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2022-02-24T14:35:30.209+0000",
                    "updated": "2022-02-24T14:35:30.209+0000",
                    "started": "2022-02-24T14:35:30.209+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "732347",
                    "issueId": "13421780"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13421780/worklog/732348",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "jorisvandenbossche commented on a change in pull request #12505:\nURL: https://github.com/apache/arrow/pull/12505#discussion_r813939597\n\n\n\n##########\nFile path: cpp/src/arrow/python/arrow_to_pandas.cc\n##########\n@@ -656,8 +656,19 @@ Status ConvertStruct(PandasOptions options, const ChunkedArray& data,\n     // Convert the struct arrays first\n     for (int32_t i = 0; i < num_fields; i++) {\n       const auto field = arr->field(static_cast<int>(i));\n-      RETURN_NOT_OK(ConvertArrayToPandas(options, field, nullptr,\n-                                         fields_data[i + fields_data_offset].ref()));\n+      // In case the field is an extension array, use .storage() to convert to Pandas\n+      if (field->type()->id() == Type::EXTENSION){\n+        // Save the field object as an Extension Array\n+        const ExtensionArray& arr_ext = checked_cast<const ExtensionArray&>(*field);\n+        // Save the storage Array and use it to convert to Pandas\n+        const std::shared_ptr<Array> field_ext = arr_ext.storage();\n+        RETURN_NOT_OK(ConvertArrayToPandas(options, field_ext, nullptr,\n+                                           fields_data[i + fields_data_offset].ref()));\n+      }\n+      else{\n+        RETURN_NOT_OK(ConvertArrayToPandas(options, field, nullptr,\n+                                           fields_data[i + fields_data_offset].ref()));\n+      }\n\nReview comment:\n       We tried that when we were pairing on this earlier, and that gives a compilation error (see below). I wasn't able to directly figure out how to \"overwrite\" the `field` variable, so that's why we for now used the repeated `ConvertArrayToPandas` in both if and else clause (which at least worked, although a bit repetitive).\r\n   \r\n   <details>\r\n   \r\n   ```\r\n   FAILED: src/arrow/python/CMakeFiles/arrow_python_objlib.dir/arrow_to_pandas.cc.o \r\n   /home/joris/miniconda3/envs/arrow-dev/bin/ccache /home/joris/miniconda3/envs/arrow-dev/bin/x86_64-conda-linux-gnu-c++ -DARROW_EXTRA_ERROR_CONTEXT -DARROW_HAVE_RUNTIME_AVX2 -DARROW_HAVE_RUNTIME_AVX512 -DARROW_HAVE_RUNTIME_BMI2 -DARROW_HAVE_RUNTIME_SSE4_2 -DARROW_HAVE_SSE4_2 -DARROW_HDFS -DARROW_JEMALLOC -DARROW_JEMALLOC_INCLUDE_DIR=\"\" -DARROW_PYTHON_EXPORTING -DARROW_WITH_BROTLI -DARROW_WITH_BZ2 -DARROW_WITH_LZ4 -DARROW_WITH_RE2 -DARROW_WITH_SNAPPY -DARROW_WITH_TIMING_TESTS -DARROW_WITH_UTF8PROC -DARROW_WITH_ZLIB -DARROW_WITH_ZSTD -DURI_STATIC_BUILD -Isrc -I../src -I../src/generated -isystem ../thirdparty/flatbuffers/include -isystem jemalloc_ep-prefix/src -isystem xsimd_ep/src/xsimd_ep-install/include -isystem ../thirdparty/hadoop/include -isystem /home/joris/miniconda3/envs/arrow-dev/lib/python3.8/site-packages/numpy/core/include -isystem /home/joris/miniconda3/envs/arrow-dev/include/python3.8 -Wno-noexcept-type -fvisibility-inlines-hidden -std=c++17 -fmessage-length=0 -march=nocona -mtune=haswell -ftree-vectorize -fPIC -fstack-protector-strong -fno-plt -O2 -ffunction-sections -pipe -isystem /home/joris/miniconda3/envs/arrow-dev/include -fdiagnostics-color=always -ggdb -O0  -Wall -Wno-conversion -Wno-deprecated-declarations -Wno-sign-conversion -Wunused-result -Werror -fno-semantic-interposition -msse4.2  -g -fPIC -std=c++11 -MD -MT src/arrow/python/CMakeFiles/arrow_python_objlib.dir/arrow_to_pandas.cc.o -MF src/arrow/python/CMakeFiles/arrow_python_objlib.dir/arrow_to_pandas.cc.o.d -o src/arrow/python/CMakeFiles/arrow_python_objlib.dir/arrow_to_pandas.cc.o -c ../src/arrow/python/arrow_to_pandas.cc\r\n   ../src/arrow/python/arrow_to_pandas.cc: In function 'arrow::Status arrow::py::{anonymous}::ConvertStruct(arrow::py::PandasOptions, const arrow::ChunkedArray&, PyObject**)':\r\n   ../src/arrow/python/arrow_to_pandas.cc:662:33: error: no match for 'operator=' (operand types are 'const std::shared_ptr<arrow::Array>' and 'const std::shared_ptr<arrow::Array>')\r\n     662 |         field = arr_ext.storage();\r\n         |                                 ^\r\n   In file included from /home/joris/miniconda3/envs/arrow-dev/x86_64-conda-linux-gnu/include/c++/9.3.0/memory:81,\r\n                    from ../src/arrow/python/arrow_to_pandas.h:25,\r\n                    from ../src/arrow/python/arrow_to_pandas.cc:20:\r\n   /home/joris/miniconda3/envs/arrow-dev/x86_64-conda-linux-gnu/include/c++/9.3.0/bits/shared_ptr.h:309:19: note: candidate: 'std::shared_ptr<_Tp>& std::shared_ptr<_Tp>::operator=(const std::shared_ptr<_Tp>&) [with _Tp = arrow::Array]' <near match>\r\n     309 |       shared_ptr& operator=(const shared_ptr&) noexcept = default;\r\n         |                   ^~~~~~~~\r\n   /home/joris/miniconda3/envs/arrow-dev/x86_64-conda-linux-gnu/include/c++/9.3.0/bits/shared_ptr.h:309:19: note:   passing 'const std::shared_ptr<arrow::Array>*' as 'this' argument discards qualifiers\r\n   /home/joris/miniconda3/envs/arrow-dev/x86_64-conda-linux-gnu/include/c++/9.3.0/bits/shared_ptr.h:313:2: note: candidate: 'std::shared_ptr<_Tp>::_Assignable<const std::shared_ptr<_Yp>&> std::shared_ptr<_Tp>::operator=(const std::shared_ptr<_Yp>&) [with _Yp = arrow::Array; _Tp = arrow::Array; std::shared_ptr<_Tp>::_Assignable<const std::shared_ptr<_Yp>&> = std::shared_ptr<arrow::Array>&]' <near match>\r\n     313 |  operator=(const shared_ptr<_Yp>& __r) noexcept\r\n         |  ^~~~~~~~\r\n   /home/joris/miniconda3/envs/arrow-dev/x86_64-conda-linux-gnu/include/c++/9.3.0/bits/shared_ptr.h:313:2: note:   passing 'const std::shared_ptr<arrow::Array>*' as 'this' argument discards qualifiers\r\n   /home/joris/miniconda3/envs/arrow-dev/x86_64-conda-linux-gnu/include/c++/9.3.0/bits/shared_ptr.h:324:2: note: candidate: 'template<class _Yp> std::shared_ptr<_Tp>::_Assignable<std::auto_ptr<_Up> > std::shared_ptr<_Tp>::operator=(std::auto_ptr<_Up>&&) [with _Yp = _Yp; _Tp = arrow::Array]'\r\n     324 |  operator=(auto_ptr<_Yp>&& __r)\r\n         |  ^~~~~~~~\r\n   /home/joris/miniconda3/envs/arrow-dev/x86_64-conda-linux-gnu/include/c++/9.3.0/bits/shared_ptr.h:324:2: note:   template argument deduction/substitution failed:\r\n   ../src/arrow/python/arrow_to_pandas.cc:662:33: note:   types 'std::auto_ptr<_Up>' and 'const std::shared_ptr<arrow::Array>' have incompatible cv-qualifiers\r\n     662 |         field = arr_ext.storage();\r\n         |                                 ^\r\n   In file included from /home/joris/miniconda3/envs/arrow-dev/x86_64-conda-linux-gnu/include/c++/9.3.0/memory:81,\r\n                    from ../src/arrow/python/arrow_to_pandas.h:25,\r\n                    from ../src/arrow/python/arrow_to_pandas.cc:20:\r\n   /home/joris/miniconda3/envs/arrow-dev/x86_64-conda-linux-gnu/include/c++/9.3.0/bits/shared_ptr.h:333:7: note: candidate: 'std::shared_ptr<_Tp>& std::shared_ptr<_Tp>::operator=(std::shared_ptr<_Tp>&&) [with _Tp = arrow::Array]' <near match>\r\n     333 |       operator=(shared_ptr&& __r) noexcept\r\n         |       ^~~~~~~~\r\n   /home/joris/miniconda3/envs/arrow-dev/x86_64-conda-linux-gnu/include/c++/9.3.0/bits/shared_ptr.h:333:7: note:   conversion of argument 1 would be ill-formed:\r\n   ../src/arrow/python/arrow_to_pandas.cc:662:32: error: cannot bind rvalue reference of type 'std::shared_ptr<arrow::Array>&&' to lvalue of type 'const std::shared_ptr<arrow::Array>'\r\n     662 |         field = arr_ext.storage();\r\n         |                 ~~~~~~~~~~~~~~~^~\r\n   In file included from /home/joris/miniconda3/envs/arrow-dev/x86_64-conda-linux-gnu/include/c++/9.3.0/memory:81,\r\n                    from ../src/arrow/python/arrow_to_pandas.h:25,\r\n                    from ../src/arrow/python/arrow_to_pandas.cc:20:\r\n   /home/joris/miniconda3/envs/arrow-dev/x86_64-conda-linux-gnu/include/c++/9.3.0/bits/shared_ptr.h:341:2: note: candidate: 'template<class _Yp> std::shared_ptr<_Tp>::_Assignable<std::shared_ptr<_Yp> > std::shared_ptr<_Tp>::operator=(std::shared_ptr<_Yp>&&) [with _Yp = _Yp; _Tp = arrow::Array]'\r\n     341 |  operator=(shared_ptr<_Yp>&& __r) noexcept\r\n         |  ^~~~~~~~\r\n   /home/joris/miniconda3/envs/arrow-dev/x86_64-conda-linux-gnu/include/c++/9.3.0/bits/shared_ptr.h:341:2: note:   template argument deduction/substitution failed:\r\n   ../src/arrow/python/arrow_to_pandas.cc:662:33: note:   types 'std::shared_ptr<_Tp>' and 'const std::shared_ptr<arrow::Array>' have incompatible cv-qualifiers\r\n     662 |         field = arr_ext.storage();\r\n         |                                 ^\r\n   In file included from /home/joris/miniconda3/envs/arrow-dev/x86_64-conda-linux-gnu/include/c++/9.3.0/memory:81,\r\n                    from ../src/arrow/python/arrow_to_pandas.h:25,\r\n                    from ../src/arrow/python/arrow_to_pandas.cc:20:\r\n   /home/joris/miniconda3/envs/arrow-dev/x86_64-conda-linux-gnu/include/c++/9.3.0/bits/shared_ptr.h:349:2: note: candidate: 'template<class _Yp, class _Del> std::shared_ptr<_Tp>::_Assignable<std::unique_ptr<_Up, _Ep> > std::shared_ptr<_Tp>::operator=(std::unique_ptr<_Up, _Ep>&&) [with _Yp = _Yp; _Del = _Del; _Tp = arrow::Array]'\r\n     349 |  operator=(unique_ptr<_Yp, _Del>&& __r)\r\n         |  ^~~~~~~~\r\n   /home/joris/miniconda3/envs/arrow-dev/x86_64-conda-linux-gnu/include/c++/9.3.0/bits/shared_ptr.h:349:2: note:   template argument deduction/substitution failed:\r\n   ../src/arrow/python/arrow_to_pandas.cc:662:33: note:   types 'std::unique_ptr<_Tp, _Dp>' and 'const std::shared_ptr<arrow::Array>' have incompatible cv-qualifiers\r\n     662 |         field = arr_ext.storage();\r\n         |                                 ^\r\n   ninja: build stopped: subcommand failed.\r\n   [1/6] Building CXX object src/arrow/python/CMakeFiles/arrow_python_objlib.dir/arrow_to_pandas.cc.o\r\n   ```\r\n   \r\n   </details>\n\n\n\n\n-- \nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nTo unsubscribe, e-mail: github-unsubscribe@arrow.apache.org\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2022-02-24T14:35:44.861+0000",
                    "updated": "2022-02-24T14:35:44.861+0000",
                    "started": "2022-02-24T14:35:44.861+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "732348",
                    "issueId": "13421780"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13421780/worklog/732353",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "pitrou commented on a change in pull request #12505:\nURL: https://github.com/apache/arrow/pull/12505#discussion_r813942649\n\n\n\n##########\nFile path: cpp/src/arrow/python/arrow_to_pandas.cc\n##########\n@@ -656,8 +656,19 @@ Status ConvertStruct(PandasOptions options, const ChunkedArray& data,\n     // Convert the struct arrays first\n     for (int32_t i = 0; i < num_fields; i++) {\n       const auto field = arr->field(static_cast<int>(i));\n-      RETURN_NOT_OK(ConvertArrayToPandas(options, field, nullptr,\n-                                         fields_data[i + fields_data_offset].ref()));\n+      // In case the field is an extension array, use .storage() to convert to Pandas\n+      if (field->type()->id() == Type::EXTENSION){\n+        // Save the field object as an Extension Array\n+        const ExtensionArray& arr_ext = checked_cast<const ExtensionArray&>(*field);\n+        // Save the storage Array and use it to convert to Pandas\n+        const std::shared_ptr<Array> field_ext = arr_ext.storage();\n+        RETURN_NOT_OK(ConvertArrayToPandas(options, field_ext, nullptr,\n+                                           fields_data[i + fields_data_offset].ref()));\n+      }\n+      else{\n+        RETURN_NOT_OK(ConvertArrayToPandas(options, field, nullptr,\n+                                           fields_data[i + fields_data_offset].ref()));\n+      }\n\nReview comment:\n       Perhaps replace `const auto field` with `auto field` in the line introducting the `field` variable?\n\n\n\n\n-- \nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nTo unsubscribe, e-mail: github-unsubscribe@arrow.apache.org\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2022-02-24T14:38:30.770+0000",
                    "updated": "2022-02-24T14:38:30.770+0000",
                    "started": "2022-02-24T14:38:30.769+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "732353",
                    "issueId": "13421780"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13421780/worklog/732358",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "jorisvandenbossche commented on pull request #12505:\nURL: https://github.com/apache/arrow/pull/12505#issuecomment-1049930335\n\n\n   > I'll defer to @jorisvandenbossche on whether this is the approach we want to take (I have no idea what the \"ideal\" output would be).\r\n   \r\n   This fix is not \"ideal\" (because it falls back to the storage array, while the ExtensionArray subclass could define a custom conversion to pandas / numpy, and ideally we would use that, also if the array is nested inside a list or struct array), but certainly better than segfaulting. So I think a good short term fix.\r\n   \r\n   If an ExtensionArray subclass defines such a custom conversion to numpy or pandas, that's defined on the python class, which means that we would need to call into python here, making this a whole lot more complicated.\r\n   \r\n   \n\n\n-- \nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nTo unsubscribe, e-mail: github-unsubscribe@arrow.apache.org\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2022-02-24T14:43:56.463+0000",
                    "updated": "2022-02-24T14:43:56.463+0000",
                    "started": "2022-02-24T14:43:56.463+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "732358",
                    "issueId": "13421780"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13421780/worklog/732364",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "jorisvandenbossche commented on a change in pull request #12505:\nURL: https://github.com/apache/arrow/pull/12505#discussion_r813950854\n\n\n\n##########\nFile path: cpp/src/arrow/python/arrow_to_pandas.cc\n##########\n@@ -656,8 +656,19 @@ Status ConvertStruct(PandasOptions options, const ChunkedArray& data,\n     // Convert the struct arrays first\n     for (int32_t i = 0; i < num_fields; i++) {\n       const auto field = arr->field(static_cast<int>(i));\n-      RETURN_NOT_OK(ConvertArrayToPandas(options, field, nullptr,\n-                                         fields_data[i + fields_data_offset].ref()));\n+      // In case the field is an extension array, use .storage() to convert to Pandas\n+      if (field->type()->id() == Type::EXTENSION){\n+        // Save the field object as an Extension Array\n+        const ExtensionArray& arr_ext = checked_cast<const ExtensionArray&>(*field);\n+        // Save the storage Array and use it to convert to Pandas\n+        const std::shared_ptr<Array> field_ext = arr_ext.storage();\n+        RETURN_NOT_OK(ConvertArrayToPandas(options, field_ext, nullptr,\n+                                           fields_data[i + fields_data_offset].ref()));\n+      }\n+      else{\n+        RETURN_NOT_OK(ConvertArrayToPandas(options, field, nullptr,\n+                                           fields_data[i + fields_data_offset].ref()));\n+      }\n\nReview comment:\n       Ah, yes, that does the trick, thanks! (we were actually thinking that the `const` disallowed updating what `field` was pointing to, but didn't think about removing the const :))\n\n\n\n\n-- \nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nTo unsubscribe, e-mail: github-unsubscribe@arrow.apache.org\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2022-02-24T14:46:37.627+0000",
                    "updated": "2022-02-24T14:46:37.627+0000",
                    "started": "2022-02-24T14:46:37.627+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "732364",
                    "issueId": "13421780"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13421780/worklog/732370",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "AlenkaF commented on a change in pull request #12505:\nURL: https://github.com/apache/arrow/pull/12505#discussion_r813956975\n\n\n\n##########\nFile path: cpp/src/arrow/python/arrow_to_pandas.cc\n##########\n@@ -656,8 +656,19 @@ Status ConvertStruct(PandasOptions options, const ChunkedArray& data,\n     // Convert the struct arrays first\n     for (int32_t i = 0; i < num_fields; i++) {\n       const auto field = arr->field(static_cast<int>(i));\n-      RETURN_NOT_OK(ConvertArrayToPandas(options, field, nullptr,\n-                                         fields_data[i + fields_data_offset].ref()));\n+      // In case the field is an extension array, use .storage() to convert to Pandas\n+      if (field->type()->id() == Type::EXTENSION){\n+        // Save the field object as an Extension Array\n+        const ExtensionArray& arr_ext = checked_cast<const ExtensionArray&>(*field);\n+        // Save the storage Array and use it to convert to Pandas\n+        const std::shared_ptr<Array> field_ext = arr_ext.storage();\n+        RETURN_NOT_OK(ConvertArrayToPandas(options, field_ext, nullptr,\n+                                           fields_data[i + fields_data_offset].ref()));\n+      }\n+      else{\n+        RETURN_NOT_OK(ConvertArrayToPandas(options, field, nullptr,\n+                                           fields_data[i + fields_data_offset].ref()));\n+      }\n\nReview comment:\n       Joris, I still get `segfault` in this case ...\n\n\n\n\n-- \nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nTo unsubscribe, e-mail: github-unsubscribe@arrow.apache.org\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2022-02-24T14:52:47.364+0000",
                    "updated": "2022-02-24T14:52:47.364+0000",
                    "started": "2022-02-24T14:52:47.364+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "732370",
                    "issueId": "13421780"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13421780/worklog/732391",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "AlenkaF commented on a change in pull request #12505:\nURL: https://github.com/apache/arrow/pull/12505#discussion_r813979570\n\n\n\n##########\nFile path: cpp/src/arrow/python/arrow_to_pandas.cc\n##########\n@@ -656,8 +656,19 @@ Status ConvertStruct(PandasOptions options, const ChunkedArray& data,\n     // Convert the struct arrays first\n     for (int32_t i = 0; i < num_fields; i++) {\n       const auto field = arr->field(static_cast<int>(i));\n-      RETURN_NOT_OK(ConvertArrayToPandas(options, field, nullptr,\n-                                         fields_data[i + fields_data_offset].ref()));\n+      // In case the field is an extension array, use .storage() to convert to Pandas\n+      if (field->type()->id() == Type::EXTENSION){\n+        // Save the field object as an Extension Array\n+        const ExtensionArray& arr_ext = checked_cast<const ExtensionArray&>(*field);\n+        // Save the storage Array and use it to convert to Pandas\n+        const std::shared_ptr<Array> field_ext = arr_ext.storage();\n+        RETURN_NOT_OK(ConvertArrayToPandas(options, field_ext, nullptr,\n+                                           fields_data[i + fields_data_offset].ref()));\n+      }\n+      else{\n+        RETURN_NOT_OK(ConvertArrayToPandas(options, field, nullptr,\n+                                           fields_data[i + fields_data_offset].ref()));\n+      }\n\nReview comment:\n       Sorry, applied to the wrong line. Works like a charm.\r\n   Will correct this, styling and the test. Thank you!\n\n\n\n\n-- \nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nTo unsubscribe, e-mail: github-unsubscribe@arrow.apache.org\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2022-02-24T15:14:15.472+0000",
                    "updated": "2022-02-24T15:14:15.472+0000",
                    "started": "2022-02-24T15:14:15.472+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "732391",
                    "issueId": "13421780"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13421780/worklog/732867",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "AlenkaF commented on pull request #12505:\nURL: https://github.com/apache/arrow/pull/12505#issuecomment-1050549538\n\n\n   @jorisvandenbossche the error seems unrelated, I think it is ready for another round of review.\n\n\n-- \nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nTo unsubscribe, e-mail: github-unsubscribe@arrow.apache.org\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2022-02-25T05:56:04.027+0000",
                    "updated": "2022-02-25T05:56:04.027+0000",
                    "started": "2022-02-25T05:56:04.026+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "732867",
                    "issueId": "13421780"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13421780/worklog/734551",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "jorisvandenbossche closed pull request #12505:\nURL: https://github.com/apache/arrow/pull/12505\n\n\n   \n\n\n-- \nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nTo unsubscribe, e-mail: github-unsubscribe@arrow.apache.org\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2022-03-01T13:08:12.986+0000",
                    "updated": "2022-03-01T13:08:12.986+0000",
                    "started": "2022-03-01T13:08:12.986+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "734551",
                    "issueId": "13421780"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13421780/worklog/734552",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "ursabot commented on pull request #12505:\nURL: https://github.com/apache/arrow/pull/12505#issuecomment-1055428757\n\n\n   Benchmark runs are scheduled for baseline = 781c4782d7d1232575f8435f2d0a6b494b878b81 and contender = abb6067a16ef7982a29020e6e5461b699631ad51. abb6067a16ef7982a29020e6e5461b699631ad51 is a master commit associated with this PR. Results will be available as each benchmark for each run completes.\n   Conbench compare runs links:\n   [Scheduled] [ec2-t3-xlarge-us-east-2](https://conbench.ursa.dev/compare/runs/1c38cead966d422c974a7c39dc97d7d3...d447eb924d664e9ca5f51f5bbd3f449f/)\n   [Scheduled] [test-mac-arm](https://conbench.ursa.dev/compare/runs/d2bcb57633214078bf920ccbfa2ed7d8...7da858a8cafc4a20a4e7b6ad471d6761/)\n   [Scheduled] [ursa-i9-9960x](https://conbench.ursa.dev/compare/runs/abcffde5c8594f18855ff6cbf3f7ee14...d4bdd11506bf49c8b02c65593524d630/)\n   [Scheduled] [ursa-thinkcentre-m75q](https://conbench.ursa.dev/compare/runs/68aec4a126684f858c527e2ff308295b...80528155374346efa328e45dd19c3902/)\n   Supported benchmarks:\n   ec2-t3-xlarge-us-east-2: Supported benchmark langs: Python. Runs only benchmarks with cloud = True\n   test-mac-arm: Supported benchmark langs: C++, Python, R\n   ursa-i9-9960x: Supported benchmark langs: Python, R, JavaScript\n   ursa-thinkcentre-m75q: Supported benchmark langs: C++, Java\n   \n\n\n-- \nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nTo unsubscribe, e-mail: github-unsubscribe@arrow.apache.org\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2022-03-01T13:11:13.884+0000",
                    "updated": "2022-03-01T13:11:13.884+0000",
                    "started": "2022-03-01T13:11:13.884+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "734552",
                    "issueId": "13421780"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13421780/worklog/734574",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "ursabot edited a comment on pull request #12505:\nURL: https://github.com/apache/arrow/pull/12505#issuecomment-1055428757\n\n\n   Benchmark runs are scheduled for baseline = 781c4782d7d1232575f8435f2d0a6b494b878b81 and contender = abb6067a16ef7982a29020e6e5461b699631ad51. abb6067a16ef7982a29020e6e5461b699631ad51 is a master commit associated with this PR. Results will be available as each benchmark for each run completes.\n   Conbench compare runs links:\n   [Finished :arrow_down:0.0% :arrow_up:0.0%] [ec2-t3-xlarge-us-east-2](https://conbench.ursa.dev/compare/runs/1c38cead966d422c974a7c39dc97d7d3...d447eb924d664e9ca5f51f5bbd3f449f/)\n   [Scheduled] [test-mac-arm](https://conbench.ursa.dev/compare/runs/d2bcb57633214078bf920ccbfa2ed7d8...7da858a8cafc4a20a4e7b6ad471d6761/)\n   [Scheduled] [ursa-i9-9960x](https://conbench.ursa.dev/compare/runs/abcffde5c8594f18855ff6cbf3f7ee14...d4bdd11506bf49c8b02c65593524d630/)\n   [Scheduled] [ursa-thinkcentre-m75q](https://conbench.ursa.dev/compare/runs/68aec4a126684f858c527e2ff308295b...80528155374346efa328e45dd19c3902/)\n   Supported benchmarks:\n   ec2-t3-xlarge-us-east-2: Supported benchmark langs: Python. Runs only benchmarks with cloud = True\n   test-mac-arm: Supported benchmark langs: C++, Python, R\n   ursa-i9-9960x: Supported benchmark langs: Python, R, JavaScript\n   ursa-thinkcentre-m75q: Supported benchmark langs: C++, Java\n   \n\n\n-- \nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nTo unsubscribe, e-mail: github-unsubscribe@arrow.apache.org\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2022-03-01T13:31:11.418+0000",
                    "updated": "2022-03-01T13:31:11.418+0000",
                    "started": "2022-03-01T13:31:11.418+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "734574",
                    "issueId": "13421780"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13421780/worklog/734666",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "ursabot edited a comment on pull request #12505:\nURL: https://github.com/apache/arrow/pull/12505#issuecomment-1055428757\n\n\n   Benchmark runs are scheduled for baseline = 781c4782d7d1232575f8435f2d0a6b494b878b81 and contender = abb6067a16ef7982a29020e6e5461b699631ad51. abb6067a16ef7982a29020e6e5461b699631ad51 is a master commit associated with this PR. Results will be available as each benchmark for each run completes.\n   Conbench compare runs links:\n   [Finished :arrow_down:0.0% :arrow_up:0.0%] [ec2-t3-xlarge-us-east-2](https://conbench.ursa.dev/compare/runs/1c38cead966d422c974a7c39dc97d7d3...d447eb924d664e9ca5f51f5bbd3f449f/)\n   [Finished :arrow_down:0.59% :arrow_up:0.0%] [test-mac-arm](https://conbench.ursa.dev/compare/runs/d2bcb57633214078bf920ccbfa2ed7d8...7da858a8cafc4a20a4e7b6ad471d6761/)\n   [Scheduled] [ursa-i9-9960x](https://conbench.ursa.dev/compare/runs/abcffde5c8594f18855ff6cbf3f7ee14...d4bdd11506bf49c8b02c65593524d630/)\n   [Finished :arrow_down:0.17% :arrow_up:0.04%] [ursa-thinkcentre-m75q](https://conbench.ursa.dev/compare/runs/68aec4a126684f858c527e2ff308295b...80528155374346efa328e45dd19c3902/)\n   Supported benchmarks:\n   ec2-t3-xlarge-us-east-2: Supported benchmark langs: Python. Runs only benchmarks with cloud = True\n   test-mac-arm: Supported benchmark langs: C++, Python, R\n   ursa-i9-9960x: Supported benchmark langs: Python, R, JavaScript\n   ursa-thinkcentre-m75q: Supported benchmark langs: C++, Java\n   \n\n\n-- \nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nTo unsubscribe, e-mail: github-unsubscribe@arrow.apache.org\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2022-03-01T15:11:29.072+0000",
                    "updated": "2022-03-01T15:11:29.072+0000",
                    "started": "2022-03-01T15:11:29.071+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "734666",
                    "issueId": "13421780"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13421780/worklog/734714",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "ursabot edited a comment on pull request #12505:\nURL: https://github.com/apache/arrow/pull/12505#issuecomment-1055428757\n\n\n   Benchmark runs are scheduled for baseline = 781c4782d7d1232575f8435f2d0a6b494b878b81 and contender = abb6067a16ef7982a29020e6e5461b699631ad51. abb6067a16ef7982a29020e6e5461b699631ad51 is a master commit associated with this PR. Results will be available as each benchmark for each run completes.\n   Conbench compare runs links:\n   [Finished :arrow_down:0.0% :arrow_up:0.0%] [ec2-t3-xlarge-us-east-2](https://conbench.ursa.dev/compare/runs/1c38cead966d422c974a7c39dc97d7d3...d447eb924d664e9ca5f51f5bbd3f449f/)\n   [Finished :arrow_down:0.59% :arrow_up:0.0%] [test-mac-arm](https://conbench.ursa.dev/compare/runs/d2bcb57633214078bf920ccbfa2ed7d8...7da858a8cafc4a20a4e7b6ad471d6761/)\n   [Finished :arrow_down:0.71% :arrow_up:0.0%] [ursa-i9-9960x](https://conbench.ursa.dev/compare/runs/abcffde5c8594f18855ff6cbf3f7ee14...d4bdd11506bf49c8b02c65593524d630/)\n   [Finished :arrow_down:0.17% :arrow_up:0.04%] [ursa-thinkcentre-m75q](https://conbench.ursa.dev/compare/runs/68aec4a126684f858c527e2ff308295b...80528155374346efa328e45dd19c3902/)\n   Supported benchmarks:\n   ec2-t3-xlarge-us-east-2: Supported benchmark langs: Python. Runs only benchmarks with cloud = True\n   test-mac-arm: Supported benchmark langs: C++, Python, R\n   ursa-i9-9960x: Supported benchmark langs: Python, R, JavaScript\n   ursa-thinkcentre-m75q: Supported benchmark langs: C++, Java\n   \n\n\n-- \nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nTo unsubscribe, e-mail: github-unsubscribe@arrow.apache.org\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2022-03-01T15:51:41.872+0000",
                    "updated": "2022-03-01T15:51:41.872+0000",
                    "started": "2022-03-01T15:51:41.872+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "734714",
                    "issueId": "13421780"
                }
            ]
        },
        "customfield_12313920": null,
        "issuetype": {
            "self": "https://issues.apache.org/jira/rest/api/2/issuetype/1",
            "id": "1",
            "description": "A problem which impairs or prevents the functions of the product.",
            "iconUrl": "https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype",
            "name": "Bug",
            "subtask": false,
            "avatarId": 21133
        },
        "timespent": 9600,
        "customfield_12314020": "{summaryBean=com.atlassian.jira.plugin.devstatus.rest.SummaryBean@2e2765ec[summary={pullrequest=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@2b21b307[overall=PullRequestOverallBean{stateCount=0, state='OPEN', details=PullRequestOverallDetails{openCount=0, mergedCount=0, declinedCount=0}},byInstanceType={}], build=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@3093f268[overall=com.atlassian.jira.plugin.devstatus.summary.beans.BuildOverallBean@160cd6f6[failedBuildCount=0,successfulBuildCount=0,unknownBuildCount=0,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], review=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@702b1a9a[overall=com.atlassian.jira.plugin.devstatus.summary.beans.ReviewsOverallBean@22ae2844[stateCount=0,state=<null>,dueDate=<null>,overDue=false,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], deployment-environment=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@d818ecb[overall=com.atlassian.jira.plugin.devstatus.summary.beans.DeploymentOverallBean@7dca42eb[topEnvironments=[],showProjects=false,successfulCount=0,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], repository=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@559d7802[overall=com.atlassian.jira.plugin.devstatus.summary.beans.CommitOverallBean@6a286fd[count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], branch=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@7d4a734[overall=com.atlassian.jira.plugin.devstatus.summary.beans.BranchOverallBean@2826703f[count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}]},errors=[],configErrors=[]], devSummaryJson={\"cachedValue\":{\"errors\":[],\"configErrors\":[],\"summary\":{\"pullrequest\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"stateCount\":0,\"state\":\"OPEN\",\"details\":{\"openCount\":0,\"mergedCount\":0,\"declinedCount\":0,\"total\":0},\"open\":true},\"byInstanceType\":{}},\"build\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"failedBuildCount\":0,\"successfulBuildCount\":0,\"unknownBuildCount\":0},\"byInstanceType\":{}},\"review\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"stateCount\":0,\"state\":null,\"dueDate\":null,\"overDue\":false,\"completed\":false},\"byInstanceType\":{}},\"deployment-environment\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"topEnvironments\":[],\"showProjects\":false,\"successfulCount\":0},\"byInstanceType\":{}},\"repository\":{\"overall\":{\"count\":0,\"lastUpdated\":null},\"byInstanceType\":{}},\"branch\":{\"overall\":{\"count\":0,\"lastUpdated\":null},\"byInstanceType\":{}}}},\"isStale\":false}}",
        "customfield_12314141": null,
        "customfield_12314140": null,
        "project": {
            "self": "https://issues.apache.org/jira/rest/api/2/project/12319525",
            "id": "12319525",
            "key": "ARROW",
            "name": "Apache Arrow",
            "projectTypeKey": "software",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/projectavatar?pid=12319525&avatarId=10011",
                "24x24": "https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12319525&avatarId=10011",
                "16x16": "https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12319525&avatarId=10011",
                "32x32": "https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12319525&avatarId=10011"
            },
            "projectCategory": {
                "self": "https://issues.apache.org/jira/rest/api/2/projectCategory/13960",
                "id": "13960",
                "description": "Apache Arrow",
                "name": "Arrow"
            }
        },
        "aggregatetimespent": 9600,
        "customfield_12312520": null,
        "customfield_12312521": "Tue Mar 01 13:08:04 UTC 2022",
        "customfield_12314422": null,
        "customfield_12314421": null,
        "customfield_12314146": null,
        "customfield_12314420": null,
        "customfield_12314145": null,
        "customfield_12314144": null,
        "customfield_12314143": null,
        "resolutiondate": "2022-03-01T13:08:04.000+0000",
        "workratio": -1,
        "customfield_12312923": null,
        "customfield_12312920": null,
        "customfield_12312921": null,
        "watches": {
            "self": "https://issues.apache.org/jira/rest/api/2/issue/ARROW-15291/watchers",
            "watchCount": 2,
            "isWatching": false
        },
        "created": "2022-01-10T18:06:05.000+0000",
        "updated": "2022-03-01T15:51:42.000+0000",
        "timeoriginalestimate": null,
        "description": "Hi !\r\n\r\nIf you create a StructArray with an ExtensionArray in it, then both to_numpy and to_pandas\u00a0 segfault in python:\r\n{code:java}\r\nimport pyarrow as pa\r\n\r\nclass CustomType(pa.PyExtensionType):\r\n    def __init__(self):\r\n        pa.PyExtensionType.__init__(self, pa.binary())\r\n    def __reduce__(self):\r\n        return CustomType, ()\r\n\r\narr = pa.ExtensionArray.from_storage(CustomType(), pa.array([b\"foo\"]))\r\npa.StructArray.from_arrays([arr], [\"name\"]).to_numpy(zero_copy_only=False)\r\n {code}\r\nThanks in advance for the help !",
        "customfield_10010": null,
        "timetracking": {
            "remainingEstimate": "0h",
            "timeSpent": "2h 40m",
            "remainingEstimateSeconds": 0,
            "timeSpentSeconds": 9600
        },
        "customfield_12314523": null,
        "customfield_12314127": null,
        "customfield_12314522": null,
        "customfield_12314126": null,
        "customfield_12314521": null,
        "customfield_12314125": null,
        "customfield_12314520": null,
        "customfield_12314124": null,
        "attachment": [],
        "customfield_12312340": null,
        "customfield_12314123": null,
        "customfield_12312341": null,
        "customfield_12312220": null,
        "customfield_12314122": null,
        "customfield_12314121": null,
        "customfield_12314120": null,
        "customfield_12314129": null,
        "customfield_12314524": null,
        "customfield_12314128": null,
        "summary": "[C++][Python] Segfault in StructArray.to_numpy and to_pandas if it contains an ExtensionArray",
        "customfield_12314130": null,
        "customfield_12310291": null,
        "customfield_12310290": null,
        "customfield_12314138": null,
        "customfield_12314137": null,
        "environment": "pyarrow 6.0.1, macbook pro",
        "customfield_12314136": null,
        "customfield_12314135": null,
        "customfield_12311020": null,
        "customfield_12314134": null,
        "duedate": null,
        "customfield_12314132": null,
        "customfield_12314131": null,
        "comment": {
            "comments": [
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13421780/comment/17486362",
                    "id": "17486362",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=jorisvandenbossche",
                        "name": "jorisvandenbossche",
                        "key": "jorisvandenbossche",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "Joris Van den Bossche",
                        "active": true,
                        "timeZone": "Europe/Brussels"
                    },
                    "body": "[~lhoestq] thanks for the report! \r\n\r\nThe issue here is that for extension arrays itself (not nested in a struct) the actual conversion happens on the python side (either by calling {{to_numpy}} on the storage array, or if the ExtensionType defines an equivalent pandas extension dtype, by dispatching the conversion to pandas). \r\nBut that approach doesn't work if the extension array is nested in other non-extension types ..\r\n\r\nThe easiest workaround here short term might be to handle an extension array as its storage array when converting a nested type (eg in this case in {{ConvertStruct}}).\r\n\r\n",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=jorisvandenbossche",
                        "name": "jorisvandenbossche",
                        "key": "jorisvandenbossche",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "Joris Van den Bossche",
                        "active": true,
                        "timeZone": "Europe/Brussels"
                    },
                    "created": "2022-02-03T10:29:54.190+0000",
                    "updated": "2022-02-03T10:29:54.190+0000"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13421780/comment/17499521",
                    "id": "17499521",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=jorisvandenbossche",
                        "name": "jorisvandenbossche",
                        "key": "jorisvandenbossche",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "Joris Van den Bossche",
                        "active": true,
                        "timeZone": "Europe/Brussels"
                    },
                    "body": "Issue resolved by pull request 12505\n[https://github.com/apache/arrow/pull/12505]",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=jorisvandenbossche",
                        "name": "jorisvandenbossche",
                        "key": "jorisvandenbossche",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "Joris Van den Bossche",
                        "active": true,
                        "timeZone": "Europe/Brussels"
                    },
                    "created": "2022-03-01T13:08:04.819+0000",
                    "updated": "2022-03-01T13:08:04.819+0000"
                }
            ],
            "maxResults": 2,
            "total": 2,
            "startAt": 0
        },
        "customfield_12311820": "0|z0yfmw:",
        "customfield_12314139": null
    }
}