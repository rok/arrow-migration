{
    "expand": "operations,versionedRepresentations,editmeta,changelog,renderedFields",
    "id": "13262042",
    "self": "https://issues.apache.org/jira/rest/api/2/issue/13262042",
    "key": "ARROW-6869",
    "fields": {
        "fixVersions": [
            {
                "self": "https://issues.apache.org/jira/rest/api/2/version/12346358",
                "id": "12346358",
                "description": "",
                "name": "0.15.1",
                "archived": false,
                "released": true,
                "releaseDate": "2019-11-01"
            },
            {
                "self": "https://issues.apache.org/jira/rest/api/2/version/12340948",
                "id": "12340948",
                "description": "",
                "name": "0.16.0",
                "archived": false,
                "released": true,
                "releaseDate": "2020-02-07"
            }
        ],
        "resolution": {
            "self": "https://issues.apache.org/jira/rest/api/2/resolution/1",
            "id": "1",
            "description": "A fix for this issue is checked into the tree and tested.",
            "name": "Fixed"
        },
        "customfield_12312322": null,
        "customfield_12312323": null,
        "customfield_12312320": null,
        "customfield_12310420": "9223372036854775807",
        "customfield_12312321": null,
        "customfield_12312328": null,
        "customfield_12312329": null,
        "customfield_12312326": null,
        "customfield_12310300": null,
        "customfield_12312327": null,
        "customfield_12312324": null,
        "customfield_12312720": null,
        "customfield_12312325": null,
        "lastViewed": null,
        "priority": {
            "self": "https://issues.apache.org/jira/rest/api/2/priority/1",
            "iconUrl": "https://issues.apache.org/jira/images/icons/priorities/blocker.svg",
            "name": "Blocker",
            "id": "1"
        },
        "labels": [
            "pull-request-available"
        ],
        "customfield_12312333": null,
        "customfield_12312334": null,
        "customfield_12313422": "false",
        "customfield_12310310": "0.0",
        "customfield_12312331": null,
        "customfield_12312332": null,
        "aggregatetimeoriginalestimate": null,
        "timeestimate": 0,
        "customfield_12312330": null,
        "versions": [],
        "customfield_12311120": null,
        "customfield_12313826": null,
        "customfield_12312339": null,
        "issuelinks": [],
        "customfield_12313825": null,
        "assignee": {
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=wesm",
            "name": "wesm",
            "key": "wesmckinn",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=wesmckinn&avatarId=29931",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=wesmckinn&avatarId=29931",
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=wesmckinn&avatarId=29931",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=wesmckinn&avatarId=29931"
            },
            "displayName": "Wes McKinney",
            "active": true,
            "timeZone": "America/New_York"
        },
        "customfield_12312337": null,
        "customfield_12313823": null,
        "customfield_12312338": null,
        "customfield_12311920": null,
        "customfield_12313822": null,
        "customfield_12312335": null,
        "customfield_12313821": null,
        "customfield_12312336": null,
        "customfield_12313820": null,
        "status": {
            "self": "https://issues.apache.org/jira/rest/api/2/status/5",
            "description": "A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.",
            "iconUrl": "https://issues.apache.org/jira/images/icons/statuses/resolved.png",
            "name": "Resolved",
            "id": "5",
            "statusCategory": {
                "self": "https://issues.apache.org/jira/rest/api/2/statuscategory/3",
                "id": 3,
                "key": "done",
                "colorName": "green",
                "name": "Done"
            }
        },
        "components": [
            {
                "self": "https://issues.apache.org/jira/rest/api/2/component/12328935",
                "id": "12328935",
                "name": "C++"
            }
        ],
        "customfield_12312026": null,
        "customfield_12312023": null,
        "customfield_12312024": null,
        "aggregatetimeestimate": 0,
        "customfield_12312022": null,
        "customfield_12310921": null,
        "customfield_12310920": "9223372036854775807",
        "customfield_12312823": null,
        "creator": {
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=wesm",
            "name": "wesm",
            "key": "wesmckinn",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=wesmckinn&avatarId=29931",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=wesmckinn&avatarId=29931",
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=wesmckinn&avatarId=29931",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=wesmckinn&avatarId=29931"
            },
            "displayName": "Wes McKinney",
            "active": true,
            "timeZone": "America/New_York"
        },
        "subtasks": [],
        "reporter": {
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=wesm",
            "name": "wesm",
            "key": "wesmckinn",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=wesmckinn&avatarId=29931",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=wesmckinn&avatarId=29931",
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=wesmckinn&avatarId=29931",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=wesmckinn&avatarId=29931"
            },
            "displayName": "Wes McKinney",
            "active": true,
            "timeZone": "America/New_York"
        },
        "aggregateprogress": {
            "progress": 6000,
            "total": 6000,
            "percent": 100
        },
        "customfield_12313520": null,
        "customfield_12310250": null,
        "progress": {
            "progress": 6000,
            "total": 6000,
            "percent": 100
        },
        "customfield_12313924": null,
        "votes": {
            "self": "https://issues.apache.org/jira/rest/api/2/issue/ARROW-6869/votes",
            "votes": 0,
            "hasVoted": false
        },
        "worklog": {
            "startAt": 0,
            "maxResults": 20,
            "total": 16,
            "worklogs": [
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13262042/worklog/330087",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "wesm commented on pull request #5687: ARROW-6869: [C++] Do not return invalid arrays from DictionaryBuilder::Finish when reusing builder. Add \"FinishDelta\" method and \"ResetFull\" method\nURL: https://github.com/apache/arrow/pull/5687\n \n \n   The current behavior is \"wrong enough\" that adding this to 0.15.1 might not be a bad idea, but we could always leave it for the next major release\n \n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2019-10-17T19:41:26.158+0000",
                    "updated": "2019-10-17T19:41:26.158+0000",
                    "started": "2019-10-17T19:41:26.158+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "330087",
                    "issueId": "13262042"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13262042/worklog/330089",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "wesm commented on issue #5687: ARROW-6869: [C++] Do not return invalid arrays from DictionaryBuilder::Finish when reusing builder. Add \"FinishDelta\" method and \"ResetFull\" method\nURL: https://github.com/apache/arrow/pull/5687#issuecomment-543331988\n \n \n   cc @alendit also since this touches code that you worked on\n \n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2019-10-17T19:44:19.010+0000",
                    "updated": "2019-10-17T19:44:19.010+0000",
                    "started": "2019-10-17T19:44:19.008+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "330089",
                    "issueId": "13262042"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13262042/worklog/330093",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "github-actions[bot] commented on issue #5687: ARROW-6869: [C++] Do not return invalid arrays from DictionaryBuilder::Finish when reusing builder. Add \"FinishDelta\" method and \"ResetFull\" method\nURL: https://github.com/apache/arrow/pull/5687#issuecomment-543332769\n \n \n   https://issues.apache.org/jira/browse/ARROW-6869\n \n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2019-10-17T19:46:28.279+0000",
                    "updated": "2019-10-17T19:46:28.279+0000",
                    "started": "2019-10-17T19:46:28.278+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "330093",
                    "issueId": "13262042"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13262042/worklog/330107",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "pitrou commented on pull request #5687: ARROW-6869: [C++] Do not return invalid arrays from DictionaryBuilder::Finish when reusing builder. Add \"FinishDelta\" method and \"ResetFull\" method\nURL: https://github.com/apache/arrow/pull/5687#discussion_r336197515\n \n \n\n ##########\n File path: cpp/src/arrow/array/builder_dict.h\n ##########\n @@ -89,11 +89,7 @@ class ARROW_EXPORT DictionaryMemoTable {\n /// dense array\n ///\n /// Unlike other builders, dictionary builder does not completely\n-/// reset the state on Finish calls. The arrays built after the\n-/// initial Finish call will reuse the previously created encoding and\n-/// build a delta dictionary when new terms occur.\n-///\n-/// data\n+/// reset the state on Finish calls.\n \n Review comment:\n   Perhaps add a sentence here describing how/why not all state is reset?\n \n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2019-10-17T20:02:18.970+0000",
                    "updated": "2019-10-17T20:02:18.970+0000",
                    "started": "2019-10-17T20:02:18.969+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "330107",
                    "issueId": "13262042"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13262042/worklog/330109",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "pitrou commented on pull request #5687: ARROW-6869: [C++] Do not return invalid arrays from DictionaryBuilder::Finish when reusing builder. Add \"FinishDelta\" method and \"ResetFull\" method\nURL: https://github.com/apache/arrow/pull/5687#discussion_r336195478\n \n \n\n ##########\n File path: cpp/src/arrow/array/builder_dict.h\n ##########\n @@ -244,28 +246,26 @@ class DictionaryBuilderBase : public ArrayBuilder {\n     return Status::OK();\n   }\n \n-  Status FinishInternal(std::shared_ptr<ArrayData>* out) override {\n-    // Finalize indices array\n-    ARROW_RETURN_NOT_OK(indices_builder_.FinishInternal(out));\n+  /// \\brief Return dictionary indices and a delta dictionary since the last\n+  /// time that Finish or FinishDelta were called, and reset state of builder\n+  /// (except the memo table)\n+  Status FinishDelta(std::shared_ptr<Array>* out_indices,\n+                     std::shared_ptr<Array>* out_delta) {\n+    std::shared_ptr<Array> dictionary;\n+    std::shared_ptr<ArrayData> indices_data;\n+    ARROW_RETURN_NOT_OK(FinishWithDictOffset(delta_offset_, &indices_data, out_delta));\n \n-    // Generate dictionary array from hash table contents\n-    std::shared_ptr<ArrayData> dictionary_data;\n+    *out_indices = MakeArray(indices_data);\n+    return Status::OK();\n+  }\n \n-    ARROW_RETURN_NOT_OK(\n-        memo_table_->GetArrayData(pool_, delta_offset_, &dictionary_data));\n+  Status FinishInternal(std::shared_ptr<ArrayData>* out) override {\n \n Review comment:\n   Nit, but shouldn't FinishInternal be protected?\n \n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2019-10-17T20:02:18.973+0000",
                    "updated": "2019-10-17T20:02:18.973+0000",
                    "started": "2019-10-17T20:02:18.973+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "330109",
                    "issueId": "13262042"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13262042/worklog/330108",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "pitrou commented on pull request #5687: ARROW-6869: [C++] Do not return invalid arrays from DictionaryBuilder::Finish when reusing builder. Add \"FinishDelta\" method and \"ResetFull\" method\nURL: https://github.com/apache/arrow/pull/5687#discussion_r336196901\n \n \n\n ##########\n File path: cpp/src/arrow/array/builder_dict.h\n ##########\n @@ -244,28 +246,26 @@ class DictionaryBuilderBase : public ArrayBuilder {\n     return Status::OK();\n   }\n \n-  Status FinishInternal(std::shared_ptr<ArrayData>* out) override {\n-    // Finalize indices array\n-    ARROW_RETURN_NOT_OK(indices_builder_.FinishInternal(out));\n+  /// \\brief Return dictionary indices and a delta dictionary since the last\n+  /// time that Finish or FinishDelta were called, and reset state of builder\n+  /// (except the memo table)\n+  Status FinishDelta(std::shared_ptr<Array>* out_indices,\n+                     std::shared_ptr<Array>* out_delta) {\n+    std::shared_ptr<Array> dictionary;\n \n Review comment:\n   Is this variable unused?\n \n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2019-10-17T20:02:18.973+0000",
                    "updated": "2019-10-17T20:02:18.973+0000",
                    "started": "2019-10-17T20:02:18.973+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "330108",
                    "issueId": "13262042"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13262042/worklog/330110",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "pitrou commented on pull request #5687: ARROW-6869: [C++] Do not return invalid arrays from DictionaryBuilder::Finish when reusing builder. Add \"FinishDelta\" method and \"ResetFull\" method\nURL: https://github.com/apache/arrow/pull/5687#discussion_r336195059\n \n \n\n ##########\n File path: cpp/src/arrow/array/builder_dict.h\n ##########\n @@ -230,10 +226,16 @@ class DictionaryBuilderBase : public ArrayBuilder {\n   }\n \n   void Reset() override {\n+    // Perform a partial reset. Also call ResetDictionary to reset the\n \n Review comment:\n   You mean ResetFull?\n \n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2019-10-17T20:02:18.993+0000",
                    "updated": "2019-10-17T20:02:18.993+0000",
                    "started": "2019-10-17T20:02:18.993+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "330110",
                    "issueId": "13262042"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13262042/worklog/330111",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "pitrou commented on pull request #5687: ARROW-6869: [C++] Do not return invalid arrays from DictionaryBuilder::Finish when reusing builder. Add \"FinishDelta\" method and \"ResetFull\" method\nURL: https://github.com/apache/arrow/pull/5687#discussion_r336199520\n \n \n\n ##########\n File path: cpp/src/arrow/array_dict_test.cc\n ##########\n @@ -336,9 +320,34 @@ TYPED_TEST(TestDictionaryBuilder, FinishResetBehavior) {\n \n   ASSERT_OK(builder.Finish(&result));\n \n-  // Dictionary has 4 elements because the dictionary memo was not reset. This\n-  // behavior will change after ARROW-6869\n-  ASSERT_EQ(2, static_cast<const DictionaryArray&>(*result).dictionary()->length());\n+  // Dictionary has 4 elements because the dictionary memo was not reset\n+  ASSERT_EQ(4, static_cast<const DictionaryArray&>(*result).dictionary()->length());\n+}\n+\n+TYPED_TEST(TestDictionaryBuilder, ResetFull) {\n+  using c_type = typename TypeParam::c_type;\n+  auto type = std::make_shared<TypeParam>();\n+\n+  Dictionary32Builder<TypeParam> builder;\n+\n+  ASSERT_OK(builder.Append(static_cast<c_type>(1)));\n+  ASSERT_OK(builder.AppendNull());\n+  ASSERT_OK(builder.Append(static_cast<c_type>(1)));\n+  ASSERT_OK(builder.Append(static_cast<c_type>(2)));\n+\n+  std::shared_ptr<Array> result;\n+  ASSERT_OK(builder.Finish(&result));\n+\n+  ASSERT_OK(builder.Append(static_cast<c_type>(3)));\n+  ASSERT_OK(builder.Finish(&result));\n+\n+  // Dictionary expanded\n+  ASSERT_EQ(3, static_cast<const DictionaryArray&>(*result).dictionary()->length());\n+\n+  builder.ResetFull();\n+  ASSERT_OK(builder.Append(static_cast<c_type>(4)));\n+  ASSERT_OK(builder.Finish(&result));\n+  ASSERT_EQ(1, static_cast<const DictionaryArray&>(*result).dictionary()->length());\n \n Review comment:\n   Same here.\n \n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2019-10-17T20:02:19.358+0000",
                    "updated": "2019-10-17T20:02:19.358+0000",
                    "started": "2019-10-17T20:02:19.357+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "330111",
                    "issueId": "13262042"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13262042/worklog/330112",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "pitrou commented on pull request #5687: ARROW-6869: [C++] Do not return invalid arrays from DictionaryBuilder::Finish when reusing builder. Add \"FinishDelta\" method and \"ResetFull\" method\nURL: https://github.com/apache/arrow/pull/5687#discussion_r336199476\n \n \n\n ##########\n File path: cpp/src/arrow/array_dict_test.cc\n ##########\n @@ -336,9 +320,34 @@ TYPED_TEST(TestDictionaryBuilder, FinishResetBehavior) {\n \n   ASSERT_OK(builder.Finish(&result));\n \n-  // Dictionary has 4 elements because the dictionary memo was not reset. This\n-  // behavior will change after ARROW-6869\n-  ASSERT_EQ(2, static_cast<const DictionaryArray&>(*result).dictionary()->length());\n+  // Dictionary has 4 elements because the dictionary memo was not reset\n+  ASSERT_EQ(4, static_cast<const DictionaryArray&>(*result).dictionary()->length());\n+}\n+\n+TYPED_TEST(TestDictionaryBuilder, ResetFull) {\n+  using c_type = typename TypeParam::c_type;\n+  auto type = std::make_shared<TypeParam>();\n+\n+  Dictionary32Builder<TypeParam> builder;\n+\n+  ASSERT_OK(builder.Append(static_cast<c_type>(1)));\n+  ASSERT_OK(builder.AppendNull());\n+  ASSERT_OK(builder.Append(static_cast<c_type>(1)));\n+  ASSERT_OK(builder.Append(static_cast<c_type>(2)));\n+\n+  std::shared_ptr<Array> result;\n+  ASSERT_OK(builder.Finish(&result));\n+\n+  ASSERT_OK(builder.Append(static_cast<c_type>(3)));\n+  ASSERT_OK(builder.Finish(&result));\n+\n+  // Dictionary expanded\n+  ASSERT_EQ(3, static_cast<const DictionaryArray&>(*result).dictionary()->length());\n \n Review comment:\n   Can we actually test the result value here?\n \n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2019-10-17T20:02:19.500+0000",
                    "updated": "2019-10-17T20:02:19.500+0000",
                    "started": "2019-10-17T20:02:19.499+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "330112",
                    "issueId": "13262042"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13262042/worklog/330119",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "wesm commented on pull request #5687: ARROW-6869: [C++] Do not return invalid arrays from DictionaryBuilder::Finish when reusing builder. Add \"FinishDelta\" method and \"ResetFull\" method\nURL: https://github.com/apache/arrow/pull/5687#discussion_r336206328\n \n \n\n ##########\n File path: cpp/src/arrow/array/builder_dict.h\n ##########\n @@ -244,28 +246,26 @@ class DictionaryBuilderBase : public ArrayBuilder {\n     return Status::OK();\n   }\n \n-  Status FinishInternal(std::shared_ptr<ArrayData>* out) override {\n-    // Finalize indices array\n-    ARROW_RETURN_NOT_OK(indices_builder_.FinishInternal(out));\n+  /// \\brief Return dictionary indices and a delta dictionary since the last\n+  /// time that Finish or FinishDelta were called, and reset state of builder\n+  /// (except the memo table)\n+  Status FinishDelta(std::shared_ptr<Array>* out_indices,\n+                     std::shared_ptr<Array>* out_delta) {\n+    std::shared_ptr<Array> dictionary;\n+    std::shared_ptr<ArrayData> indices_data;\n+    ARROW_RETURN_NOT_OK(FinishWithDictOffset(delta_offset_, &indices_data, out_delta));\n \n-    // Generate dictionary array from hash table contents\n-    std::shared_ptr<ArrayData> dictionary_data;\n+    *out_indices = MakeArray(indices_data);\n+    return Status::OK();\n+  }\n \n-    ARROW_RETURN_NOT_OK(\n-        memo_table_->GetArrayData(pool_, delta_offset_, &dictionary_data));\n+  Status FinishInternal(std::shared_ptr<ArrayData>* out) override {\n \n Review comment:\n   yes, fixed\n \n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2019-10-17T20:25:51.533+0000",
                    "updated": "2019-10-17T20:25:51.533+0000",
                    "started": "2019-10-17T20:25:51.532+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "330119",
                    "issueId": "13262042"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13262042/worklog/330120",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "wesm commented on pull request #5687: ARROW-6869: [C++] Do not return invalid arrays from DictionaryBuilder::Finish when reusing builder. Add \"FinishDelta\" method and \"ResetFull\" method\nURL: https://github.com/apache/arrow/pull/5687#discussion_r336208640\n \n \n\n ##########\n File path: cpp/src/arrow/array_dict_test.cc\n ##########\n @@ -336,9 +320,34 @@ TYPED_TEST(TestDictionaryBuilder, FinishResetBehavior) {\n \n   ASSERT_OK(builder.Finish(&result));\n \n-  // Dictionary has 4 elements because the dictionary memo was not reset. This\n-  // behavior will change after ARROW-6869\n-  ASSERT_EQ(2, static_cast<const DictionaryArray&>(*result).dictionary()->length());\n+  // Dictionary has 4 elements because the dictionary memo was not reset\n+  ASSERT_EQ(4, static_cast<const DictionaryArray&>(*result).dictionary()->length());\n+}\n+\n+TYPED_TEST(TestDictionaryBuilder, ResetFull) {\n+  using c_type = typename TypeParam::c_type;\n+  auto type = std::make_shared<TypeParam>();\n+\n+  Dictionary32Builder<TypeParam> builder;\n+\n+  ASSERT_OK(builder.Append(static_cast<c_type>(1)));\n+  ASSERT_OK(builder.AppendNull());\n+  ASSERT_OK(builder.Append(static_cast<c_type>(1)));\n+  ASSERT_OK(builder.Append(static_cast<c_type>(2)));\n+\n+  std::shared_ptr<Array> result;\n+  ASSERT_OK(builder.Finish(&result));\n+\n+  ASSERT_OK(builder.Append(static_cast<c_type>(3)));\n+  ASSERT_OK(builder.Finish(&result));\n+\n+  // Dictionary expanded\n+  ASSERT_EQ(3, static_cast<const DictionaryArray&>(*result).dictionary()->length());\n \n Review comment:\n   done\n \n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2019-10-17T20:25:51.536+0000",
                    "updated": "2019-10-17T20:25:51.536+0000",
                    "started": "2019-10-17T20:25:51.536+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "330120",
                    "issueId": "13262042"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13262042/worklog/330121",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "wesm commented on pull request #5687: ARROW-6869: [C++] Do not return invalid arrays from DictionaryBuilder::Finish when reusing builder. Add \"FinishDelta\" method and \"ResetFull\" method\nURL: https://github.com/apache/arrow/pull/5687#discussion_r336208658\n \n \n\n ##########\n File path: cpp/src/arrow/array_dict_test.cc\n ##########\n @@ -336,9 +320,34 @@ TYPED_TEST(TestDictionaryBuilder, FinishResetBehavior) {\n \n   ASSERT_OK(builder.Finish(&result));\n \n-  // Dictionary has 4 elements because the dictionary memo was not reset. This\n-  // behavior will change after ARROW-6869\n-  ASSERT_EQ(2, static_cast<const DictionaryArray&>(*result).dictionary()->length());\n+  // Dictionary has 4 elements because the dictionary memo was not reset\n+  ASSERT_EQ(4, static_cast<const DictionaryArray&>(*result).dictionary()->length());\n+}\n+\n+TYPED_TEST(TestDictionaryBuilder, ResetFull) {\n+  using c_type = typename TypeParam::c_type;\n+  auto type = std::make_shared<TypeParam>();\n+\n+  Dictionary32Builder<TypeParam> builder;\n+\n+  ASSERT_OK(builder.Append(static_cast<c_type>(1)));\n+  ASSERT_OK(builder.AppendNull());\n+  ASSERT_OK(builder.Append(static_cast<c_type>(1)));\n+  ASSERT_OK(builder.Append(static_cast<c_type>(2)));\n+\n+  std::shared_ptr<Array> result;\n+  ASSERT_OK(builder.Finish(&result));\n+\n+  ASSERT_OK(builder.Append(static_cast<c_type>(3)));\n+  ASSERT_OK(builder.Finish(&result));\n+\n+  // Dictionary expanded\n+  ASSERT_EQ(3, static_cast<const DictionaryArray&>(*result).dictionary()->length());\n+\n+  builder.ResetFull();\n+  ASSERT_OK(builder.Append(static_cast<c_type>(4)));\n+  ASSERT_OK(builder.Finish(&result));\n+  ASSERT_EQ(1, static_cast<const DictionaryArray&>(*result).dictionary()->length());\n \n Review comment:\n   done\n \n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2019-10-17T20:25:51.536+0000",
                    "updated": "2019-10-17T20:25:51.536+0000",
                    "started": "2019-10-17T20:25:51.536+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "330121",
                    "issueId": "13262042"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13262042/worklog/330122",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "wesm commented on pull request #5687: ARROW-6869: [C++] Do not return invalid arrays from DictionaryBuilder::Finish when reusing builder. Add \"FinishDelta\" method and \"ResetFull\" method\nURL: https://github.com/apache/arrow/pull/5687#discussion_r336204859\n \n \n\n ##########\n File path: cpp/src/arrow/array/builder_dict.h\n ##########\n @@ -230,10 +226,16 @@ class DictionaryBuilderBase : public ArrayBuilder {\n   }\n \n   void Reset() override {\n+    // Perform a partial reset. Also call ResetDictionary to reset the\n \n Review comment:\n   Yes, fixed\n \n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2019-10-17T20:25:51.536+0000",
                    "updated": "2019-10-17T20:25:51.536+0000",
                    "started": "2019-10-17T20:25:51.536+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "330122",
                    "issueId": "13262042"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13262042/worklog/330123",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "wesm commented on pull request #5687: ARROW-6869: [C++] Do not return invalid arrays from DictionaryBuilder::Finish when reusing builder. Add \"FinishDelta\" method and \"ResetFull\" method\nURL: https://github.com/apache/arrow/pull/5687#discussion_r336204973\n \n \n\n ##########\n File path: cpp/src/arrow/array/builder_dict.h\n ##########\n @@ -244,28 +246,26 @@ class DictionaryBuilderBase : public ArrayBuilder {\n     return Status::OK();\n   }\n \n-  Status FinishInternal(std::shared_ptr<ArrayData>* out) override {\n-    // Finalize indices array\n-    ARROW_RETURN_NOT_OK(indices_builder_.FinishInternal(out));\n+  /// \\brief Return dictionary indices and a delta dictionary since the last\n+  /// time that Finish or FinishDelta were called, and reset state of builder\n+  /// (except the memo table)\n+  Status FinishDelta(std::shared_ptr<Array>* out_indices,\n+                     std::shared_ptr<Array>* out_delta) {\n+    std::shared_ptr<Array> dictionary;\n \n Review comment:\n   fixed\n \n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2019-10-17T20:25:51.588+0000",
                    "updated": "2019-10-17T20:25:51.588+0000",
                    "started": "2019-10-17T20:25:51.588+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "330123",
                    "issueId": "13262042"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13262042/worklog/330504",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "wesm commented on pull request #5687: ARROW-6869: [C++] Do not return invalid arrays from DictionaryBuilder::Finish when reusing builder. Add \"FinishDelta\" method and \"ResetFull\" method\nURL: https://github.com/apache/arrow/pull/5687\n \n \n   \n \n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2019-10-18T13:50:43.104+0000",
                    "updated": "2019-10-18T13:50:43.104+0000",
                    "started": "2019-10-18T13:50:43.104+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "330504",
                    "issueId": "13262042"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13262042/worklog/330505",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "wesm commented on issue #5687: ARROW-6869: [C++] Do not return invalid arrays from DictionaryBuilder::Finish when reusing builder. Add \"FinishDelta\" method and \"ResetFull\" method\nURL: https://github.com/apache/arrow/pull/5687#issuecomment-543757062\n \n \n   I've marked this with 0.15.1 (since it's buggy) but if others disagree about including it, I am OK with that\n \n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2019-10-18T13:51:38.135+0000",
                    "updated": "2019-10-18T13:51:38.135+0000",
                    "started": "2019-10-18T13:51:38.135+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "330505",
                    "issueId": "13262042"
                }
            ]
        },
        "customfield_12313920": null,
        "issuetype": {
            "self": "https://issues.apache.org/jira/rest/api/2/issuetype/1",
            "id": "1",
            "description": "A problem which impairs or prevents the functions of the product.",
            "iconUrl": "https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype",
            "name": "Bug",
            "subtask": false,
            "avatarId": 21133
        },
        "timespent": 6000,
        "customfield_12314020": "{summaryBean=com.atlassian.jira.plugin.devstatus.rest.SummaryBean@225ea6c5[summary={pullrequest=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@6a0a4f66[overall=PullRequestOverallBean{stateCount=0, state='OPEN', details=PullRequestOverallDetails{openCount=0, mergedCount=0, declinedCount=0}},byInstanceType={}], build=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@774b87b[overall=com.atlassian.jira.plugin.devstatus.summary.beans.BuildOverallBean@3f3db68c[failedBuildCount=0,successfulBuildCount=0,unknownBuildCount=0,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], review=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@20165ccf[overall=com.atlassian.jira.plugin.devstatus.summary.beans.ReviewsOverallBean@2a76bee8[stateCount=0,state=<null>,dueDate=<null>,overDue=false,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], deployment-environment=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@8637cbd[overall=com.atlassian.jira.plugin.devstatus.summary.beans.DeploymentOverallBean@5a3822eb[topEnvironments=[],showProjects=false,successfulCount=0,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], repository=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@485aed47[overall=com.atlassian.jira.plugin.devstatus.summary.beans.CommitOverallBean@57c49b5a[count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], branch=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@4451838b[overall=com.atlassian.jira.plugin.devstatus.summary.beans.BranchOverallBean@5f65de90[count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}]},errors=[],configErrors=[]], devSummaryJson={\"cachedValue\":{\"errors\":[],\"configErrors\":[],\"summary\":{\"pullrequest\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"stateCount\":0,\"state\":\"OPEN\",\"details\":{\"openCount\":0,\"mergedCount\":0,\"declinedCount\":0,\"total\":0},\"open\":true},\"byInstanceType\":{}},\"build\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"failedBuildCount\":0,\"successfulBuildCount\":0,\"unknownBuildCount\":0},\"byInstanceType\":{}},\"review\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"stateCount\":0,\"state\":null,\"dueDate\":null,\"overDue\":false,\"completed\":false},\"byInstanceType\":{}},\"deployment-environment\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"topEnvironments\":[],\"showProjects\":false,\"successfulCount\":0},\"byInstanceType\":{}},\"repository\":{\"overall\":{\"count\":0,\"lastUpdated\":null},\"byInstanceType\":{}},\"branch\":{\"overall\":{\"count\":0,\"lastUpdated\":null},\"byInstanceType\":{}}}},\"isStale\":false}}",
        "customfield_12314141": null,
        "customfield_12314140": null,
        "project": {
            "self": "https://issues.apache.org/jira/rest/api/2/project/12319525",
            "id": "12319525",
            "key": "ARROW",
            "name": "Apache Arrow",
            "projectTypeKey": "software",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/projectavatar?pid=12319525&avatarId=10011",
                "24x24": "https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12319525&avatarId=10011",
                "16x16": "https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12319525&avatarId=10011",
                "32x32": "https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12319525&avatarId=10011"
            },
            "projectCategory": {
                "self": "https://issues.apache.org/jira/rest/api/2/projectCategory/13960",
                "id": "13960",
                "description": "Apache Arrow",
                "name": "Arrow"
            }
        },
        "aggregatetimespent": 6000,
        "customfield_12312520": null,
        "customfield_12312521": "Fri Oct 18 13:50:53 UTC 2019",
        "customfield_12314422": null,
        "customfield_12314421": null,
        "customfield_12314146": null,
        "customfield_12314420": null,
        "customfield_12314145": null,
        "customfield_12314144": null,
        "customfield_12314143": null,
        "resolutiondate": "2019-10-18T13:50:53.000+0000",
        "workratio": -1,
        "customfield_12312923": null,
        "customfield_12312920": null,
        "customfield_12312921": null,
        "watches": {
            "self": "https://issues.apache.org/jira/rest/api/2/issue/ARROW-6869/watchers",
            "watchCount": 1,
            "isWatching": false
        },
        "created": "2019-10-14T01:19:06.000+0000",
        "updated": "2019-10-18T13:51:38.000+0000",
        "timeoriginalestimate": null,
        "description": "Looking at the unit tests for the dictionary delta logic -- the arrays that are produced by subsequent invocations of {{Finish}} yield DictionaryArray instances with partial dictionaries. I think this is misleading (I was surprised to find this while working on ARROW-6861). We should develop a different approach to computing dictionary delta. ",
        "customfield_10010": null,
        "timetracking": {
            "remainingEstimate": "0h",
            "timeSpent": "1h 40m",
            "remainingEstimateSeconds": 0,
            "timeSpentSeconds": 6000
        },
        "customfield_12314523": null,
        "customfield_12314127": null,
        "customfield_12314522": null,
        "customfield_12314126": null,
        "customfield_12314521": null,
        "customfield_12314125": null,
        "customfield_12314520": null,
        "customfield_12314124": null,
        "attachment": [],
        "customfield_12312340": null,
        "customfield_12314123": null,
        "customfield_12312341": null,
        "customfield_12312220": null,
        "customfield_12314122": null,
        "customfield_12314121": null,
        "customfield_12314120": null,
        "customfield_12314129": null,
        "customfield_12314524": null,
        "customfield_12314128": null,
        "summary": "[C++] Dictionary \"delta\" building logic in builder_dict.h produces invalid arrays",
        "customfield_12314130": null,
        "customfield_12310291": null,
        "customfield_12310290": null,
        "customfield_12314138": null,
        "customfield_12314137": null,
        "environment": null,
        "customfield_12314136": null,
        "customfield_12314135": null,
        "customfield_12311020": null,
        "customfield_12314134": null,
        "duedate": null,
        "customfield_12314132": null,
        "customfield_12314131": null,
        "comment": {
            "comments": [
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13262042/comment/16950653",
                    "id": "16950653",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=wesm",
                        "name": "wesm",
                        "key": "wesmckinn",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=wesmckinn&avatarId=29931",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=wesmckinn&avatarId=29931",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=wesmckinn&avatarId=29931",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=wesmckinn&avatarId=29931"
                        },
                        "displayName": "Wes McKinney",
                        "active": true,
                        "timeZone": "America/New_York"
                    },
                    "body": "cc [~alendit]",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=wesm",
                        "name": "wesm",
                        "key": "wesmckinn",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=wesmckinn&avatarId=29931",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=wesmckinn&avatarId=29931",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=wesmckinn&avatarId=29931",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=wesmckinn&avatarId=29931"
                        },
                        "displayName": "Wes McKinney",
                        "active": true,
                        "timeZone": "America/New_York"
                    },
                    "created": "2019-10-14T01:37:04.453+0000",
                    "updated": "2019-10-14T01:37:04.453+0000"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13262042/comment/16954629",
                    "id": "16954629",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=wesm",
                        "name": "wesm",
                        "key": "wesmckinn",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=wesmckinn&avatarId=29931",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=wesmckinn&avatarId=29931",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=wesmckinn&avatarId=29931",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=wesmckinn&avatarId=29931"
                        },
                        "displayName": "Wes McKinney",
                        "active": true,
                        "timeZone": "America/New_York"
                    },
                    "body": "Issue resolved by pull request 5687\n[https://github.com/apache/arrow/pull/5687]",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=wesm",
                        "name": "wesm",
                        "key": "wesmckinn",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=wesmckinn&avatarId=29931",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=wesmckinn&avatarId=29931",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=wesmckinn&avatarId=29931",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=wesmckinn&avatarId=29931"
                        },
                        "displayName": "Wes McKinney",
                        "active": true,
                        "timeZone": "America/New_York"
                    },
                    "created": "2019-10-18T13:50:53.249+0000",
                    "updated": "2019-10-18T13:50:53.249+0000"
                }
            ],
            "maxResults": 2,
            "total": 2,
            "startAt": 0
        },
        "customfield_12311820": "0|z07jtk:",
        "customfield_12314139": null
    }
}