{
    "expand": "operations,versionedRepresentations,editmeta,changelog,renderedFields",
    "id": "13357673",
    "self": "https://issues.apache.org/jira/rest/api/2/issue/13357673",
    "key": "ARROW-11567",
    "fields": {
        "fixVersions": [
            {
                "self": "https://issues.apache.org/jira/rest/api/2/version/12349493",
                "id": "12349493",
                "description": "",
                "name": "4.0.0",
                "archived": false,
                "released": true,
                "releaseDate": "2021-04-26"
            }
        ],
        "resolution": {
            "self": "https://issues.apache.org/jira/rest/api/2/resolution/1",
            "id": "1",
            "description": "A fix for this issue is checked into the tree and tested.",
            "name": "Fixed"
        },
        "customfield_12312322": null,
        "customfield_12312323": null,
        "customfield_12312320": null,
        "customfield_12310420": "9223372036854775807",
        "customfield_12312321": null,
        "customfield_12312328": null,
        "customfield_12312329": null,
        "customfield_12312326": null,
        "customfield_12310300": null,
        "customfield_12312327": null,
        "customfield_12312324": null,
        "customfield_12312720": null,
        "customfield_12312325": null,
        "lastViewed": null,
        "priority": {
            "self": "https://issues.apache.org/jira/rest/api/2/priority/3",
            "iconUrl": "https://issues.apache.org/jira/images/icons/priorities/major.svg",
            "name": "Major",
            "id": "3"
        },
        "labels": [
            "pull-request-available"
        ],
        "customfield_12312333": null,
        "customfield_12312334": null,
        "customfield_12313422": "false",
        "customfield_12310310": "0.0",
        "customfield_12312331": null,
        "customfield_12312332": null,
        "aggregatetimeoriginalestimate": null,
        "timeestimate": 0,
        "customfield_12312330": null,
        "versions": [
            {
                "self": "https://issues.apache.org/jira/rest/api/2/version/12348823",
                "id": "12348823",
                "description": "",
                "name": "3.0.0",
                "archived": false,
                "released": true,
                "releaseDate": "2021-01-25"
            }
        ],
        "customfield_12311120": null,
        "customfield_12313826": null,
        "customfield_12312339": null,
        "issuelinks": [
            {
                "id": "12609198",
                "self": "https://issues.apache.org/jira/rest/api/2/issueLink/12609198",
                "type": {
                    "id": "10030",
                    "name": "Reference",
                    "inward": "is related to",
                    "outward": "relates to",
                    "self": "https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"
                },
                "inwardIssue": {
                    "id": "13360514",
                    "key": "ARROW-11758",
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13360514",
                    "fields": {
                        "summary": "[C++][Compute] Summation kernel round-off error",
                        "status": {
                            "self": "https://issues.apache.org/jira/rest/api/2/status/5",
                            "description": "A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.",
                            "iconUrl": "https://issues.apache.org/jira/images/icons/statuses/resolved.png",
                            "name": "Resolved",
                            "id": "5",
                            "statusCategory": {
                                "self": "https://issues.apache.org/jira/rest/api/2/statuscategory/3",
                                "id": 3,
                                "key": "done",
                                "colorName": "green",
                                "name": "Done"
                            }
                        },
                        "priority": {
                            "self": "https://issues.apache.org/jira/rest/api/2/priority/3",
                            "iconUrl": "https://issues.apache.org/jira/images/icons/priorities/major.svg",
                            "name": "Major",
                            "id": "3"
                        },
                        "issuetype": {
                            "self": "https://issues.apache.org/jira/rest/api/2/issuetype/1",
                            "id": "1",
                            "description": "A problem which impairs or prevents the functions of the product.",
                            "iconUrl": "https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype",
                            "name": "Bug",
                            "subtask": false,
                            "avatarId": 21133
                        }
                    }
                }
            }
        ],
        "customfield_12313825": null,
        "assignee": {
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=yibocai",
            "name": "yibocai",
            "key": "yibo",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=yibo&avatarId=47542",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=yibo&avatarId=47542",
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=yibo&avatarId=47542",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=yibo&avatarId=47542"
            },
            "displayName": "Yibo Cai",
            "active": true,
            "timeZone": "Etc/UTC"
        },
        "customfield_12312337": null,
        "customfield_12313823": null,
        "customfield_12312338": null,
        "customfield_12311920": null,
        "customfield_12313822": null,
        "customfield_12312335": null,
        "customfield_12313821": null,
        "customfield_12312336": null,
        "customfield_12313820": null,
        "status": {
            "self": "https://issues.apache.org/jira/rest/api/2/status/5",
            "description": "A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.",
            "iconUrl": "https://issues.apache.org/jira/images/icons/statuses/resolved.png",
            "name": "Resolved",
            "id": "5",
            "statusCategory": {
                "self": "https://issues.apache.org/jira/rest/api/2/statuscategory/3",
                "id": 3,
                "key": "done",
                "colorName": "green",
                "name": "Done"
            }
        },
        "components": [
            {
                "self": "https://issues.apache.org/jira/rest/api/2/component/12328935",
                "id": "12328935",
                "name": "C++"
            }
        ],
        "customfield_12312026": null,
        "customfield_12312023": null,
        "customfield_12312024": null,
        "aggregatetimeestimate": 0,
        "customfield_12312022": null,
        "customfield_12310921": null,
        "customfield_12310920": "9223372036854775807",
        "customfield_12312823": null,
        "creator": {
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=yibocai",
            "name": "yibocai",
            "key": "yibo",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=yibo&avatarId=47542",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=yibo&avatarId=47542",
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=yibo&avatarId=47542",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=yibo&avatarId=47542"
            },
            "displayName": "Yibo Cai",
            "active": true,
            "timeZone": "Etc/UTC"
        },
        "subtasks": [],
        "reporter": {
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=yibocai",
            "name": "yibocai",
            "key": "yibo",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=yibo&avatarId=47542",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=yibo&avatarId=47542",
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=yibo&avatarId=47542",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=yibo&avatarId=47542"
            },
            "displayName": "Yibo Cai",
            "active": true,
            "timeZone": "Etc/UTC"
        },
        "aggregateprogress": {
            "progress": 6000,
            "total": 6000,
            "percent": 100
        },
        "customfield_12313520": null,
        "customfield_12310250": null,
        "progress": {
            "progress": 6000,
            "total": 6000,
            "percent": 100
        },
        "customfield_12313924": null,
        "votes": {
            "self": "https://issues.apache.org/jira/rest/api/2/issue/ARROW-11567/votes",
            "votes": 0,
            "hasVoted": false
        },
        "worklog": {
            "startAt": 0,
            "maxResults": 20,
            "total": 10,
            "worklogs": [
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13357673/worklog/559287",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "cyb70289 opened a new pull request #9604:\nURL: https://github.com/apache/arrow/pull/9604\n\n\n   Variance kernel suffers from round-off errors due to naive summation.\r\n   This patch implements pairwise summation algorithm to improve variance\r\n   kernel precision.\r\n   \r\n   Pairwise summation also results to better performance for normal cases.\r\n   - ~1x improvement for 0.01%, 0% null count\r\n   - moderate improvement for 1% null count\r\n   - ~0.5x drop for 10%, 50% null count\n\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2021-03-01T09:31:52.952+0000",
                    "updated": "2021-03-01T09:31:52.952+0000",
                    "started": "2021-03-01T09:31:52.952+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "559287",
                    "issueId": "13357673"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13357673/worklog/559288",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "cyb70289 commented on pull request #9604:\nURL: https://github.com/apache/arrow/pull/9604#issuecomment-787804449\n\n\n   Besides better accuracy, pairwise summation also improves performance significantly for normal cases.\r\n   - big improvement (~1x) for 0.01%, 0% null count\r\n   - moderate improvement for 1% null count\r\n   - big drop (~0.5x) for 10%, 50% null count (due to short continuous data blocks)\r\n   \r\n   Benchmark result on skylake, clang-9 (removed Int32 benchs as they're not touched)\r\n   \r\n   ```\r\n   Before\r\n   ---------------------------------------------------------------------------------------------\r\n   Benchmark                                   Time             CPU   Iterations UserCounters...\r\n   ---------------------------------------------------------------------------------------------\r\n   VarianceKernelInt64/1048576/10000         201 us          201 us         3479 bytes_per_second=4.85858G/s null_percent=0.01 size=1048.58k\r\n   VarianceKernelInt64/1048576/100           235 us          235 us         2983 bytes_per_second=4.15903G/s null_percent=1 size=1048.58k\r\n   VarianceKernelInt64/1048576/10            515 us          515 us         1362 bytes_per_second=1.89616G/s null_percent=10 size=1048.58k\r\n   VarianceKernelInt64/1048576/2             826 us          825 us          848 bytes_per_second=1.18306G/s null_percent=50 size=1048.58k\r\n   VarianceKernelInt64/1048576/1           0.866 us        0.866 us       806079 bytes_per_second=1.10133T/s null_percent=100 size=1048.58k\r\n   VarianceKernelInt64/1048576/0             186 us          186 us         3766 bytes_per_second=5.23785G/s null_percent=0 size=1048.58k\r\n   \r\n   VarianceKernelFloat/1048576/10000         549 us          549 us         1274 bytes_per_second=1.77922G/s null_percent=0.01 size=1048.58k\r\n   VarianceKernelFloat/1048576/100           579 us          579 us         1208 bytes_per_second=1.68558G/s null_percent=1 size=1048.58k\r\n   VarianceKernelFloat/1048576/10           1040 us         1040 us          673 bytes_per_second=961.64M/s null_percent=10 size=1048.58k\r\n   VarianceKernelFloat/1048576/2            1650 us         1650 us          424 bytes_per_second=606.079M/s null_percent=50 size=1048.58k\r\n   VarianceKernelFloat/1048576/1           0.876 us        0.876 us       775800 bytes_per_second=1115.15G/s null_percent=100 size=1048.58k\r\n   VarianceKernelFloat/1048576/0             541 us          541 us         1294 bytes_per_second=1.80506G/s null_percent=0 size=1048.58k\r\n   \r\n   VarianceKernelDouble/1048576/10000        275 us          275 us         2543 bytes_per_second=3.54668G/s null_percent=0.01 size=1048.58k\r\n   VarianceKernelDouble/1048576/100          277 us          277 us         2530 bytes_per_second=3.52828G/s null_percent=1 size=1048.58k\r\n   VarianceKernelDouble/1048576/10           500 us          500 us         1397 bytes_per_second=1.95315G/s null_percent=10 size=1048.58k\r\n   VarianceKernelDouble/1048576/2            793 us          793 us          884 bytes_per_second=1.23201G/s null_percent=50 size=1048.58k\r\n   VarianceKernelDouble/1048576/1          0.894 us        0.894 us       765871 bytes_per_second=1092.23G/s null_percent=100 size=1048.58k\r\n   VarianceKernelDouble/1048576/0            271 us          271 us         2576 bytes_per_second=3.59923G/s null_percent=0 size=1048.58k\r\n   \r\n   \r\n   After\r\n   ---------------------------------------------------------------------------------------------\r\n   Benchmark                                   Time             CPU   Iterations UserCounters...\r\n   ---------------------------------------------------------------------------------------------\r\n   VarianceKernelInt64/1048576/10000         138 us          138 us         5082 bytes_per_second=7.07395G/s null_percent=0.01 size=1048.58k\r\n   VarianceKernelInt64/1048576/100           226 us          226 us         2858 bytes_per_second=4.32355G/s null_percent=1 size=1048.58k\r\n   VarianceKernelInt64/1048576/10            679 us          679 us         1032 bytes_per_second=1.4386G/s null_percent=10 size=1048.58k\r\n   VarianceKernelInt64/1048576/2            1121 us         1121 us          625 bytes_per_second=891.928M/s null_percent=50 size=1048.58k\r\n   VarianceKernelInt64/1048576/1           0.835 us        0.835 us       815343 bytes_per_second=1.14166T/s null_percent=100 size=1048.58k\r\n   VarianceKernelInt64/1048576/0             165 us          165 us         5278 bytes_per_second=5.91169G/s null_percent=0 size=1048.58k\r\n   \r\n   VarianceKernelFloat/1048576/10000         333 us          333 us         2103 bytes_per_second=2.93102G/s null_percent=0.01 size=1048.58k\r\n   VarianceKernelFloat/1048576/100           550 us          550 us         1272 bytes_per_second=1.77448G/s null_percent=1 size=1048.58k\r\n   VarianceKernelFloat/1048576/10           1699 us         1699 us          412 bytes_per_second=588.556M/s null_percent=10 size=1048.58k\r\n   VarianceKernelFloat/1048576/2            2788 us         2788 us          251 bytes_per_second=358.73M/s null_percent=50 size=1048.58k\r\n   VarianceKernelFloat/1048576/1           0.878 us        0.878 us       831430 bytes_per_second=1112.44G/s null_percent=100 size=1048.58k\r\n   VarianceKernelFloat/1048576/0             327 us          327 us         2164 bytes_per_second=2.98677G/s null_percent=0 size=1048.58k\r\n   \r\n   VarianceKernelDouble/1048576/10000        121 us          121 us         5785 bytes_per_second=8.05841G/s null_percent=0.01 size=1048.58k\r\n   VarianceKernelDouble/1048576/100          222 us          222 us         3145 bytes_per_second=4.40277G/s null_percent=1 size=1048.58k\r\n   VarianceKernelDouble/1048576/10           789 us          789 us          887 bytes_per_second=1.23705G/s null_percent=10 size=1048.58k\r\n   VarianceKernelDouble/1048576/2           1428 us         1428 us          490 bytes_per_second=700.099M/s null_percent=50 size=1048.58k\r\n   VarianceKernelDouble/1048576/1          0.853 us        0.853 us       827831 bytes_per_second=1.11828T/s null_percent=100 size=1048.58k\r\n   VarianceKernelDouble/1048576/0            140 us          140 us         5986 bytes_per_second=6.97951G/s null_percent=0 size=1048.58k\r\n   ```\n\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2021-03-01T09:32:42.613+0000",
                    "updated": "2021-03-01T09:32:42.613+0000",
                    "started": "2021-03-01T09:32:42.613+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "559288",
                    "issueId": "13357673"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13357673/worklog/559378",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "pitrou commented on a change in pull request #9604:\nURL: https://github.com/apache/arrow/pull/9604#discussion_r584720949\n\n\n\n##########\nFile path: cpp/src/arrow/compute/kernels/aggregate_var_std.cc\n##########\n@@ -30,6 +30,96 @@ namespace internal {\n namespace {\n \n using arrow::internal::int128_t;\n+using arrow::internal::VisitSetBitRunsVoid;\n+\n+// non-recursive pairwise summation for floating points\n+// https://en.wikipedia.org/wiki/Pairwise_summation\n+template <typename ValueType, typename SumType, typename ValueFunc>\n+enable_if_t<std::is_floating_point<SumType>::value, SumType> SumArray(\n+    const ArrayData& data, ValueFunc&& func) {\n+  const int64_t data_size = data.length - data.GetNullCount();\n+  if (data_size == 0) {\n+    return 0;\n+  }\n+\n+  // number of inputs to accumulate before merging with another block\n+  constexpr int kBlockSize = 16;  // same as numpy\n+  // levels (tree depth) = ceil(log2(len)) + 1, a bit larger than necessary\n+  const int levels = BitUtil::Log2(static_cast<uint64_t>(data_size)) + 1;\n+  // temporary summation per level\n+  std::vector<SumType> sum(levels);\n+  // whether two summations are ready and should be reduced to upper level\n+  // one bit for each level, bit0 -> level0, ...\n+  uint64_t mask = 0;\n+  // level of root node holding the final summation\n+  int root_level = 0;\n+\n+  // reduce summation of one block (may be smaller than kBlockSize) from leaf node\n+  // continue reducing to upper level if two summations are ready for non-leaf node\n+  auto reduce = [&](SumType block_sum) {\n+    int cur_level = 0;\n+    uint64_t cur_level_mask = 1ULL;\n+    sum[cur_level] += block_sum;\n+    mask ^= cur_level_mask;\n+    while ((mask & cur_level_mask) == 0) {\n+      block_sum = sum[cur_level];\n+      sum[cur_level] = 0;\n+      ++cur_level;\n+      DCHECK_LT(cur_level, levels);\n+      cur_level_mask <<= 1;\n+      sum[cur_level] += block_sum;\n+      mask ^= cur_level_mask;\n+    }\n+    root_level = std::max(root_level, cur_level);\n+  };\n+\n+  const ValueType* values = data.GetValues<ValueType>(1);\n+  VisitSetBitRunsVoid(data.buffers[0], data.offset, data.length,\n+                      [&](int64_t pos, int64_t len) {\n+                        const ValueType* v = &values[pos];\n+                        const int64_t blocks = len / kBlockSize;\n+                        const int64_t remains = len % kBlockSize;\n\nReview comment:\n       If you're interested in performance, note that signed division and modulo are more complicated than a simple shift or mask:\r\n   https://godbolt.org/z/MTz7eM\n\n##########\nFile path: cpp/src/arrow/compute/kernels/aggregate_test.cc\n##########\n@@ -1205,6 +1205,21 @@ TEST_F(TestVarStdKernelMergeStability, Basics) {\n #endif\n }\n \n+// Test round-off error\n+class TestVarStdKernelRoundOff : public TestPrimitiveVarStdKernel<DoubleType> {};\n+\n+TEST_F(TestVarStdKernelRoundOff, Basics) {\n+  // build array: np.arange(321000, dtype='float64')\n+  double value = 0;\n+  ASSERT_OK_AND_ASSIGN(\n+      auto array, ArrayFromBuilderVisitor(float64(), 321000, [&](DoubleBuilder* builder) {\n+        builder->UnsafeAppend(value++);\n+      }));\n+\n+  // reference value from numpy.var()\n+  this->AssertVarStdIs(*array, VarianceOptions{0}, 8586749999.916667);\n+}\n\nReview comment:\n       Should we have a similar test for `float32` as well?\n\n\n\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2021-03-01T13:47:21.410+0000",
                    "updated": "2021-03-01T13:47:21.410+0000",
                    "started": "2021-03-01T13:47:21.409+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "559378",
                    "issueId": "13357673"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13357673/worklog/559384",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "cyb70289 commented on a change in pull request #9604:\nURL: https://github.com/apache/arrow/pull/9604#discussion_r584732087\n\n\n\n##########\nFile path: cpp/src/arrow/compute/kernels/aggregate_var_std.cc\n##########\n@@ -30,6 +30,96 @@ namespace internal {\n namespace {\n \n using arrow::internal::int128_t;\n+using arrow::internal::VisitSetBitRunsVoid;\n+\n+// non-recursive pairwise summation for floating points\n+// https://en.wikipedia.org/wiki/Pairwise_summation\n+template <typename ValueType, typename SumType, typename ValueFunc>\n+enable_if_t<std::is_floating_point<SumType>::value, SumType> SumArray(\n+    const ArrayData& data, ValueFunc&& func) {\n+  const int64_t data_size = data.length - data.GetNullCount();\n+  if (data_size == 0) {\n+    return 0;\n+  }\n+\n+  // number of inputs to accumulate before merging with another block\n+  constexpr int kBlockSize = 16;  // same as numpy\n+  // levels (tree depth) = ceil(log2(len)) + 1, a bit larger than necessary\n+  const int levels = BitUtil::Log2(static_cast<uint64_t>(data_size)) + 1;\n+  // temporary summation per level\n+  std::vector<SumType> sum(levels);\n+  // whether two summations are ready and should be reduced to upper level\n+  // one bit for each level, bit0 -> level0, ...\n+  uint64_t mask = 0;\n+  // level of root node holding the final summation\n+  int root_level = 0;\n+\n+  // reduce summation of one block (may be smaller than kBlockSize) from leaf node\n+  // continue reducing to upper level if two summations are ready for non-leaf node\n+  auto reduce = [&](SumType block_sum) {\n+    int cur_level = 0;\n+    uint64_t cur_level_mask = 1ULL;\n+    sum[cur_level] += block_sum;\n+    mask ^= cur_level_mask;\n+    while ((mask & cur_level_mask) == 0) {\n+      block_sum = sum[cur_level];\n+      sum[cur_level] = 0;\n+      ++cur_level;\n+      DCHECK_LT(cur_level, levels);\n+      cur_level_mask <<= 1;\n+      sum[cur_level] += block_sum;\n+      mask ^= cur_level_mask;\n+    }\n+    root_level = std::max(root_level, cur_level);\n+  };\n+\n+  const ValueType* values = data.GetValues<ValueType>(1);\n+  VisitSetBitRunsVoid(data.buffers[0], data.offset, data.length,\n+                      [&](int64_t pos, int64_t len) {\n+                        const ValueType* v = &values[pos];\n+                        const int64_t blocks = len / kBlockSize;\n+                        const int64_t remains = len % kBlockSize;\n\nReview comment:\n       Ah yes, missed this point, will change to shift/mask.\n\n\n\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2021-03-01T13:59:49.935+0000",
                    "updated": "2021-03-01T13:59:49.935+0000",
                    "started": "2021-03-01T13:59:49.934+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "559384",
                    "issueId": "13357673"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13357673/worklog/559392",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "cyb70289 commented on a change in pull request #9604:\nURL: https://github.com/apache/arrow/pull/9604#discussion_r584741353\n\n\n\n##########\nFile path: cpp/src/arrow/compute/kernels/aggregate_test.cc\n##########\n@@ -1205,6 +1205,21 @@ TEST_F(TestVarStdKernelMergeStability, Basics) {\n #endif\n }\n \n+// Test round-off error\n+class TestVarStdKernelRoundOff : public TestPrimitiveVarStdKernel<DoubleType> {};\n+\n+TEST_F(TestVarStdKernelRoundOff, Basics) {\n+  // build array: np.arange(321000, dtype='float64')\n+  double value = 0;\n+  ASSERT_OK_AND_ASSIGN(\n+      auto array, ArrayFromBuilderVisitor(float64(), 321000, [&](DoubleBuilder* builder) {\n+        builder->UnsafeAppend(value++);\n+      }));\n+\n+  // reference value from numpy.var()\n+  this->AssertVarStdIs(*array, VarianceOptions{0}, 8586749999.916667);\n+}\n\nReview comment:\n       Looks not necessary, as internally `float32` is converted to `double` before calculation, and there's no `float32` summation.\r\n   Will do some tests against numpy to see if additional test is required.\n\n\n\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2021-03-01T14:12:27.366+0000",
                    "updated": "2021-03-01T14:12:27.366+0000",
                    "started": "2021-03-01T14:12:27.366+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "559392",
                    "issueId": "13357673"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13357673/worklog/559836",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "cyb70289 commented on a change in pull request #9604:\nURL: https://github.com/apache/arrow/pull/9604#discussion_r585316069\n\n\n\n##########\nFile path: cpp/src/arrow/compute/kernels/aggregate_test.cc\n##########\n@@ -1205,6 +1205,21 @@ TEST_F(TestVarStdKernelMergeStability, Basics) {\n #endif\n }\n \n+// Test round-off error\n+class TestVarStdKernelRoundOff : public TestPrimitiveVarStdKernel<DoubleType> {};\n+\n+TEST_F(TestVarStdKernelRoundOff, Basics) {\n+  // build array: np.arange(321000, dtype='float64')\n+  double value = 0;\n+  ASSERT_OK_AND_ASSIGN(\n+      auto array, ArrayFromBuilderVisitor(float64(), 321000, [&](DoubleBuilder* builder) {\n+        builder->UnsafeAppend(value++);\n+      }));\n+\n+  // reference value from numpy.var()\n+  this->AssertVarStdIs(*array, VarianceOptions{0}, 8586749999.916667);\n+}\n\nReview comment:\n       Hmm... some difference from numpy. Our variance kernel always returns `double` for any input type. Numpy can select output dtype, by default, it returns `float32` for `float32`, `double` for any other types. https://numpy.org/doc/stable/reference/generated/numpy.var.html\r\n   \r\n   I would prefer always returning `double`. It's simpler and looks more reasonable.\n\n\n\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2021-03-02T07:23:18.229+0000",
                    "updated": "2021-03-02T07:23:18.229+0000",
                    "started": "2021-03-02T07:23:18.229+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "559836",
                    "issueId": "13357673"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13357673/worklog/559837",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "cyb70289 commented on a change in pull request #9604:\nURL: https://github.com/apache/arrow/pull/9604#discussion_r585317366\n\n\n\n##########\nFile path: cpp/src/arrow/compute/kernels/aggregate_var_std.cc\n##########\n@@ -30,6 +30,96 @@ namespace internal {\n namespace {\n \n using arrow::internal::int128_t;\n+using arrow::internal::VisitSetBitRunsVoid;\n+\n+// non-recursive pairwise summation for floating points\n+// https://en.wikipedia.org/wiki/Pairwise_summation\n+template <typename ValueType, typename SumType, typename ValueFunc>\n+enable_if_t<std::is_floating_point<SumType>::value, SumType> SumArray(\n+    const ArrayData& data, ValueFunc&& func) {\n+  const int64_t data_size = data.length - data.GetNullCount();\n+  if (data_size == 0) {\n+    return 0;\n+  }\n+\n+  // number of inputs to accumulate before merging with another block\n+  constexpr int kBlockSize = 16;  // same as numpy\n+  // levels (tree depth) = ceil(log2(len)) + 1, a bit larger than necessary\n+  const int levels = BitUtil::Log2(static_cast<uint64_t>(data_size)) + 1;\n+  // temporary summation per level\n+  std::vector<SumType> sum(levels);\n+  // whether two summations are ready and should be reduced to upper level\n+  // one bit for each level, bit0 -> level0, ...\n+  uint64_t mask = 0;\n+  // level of root node holding the final summation\n+  int root_level = 0;\n+\n+  // reduce summation of one block (may be smaller than kBlockSize) from leaf node\n+  // continue reducing to upper level if two summations are ready for non-leaf node\n+  auto reduce = [&](SumType block_sum) {\n+    int cur_level = 0;\n+    uint64_t cur_level_mask = 1ULL;\n+    sum[cur_level] += block_sum;\n+    mask ^= cur_level_mask;\n+    while ((mask & cur_level_mask) == 0) {\n+      block_sum = sum[cur_level];\n+      sum[cur_level] = 0;\n+      ++cur_level;\n+      DCHECK_LT(cur_level, levels);\n+      cur_level_mask <<= 1;\n+      sum[cur_level] += block_sum;\n+      mask ^= cur_level_mask;\n+    }\n+    root_level = std::max(root_level, cur_level);\n+  };\n+\n+  const ValueType* values = data.GetValues<ValueType>(1);\n+  VisitSetBitRunsVoid(data.buffers[0], data.offset, data.length,\n+                      [&](int64_t pos, int64_t len) {\n+                        const ValueType* v = &values[pos];\n+                        const int64_t blocks = len / kBlockSize;\n+                        const int64_t remains = len % kBlockSize;\n\nReview comment:\n       Changed to unsigned division. Not using shift/mask as kBlockSize may be not 2^n.\n\n\n\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2021-03-02T07:25:55.455+0000",
                    "updated": "2021-03-02T07:25:55.455+0000",
                    "started": "2021-03-02T07:25:55.455+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "559837",
                    "issueId": "13357673"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13357673/worklog/559866",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "pitrou commented on a change in pull request #9604:\nURL: https://github.com/apache/arrow/pull/9604#discussion_r585384019\n\n\n\n##########\nFile path: cpp/src/arrow/compute/kernels/aggregate_test.cc\n##########\n@@ -1205,6 +1205,21 @@ TEST_F(TestVarStdKernelMergeStability, Basics) {\n #endif\n }\n \n+// Test round-off error\n+class TestVarStdKernelRoundOff : public TestPrimitiveVarStdKernel<DoubleType> {};\n+\n+TEST_F(TestVarStdKernelRoundOff, Basics) {\n+  // build array: np.arange(321000, dtype='float64')\n+  double value = 0;\n+  ASSERT_OK_AND_ASSIGN(\n+      auto array, ArrayFromBuilderVisitor(float64(), 321000, [&](DoubleBuilder* builder) {\n+        builder->UnsafeAppend(value++);\n+      }));\n+\n+  // reference value from numpy.var()\n+  this->AssertVarStdIs(*array, VarianceOptions{0}, 8586749999.916667);\n+}\n\nReview comment:\n       I agree that it looks more reasonable.\n\n\n\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2021-03-02T11:33:22.553+0000",
                    "updated": "2021-03-02T11:33:22.553+0000",
                    "started": "2021-03-02T11:33:22.553+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "559866",
                    "issueId": "13357673"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13357673/worklog/559873",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "cyb70289 commented on a change in pull request #9604:\nURL: https://github.com/apache/arrow/pull/9604#discussion_r585420352\n\n\n\n##########\nFile path: cpp/src/arrow/compute/kernels/aggregate_test.cc\n##########\n@@ -1205,6 +1205,21 @@ TEST_F(TestVarStdKernelMergeStability, Basics) {\n #endif\n }\n \n+// Test round-off error\n+class TestVarStdKernelRoundOff : public TestPrimitiveVarStdKernel<DoubleType> {};\n+\n+TEST_F(TestVarStdKernelRoundOff, Basics) {\n+  // build array: np.arange(321000, dtype='float64')\n+  double value = 0;\n+  ASSERT_OK_AND_ASSIGN(\n+      auto array, ArrayFromBuilderVisitor(float64(), 321000, [&](DoubleBuilder* builder) {\n+        builder->UnsafeAppend(value++);\n+      }));\n+\n+  // reference value from numpy.var()\n+  this->AssertVarStdIs(*array, VarianceOptions{0}, 8586749999.916667);\n+}\n\nReview comment:\n       Added float32/int32/int64 round-off test.\n\n\n\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2021-03-02T11:50:31.319+0000",
                    "updated": "2021-03-02T11:50:31.319+0000",
                    "started": "2021-03-02T11:50:31.318+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "559873",
                    "issueId": "13357673"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13357673/worklog/559943",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "pitrou closed pull request #9604:\nURL: https://github.com/apache/arrow/pull/9604\n\n\n   \n\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2021-03-02T13:07:33.735+0000",
                    "updated": "2021-03-02T13:07:33.735+0000",
                    "started": "2021-03-02T13:07:33.735+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "559943",
                    "issueId": "13357673"
                }
            ]
        },
        "customfield_12313920": null,
        "issuetype": {
            "self": "https://issues.apache.org/jira/rest/api/2/issuetype/1",
            "id": "1",
            "description": "A problem which impairs or prevents the functions of the product.",
            "iconUrl": "https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype",
            "name": "Bug",
            "subtask": false,
            "avatarId": 21133
        },
        "timespent": 6000,
        "customfield_12314020": "{summaryBean=com.atlassian.jira.plugin.devstatus.rest.SummaryBean@5f2474b1[summary={pullrequest=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@3c0dca95[overall=PullRequestOverallBean{stateCount=0, state='OPEN', details=PullRequestOverallDetails{openCount=0, mergedCount=0, declinedCount=0}},byInstanceType={}], build=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@3552ea9f[overall=com.atlassian.jira.plugin.devstatus.summary.beans.BuildOverallBean@6759d7c2[failedBuildCount=0,successfulBuildCount=0,unknownBuildCount=0,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], review=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@5f8ff1cc[overall=com.atlassian.jira.plugin.devstatus.summary.beans.ReviewsOverallBean@6ae2147c[stateCount=0,state=<null>,dueDate=<null>,overDue=false,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], deployment-environment=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@48461dad[overall=com.atlassian.jira.plugin.devstatus.summary.beans.DeploymentOverallBean@610834a0[topEnvironments=[],showProjects=false,successfulCount=0,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], repository=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@41a9b8dc[overall=com.atlassian.jira.plugin.devstatus.summary.beans.CommitOverallBean@3b120561[count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], branch=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@43c1ccdb[overall=com.atlassian.jira.plugin.devstatus.summary.beans.BranchOverallBean@63cc4d37[count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}]},errors=[],configErrors=[]], devSummaryJson={\"cachedValue\":{\"errors\":[],\"configErrors\":[],\"summary\":{\"pullrequest\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"stateCount\":0,\"state\":\"OPEN\",\"details\":{\"openCount\":0,\"mergedCount\":0,\"declinedCount\":0,\"total\":0},\"open\":true},\"byInstanceType\":{}},\"build\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"failedBuildCount\":0,\"successfulBuildCount\":0,\"unknownBuildCount\":0},\"byInstanceType\":{}},\"review\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"stateCount\":0,\"state\":null,\"dueDate\":null,\"overDue\":false,\"completed\":false},\"byInstanceType\":{}},\"deployment-environment\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"topEnvironments\":[],\"showProjects\":false,\"successfulCount\":0},\"byInstanceType\":{}},\"repository\":{\"overall\":{\"count\":0,\"lastUpdated\":null},\"byInstanceType\":{}},\"branch\":{\"overall\":{\"count\":0,\"lastUpdated\":null},\"byInstanceType\":{}}}},\"isStale\":false}}",
        "customfield_12314141": null,
        "customfield_12314140": null,
        "project": {
            "self": "https://issues.apache.org/jira/rest/api/2/project/12319525",
            "id": "12319525",
            "key": "ARROW",
            "name": "Apache Arrow",
            "projectTypeKey": "software",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/projectavatar?pid=12319525&avatarId=10011",
                "24x24": "https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12319525&avatarId=10011",
                "16x16": "https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12319525&avatarId=10011",
                "32x32": "https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12319525&avatarId=10011"
            },
            "projectCategory": {
                "self": "https://issues.apache.org/jira/rest/api/2/projectCategory/13960",
                "id": "13960",
                "description": "Apache Arrow",
                "name": "Arrow"
            }
        },
        "aggregatetimespent": 6000,
        "customfield_12312520": null,
        "customfield_12312521": "Tue Mar 02 13:07:22 UTC 2021",
        "customfield_12314422": null,
        "customfield_12314421": null,
        "customfield_12314146": null,
        "customfield_12314420": null,
        "customfield_12314145": null,
        "customfield_12314144": null,
        "customfield_12314143": null,
        "resolutiondate": "2021-03-02T13:07:22.000+0000",
        "workratio": -1,
        "customfield_12312923": null,
        "customfield_12312920": null,
        "customfield_12312921": null,
        "watches": {
            "self": "https://issues.apache.org/jira/rest/api/2/issue/ARROW-11567/watchers",
            "watchCount": 1,
            "isWatching": false
        },
        "created": "2021-02-09T04:33:38.000+0000",
        "updated": "2021-03-02T13:07:34.000+0000",
        "timeoriginalestimate": null,
        "description": "For long arrays, variance kernel is not accurate compared with numpy. See below example.\r\n\r\n{noformat}\r\nIn [1]: import numpy as np\r\n\r\nIn [2]: import pyarrow.compute as pc\r\n\r\nIn [3]: t = np.arange(321000, dtype='float')\r\n\r\nIn [4]: np.var(t)\r\nOut[4]: 8586749999.916667\r\n\r\nIn [5]: pc.variance(t)\r\nOut[5]: <pyarrow.DoubleScalar: 8586749999.899047>\r\n{noformat}",
        "customfield_10010": null,
        "timetracking": {
            "remainingEstimate": "0h",
            "timeSpent": "1h 40m",
            "remainingEstimateSeconds": 0,
            "timeSpentSeconds": 6000
        },
        "customfield_12314523": null,
        "customfield_12314127": null,
        "customfield_12314522": null,
        "customfield_12314126": null,
        "customfield_12314521": null,
        "customfield_12314125": null,
        "customfield_12314520": null,
        "customfield_12314124": null,
        "attachment": [],
        "customfield_12312340": null,
        "customfield_12314123": null,
        "customfield_12312341": null,
        "customfield_12312220": null,
        "customfield_12314122": null,
        "customfield_12314121": null,
        "customfield_12314120": null,
        "customfield_12314129": null,
        "customfield_12314524": null,
        "customfield_12314128": null,
        "summary": "[C++][Compute] Variance kernel has precision issue",
        "customfield_12314130": null,
        "customfield_12310291": null,
        "customfield_12310290": null,
        "customfield_12314138": null,
        "customfield_12314137": null,
        "environment": null,
        "customfield_12314136": null,
        "customfield_12314135": null,
        "customfield_12311020": null,
        "customfield_12314134": null,
        "duedate": null,
        "customfield_12314132": null,
        "customfield_12314131": null,
        "comment": {
            "comments": [
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13357673/comment/17289011",
                    "id": "17289011",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=yibocai",
                        "name": "yibocai",
                        "key": "yibo",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=yibo&avatarId=47542",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=yibo&avatarId=47542",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=yibo&avatarId=47542",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=yibo&avatarId=47542"
                        },
                        "displayName": "Yibo Cai",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "body": "Numpy looks is using pariwise summation algorithm which has better precision.\r\n\r\nnumpy source code:\r\nhttps://github.com/numpy/numpy/blob/ce82028409c1147a6df62d8f7437e0a9262ee2b7/numpy/core/src/umath/loops_utils.h.src#L78\r\n\r\npairwise summation:\r\nhttps://en.wikipedia.org/wiki/Pairwise_summation",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=yibocai",
                        "name": "yibocai",
                        "key": "yibo",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=yibo&avatarId=47542",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=yibo&avatarId=47542",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=yibo&avatarId=47542",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=yibo&avatarId=47542"
                        },
                        "displayName": "Yibo Cai",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "created": "2021-02-23T11:01:17.124+0000",
                    "updated": "2021-02-23T11:01:17.124+0000"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13357673/comment/17293685",
                    "id": "17293685",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=apitrou",
                        "name": "apitrou",
                        "key": "pitrou",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=pitrou&avatarId=35049",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=pitrou&avatarId=35049",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=pitrou&avatarId=35049",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=pitrou&avatarId=35049"
                        },
                        "displayName": "Antoine Pitrou",
                        "active": true,
                        "timeZone": "Europe/Paris"
                    },
                    "body": "Issue resolved by pull request 9604\n[https://github.com/apache/arrow/pull/9604]",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=apitrou",
                        "name": "apitrou",
                        "key": "pitrou",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=pitrou&avatarId=35049",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=pitrou&avatarId=35049",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=pitrou&avatarId=35049",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=pitrou&avatarId=35049"
                        },
                        "displayName": "Antoine Pitrou",
                        "active": true,
                        "timeZone": "Europe/Paris"
                    },
                    "created": "2021-03-02T13:07:22.119+0000",
                    "updated": "2021-03-02T13:07:22.119+0000"
                }
            ],
            "maxResults": 2,
            "total": 2,
            "startAt": 0
        },
        "customfield_12311820": "0|z0nik0:",
        "customfield_12314139": null
    }
}