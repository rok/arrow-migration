{
    "expand": "operations,versionedRepresentations,editmeta,changelog,renderedFields",
    "id": "13468311",
    "self": "https://issues.apache.org/jira/rest/api/2/issue/13468311",
    "key": "ARROW-16901",
    "fields": {
        "parent": {
            "id": "13442343",
            "key": "ARROW-16400",
            "self": "https://issues.apache.org/jira/rest/api/2/issue/13442343",
            "fields": {
                "summary": "[R][CI] Integrate arrow-r nightly/release builds into Crossbow",
                "status": {
                    "self": "https://issues.apache.org/jira/rest/api/2/status/5",
                    "description": "A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.",
                    "iconUrl": "https://issues.apache.org/jira/images/icons/statuses/resolved.png",
                    "name": "Resolved",
                    "id": "5",
                    "statusCategory": {
                        "self": "https://issues.apache.org/jira/rest/api/2/statuscategory/3",
                        "id": 3,
                        "key": "done",
                        "colorName": "green",
                        "name": "Done"
                    }
                },
                "priority": {
                    "self": "https://issues.apache.org/jira/rest/api/2/priority/3",
                    "iconUrl": "https://issues.apache.org/jira/images/icons/priorities/major.svg",
                    "name": "Major",
                    "id": "3"
                },
                "issuetype": {
                    "self": "https://issues.apache.org/jira/rest/api/2/issuetype/4",
                    "id": "4",
                    "description": "An improvement or enhancement to an existing feature or task.",
                    "iconUrl": "https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21140&avatarType=issuetype",
                    "name": "Improvement",
                    "subtask": false,
                    "avatarId": 21140
                }
            }
        },
        "fixVersions": [
            {
                "self": "https://issues.apache.org/jira/rest/api/2/version/12351550",
                "id": "12351550",
                "name": "9.0.0",
                "archived": false,
                "released": true,
                "releaseDate": "2022-08-03"
            }
        ],
        "resolution": {
            "self": "https://issues.apache.org/jira/rest/api/2/resolution/1",
            "id": "1",
            "description": "A fix for this issue is checked into the tree and tested.",
            "name": "Fixed"
        },
        "customfield_12312322": null,
        "customfield_12312323": null,
        "customfield_12312320": null,
        "customfield_12310420": "9223372036854775807",
        "customfield_12312321": null,
        "customfield_12312328": null,
        "customfield_12312329": null,
        "customfield_12312326": null,
        "customfield_12310300": null,
        "customfield_12312327": null,
        "customfield_12312324": null,
        "customfield_12312720": null,
        "customfield_12312325": null,
        "lastViewed": null,
        "priority": {
            "self": "https://issues.apache.org/jira/rest/api/2/priority/3",
            "iconUrl": "https://issues.apache.org/jira/images/icons/priorities/major.svg",
            "name": "Major",
            "id": "3"
        },
        "labels": [
            "pull-request-available"
        ],
        "customfield_12312333": null,
        "customfield_12312334": null,
        "customfield_12313422": "false",
        "customfield_12310310": "0.0",
        "customfield_12312331": null,
        "customfield_12312332": null,
        "aggregatetimeoriginalestimate": null,
        "timeestimate": 0,
        "customfield_12312330": null,
        "versions": [],
        "customfield_12311120": null,
        "customfield_12313826": null,
        "customfield_12312339": null,
        "issuelinks": [],
        "customfield_12313825": null,
        "assignee": {
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=assignUser",
            "name": "assignUser",
            "key": "JIRAUSER287549",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=34052",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34052",
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34052",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34052"
            },
            "displayName": "Jacob Wujciak-Jens",
            "active": true,
            "timeZone": "Europe/Berlin"
        },
        "customfield_12312337": null,
        "customfield_12313823": null,
        "customfield_12312338": null,
        "customfield_12311920": null,
        "customfield_12313822": null,
        "customfield_12312335": null,
        "customfield_12313821": null,
        "customfield_12312336": null,
        "customfield_12313820": null,
        "status": {
            "self": "https://issues.apache.org/jira/rest/api/2/status/5",
            "description": "A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.",
            "iconUrl": "https://issues.apache.org/jira/images/icons/statuses/resolved.png",
            "name": "Resolved",
            "id": "5",
            "statusCategory": {
                "self": "https://issues.apache.org/jira/rest/api/2/statuscategory/3",
                "id": 3,
                "key": "done",
                "colorName": "green",
                "name": "Done"
            }
        },
        "components": [
            {
                "self": "https://issues.apache.org/jira/rest/api/2/component/12333244",
                "id": "12333244",
                "name": "Continuous Integration"
            },
            {
                "self": "https://issues.apache.org/jira/rest/api/2/component/12333008",
                "id": "12333008",
                "name": "R"
            }
        ],
        "customfield_12312026": null,
        "customfield_12312023": null,
        "customfield_12312024": null,
        "aggregatetimeestimate": 0,
        "customfield_12312022": null,
        "customfield_12310921": null,
        "customfield_12310920": "9223372036854775807",
        "customfield_12312823": null,
        "creator": {
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=assignUser",
            "name": "assignUser",
            "key": "JIRAUSER287549",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=34052",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34052",
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34052",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34052"
            },
            "displayName": "Jacob Wujciak-Jens",
            "active": true,
            "timeZone": "Europe/Berlin"
        },
        "subtasks": [],
        "reporter": {
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=assignUser",
            "name": "assignUser",
            "key": "JIRAUSER287549",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=34052",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34052",
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34052",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34052"
            },
            "displayName": "Jacob Wujciak-Jens",
            "active": true,
            "timeZone": "Europe/Berlin"
        },
        "aggregateprogress": {
            "progress": 12000,
            "total": 12000,
            "percent": 100
        },
        "customfield_12313520": null,
        "customfield_12310250": null,
        "progress": {
            "progress": 12000,
            "total": 12000,
            "percent": 100
        },
        "customfield_12313924": null,
        "votes": {
            "self": "https://issues.apache.org/jira/rest/api/2/issue/ARROW-16901/votes",
            "votes": 0,
            "hasVoted": false
        },
        "worklog": {
            "startAt": 0,
            "maxResults": 20,
            "total": 20,
            "worklogs": [
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13468311/worklog/785677",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "assignUser opened a new pull request, #13453:\nURL: https://github.com/apache/arrow/pull/13453\n\n   This PR adds pruning to the nightly R upload, 14 versions will be kept by default. \r\n   \r\n   I have removed the `burnett01/rsync-deployments` actions because the use of docker for this was unnecessary and the action can only upload to a remote. This new manual version also utilizes host key checking for which I created `secrets.NIGHTLIES_RSYNC_HOST_KEY` (which should contain the result of ` ssh-keyscan -H nightlies.apache.org 2> /dev/null` and needs to be added to apache/arrow before this can run).  This way we are no longer depending on the action and it's associated Dockerfile (`drinternet/rsync`). \r\n   \r\n   We might want to refactor this into a local action for use with all nightly upload jobs.\r\n   \r\n   The pruning is not super efficient as we download the whole nightly repository (on cache miss). This could be avoided for the libarrow files, they could possibly be deleted via ssh instead but we need to download all R packages as `tools::write_PACKAGES` needs access to each archive.\n\n\n",
                    "created": "2022-06-28T16:32:12.466+0000",
                    "updated": "2022-06-28T16:32:12.466+0000",
                    "started": "2022-06-28T16:32:12.465+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "785677",
                    "issueId": "13468311"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13468311/worklog/785679",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "assignUser commented on PR #13453:\nURL: https://github.com/apache/arrow/pull/13453#issuecomment-1168959164\n\n   @raulcd could you give this a first pass?\n\n\n",
                    "created": "2022-06-28T16:36:43.024+0000",
                    "updated": "2022-06-28T16:36:43.024+0000",
                    "started": "2022-06-28T16:36:43.023+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "785679",
                    "issueId": "13468311"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13468311/worklog/785686",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "github-actions[bot] commented on PR #13453:\nURL: https://github.com/apache/arrow/pull/13453#issuecomment-1168986299\n\n   https://issues.apache.org/jira/browse/ARROW-16901\n\n\n",
                    "created": "2022-06-28T16:57:16.424+0000",
                    "updated": "2022-06-28T16:57:16.424+0000",
                    "started": "2022-06-28T16:57:16.423+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "785686",
                    "issueId": "13468311"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13468311/worklog/785687",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "github-actions[bot] commented on PR #13453:\nURL: https://github.com/apache/arrow/pull/13453#issuecomment-1168986334\n\n   :warning: Ticket **has not been started in JIRA**, please click 'Start Progress'.\n\n\n",
                    "created": "2022-06-28T16:57:19.103+0000",
                    "updated": "2022-06-28T16:57:19.103+0000",
                    "started": "2022-06-28T16:57:19.103+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "785687",
                    "issueId": "13468311"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13468311/worklog/785771",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "kou commented on code in PR #13453:\nURL: https://github.com/apache/arrow/pull/13453#discussion_r909080320\n\n\n##########\n.github/workflows/r_nightly.yml:\n##########\n@@ -100,18 +149,37 @@ jobs:\n           # strip superfluous nested dirs\r\n           new_paths <- sub(art_path, \".\", new_paths)\r\n           dirs <- dirname(new_paths)\r\n-          dir_result <- sapply(dirs, dir.create, recursive = TRUE)\r\n+          sapply(dirs, dir.create, recursive = TRUE, showWarnings = FALSE)\r\n \r\n-          if (!all(dir_result)) {\r\n-            stop(\"There was an issue while creating the folders!\")\r\n-          }\r\n-\r\n-          copy_result <- file.copy(current_path, new_paths)\r\n+          # overwrite allows us to \"force push\" a new version with the same name\r\n+          copy_result <- file.copy(current_path, new_paths, overwrite = TRUE)\r\n \r\n           if (!all(copy_result)) {\r\n             stop(\"There was an issue while copying the files!\")\r\n           }\r\n+      - name: Prune Repository\r\n+        shell: bash\r\n+        env:\r\n+          KEEP: ${{ github.event.inputs.keep || 14 }}\r\n+        run: |   \r\n+          prune() {\r\n+            # list files  | retain $KEEP newest files | delete everything else\r\n+            ls -t $1/arrow* | tail -n +$((KEEP + 1)) | xargs --no-run-if-empty rm \r\n+          }\r\n+\r\n+          # find leaf sub dirs\r\n+          repo_dirs=$(find repo -type d -links 2)\r\n \r\n+          # We want to retain $keep (14) versions of each pkg/lib so we call\r\n+          # prune on each leaf dir and not on repo/.\r\n+          for dir in ${repo_dirs[@]}; do\r\n+            prune $dir\r\n+          done\r\n\nReview Comment:\n   Can we use `find repo/* -mtime +$KEEP -type f -print0 | xargs -0 rm -rf` here?\n\n\n\n##########\n.github/workflows/r_nightly.yml:\n##########\n@@ -77,10 +89,47 @@ jobs:\n             echo \"No files found. Stopping upload.\"\r\n             exit 1\r\n           fi\r\n+      - name: Cache Repo\r\n+        uses: actions/cache@v3\r\n+        with:\r\n+          path: repo\r\n+          key: r-nightly-${{ github.run_id }}\r\n+          restore-keys: r-nightly-\r\n+      - name: Sync from Remote\r\n\nReview Comment:\n   I think that we don't need this if we use `actions/cache` for `repo/`.\r\n   If we use `actions/cache` for `repo/`, `repo/` has the same contents of https://nightlies.apache.org/arrow/r/ eventually.\n\n\n\n##########\n.github/workflows/r_nightly.yml:\n##########\n@@ -59,6 +65,12 @@ jobs:\n       - name: Install Archery\r\n         shell: bash\r\n         run: pip install -e arrow/dev/archery[all]\r\n+      - uses: actions/cache@v3\r\n+        with:\r\n+          path: repo\r\n+          key: r-nightly-${{ github.run_id }}\r\n+          restore-keys: r-nightly-\r\n+      \r\n\nReview Comment:\n   It seems this is duplicated.\n\n\n\n##########\n.github/workflows/r_nightly.yml:\n##########\n@@ -124,14 +192,32 @@ jobs:\n             tools::write_PACKAGES(dir, type = ifelse(on_win, \"win.binary\", \"mac.binary\"), verbose = TRUE )\r\n           }\r\n       - name: Show repo contents\r\n-        run: ls -R repo\r\n-      - name: Upload Files\r\n-        uses: burnett01/rsync-deployments@5.2\r\n-        with:\r\n-          switches: -avzr\r\n-          path: repo/*\r\n-          remote_path: ${{ secrets.NIGHTLIES_RSYNC_PATH }}/arrow/r\r\n-          remote_host: ${{ secrets.NIGHTLIES_RSYNC_HOST }}\r\n-          remote_port: ${{ secrets.NIGHTLIES_RSYNC_PORT }}\r\n-          remote_user: ${{ secrets.NIGHTLIES_RSYNC_USER }}\r\n-          remote_key: ${{ secrets.NIGHTLIES_RSYNC_KEY }}\r\n+        run: tree repo\r\n+      - name: Sync to Remote\r\n\nReview Comment:\n   Why do we implement this instead of using `burnett01/rsync-deployments@5.2`?\n\n\n\n",
                    "created": "2022-06-28T23:48:10.927+0000",
                    "updated": "2022-06-28T23:48:10.927+0000",
                    "started": "2022-06-28T23:48:10.927+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "785771",
                    "issueId": "13468311"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13468311/worklog/785932",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "assignUser commented on code in PR #13453:\nURL: https://github.com/apache/arrow/pull/13453#discussion_r909484781\n\n\n##########\n.github/workflows/r_nightly.yml:\n##########\n@@ -100,18 +149,37 @@ jobs:\n           # strip superfluous nested dirs\r\n           new_paths <- sub(art_path, \".\", new_paths)\r\n           dirs <- dirname(new_paths)\r\n-          dir_result <- sapply(dirs, dir.create, recursive = TRUE)\r\n+          sapply(dirs, dir.create, recursive = TRUE, showWarnings = FALSE)\r\n \r\n-          if (!all(dir_result)) {\r\n-            stop(\"There was an issue while creating the folders!\")\r\n-          }\r\n-\r\n-          copy_result <- file.copy(current_path, new_paths)\r\n+          # overwrite allows us to \"force push\" a new version with the same name\r\n+          copy_result <- file.copy(current_path, new_paths, overwrite = TRUE)\r\n \r\n           if (!all(copy_result)) {\r\n             stop(\"There was an issue while copying the files!\")\r\n           }\r\n+      - name: Prune Repository\r\n+        shell: bash\r\n+        env:\r\n+          KEEP: ${{ github.event.inputs.keep || 14 }}\r\n+        run: |   \r\n+          prune() {\r\n+            # list files  | retain $KEEP newest files | delete everything else\r\n+            ls -t $1/arrow* | tail -n +$((KEEP + 1)) | xargs --no-run-if-empty rm \r\n+          }\r\n+\r\n+          # find leaf sub dirs\r\n+          repo_dirs=$(find repo -type d -links 2)\r\n \r\n+          # We want to retain $keep (14) versions of each pkg/lib so we call\r\n+          # prune on each leaf dir and not on repo/.\r\n+          for dir in ${repo_dirs[@]}; do\r\n+            prune $dir\r\n+          done\r\n\nReview Comment:\n   I'll give it a try :)\n\n\n\n##########\n.github/workflows/r_nightly.yml:\n##########\n@@ -59,6 +65,12 @@ jobs:\n       - name: Install Archery\r\n         shell: bash\r\n         run: pip install -e arrow/dev/archery[all]\r\n+      - uses: actions/cache@v3\r\n+        with:\r\n+          path: repo\r\n+          key: r-nightly-${{ github.run_id }}\r\n+          restore-keys: r-nightly-\r\n+      \r\n\nReview Comment:\n   \ud83e\udd26\u200d\u2642\ufe0f you are right it is duplicated\n\n\n\n##########\n.github/workflows/r_nightly.yml:\n##########\n@@ -77,10 +89,47 @@ jobs:\n             echo \"No files found. Stopping upload.\"\r\n             exit 1\r\n           fi\r\n+      - name: Cache Repo\r\n+        uses: actions/cache@v3\r\n+        with:\r\n+          path: repo\r\n+          key: r-nightly-${{ github.run_id }}\r\n+          restore-keys: r-nightly-\r\n+      - name: Sync from Remote\r\n\nReview Comment:\n   GHA caches are evicted regularly especially due to the workaround I described above which creates a large number of redundant cache objects (this is also in use for the R cpp builds). So we can not rely on always hitting the cache.\n\n\n\n##########\n.github/workflows/r_nightly.yml:\n##########\n@@ -59,6 +65,12 @@ jobs:\n       - name: Install Archery\r\n         shell: bash\r\n         run: pip install -e arrow/dev/archery[all]\r\n+      - uses: actions/cache@v3\r\n+        with:\r\n+          path: repo\r\n+          key: r-nightly-${{ github.run_id }}\r\n+          restore-keys: r-nightly-\r\n+      \r\n\nReview Comment:\n   No, this is intentional. `actions/cache` is broken, it will not update the cache on a primary key (there are several issues about this e.g. https://github.com/actions/cache/discussions/641). This is a (wasteful) workaround, by generating a unique primary key and matching on the `restore-key` we force the cache to be \"updated\" (a new cache object will be created). Leading the whole concept of a cache ad absurdum but there is now way around it for now :(\n\n\n\n##########\n.github/workflows/r_nightly.yml:\n##########\n@@ -124,14 +192,32 @@ jobs:\n             tools::write_PACKAGES(dir, type = ifelse(on_win, \"win.binary\", \"mac.binary\"), verbose = TRUE )\r\n           }\r\n       - name: Show repo contents\r\n-        run: ls -R repo\r\n-      - name: Upload Files\r\n-        uses: burnett01/rsync-deployments@5.2\r\n-        with:\r\n-          switches: -avzr\r\n-          path: repo/*\r\n-          remote_path: ${{ secrets.NIGHTLIES_RSYNC_PATH }}/arrow/r\r\n-          remote_host: ${{ secrets.NIGHTLIES_RSYNC_HOST }}\r\n-          remote_port: ${{ secrets.NIGHTLIES_RSYNC_PORT }}\r\n-          remote_user: ${{ secrets.NIGHTLIES_RSYNC_USER }}\r\n-          remote_key: ${{ secrets.NIGHTLIES_RSYNC_KEY }}\r\n+        run: tree repo\r\n+      - name: Sync to Remote\r\n\nReview Comment:\n   For functional reasons:\r\n   - the action does not support downloading from source\r\n     - this could be achived without rsync but would likely be slower (no auth)\r\n   - the functionality can be implemented in 10 LOCs without the need for docker, which in itself is a valid reason not to use the action imho\r\n   - but also security reasons:\r\n     - this workflow runs with full access to `secrets` and a ~~r/w `github.token` available to actions~~ (I removed this) -> :warning: see [here](https://cwiki.apache.org/confluence/display/BUILDS/GitHub+Actions+status#GitHubActionsstatus-Security)\r\n     - the action does not validate host keys -> potential for MITM\r\n   \n\n\n\n##########\n.github/workflows/r_nightly.yml:\n##########\n@@ -100,18 +149,37 @@ jobs:\n           # strip superfluous nested dirs\r\n           new_paths <- sub(art_path, \".\", new_paths)\r\n           dirs <- dirname(new_paths)\r\n-          dir_result <- sapply(dirs, dir.create, recursive = TRUE)\r\n+          sapply(dirs, dir.create, recursive = TRUE, showWarnings = FALSE)\r\n \r\n-          if (!all(dir_result)) {\r\n-            stop(\"There was an issue while creating the folders!\")\r\n-          }\r\n-\r\n-          copy_result <- file.copy(current_path, new_paths)\r\n+          # overwrite allows us to \"force push\" a new version with the same name\r\n+          copy_result <- file.copy(current_path, new_paths, overwrite = TRUE)\r\n \r\n           if (!all(copy_result)) {\r\n             stop(\"There was an issue while copying the files!\")\r\n           }\r\n+      - name: Prune Repository\r\n+        shell: bash\r\n+        env:\r\n+          KEEP: ${{ github.event.inputs.keep || 14 }}\r\n+        run: |   \r\n+          prune() {\r\n+            # list files  | retain $KEEP newest files | delete everything else\r\n+            ls -t $1/arrow* | tail -n +$((KEEP + 1)) | xargs --no-run-if-empty rm \r\n+          }\r\n+\r\n+          # find leaf sub dirs\r\n+          repo_dirs=$(find repo -type d -links 2)\r\n \r\n+          # We want to retain $keep (14) versions of each pkg/lib so we call\r\n+          # prune on each leaf dir and not on repo/.\r\n+          for dir in ${repo_dirs[@]}; do\r\n+            prune $dir\r\n+          done\r\n\nReview Comment:\n   No we can't, because this will delete by time with no regard to total number of files, so if for some reason the nightly builds are not uploaded regularly (e.g. because the build is failing for some reason) this will delete all files.\n\n\n\n",
                    "created": "2022-06-29T12:29:30.985+0000",
                    "updated": "2022-06-29T12:29:30.985+0000",
                    "started": "2022-06-29T12:29:30.985+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "785932",
                    "issueId": "13468311"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13468311/worklog/786222",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "kou commented on code in PR #13453:\nURL: https://github.com/apache/arrow/pull/13453#discussion_r910490933\n\n\n##########\n.github/workflows/r_nightly.yml:\n##########\n@@ -77,10 +86,47 @@ jobs:\n             echo \"No files found. Stopping upload.\"\r\n             exit 1\r\n           fi\r\n+      - name: Cache Repo\r\n+        uses: actions/cache@v3\r\n+        with:\r\n+          path: repo\r\n+          key: r-nightly-${{ github.run_id }}\r\n+          restore-keys: r-nightly-\r\n+      - name: Sync from Remote\r\n+        env:\r\n+          RSYNC_PATH: repo\r\n+          SSH_KEY: \"${{ secrets.NIGHTLIES_RSYNC_KEY }}\"\r\n+          PORT: \"${{ secrets.NIGHTLIES_RSYNC_PORT }}\"\r\n+          USER: \"${{ secrets.NIGHTLIES_RSYNC_USER }}\"\r\n+          HOST: \"${{ secrets.NIGHTLIES_RSYNC_HOST }}\"\r\n+          HOST_KEY: \"${{ secrets.NIGHTLIES_RSYNC_HOST_KEY }}\"\r\n+          REMOTE_PATH: \"${{ secrets.NIGHTLIES_RSYNC_PATH }}/arrow/r\"\r\n+        run: |\r\n+            # Make SSH key available and add remote to known hosts\r\n+            eval \"$(ssh-agent)\" > /dev/null\r\n+            echo \"$SSH_KEY\" | tr -d '\\r' | DISPLAY=1 ssh-add - >/dev/null\r\n+            mkdir -p ~/.ssh\r\n+            echo \"$HOST_KEY\" >> ~/.ssh/known_hosts\r\n+\r\n+            # strict errors\r\n+            set -eu\r\n+\r\n+            # avzrh - archive mode, verbose, with compression, recurse into dirs, human readable numbers\r\n+            # transfer only new files, delete files not in source, show progress info\r\n+            RSYNC_SWITCHES=\"-avzrh --update --delete --progress\"\r\n+            # We have to use a custom remote shell to supply the port\r\n+            RSH=\"ssh -p $PORT\"\r\n+            LOCAL_PATH=\"$GITHUB_WORKSPACE/$RSYNC_PATH\"\r\n+            DSN=\"$USER@$HOST\"\r\n+\r\n+            # Deploy. It is important to append '/*' to the source path otherwise\r\n+            # the entire source dir will be created as a sub dir in the destination\r\n+            sh -c \"rsync $RSYNC_SWITCHES -e '$RSH' $DSN:$REMOTE_PATH/* $LOCAL_PATH\"\r\n+      - run: tree repo\r\n\nReview Comment:\n   Could you show an output of this?\r\n   \r\n   I don't know why we don't use the same directory structure for `repo/` and https://nightlies.apache.org/arrow/r/ . If we use the same directory structure, we don't need to append `/*` for `rsync` source.\n\n\n\n##########\n.github/workflows/r_nightly.yml:\n##########\n@@ -77,10 +86,47 @@ jobs:\n             echo \"No files found. Stopping upload.\"\r\n             exit 1\r\n           fi\r\n+      - name: Cache Repo\r\n+        uses: actions/cache@v3\r\n+        with:\r\n+          path: repo\r\n+          key: r-nightly-${{ github.run_id }}\r\n+          restore-keys: r-nightly-\r\n+      - name: Sync from Remote\r\n+        env:\r\n+          RSYNC_PATH: repo\r\n+          SSH_KEY: \"${{ secrets.NIGHTLIES_RSYNC_KEY }}\"\r\n+          PORT: \"${{ secrets.NIGHTLIES_RSYNC_PORT }}\"\r\n+          USER: \"${{ secrets.NIGHTLIES_RSYNC_USER }}\"\r\n+          HOST: \"${{ secrets.NIGHTLIES_RSYNC_HOST }}\"\r\n+          HOST_KEY: \"${{ secrets.NIGHTLIES_RSYNC_HOST_KEY }}\"\r\n+          REMOTE_PATH: \"${{ secrets.NIGHTLIES_RSYNC_PATH }}/arrow/r\"\r\n+        run: |\r\n+            # Make SSH key available and add remote to known hosts\r\n+            eval \"$(ssh-agent)\" > /dev/null\r\n+            echo \"$SSH_KEY\" | tr -d '\\r' | DISPLAY=1 ssh-add - >/dev/null\r\n+            mkdir -p ~/.ssh\r\n+            echo \"$HOST_KEY\" >> ~/.ssh/known_hosts\r\n+\r\n+            # strict errors\r\n+            set -eu\r\n+\r\n+            # avzrh - archive mode, verbose, with compression, recurse into dirs, human readable numbers\r\n+            # transfer only new files, delete files not in source, show progress info\r\n+            RSYNC_SWITCHES=\"-avzrh --update --delete --progress\"\r\n+            # We have to use a custom remote shell to supply the port\r\n+            RSH=\"ssh -p $PORT\"\r\n+            LOCAL_PATH=\"$GITHUB_WORKSPACE/$RSYNC_PATH\"\r\n+            DSN=\"$USER@$HOST\"\r\n+\r\n+            # Deploy. It is important to append '/*' to the source path otherwise\r\n+            # the entire source dir will be created as a sub dir in the destination\r\n+            sh -c \"rsync $RSYNC_SWITCHES -e '$RSH' $DSN:$REMOTE_PATH/* $LOCAL_PATH\"\r\n\nReview Comment:\n   Why do we need `sh -c`?\r\n   \r\n   \n\n\n\n##########\n.github/workflows/r_nightly.yml:\n##########\n@@ -77,10 +86,47 @@ jobs:\n             echo \"No files found. Stopping upload.\"\r\n             exit 1\r\n           fi\r\n+      - name: Cache Repo\r\n+        uses: actions/cache@v3\r\n+        with:\r\n+          path: repo\r\n+          key: r-nightly-${{ github.run_id }}\r\n+          restore-keys: r-nightly-\r\n+      - name: Sync from Remote\r\n+        env:\r\n+          RSYNC_PATH: repo\r\n+          SSH_KEY: \"${{ secrets.NIGHTLIES_RSYNC_KEY }}\"\r\n+          PORT: \"${{ secrets.NIGHTLIES_RSYNC_PORT }}\"\r\n+          USER: \"${{ secrets.NIGHTLIES_RSYNC_USER }}\"\r\n+          HOST: \"${{ secrets.NIGHTLIES_RSYNC_HOST }}\"\r\n+          HOST_KEY: \"${{ secrets.NIGHTLIES_RSYNC_HOST_KEY }}\"\r\n+          REMOTE_PATH: \"${{ secrets.NIGHTLIES_RSYNC_PATH }}/arrow/r\"\r\n+        run: |\r\n+            # Make SSH key available and add remote to known hosts\r\n+            eval \"$(ssh-agent)\" > /dev/null\r\n+            echo \"$SSH_KEY\" | tr -d '\\r' | DISPLAY=1 ssh-add - >/dev/null\r\n+            mkdir -p ~/.ssh\r\n+            echo \"$HOST_KEY\" >> ~/.ssh/known_hosts\r\n+\r\n+            # strict errors\r\n+            set -eu\r\n+\r\n+            # avzrh - archive mode, verbose, with compression, recurse into dirs, human readable numbers\r\n+            # transfer only new files, delete files not in source, show progress info\r\n+            RSYNC_SWITCHES=\"-avzrh --update --delete --progress\"\r\n\nReview Comment:\n   `-r` is redundant because `a` includes `-r`:\r\n   \r\n   ```bash\r\n   $ rsync --help\r\n   ....\r\n          --archive, -a            archive mode is -rlptgoD (no -A,-X,-U,-N,-H)\r\n   ...\r\n   ```\n\n\n\n##########\n.github/workflows/r_nightly.yml:\n##########\n@@ -77,10 +86,47 @@ jobs:\n             echo \"No files found. Stopping upload.\"\r\n             exit 1\r\n           fi\r\n+      - name: Cache Repo\r\n+        uses: actions/cache@v3\r\n+        with:\r\n+          path: repo\r\n+          key: r-nightly-${{ github.run_id }}\r\n+          restore-keys: r-nightly-\r\n+      - name: Sync from Remote\r\n+        env:\r\n+          RSYNC_PATH: repo\r\n+          SSH_KEY: \"${{ secrets.NIGHTLIES_RSYNC_KEY }}\"\r\n+          PORT: \"${{ secrets.NIGHTLIES_RSYNC_PORT }}\"\r\n+          USER: \"${{ secrets.NIGHTLIES_RSYNC_USER }}\"\r\n+          HOST: \"${{ secrets.NIGHTLIES_RSYNC_HOST }}\"\r\n+          HOST_KEY: \"${{ secrets.NIGHTLIES_RSYNC_HOST_KEY }}\"\r\n+          REMOTE_PATH: \"${{ secrets.NIGHTLIES_RSYNC_PATH }}/arrow/r\"\r\n+        run: |\r\n+            # Make SSH key available and add remote to known hosts\r\n+            eval \"$(ssh-agent)\" > /dev/null\r\n+            echo \"$SSH_KEY\" | tr -d '\\r' | DISPLAY=1 ssh-add - >/dev/null\r\n+            mkdir -p ~/.ssh\r\n\nReview Comment:\n   Do we need `chmod go-rwx ~/.ssh`?\n\n\n\n##########\n.github/workflows/r_nightly.yml:\n##########\n@@ -77,10 +86,47 @@ jobs:\n             echo \"No files found. Stopping upload.\"\r\n             exit 1\r\n           fi\r\n+      - name: Cache Repo\r\n+        uses: actions/cache@v3\r\n+        with:\r\n+          path: repo\r\n+          key: r-nightly-${{ github.run_id }}\r\n+          restore-keys: r-nightly-\r\n+      - name: Sync from Remote\r\n+        env:\r\n+          RSYNC_PATH: repo\r\n+          SSH_KEY: \"${{ secrets.NIGHTLIES_RSYNC_KEY }}\"\r\n+          PORT: \"${{ secrets.NIGHTLIES_RSYNC_PORT }}\"\r\n+          USER: \"${{ secrets.NIGHTLIES_RSYNC_USER }}\"\r\n+          HOST: \"${{ secrets.NIGHTLIES_RSYNC_HOST }}\"\r\n+          HOST_KEY: \"${{ secrets.NIGHTLIES_RSYNC_HOST_KEY }}\"\r\n+          REMOTE_PATH: \"${{ secrets.NIGHTLIES_RSYNC_PATH }}/arrow/r\"\r\n+        run: |\r\n+            # Make SSH key available and add remote to known hosts\r\n+            eval \"$(ssh-agent)\" > /dev/null\r\n+            echo \"$SSH_KEY\" | tr -d '\\r' | DISPLAY=1 ssh-add - >/dev/null\r\n\nReview Comment:\n   Why do we need `DISPLAY=1`?\r\n   I think that there is no X on GitHub Actions.\n\n\n\n",
                    "created": "2022-06-29T23:44:07.657+0000",
                    "updated": "2022-06-29T23:44:07.657+0000",
                    "started": "2022-06-29T23:44:07.656+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "786222",
                    "issueId": "13468311"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13468311/worklog/786509",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "assignUser commented on code in PR #13453:\nURL: https://github.com/apache/arrow/pull/13453#discussion_r910865912\n\n\n##########\n.github/workflows/r_nightly.yml:\n##########\n@@ -77,10 +86,47 @@ jobs:\n             echo \"No files found. Stopping upload.\"\r\n             exit 1\r\n           fi\r\n+      - name: Cache Repo\r\n+        uses: actions/cache@v3\r\n+        with:\r\n+          path: repo\r\n+          key: r-nightly-${{ github.run_id }}\r\n+          restore-keys: r-nightly-\r\n+      - name: Sync from Remote\r\n+        env:\r\n+          RSYNC_PATH: repo\r\n+          SSH_KEY: \"${{ secrets.NIGHTLIES_RSYNC_KEY }}\"\r\n+          PORT: \"${{ secrets.NIGHTLIES_RSYNC_PORT }}\"\r\n+          USER: \"${{ secrets.NIGHTLIES_RSYNC_USER }}\"\r\n+          HOST: \"${{ secrets.NIGHTLIES_RSYNC_HOST }}\"\r\n+          HOST_KEY: \"${{ secrets.NIGHTLIES_RSYNC_HOST_KEY }}\"\r\n+          REMOTE_PATH: \"${{ secrets.NIGHTLIES_RSYNC_PATH }}/arrow/r\"\r\n+        run: |\r\n+            # Make SSH key available and add remote to known hosts\r\n+            eval \"$(ssh-agent)\" > /dev/null\r\n+            echo \"$SSH_KEY\" | tr -d '\\r' | DISPLAY=1 ssh-add - >/dev/null\r\n+            mkdir -p ~/.ssh\r\n+            echo \"$HOST_KEY\" >> ~/.ssh/known_hosts\r\n+\r\n+            # strict errors\r\n+            set -eu\r\n+\r\n+            # avzrh - archive mode, verbose, with compression, recurse into dirs, human readable numbers\r\n+            # transfer only new files, delete files not in source, show progress info\r\n+            RSYNC_SWITCHES=\"-avzrh --update --delete --progress\"\r\n+            # We have to use a custom remote shell to supply the port\r\n+            RSH=\"ssh -p $PORT\"\r\n+            LOCAL_PATH=\"$GITHUB_WORKSPACE/$RSYNC_PATH\"\r\n+            DSN=\"$USER@$HOST\"\r\n+\r\n+            # Deploy. It is important to append '/*' to the source path otherwise\r\n+            # the entire source dir will be created as a sub dir in the destination\r\n+            sh -c \"rsync $RSYNC_SWITCHES -e '$RSH' $DSN:$REMOTE_PATH/* $LOCAL_PATH\"\r\n+      - run: tree repo\r\n\nReview Comment:\n   A small example:\r\n   ```\r\n   $ tree src\r\n   src\r\n   \u2514\u2500\u2500 arrow\r\n       \u2514\u2500\u2500 r\r\n           \u2514\u2500\u2500 pkg.file\r\n   \r\n   2 directories, 1 file\r\n   $ tree dest\r\n   dest\r\n   \r\n   0 directories, 0 files\r\n   $ rsync -avzh --update --delete src dest\r\n   sending incremental file list\r\n   src/\r\n   src/arrow/\r\n   src/arrow/r/\r\n   src/arrow/r/pkg.file\r\n   \r\n   sent 180 bytes  received 51 bytes  462.00 bytes/sec\r\n   total size is 0  speedup is 0.00\r\n   $ tree dest\r\n   dest\r\n   \u2514\u2500\u2500 src\r\n       \u2514\u2500\u2500 arrow\r\n           \u2514\u2500\u2500 r\r\n               \u2514\u2500\u2500 pkg.file\r\n   \r\n   3 directories, 1 file\r\n   ```\r\n   vs\r\n   \r\n   ```\r\n   $ rsync -avzh --update --delete src/* dest\r\n   sending incremental file list\r\n   arrow/\r\n   arrow/r/\r\n   arrow/r/pkg.file\r\n   \r\n   sent 158 bytes  received 47 bytes  410.00 bytes/sec\r\n   total size is 0  speedup is 0.00\r\n   $ tree dest\r\n   dest\r\n   \u2514\u2500\u2500 arrow\r\n       \u2514\u2500\u2500 r\r\n           \u2514\u2500\u2500 pkg.file\r\n   \r\n   2 directories, 1 file\r\n   ```\r\n   \n\n\n\n",
                    "created": "2022-06-30T10:30:04.627+0000",
                    "updated": "2022-06-30T10:30:04.627+0000",
                    "started": "2022-06-30T10:30:04.627+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "786509",
                    "issueId": "13468311"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13468311/worklog/786540",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "assignUser commented on PR #13453:\nURL: https://github.com/apache/arrow/pull/13453#issuecomment-1171148839\n\n   Thanks for the review @kou ! While integrating the changes I was already annoyed to do everything twice so I refactored the syncing as a local action. This way it can be easily reused by other components to upload their nightly builds (e.g. java).\r\n   I also switched to using a local `.ssh` folder for `known_hosts` to avoid interfering with the runner state (not strictly necessary but I think good form).\r\n   \r\n   Here is an example run in a test repo\r\n   https://github.com/assignUser/test-repo-a/runs/7130803918?check_suite_focus=true\n\n\n",
                    "created": "2022-06-30T12:18:52.940+0000",
                    "updated": "2022-06-30T12:18:52.940+0000",
                    "started": "2022-06-30T12:18:52.940+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "786540",
                    "issueId": "13468311"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13468311/worklog/786888",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "kou commented on code in PR #13453:\nURL: https://github.com/apache/arrow/pull/13453#discussion_r911526028\n\n\n##########\n.github/workflows/r_nightly.yml:\n##########\n@@ -77,10 +86,47 @@ jobs:\n             echo \"No files found. Stopping upload.\"\r\n             exit 1\r\n           fi\r\n+      - name: Cache Repo\r\n+        uses: actions/cache@v3\r\n+        with:\r\n+          path: repo\r\n+          key: r-nightly-${{ github.run_id }}\r\n+          restore-keys: r-nightly-\r\n+      - name: Sync from Remote\r\n+        env:\r\n+          RSYNC_PATH: repo\r\n+          SSH_KEY: \"${{ secrets.NIGHTLIES_RSYNC_KEY }}\"\r\n+          PORT: \"${{ secrets.NIGHTLIES_RSYNC_PORT }}\"\r\n+          USER: \"${{ secrets.NIGHTLIES_RSYNC_USER }}\"\r\n+          HOST: \"${{ secrets.NIGHTLIES_RSYNC_HOST }}\"\r\n+          HOST_KEY: \"${{ secrets.NIGHTLIES_RSYNC_HOST_KEY }}\"\r\n+          REMOTE_PATH: \"${{ secrets.NIGHTLIES_RSYNC_PATH }}/arrow/r\"\r\n+        run: |\r\n+            # Make SSH key available and add remote to known hosts\r\n+            eval \"$(ssh-agent)\" > /dev/null\r\n+            echo \"$SSH_KEY\" | tr -d '\\r' | DISPLAY=1 ssh-add - >/dev/null\r\n+            mkdir -p ~/.ssh\r\n+            echo \"$HOST_KEY\" >> ~/.ssh/known_hosts\r\n+\r\n+            # strict errors\r\n+            set -eu\r\n+\r\n+            # avzrh - archive mode, verbose, with compression, recurse into dirs, human readable numbers\r\n+            # transfer only new files, delete files not in source, show progress info\r\n+            RSYNC_SWITCHES=\"-avzrh --update --delete --progress\"\r\n+            # We have to use a custom remote shell to supply the port\r\n+            RSH=\"ssh -p $PORT\"\r\n+            LOCAL_PATH=\"$GITHUB_WORKSPACE/$RSYNC_PATH\"\r\n+            DSN=\"$USER@$HOST\"\r\n+\r\n+            # Deploy. It is important to append '/*' to the source path otherwise\r\n+            # the entire source dir will be created as a sub dir in the destination\r\n+            sh -c \"rsync $RSYNC_SWITCHES -e '$RSH' $DSN:$REMOTE_PATH/* $LOCAL_PATH\"\r\n+      - run: tree repo\r\n\nReview Comment:\n   Thanks.\r\n   Could you try `rsync -avzh --update --delete src/ dest`? (`/` is appended to `src`.)\n\n\n\n##########\n.github/actions/sync-nightlies/action.yml:\n##########\n@@ -0,0 +1,92 @@\n+# Licensed to the Apache Software Foundation (ASF) under one\r\n+# or more contributor license agreements.  See the NOTICE file\r\n+# distributed with this work for additional information\r\n+# regarding copyright ownership.  The ASF licenses this file\r\n+# to you under the Apache License, Version 2.0 (the\r\n+# \"License\"); you may not use this file except in compliance\r\n+# with the License.  You may obtain a copy of the License at\r\n+#\r\n+#   http://www.apache.org/licenses/LICENSE-2.0\r\n+#\r\n+# Unless required by applicable law or agreed to in writing,\r\n+# software distributed under the License is distributed on an\r\n+# \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\r\n+# KIND, either express or implied.  See the License for the\r\n+# specific language governing permissions and limitations\r\n+# under the License.\r\n+\r\n+name: 'Sync nightlies'\r\n+description: 'Sync files to and from nightlies.apache.org'\r\n+inputs:\r\n+  upload:\r\n+    description: 'Sync from local to remote'\r\n+    default: false\r\n+    required: false\r\n+  switches:\r\n+    description: 'see rsync --help'\r\n+    required: true\r\n+  local_path:\r\n+    description: 'The relative local path within $GITHUB_WORKSPACE'\r\n+    required: true\r\n+  remote_path:\r\n+    description: 'The remote path incl. sub dirs e.g. {{secrets.path}}/arrow/r'\r\n+    required: true\r\n+  remote_host:\r\n+    description: 'The remote host'\r\n+    required: true\r\n+  remote_port:\r\n+    description: 'The remote port'\r\n+    required: false\r\n+    default: 22\r\n+  remote_user:\r\n+    description: 'The remote user'\r\n+    required: true\r\n+  remote_key:\r\n+    description: 'The remote key'\r\n+    required: true\r\n+  remote_host_key:\r\n+    description: 'The host key fot Stricthostkeychecking'\r\n\nReview Comment:\n   ```suggestion\r\n       description: 'The host key for StrictHostKeyChecking'\r\n   \r\n   ```\n\n\n\n##########\n.github/actions/sync-nightlies/action.yml:\n##########\n@@ -0,0 +1,92 @@\n+# Licensed to the Apache Software Foundation (ASF) under one\r\n+# or more contributor license agreements.  See the NOTICE file\r\n+# distributed with this work for additional information\r\n+# regarding copyright ownership.  The ASF licenses this file\r\n+# to you under the Apache License, Version 2.0 (the\r\n+# \"License\"); you may not use this file except in compliance\r\n+# with the License.  You may obtain a copy of the License at\r\n+#\r\n+#   http://www.apache.org/licenses/LICENSE-2.0\r\n+#\r\n+# Unless required by applicable law or agreed to in writing,\r\n+# software distributed under the License is distributed on an\r\n+# \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\r\n+# KIND, either express or implied.  See the License for the\r\n+# specific language governing permissions and limitations\r\n+# under the License.\r\n+\r\n+name: 'Sync nightlies'\r\n+description: 'Sync files to and from nightlies.apache.org'\r\n+inputs:\r\n+  upload:\r\n+    description: 'Sync from local to remote'\r\n+    default: false\r\n+    required: false\r\n+  switches:\r\n+    description: 'see rsync --help'\r\n+    required: true\r\n+  local_path:\r\n+    description: 'The relative local path within $GITHUB_WORKSPACE'\r\n+    required: true\r\n+  remote_path:\r\n+    description: 'The remote path incl. sub dirs e.g. {{secrets.path}}/arrow/r'\r\n+    required: true\r\n+  remote_host:\r\n+    description: 'The remote host'\r\n+    required: true\r\n+  remote_port:\r\n+    description: 'The remote port'\r\n+    required: false\r\n+    default: 22\r\n+  remote_user:\r\n+    description: 'The remote user'\r\n+    required: true\r\n+  remote_key:\r\n+    description: 'The remote key'\r\n+    required: true\r\n+  remote_host_key:\r\n+    description: 'The host key fot Stricthostkeychecking'\r\n+    required: true\r\n+\r\n+runs:\r\n+  using: \"composite\"\r\n+  steps:\r\n+    - name: Sync files\r\n+      shell: bash\r\n+      env:\r\n+          SWITCHES: \"${{ inputs.switches }}\"\r\n+          LOCAL_PATH: \"${{ github.workspace}}/${{ inputs.local_path }}\"\r\n\nReview Comment:\n   ```suggestion\r\n             LOCAL_PATH: \"${{ github.workspace }}/${{ inputs.local_path }}\"\r\n   \r\n   ```\n\n\n\n",
                    "created": "2022-07-01T00:20:40.071+0000",
                    "updated": "2022-07-01T00:20:40.071+0000",
                    "started": "2022-07-01T00:20:40.071+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "786888",
                    "issueId": "13468311"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13468311/worklog/787010",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "raulcd commented on code in PR #13453:\nURL: https://github.com/apache/arrow/pull/13453#discussion_r911777504\n\n\n##########\n.github/workflows/r_nightly.yml:\n##########\n@@ -101,18 +127,37 @@ jobs:\n           # strip superfluous nested dirs\r\n           new_paths <- sub(art_path, \".\", new_paths)\r\n           dirs <- dirname(new_paths)\r\n-          dir_result <- sapply(dirs, dir.create, recursive = TRUE)\r\n-\r\n-          if (!all(dir_result)) {\r\n-            stop(\"There was an issue while creating the folders!\")\r\n-          }\r\n+          sapply(dirs, dir.create, recursive = TRUE, showWarnings = FALSE)\r\n \r\n-          copy_result <- file.copy(current_path, new_paths)\r\n+          # overwrite allows us to \"force push\" a new version with the same name\r\n+          copy_result <- file.copy(current_path, new_paths, overwrite = TRUE)\r\n \r\n           if (!all(copy_result)) {\r\n             stop(\"There was an issue while copying the files!\")\r\n           }\r\n+      - name: Prune Repository\r\n+        shell: bash\r\n+        env:\r\n+          KEEP: ${{ github.event.inputs.keep || 14 }}\r\n\nReview Comment:\n   shouldn't this already be the default value? I am not sure I understand why do we need the `|| 14`\n\n\n\n",
                    "created": "2022-07-01T09:14:48.377+0000",
                    "updated": "2022-07-01T09:14:48.377+0000",
                    "started": "2022-07-01T09:14:48.377+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "787010",
                    "issueId": "13468311"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13468311/worklog/787024",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "assignUser commented on code in PR #13453:\nURL: https://github.com/apache/arrow/pull/13453#discussion_r911792408\n\n\n##########\n.github/workflows/r_nightly.yml:\n##########\n@@ -101,18 +127,37 @@ jobs:\n           # strip superfluous nested dirs\r\n           new_paths <- sub(art_path, \".\", new_paths)\r\n           dirs <- dirname(new_paths)\r\n-          dir_result <- sapply(dirs, dir.create, recursive = TRUE)\r\n-\r\n-          if (!all(dir_result)) {\r\n-            stop(\"There was an issue while creating the folders!\")\r\n-          }\r\n+          sapply(dirs, dir.create, recursive = TRUE, showWarnings = FALSE)\r\n \r\n-          copy_result <- file.copy(current_path, new_paths)\r\n+          # overwrite allows us to \"force push\" a new version with the same name\r\n+          copy_result <- file.copy(current_path, new_paths, overwrite = TRUE)\r\n \r\n           if (!all(copy_result)) {\r\n             stop(\"There was an issue while copying the files!\")\r\n           }\r\n+      - name: Prune Repository\r\n+        shell: bash\r\n+        env:\r\n+          KEEP: ${{ github.event.inputs.keep || 14 }}\r\n\nReview Comment:\n   The default value shows up in a text box, so theoretically you could delete it and this would catch it. Probably unlikely but its only 4 chars  \ud83e\udd37 \ud83d\ude00 \n\n\n\n",
                    "created": "2022-07-01T09:30:53.610+0000",
                    "updated": "2022-07-01T09:30:53.610+0000",
                    "started": "2022-07-01T09:30:53.610+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "787024",
                    "issueId": "13468311"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13468311/worklog/787025",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "assignUser commented on code in PR #13453:\nURL: https://github.com/apache/arrow/pull/13453#discussion_r911795531\n\n\n##########\n.github/actions/sync-nightlies/action.yml:\n##########\n@@ -0,0 +1,92 @@\n+# Licensed to the Apache Software Foundation (ASF) under one\r\n+# or more contributor license agreements.  See the NOTICE file\r\n+# distributed with this work for additional information\r\n+# regarding copyright ownership.  The ASF licenses this file\r\n+# to you under the Apache License, Version 2.0 (the\r\n+# \"License\"); you may not use this file except in compliance\r\n+# with the License.  You may obtain a copy of the License at\r\n+#\r\n+#   http://www.apache.org/licenses/LICENSE-2.0\r\n+#\r\n+# Unless required by applicable law or agreed to in writing,\r\n+# software distributed under the License is distributed on an\r\n+# \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\r\n+# KIND, either express or implied.  See the License for the\r\n+# specific language governing permissions and limitations\r\n+# under the License.\r\n+\r\n+name: 'Sync nightlies'\r\n+description: 'Sync files to and from nightlies.apache.org'\r\n+inputs:\r\n+  upload:\r\n+    description: 'Sync from local to remote'\r\n+    default: false\r\n+    required: false\r\n+  switches:\r\n+    description: 'see rsync --help'\r\n+    required: true\r\n+  local_path:\r\n+    description: 'The relative local path within $GITHUB_WORKSPACE'\r\n+    required: true\r\n+  remote_path:\r\n+    description: 'The remote path incl. sub dirs e.g. {{secrets.path}}/arrow/r'\r\n+    required: true\r\n+  remote_host:\r\n+    description: 'The remote host'\r\n+    required: true\r\n+  remote_port:\r\n+    description: 'The remote port'\r\n+    required: false\r\n+    default: 22\r\n+  remote_user:\r\n+    description: 'The remote user'\r\n+    required: true\r\n+  remote_key:\r\n+    description: 'The remote key'\r\n+    required: true\r\n+  remote_host_key:\r\n+    description: 'The host key fot Stricthostkeychecking'\r\n+    required: true\r\n+\r\n+runs:\r\n+  using: \"composite\"\r\n+  steps:\r\n+    - name: Sync files\r\n+      shell: bash\r\n+      env:\r\n+          SWITCHES: \"${{ inputs.switches }}\"\r\n+          LOCAL_PATH: \"${{ github.workspace}}/${{ inputs.local_path }}\"\r\n+          SSH_KEY: \"${{ inputs.remote_key }}\"\r\n+          PORT: \"${{ inputs.remote_port }}\"\r\n+          USER: \"${{ inputs.remote_user }}\"\r\n+          HOST: \"${{ inputs.remote_host }}\"\r\n+          HOST_KEY: \"${{ inputs.remote_host_key }}\"\r\n+          REMOTE_PATH: \"${{ inputs.remote_path }}\"\r\n+      run: |\r\n+        # Make SSH key available and add remote to known hosts\r\n+        eval \"$(ssh-agent)\" > /dev/null\r\n+        echo \"$SSH_KEY\" | tr -d '\\r' | ssh-add - >/dev/null\r\n+\r\n+        mkdir -p .ssh\r\n+        chmod go-rwx .ssh\r\n+        echo \"$HOST_KEY\" >> .ssh/known_hosts\r\n+\r\n+        # strict errors\r\n+        set -eu\r\n+\r\n+        # We have to use a custom RSH to supply the port\r\n+        RSH=\"ssh -o UserKnownHostsFile=.ssh/known_hosts -p $PORT\"\r\n+        DSN=\"$USER@$HOST\"\r\n+\r\n+        # It is important to append '/*' to the source path otherwise\r\n+        # the entire source dir will be created as a sub dir in the destination\r\n+        if [ \"${{ inputs.upload }}\" = true ]\r\n+        then\r\n+          SOURCE=$LOCAL_PATH/*\r\n+          DEST=$DSN:$REMOTE_PATH\r\n+        else\r\n+          SOURCE=$DSN:$REMOTE_PATH/*\r\n+          DEST=$LOCAL_PATH\r\n+        fi\r\n\nReview Comment:\n   ```suggestion\r\n   \r\n           # It is important to append '/' to the source path otherwise\r\n           # the entire source dir will be created as a sub dir in the destination\r\n           if [ \"${{ inputs.upload }}\" = true ]\r\n           then\r\n             SOURCE=$LOCAL_PATH/\r\n             DEST=$DSN:$REMOTE_PATH\r\n           else\r\n             SOURCE=$DSN:$REMOTE_PATH/\r\n             DEST=$LOCAL_PATH\r\n           fi\r\n   \r\n   ```\n\n\n\n",
                    "created": "2022-07-01T09:33:28.443+0000",
                    "updated": "2022-07-01T09:33:28.443+0000",
                    "started": "2022-07-01T09:33:28.443+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "787025",
                    "issueId": "13468311"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13468311/worklog/787026",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "assignUser commented on code in PR #13453:\nURL: https://github.com/apache/arrow/pull/13453#discussion_r911796215\n\n\n##########\n.github/workflows/r_nightly.yml:\n##########\n@@ -77,10 +86,47 @@ jobs:\n             echo \"No files found. Stopping upload.\"\r\n             exit 1\r\n           fi\r\n+      - name: Cache Repo\r\n+        uses: actions/cache@v3\r\n+        with:\r\n+          path: repo\r\n+          key: r-nightly-${{ github.run_id }}\r\n+          restore-keys: r-nightly-\r\n+      - name: Sync from Remote\r\n+        env:\r\n+          RSYNC_PATH: repo\r\n+          SSH_KEY: \"${{ secrets.NIGHTLIES_RSYNC_KEY }}\"\r\n+          PORT: \"${{ secrets.NIGHTLIES_RSYNC_PORT }}\"\r\n+          USER: \"${{ secrets.NIGHTLIES_RSYNC_USER }}\"\r\n+          HOST: \"${{ secrets.NIGHTLIES_RSYNC_HOST }}\"\r\n+          HOST_KEY: \"${{ secrets.NIGHTLIES_RSYNC_HOST_KEY }}\"\r\n+          REMOTE_PATH: \"${{ secrets.NIGHTLIES_RSYNC_PATH }}/arrow/r\"\r\n+        run: |\r\n+            # Make SSH key available and add remote to known hosts\r\n+            eval \"$(ssh-agent)\" > /dev/null\r\n+            echo \"$SSH_KEY\" | tr -d '\\r' | DISPLAY=1 ssh-add - >/dev/null\r\n+            mkdir -p ~/.ssh\r\n+            echo \"$HOST_KEY\" >> ~/.ssh/known_hosts\r\n+\r\n+            # strict errors\r\n+            set -eu\r\n+\r\n+            # avzrh - archive mode, verbose, with compression, recurse into dirs, human readable numbers\r\n+            # transfer only new files, delete files not in source, show progress info\r\n+            RSYNC_SWITCHES=\"-avzrh --update --delete --progress\"\r\n+            # We have to use a custom remote shell to supply the port\r\n+            RSH=\"ssh -p $PORT\"\r\n+            LOCAL_PATH=\"$GITHUB_WORKSPACE/$RSYNC_PATH\"\r\n+            DSN=\"$USER@$HOST\"\r\n+\r\n+            # Deploy. It is important to append '/*' to the source path otherwise\r\n+            # the entire source dir will be created as a sub dir in the destination\r\n+            sh -c \"rsync $RSYNC_SWITCHES -e '$RSH' $DSN:$REMOTE_PATH/* $LOCAL_PATH\"\r\n+      - run: tree repo\r\n\nReview Comment:\n   Yes that works!\n\n\n\n",
                    "created": "2022-07-01T09:34:13.511+0000",
                    "updated": "2022-07-01T09:34:13.511+0000",
                    "started": "2022-07-01T09:34:13.511+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "787026",
                    "issueId": "13468311"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13468311/worklog/787210",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "kou commented on code in PR #13453:\nURL: https://github.com/apache/arrow/pull/13453#discussion_r912220398\n\n\n##########\n.github/actions/sync-nightlies/action.yml:\n##########\n@@ -0,0 +1,95 @@\n+# Licensed to the Apache Software Foundation (ASF) under one\r\n+# or more contributor license agreements.  See the NOTICE file\r\n+# distributed with this work for additional information\r\n+# regarding copyright ownership.  The ASF licenses this file\r\n+# to you under the Apache License, Version 2.0 (the\r\n+# \"License\"); you may not use this file except in compliance\r\n+# with the License.  You may obtain a copy of the License at\r\n+#\r\n+#   http://www.apache.org/licenses/LICENSE-2.0\r\n+#\r\n+# Unless required by applicable law or agreed to in writing,\r\n+# software distributed under the License is distributed on an\r\n+# \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\r\n+# KIND, either express or implied.  See the License for the\r\n+# specific language governing permissions and limitations\r\n+# under the License.\r\n+\r\n+name: 'Sync nightlies'\r\n+description: 'Sync files to and from nightlies.apache.org'\r\n+inputs:\r\n+  upload:\r\n+    description: 'Sync from local to remote'\r\n+    default: false\r\n+    required: false\r\n+  switches:\r\n+    description: 'see rsync --help'\r\n+    required: true\r\n+  local_path:\r\n+    description: 'The relative local path within $GITHUB_WORKSPACE'\r\n+    required: true\r\n+  remote_path:\r\n+    description: 'The remote path incl. sub dirs e.g. {{secrets.path}}/arrow/r'\r\n+    required: true\r\n+  remote_host:\r\n+    description: 'The remote host'\r\n+    required: true\r\n+  remote_port:\r\n+    description: 'The remote port'\r\n+    required: false\r\n+    default: 22\r\n+  remote_user:\r\n+    description: 'The remote user'\r\n+    required: true\r\n+  remote_key:\r\n+    description: 'The remote key'\r\n+    required: true\r\n+  remote_host_key:\r\n+    description: 'The host key for StrictHostKeyChecking'\r\n+\r\n+    required: true\r\n+\r\n+runs:\r\n+  using: \"composite\"\r\n+  steps:\r\n+    - name: Sync files\r\n+      shell: bash\r\n+      env:\r\n+          SWITCHES: \"${{ inputs.switches }}\"\r\n+          LOCAL_PATH: \"${{ github.workspace }}/${{ inputs.local_path }}\"\r\n+\r\n+          SSH_KEY: \"${{ inputs.remote_key }}\"\r\n+          PORT: \"${{ inputs.remote_port }}\"\r\n+          USER: \"${{ inputs.remote_user }}\"\r\n+          HOST: \"${{ inputs.remote_host }}\"\r\n+          HOST_KEY: \"${{ inputs.remote_host_key }}\"\r\n+          REMOTE_PATH: \"${{ inputs.remote_path }}\"\r\n+      run: |\r\n+        # Make SSH key available and add remote to known hosts\r\n+        eval \"$(ssh-agent)\" > /dev/null\r\n+        echo \"$SSH_KEY\" | tr -d '\\r' | ssh-add - >/dev/null\r\n+\r\n+        mkdir -p .ssh\r\n+        chmod go-rwx .ssh\r\n+        echo \"$HOST_KEY\" >> .ssh/known_hosts\r\n+\r\n+        # strict errors\r\n+        set -eu\r\n+\r\n+        # We have to use a custom RSH to supply the port\r\n+        RSH=\"ssh -o UserKnownHostsFile=.ssh/known_hosts -p $PORT\"\r\n+        DSN=\"$USER@$HOST\"\r\n+\r\n+        # It is important to append '/' to the source path otherwise\r\n\nReview Comment:\n   How about appending `/` in caller not here to control how to synchronize by caller?\r\n   \r\n   e.g.:\r\n   \r\n   ```yaml\r\n           with:\r\n             local_path: repo/\r\n   ```\r\n   \r\n   ```yaml\r\n           with:\r\n             remote_path: ${{ secrets.NIGHTLIES_RSYNC_PATH }}/arrow/r/\r\n   ```\r\n   \n\n\n\n",
                    "created": "2022-07-01T19:54:09.946+0000",
                    "updated": "2022-07-01T19:54:09.946+0000",
                    "started": "2022-07-01T19:54:09.946+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "787210",
                    "issueId": "13468311"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13468311/worklog/787221",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "assignUser commented on code in PR #13453:\nURL: https://github.com/apache/arrow/pull/13453#discussion_r912248381\n\n\n##########\n.github/actions/sync-nightlies/action.yml:\n##########\n@@ -0,0 +1,95 @@\n+# Licensed to the Apache Software Foundation (ASF) under one\r\n+# or more contributor license agreements.  See the NOTICE file\r\n+# distributed with this work for additional information\r\n+# regarding copyright ownership.  The ASF licenses this file\r\n+# to you under the Apache License, Version 2.0 (the\r\n+# \"License\"); you may not use this file except in compliance\r\n+# with the License.  You may obtain a copy of the License at\r\n+#\r\n+#   http://www.apache.org/licenses/LICENSE-2.0\r\n+#\r\n+# Unless required by applicable law or agreed to in writing,\r\n+# software distributed under the License is distributed on an\r\n+# \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\r\n+# KIND, either express or implied.  See the License for the\r\n+# specific language governing permissions and limitations\r\n+# under the License.\r\n+\r\n+name: 'Sync nightlies'\r\n+description: 'Sync files to and from nightlies.apache.org'\r\n+inputs:\r\n+  upload:\r\n+    description: 'Sync from local to remote'\r\n+    default: false\r\n+    required: false\r\n+  switches:\r\n+    description: 'see rsync --help'\r\n+    required: true\r\n+  local_path:\r\n+    description: 'The relative local path within $GITHUB_WORKSPACE'\r\n+    required: true\r\n+  remote_path:\r\n+    description: 'The remote path incl. sub dirs e.g. {{secrets.path}}/arrow/r'\r\n+    required: true\r\n+  remote_host:\r\n+    description: 'The remote host'\r\n+    required: true\r\n+  remote_port:\r\n+    description: 'The remote port'\r\n+    required: false\r\n+    default: 22\r\n+  remote_user:\r\n+    description: 'The remote user'\r\n+    required: true\r\n+  remote_key:\r\n+    description: 'The remote key'\r\n+    required: true\r\n+  remote_host_key:\r\n+    description: 'The host key for StrictHostKeyChecking'\r\n+\r\n+    required: true\r\n+\r\n+runs:\r\n+  using: \"composite\"\r\n+  steps:\r\n+    - name: Sync files\r\n+      shell: bash\r\n+      env:\r\n+          SWITCHES: \"${{ inputs.switches }}\"\r\n+          LOCAL_PATH: \"${{ github.workspace }}/${{ inputs.local_path }}\"\r\n+\r\n+          SSH_KEY: \"${{ inputs.remote_key }}\"\r\n+          PORT: \"${{ inputs.remote_port }}\"\r\n+          USER: \"${{ inputs.remote_user }}\"\r\n+          HOST: \"${{ inputs.remote_host }}\"\r\n+          HOST_KEY: \"${{ inputs.remote_host_key }}\"\r\n+          REMOTE_PATH: \"${{ inputs.remote_path }}\"\r\n+      run: |\r\n+        # Make SSH key available and add remote to known hosts\r\n+        eval \"$(ssh-agent)\" > /dev/null\r\n+        echo \"$SSH_KEY\" | tr -d '\\r' | ssh-add - >/dev/null\r\n+\r\n+        mkdir -p .ssh\r\n+        chmod go-rwx .ssh\r\n+        echo \"$HOST_KEY\" >> .ssh/known_hosts\r\n+\r\n+        # strict errors\r\n+        set -eu\r\n+\r\n+        # We have to use a custom RSH to supply the port\r\n+        RSH=\"ssh -o UserKnownHostsFile=.ssh/known_hosts -p $PORT\"\r\n+        DSN=\"$USER@$HOST\"\r\n+\r\n+        # It is important to append '/' to the source path otherwise\r\n\nReview Comment:\n   Than the caller needs to know what happens within the action, which should not be required imho. I see your point about flexibility, this would break if I tried to sync just one file due to the appended `/`.\r\n   \r\n   How about we check if `SOURCE` is a directory or file and only add a slash if it is a directory and does not already have a trailing slash?\n\n\n\n",
                    "created": "2022-07-01T21:01:22.116+0000",
                    "updated": "2022-07-01T21:01:22.116+0000",
                    "started": "2022-07-01T21:01:22.115+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "787221",
                    "issueId": "13468311"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13468311/worklog/787224",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "kou commented on code in PR #13453:\nURL: https://github.com/apache/arrow/pull/13453#discussion_r912251599\n\n\n##########\n.github/actions/sync-nightlies/action.yml:\n##########\n@@ -0,0 +1,95 @@\n+# Licensed to the Apache Software Foundation (ASF) under one\r\n+# or more contributor license agreements.  See the NOTICE file\r\n+# distributed with this work for additional information\r\n+# regarding copyright ownership.  The ASF licenses this file\r\n+# to you under the Apache License, Version 2.0 (the\r\n+# \"License\"); you may not use this file except in compliance\r\n+# with the License.  You may obtain a copy of the License at\r\n+#\r\n+#   http://www.apache.org/licenses/LICENSE-2.0\r\n+#\r\n+# Unless required by applicable law or agreed to in writing,\r\n+# software distributed under the License is distributed on an\r\n+# \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\r\n+# KIND, either express or implied.  See the License for the\r\n+# specific language governing permissions and limitations\r\n+# under the License.\r\n+\r\n+name: 'Sync nightlies'\r\n+description: 'Sync files to and from nightlies.apache.org'\r\n+inputs:\r\n+  upload:\r\n+    description: 'Sync from local to remote'\r\n+    default: false\r\n+    required: false\r\n+  switches:\r\n+    description: 'see rsync --help'\r\n+    required: true\r\n+  local_path:\r\n+    description: 'The relative local path within $GITHUB_WORKSPACE'\r\n+    required: true\r\n+  remote_path:\r\n+    description: 'The remote path incl. sub dirs e.g. {{secrets.path}}/arrow/r'\r\n+    required: true\r\n+  remote_host:\r\n+    description: 'The remote host'\r\n+    required: true\r\n+  remote_port:\r\n+    description: 'The remote port'\r\n+    required: false\r\n+    default: 22\r\n+  remote_user:\r\n+    description: 'The remote user'\r\n+    required: true\r\n+  remote_key:\r\n+    description: 'The remote key'\r\n+    required: true\r\n+  remote_host_key:\r\n+    description: 'The host key for StrictHostKeyChecking'\r\n+\r\n+    required: true\r\n+\r\n+runs:\r\n+  using: \"composite\"\r\n+  steps:\r\n+    - name: Sync files\r\n+      shell: bash\r\n+      env:\r\n+          SWITCHES: \"${{ inputs.switches }}\"\r\n+          LOCAL_PATH: \"${{ github.workspace }}/${{ inputs.local_path }}\"\r\n+\r\n+          SSH_KEY: \"${{ inputs.remote_key }}\"\r\n+          PORT: \"${{ inputs.remote_port }}\"\r\n+          USER: \"${{ inputs.remote_user }}\"\r\n+          HOST: \"${{ inputs.remote_host }}\"\r\n+          HOST_KEY: \"${{ inputs.remote_host_key }}\"\r\n+          REMOTE_PATH: \"${{ inputs.remote_path }}\"\r\n+      run: |\r\n+        # Make SSH key available and add remote to known hosts\r\n+        eval \"$(ssh-agent)\" > /dev/null\r\n+        echo \"$SSH_KEY\" | tr -d '\\r' | ssh-add - >/dev/null\r\n+\r\n+        mkdir -p .ssh\r\n+        chmod go-rwx .ssh\r\n+        echo \"$HOST_KEY\" >> .ssh/known_hosts\r\n+\r\n+        # strict errors\r\n+        set -eu\r\n+\r\n+        # We have to use a custom RSH to supply the port\r\n+        RSH=\"ssh -o UserKnownHostsFile=.ssh/known_hosts -p $PORT\"\r\n+        DSN=\"$USER@$HOST\"\r\n+\r\n+        # It is important to append '/' to the source path otherwise\r\n\nReview Comment:\n   > How about we check if `SOURCE` is a directory or file and only add a slash if it is a directory and does not already have a trailing slash?\r\n   \r\n   If we use this approach, we can't copy `src/` to `dest/src/` by `local_path: src` (no trailing slash).\r\n   \r\n   If you don't like the \"appending `/` in caller` approach, I'm OK with the current approach. But could you add a comment that \"this action supports only directory as source\" or something?\n\n\n\n",
                    "created": "2022-07-01T21:10:23.346+0000",
                    "updated": "2022-07-01T21:10:23.346+0000",
                    "started": "2022-07-01T21:10:23.346+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "787224",
                    "issueId": "13468311"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13468311/worklog/787267",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "kou commented on code in PR #13453:\nURL: https://github.com/apache/arrow/pull/13453#discussion_r912251599\n\n\n##########\n.github/actions/sync-nightlies/action.yml:\n##########\n@@ -0,0 +1,95 @@\n+# Licensed to the Apache Software Foundation (ASF) under one\r\n+# or more contributor license agreements.  See the NOTICE file\r\n+# distributed with this work for additional information\r\n+# regarding copyright ownership.  The ASF licenses this file\r\n+# to you under the Apache License, Version 2.0 (the\r\n+# \"License\"); you may not use this file except in compliance\r\n+# with the License.  You may obtain a copy of the License at\r\n+#\r\n+#   http://www.apache.org/licenses/LICENSE-2.0\r\n+#\r\n+# Unless required by applicable law or agreed to in writing,\r\n+# software distributed under the License is distributed on an\r\n+# \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\r\n+# KIND, either express or implied.  See the License for the\r\n+# specific language governing permissions and limitations\r\n+# under the License.\r\n+\r\n+name: 'Sync nightlies'\r\n+description: 'Sync files to and from nightlies.apache.org'\r\n+inputs:\r\n+  upload:\r\n+    description: 'Sync from local to remote'\r\n+    default: false\r\n+    required: false\r\n+  switches:\r\n+    description: 'see rsync --help'\r\n+    required: true\r\n+  local_path:\r\n+    description: 'The relative local path within $GITHUB_WORKSPACE'\r\n+    required: true\r\n+  remote_path:\r\n+    description: 'The remote path incl. sub dirs e.g. {{secrets.path}}/arrow/r'\r\n+    required: true\r\n+  remote_host:\r\n+    description: 'The remote host'\r\n+    required: true\r\n+  remote_port:\r\n+    description: 'The remote port'\r\n+    required: false\r\n+    default: 22\r\n+  remote_user:\r\n+    description: 'The remote user'\r\n+    required: true\r\n+  remote_key:\r\n+    description: 'The remote key'\r\n+    required: true\r\n+  remote_host_key:\r\n+    description: 'The host key for StrictHostKeyChecking'\r\n+\r\n+    required: true\r\n+\r\n+runs:\r\n+  using: \"composite\"\r\n+  steps:\r\n+    - name: Sync files\r\n+      shell: bash\r\n+      env:\r\n+          SWITCHES: \"${{ inputs.switches }}\"\r\n+          LOCAL_PATH: \"${{ github.workspace }}/${{ inputs.local_path }}\"\r\n+\r\n+          SSH_KEY: \"${{ inputs.remote_key }}\"\r\n+          PORT: \"${{ inputs.remote_port }}\"\r\n+          USER: \"${{ inputs.remote_user }}\"\r\n+          HOST: \"${{ inputs.remote_host }}\"\r\n+          HOST_KEY: \"${{ inputs.remote_host_key }}\"\r\n+          REMOTE_PATH: \"${{ inputs.remote_path }}\"\r\n+      run: |\r\n+        # Make SSH key available and add remote to known hosts\r\n+        eval \"$(ssh-agent)\" > /dev/null\r\n+        echo \"$SSH_KEY\" | tr -d '\\r' | ssh-add - >/dev/null\r\n+\r\n+        mkdir -p .ssh\r\n+        chmod go-rwx .ssh\r\n+        echo \"$HOST_KEY\" >> .ssh/known_hosts\r\n+\r\n+        # strict errors\r\n+        set -eu\r\n+\r\n+        # We have to use a custom RSH to supply the port\r\n+        RSH=\"ssh -o UserKnownHostsFile=.ssh/known_hosts -p $PORT\"\r\n+        DSN=\"$USER@$HOST\"\r\n+\r\n+        # It is important to append '/' to the source path otherwise\r\n\nReview Comment:\n   > How about we check if `SOURCE` is a directory or file and only add a slash if it is a directory and does not already have a trailing slash?\r\n   \r\n   If we use this approach, we can't copy `src/` to `dest/src/` by `local_path: src` (no trailing slash).\r\n   \r\n   If you don't like the \"appending `/` in caller\" approach, I'm OK with the current approach. But could you add a comment that \"this action supports only directory as source\" or something?\n\n\n\n",
                    "created": "2022-07-02T00:44:02.477+0000",
                    "updated": "2022-07-02T00:44:02.477+0000",
                    "started": "2022-07-02T00:44:02.477+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "787267",
                    "issueId": "13468311"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13468311/worklog/787699",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "kou commented on code in PR #13453:\nURL: https://github.com/apache/arrow/pull/13453#discussion_r913266454\n\n\n##########\n.github/actions/sync-nightlies/README.md:\n##########\n@@ -0,0 +1,51 @@\n+# Sync Nightlies\r\n\nReview Comment:\n   Could you add a license header?\n\n\n\n",
                    "created": "2022-07-04T21:07:04.037+0000",
                    "updated": "2022-07-04T21:07:04.037+0000",
                    "started": "2022-07-04T21:07:04.036+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "787699",
                    "issueId": "13468311"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13468311/worklog/788116",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "kou merged PR #13453:\nURL: https://github.com/apache/arrow/pull/13453\n\n\n",
                    "created": "2022-07-06T02:47:48.825+0000",
                    "updated": "2022-07-06T02:47:48.825+0000",
                    "started": "2022-07-06T02:47:48.824+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "788116",
                    "issueId": "13468311"
                }
            ]
        },
        "customfield_12313920": null,
        "issuetype": {
            "self": "https://issues.apache.org/jira/rest/api/2/issuetype/7",
            "id": "7",
            "description": "The sub-task of the issue",
            "iconUrl": "https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21146&avatarType=issuetype",
            "name": "Sub-task",
            "subtask": true,
            "avatarId": 21146
        },
        "timespent": 12000,
        "customfield_12314020": "{summaryBean=com.atlassian.jira.plugin.devstatus.rest.SummaryBean@7a0b2e39[summary={pullrequest=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@7551eafa[overall=PullRequestOverallBean{stateCount=0, state='OPEN', details=PullRequestOverallDetails{openCount=0, mergedCount=0, declinedCount=0}},byInstanceType={}], build=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@5790d457[overall=com.atlassian.jira.plugin.devstatus.summary.beans.BuildOverallBean@2d6cf265[failedBuildCount=0,successfulBuildCount=0,unknownBuildCount=0,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], review=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@3132df41[overall=com.atlassian.jira.plugin.devstatus.summary.beans.ReviewsOverallBean@f75ee28[stateCount=0,state=<null>,dueDate=<null>,overDue=false,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], deployment-environment=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@5e16b1fd[overall=com.atlassian.jira.plugin.devstatus.summary.beans.DeploymentOverallBean@14a39f80[topEnvironments=[],showProjects=false,successfulCount=0,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], repository=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@33cc8282[overall=com.atlassian.jira.plugin.devstatus.summary.beans.CommitOverallBean@13683e7d[count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], branch=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@781afcb4[overall=com.atlassian.jira.plugin.devstatus.summary.beans.BranchOverallBean@704d23a8[count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}]},errors=[],configErrors=[]], devSummaryJson={\"cachedValue\":{\"errors\":[],\"configErrors\":[],\"summary\":{\"pullrequest\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"stateCount\":0,\"state\":\"OPEN\",\"details\":{\"openCount\":0,\"mergedCount\":0,\"declinedCount\":0,\"total\":0},\"open\":true},\"byInstanceType\":{}},\"build\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"failedBuildCount\":0,\"successfulBuildCount\":0,\"unknownBuildCount\":0},\"byInstanceType\":{}},\"review\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"stateCount\":0,\"state\":null,\"dueDate\":null,\"overDue\":false,\"completed\":false},\"byInstanceType\":{}},\"deployment-environment\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"topEnvironments\":[],\"showProjects\":false,\"successfulCount\":0},\"byInstanceType\":{}},\"repository\":{\"overall\":{\"count\":0,\"lastUpdated\":null},\"byInstanceType\":{}},\"branch\":{\"overall\":{\"count\":0,\"lastUpdated\":null},\"byInstanceType\":{}}}},\"isStale\":false}}",
        "customfield_12314141": null,
        "customfield_12314140": null,
        "project": {
            "self": "https://issues.apache.org/jira/rest/api/2/project/12319525",
            "id": "12319525",
            "key": "ARROW",
            "name": "Apache Arrow",
            "projectTypeKey": "software",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/projectavatar?pid=12319525&avatarId=10011",
                "24x24": "https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12319525&avatarId=10011",
                "16x16": "https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12319525&avatarId=10011",
                "32x32": "https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12319525&avatarId=10011"
            },
            "projectCategory": {
                "self": "https://issues.apache.org/jira/rest/api/2/projectCategory/13960",
                "id": "13960",
                "description": "Apache Arrow",
                "name": "Arrow"
            }
        },
        "aggregatetimespent": 12000,
        "customfield_12312520": null,
        "customfield_12312521": "Wed Jul 06 02:48:38 UTC 2022",
        "customfield_12314422": null,
        "customfield_12314421": null,
        "customfield_12314146": null,
        "customfield_12314420": null,
        "customfield_12314145": null,
        "customfield_12314144": null,
        "customfield_12314143": null,
        "resolutiondate": "2022-07-06T02:48:38.000+0000",
        "workratio": -1,
        "customfield_12312923": null,
        "customfield_12312920": null,
        "customfield_12312921": null,
        "watches": {
            "self": "https://issues.apache.org/jira/rest/api/2/issue/ARROW-16901/watchers",
            "watchCount": 1,
            "isWatching": false
        },
        "created": "2022-06-24T14:18:10.000+0000",
        "updated": "2022-07-06T02:48:38.000+0000",
        "timeoriginalestimate": null,
        "description": "We only want to keep 14days/versions and remove everything else",
        "customfield_10010": null,
        "timetracking": {
            "remainingEstimate": "0h",
            "timeSpent": "3h 20m",
            "remainingEstimateSeconds": 0,
            "timeSpentSeconds": 12000
        },
        "customfield_12314523": null,
        "customfield_12314127": null,
        "customfield_12314522": null,
        "customfield_12314126": null,
        "customfield_12314521": null,
        "customfield_12314125": null,
        "customfield_12314520": null,
        "customfield_12314124": null,
        "attachment": [],
        "customfield_12312340": null,
        "customfield_12314123": null,
        "customfield_12312341": null,
        "customfield_12312220": null,
        "customfield_12314122": null,
        "customfield_12314121": null,
        "customfield_12314120": null,
        "customfield_12314129": null,
        "customfield_12314524": null,
        "customfield_12314128": null,
        "summary": "[R][CI] Prune R nightly builds",
        "customfield_12314130": null,
        "customfield_12310291": null,
        "customfield_12310290": null,
        "customfield_12314138": null,
        "customfield_12314137": null,
        "environment": null,
        "customfield_12314136": null,
        "customfield_12314135": null,
        "customfield_12311020": null,
        "customfield_12314134": null,
        "duedate": null,
        "customfield_12314132": null,
        "customfield_12314131": null,
        "comment": {
            "comments": [
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13468311/comment/17562927",
                    "id": "17562927",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=kou",
                        "name": "kou",
                        "key": "kou",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=kou&avatarId=30762",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kou&avatarId=30762",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kou&avatarId=30762",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kou&avatarId=30762"
                        },
                        "displayName": "Kouhei Sutou",
                        "active": true,
                        "timeZone": "Asia/Tokyo"
                    },
                    "body": "Issue resolved by pull request 13453\n[https://github.com/apache/arrow/pull/13453]",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=kou",
                        "name": "kou",
                        "key": "kou",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=kou&avatarId=30762",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=kou&avatarId=30762",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=kou&avatarId=30762",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=kou&avatarId=30762"
                        },
                        "displayName": "Kouhei Sutou",
                        "active": true,
                        "timeZone": "Asia/Tokyo"
                    },
                    "created": "2022-07-06T02:48:38.763+0000",
                    "updated": "2022-07-06T02:48:38.763+0000"
                }
            ],
            "maxResults": 1,
            "total": 1,
            "startAt": 0
        },
        "customfield_12311820": "0|z16ca8:",
        "customfield_12314139": null
    }
}