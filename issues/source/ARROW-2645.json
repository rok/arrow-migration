{
    "expand": "operations,versionedRepresentations,editmeta,changelog,renderedFields",
    "id": "13162735",
    "self": "https://issues.apache.org/jira/rest/api/2/issue/13162735",
    "key": "ARROW-2645",
    "fields": {
        "fixVersions": [
            {
                "self": "https://issues.apache.org/jira/rest/api/2/version/12342562",
                "id": "12342562",
                "description": "",
                "name": "0.10.0",
                "archived": false,
                "released": true,
                "releaseDate": "2018-08-06"
            }
        ],
        "resolution": {
            "self": "https://issues.apache.org/jira/rest/api/2/resolution/1",
            "id": "1",
            "description": "A fix for this issue is checked into the tree and tested.",
            "name": "Fixed"
        },
        "customfield_12312322": null,
        "customfield_12312323": null,
        "customfield_12312320": null,
        "customfield_12310420": "9223372036854775807",
        "customfield_12312321": null,
        "customfield_12312328": null,
        "customfield_12312329": null,
        "customfield_12312326": null,
        "customfield_12310300": null,
        "customfield_12312327": null,
        "customfield_12312324": null,
        "customfield_12312720": null,
        "customfield_12312325": null,
        "lastViewed": null,
        "priority": {
            "self": "https://issues.apache.org/jira/rest/api/2/priority/3",
            "iconUrl": "https://issues.apache.org/jira/images/icons/priorities/major.svg",
            "name": "Major",
            "id": "3"
        },
        "labels": [
            "pull-request-available"
        ],
        "customfield_12312333": null,
        "customfield_12312334": null,
        "customfield_12313422": "false",
        "customfield_12310310": "0.0",
        "customfield_12312331": null,
        "customfield_12312332": null,
        "aggregatetimeoriginalestimate": null,
        "timeestimate": 0,
        "customfield_12312330": null,
        "versions": [],
        "customfield_12311120": null,
        "customfield_12313826": null,
        "customfield_12312339": null,
        "issuelinks": [
            {
                "id": "12535314",
                "self": "https://issues.apache.org/jira/rest/api/2/issueLink/12535314",
                "type": {
                    "id": "10030",
                    "name": "Reference",
                    "inward": "is related to",
                    "outward": "relates to",
                    "self": "https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"
                },
                "inwardIssue": {
                    "id": "13161532",
                    "key": "ARROW-2632",
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13161532",
                    "fields": {
                        "summary": "[Java] ArrowStreamWriter accumulates ArrowBlock but does not use them",
                        "status": {
                            "self": "https://issues.apache.org/jira/rest/api/2/status/5",
                            "description": "A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.",
                            "iconUrl": "https://issues.apache.org/jira/images/icons/statuses/resolved.png",
                            "name": "Resolved",
                            "id": "5",
                            "statusCategory": {
                                "self": "https://issues.apache.org/jira/rest/api/2/statuscategory/3",
                                "id": 3,
                                "key": "done",
                                "colorName": "green",
                                "name": "Done"
                            }
                        },
                        "priority": {
                            "self": "https://issues.apache.org/jira/rest/api/2/priority/3",
                            "iconUrl": "https://issues.apache.org/jira/images/icons/priorities/major.svg",
                            "name": "Major",
                            "id": "3"
                        },
                        "issuetype": {
                            "self": "https://issues.apache.org/jira/rest/api/2/issuetype/1",
                            "id": "1",
                            "description": "A problem which impairs or prevents the functions of the product.",
                            "iconUrl": "https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype",
                            "name": "Bug",
                            "subtask": false,
                            "avatarId": 21133
                        }
                    }
                }
            }
        ],
        "customfield_12313825": null,
        "assignee": {
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=bryanc",
            "name": "bryanc",
            "key": "bryanc",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=bryanc&avatarId=23479",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=bryanc&avatarId=23479",
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=bryanc&avatarId=23479",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=bryanc&avatarId=23479"
            },
            "displayName": "Bryan Cutler",
            "active": true,
            "timeZone": "America/Los_Angeles"
        },
        "customfield_12312337": null,
        "customfield_12313823": null,
        "customfield_12312338": null,
        "customfield_12311920": null,
        "customfield_12313822": null,
        "customfield_12312335": null,
        "customfield_12313821": null,
        "customfield_12312336": null,
        "customfield_12313820": null,
        "status": {
            "self": "https://issues.apache.org/jira/rest/api/2/status/5",
            "description": "A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.",
            "iconUrl": "https://issues.apache.org/jira/images/icons/statuses/resolved.png",
            "name": "Resolved",
            "id": "5",
            "statusCategory": {
                "self": "https://issues.apache.org/jira/rest/api/2/statuscategory/3",
                "id": 3,
                "key": "done",
                "colorName": "green",
                "name": "Done"
            }
        },
        "components": [
            {
                "self": "https://issues.apache.org/jira/rest/api/2/component/12328933",
                "id": "12328933",
                "name": "Java"
            }
        ],
        "customfield_12312026": null,
        "customfield_12312023": null,
        "customfield_12312024": null,
        "aggregatetimeestimate": 0,
        "customfield_12312022": null,
        "customfield_12310921": null,
        "customfield_12310920": "9223372036854775807",
        "customfield_12312823": null,
        "creator": {
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=bryanc",
            "name": "bryanc",
            "key": "bryanc",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=bryanc&avatarId=23479",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=bryanc&avatarId=23479",
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=bryanc&avatarId=23479",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=bryanc&avatarId=23479"
            },
            "displayName": "Bryan Cutler",
            "active": true,
            "timeZone": "America/Los_Angeles"
        },
        "subtasks": [],
        "reporter": {
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=bryanc",
            "name": "bryanc",
            "key": "bryanc",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=bryanc&avatarId=23479",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=bryanc&avatarId=23479",
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=bryanc&avatarId=23479",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=bryanc&avatarId=23479"
            },
            "displayName": "Bryan Cutler",
            "active": true,
            "timeZone": "America/Los_Angeles"
        },
        "aggregateprogress": {
            "progress": 6600,
            "total": 6600,
            "percent": 100
        },
        "customfield_12313520": null,
        "customfield_12310250": null,
        "progress": {
            "progress": 6600,
            "total": 6600,
            "percent": 100
        },
        "customfield_12313924": null,
        "votes": {
            "self": "https://issues.apache.org/jira/rest/api/2/issue/ARROW-2645/votes",
            "votes": 0,
            "hasVoted": false
        },
        "worklog": {
            "startAt": 0,
            "maxResults": 20,
            "total": 11,
            "worklogs": [
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13162735/worklog/106949",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "BryanCutler opened a new pull request #2090: ARROW-2645: [Java] Fixed ArrowStreamWriter from accumulating Dictionary batch blocks\nURL: https://github.com/apache/arrow/pull/2090\n \n \n   Related to #2079 , the DictionaryBatch `ArrowBlock`s were being accumulated in the base class and used by `ArrowFileWriter` and not `ArrowStreamWriter`.  This refactors the `ArrowWriter` to move Lists of ArrowBlocks from the base class to only `ArrowWriter`. \n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2018-05-29T23:43:08.248+0000",
                    "updated": "2018-05-29T23:43:08.248+0000",
                    "started": "2018-05-29T23:43:08.247+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "106949",
                    "issueId": "13162735"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13162735/worklog/106950",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "BryanCutler commented on issue #2090: ARROW-2645: [Java] Fixed ArrowStreamWriter from accumulating Dictionary batch blocks\nURL: https://github.com/apache/arrow/pull/2090#issuecomment-392983154\n \n \n   cc @siddharthteotia\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2018-05-29T23:43:38.089+0000",
                    "updated": "2018-05-29T23:43:38.089+0000",
                    "started": "2018-05-29T23:43:38.088+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "106950",
                    "issueId": "13162735"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13162735/worklog/107759",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "BryanCutler commented on issue #2090: ARROW-2645: [Java] Fixed ArrowStreamWriter from accumulating Dictionary batch blocks\nURL: https://github.com/apache/arrow/pull/2090#issuecomment-393604218\n \n \n   @icexelloss, please review if you can, thanks!\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2018-05-31T17:08:48.245+0000",
                    "updated": "2018-05-31T17:08:48.245+0000",
                    "started": "2018-05-31T17:08:48.244+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "107759",
                    "issueId": "13162735"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13162735/worklog/107765",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "icexelloss commented on issue #2090: ARROW-2645: [Java] Fixed ArrowStreamWriter from accumulating Dictionary batch blocks\nURL: https://github.com/apache/arrow/pull/2090#issuecomment-393609144\n \n \n   @BryanCutler does this PR refactor out file format specific logic from ArrowWriter to ArrowFileWriter?\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2018-05-31T17:24:38.639+0000",
                    "updated": "2018-05-31T17:24:38.639+0000",
                    "started": "2018-05-31T17:24:38.638+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "107765",
                    "issueId": "13162735"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13162735/worklog/107769",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "icexelloss commented on a change in pull request #2090: ARROW-2645: [Java] Fixed ArrowStreamWriter from accumulating Dictionary batch blocks\nURL: https://github.com/apache/arrow/pull/2090#discussion_r192176877\n \n \n\n ##########\n File path: java/vector/src/main/java/org/apache/arrow/vector/ipc/ArrowFileWriter.java\n ##########\n @@ -20,20 +20,27 @@\n \n import java.io.IOException;\n import java.nio.channels.WritableByteChannel;\n+import java.util.ArrayList;\n import java.util.List;\n \n+import com.google.common.annotations.VisibleForTesting;\n+\n import org.apache.arrow.vector.VectorSchemaRoot;\n import org.apache.arrow.vector.dictionary.DictionaryProvider;\n import org.apache.arrow.vector.ipc.message.ArrowBlock;\n+import org.apache.arrow.vector.ipc.message.ArrowDictionaryBatch;\n import org.apache.arrow.vector.ipc.message.ArrowFooter;\n-import org.apache.arrow.vector.types.pojo.Schema;\n+import org.apache.arrow.vector.ipc.message.ArrowRecordBatch;\n import org.slf4j.Logger;\n import org.slf4j.LoggerFactory;\n \n public class ArrowFileWriter extends ArrowWriter {\n \n   private static final Logger LOGGER = LoggerFactory.getLogger(ArrowFileWriter.class);\n \n+  private final List<ArrowBlock> dictionaryBlocks = new ArrayList<>();\n \n Review comment:\n   Can you add a comment on the purpose of these two lists here?\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2018-05-31T17:29:36.109+0000",
                    "updated": "2018-05-31T17:29:36.109+0000",
                    "started": "2018-05-31T17:29:36.108+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "107769",
                    "issueId": "13162735"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13162735/worklog/107770",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "BryanCutler commented on issue #2090: ARROW-2645: [Java] Fixed ArrowStreamWriter from accumulating Dictionary batch blocks\nURL: https://github.com/apache/arrow/pull/2090#issuecomment-393610991\n \n \n   > @BryanCutler does this PR refactor out file format specific logic from ArrowWriter to ArrowFileWriter?\r\n   \r\n   Yes, specifically saving `ArrowBlock`s written to a list so they can be used in `ArrowFileWriter.endInternal`\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2018-05-31T17:30:18.534+0000",
                    "updated": "2018-05-31T17:30:18.534+0000",
                    "started": "2018-05-31T17:30:18.534+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "107770",
                    "issueId": "13162735"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13162735/worklog/107771",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "BryanCutler commented on a change in pull request #2090: ARROW-2645: [Java] Fixed ArrowStreamWriter from accumulating Dictionary batch blocks\nURL: https://github.com/apache/arrow/pull/2090#discussion_r192177184\n \n \n\n ##########\n File path: java/vector/src/main/java/org/apache/arrow/vector/ipc/ArrowFileWriter.java\n ##########\n @@ -20,20 +20,27 @@\n \n import java.io.IOException;\n import java.nio.channels.WritableByteChannel;\n+import java.util.ArrayList;\n import java.util.List;\n \n+import com.google.common.annotations.VisibleForTesting;\n+\n import org.apache.arrow.vector.VectorSchemaRoot;\n import org.apache.arrow.vector.dictionary.DictionaryProvider;\n import org.apache.arrow.vector.ipc.message.ArrowBlock;\n+import org.apache.arrow.vector.ipc.message.ArrowDictionaryBatch;\n import org.apache.arrow.vector.ipc.message.ArrowFooter;\n-import org.apache.arrow.vector.types.pojo.Schema;\n+import org.apache.arrow.vector.ipc.message.ArrowRecordBatch;\n import org.slf4j.Logger;\n import org.slf4j.LoggerFactory;\n \n public class ArrowFileWriter extends ArrowWriter {\n \n   private static final Logger LOGGER = LoggerFactory.getLogger(ArrowFileWriter.class);\n \n+  private final List<ArrowBlock> dictionaryBlocks = new ArrayList<>();\n \n Review comment:\n   sure\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2018-05-31T17:30:35.836+0000",
                    "updated": "2018-05-31T17:30:35.836+0000",
                    "started": "2018-05-31T17:30:35.836+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "107771",
                    "issueId": "13162735"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13162735/worklog/107777",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "icexelloss commented on issue #2090: ARROW-2645: [Java] Fixed ArrowStreamWriter from accumulating Dictionary batch blocks\nURL: https://github.com/apache/arrow/pull/2090#issuecomment-393613913\n \n \n   Maybe it makes more sense to change the PR title to be\r\n   \r\n   \"Refactor record batch and dictionary batch accumulating logic from ArrowWriter to ArrowFileWriter\"\r\n   \r\n   (at least more understandable to me) but this is minor so your call @BryanCutler \n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2018-05-31T17:39:39.593+0000",
                    "updated": "2018-05-31T17:39:39.593+0000",
                    "started": "2018-05-31T17:39:39.593+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "107777",
                    "issueId": "13162735"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13162735/worklog/107788",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "BryanCutler commented on issue #2090: ARROW-2645: [Java] Refactor ArrowWriter to remove all ArrowFileWriter specifc logic\nURL: https://github.com/apache/arrow/pull/2090#issuecomment-393622133\n \n \n   Thanks for reviewing @icexelloss !\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2018-05-31T18:04:52.203+0000",
                    "updated": "2018-05-31T18:04:52.203+0000",
                    "started": "2018-05-31T18:04:52.202+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "107788",
                    "issueId": "13162735"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13162735/worklog/107920",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "BryanCutler closed pull request #2090: ARROW-2645: [Java] Refactor ArrowWriter to remove all ArrowFileWriter specifc logic\nURL: https://github.com/apache/arrow/pull/2090\n \n \n   \n\nThis is a PR merged from a forked repository.\nAs GitHub hides the original diff on merge, it is displayed below for\nthe sake of provenance:\n\nAs this is a foreign pull request (from a fork), the diff is supplied\nbelow (as it won't show otherwise due to GitHub magic):\n\ndiff --git a/java/tools/src/test/java/org/apache/arrow/tools/EchoServerTest.java b/java/tools/src/test/java/org/apache/arrow/tools/EchoServerTest.java\nindex 2674c7bdc7..47b5541d17 100644\n--- a/java/tools/src/test/java/org/apache/arrow/tools/EchoServerTest.java\n+++ b/java/tools/src/test/java/org/apache/arrow/tools/EchoServerTest.java\n@@ -112,7 +112,6 @@ private void testEchoServer(int serverPort,\n         writer.writeBatch();\n       }\n       writer.end();\n-      assertTrue(writer.getRecordBlocks().isEmpty());\n \n       assertEquals(new Schema(asList(field)), reader.getVectorSchemaRoot().getSchema());\n \ndiff --git a/java/vector/src/main/java/org/apache/arrow/vector/ipc/ArrowFileWriter.java b/java/vector/src/main/java/org/apache/arrow/vector/ipc/ArrowFileWriter.java\nindex 1b687c9f26..832608aaf6 100644\n--- a/java/vector/src/main/java/org/apache/arrow/vector/ipc/ArrowFileWriter.java\n+++ b/java/vector/src/main/java/org/apache/arrow/vector/ipc/ArrowFileWriter.java\n@@ -20,13 +20,17 @@\n \n import java.io.IOException;\n import java.nio.channels.WritableByteChannel;\n+import java.util.ArrayList;\n import java.util.List;\n \n+import com.google.common.annotations.VisibleForTesting;\n+\n import org.apache.arrow.vector.VectorSchemaRoot;\n import org.apache.arrow.vector.dictionary.DictionaryProvider;\n import org.apache.arrow.vector.ipc.message.ArrowBlock;\n+import org.apache.arrow.vector.ipc.message.ArrowDictionaryBatch;\n import org.apache.arrow.vector.ipc.message.ArrowFooter;\n-import org.apache.arrow.vector.types.pojo.Schema;\n+import org.apache.arrow.vector.ipc.message.ArrowRecordBatch;\n import org.slf4j.Logger;\n import org.slf4j.LoggerFactory;\n \n@@ -34,6 +38,10 @@\n \n   private static final Logger LOGGER = LoggerFactory.getLogger(ArrowFileWriter.class);\n \n+  // All ArrowBlocks written are saved in these lists to be passed to ArrowFooter in endInternal.\n+  private final List<ArrowBlock> dictionaryBlocks = new ArrayList<>();\n+  private final List<ArrowBlock> recordBlocks = new ArrayList<>();\n+\n   public ArrowFileWriter(VectorSchemaRoot root, DictionaryProvider provider, WritableByteChannel out) {\n     super(root, provider, out);\n   }\n@@ -44,12 +52,23 @@ protected void startInternal(WriteChannel out) throws IOException {\n   }\n \n   @Override\n-  protected void endInternal(WriteChannel out,\n-                             Schema schema,\n-                             List<ArrowBlock> dictionaries,\n-                             List<ArrowBlock> records) throws IOException {\n+  protected ArrowBlock writeDictionaryBatch(ArrowDictionaryBatch batch) throws IOException {\n+    ArrowBlock block = super.writeDictionaryBatch(batch);\n+    dictionaryBlocks.add(block);\n+    return block;\n+  }\n+\n+  @Override\n+  protected ArrowBlock writeRecordBatch(ArrowRecordBatch batch) throws IOException {\n+    ArrowBlock block = super.writeRecordBatch(batch);\n+    recordBlocks.add(block);\n+    return block;\n+  }\n+\n+  @Override\n+  protected void endInternal(WriteChannel out) throws IOException {\n     long footerStart = out.getCurrentPosition();\n-    out.write(new ArrowFooter(schema, dictionaries, records), false);\n+    out.write(new ArrowFooter(schema, dictionaryBlocks, recordBlocks), false);\n     int footerLength = (int) (out.getCurrentPosition() - footerStart);\n     if (footerLength <= 0) {\n       throw new InvalidArrowFileException(\"invalid footer\");\n@@ -59,4 +78,14 @@ protected void endInternal(WriteChannel out,\n     ArrowMagic.writeMagic(out, false);\n     LOGGER.debug(String.format(\"magic written, now at %d\", out.getCurrentPosition()));\n   }\n+\n+  @VisibleForTesting\n+  public List<ArrowBlock> getRecordBlocks() {\n+    return recordBlocks;\n+  }\n+\n+  @VisibleForTesting\n+  public List<ArrowBlock> getDictionaryBlocks() {\n+    return dictionaryBlocks;\n+  }\n }\ndiff --git a/java/vector/src/main/java/org/apache/arrow/vector/ipc/ArrowStreamWriter.java b/java/vector/src/main/java/org/apache/arrow/vector/ipc/ArrowStreamWriter.java\nindex 14e6add55d..784ce08276 100644\n--- a/java/vector/src/main/java/org/apache/arrow/vector/ipc/ArrowStreamWriter.java\n+++ b/java/vector/src/main/java/org/apache/arrow/vector/ipc/ArrowStreamWriter.java\n@@ -20,18 +20,11 @@\n \n import org.apache.arrow.vector.VectorSchemaRoot;\n import org.apache.arrow.vector.dictionary.DictionaryProvider;\n-import org.apache.arrow.vector.ipc.message.ArrowBlock;\n-import org.apache.arrow.vector.ipc.ArrowWriter;\n-import org.apache.arrow.vector.ipc.WriteChannel;\n-import org.apache.arrow.vector.ipc.message.ArrowRecordBatch;\n-import org.apache.arrow.vector.ipc.message.MessageSerializer;\n-import org.apache.arrow.vector.types.pojo.Schema;\n \n import java.io.IOException;\n import java.io.OutputStream;\n import java.nio.channels.Channels;\n import java.nio.channels.WritableByteChannel;\n-import java.util.List;\n \n public class ArrowStreamWriter extends ArrowWriter {\n \n@@ -48,17 +41,7 @@ protected void startInternal(WriteChannel out) throws IOException {\n   }\n \n   @Override\n-  protected void endInternal(WriteChannel out,\n-                             Schema schema,\n-                             List<ArrowBlock> dictionaries,\n-                             List<ArrowBlock> records) throws IOException {\n+  protected void endInternal(WriteChannel out) throws IOException {\n     out.writeIntLittleEndian(0);\n   }\n-\n-  @Override\n-  protected void writeRecordBatch(ArrowRecordBatch batch) throws IOException {\n-    ArrowBlock block = MessageSerializer.serialize(out, batch);\n-    LOGGER.debug(String.format(\"RecordBatch at %d, metadata: %d, body: %d\",\n-        block.getOffset(), block.getMetadataLength(), block.getBodyLength()));\n-  }\n }\ndiff --git a/java/vector/src/main/java/org/apache/arrow/vector/ipc/ArrowWriter.java b/java/vector/src/main/java/org/apache/arrow/vector/ipc/ArrowWriter.java\nindex d9d05346a2..8bc64027bc 100644\n--- a/java/vector/src/main/java/org/apache/arrow/vector/ipc/ArrowWriter.java\n+++ b/java/vector/src/main/java/org/apache/arrow/vector/ipc/ArrowWriter.java\n@@ -25,7 +25,6 @@\n import java.util.List;\n import java.util.Set;\n \n-import com.google.common.annotations.VisibleForTesting;\n import org.apache.arrow.vector.FieldVector;\n import org.apache.arrow.vector.VectorSchemaRoot;\n import org.apache.arrow.vector.VectorUnloader;\n@@ -48,15 +47,12 @@\n   protected static final Logger LOGGER = LoggerFactory.getLogger(ArrowWriter.class);\n \n   // schema with fields in message format, not memory format\n-  private final Schema schema;\n+  protected final Schema schema;\n   protected final WriteChannel out;\n \n   private final VectorUnloader unloader;\n   private final List<ArrowDictionaryBatch> dictionaries;\n \n-  private final List<ArrowBlock> dictionaryBlocks = new ArrayList<>();\n-  private final List<ArrowBlock> recordBlocks = new ArrayList<>();\n-\n   private boolean started = false;\n   private boolean ended = false;\n \n@@ -105,11 +101,18 @@ public void writeBatch() throws IOException {\n     }\n   }\n \n-  protected void writeRecordBatch(ArrowRecordBatch batch) throws IOException {\n+  protected ArrowBlock writeDictionaryBatch(ArrowDictionaryBatch batch) throws IOException {\n+    ArrowBlock block = MessageSerializer.serialize(out, batch);\n+    LOGGER.debug(String.format(\"DictionaryRecordBatch at %d, metadata: %d, body: %d\",\n+      block.getOffset(), block.getMetadataLength(), block.getBodyLength()));\n+    return block;\n+  }\n+\n+  protected ArrowBlock writeRecordBatch(ArrowRecordBatch batch) throws IOException {\n     ArrowBlock block = MessageSerializer.serialize(out, batch);\n     LOGGER.debug(String.format(\"RecordBatch at %d, metadata: %d, body: %d\",\n-        block.getOffset(), block.getMetadataLength(), block.getBodyLength()));\n-    recordBlocks.add(block);\n+      block.getOffset(), block.getMetadataLength(), block.getBodyLength()));\n+    return block;\n   }\n \n   public void end() throws IOException {\n@@ -131,10 +134,7 @@ private void ensureStarted() throws IOException {\n       // write out any dictionaries\n       for (ArrowDictionaryBatch batch : dictionaries) {\n         try {\n-          ArrowBlock block = MessageSerializer.serialize(out, batch);\n-          LOGGER.debug(String.format(\"DictionaryRecordBatch at %d, metadata: %d, body: %d\",\n-              block.getOffset(), block.getMetadataLength(), block.getBodyLength()));\n-          dictionaryBlocks.add(block);\n+          writeDictionaryBatch(batch);\n         } finally {\n           batch.close();\n         }\n@@ -145,16 +145,13 @@ private void ensureStarted() throws IOException {\n   private void ensureEnded() throws IOException {\n     if (!ended) {\n       ended = true;\n-      endInternal(out, schema, dictionaryBlocks, recordBlocks);\n+      endInternal(out);\n     }\n   }\n \n   protected abstract void startInternal(WriteChannel out) throws IOException;\n \n-  protected abstract void endInternal(WriteChannel out,\n-                                      Schema schema,\n-                                      List<ArrowBlock> dictionaries,\n-                                      List<ArrowBlock> records) throws IOException;\n+  protected abstract void endInternal(WriteChannel out) throws IOException;\n \n   @Override\n   public void close() {\n@@ -165,9 +162,4 @@ public void close() {\n       throw new RuntimeException(e);\n     }\n   }\n-\n-  @VisibleForTesting\n-  public List<ArrowBlock> getRecordBlocks() {\n-    return recordBlocks;\n-  }\n }\ndiff --git a/java/vector/src/test/java/org/apache/arrow/vector/ipc/TestArrowFile.java b/java/vector/src/test/java/org/apache/arrow/vector/ipc/TestArrowFile.java\nindex 6ddd14b661..fcf738f60d 100644\n--- a/java/vector/src/test/java/org/apache/arrow/vector/ipc/TestArrowFile.java\n+++ b/java/vector/src/test/java/org/apache/arrow/vector/ipc/TestArrowFile.java\n@@ -445,6 +445,7 @@ public void testWriteReadMetadata() throws IOException {\n   public void testWriteReadDictionary() throws IOException {\n     File file = new File(\"target/mytest_dict.arrow\");\n     ByteArrayOutputStream stream = new ByteArrayOutputStream();\n+    int numDictionaryBlocksWritten = 0;\n \n     // write\n     try (BufferAllocator originalVectorAllocator = allocator.newChildAllocator(\"original vectors\", 0, Integer.MAX_VALUE)) {\n@@ -462,6 +463,7 @@ public void testWriteReadDictionary() throws IOException {\n         streamWriter.writeBatch();\n         fileWriter.end();\n         streamWriter.end();\n+        numDictionaryBlocksWritten = fileWriter.getDictionaryBlocks().size();\n       }\n \n       // Need to close dictionary vectors\n@@ -479,6 +481,7 @@ public void testWriteReadDictionary() throws IOException {\n       LOGGER.debug(\"reading schema: \" + schema);\n       Assert.assertTrue(arrowReader.loadNextBatch());\n       validateFlatDictionary(root, arrowReader);\n+      Assert.assertEquals(numDictionaryBlocksWritten, arrowReader.getDictionaryBlocks().size());\n     }\n \n     // Read from stream\n@@ -712,6 +715,7 @@ public void testWriteReadVarBin() throws IOException {\n   @Test\n   public void testReadWriteMultipleBatches() throws IOException {\n     File file = new File(\"target/mytest_nulls_multibatch.arrow\");\n+    int numBlocksWritten = 0;\n \n     try (IntVector vector = new IntVector(\"foo\", allocator);) {\n       Schema schema = new Schema(Collections.singletonList(vector.getField()), null);\n@@ -719,6 +723,7 @@ public void testReadWriteMultipleBatches() throws IOException {\n            VectorSchemaRoot root = new VectorSchemaRoot(schema, Collections.singletonList((FieldVector) vector), vector.getValueCount());\n            ArrowFileWriter writer = new ArrowFileWriter(root, null, fileOutputStream.getChannel());) {\n         writeBatchData(writer, vector, root);\n+        numBlocksWritten = writer.getRecordBlocks().size();\n       }\n     }\n \n@@ -726,6 +731,7 @@ public void testReadWriteMultipleBatches() throws IOException {\n          ArrowFileReader reader = new ArrowFileReader(fileInputStream.getChannel(), allocator);) {\n       IntVector vector = (IntVector) reader.getVectorSchemaRoot().getFieldVectors().get(0);\n       validateBatchData(reader, vector);\n+      Assert.assertEquals(numBlocksWritten, reader.getRecordBlocks().size());\n     }\n   }\n \ndiff --git a/java/vector/src/test/java/org/apache/arrow/vector/ipc/TestArrowStream.java b/java/vector/src/test/java/org/apache/arrow/vector/ipc/TestArrowStream.java\nindex bed4e63a50..431ebf04bb 100644\n--- a/java/vector/src/test/java/org/apache/arrow/vector/ipc/TestArrowStream.java\n+++ b/java/vector/src/test/java/org/apache/arrow/vector/ipc/TestArrowStream.java\n@@ -82,8 +82,6 @@ public void testReadWrite() throws IOException {\n         }\n         writer.end();\n         bytesWritten = writer.bytesWritten();\n-\n-        assertTrue(writer.getRecordBlocks().isEmpty());\n       }\n \n       ByteArrayInputStream in = new ByteArrayInputStream(out.toByteArray());\n@@ -110,8 +108,6 @@ public void testReadWriteMultipleBatches() throws IOException {\n       try (VectorSchemaRoot root = new VectorSchemaRoot(schema, Collections.singletonList(vector), vector.getValueCount());\n            ArrowStreamWriter writer = new ArrowStreamWriter(root, null, Channels.newChannel(os));) {\n         writeBatchData(writer, vector, root);\n-\n-        assertTrue(writer.getRecordBlocks().isEmpty());\n       }\n     }\n \n\n\n \n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2018-05-31T22:45:43.489+0000",
                    "updated": "2018-05-31T22:45:43.489+0000",
                    "started": "2018-05-31T22:45:43.488+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "107920",
                    "issueId": "13162735"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13162735/worklog/107921",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "BryanCutler commented on issue #2090: ARROW-2645: [Java] Refactor ArrowWriter to remove all ArrowFileWriter specifc logic\nURL: https://github.com/apache/arrow/pull/2090#issuecomment-393706343\n \n \n   merged to master\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2018-05-31T22:45:57.845+0000",
                    "updated": "2018-05-31T22:45:57.845+0000",
                    "started": "2018-05-31T22:45:57.845+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "107921",
                    "issueId": "13162735"
                }
            ]
        },
        "customfield_12313920": null,
        "issuetype": {
            "self": "https://issues.apache.org/jira/rest/api/2/issuetype/4",
            "id": "4",
            "description": "An improvement or enhancement to an existing feature or task.",
            "iconUrl": "https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21140&avatarType=issuetype",
            "name": "Improvement",
            "subtask": false,
            "avatarId": 21140
        },
        "timespent": 6600,
        "customfield_12314020": "{summaryBean=com.atlassian.jira.plugin.devstatus.rest.SummaryBean@3fd02a5b[summary={pullrequest=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@3507e14e[overall=PullRequestOverallBean{stateCount=0, state='OPEN', details=PullRequestOverallDetails{openCount=0, mergedCount=0, declinedCount=0}},byInstanceType={}], build=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@347b55e4[overall=com.atlassian.jira.plugin.devstatus.summary.beans.BuildOverallBean@3e7cdfb4[failedBuildCount=0,successfulBuildCount=0,unknownBuildCount=0,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], review=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@3e7d6be5[overall=com.atlassian.jira.plugin.devstatus.summary.beans.ReviewsOverallBean@d290723[stateCount=0,state=<null>,dueDate=<null>,overDue=false,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], deployment-environment=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@6393a717[overall=com.atlassian.jira.plugin.devstatus.summary.beans.DeploymentOverallBean@3b4a55ae[topEnvironments=[],showProjects=false,successfulCount=0,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], repository=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@6ebd3361[overall=com.atlassian.jira.plugin.devstatus.summary.beans.CommitOverallBean@2be8218a[count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], branch=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@55bd80ff[overall=com.atlassian.jira.plugin.devstatus.summary.beans.BranchOverallBean@3c3348c3[count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}]},errors=[],configErrors=[]], devSummaryJson={\"cachedValue\":{\"errors\":[],\"configErrors\":[],\"summary\":{\"pullrequest\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"stateCount\":0,\"state\":\"OPEN\",\"details\":{\"openCount\":0,\"mergedCount\":0,\"declinedCount\":0,\"total\":0},\"open\":true},\"byInstanceType\":{}},\"build\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"failedBuildCount\":0,\"successfulBuildCount\":0,\"unknownBuildCount\":0},\"byInstanceType\":{}},\"review\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"stateCount\":0,\"state\":null,\"dueDate\":null,\"overDue\":false,\"completed\":false},\"byInstanceType\":{}},\"deployment-environment\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"topEnvironments\":[],\"showProjects\":false,\"successfulCount\":0},\"byInstanceType\":{}},\"repository\":{\"overall\":{\"count\":0,\"lastUpdated\":null},\"byInstanceType\":{}},\"branch\":{\"overall\":{\"count\":0,\"lastUpdated\":null},\"byInstanceType\":{}}}},\"isStale\":false}}",
        "customfield_12314141": null,
        "customfield_12314140": null,
        "project": {
            "self": "https://issues.apache.org/jira/rest/api/2/project/12319525",
            "id": "12319525",
            "key": "ARROW",
            "name": "Apache Arrow",
            "projectTypeKey": "software",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/projectavatar?pid=12319525&avatarId=10011",
                "24x24": "https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12319525&avatarId=10011",
                "16x16": "https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12319525&avatarId=10011",
                "32x32": "https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12319525&avatarId=10011"
            },
            "projectCategory": {
                "self": "https://issues.apache.org/jira/rest/api/2/projectCategory/13960",
                "id": "13960",
                "description": "Apache Arrow",
                "name": "Arrow"
            }
        },
        "aggregatetimespent": 6600,
        "customfield_12312520": null,
        "customfield_12312521": "Thu May 31 22:45:47 UTC 2018",
        "customfield_12314422": null,
        "customfield_12314421": null,
        "customfield_12314146": null,
        "customfield_12314420": null,
        "customfield_12314145": null,
        "customfield_12314144": null,
        "customfield_12314143": null,
        "resolutiondate": "2018-05-31T22:45:47.000+0000",
        "workratio": -1,
        "customfield_12312923": null,
        "customfield_12312920": null,
        "customfield_12312921": null,
        "watches": {
            "self": "https://issues.apache.org/jira/rest/api/2/issue/ARROW-2645/watchers",
            "watchCount": 1,
            "isWatching": false
        },
        "created": "2018-05-29T22:35:35.000+0000",
        "updated": "2018-05-31T22:45:57.000+0000",
        "timeoriginalestimate": null,
        "description": "While reading the base method ensureStarted in ArrowStreamWriter accumulates Dictionary blocks.\u00a0 This is used for ArrowFileWriter but not ArrowStreamWriter.\u00a0",
        "customfield_10010": null,
        "timetracking": {
            "remainingEstimate": "0h",
            "timeSpent": "1h 50m",
            "remainingEstimateSeconds": 0,
            "timeSpentSeconds": 6600
        },
        "customfield_12314523": null,
        "customfield_12314127": null,
        "customfield_12314522": null,
        "customfield_12314126": null,
        "customfield_12314521": null,
        "customfield_12314125": null,
        "customfield_12314520": null,
        "customfield_12314124": null,
        "attachment": [],
        "customfield_12312340": null,
        "customfield_12314123": null,
        "customfield_12312341": null,
        "customfield_12312220": null,
        "customfield_12314122": null,
        "customfield_12314121": null,
        "customfield_12314120": null,
        "customfield_12314129": null,
        "customfield_12314524": null,
        "customfield_12314128": null,
        "summary": "[Java] ArrowStreamWriter accumulates DictionaryBatch ArrowBlocks",
        "customfield_12314130": null,
        "customfield_12310291": null,
        "customfield_12310290": null,
        "customfield_12314138": null,
        "customfield_12314137": null,
        "environment": null,
        "customfield_12314136": null,
        "customfield_12314135": null,
        "customfield_12311020": null,
        "customfield_12314134": null,
        "duedate": null,
        "customfield_12314132": null,
        "customfield_12314131": null,
        "comment": {
            "comments": [
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13162735/comment/16494397",
                    "id": "16494397",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=bryanc",
                        "name": "bryanc",
                        "key": "bryanc",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=bryanc&avatarId=23479",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=bryanc&avatarId=23479",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=bryanc&avatarId=23479",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=bryanc&avatarId=23479"
                        },
                        "displayName": "Bryan Cutler",
                        "active": true,
                        "timeZone": "America/Los_Angeles"
                    },
                    "body": "I'll work on this and try to refactor a little to clean up",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=bryanc",
                        "name": "bryanc",
                        "key": "bryanc",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=bryanc&avatarId=23479",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=bryanc&avatarId=23479",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=bryanc&avatarId=23479",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=bryanc&avatarId=23479"
                        },
                        "displayName": "Bryan Cutler",
                        "active": true,
                        "timeZone": "America/Los_Angeles"
                    },
                    "created": "2018-05-29T22:38:12.465+0000",
                    "updated": "2018-05-29T22:38:12.465+0000"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13162735/comment/16497278",
                    "id": "16497278",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=bryanc",
                        "name": "bryanc",
                        "key": "bryanc",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=bryanc&avatarId=23479",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=bryanc&avatarId=23479",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=bryanc&avatarId=23479",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=bryanc&avatarId=23479"
                        },
                        "displayName": "Bryan Cutler",
                        "active": true,
                        "timeZone": "America/Los_Angeles"
                    },
                    "body": "Issue resolved by pull request 2090\n[https://github.com/apache/arrow/pull/2090]",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=bryanc",
                        "name": "bryanc",
                        "key": "bryanc",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=bryanc&avatarId=23479",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=bryanc&avatarId=23479",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=bryanc&avatarId=23479",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=bryanc&avatarId=23479"
                        },
                        "displayName": "Bryan Cutler",
                        "active": true,
                        "timeZone": "America/Los_Angeles"
                    },
                    "created": "2018-05-31T22:45:47.067+0000",
                    "updated": "2018-05-31T22:45:47.067+0000"
                }
            ],
            "maxResults": 2,
            "total": 2,
            "startAt": 0
        },
        "customfield_12311820": "0|i3uaa7:",
        "customfield_12314139": null
    }
}