{
    "expand": "operations,versionedRepresentations,editmeta,changelog,renderedFields",
    "id": "13158639",
    "self": "https://issues.apache.org/jira/rest/api/2/issue/13158639",
    "key": "ARROW-2571",
    "fields": {
        "fixVersions": [
            {
                "self": "https://issues.apache.org/jira/rest/api/2/version/12342562",
                "id": "12342562",
                "description": "",
                "name": "0.10.0",
                "archived": false,
                "released": true,
                "releaseDate": "2018-08-06"
            }
        ],
        "resolution": {
            "self": "https://issues.apache.org/jira/rest/api/2/resolution/1",
            "id": "1",
            "description": "A fix for this issue is checked into the tree and tested.",
            "name": "Fixed"
        },
        "customfield_12312322": null,
        "customfield_12312323": null,
        "customfield_12312320": null,
        "customfield_12310420": "9223372036854775807",
        "customfield_12312321": null,
        "customfield_12312328": null,
        "customfield_12312329": null,
        "customfield_12312326": null,
        "customfield_12310300": null,
        "customfield_12312327": null,
        "customfield_12312324": null,
        "customfield_12312720": null,
        "customfield_12312325": null,
        "lastViewed": null,
        "priority": {
            "self": "https://issues.apache.org/jira/rest/api/2/priority/4",
            "iconUrl": "https://issues.apache.org/jira/images/icons/priorities/minor.svg",
            "name": "Minor",
            "id": "4"
        },
        "labels": [
            "pull-request-available"
        ],
        "customfield_12312333": null,
        "customfield_12312334": null,
        "customfield_12313422": "false",
        "customfield_12310310": "0.0",
        "customfield_12312331": null,
        "customfield_12312332": null,
        "aggregatetimeoriginalestimate": null,
        "timeestimate": 0,
        "customfield_12312330": null,
        "versions": [],
        "customfield_12311120": null,
        "customfield_12313826": null,
        "customfield_12312339": null,
        "issuelinks": [],
        "customfield_12313825": null,
        "assignee": {
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=veprbl",
            "name": "veprbl",
            "key": "veprbl",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
            },
            "displayName": "Dmitry Kalinkin",
            "active": true,
            "timeZone": "Etc/UTC"
        },
        "customfield_12312337": null,
        "customfield_12313823": null,
        "customfield_12312338": null,
        "customfield_12311920": null,
        "customfield_12313822": null,
        "customfield_12312335": null,
        "customfield_12313821": null,
        "customfield_12312336": null,
        "customfield_12313820": null,
        "status": {
            "self": "https://issues.apache.org/jira/rest/api/2/status/5",
            "description": "A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.",
            "iconUrl": "https://issues.apache.org/jira/images/icons/statuses/resolved.png",
            "name": "Resolved",
            "id": "5",
            "statusCategory": {
                "self": "https://issues.apache.org/jira/rest/api/2/statuscategory/3",
                "id": 3,
                "key": "done",
                "colorName": "green",
                "name": "Done"
            }
        },
        "components": [
            {
                "self": "https://issues.apache.org/jira/rest/api/2/component/12328935",
                "id": "12328935",
                "name": "C++"
            }
        ],
        "customfield_12312026": null,
        "customfield_12312023": null,
        "customfield_12312024": null,
        "aggregatetimeestimate": 0,
        "customfield_12312022": null,
        "customfield_12310921": null,
        "customfield_12310920": "9223372036854775807",
        "customfield_12312823": null,
        "creator": {
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=veprbl",
            "name": "veprbl",
            "key": "veprbl",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
            },
            "displayName": "Dmitry Kalinkin",
            "active": true,
            "timeZone": "Etc/UTC"
        },
        "subtasks": [],
        "reporter": {
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=veprbl",
            "name": "veprbl",
            "key": "veprbl",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
            },
            "displayName": "Dmitry Kalinkin",
            "active": true,
            "timeZone": "Etc/UTC"
        },
        "aggregateprogress": {
            "progress": 4200,
            "total": 4200,
            "percent": 100
        },
        "customfield_12313520": null,
        "customfield_12310250": null,
        "progress": {
            "progress": 4200,
            "total": 4200,
            "percent": 100
        },
        "customfield_12313924": null,
        "votes": {
            "self": "https://issues.apache.org/jira/rest/api/2/issue/ARROW-2571/votes",
            "votes": 0,
            "hasVoted": false
        },
        "worklog": {
            "startAt": 0,
            "maxResults": 20,
            "total": 7,
            "worklogs": [
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13158639/worklog/100977",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "veprbl opened a new pull request #2032: ARROW-2571: [C++] Lz4Codec doesn't properly handle empty data\nURL: https://github.com/apache/arrow/pull/2032\n \n \n   From the lz4 manual [1]:\r\n   \r\n   int LZ4_compress_default(const char* src, char* dst, int srcSize, int\r\n         dstCapacity);\r\n   return : the number of bytes written into buffer 'dst' (necessarily <= dstCapacity)\r\n            or 0 if compression fails\r\n   \r\n   int LZ4_decompress_safe (const char* src, char* dst, int compressedSize,\r\n         int dstCapacity);\r\n   return : the number of bytes decompressed into destination buffer (necessarily <= dstCapacity)\r\n            If destination buffer is not large enough, decoding will stop and output an error code (negative value).\r\n            If the source stream is detected malformed, the function will stop decoding and return a negative result.\r\n            This function is protected against malicious data packets.\r\n   \r\n   Fixes: 83a4405ea0 ('ARROW-599: [C++] Lz4 compression codec support')\r\n   \r\n   [1] https://github.com/lz4/lz4/blob/bf6fd938e522150e2a30bee978102769a51f4b3e/doc/lz4_manual.html#L64\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2018-05-11T04:45:47.776+0000",
                    "updated": "2018-05-11T04:45:47.776+0000",
                    "started": "2018-05-11T04:45:47.775+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "100977",
                    "issueId": "13158639"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13158639/worklog/100993",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "veprbl commented on issue #2032: ARROW-2571: [C++] Lz4Codec doesn't properly handle empty data\nURL: https://github.com/apache/arrow/pull/2032#issuecomment-388271291\n \n \n   Test still fails on MS-DOS: https://ci.appveyor.com/project/ApacheSoftwareFoundation/arrow/build/1.0.6392/job/ktbow83evchjjsw3#L3508\r\n   Not sure how to debug this.\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2018-05-11T06:16:11.706+0000",
                    "updated": "2018-05-11T06:16:11.706+0000",
                    "started": "2018-05-11T06:16:11.705+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "100993",
                    "issueId": "13158639"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13158639/worklog/101044",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "pitrou commented on issue #2032: ARROW-2571: [C++] Lz4Codec doesn't properly handle empty data\nURL: https://github.com/apache/arrow/pull/2032#issuecomment-388309734\n \n \n   Judging by the AppVeyor output, the Windows build may crash in the Snappy test.\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2018-05-11T09:18:06.150+0000",
                    "updated": "2018-05-11T09:18:06.150+0000",
                    "started": "2018-05-11T09:18:06.150+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "101044",
                    "issueId": "13158639"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13158639/worklog/101088",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "pitrou commented on issue #2032: ARROW-2571: [C++] Lz4Codec doesn't properly handle empty data\nURL: https://github.com/apache/arrow/pull/2032#issuecomment-388339141\n \n \n   Ok, I reproduced it. The problem is that `CheckCodecRoundtrip` accesses `data[0]` even though the `data` vector is empty. This produces an assertion error in debug mode. The proper idiom is `data.data()`. Here is a working patch, you can integrate it in the PR:\r\n   ```diff\r\n   diff --git a/cpp/src/arrow/util/compression-test.cc b/cpp/src/arrow/util/compression-test.cc\r\n   index 6dd518a..52a5b59 100644\r\n   --- a/cpp/src/arrow/util/compression-test.cc\r\n   +++ b/cpp/src/arrow/util/compression-test.cc\r\n   @@ -38,31 +38,32 @@ void CheckCodecRoundtrip(const vector<uint8_t>& data) {\r\n      ASSERT_OK(Codec::Create(CODEC, &c1));\r\n      ASSERT_OK(Codec::Create(CODEC, &c2));\r\n    \r\n   -  int max_compressed_len = static_cast<int>(c1->MaxCompressedLen(data.size(), &data[0]));\r\n   +  int max_compressed_len =\r\n   +      static_cast<int>(c1->MaxCompressedLen(data.size(), data.data()));\r\n      std::vector<uint8_t> compressed(max_compressed_len);\r\n      std::vector<uint8_t> decompressed(data.size());\r\n    \r\n      // compress with c1\r\n      int64_t actual_size;\r\n   -  ASSERT_OK(c1->Compress(data.size(), &data[0], max_compressed_len, &compressed[0],\r\n   +  ASSERT_OK(c1->Compress(data.size(), data.data(), max_compressed_len, compressed.data(),\r\n                             &actual_size));\r\n      compressed.resize(actual_size);\r\n    \r\n      // decompress with c2\r\n   -  ASSERT_OK(c2->Decompress(compressed.size(), &compressed[0], decompressed.size(),\r\n   -                           &decompressed[0]));\r\n   +  ASSERT_OK(c2->Decompress(compressed.size(), compressed.data(), decompressed.size(),\r\n   +                           decompressed.data()));\r\n    \r\n      ASSERT_EQ(data, decompressed);\r\n    \r\n      // compress with c2\r\n      int64_t actual_size2;\r\n   -  ASSERT_OK(c2->Compress(data.size(), &data[0], max_compressed_len, &compressed[0],\r\n   +  ASSERT_OK(c2->Compress(data.size(), data.data(), max_compressed_len, compressed.data(),\r\n                             &actual_size2));\r\n      ASSERT_EQ(actual_size2, actual_size);\r\n    \r\n      // decompress with c1\r\n   -  ASSERT_OK(c1->Decompress(compressed.size(), &compressed[0], decompressed.size(),\r\n   -                           &decompressed[0]));\r\n   +  ASSERT_OK(c1->Decompress(compressed.size(), compressed.data(), decompressed.size(),\r\n   +                           decompressed.data()));\r\n    \r\n      ASSERT_EQ(data, decompressed);\r\n    }\r\n   ```\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2018-05-11T11:36:41.984+0000",
                    "updated": "2018-05-11T11:36:41.984+0000",
                    "started": "2018-05-11T11:36:41.983+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "101088",
                    "issueId": "13158639"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13158639/worklog/101161",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "veprbl commented on issue #2032: ARROW-2571: [C++] Lz4Codec doesn't properly handle empty data\nURL: https://github.com/apache/arrow/pull/2032#issuecomment-388400512\n \n \n   @pitrou Thank you!\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2018-05-11T15:36:59.912+0000",
                    "updated": "2018-05-11T15:36:59.912+0000",
                    "started": "2018-05-11T15:36:59.911+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "101161",
                    "issueId": "13158639"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13158639/worklog/101542",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "codecov-io commented on issue #2032: ARROW-2571: [C++] Lz4Codec doesn't properly handle empty data\nURL: https://github.com/apache/arrow/pull/2032#issuecomment-388638398\n \n \n   # [Codecov](https://codecov.io/gh/apache/arrow/pull/2032?src=pr&el=h1) Report\n   > Merging [#2032](https://codecov.io/gh/apache/arrow/pull/2032?src=pr&el=desc) into [master](https://codecov.io/gh/apache/arrow/commit/da3f843c156fbbafbb22187d9c2a7b360af1b628?src=pr&el=desc) will **increase** coverage by `0.03%`.\n   > The diff coverage is `100%`.\n   \n   [![Impacted file tree graph](https://codecov.io/gh/apache/arrow/pull/2032/graphs/tree.svg?height=150&token=LpTCFbqVT1&width=650&src=pr)](https://codecov.io/gh/apache/arrow/pull/2032?src=pr&el=tree)\n   \n   ```diff\n   @@            Coverage Diff             @@\n   ##           master    #2032      +/-   ##\n   ==========================================\n   + Coverage   87.44%   87.47%   +0.03%     \n   ==========================================\n     Files         189      178      -11     \n     Lines       29366    28593     -773     \n   ==========================================\n   - Hits        25678    25012     -666     \n   + Misses       3688     3581     -107\n   ```\n   \n   \n   | [Impacted Files](https://codecov.io/gh/apache/arrow/pull/2032?src=pr&el=tree) | Coverage \u0394 | |\n   |---|---|---|\n   | [cpp/src/arrow/util/compression-test.cc](https://codecov.io/gh/apache/arrow/pull/2032/diff?src=pr&el=tree#diff-Y3BwL3NyYy9hcnJvdy91dGlsL2NvbXByZXNzaW9uLXRlc3QuY2M=) | `100% <100%> (\u00f8)` | :arrow_up: |\n   | [cpp/src/arrow/util/compression\\_lz4.cc](https://codecov.io/gh/apache/arrow/pull/2032/diff?src=pr&el=tree#diff-Y3BwL3NyYy9hcnJvdy91dGlsL2NvbXByZXNzaW9uX2x6NC5jYw==) | `83.33% <100%> (\u00f8)` | :arrow_up: |\n   | [rust/src/datatypes.rs](https://codecov.io/gh/apache/arrow/pull/2032/diff?src=pr&el=tree#diff-cnVzdC9zcmMvZGF0YXR5cGVzLnJz) | | |\n   | [rust/src/memory.rs](https://codecov.io/gh/apache/arrow/pull/2032/diff?src=pr&el=tree#diff-cnVzdC9zcmMvbWVtb3J5LnJz) | | |\n   | [rust/src/buffer.rs](https://codecov.io/gh/apache/arrow/pull/2032/diff?src=pr&el=tree#diff-cnVzdC9zcmMvYnVmZmVyLnJz) | | |\n   | [rust/src/bitmap.rs](https://codecov.io/gh/apache/arrow/pull/2032/diff?src=pr&el=tree#diff-cnVzdC9zcmMvYml0bWFwLnJz) | | |\n   | [rust/src/memory\\_pool.rs](https://codecov.io/gh/apache/arrow/pull/2032/diff?src=pr&el=tree#diff-cnVzdC9zcmMvbWVtb3J5X3Bvb2wucnM=) | | |\n   | [rust/src/list.rs](https://codecov.io/gh/apache/arrow/pull/2032/diff?src=pr&el=tree#diff-cnVzdC9zcmMvbGlzdC5ycw==) | | |\n   | [rust/src/array.rs](https://codecov.io/gh/apache/arrow/pull/2032/diff?src=pr&el=tree#diff-cnVzdC9zcmMvYXJyYXkucnM=) | | |\n   | [rust/src/lib.rs](https://codecov.io/gh/apache/arrow/pull/2032/diff?src=pr&el=tree#diff-cnVzdC9zcmMvbGliLnJz) | | |\n   | ... and [4 more](https://codecov.io/gh/apache/arrow/pull/2032/diff?src=pr&el=tree-more) | |\n   \n   ------\n   \n   [Continue to review full report at Codecov](https://codecov.io/gh/apache/arrow/pull/2032?src=pr&el=continue).\n   > **Legend** - [Click here to learn more](https://docs.codecov.io/docs/codecov-delta)\n   > `\u0394 = absolute <relative> (impact)`, `\u00f8 = not affected`, `? = missing data`\n   > Powered by [Codecov](https://codecov.io/gh/apache/arrow/pull/2032?src=pr&el=footer). Last update [da3f843...e768ede](https://codecov.io/gh/apache/arrow/pull/2032?src=pr&el=lastupdated). Read the [comment docs](https://docs.codecov.io/docs/pull-request-comments).\n   \n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2018-05-13T16:19:34.991+0000",
                    "updated": "2018-05-13T16:19:34.991+0000",
                    "started": "2018-05-13T16:19:34.991+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "101542",
                    "issueId": "13158639"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13158639/worklog/101543",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "xhochy closed pull request #2032: ARROW-2571: [C++] Lz4Codec doesn't properly handle empty data\nURL: https://github.com/apache/arrow/pull/2032\n \n \n   \n\nThis is a PR merged from a forked repository.\nAs GitHub hides the original diff on merge, it is displayed below for\nthe sake of provenance:\n\nAs this is a foreign pull request (from a fork), the diff is supplied\nbelow (as it won't show otherwise due to GitHub magic):\n\ndiff --git a/cpp/src/arrow/util/compression-test.cc b/cpp/src/arrow/util/compression-test.cc\nindex 6dd518a182..84a8d7c1d5 100644\n--- a/cpp/src/arrow/util/compression-test.cc\n+++ b/cpp/src/arrow/util/compression-test.cc\n@@ -38,38 +38,39 @@ void CheckCodecRoundtrip(const vector<uint8_t>& data) {\n   ASSERT_OK(Codec::Create(CODEC, &c1));\n   ASSERT_OK(Codec::Create(CODEC, &c2));\n \n-  int max_compressed_len = static_cast<int>(c1->MaxCompressedLen(data.size(), &data[0]));\n+  int max_compressed_len =\n+      static_cast<int>(c1->MaxCompressedLen(data.size(), data.data()));\n   std::vector<uint8_t> compressed(max_compressed_len);\n   std::vector<uint8_t> decompressed(data.size());\n \n   // compress with c1\n   int64_t actual_size;\n-  ASSERT_OK(c1->Compress(data.size(), &data[0], max_compressed_len, &compressed[0],\n+  ASSERT_OK(c1->Compress(data.size(), data.data(), max_compressed_len, compressed.data(),\n                          &actual_size));\n   compressed.resize(actual_size);\n \n   // decompress with c2\n-  ASSERT_OK(c2->Decompress(compressed.size(), &compressed[0], decompressed.size(),\n-                           &decompressed[0]));\n+  ASSERT_OK(c2->Decompress(compressed.size(), compressed.data(), decompressed.size(),\n+                           decompressed.data()));\n \n   ASSERT_EQ(data, decompressed);\n \n   // compress with c2\n   int64_t actual_size2;\n-  ASSERT_OK(c2->Compress(data.size(), &data[0], max_compressed_len, &compressed[0],\n+  ASSERT_OK(c2->Compress(data.size(), data.data(), max_compressed_len, compressed.data(),\n                          &actual_size2));\n   ASSERT_EQ(actual_size2, actual_size);\n \n   // decompress with c1\n-  ASSERT_OK(c1->Decompress(compressed.size(), &compressed[0], decompressed.size(),\n-                           &decompressed[0]));\n+  ASSERT_OK(c1->Decompress(compressed.size(), compressed.data(), decompressed.size(),\n+                           decompressed.data()));\n \n   ASSERT_EQ(data, decompressed);\n }\n \n template <Compression::type CODEC>\n void CheckCodec() {\n-  int sizes[] = {10000, 100000};\n+  int sizes[] = {0, 10000, 100000};\n   for (int data_size : sizes) {\n     vector<uint8_t> data(data_size);\n     test::random_bytes(data_size, 1234, data.data());\ndiff --git a/cpp/src/arrow/util/compression_lz4.cc b/cpp/src/arrow/util/compression_lz4.cc\nindex 001edeb01b..23a5c398b6 100644\n--- a/cpp/src/arrow/util/compression_lz4.cc\n+++ b/cpp/src/arrow/util/compression_lz4.cc\n@@ -34,7 +34,7 @@ Status Lz4Codec::Decompress(int64_t input_len, const uint8_t* input, int64_t out\n   int64_t decompressed_size = LZ4_decompress_safe(\n       reinterpret_cast<const char*>(input), reinterpret_cast<char*>(output_buffer),\n       static_cast<int>(input_len), static_cast<int>(output_len));\n-  if (decompressed_size < 1) {\n+  if (decompressed_size < 0) {\n     return Status::IOError(\"Corrupt Lz4 compressed data.\");\n   }\n   return Status::OK();\n@@ -51,7 +51,7 @@ Status Lz4Codec::Compress(int64_t input_len, const uint8_t* input,\n   *output_length = LZ4_compress_default(\n       reinterpret_cast<const char*>(input), reinterpret_cast<char*>(output_buffer),\n       static_cast<int>(input_len), static_cast<int>(output_buffer_len));\n-  if (*output_length < 1) {\n+  if (*output_length == 0) {\n     return Status::IOError(\"Lz4 compression failure.\");\n   }\n   return Status::OK();\n\n\n \n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2018-05-13T16:26:55.799+0000",
                    "updated": "2018-05-13T16:26:55.799+0000",
                    "started": "2018-05-13T16:26:55.798+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "101543",
                    "issueId": "13158639"
                }
            ]
        },
        "customfield_12313920": null,
        "issuetype": {
            "self": "https://issues.apache.org/jira/rest/api/2/issuetype/1",
            "id": "1",
            "description": "A problem which impairs or prevents the functions of the product.",
            "iconUrl": "https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype",
            "name": "Bug",
            "subtask": false,
            "avatarId": 21133
        },
        "timespent": 4200,
        "customfield_12314020": "{summaryBean=com.atlassian.jira.plugin.devstatus.rest.SummaryBean@3a50b335[summary={pullrequest=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@31d9d09f[overall=PullRequestOverallBean{stateCount=0, state='OPEN', details=PullRequestOverallDetails{openCount=0, mergedCount=0, declinedCount=0}},byInstanceType={}], build=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@7d193d68[overall=com.atlassian.jira.plugin.devstatus.summary.beans.BuildOverallBean@2bb577c[failedBuildCount=0,successfulBuildCount=0,unknownBuildCount=0,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], review=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@6465a1b7[overall=com.atlassian.jira.plugin.devstatus.summary.beans.ReviewsOverallBean@598fd50f[stateCount=0,state=<null>,dueDate=<null>,overDue=false,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], deployment-environment=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@6d49412b[overall=com.atlassian.jira.plugin.devstatus.summary.beans.DeploymentOverallBean@3591eb49[topEnvironments=[],showProjects=false,successfulCount=0,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], repository=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@7cb09c55[overall=com.atlassian.jira.plugin.devstatus.summary.beans.CommitOverallBean@5b301961[count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], branch=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@7cd75b35[overall=com.atlassian.jira.plugin.devstatus.summary.beans.BranchOverallBean@46a63c45[count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}]},errors=[],configErrors=[]], devSummaryJson={\"cachedValue\":{\"errors\":[],\"configErrors\":[],\"summary\":{\"pullrequest\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"stateCount\":0,\"state\":\"OPEN\",\"details\":{\"openCount\":0,\"mergedCount\":0,\"declinedCount\":0,\"total\":0},\"open\":true},\"byInstanceType\":{}},\"build\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"failedBuildCount\":0,\"successfulBuildCount\":0,\"unknownBuildCount\":0},\"byInstanceType\":{}},\"review\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"stateCount\":0,\"state\":null,\"dueDate\":null,\"overDue\":false,\"completed\":false},\"byInstanceType\":{}},\"deployment-environment\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"topEnvironments\":[],\"showProjects\":false,\"successfulCount\":0},\"byInstanceType\":{}},\"repository\":{\"overall\":{\"count\":0,\"lastUpdated\":null},\"byInstanceType\":{}},\"branch\":{\"overall\":{\"count\":0,\"lastUpdated\":null},\"byInstanceType\":{}}}},\"isStale\":false}}",
        "customfield_12314141": null,
        "customfield_12314140": null,
        "project": {
            "self": "https://issues.apache.org/jira/rest/api/2/project/12319525",
            "id": "12319525",
            "key": "ARROW",
            "name": "Apache Arrow",
            "projectTypeKey": "software",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/projectavatar?pid=12319525&avatarId=10011",
                "24x24": "https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12319525&avatarId=10011",
                "16x16": "https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12319525&avatarId=10011",
                "32x32": "https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12319525&avatarId=10011"
            },
            "projectCategory": {
                "self": "https://issues.apache.org/jira/rest/api/2/projectCategory/13960",
                "id": "13960",
                "description": "Apache Arrow",
                "name": "Arrow"
            }
        },
        "aggregatetimespent": 4200,
        "customfield_12312520": null,
        "customfield_12312521": "Sun May 13 16:27:12 UTC 2018",
        "customfield_12314422": null,
        "customfield_12314421": null,
        "customfield_12314146": null,
        "customfield_12314420": null,
        "customfield_12314145": null,
        "customfield_12314144": null,
        "customfield_12314143": null,
        "resolutiondate": "2018-05-13T16:27:12.000+0000",
        "workratio": -1,
        "customfield_12312923": null,
        "customfield_12312920": null,
        "customfield_12312921": null,
        "watches": {
            "self": "https://issues.apache.org/jira/rest/api/2/issue/ARROW-2571/watchers",
            "watchCount": 1,
            "isWatching": false
        },
        "created": "2018-05-11T04:40:15.000+0000",
        "updated": "2018-07-27T15:24:18.000+0000",
        "timeoriginalestimate": null,
        "description": "For example a following closure test will fail:\r\n{code:python}\r\nimport pyarrow as pa\r\nimport pyarrow.parquet as pq\r\n\r\ndata = [pa.array([None] * 10)]\r\nbatch = pa.RecordBatch.from_arrays(data, ['x'])\r\ntable = pa.Table.from_batches([batch])\r\npq.write_table(table, \"test.parquet\", compression='LZ4')\r\ntable = pq.read_table(\"test.parquet\")\r\n{code}\r\nwith a following error\r\n{code:java}\r\nTraceback (most recent call last): File \"test.py\", line 8, in <module> table = pq.read_table(\"test.parquet\") File \"python3.6/site-packages/pyarrow/parquet.py\", line 987, in read_table use_pandas_metadata=use_pandas_metadata) File \"python3.6/site-packages/pyarrow/parquet.py\", line 149, in read nthreads=nthreads) File \"_parquet.pyx\", line 736, in pyarrow._parquet.ParquetReader.read_all File \"error.pxi\", line 83, in pyarrow.lib.check_status pyarrow.lib.ArrowIOError: Arrow error: IOError: Corrupt Lz4 compressed data.\r\n{code}\r\nWriting file from with LZ4 from python requires patch for ARROW-2570. But the issue can be reproduced by creating an input file with parquet-cpp. The file must be compressed with LZ4 and contain a column with only gap values.",
        "customfield_10010": null,
        "timetracking": {
            "remainingEstimate": "0h",
            "timeSpent": "1h 10m",
            "remainingEstimateSeconds": 0,
            "timeSpentSeconds": 4200
        },
        "customfield_12314523": null,
        "customfield_12314127": null,
        "customfield_12314522": null,
        "customfield_12314126": null,
        "customfield_12314521": null,
        "customfield_12314125": null,
        "customfield_12314520": null,
        "customfield_12314124": null,
        "attachment": [],
        "customfield_12312340": null,
        "customfield_12314123": null,
        "customfield_12312341": null,
        "customfield_12312220": null,
        "customfield_12314122": null,
        "customfield_12314121": null,
        "customfield_12314120": null,
        "customfield_12314129": null,
        "customfield_12314524": null,
        "customfield_12314128": null,
        "summary": "[C++] Lz4Codec doesn't properly handle empty data",
        "customfield_12314130": null,
        "customfield_12310291": null,
        "customfield_12310290": null,
        "customfield_12314138": null,
        "customfield_12314137": null,
        "environment": null,
        "customfield_12314136": null,
        "customfield_12314135": null,
        "customfield_12311020": null,
        "customfield_12314134": null,
        "duedate": null,
        "customfield_12314132": null,
        "customfield_12314131": null,
        "comment": {
            "comments": [
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13158639/comment/16473551",
                    "id": "16473551",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=uwe",
                        "name": "uwe",
                        "key": "xhochy",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=xhochy&avatarId=30652",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=xhochy&avatarId=30652",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=xhochy&avatarId=30652",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=xhochy&avatarId=30652"
                        },
                        "displayName": "Uwe Korn",
                        "active": true,
                        "timeZone": "Europe/Berlin"
                    },
                    "body": "Issue resolved by pull request 2032\n[https://github.com/apache/arrow/pull/2032]",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=uwe",
                        "name": "uwe",
                        "key": "xhochy",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=xhochy&avatarId=30652",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=xhochy&avatarId=30652",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=xhochy&avatarId=30652",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=xhochy&avatarId=30652"
                        },
                        "displayName": "Uwe Korn",
                        "active": true,
                        "timeZone": "Europe/Berlin"
                    },
                    "created": "2018-05-13T16:27:12.518+0000",
                    "updated": "2018-05-13T16:27:12.518+0000"
                }
            ],
            "maxResults": 1,
            "total": 1,
            "startAt": 0
        },
        "customfield_12311820": "0|i3tlhz:",
        "customfield_12314139": null
    }
}