{
    "expand": "operations,versionedRepresentations,editmeta,changelog,renderedFields",
    "id": "13308302",
    "self": "https://issues.apache.org/jira/rest/api/2/issue/13308302",
    "key": "ARROW-8980",
    "fields": {
        "fixVersions": [
            {
                "self": "https://issues.apache.org/jira/rest/api/2/version/12347769",
                "id": "12347769",
                "description": "",
                "name": "1.0.0",
                "archived": false,
                "released": true,
                "releaseDate": "2020-07-24"
            }
        ],
        "resolution": {
            "self": "https://issues.apache.org/jira/rest/api/2/resolution/1",
            "id": "1",
            "description": "A fix for this issue is checked into the tree and tested.",
            "name": "Fixed"
        },
        "customfield_12312322": null,
        "customfield_12312323": null,
        "customfield_12312320": null,
        "customfield_12310420": "9223372036854775807",
        "customfield_12312321": null,
        "customfield_12312328": null,
        "customfield_12312329": null,
        "customfield_12312326": null,
        "customfield_12310300": null,
        "customfield_12312327": null,
        "customfield_12312324": null,
        "customfield_12312720": null,
        "customfield_12312325": null,
        "lastViewed": null,
        "priority": {
            "self": "https://issues.apache.org/jira/rest/api/2/priority/3",
            "iconUrl": "https://issues.apache.org/jira/images/icons/priorities/major.svg",
            "name": "Major",
            "id": "3"
        },
        "labels": [
            "metadata",
            "parquet",
            "pull-request-available",
            "pyarrow",
            "python",
            "schema"
        ],
        "customfield_12312333": null,
        "customfield_12312334": null,
        "customfield_12313422": "false",
        "customfield_12310310": "2.0",
        "customfield_12312331": null,
        "customfield_12312332": null,
        "aggregatetimeoriginalestimate": null,
        "timeestimate": 0,
        "customfield_12312330": null,
        "versions": [
            {
                "self": "https://issues.apache.org/jira/rest/api/2/version/12340948",
                "id": "12340948",
                "description": "",
                "name": "0.16.0",
                "archived": false,
                "released": true,
                "releaseDate": "2020-02-07"
            }
        ],
        "customfield_12311120": null,
        "customfield_12313826": null,
        "customfield_12312339": null,
        "issuelinks": [
            {
                "id": "12590046",
                "self": "https://issues.apache.org/jira/rest/api/2/issueLink/12590046",
                "type": {
                    "id": "10030",
                    "name": "Reference",
                    "inward": "is related to",
                    "outward": "relates to",
                    "self": "https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"
                },
                "outwardIssue": {
                    "id": "13308917",
                    "key": "ARROW-9009",
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13308917",
                    "fields": {
                        "summary": "[C++][Dataset] ARROW:schema should be removed from schema's metadata when reading Parquet files",
                        "status": {
                            "self": "https://issues.apache.org/jira/rest/api/2/status/5",
                            "description": "A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.",
                            "iconUrl": "https://issues.apache.org/jira/images/icons/statuses/resolved.png",
                            "name": "Resolved",
                            "id": "5",
                            "statusCategory": {
                                "self": "https://issues.apache.org/jira/rest/api/2/statuscategory/3",
                                "id": 3,
                                "key": "done",
                                "colorName": "green",
                                "name": "Done"
                            }
                        },
                        "priority": {
                            "self": "https://issues.apache.org/jira/rest/api/2/priority/3",
                            "iconUrl": "https://issues.apache.org/jira/images/icons/priorities/major.svg",
                            "name": "Major",
                            "id": "3"
                        },
                        "issuetype": {
                            "self": "https://issues.apache.org/jira/rest/api/2/issuetype/1",
                            "id": "1",
                            "description": "A problem which impairs or prevents the functions of the product.",
                            "iconUrl": "https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype",
                            "name": "Bug",
                            "subtask": false,
                            "avatarId": 21133
                        }
                    }
                }
            }
        ],
        "customfield_12313825": null,
        "assignee": {
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=wesm",
            "name": "wesm",
            "key": "wesmckinn",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=wesmckinn&avatarId=29931",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=wesmckinn&avatarId=29931",
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=wesmckinn&avatarId=29931",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=wesmckinn&avatarId=29931"
            },
            "displayName": "Wes McKinney",
            "active": true,
            "timeZone": "America/New_York"
        },
        "customfield_12312337": null,
        "customfield_12313823": null,
        "customfield_12312338": null,
        "customfield_12311920": null,
        "customfield_12313822": null,
        "customfield_12312335": null,
        "customfield_12313821": null,
        "customfield_12312336": null,
        "customfield_12313820": null,
        "status": {
            "self": "https://issues.apache.org/jira/rest/api/2/status/5",
            "description": "A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.",
            "iconUrl": "https://issues.apache.org/jira/images/icons/statuses/resolved.png",
            "name": "Resolved",
            "id": "5",
            "statusCategory": {
                "self": "https://issues.apache.org/jira/rest/api/2/statuscategory/3",
                "id": 3,
                "key": "done",
                "colorName": "green",
                "name": "Done"
            }
        },
        "components": [
            {
                "self": "https://issues.apache.org/jira/rest/api/2/component/12328936",
                "id": "12328936",
                "name": "Python"
            }
        ],
        "customfield_12312026": null,
        "customfield_12312023": null,
        "customfield_12312024": null,
        "aggregatetimeestimate": 0,
        "customfield_12312022": null,
        "customfield_12310921": null,
        "customfield_12310920": "9223372036854775807",
        "customfield_12312823": null,
        "creator": {
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=kevinglasson",
            "name": "kevinglasson",
            "key": "kevinglasson",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=34044",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34044",
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34044",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34044"
            },
            "displayName": "Kevin Glasson",
            "active": true,
            "timeZone": "Australia/Perth"
        },
        "subtasks": [],
        "reporter": {
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=kevinglasson",
            "name": "kevinglasson",
            "key": "kevinglasson",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=34044",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34044",
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34044",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34044"
            },
            "displayName": "Kevin Glasson",
            "active": true,
            "timeZone": "Australia/Perth"
        },
        "aggregateprogress": {
            "progress": 2400,
            "total": 2400,
            "percent": 100
        },
        "customfield_12313520": null,
        "customfield_12310250": null,
        "progress": {
            "progress": 2400,
            "total": 2400,
            "percent": 100
        },
        "customfield_12313924": null,
        "votes": {
            "self": "https://issues.apache.org/jira/rest/api/2/issue/ARROW-8980/votes",
            "votes": 0,
            "hasVoted": false
        },
        "worklog": {
            "startAt": 0,
            "maxResults": 20,
            "total": 4,
            "worklogs": [
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13308302/worklog/452135",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "wesm opened a new pull request #7577:\nURL: https://github.com/apache/arrow/pull/7577\n\n\n   This was already being worked around in some unit tests... \n\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2020-06-29T02:40:36.902+0000",
                    "updated": "2020-06-29T02:40:36.902+0000",
                    "started": "2020-06-29T02:40:36.902+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "452135",
                    "issueId": "13308302"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13308302/worklog/452140",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "github-actions[bot] commented on pull request #7577:\nURL: https://github.com/apache/arrow/pull/7577#issuecomment-650872224\n\n\n   https://issues.apache.org/jira/browse/ARROW-8980\n\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2020-06-29T02:46:52.124+0000",
                    "updated": "2020-06-29T02:46:52.124+0000",
                    "started": "2020-06-29T02:46:52.124+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "452140",
                    "issueId": "13308302"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13308302/worklog/452157",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "wesm commented on pull request #7577:\nURL: https://github.com/apache/arrow/pull/7577#issuecomment-650893647\n\n\n   +1\n\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2020-06-29T04:08:36.736+0000",
                    "updated": "2020-06-29T04:08:36.736+0000",
                    "started": "2020-06-29T04:08:36.736+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "452157",
                    "issueId": "13308302"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13308302/worklog/452158",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "wesm closed pull request #7577:\nURL: https://github.com/apache/arrow/pull/7577\n\n\n   \n\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2020-06-29T04:08:59.882+0000",
                    "updated": "2020-06-29T04:08:59.882+0000",
                    "started": "2020-06-29T04:08:59.882+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "452158",
                    "issueId": "13308302"
                }
            ]
        },
        "customfield_12313920": null,
        "issuetype": {
            "self": "https://issues.apache.org/jira/rest/api/2/issuetype/1",
            "id": "1",
            "description": "A problem which impairs or prevents the functions of the product.",
            "iconUrl": "https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype",
            "name": "Bug",
            "subtask": false,
            "avatarId": 21133
        },
        "timespent": 2400,
        "customfield_12314020": "{summaryBean=com.atlassian.jira.plugin.devstatus.rest.SummaryBean@2c1bbd9a[summary={pullrequest=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@264c517f[overall=PullRequestOverallBean{stateCount=0, state='OPEN', details=PullRequestOverallDetails{openCount=0, mergedCount=0, declinedCount=0}},byInstanceType={}], build=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@2e5a0f5d[overall=com.atlassian.jira.plugin.devstatus.summary.beans.BuildOverallBean@6ad96440[failedBuildCount=0,successfulBuildCount=0,unknownBuildCount=0,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], review=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@766f82bb[overall=com.atlassian.jira.plugin.devstatus.summary.beans.ReviewsOverallBean@4d7a24b1[stateCount=0,state=<null>,dueDate=<null>,overDue=false,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], deployment-environment=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@33a4eaa4[overall=com.atlassian.jira.plugin.devstatus.summary.beans.DeploymentOverallBean@12fe63f4[topEnvironments=[],showProjects=false,successfulCount=0,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], repository=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@188e414a[overall=com.atlassian.jira.plugin.devstatus.summary.beans.CommitOverallBean@44db146[count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], branch=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@10289aa1[overall=com.atlassian.jira.plugin.devstatus.summary.beans.BranchOverallBean@7128ba93[count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}]},errors=[],configErrors=[]], devSummaryJson={\"cachedValue\":{\"errors\":[],\"configErrors\":[],\"summary\":{\"pullrequest\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"stateCount\":0,\"state\":\"OPEN\",\"details\":{\"openCount\":0,\"mergedCount\":0,\"declinedCount\":0,\"total\":0},\"open\":true},\"byInstanceType\":{}},\"build\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"failedBuildCount\":0,\"successfulBuildCount\":0,\"unknownBuildCount\":0},\"byInstanceType\":{}},\"review\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"stateCount\":0,\"state\":null,\"dueDate\":null,\"overDue\":false,\"completed\":false},\"byInstanceType\":{}},\"deployment-environment\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"topEnvironments\":[],\"showProjects\":false,\"successfulCount\":0},\"byInstanceType\":{}},\"repository\":{\"overall\":{\"count\":0,\"lastUpdated\":null},\"byInstanceType\":{}},\"branch\":{\"overall\":{\"count\":0,\"lastUpdated\":null},\"byInstanceType\":{}}}},\"isStale\":false}}",
        "customfield_12314141": null,
        "customfield_12314140": null,
        "project": {
            "self": "https://issues.apache.org/jira/rest/api/2/project/12319525",
            "id": "12319525",
            "key": "ARROW",
            "name": "Apache Arrow",
            "projectTypeKey": "software",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/projectavatar?pid=12319525&avatarId=10011",
                "24x24": "https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12319525&avatarId=10011",
                "16x16": "https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12319525&avatarId=10011",
                "32x32": "https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12319525&avatarId=10011"
            },
            "projectCategory": {
                "self": "https://issues.apache.org/jira/rest/api/2/projectCategory/13960",
                "id": "13960",
                "description": "Apache Arrow",
                "name": "Arrow"
            }
        },
        "aggregatetimespent": 2400,
        "customfield_12312520": null,
        "customfield_12312521": "Mon Jun 29 04:08:44 UTC 2020",
        "customfield_12314422": null,
        "customfield_12314421": null,
        "customfield_12314146": null,
        "customfield_12314420": null,
        "customfield_12314145": null,
        "customfield_12314144": null,
        "customfield_12314143": null,
        "resolutiondate": "2020-06-29T04:08:44.000+0000",
        "workratio": -1,
        "customfield_12312923": null,
        "customfield_12312920": null,
        "customfield_12312921": null,
        "watches": {
            "self": "https://issues.apache.org/jira/rest/api/2/issue/ARROW-8980/watchers",
            "watchCount": 4,
            "isWatching": false
        },
        "created": "2020-05-29T11:19:55.000+0000",
        "updated": "2020-06-29T04:09:00.000+0000",
        "timeoriginalestimate": null,
        "description": "When overwriting parquet files we first read the schema that is already on disk this is mainly to deal with some type harmonizing between pyarrow and pandas (that I wont go into).\r\n\r\nRegardless here is a simple example (below) with no weirdness. If I continously re-write the same file by first fetching the schema from disk, creating a writer with that schema and then writing same dataframe the file size keeps growing even though the amount of rows has not changed.\r\n\r\nNote: My solution was to remove `b'ARROW:schema'` data from the `schema.metadata.` this seems to stop the file size growing. So I wonder if the writer keeps appending to it or something? TBH I'm not entirely sure but I have a hunch that the ARROW:schema is just the metadata serialised or something.\r\n\r\nI should also note that once the metadata gets to big this leads to a buffer overflow in another part of the code 'thrift' which was referenced here:\u00a0https://issues.apache.org/jira/browse/PARQUET-1345\r\n{code:java}\r\nimport pyarrow as pa\r\nimport pyarrow.parquet as pq\r\nimport pyarrow as pa\r\nimport pandas as pd\r\nimport pathlib\r\nimport sys\r\ndef main():\r\n    print(f\"python: {sys.version}\")\r\n    print(f\"pa version: {pa.__version__}\")\r\n    print(f\"pd version: {pd.__version__}\")    fname = \"test.pq\"\r\n    path = pathlib.Path(fname)    df = pd.DataFrame({\"A\": [0] * 100000})\r\n    df.to_parquet(fname)    print(f\"Wrote test frame to {fname}\")\r\n    print(f\"Size of {fname}: {path.stat().st_size}\")    for _ in range(5):\r\n        file = pq.ParquetFile(fname)\r\n        tmp_df = file.read().to_pandas()\r\n        print(f\"Number of rows on disk: {tmp_df.shape}\")\r\n        print(\"Reading schema from disk\")\r\n        schema = file.schema.to_arrow_schema()\r\n        print(\"Creating new writer\")\r\n        writer = pq.ParquetWriter(fname, schema=schema)\r\n        print(\"Re-writing the dataframe\")\r\n        writer.write_table(pa.Table.from_pandas(df))\r\n        writer.close()\r\n        print(f\"Size of {fname}: {path.stat().st_size}\")\r\nif __name__ == \"__main__\":\r\n    main()\r\n{code}\r\n{code:java}\r\n(sdm) \u279c ~ python growing_metadata.py\r\npython: 3.7.3 | packaged by conda-forge | (default, Dec 6 2019, 08:36:57)\r\n[Clang 9.0.0 (tags/RELEASE_900/final)]\r\npa version: 0.16.0\r\npd version: 0.25.2\r\nWrote test frame to test.pq\r\nSize of test.pq: 1643\r\nNumber of rows on disk: (100000, 1)\r\nReading schema from disk\r\nCreating new writer\r\nRe-writing the dataframe\r\nSize of test.pq: 3637\r\nNumber of rows on disk: (100000, 1)\r\nReading schema from disk\r\nCreating new writer\r\nRe-writing the dataframe\r\nSize of test.pq: 8327\r\nNumber of rows on disk: (100000, 1)\r\nReading schema from disk\r\nCreating new writer\r\nRe-writing the dataframe\r\nSize of test.pq: 19301\r\nNumber of rows on disk: (100000, 1)\r\nReading schema from disk\r\nCreating new writer\r\nRe-writing the dataframe\r\nSize of test.pq: 44944\r\nNumber of rows on disk: (100000, 1)\r\nReading schema from disk\r\nCreating new writer\r\nRe-writing the dataframe\r\nSize of test.pq: 104815{code}",
        "customfield_10010": null,
        "timetracking": {
            "remainingEstimate": "0h",
            "timeSpent": "40m",
            "remainingEstimateSeconds": 0,
            "timeSpentSeconds": 2400
        },
        "customfield_12314523": null,
        "customfield_12314127": null,
        "customfield_12314522": null,
        "customfield_12314126": null,
        "customfield_12314521": null,
        "customfield_12314125": null,
        "customfield_12314520": null,
        "customfield_12314124": null,
        "attachment": [
            {
                "self": "https://issues.apache.org/jira/rest/api/2/attachment/13004333",
                "id": "13004333",
                "filename": "growing_metadata.py",
                "author": {
                    "self": "https://issues.apache.org/jira/rest/api/2/user?username=kevinglasson",
                    "name": "kevinglasson",
                    "key": "kevinglasson",
                    "avatarUrls": {
                        "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=34044",
                        "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34044",
                        "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34044",
                        "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34044"
                    },
                    "displayName": "Kevin Glasson",
                    "active": true,
                    "timeZone": "Australia/Perth"
                },
                "created": "2020-05-29T11:18:40.152+0000",
                "size": 1028,
                "mimeType": "text/x-python-script",
                "content": "https://issues.apache.org/jira/secure/attachment/13004333/growing_metadata.py"
            },
            {
                "self": "https://issues.apache.org/jira/rest/api/2/attachment/13004332",
                "id": "13004332",
                "filename": "test.pq",
                "author": {
                    "self": "https://issues.apache.org/jira/rest/api/2/user?username=kevinglasson",
                    "name": "kevinglasson",
                    "key": "kevinglasson",
                    "avatarUrls": {
                        "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=34044",
                        "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34044",
                        "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34044",
                        "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34044"
                    },
                    "displayName": "Kevin Glasson",
                    "active": true,
                    "timeZone": "Australia/Perth"
                },
                "created": "2020-05-29T11:18:42.024+0000",
                "size": 104815,
                "mimeType": "application/octet-stream",
                "content": "https://issues.apache.org/jira/secure/attachment/13004332/test.pq"
            }
        ],
        "customfield_12312340": null,
        "customfield_12314123": null,
        "customfield_12312341": null,
        "customfield_12312220": null,
        "customfield_12314122": null,
        "customfield_12314121": null,
        "customfield_12314120": null,
        "customfield_12314129": null,
        "customfield_12314524": null,
        "customfield_12314128": null,
        "summary": "[Python] Metadata grows exponentially when using schema from disk",
        "customfield_12314130": null,
        "customfield_12310291": null,
        "customfield_12310290": null,
        "customfield_12314138": null,
        "customfield_12314137": null,
        "environment": "python: 3.7.3 | packaged by conda-forge | (default, Dec 6 2019, 08:36:57)\r\n[Clang 9.0.0 (tags/RELEASE_900/final)]\r\npa version: 0.16.0\r\npd version: 0.25.2",
        "customfield_12314136": null,
        "customfield_12314135": null,
        "customfield_12311020": null,
        "customfield_12314134": null,
        "duedate": null,
        "customfield_12314132": null,
        "customfield_12314131": null,
        "comment": {
            "comments": [
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13308302/comment/17123549",
                    "id": "17123549",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=jorisvandenbossche",
                        "name": "jorisvandenbossche",
                        "key": "jorisvandenbossche",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "Joris Van den Bossche",
                        "active": true,
                        "timeZone": "Europe/Brussels"
                    },
                    "body": "[~kevinglasson] thanks for the report!\r\n\r\nA bit modified example to visualize the issue:\r\n\r\n{code:python}\r\nimport pyarrow.parquet as pq\r\n\r\nfname = \"test_metadata_size.parquet\" \r\ndf = pd.DataFrame({\"A\": [0] * 100000})\r\ndf.to_parquet(fname)\r\n\r\n# first read\r\nfile1 = pq.ParquetFile(\"test_metadata_size.parquet\")                                                                                                                                  \r\ntable1 = file1.read()                                                                                                                                                                  \r\nschema1 = file1.schema.to_arrow_schema()                                                                                                                                               \r\n\r\n# writing\r\nwriter = pq.ParquetWriter(fname, schema=schema1)                                                                                                                                      \r\nwriter.write_table(pa.Table.from_pandas(df))                                                                                                                                         \r\nwriter.close()                                                                                                                                                                       \r\n\r\n# second read\r\nfile2 = pq.ParquetFile(fname)                                                                                                                                                        \r\ntable2 = file2.read()                                                                                                                                                                \r\nschema2 = file2.schema.to_arrow_schema() \r\n{code}\r\n\r\nand then looking at the different schemas:\r\n\r\n{code}\r\n>>> schema1                                                                                                                                                                               \r\nA: int64\r\n  -- field metadata --\r\n  PARQUET:field_id: '1'\r\n-- schema metadata --\r\npandas: '{\"index_columns\": [{\"kind\": \"range\", \"name\": null, \"start\": 0, \"' + 408\r\nARROW:schema: '/////4gCAAAQAAAAAAAKAA4ABgAFAAgACgAAAAABAwAQAAAAAAAKAAwAAA' + 818\r\n\r\n>>> table1.schema                                                                                                                                                                         \r\nA: int64\r\n  -- field metadata --\r\n  PARQUET:field_id: '1'\r\n-- schema metadata --\r\npandas: '{\"index_columns\": [{\"kind\": \"range\", \"name\": null, \"start\": 0, \"' + 408\r\n\r\n>>> schema2  \r\nA: int64\r\n  -- field metadata --\r\n  PARQUET:field_id: '1'\r\n-- schema metadata --\r\npandas: '{\"index_columns\": [{\"kind\": \"range\", \"name\": null, \"start\": 0, \"' + 408\r\nARROW:schema: '/////4gCAAAQAAAAAAAKAA4ABgAFAAgACgAAAAABAwAQAAAAAAAKAAwAAA' + 818\r\nARROW:schema: '/////2AGAAAQAAAAAAAKAA4ABgAFAAgACgAAAAABAwAQAAAAAAAKAAwAAA' + 2130\r\n\r\n>>> table2.schema\r\nA: int64\r\n  -- field metadata --\r\n  PARQUET:field_id: '1'\r\n-- schema metadata --\r\npandas: '{\"index_columns\": [{\"kind\": \"range\", \"name\": null, \"start\": 0, \"' + 408\r\nARROW:schema: '/////2AGAAAQAAAAAAAKAA4ABgAFAAgACgAAAAABAwAQAAAAAAAKAAwAAA' + 2130\r\n{code}\r\n\r\nSo indeed, as you said, it's the ARROW:schema size that is accumulating.\r\n\r\nSome observations:\r\n\r\n- In actual {{Table.schema}}, the ARROW:schema field is removed from the metadata (after reading). Sidenote: so if you would use this instead of {{file.schema.to_arrow_schema()}} that could be a temporary workaround for you.\r\n- When converting the ParquetSchema to a pyarrow Schema, we don't remove the \"ARROW:schema\" key, which we probably should do? (since that information is only used to propertly reconstruct the arrow schema, so once you have this arrow schema, we can drop the metadata for this. Similarly as we do when reading the actual file)\r\n- When writing with a schema that already has a \"ARROW:schema\"  metadata field, another field (with a duplicated key) gets added. I suppose this might be expected since the metadata doesn't check for duplicate keys right now. But it would also help in this case if the field would be over-written.",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=jorisvandenbossche",
                        "name": "jorisvandenbossche",
                        "key": "jorisvandenbossche",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "Joris Van den Bossche",
                        "active": true,
                        "timeZone": "Europe/Brussels"
                    },
                    "created": "2020-06-02T09:17:43.564+0000",
                    "updated": "2020-06-02T09:29:07.330+0000"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13308302/comment/17147529",
                    "id": "17147529",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=wesm",
                        "name": "wesm",
                        "key": "wesmckinn",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=wesmckinn&avatarId=29931",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=wesmckinn&avatarId=29931",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=wesmckinn&avatarId=29931",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=wesmckinn&avatarId=29931"
                        },
                        "displayName": "Wes McKinney",
                        "active": true,
                        "timeZone": "America/New_York"
                    },
                    "body": "Issue resolved by pull request 7577\n[https://github.com/apache/arrow/pull/7577]",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=wesm",
                        "name": "wesm",
                        "key": "wesmckinn",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=wesmckinn&avatarId=29931",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=wesmckinn&avatarId=29931",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=wesmckinn&avatarId=29931",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=wesmckinn&avatarId=29931"
                        },
                        "displayName": "Wes McKinney",
                        "active": true,
                        "timeZone": "America/New_York"
                    },
                    "created": "2020-06-29T04:08:44.697+0000",
                    "updated": "2020-06-29T04:08:44.697+0000"
                }
            ],
            "maxResults": 2,
            "total": 2,
            "startAt": 0
        },
        "customfield_12311820": "0|z0fbaw:",
        "customfield_12314139": null
    }
}