{
    "expand": "operations,versionedRepresentations,editmeta,changelog,renderedFields",
    "id": "13271581",
    "self": "https://issues.apache.org/jira/rest/api/2/issue/13271581",
    "key": "ARROW-7284",
    "fields": {
        "parent": {
            "id": "13271580",
            "key": "ARROW-7283",
            "self": "https://issues.apache.org/jira/rest/api/2/issue/13271580",
            "fields": {
                "summary": "[Integration] Ensure dictionary IPC implementations match spec clarifications",
                "status": {
                    "self": "https://issues.apache.org/jira/rest/api/2/status/1",
                    "description": "The issue is open and ready for the assignee to start work on it.",
                    "iconUrl": "https://issues.apache.org/jira/images/icons/statuses/open.png",
                    "name": "Open",
                    "id": "1",
                    "statusCategory": {
                        "self": "https://issues.apache.org/jira/rest/api/2/statuscategory/2",
                        "id": 2,
                        "key": "new",
                        "colorName": "blue-gray",
                        "name": "To Do"
                    }
                },
                "priority": {
                    "self": "https://issues.apache.org/jira/rest/api/2/priority/2",
                    "iconUrl": "https://issues.apache.org/jira/images/icons/priorities/critical.svg",
                    "name": "Critical",
                    "id": "2"
                },
                "issuetype": {
                    "self": "https://issues.apache.org/jira/rest/api/2/issuetype/4",
                    "id": "4",
                    "description": "An improvement or enhancement to an existing feature or task.",
                    "iconUrl": "https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21140&avatarType=issuetype",
                    "name": "Improvement",
                    "subtask": false,
                    "avatarId": 21140
                }
            }
        },
        "fixVersions": [
            {
                "self": "https://issues.apache.org/jira/rest/api/2/version/12340948",
                "id": "12340948",
                "description": "",
                "name": "0.16.0",
                "archived": false,
                "released": true,
                "releaseDate": "2020-02-07"
            }
        ],
        "resolution": {
            "self": "https://issues.apache.org/jira/rest/api/2/resolution/1",
            "id": "1",
            "description": "A fix for this issue is checked into the tree and tested.",
            "name": "Fixed"
        },
        "customfield_12312322": null,
        "customfield_12312323": null,
        "customfield_12312320": null,
        "customfield_12310420": "9223372036854775807",
        "customfield_12312321": null,
        "customfield_12312328": null,
        "customfield_12312329": null,
        "customfield_12312326": null,
        "customfield_12310300": null,
        "customfield_12312327": null,
        "customfield_12312324": null,
        "customfield_12312720": null,
        "customfield_12312325": null,
        "lastViewed": null,
        "priority": {
            "self": "https://issues.apache.org/jira/rest/api/2/priority/3",
            "iconUrl": "https://issues.apache.org/jira/images/icons/priorities/major.svg",
            "name": "Major",
            "id": "3"
        },
        "labels": [
            "pull-request-available"
        ],
        "customfield_12312333": null,
        "customfield_12312334": null,
        "customfield_12313422": "false",
        "customfield_12310310": "0.0",
        "customfield_12312331": null,
        "customfield_12312332": null,
        "aggregatetimeoriginalestimate": null,
        "timeestimate": 0,
        "customfield_12312330": null,
        "versions": [],
        "customfield_12311120": null,
        "customfield_12313826": null,
        "customfield_12312339": null,
        "issuelinks": [],
        "customfield_12313825": null,
        "assignee": {
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=tianchen92",
            "name": "tianchen92",
            "key": "tianchen92",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=tianchen92&avatarId=40800",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tianchen92&avatarId=40800",
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tianchen92&avatarId=40800",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tianchen92&avatarId=40800"
            },
            "displayName": "Ji Liu",
            "active": true,
            "timeZone": "Asia/Gaza"
        },
        "customfield_12312337": null,
        "customfield_12313823": null,
        "customfield_12312338": null,
        "customfield_12311920": null,
        "customfield_12313822": null,
        "customfield_12312335": null,
        "customfield_12313821": null,
        "customfield_12312336": null,
        "customfield_12313820": null,
        "status": {
            "self": "https://issues.apache.org/jira/rest/api/2/status/5",
            "description": "A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.",
            "iconUrl": "https://issues.apache.org/jira/images/icons/statuses/resolved.png",
            "name": "Resolved",
            "id": "5",
            "statusCategory": {
                "self": "https://issues.apache.org/jira/rest/api/2/statuscategory/3",
                "id": 3,
                "key": "done",
                "colorName": "green",
                "name": "Done"
            }
        },
        "components": [
            {
                "self": "https://issues.apache.org/jira/rest/api/2/component/12328933",
                "id": "12328933",
                "name": "Java"
            }
        ],
        "customfield_12312026": null,
        "customfield_12312023": null,
        "customfield_12312024": null,
        "aggregatetimeestimate": 0,
        "customfield_12312022": null,
        "customfield_12310921": null,
        "customfield_12310920": "9223372036854775807",
        "customfield_12312823": null,
        "creator": {
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=emkornfield%40gmail.com",
            "name": "emkornfield@gmail.com",
            "key": "emkornfield@gmail.com",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
            },
            "displayName": "Micah Kornfield",
            "active": true,
            "timeZone": "Etc/UTC"
        },
        "subtasks": [],
        "reporter": {
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=emkornfield%40gmail.com",
            "name": "emkornfield@gmail.com",
            "key": "emkornfield@gmail.com",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
            },
            "displayName": "Micah Kornfield",
            "active": true,
            "timeZone": "Etc/UTC"
        },
        "aggregateprogress": {
            "progress": 8400,
            "total": 8400,
            "percent": 100
        },
        "customfield_12313520": null,
        "customfield_12310250": null,
        "progress": {
            "progress": 8400,
            "total": 8400,
            "percent": 100
        },
        "customfield_12313924": null,
        "votes": {
            "self": "https://issues.apache.org/jira/rest/api/2/issue/ARROW-7284/votes",
            "votes": 0,
            "hasVoted": false
        },
        "worklog": {
            "startAt": 0,
            "maxResults": 20,
            "total": 14,
            "worklogs": [
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13271581/worklog/352514",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "tianchen92 commented on pull request #5945: ARROW-7284: [Java] ensure java implementation meets clarified dictionary spec\nURL: https://github.com/apache/arrow/pull/5945\n \n \n   Related to [ARROW-7284](https://issues.apache.org/jira/browse/ARROW-7284). \r\n   As discussed on [[link](https://lists.apache.org/thread.html/d0f137e9db0abfcfde2ef879ca517a710f620e5be4dd749923d22c37@%3Cdev.arrow.apache.org%3E)]. This is the java side implementation.\r\n   1.  It is not required that all dictionary batches occur at the beginning\r\n   of the IPC stream format (if a the first record batch has an all null\r\n   dictionary encoded column, the null column's dictionary might not be sent\r\n   until later in the stream).\r\n   \r\n   2.  A second dictionary batch for the same ID that is not a \"delta batch\"\r\n   in an IPC stream indicates the dictionary should be replaced.\r\n   \r\n   3.  Clarifies that the file format, can only contain 1 \"NON-delta\"\r\n   dictionary batch and multiple \"delta\" dictionary batches.\r\n   \r\n   4.  Add an enum to dictionary metadata for possible future changes in what\r\n   format dictionary batches can be sent. (the most likely would be an array\r\n   Map<Int, Value>).  An enum is needed as a place holder to allow for forward\r\n   compatibility past the release 1.0.0.\n \n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2019-12-03T09:10:52.718+0000",
                    "updated": "2019-12-03T09:10:52.718+0000",
                    "started": "2019-12-03T09:10:52.717+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "352514",
                    "issueId": "13271581"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13271581/worklog/352515",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "tianchen92 commented on issue #5945: ARROW-7284: [Java] ensure java implementation meets clarified dictionary spec\nURL: https://github.com/apache/arrow/pull/5945#issuecomment-561071141\n \n \n   cc @emkornfield \n \n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2019-12-03T09:11:09.595+0000",
                    "updated": "2019-12-03T09:11:09.595+0000",
                    "started": "2019-12-03T09:11:09.595+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "352515",
                    "issueId": "13271581"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13271581/worklog/352516",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "github-actions[bot] commented on issue #5945: ARROW-7284: [Java] ensure java implementation meets clarified dictionary spec\nURL: https://github.com/apache/arrow/pull/5945#issuecomment-561073039\n \n \n   https://issues.apache.org/jira/browse/ARROW-7284\n \n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2019-12-03T09:16:02.507+0000",
                    "updated": "2019-12-03T09:16:02.507+0000",
                    "started": "2019-12-03T09:16:02.507+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "352516",
                    "issueId": "13271581"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13271581/worklog/358458",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "emkornfield commented on issue #5945: ARROW-7284: [Java] ensure java implementation meets clarified dictionary spec\nURL: https://github.com/apache/arrow/pull/5945#issuecomment-564911087\n \n \n   @tianchen92  sorry, I've been backlogged will try to review your open PRs over the next week or so (unless others get to them sooner CC @praveenbingo @pravindra @BryanCutler)\n \n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2019-12-12T08:54:02.396+0000",
                    "updated": "2019-12-12T08:54:02.396+0000",
                    "started": "2019-12-12T08:54:02.396+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "358458",
                    "issueId": "13271581"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13271581/worklog/369678",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "emkornfield commented on pull request #5945: ARROW-7284: [Java] ensure java implementation meets clarified dictionary spec\nURL: https://github.com/apache/arrow/pull/5945#discussion_r365107486\n \n \n\n ##########\n File path: java/vector/src/test/java/org/apache/arrow/vector/ipc/TestArrowReaderWriter.java\n ##########\n @@ -86,29 +94,43 @@\n   public void init() {\n     allocator = new RootAllocator(Long.MAX_VALUE);\n \n-    VarCharVector dictionary1Vector = newVarCharVector(\"D1\", allocator);\n-    dictionary1Vector.allocateNewSafe();\n-    dictionary1Vector.set(0, \"foo\".getBytes(StandardCharsets.UTF_8));\n-    dictionary1Vector.set(1, \"bar\".getBytes(StandardCharsets.UTF_8));\n-    dictionary1Vector.set(2, \"baz\".getBytes(StandardCharsets.UTF_8));\n-    dictionary1Vector.setValueCount(3);\n-\n-    dictionary = new Dictionary(dictionary1Vector, new DictionaryEncoding(1L, false, null));\n-\n-    VarCharVector dictionary2Vector = newVarCharVector(\"D2\", allocator);\n-    dictionary2Vector.allocateNewSafe();\n-    dictionary2Vector.set(0, \"aa\".getBytes(StandardCharsets.UTF_8));\n-    dictionary2Vector.set(1, \"bb\".getBytes(StandardCharsets.UTF_8));\n-    dictionary2Vector.set(2, \"cc\".getBytes(StandardCharsets.UTF_8));\n-    dictionary2Vector.setValueCount(3);\n-\n-    dictionary2 = new Dictionary(dictionary2Vector, new DictionaryEncoding(2L, false, null));\n+    dictionaryVector1 = newVarCharVector(\"D1\", allocator);\n+    dictionaryVector1.allocateNewSafe();\n \n Review comment:\n   can't you use the test builders you wrote here?\n \n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2020-01-10T07:51:30.928+0000",
                    "updated": "2020-01-10T07:51:30.928+0000",
                    "started": "2020-01-10T07:51:30.928+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "369678",
                    "issueId": "13271581"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13271581/worklog/369681",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "emkornfield commented on pull request #5945: ARROW-7284: [Java] ensure java implementation meets clarified dictionary spec\nURL: https://github.com/apache/arrow/pull/5945#discussion_r365107618\n \n \n\n ##########\n File path: java/vector/src/test/java/org/apache/arrow/vector/ipc/TestArrowReaderWriter.java\n ##########\n @@ -86,29 +94,43 @@\n   public void init() {\n     allocator = new RootAllocator(Long.MAX_VALUE);\n \n-    VarCharVector dictionary1Vector = newVarCharVector(\"D1\", allocator);\n-    dictionary1Vector.allocateNewSafe();\n-    dictionary1Vector.set(0, \"foo\".getBytes(StandardCharsets.UTF_8));\n-    dictionary1Vector.set(1, \"bar\".getBytes(StandardCharsets.UTF_8));\n-    dictionary1Vector.set(2, \"baz\".getBytes(StandardCharsets.UTF_8));\n-    dictionary1Vector.setValueCount(3);\n-\n-    dictionary = new Dictionary(dictionary1Vector, new DictionaryEncoding(1L, false, null));\n-\n-    VarCharVector dictionary2Vector = newVarCharVector(\"D2\", allocator);\n-    dictionary2Vector.allocateNewSafe();\n-    dictionary2Vector.set(0, \"aa\".getBytes(StandardCharsets.UTF_8));\n-    dictionary2Vector.set(1, \"bb\".getBytes(StandardCharsets.UTF_8));\n-    dictionary2Vector.set(2, \"cc\".getBytes(StandardCharsets.UTF_8));\n-    dictionary2Vector.setValueCount(3);\n-\n-    dictionary2 = new Dictionary(dictionary2Vector, new DictionaryEncoding(2L, false, null));\n+    dictionaryVector1 = newVarCharVector(\"D1\", allocator);\n+    dictionaryVector1.allocateNewSafe();\n+    dictionaryVector1.set(0, \"foo\".getBytes(StandardCharsets.UTF_8));\n+    dictionaryVector1.set(1, \"bar\".getBytes(StandardCharsets.UTF_8));\n+    dictionaryVector1.set(2, \"baz\".getBytes(StandardCharsets.UTF_8));\n+    dictionaryVector1.setValueCount(3);\n+\n+    dictionaryVector2 = newVarCharVector(\"D2\", allocator);\n+    dictionaryVector2.allocateNewSafe();\n+    dictionaryVector2.set(0, \"aa\".getBytes(StandardCharsets.UTF_8));\n+    dictionaryVector2.set(1, \"bb\".getBytes(StandardCharsets.UTF_8));\n+    dictionaryVector2.set(2, \"cc\".getBytes(StandardCharsets.UTF_8));\n+    dictionaryVector2.setValueCount(3);\n+\n+    dictionaryVector3 = newVarCharVector(\"D3\", allocator);\n+    dictionaryVector3.allocateNewSafe();\n+    dictionaryVector3.set(0, \"foo\".getBytes(StandardCharsets.UTF_8));\n+    dictionaryVector3.set(1, \"bar\".getBytes(StandardCharsets.UTF_8));\n+    dictionaryVector3.set(2, \"baz\".getBytes(StandardCharsets.UTF_8));\n+    dictionaryVector3.set(3, \"aa\".getBytes(StandardCharsets.UTF_8));\n+    dictionaryVector3.set(4, \"bb\".getBytes(StandardCharsets.UTF_8));\n+    dictionaryVector3.set(5, \"cc\".getBytes(StandardCharsets.UTF_8));\n+    dictionaryVector3.setValueCount(6);\n+\n+    dictionary1 =\n+        new Dictionary(dictionaryVector1, new DictionaryEncoding(1L, false, null));\n \n Review comment:\n   please comment literal parameters with parameter names (/*dictionary_id=*/1L, etc)\n \n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2020-01-10T07:51:58.139+0000",
                    "updated": "2020-01-10T07:51:58.139+0000",
                    "started": "2020-01-10T07:51:58.139+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "369681",
                    "issueId": "13271581"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13271581/worklog/369683",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "emkornfield commented on pull request #5945: ARROW-7284: [Java] ensure java implementation meets clarified dictionary spec\nURL: https://github.com/apache/arrow/pull/5945#discussion_r365107741\n \n \n\n ##########\n File path: java/vector/src/test/java/org/apache/arrow/vector/ipc/TestArrowReaderWriter.java\n ##########\n @@ -361,6 +383,174 @@ public void testEmptyStreamInStreamingIPC() throws IOException {\n \n   }\n \n+  @Test\n+  public void testDictionaryReplacement() throws Exception {\n+    VarCharVector vector1 = newVarCharVector(\"varchar1\", allocator);\n+    vector1.allocateNewSafe();\n+    vector1.set(0, \"foo\".getBytes(StandardCharsets.UTF_8));\n \n Review comment:\n   same comment, can you use test builders here?\n \n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2020-01-10T07:52:32.521+0000",
                    "updated": "2020-01-10T07:52:32.521+0000",
                    "started": "2020-01-10T07:52:32.520+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "369683",
                    "issueId": "13271581"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13271581/worklog/369687",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "emkornfield commented on pull request #5945: ARROW-7284: [Java] ensure java implementation meets clarified dictionary spec\nURL: https://github.com/apache/arrow/pull/5945#discussion_r365108375\n \n \n\n ##########\n File path: java/vector/src/main/java/org/apache/arrow/vector/ipc/message/ArrowDictionaryBatch.java\n ##########\n @@ -30,10 +30,23 @@\n \n   private final long dictionaryId;\n   private final ArrowRecordBatch dictionary;\n+  private final boolean isDelta;\n \n   public ArrowDictionaryBatch(long dictionaryId, ArrowRecordBatch dictionary) {\n \n Review comment:\n   lets mark this as deprecated.\n \n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2020-01-10T07:55:03.377+0000",
                    "updated": "2020-01-10T07:55:03.377+0000",
                    "started": "2020-01-10T07:55:03.377+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "369687",
                    "issueId": "13271581"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13271581/worklog/369690",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "emkornfield commented on pull request #5945: ARROW-7284: [Java] ensure java implementation meets clarified dictionary spec\nURL: https://github.com/apache/arrow/pull/5945#discussion_r365108806\n \n \n\n ##########\n File path: java/vector/src/main/java/org/apache/arrow/vector/ipc/ArrowReader.java\n ##########\n @@ -229,4 +242,18 @@ protected void loadDictionary(ArrowDictionaryBatch dictionaryBatch) {\n       dictionaryBatch.close();\n     }\n   }\n+\n+  /**\n+   * Concat dictionary vector and delta dictionary vector.\n+   */\n+  private void concatDeltaDictionary(FieldVector vector, FieldVector deltaVector) {\n \n Review comment:\n   lets open up a JIRA to remove this method once https://github.com/apache/arrow/pull/5916 is merged.\n \n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2020-01-10T07:56:48.753+0000",
                    "updated": "2020-01-10T07:56:48.753+0000",
                    "started": "2020-01-10T07:56:48.753+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "369690",
                    "issueId": "13271581"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13271581/worklog/369762",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "tianchen92 commented on pull request #5945: ARROW-7284: [Java] ensure java implementation meets clarified dictionary spec\nURL: https://github.com/apache/arrow/pull/5945#discussion_r365161928\n \n \n\n ##########\n File path: java/vector/src/main/java/org/apache/arrow/vector/ipc/ArrowReader.java\n ##########\n @@ -229,4 +242,18 @@ protected void loadDictionary(ArrowDictionaryBatch dictionaryBatch) {\n       dictionaryBatch.close();\n     }\n   }\n+\n+  /**\n+   * Concat dictionary vector and delta dictionary vector.\n+   */\n+  private void concatDeltaDictionary(FieldVector vector, FieldVector deltaVector) {\n \n Review comment:\n   right, I will follow this issue.\n \n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2020-01-10T10:13:27.757+0000",
                    "updated": "2020-01-10T10:13:27.757+0000",
                    "started": "2020-01-10T10:13:27.757+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "369762",
                    "issueId": "13271581"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13271581/worklog/369764",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "tianchen92 commented on issue #5945: ARROW-7284: [Java] ensure java implementation meets clarified dictionary spec\nURL: https://github.com/apache/arrow/pull/5945#issuecomment-572973763\n \n \n   Thanks @emkornfield, PR updated according to your comments.\n \n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2020-01-10T10:14:15.342+0000",
                    "updated": "2020-01-10T10:14:15.342+0000",
                    "started": "2020-01-10T10:14:15.341+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "369764",
                    "issueId": "13271581"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13271581/worklog/373413",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "emkornfield commented on pull request #5945: ARROW-7284: [Java] ensure java implementation meets clarified dictionary spec\nURL: https://github.com/apache/arrow/pull/5945#discussion_r367778261\n \n \n\n ##########\n File path: java/vector/src/test/java/org/apache/arrow/vector/ipc/TestArrowReaderWriter.java\n ##########\n @@ -361,6 +381,170 @@ public void testEmptyStreamInStreamingIPC() throws IOException {\n \n   }\n \n+  @Test\n+  public void testDictionaryReplacement() throws Exception {\n+    VarCharVector vector1 = newVarCharVector(\"varchar1\", allocator);\n+    setVector(vector1,\n+        \"foo\".getBytes(StandardCharsets.UTF_8),\n+        \"bar\".getBytes(StandardCharsets.UTF_8),\n+        \"baz\".getBytes(StandardCharsets.UTF_8),\n+        \"bar\".getBytes(StandardCharsets.UTF_8));\n+\n+    FieldVector encodedVector1 = (FieldVector) DictionaryEncoder.encode(vector1, dictionary1);\n+\n+    VarCharVector vector2 = newVarCharVector(\"varchar2\", allocator);\n+    setVector(vector2,\n+        \"foo\".getBytes(StandardCharsets.UTF_8),\n+        \"foo\".getBytes(StandardCharsets.UTF_8),\n+        \"foo\".getBytes(StandardCharsets.UTF_8),\n+        \"foo\".getBytes(StandardCharsets.UTF_8));\n+\n+    FieldVector encodedVector2 = (FieldVector) DictionaryEncoder.encode(vector2, dictionary1);\n+\n+    DictionaryProvider.MapDictionaryProvider provider = new DictionaryProvider.MapDictionaryProvider();\n+    provider.put(dictionary1);\n+    List<Field> schemaFields = new ArrayList<>();\n+    schemaFields.add(DictionaryUtility.toMessageFormat(encodedVector1.getField(), provider, new HashSet<>()));\n+    schemaFields.add(DictionaryUtility.toMessageFormat(encodedVector2.getField(), provider, new HashSet<>()));\n+    Schema schema = new Schema(schemaFields);\n+\n+    ByteArrayOutputStream outStream = new ByteArrayOutputStream();\n+    WriteChannel out = new WriteChannel(newChannel(outStream));\n+\n+    // write schema\n+    MessageSerializer.serialize(out, schema);\n+\n+    List<AutoCloseable> closeableList = new ArrayList<>();\n+\n+    // write non-delta dictionary with id=1\n+    serializeDictionaryBatch(out, dictionary3, false, closeableList);\n+\n+    // write non-delta dictionary with id=1\n+    serializeDictionaryBatch(out, dictionary1, false, closeableList);\n+\n+    // write recordBatch2\n+    serializeRecordBatch(out, Arrays.asList(encodedVector1, encodedVector2), closeableList);\n \n Review comment:\n   is this necessary for this test?\n \n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2020-01-17T05:48:45.602+0000",
                    "updated": "2020-01-17T05:48:45.602+0000",
                    "started": "2020-01-17T05:48:45.602+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "373413",
                    "issueId": "13271581"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13271581/worklog/373423",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "tianchen92 commented on pull request #5945: ARROW-7284: [Java] ensure java implementation meets clarified dictionary spec\nURL: https://github.com/apache/arrow/pull/5945#discussion_r367782571\n \n \n\n ##########\n File path: java/vector/src/test/java/org/apache/arrow/vector/ipc/TestArrowReaderWriter.java\n ##########\n @@ -361,6 +381,170 @@ public void testEmptyStreamInStreamingIPC() throws IOException {\n \n   }\n \n+  @Test\n+  public void testDictionaryReplacement() throws Exception {\n+    VarCharVector vector1 = newVarCharVector(\"varchar1\", allocator);\n+    setVector(vector1,\n+        \"foo\".getBytes(StandardCharsets.UTF_8),\n+        \"bar\".getBytes(StandardCharsets.UTF_8),\n+        \"baz\".getBytes(StandardCharsets.UTF_8),\n+        \"bar\".getBytes(StandardCharsets.UTF_8));\n+\n+    FieldVector encodedVector1 = (FieldVector) DictionaryEncoder.encode(vector1, dictionary1);\n+\n+    VarCharVector vector2 = newVarCharVector(\"varchar2\", allocator);\n+    setVector(vector2,\n+        \"foo\".getBytes(StandardCharsets.UTF_8),\n+        \"foo\".getBytes(StandardCharsets.UTF_8),\n+        \"foo\".getBytes(StandardCharsets.UTF_8),\n+        \"foo\".getBytes(StandardCharsets.UTF_8));\n+\n+    FieldVector encodedVector2 = (FieldVector) DictionaryEncoder.encode(vector2, dictionary1);\n+\n+    DictionaryProvider.MapDictionaryProvider provider = new DictionaryProvider.MapDictionaryProvider();\n+    provider.put(dictionary1);\n+    List<Field> schemaFields = new ArrayList<>();\n+    schemaFields.add(DictionaryUtility.toMessageFormat(encodedVector1.getField(), provider, new HashSet<>()));\n+    schemaFields.add(DictionaryUtility.toMessageFormat(encodedVector2.getField(), provider, new HashSet<>()));\n+    Schema schema = new Schema(schemaFields);\n+\n+    ByteArrayOutputStream outStream = new ByteArrayOutputStream();\n+    WriteChannel out = new WriteChannel(newChannel(outStream));\n+\n+    // write schema\n+    MessageSerializer.serialize(out, schema);\n+\n+    List<AutoCloseable> closeableList = new ArrayList<>();\n+\n+    // write non-delta dictionary with id=1\n+    serializeDictionaryBatch(out, dictionary3, false, closeableList);\n+\n+    // write non-delta dictionary with id=1\n+    serializeDictionaryBatch(out, dictionary1, false, closeableList);\n+\n+    // write recordBatch2\n+    serializeRecordBatch(out, Arrays.asList(encodedVector1, encodedVector2), closeableList);\n \n Review comment:\n   I guess yes, if we only sent dictionaries without batches, seems dictionaries won't be read since we made this change in https://issues.apache.org/jira/browse/ARROW-6040\n \n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2020-01-17T06:12:08.730+0000",
                    "updated": "2020-01-17T06:12:08.730+0000",
                    "started": "2020-01-17T06:12:08.730+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "373423",
                    "issueId": "13271581"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13271581/worklog/373430",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "emkornfield commented on pull request #5945: ARROW-7284: [Java] ensure java implementation meets clarified dictionary spec\nURL: https://github.com/apache/arrow/pull/5945\n \n \n   \n \n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2020-01-17T06:23:50.601+0000",
                    "updated": "2020-01-17T06:23:50.601+0000",
                    "started": "2020-01-17T06:23:50.600+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "373430",
                    "issueId": "13271581"
                }
            ]
        },
        "customfield_12313920": null,
        "issuetype": {
            "self": "https://issues.apache.org/jira/rest/api/2/issuetype/7",
            "id": "7",
            "description": "The sub-task of the issue",
            "iconUrl": "https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21146&avatarType=issuetype",
            "name": "Sub-task",
            "subtask": true,
            "avatarId": 21146
        },
        "timespent": 8400,
        "customfield_12314020": "{summaryBean=com.atlassian.jira.plugin.devstatus.rest.SummaryBean@59a1b6d1[summary={pullrequest=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@2378e328[overall=PullRequestOverallBean{stateCount=0, state='OPEN', details=PullRequestOverallDetails{openCount=0, mergedCount=0, declinedCount=0}},byInstanceType={}], build=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@7b19f9e2[overall=com.atlassian.jira.plugin.devstatus.summary.beans.BuildOverallBean@1f1c340a[failedBuildCount=0,successfulBuildCount=0,unknownBuildCount=0,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], review=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@201a8da4[overall=com.atlassian.jira.plugin.devstatus.summary.beans.ReviewsOverallBean@59961924[stateCount=0,state=<null>,dueDate=<null>,overDue=false,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], deployment-environment=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@6df43d1d[overall=com.atlassian.jira.plugin.devstatus.summary.beans.DeploymentOverallBean@13b6e8cd[topEnvironments=[],showProjects=false,successfulCount=0,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], repository=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@67b520b2[overall=com.atlassian.jira.plugin.devstatus.summary.beans.CommitOverallBean@e835a59[count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], branch=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@42538241[overall=com.atlassian.jira.plugin.devstatus.summary.beans.BranchOverallBean@6687fa46[count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}]},errors=[],configErrors=[]], devSummaryJson={\"cachedValue\":{\"errors\":[],\"configErrors\":[],\"summary\":{\"pullrequest\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"stateCount\":0,\"state\":\"OPEN\",\"details\":{\"openCount\":0,\"mergedCount\":0,\"declinedCount\":0,\"total\":0},\"open\":true},\"byInstanceType\":{}},\"build\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"failedBuildCount\":0,\"successfulBuildCount\":0,\"unknownBuildCount\":0},\"byInstanceType\":{}},\"review\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"stateCount\":0,\"state\":null,\"dueDate\":null,\"overDue\":false,\"completed\":false},\"byInstanceType\":{}},\"deployment-environment\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"topEnvironments\":[],\"showProjects\":false,\"successfulCount\":0},\"byInstanceType\":{}},\"repository\":{\"overall\":{\"count\":0,\"lastUpdated\":null},\"byInstanceType\":{}},\"branch\":{\"overall\":{\"count\":0,\"lastUpdated\":null},\"byInstanceType\":{}}}},\"isStale\":false}}",
        "customfield_12314141": null,
        "customfield_12314140": null,
        "project": {
            "self": "https://issues.apache.org/jira/rest/api/2/project/12319525",
            "id": "12319525",
            "key": "ARROW",
            "name": "Apache Arrow",
            "projectTypeKey": "software",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/projectavatar?pid=12319525&avatarId=10011",
                "24x24": "https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12319525&avatarId=10011",
                "16x16": "https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12319525&avatarId=10011",
                "32x32": "https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12319525&avatarId=10011"
            },
            "projectCategory": {
                "self": "https://issues.apache.org/jira/rest/api/2/projectCategory/13960",
                "id": "13960",
                "description": "Apache Arrow",
                "name": "Arrow"
            }
        },
        "aggregatetimespent": 8400,
        "customfield_12312520": null,
        "customfield_12312521": "Fri Jan 17 06:24:06 UTC 2020",
        "customfield_12314422": null,
        "customfield_12314421": null,
        "customfield_12314146": null,
        "customfield_12314420": null,
        "customfield_12314145": null,
        "customfield_12314144": null,
        "customfield_12314143": null,
        "resolutiondate": "2020-01-17T06:24:06.000+0000",
        "workratio": -1,
        "customfield_12312923": null,
        "customfield_12312920": null,
        "customfield_12312921": null,
        "watches": {
            "self": "https://issues.apache.org/jira/rest/api/2/issue/ARROW-7284/watchers",
            "watchCount": 2,
            "isWatching": false
        },
        "created": "2019-12-02T01:18:26.000+0000",
        "updated": "2020-01-17T06:24:06.000+0000",
        "timeoriginalestimate": null,
        "description": "see parent issue.\r\n\r\n\u00a0\r\n\r\nCC [~tianchen92]",
        "customfield_10010": null,
        "timetracking": {
            "remainingEstimate": "0h",
            "timeSpent": "2h 20m",
            "remainingEstimateSeconds": 0,
            "timeSpentSeconds": 8400
        },
        "customfield_12314523": null,
        "customfield_12314127": null,
        "customfield_12314522": null,
        "customfield_12314126": null,
        "customfield_12314521": null,
        "customfield_12314125": null,
        "customfield_12314520": null,
        "customfield_12314124": null,
        "attachment": [],
        "customfield_12312340": null,
        "customfield_12314123": null,
        "customfield_12312341": null,
        "customfield_12312220": null,
        "customfield_12314122": null,
        "customfield_12314121": null,
        "customfield_12314120": null,
        "customfield_12314129": null,
        "customfield_12314524": null,
        "customfield_12314128": null,
        "summary": "[Java] ensure java implementation meets clarified dictionary spec",
        "customfield_12314130": null,
        "customfield_12310291": null,
        "customfield_12310290": null,
        "customfield_12314138": null,
        "customfield_12314137": null,
        "environment": null,
        "customfield_12314136": null,
        "customfield_12314135": null,
        "customfield_12311020": null,
        "customfield_12314134": null,
        "duedate": null,
        "customfield_12314132": null,
        "customfield_12314131": null,
        "comment": {
            "comments": [
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13271581/comment/17017744",
                    "id": "17017744",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=emkornfield%40gmail.com",
                        "name": "emkornfield@gmail.com",
                        "key": "emkornfield@gmail.com",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "Micah Kornfield",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "body": "Issue resolved by pull request 5945\n[https://github.com/apache/arrow/pull/5945]",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=emkornfield%40gmail.com",
                        "name": "emkornfield@gmail.com",
                        "key": "emkornfield@gmail.com",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "Micah Kornfield",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "created": "2020-01-17T06:24:06.160+0000",
                    "updated": "2020-01-17T06:24:06.160+0000"
                }
            ],
            "maxResults": 1,
            "total": 1,
            "startAt": 0
        },
        "customfield_12311820": "0|z0967s:",
        "customfield_12314139": null
    }
}