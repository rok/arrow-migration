{
    "expand": "operations,versionedRepresentations,editmeta,changelog,renderedFields",
    "id": "13447780",
    "self": "https://issues.apache.org/jira/rest/api/2/issue/13447780",
    "key": "ARROW-16700",
    "fields": {
        "fixVersions": [
            {
                "self": "https://issues.apache.org/jira/rest/api/2/version/12351550",
                "id": "12351550",
                "name": "9.0.0",
                "archived": false,
                "released": true,
                "releaseDate": "2022-08-03"
            }
        ],
        "resolution": {
            "self": "https://issues.apache.org/jira/rest/api/2/resolution/1",
            "id": "1",
            "description": "A fix for this issue is checked into the tree and tested.",
            "name": "Fixed"
        },
        "customfield_12312322": null,
        "customfield_12312323": null,
        "customfield_12312320": null,
        "customfield_12310420": "9223372036854775807",
        "customfield_12312321": null,
        "customfield_12312328": null,
        "customfield_12312329": null,
        "customfield_12312326": null,
        "customfield_12310300": null,
        "customfield_12312327": null,
        "customfield_12312324": null,
        "customfield_12312720": null,
        "customfield_12312325": null,
        "lastViewed": null,
        "priority": {
            "self": "https://issues.apache.org/jira/rest/api/2/priority/1",
            "iconUrl": "https://issues.apache.org/jira/images/icons/priorities/blocker.svg",
            "name": "Blocker",
            "id": "1"
        },
        "labels": [
            "pull-request-available"
        ],
        "customfield_12312333": null,
        "customfield_12312334": null,
        "customfield_12313422": "false",
        "customfield_12310310": "0.0",
        "customfield_12312331": null,
        "customfield_12312332": null,
        "aggregatetimeoriginalestimate": null,
        "timeestimate": 0,
        "customfield_12312330": null,
        "versions": [],
        "customfield_12311120": null,
        "customfield_12313826": null,
        "customfield_12312339": null,
        "issuelinks": [],
        "customfield_12313825": null,
        "assignee": {
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=jvanstraten",
            "name": "jvanstraten",
            "key": "JIRAUSER282962",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=JIRAUSER282962&avatarId=48950",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=JIRAUSER282962&avatarId=48950",
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=JIRAUSER282962&avatarId=48950",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=JIRAUSER282962&avatarId=48950"
            },
            "displayName": "Jeroen van Straten",
            "active": true,
            "timeZone": "Europe/Amsterdam"
        },
        "customfield_12312337": null,
        "customfield_12313823": null,
        "customfield_12312338": null,
        "customfield_12311920": null,
        "customfield_12313822": null,
        "customfield_12312335": null,
        "customfield_12313821": null,
        "customfield_12312336": null,
        "customfield_12313820": null,
        "status": {
            "self": "https://issues.apache.org/jira/rest/api/2/status/5",
            "description": "A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.",
            "iconUrl": "https://issues.apache.org/jira/images/icons/statuses/resolved.png",
            "name": "Resolved",
            "id": "5",
            "statusCategory": {
                "self": "https://issues.apache.org/jira/rest/api/2/statuscategory/3",
                "id": 3,
                "key": "done",
                "colorName": "green",
                "name": "Done"
            }
        },
        "components": [
            {
                "self": "https://issues.apache.org/jira/rest/api/2/component/12328935",
                "id": "12328935",
                "name": "C++"
            },
            {
                "self": "https://issues.apache.org/jira/rest/api/2/component/12333008",
                "id": "12333008",
                "name": "R"
            }
        ],
        "customfield_12312026": null,
        "customfield_12312023": null,
        "customfield_12312024": null,
        "aggregatetimeestimate": 0,
        "customfield_12312022": null,
        "customfield_12310921": null,
        "customfield_12310920": "9223372036854775807",
        "customfield_12312823": null,
        "creator": {
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=jonkeane",
            "name": "jonkeane",
            "key": "jonkeane",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=34057",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34057",
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34057",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34057"
            },
            "displayName": "Jonathan Keane",
            "active": true,
            "timeZone": "Etc/UTC"
        },
        "subtasks": [],
        "reporter": {
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=jonkeane",
            "name": "jonkeane",
            "key": "jonkeane",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=34057",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34057",
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34057",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34057"
            },
            "displayName": "Jonathan Keane",
            "active": true,
            "timeZone": "Etc/UTC"
        },
        "aggregateprogress": {
            "progress": 12000,
            "total": 12000,
            "percent": 100
        },
        "customfield_12313520": null,
        "customfield_12310250": null,
        "progress": {
            "progress": 12000,
            "total": 12000,
            "percent": 100
        },
        "customfield_12313924": null,
        "votes": {
            "self": "https://issues.apache.org/jira/rest/api/2/issue/ARROW-16700/votes",
            "votes": 0,
            "hasVoted": false
        },
        "worklog": {
            "startAt": 0,
            "maxResults": 20,
            "total": 20,
            "worklogs": [
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13447780/worklog/787616",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "jvanstraten opened a new pull request, #13509:\nURL: https://github.com/apache/arrow/pull/13509\n\n   The min/max aggregate compute kernels seemed to discard their state between partitions, so they would only aggregate the last partition they see (in each thread).\r\n   \r\n   This is the simplest change I could come up with to fix this, but honestly I'm not sure why the `local` variable even exists. It seems to me it could just be replaced with `this->state` directly, since there doesn't seem to be any failure path where `this->state` isn't updated from `local`. Am I missing something?\n\n\n",
                    "created": "2022-07-04T14:17:14.147+0000",
                    "updated": "2022-07-04T14:17:14.147+0000",
                    "started": "2022-07-04T14:17:14.147+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "787616",
                    "issueId": "13447780"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13447780/worklog/787617",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "github-actions[bot] commented on PR #13509:\nURL: https://github.com/apache/arrow/pull/13509#issuecomment-1173873922\n\n   https://issues.apache.org/jira/browse/ARROW-16700\n\n\n",
                    "created": "2022-07-04T14:17:37.139+0000",
                    "updated": "2022-07-04T14:17:37.139+0000",
                    "started": "2022-07-04T14:17:37.138+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "787617",
                    "issueId": "13447780"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13447780/worklog/787898",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "jvanstraten commented on PR #13509:\nURL: https://github.com/apache/arrow/pull/13509#issuecomment-1175169931\n\n   Chunked arrays are tested [here](https://github.com/apache/arrow/blob/3d6240c1ee7802829d2ed209f4135906e9413915/cpp/src/arrow/compute/kernels/aggregate_test.cc#L1566-L1568), but, as cleaned up from my debug prints for `chunked_input1`, the call pattern there is\r\n   \r\n   ```\r\n   auto min_max_impl_1 = MinMaxImpl(...)\r\n   auto min_max_impl_2 = MinMaxImpl(...)\r\n   min_max_impl_2.Consume([5,1,2,3,4]) -> (1, 5)\r\n   min_max_impl_1.MergeFrom(min_max_impl_2) -> (1, 5)\r\n   auto min_max_impl_3 = MinMaxImpl(...)\r\n   min_max_impl_3.Consume([9,1,null,3,4]) -> (1, 9)\r\n   min_max_impl_1.MergeFrom(min_max_impl_3) -> (1, 9)\r\n   min_max_impl_1.Finalize() -> (1, 9)\r\n   ```\r\n   \r\n   for which it does not matter whether `Consume()` overrides the previous state. The test cases aren't great anyway since the last chunk has the min and max values for each of them, but even if I'd swap one of them around you'd still get\r\n   \r\n   ```\r\n   auto min_max_impl_1 = MinMaxImpl(...)\r\n   auto min_max_impl_2 = MinMaxImpl(...)\r\n   min_max_impl_2.Consume([9,1,null,3,4]) -> (1, 9)\r\n   min_max_impl_1.MergeFrom(min_max_impl_2) -> (1, 9)\r\n   auto min_max_impl_3 = MinMaxImpl(...)\r\n   min_max_impl_3.Consume([5,1,2,3,4]) -> (1, 5)\r\n   min_max_impl_1.MergeFrom(min_max_impl_3) -> (1, 9)\r\n   min_max_impl_1.Finalize() -> (1, 9)\r\n   ```\r\n   \r\n   I don't know why it's doing it this way. Seems rather inefficient to me. Evidently though, for larger-scale workloads it *does* call `Consume()` more than once before merging and throwing away each `MinMaxImpl` instance.\n\n\n",
                    "created": "2022-07-05T15:06:02.101+0000",
                    "updated": "2022-07-05T15:06:02.101+0000",
                    "started": "2022-07-05T15:06:02.101+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "787898",
                    "issueId": "13447780"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13447780/worklog/787906",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "lidavidm commented on PR #13509:\nURL: https://github.com/apache/arrow/pull/13509#issuecomment-1175194160\n\n   My bad, I was looking at the hash aggregate tests! \r\n   \r\n   I suppose the 'right' way to test it is to construct an ExecPlan and feed the data through. There are some tests in plan_test.cc but it doesn't have much coverage of the kernels themselves. We may need some parameterization/a helper to test \"both ways\" of calling aggregates in much the same way hash_aggregate_test.cc does.\n\n\n",
                    "created": "2022-07-05T15:28:34.189+0000",
                    "updated": "2022-07-05T15:28:34.189+0000",
                    "started": "2022-07-05T15:28:34.188+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "787906",
                    "issueId": "13447780"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13447780/worklog/787907",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "lidavidm commented on PR #13509:\nURL: https://github.com/apache/arrow/pull/13509#issuecomment-1175195111\n\n   The behavior you're seeing stems from this: https://github.com/apache/arrow/blob/3d6240c1ee7802829d2ed209f4135906e9413915/cpp/src/arrow/compute/exec.cc#L1124-L1177\r\n   \r\n   We could/should fix that up too (perhaps in a separate JIRA)\n\n\n",
                    "created": "2022-07-05T15:29:30.706+0000",
                    "updated": "2022-07-05T15:29:30.706+0000",
                    "started": "2022-07-05T15:29:30.705+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "787907",
                    "issueId": "13447780"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13447780/worklog/787909",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "lidavidm commented on PR #13509:\nURL: https://github.com/apache/arrow/pull/13509#issuecomment-1175195775\n\n   I suppose it's done that way because of the `// TODO: implement parallelism` but I wonder if we want to just say, \"use Acero for that\", or if we do want to actually go implement parallelism\n\n\n",
                    "created": "2022-07-05T15:30:14.262+0000",
                    "updated": "2022-07-05T15:30:14.262+0000",
                    "started": "2022-07-05T15:30:14.262+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "787909",
                    "issueId": "13447780"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13447780/worklog/787935",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "westonpace commented on PR #13509:\nURL: https://github.com/apache/arrow/pull/13509#issuecomment-1175256838\n\n   > I suppose the 'right' way to test it is to construct an ExecPlan and feed the data through. There are some tests in plan_test.cc but it doesn't have much coverage of the kernels themselves. We may need some parameterization/a helper to test \"both ways\" of calling aggregates in much the same way hash_aggregate_test.cc does.\r\n   \r\n   @drin is working on this for min/max.\r\n   \r\n   I think there is probably more interest/priority in making the exec plan case work well vs the chunked array case.  If you are doing compute on chunked arrays and the entire chunked array fits in memory, then it is probably sufficient to just concatenate the chunked array into a single array at the beginning of your compute work.\n\n\n",
                    "created": "2022-07-05T16:32:59.735+0000",
                    "updated": "2022-07-05T16:32:59.735+0000",
                    "started": "2022-07-05T16:32:59.734+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "787935",
                    "issueId": "13447780"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13447780/worklog/788003",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "jvanstraten opened a new pull request, #13518:\nURL: https://github.com/apache/arrow/pull/13518\n\n   This updates the Scanner node such that it will use the guarantee expression to fill out columns missing from the dataset but guaranteed to be some constant with appropriate scalars, rather than just inserting a null placeholder column. In case both are available, the dataset constructor prefers using the scalar from the guarantee expression over the actual data, since the latter would probably be an array that unnecessarily repeats the constant value.\r\n   \r\n   This is the other part of what was uncovered while analyzing ARROW-16700, the more direct cause being a duplicate of ARROW-16904 (see also https://github.com/apache/arrow/pull/13509 for my fix for that).\n\n\n",
                    "created": "2022-07-05T18:33:58.548+0000",
                    "updated": "2022-07-05T18:33:58.548+0000",
                    "started": "2022-07-05T18:33:58.548+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "788003",
                    "issueId": "13447780"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13447780/worklog/788005",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "github-actions[bot] commented on PR #13518:\nURL: https://github.com/apache/arrow/pull/13518#issuecomment-1175369755\n\n   https://issues.apache.org/jira/browse/ARROW-16700\n\n\n",
                    "created": "2022-07-05T18:34:19.540+0000",
                    "updated": "2022-07-05T18:34:19.540+0000",
                    "started": "2022-07-05T18:34:19.540+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "788005",
                    "issueId": "13447780"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13447780/worklog/790538",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "westonpace commented on code in PR #13518:\nURL: https://github.com/apache/arrow/pull/13518#discussion_r920364266\n\n\n##########\ncpp/src/arrow/dataset/scanner_test.cc:\n##########\n@@ -1445,9 +1446,13 @@ DatasetAndBatches MakeBasicDataset() {\n           equal(field_ref(\"c\"), literal(23)),\n           equal(field_ref(\"c\"), literal(47)),\n       },\n-      [](compute::ExecBatch* batch, const RecordBatch&) {\n+      [](compute::ExecBatch* batch, const RecordBatch&, size_t guarantee_index) {\n         // a placeholder will be inserted for partition field \"c\"\n-        batch->values.emplace_back(std::make_shared<Int32Scalar>());\n+        if (guarantee_index == 0) {\n+          batch->values.emplace_back(std::make_shared<Int32Scalar>(23));\n+        } else {\n+          batch->values.emplace_back(std::make_shared<Int32Scalar>(47));\n+        }\n\nReview Comment:\n   This seems like a spot-fix.  Perhaps a more general fix would be to fix the `DatasetAndBatchesFromJSON` function?\n\n\n\n",
                    "created": "2022-07-13T18:04:15.566+0000",
                    "updated": "2022-07-13T18:04:15.566+0000",
                    "started": "2022-07-13T18:04:15.566+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "790538",
                    "issueId": "13447780"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13447780/worklog/791063",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "drin commented on PR #13518:\nURL: https://github.com/apache/arrow/pull/13518#issuecomment-1184693894\n\n   rebased branch\n\n\n",
                    "created": "2022-07-14T17:11:09.535+0000",
                    "updated": "2022-07-14T17:11:09.535+0000",
                    "started": "2022-07-14T17:11:09.535+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "791063",
                    "issueId": "13447780"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13447780/worklog/791599",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "drin commented on code in PR #13518:\nURL: https://github.com/apache/arrow/pull/13518#discussion_r922566935\n\n\n##########\ncpp/src/arrow/dataset/scanner_test.cc:\n##########\n@@ -1445,9 +1446,13 @@ DatasetAndBatches MakeBasicDataset() {\n           equal(field_ref(\"c\"), literal(23)),\n           equal(field_ref(\"c\"), literal(47)),\n       },\n-      [](compute::ExecBatch* batch, const RecordBatch&) {\n+      [](compute::ExecBatch* batch, const RecordBatch&, size_t guarantee_index) {\n         // a placeholder will be inserted for partition field \"c\"\n-        batch->values.emplace_back(std::make_shared<Int32Scalar>());\n+        if (guarantee_index == 0) {\n+          batch->values.emplace_back(std::make_shared<Int32Scalar>(23));\n+        } else {\n+          batch->values.emplace_back(std::make_shared<Int32Scalar>(47));\n+        }\n\nReview Comment:\n   I address this in .\r\n   \r\n   I essentially change the invocation of the lambda to:\r\n   ```cpp\r\n   if (not guarantees.empty()) {\r\n     auto extract_result = ExtractKnownFieldValues(guarantees[frag_ndx]);\r\n     ARROW_WARN_NOT_OK(extract_result.status(), \"ExtractKnownFieldValues failed\");\r\n     for (const auto& known_field : extract_result->map) {\r\n       batches.back().values.emplace_back(known_field.second);\r\n     }\r\n   }\r\n   ```\r\n   \r\n   ooh, but I just realized I used `not` instead of `!`. I'm not sure if there's a preference\n\n\n\n",
                    "created": "2022-07-15T23:00:03.585+0000",
                    "updated": "2022-07-15T23:00:03.585+0000",
                    "started": "2022-07-15T23:00:03.584+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "791599",
                    "issueId": "13447780"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13447780/worklog/791600",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "drin commented on code in PR #13518:\nURL: https://github.com/apache/arrow/pull/13518#discussion_r922566935\n\n\n##########\ncpp/src/arrow/dataset/scanner_test.cc:\n##########\n@@ -1445,9 +1446,13 @@ DatasetAndBatches MakeBasicDataset() {\n           equal(field_ref(\"c\"), literal(23)),\n           equal(field_ref(\"c\"), literal(47)),\n       },\n-      [](compute::ExecBatch* batch, const RecordBatch&) {\n+      [](compute::ExecBatch* batch, const RecordBatch&, size_t guarantee_index) {\n         // a placeholder will be inserted for partition field \"c\"\n-        batch->values.emplace_back(std::make_shared<Int32Scalar>());\n+        if (guarantee_index == 0) {\n+          batch->values.emplace_back(std::make_shared<Int32Scalar>(23));\n+        } else {\n+          batch->values.emplace_back(std::make_shared<Int32Scalar>(47));\n+        }\n\nReview Comment:\n   I address this in https://github.com/apache/arrow/pull/13518/commits/8b9137e8fb7ca0d4d017bc995d6705a271ae4141.\r\n   \r\n   I essentially change the invocation of the lambda to:\r\n   ```cpp\r\n   if (not guarantees.empty()) {\r\n     auto extract_result = ExtractKnownFieldValues(guarantees[frag_ndx]);\r\n     ARROW_WARN_NOT_OK(extract_result.status(), \"ExtractKnownFieldValues failed\");\r\n     for (const auto& known_field : extract_result->map) {\r\n       batches.back().values.emplace_back(known_field.second);\r\n     }\r\n   }\r\n   ```\r\n   \r\n   ooh, but I just realized I used `not` instead of `!`. I'm not sure if there's a preference\n\n\n\n",
                    "created": "2022-07-15T23:00:28.253+0000",
                    "updated": "2022-07-15T23:00:28.253+0000",
                    "started": "2022-07-15T23:00:28.252+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "791600",
                    "issueId": "13447780"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13447780/worklog/791601",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "drin commented on PR #13518:\nURL: https://github.com/apache/arrow/pull/13518#issuecomment-1186012854\n\n   I confirmed that the C++ unit tests validate the fix provided in this PR. Still working on an R test that correctly validates the fix.\r\n   \r\n   https://github.com/apache/arrow/blob/6592ad2472bad6f268448cdb9a0e6c2c0dd4a6e4/cpp/src/arrow/dataset/scanner.cc#L911-L916\n\n\n",
                    "created": "2022-07-15T23:07:02.232+0000",
                    "updated": "2022-07-15T23:07:02.232+0000",
                    "started": "2022-07-15T23:07:02.232+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "791601",
                    "issueId": "13447780"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13447780/worklog/792164",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "westonpace commented on PR #13518:\nURL: https://github.com/apache/arrow/pull/13518#issuecomment-1187586861\n\n   I'm sorry but I believe I have sent you on a wild goose chase.  I had suggested an R test but, upon re-reading the JIRA, realize that I had forgotten this is not reproducible from R (because it always inserts a project node prior to an aggregate node) and so no R test is needed.\n\n\n",
                    "created": "2022-07-18T14:42:03.216+0000",
                    "updated": "2022-07-18T14:42:03.216+0000",
                    "started": "2022-07-18T14:42:03.216+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "792164",
                    "issueId": "13447780"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13447780/worklog/792169",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "westonpace commented on code in PR #13518:\nURL: https://github.com/apache/arrow/pull/13518#discussion_r923460831\n\n\n##########\ncpp/src/arrow/dataset/scanner_test.cc:\n##########\n@@ -1377,37 +1381,40 @@ DatasetAndBatches DatasetAndBatchesFromJSON(\n                           fragment_batches.end());\n     fragments.push_back(std::make_shared<InMemoryFragment>(\n         physical_schema, std::move(fragment_batches),\n-        guarantees.empty() ? literal(true) : guarantees[i]));\n+        guarantees.empty() ? literal(true) : guarantees[frag_ndx]));\n   }\n \n+  // then construct ExecBatches that can reference fields from constructed Fragments\n   std::vector<compute::ExecBatch> batches;\n   auto batch_it = record_batches.begin();\n-  for (size_t fragment_index = 0; fragment_index < fragment_batch_strs.size();\n-       ++fragment_index) {\n-    for (size_t batch_index = 0; batch_index < fragment_batch_strs[fragment_index].size();\n-         ++batch_index) {\n+  for (size_t frag_ndx = 0; frag_ndx < fragment_batch_strs.size(); ++frag_ndx) {\n+    size_t frag_batch_count = fragment_batch_strs[frag_ndx].size();\n+\n+    for (size_t batch_index = 0; batch_index < frag_batch_count; ++batch_index) {\n       const auto& batch = *batch_it++;\n \n       // the scanned ExecBatches will begin with physical columns\n       batches.emplace_back(*batch);\n \n-      // allow customizing the ExecBatch (e.g. to fill in placeholders for partition\n-      // fields)\n-      if (make_exec_batch) {\n-        make_exec_batch(&batches.back(), *batch);\n+      // augment scanned ExecBatch with columns for this fragment's guarantee\n+      if (not guarantees.empty()) {\n\nReview Comment:\n   ```suggestion\r\n         if (!guarantees.empty()) {\r\n   ```\n\n\n\n##########\ncpp/src/arrow/dataset/scanner_test.cc:\n##########\n@@ -1377,37 +1381,40 @@ DatasetAndBatches DatasetAndBatchesFromJSON(\n                           fragment_batches.end());\n     fragments.push_back(std::make_shared<InMemoryFragment>(\n         physical_schema, std::move(fragment_batches),\n-        guarantees.empty() ? literal(true) : guarantees[i]));\n+        guarantees.empty() ? literal(true) : guarantees[frag_ndx]));\n   }\n \n+  // then construct ExecBatches that can reference fields from constructed Fragments\n   std::vector<compute::ExecBatch> batches;\n   auto batch_it = record_batches.begin();\n-  for (size_t fragment_index = 0; fragment_index < fragment_batch_strs.size();\n-       ++fragment_index) {\n-    for (size_t batch_index = 0; batch_index < fragment_batch_strs[fragment_index].size();\n-         ++batch_index) {\n+  for (size_t frag_ndx = 0; frag_ndx < fragment_batch_strs.size(); ++frag_ndx) {\n+    size_t frag_batch_count = fragment_batch_strs[frag_ndx].size();\n+\n+    for (size_t batch_index = 0; batch_index < frag_batch_count; ++batch_index) {\n       const auto& batch = *batch_it++;\n \n       // the scanned ExecBatches will begin with physical columns\n       batches.emplace_back(*batch);\n \n-      // allow customizing the ExecBatch (e.g. to fill in placeholders for partition\n-      // fields)\n-      if (make_exec_batch) {\n-        make_exec_batch(&batches.back(), *batch);\n+      // augment scanned ExecBatch with columns for this fragment's guarantee\n+      if (not guarantees.empty()) {\n+        auto extract_result = ExtractKnownFieldValues(guarantees[frag_ndx]);\n+        ARROW_WARN_NOT_OK(extract_result.status(), \"ExtractKnownFieldValues failed\");\n\nReview Comment:\n   ```suggestion\r\n           EXPECT_OK_AND_ASSIGN(auto extract_result, ExtractKnownFieldValues(guarantees[frag_ndx]));\r\n   ```\n\n\n\n",
                    "created": "2022-07-18T14:47:23.158+0000",
                    "updated": "2022-07-18T14:47:23.158+0000",
                    "started": "2022-07-18T14:47:23.158+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "792169",
                    "issueId": "13447780"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13447780/worklog/792403",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "drin commented on code in PR #13518:\nURL: https://github.com/apache/arrow/pull/13518#discussion_r923988095\n\n\n##########\ncpp/src/arrow/dataset/scanner_test.cc:\n##########\n@@ -1445,9 +1446,13 @@ DatasetAndBatches MakeBasicDataset() {\n           equal(field_ref(\"c\"), literal(23)),\n           equal(field_ref(\"c\"), literal(47)),\n       },\n-      [](compute::ExecBatch* batch, const RecordBatch&) {\n+      [](compute::ExecBatch* batch, const RecordBatch&, size_t guarantee_index) {\n         // a placeholder will be inserted for partition field \"c\"\n-        batch->values.emplace_back(std::make_shared<Int32Scalar>());\n+        if (guarantee_index == 0) {\n+          batch->values.emplace_back(std::make_shared<Int32Scalar>(23));\n+        } else {\n+          batch->values.emplace_back(std::make_shared<Int32Scalar>(47));\n+        }\n\nReview Comment:\n   oddly enough, I can't mark this resolved.\n\n\n\n",
                    "created": "2022-07-19T01:46:25.854+0000",
                    "updated": "2022-07-19T01:46:25.854+0000",
                    "started": "2022-07-19T01:46:25.853+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "792403",
                    "issueId": "13447780"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13447780/worklog/794298",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "westonpace commented on code in PR #13518:\nURL: https://github.com/apache/arrow/pull/13518#discussion_r927812785\n\n\n##########\ncpp/src/arrow/dataset/scanner_test.cc:\n##########\n@@ -1358,16 +1359,19 @@ DatasetAndBatches DatasetAndBatchesFromJSON(\n     const std::shared_ptr<Schema>& dataset_schema,\n     const std::shared_ptr<Schema>& physical_schema,\n     const std::vector<std::vector<std::string>>& fragment_batch_strs,\n-    const std::vector<compute::Expression>& guarantees,\n-    std::function<void(compute::ExecBatch*, const RecordBatch&)> make_exec_batch = {}) {\n+    const std::vector<compute::Expression>& guarantees) {\n+  // Expect a guarantee expr for each test fragment\n\nReview Comment:\n   ```suggestion\r\n     // If guarantees are provided we must have one for each batch\r\n   ```\n\n\n\n",
                    "created": "2022-07-22T16:22:50.094+0000",
                    "updated": "2022-07-22T16:22:50.094+0000",
                    "started": "2022-07-22T16:22:50.094+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "794298",
                    "issueId": "13447780"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13447780/worklog/794300",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "westonpace merged PR #13518:\nURL: https://github.com/apache/arrow/pull/13518\n\n\n",
                    "created": "2022-07-22T16:24:39.895+0000",
                    "updated": "2022-07-22T16:24:39.895+0000",
                    "started": "2022-07-22T16:24:39.895+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "794300",
                    "issueId": "13447780"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13447780/worklog/794548",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "ursabot commented on PR #13518:\nURL: https://github.com/apache/arrow/pull/13518#issuecomment-1193170576\n\n   Benchmark runs are scheduled for baseline = b3ce0fa7b682c891a33b4ac44711e949f9eff577 and contender = e0ccfa110544e65b4e7ef2f9d39376a3dfb8420d. e0ccfa110544e65b4e7ef2f9d39376a3dfb8420d is a master commit associated with this PR. Results will be available as each benchmark for each run completes.\n   Conbench compare runs links:\n   [Failed] [ec2-t3-xlarge-us-east-2](https://conbench.ursa.dev/compare/runs/d71d3d711d4b40d18181baba86b34c86...915a79b1ee9442809be122c4ee073f68/)\n   [Failed :arrow_down:0.59% :arrow_up:0.0%] [test-mac-arm](https://conbench.ursa.dev/compare/runs/90b1a7b4a1214586bf5dd7b8e7fb7189...a8ab325d6b744228bba538da986cc651/)\n   [Failed :arrow_down:0.63% :arrow_up:0.0%] [ursa-i9-9960x](https://conbench.ursa.dev/compare/runs/b95b28a4203244bfb7040145767fe73c...980f5fd0bcfc4faaaf4c368077b1462a/)\n   [Finished :arrow_down:0.29% :arrow_up:0.0%] [ursa-thinkcentre-m75q](https://conbench.ursa.dev/compare/runs/9d504daa46f442abb53d7e6e78dbe997...ac8abfdcad7a4df6b50f8983a07c04fa/)\n   Buildkite builds:\n   [Failed] [`e0ccfa11` ec2-t3-xlarge-us-east-2](https://buildkite.com/apache-arrow/arrow-bci-benchmark-on-ec2-t3-xlarge-us-east-2/builds/1182)\n   [Failed] [`e0ccfa11` test-mac-arm](https://buildkite.com/apache-arrow/arrow-bci-benchmark-on-test-mac-arm/builds/1194)\n   [Failed] [`e0ccfa11` ursa-i9-9960x](https://buildkite.com/apache-arrow/arrow-bci-benchmark-on-ursa-i9-9960x/builds/1176)\n   [Finished] [`e0ccfa11` ursa-thinkcentre-m75q](https://buildkite.com/apache-arrow/arrow-bci-benchmark-on-ursa-thinkcentre-m75q/builds/1196)\n   [Failed] [`b3ce0fa7` ec2-t3-xlarge-us-east-2](https://buildkite.com/apache-arrow/arrow-bci-benchmark-on-ec2-t3-xlarge-us-east-2/builds/1181)\n   [Failed] [`b3ce0fa7` test-mac-arm](https://buildkite.com/apache-arrow/arrow-bci-benchmark-on-test-mac-arm/builds/1193)\n   [Failed] [`b3ce0fa7` ursa-i9-9960x](https://buildkite.com/apache-arrow/arrow-bci-benchmark-on-ursa-i9-9960x/builds/1175)\n   [Finished] [`b3ce0fa7` ursa-thinkcentre-m75q](https://buildkite.com/apache-arrow/arrow-bci-benchmark-on-ursa-thinkcentre-m75q/builds/1195)\n   Supported benchmarks:\n   ec2-t3-xlarge-us-east-2: Supported benchmark langs: Python, R. Runs only benchmarks with cloud = True\n   test-mac-arm: Supported benchmark langs: C++, Python, R\n   ursa-i9-9960x: Supported benchmark langs: Python, R, JavaScript\n   ursa-thinkcentre-m75q: Supported benchmark langs: C++, Java\n   \n\n\n",
                    "created": "2022-07-23T18:41:23.983+0000",
                    "updated": "2022-07-23T18:41:23.983+0000",
                    "started": "2022-07-23T18:41:23.983+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "794548",
                    "issueId": "13447780"
                }
            ]
        },
        "customfield_12313920": null,
        "issuetype": {
            "self": "https://issues.apache.org/jira/rest/api/2/issuetype/1",
            "id": "1",
            "description": "A problem which impairs or prevents the functions of the product.",
            "iconUrl": "https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype",
            "name": "Bug",
            "subtask": false,
            "avatarId": 21133
        },
        "timespent": 12000,
        "customfield_12314020": "{summaryBean=com.atlassian.jira.plugin.devstatus.rest.SummaryBean@5def11b3[summary={pullrequest=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@52a417a2[overall=PullRequestOverallBean{stateCount=0, state='OPEN', details=PullRequestOverallDetails{openCount=0, mergedCount=0, declinedCount=0}},byInstanceType={}], build=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@327a72f[overall=com.atlassian.jira.plugin.devstatus.summary.beans.BuildOverallBean@714cb9ee[failedBuildCount=0,successfulBuildCount=0,unknownBuildCount=0,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], review=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@3b17c3b7[overall=com.atlassian.jira.plugin.devstatus.summary.beans.ReviewsOverallBean@1f95e20c[stateCount=0,state=<null>,dueDate=<null>,overDue=false,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], deployment-environment=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@21b5200e[overall=com.atlassian.jira.plugin.devstatus.summary.beans.DeploymentOverallBean@35226e1f[topEnvironments=[],showProjects=false,successfulCount=0,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], repository=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@302d1977[overall=com.atlassian.jira.plugin.devstatus.summary.beans.CommitOverallBean@1818fc[count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], branch=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@825eda1[overall=com.atlassian.jira.plugin.devstatus.summary.beans.BranchOverallBean@2e51282c[count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}]},errors=[],configErrors=[]], devSummaryJson={\"cachedValue\":{\"errors\":[],\"configErrors\":[],\"summary\":{\"pullrequest\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"stateCount\":0,\"state\":\"OPEN\",\"details\":{\"openCount\":0,\"mergedCount\":0,\"declinedCount\":0,\"total\":0},\"open\":true},\"byInstanceType\":{}},\"build\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"failedBuildCount\":0,\"successfulBuildCount\":0,\"unknownBuildCount\":0},\"byInstanceType\":{}},\"review\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"stateCount\":0,\"state\":null,\"dueDate\":null,\"overDue\":false,\"completed\":false},\"byInstanceType\":{}},\"deployment-environment\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"topEnvironments\":[],\"showProjects\":false,\"successfulCount\":0},\"byInstanceType\":{}},\"repository\":{\"overall\":{\"count\":0,\"lastUpdated\":null},\"byInstanceType\":{}},\"branch\":{\"overall\":{\"count\":0,\"lastUpdated\":null},\"byInstanceType\":{}}}},\"isStale\":false}}",
        "customfield_12314141": null,
        "customfield_12314140": null,
        "project": {
            "self": "https://issues.apache.org/jira/rest/api/2/project/12319525",
            "id": "12319525",
            "key": "ARROW",
            "name": "Apache Arrow",
            "projectTypeKey": "software",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/projectavatar?pid=12319525&avatarId=10011",
                "24x24": "https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12319525&avatarId=10011",
                "16x16": "https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12319525&avatarId=10011",
                "32x32": "https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12319525&avatarId=10011"
            },
            "projectCategory": {
                "self": "https://issues.apache.org/jira/rest/api/2/projectCategory/13960",
                "id": "13960",
                "description": "Apache Arrow",
                "name": "Arrow"
            }
        },
        "aggregatetimespent": 12000,
        "customfield_12312520": null,
        "customfield_12312521": "Fri Jul 22 16:24:41 UTC 2022",
        "customfield_12314422": null,
        "customfield_12314421": null,
        "customfield_12314146": null,
        "customfield_12314420": null,
        "customfield_12314145": null,
        "customfield_12314144": null,
        "customfield_12314143": null,
        "resolutiondate": "2022-07-22T16:24:41.000+0000",
        "workratio": -1,
        "customfield_12312923": null,
        "customfield_12312920": null,
        "customfield_12312921": null,
        "watches": {
            "self": "https://issues.apache.org/jira/rest/api/2/issue/ARROW-16700/watchers",
            "watchCount": 6,
            "isWatching": false
        },
        "created": "2022-05-31T20:08:39.000+0000",
        "updated": "2022-10-03T15:32:54.000+0000",
        "timeoriginalestimate": null,
        "description": "When summarizing a whole dataset (without group_by) with an aggregate, and summarizing a partitioned column, arrow returns wrong data:\r\n\r\n{code:r}\r\nlibrary(arrow, warn.conflicts = FALSE)\r\nlibrary(dplyr, warn.conflicts = FALSE)\r\n\r\ndf <- expand.grid(\r\n  some_nulls = c(0L, 1L, 2L),\r\n  year = 2010:2023,\r\n  month = 1:12,\r\n  day = 1:30\r\n)\r\n\r\npath <- tempfile()\r\ndir.create(path)\r\nwrite_dataset(df, path, partitioning = c(\"year\", \"month\"))\r\n\r\nds <- open_dataset(path)\r\n\r\n# with arrow the mins/maxes are off for partitioning columns\r\nds %>%\r\n  summarise(n = n(), min_year = min(year), min_month = min(month), min_day = min(day), max_year = max(year), max_month = max(month), max_day = max(day)) %>% \r\n  collect()\r\n#> # A tibble: 1 \u00d7 7\r\n#>       n min_year min_month min_day max_year max_month max_day\r\n#>   <int>    <int>     <int>   <int>    <int>     <int>   <int>\r\n#> 1 15120     2023         1       1     2023        12      30\r\n\r\n# comapred to what we get with dplyr\r\ndf %>%\r\n  summarise(n = n(), min_year = min(year), min_month = min(month), min_day = min(day), max_year = max(year), max_month = max(month), max_day = max(day)) %>% \r\n  collect()\r\n#>       n min_year min_month min_day max_year max_month max_day\r\n#> 1 15120     2010         1       1     2023        12      30\r\n\r\n# even min alone is off:\r\nds %>%\r\n  summarise(min_year = min(year)) %>% \r\n  collect()\r\n#> # A tibble: 1 \u00d7 1\r\n#>   min_year\r\n#>      <int>\r\n#> 1     2016\r\n  \r\n# but non-partitioning columns are fine:\r\nds %>%\r\n  summarise(min_day = min(day)) %>% \r\n  collect()\r\n#> # A tibble: 1 \u00d7 1\r\n#>   min_day\r\n#>     <int>\r\n#> 1       1\r\n  \r\n  \r\n# But with a group_by, this seems ok\r\nds %>%\r\n  group_by(some_nulls) %>%\r\n  summarise(min_year = min(year)) %>% \r\n  collect()\r\n#> # A tibble: 3 \u00d7 2\r\n#>   some_nulls min_year\r\n#>        <int>    <int>\r\n#> 1          0     2010\r\n#> 2          1     2010\r\n#> 3          2     2010\r\n{code}",
        "customfield_10010": null,
        "timetracking": {
            "remainingEstimate": "0h",
            "timeSpent": "3h 20m",
            "remainingEstimateSeconds": 0,
            "timeSpentSeconds": 12000
        },
        "customfield_12314523": null,
        "customfield_12314127": null,
        "customfield_12314522": null,
        "customfield_12314126": null,
        "customfield_12314521": null,
        "customfield_12314125": null,
        "customfield_12314520": null,
        "customfield_12314124": null,
        "attachment": [],
        "customfield_12312340": null,
        "customfield_12314123": null,
        "customfield_12312341": null,
        "customfield_12312220": null,
        "customfield_12314122": null,
        "customfield_12314121": null,
        "customfield_12314120": null,
        "customfield_12314129": null,
        "customfield_12314524": null,
        "customfield_12314128": null,
        "summary": "[C++] [R] [Datasets] aggregates on partitioning columns",
        "customfield_12314130": null,
        "customfield_12310291": null,
        "customfield_12310290": null,
        "customfield_12314138": null,
        "customfield_12314137": null,
        "environment": null,
        "customfield_12314136": null,
        "customfield_12314135": null,
        "customfield_12311020": null,
        "customfield_12314134": null,
        "duedate": null,
        "customfield_12314132": null,
        "customfield_12314131": null,
        "comment": {
            "comments": [
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13447780/comment/17560667",
                    "id": "17560667",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=jonkeane",
                        "name": "jonkeane",
                        "key": "jonkeane",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=34057",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34057",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34057",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34057"
                        },
                        "displayName": "Jonathan Keane",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "body": "[~westonpace] not sure if this is related to ARROW-16904 or ARROW-16807 but another wrong-data ticket we should take a look at",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=jonkeane",
                        "name": "jonkeane",
                        "key": "jonkeane",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=34057",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34057",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34057",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34057"
                        },
                        "displayName": "Jonathan Keane",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "created": "2022-06-29T21:32:01.299+0000",
                    "updated": "2022-06-29T21:32:01.299+0000"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13447780/comment/17561218",
                    "id": "17561218",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=westonpace",
                        "name": "westonpace",
                        "key": "westonpace",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=34045",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34045",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34045",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34045"
                        },
                        "displayName": "Weston Pace",
                        "active": true,
                        "timeZone": "America/Los_Angeles"
                    },
                    "body": "So the root cause here is how partition columns are handed to the exec plan.  In the datasets API a partitioning doesn't necessarily yield a single value for a batch, but rather an expression.\r\n\r\nFor example, the folder `/foo=7/chunk-0.parquet` will yield the expression `foo == 7` instead of the value `foo:7`.  This allow for rather novel partitioning schemes like `/temp=med/chunk-0.parquet` which could attach the expression `25 < temp < 75`.\r\n\r\nUnfortunately, this cleverness cannot really be utilized by the execution engine.  For example, how does one resolve the query `SELECT * FROM measurements WHERE temp == 50` when all they know for a batch is `25 < temp < 75`.\r\n\r\nAt the moment, these expressions are attached to the incoming batch as a \"guarantee\".  In addition, we also add a new column to the batch (e.g. `foo` or `temp`).  However, no value is ever set on this column and so it ends up getting set implicitly to `NULL`.  This guarantee is then used by project and filter nodes to simplify an expression.\r\n\r\nThis is why the query `SELECT foo from dataset WHERE foo == 7` works.  The expression `foo == 7` gets simplified by the guarantee (`foo ==7`) to `true` and so the row is included (even though the value of the row is null).  The projection `field_ref('foo')` gets simplified to `scalar(7)` and so the underlying array (which is full of nulls) is not looked at.\r\n\r\nHowever, aggregate nodes do not simplify with a guarantee.  So, instead, they see the raw underlying value (null) and it doesn't get processed correctly by the aggregate node.\r\n\r\nOne quick fix would be to get rid of the guarantee concept entirely.  When we have an incoming partition expression we should:\r\n\r\n * If the expression is an equality we replace it with a scalar.\r\n * If the expression is not an equality we raise an error.",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=westonpace",
                        "name": "westonpace",
                        "key": "westonpace",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=34045",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34045",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34045",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34045"
                        },
                        "displayName": "Weston Pace",
                        "active": true,
                        "timeZone": "America/Los_Angeles"
                    },
                    "created": "2022-07-01T00:18:59.448+0000",
                    "updated": "2022-07-01T00:18:59.448+0000"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13447780/comment/17561219",
                    "id": "17561219",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=westonpace",
                        "name": "westonpace",
                        "key": "westonpace",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=34045",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34045",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34045",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34045"
                        },
                        "displayName": "Weston Pace",
                        "active": true,
                        "timeZone": "America/Los_Angeles"
                    },
                    "body": "CC [~bkietz] for second opinion",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=westonpace",
                        "name": "westonpace",
                        "key": "westonpace",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=34045",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34045",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34045",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34045"
                        },
                        "displayName": "Weston Pace",
                        "active": true,
                        "timeZone": "America/Los_Angeles"
                    },
                    "created": "2022-07-01T00:19:26.595+0000",
                    "updated": "2022-07-01T00:19:26.595+0000"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13447780/comment/17562191",
                    "id": "17562191",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=jvanstraten",
                        "name": "jvanstraten",
                        "key": "JIRAUSER282962",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=JIRAUSER282962&avatarId=48950",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=JIRAUSER282962&avatarId=48950",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=JIRAUSER282962&avatarId=48950",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=JIRAUSER282962&avatarId=48950"
                        },
                        "displayName": "Jeroen van Straten",
                        "active": true,
                        "timeZone": "Europe/Amsterdam"
                    },
                    "body": "tl;dr it looks like min/max itself is broken and only aggregates only the last partition it sees (in each thread); every Consume call casually ignores and overrides this->state. Extraordinary claims demand extraordinary evidence, especially since I only started looking at Acero in-depth and installed R about five hours ago, so here's my complete analysis for posterity...\r\n\r\n> For example, how does one resolve the query {{SELECT * FROM measurements WHERE temp == 50}} when all they know for a batch is {{{}25 < temp < 75{}}}.\r\n\r\nI would assume that in the case of a guarantee like {{25 < temp < 75}} the column {{temp}} is not optimized out of the physical schema as it would be for {{{}temp = 50{}}}, otherwise the data simply isn't there anymore. So, I don't see how\r\n\r\n> However, no value is ever set on this column and so it ends up getting set implicitly to {{{}NULL{}}}.\r\n\r\nwould apply in this case, and would expect that aggregation would work correctly under those circumstances. But I'm not sure how to verify this.\r\n\r\nIf above assessment is true, it seems to me that the problem is that either:\r\n * \"trivial\" guarantees aren't respected consistently throughout Acero, which is invalid because columns may already have been optimized out of the physical schema under the assumption that all values are known via the guarantee; or\r\n * if you take the [this|https://github.com/apache/arrow/blob/897a4c0ce73c3fe07872beee2c1d2128e44f6dd4/cpp/src/arrow/compute/exec.h#L201] description of ExecBatch::guarantee at face value, the problem is that the guarantee doesn't actually evaluate to true at all in this case, because the columns it asserts a constant value for are in fact optimized out and would thus evaluate to null. This conflicts with [the way Scanner deals with guarantees|https://github.com/apache/arrow/blob/897a4c0ce73c3fe07872beee2c1d2128e44f6dd4/cpp/src/arrow/dataset/scanner.cc#L911-L914], though.\r\n\r\nPut differently, different parts of the codebase seem to treat {{guarantee}} in two incompatible ways (at least according to the comments).\r\n\r\nLooking through the code I don't see _any_ mention of guarantees in nodes other than filter and project, so I would expect all nodes to fail on this, _unless_ they end up following a projection node, which would materialize the columns based on the expressions derived from the guarantee. It looks like the group-by example only works because a projection is inserted in that case:\r\n{code:java}\r\n 5:SinkNode{}\r\n  4:ProjectNode{projection=[some_nulls, min_year]}\r\n    3:ProjectNode{projection=[some_nulls, min_year]}\r\n      2:GroupByNode{keys=[\"some_nulls\"], aggregates=[\r\n      \thash_min(min_year, {skip_nulls=false, min_count=0}),\r\n      ]}\r\n        1:ProjectNode{projection=[\"min_year\": year, some_nulls]}\r\n          0:SourceNode{}\r\n{code}\r\n... but something isn't adding up for the failing case, because I'm getting:\r\n{code:java}\r\n4:SinkNode{}\r\n  3:ProjectNode{projection=[n, min_year, min_month, min_day, max_year, max_month, max_day]}\r\n    2:ScalarAggregateNode{aggregates=[\r\n\tsum(n, {skip_nulls=true, min_count=1}),\r\n\tmin(min_year, {skip_nulls=false, min_count=0}),\r\n\tmin(min_month, {skip_nulls=false, min_count=0}),\r\n\tmin(min_day, {skip_nulls=false, min_count=0}),\r\n\tmax(max_year, {skip_nulls=false, min_count=0}),\r\n\tmax(max_month, {skip_nulls=false, min_count=0}),\r\n\tmax(max_day, {skip_nulls=false, min_count=0}),\r\n]}\r\n      1:ProjectNode{projection=[\"n\": 1, \"min_year\": year, \"min_month\": month, \"min_day\": day, \"max_year\": year, \"max_month\": month, \"max_day\": day]}\r\n        0:SourceNode{}\r\n{code}\r\nIn fact, judging by the input and output of 1:ProjectNode in either case, it looks like it'd be difficult to make a plan that doesn't need one, since it would normally at least get rid of the fragment source information.\r\n\r\nAnd indeed, if I spam sufficient debug output, I see that 1:ProjectNode _is_ indeed materializing the columns accordingly, and 2:ScalarAggregateNode _is_ actually getting completely-materialized inputs passed to InputReceived. Hmmm...\r\n\r\nSome more debug prints and clicking through code later I find that the bad minima and maxima are originating from [here|https://github.com/apache/arrow/blob/897a4c0ce73c3fe07872beee2c1d2128e44f6dd4/cpp/src/arrow/compute/kernels/aggregate_basic_internal.h#L440-L451]. Each partition corresponds to its own call. I expected something to be subtly wrong here, but it doesn't appear to be subtle at all: local is created [here|https://github.com/apache/arrow/blob/897a4c0ce73c3fe07872beee2c1d2128e44f6dd4/cpp/src/arrow/compute/kernels/aggregate_basic_internal.h#L440] and is later used to override this->state [here|https://github.com/apache/arrow/blob/897a4c0ce73c3fe07872beee2c1d2128e44f6dd4/cpp/src/arrow/compute/kernels/aggregate_basic_internal.h#L445] or [here|https://github.com/apache/arrow/blob/897a4c0ce73c3fe07872beee2c1d2128e44f6dd4/cpp/src/arrow/compute/kernels/aggregate_basic_internal.h#L450], without any reference to the previous value of this->state! I suppose what those {{this->state = local}} lines _should_ read is {{this->state \\+= local}}, since operator+= is overloaded for combining states, so that's what I'll make a PR for.\r\n\r\nThe issue Weston pointed out _may_ still be an issue after that though, just a far less likely one to hit (if it's possible at all) because of how likely it is that a project node will be placed immediately after a scan node. So I guess there should be a followup issue for that?",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=jvanstraten",
                        "name": "jvanstraten",
                        "key": "JIRAUSER282962",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=JIRAUSER282962&avatarId=48950",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=JIRAUSER282962&avatarId=48950",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=JIRAUSER282962&avatarId=48950",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=JIRAUSER282962&avatarId=48950"
                        },
                        "displayName": "Jeroen van Straten",
                        "active": true,
                        "timeZone": "Europe/Amsterdam"
                    },
                    "created": "2022-07-04T14:06:26.452+0000",
                    "updated": "2022-07-05T11:42:48.510+0000"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13447780/comment/17562721",
                    "id": "17562721",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=westonpace",
                        "name": "westonpace",
                        "key": "westonpace",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=34045",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34045",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34045",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34045"
                        },
                        "displayName": "Weston Pace",
                        "active": true,
                        "timeZone": "America/Los_Angeles"
                    },
                    "body": "{quote}tl;dr it looks like min/max itself is broken and only aggregates only the last partition it sees (in each thread); every Consume call casually ignores and overrides this->state. Extraordinary claims demand extraordinary evidence, especially since I only started looking at Acero in-depth and installed R about five hours ago, so here's my complete analysis for posterity...{quote}\r\n\r\nYes, min/max is broken in the way you describe.  This is captured in ARROW-16904.  [~octalene] is working on updating the unit tests so that we can reproduce this issue correctly.  Sorry, I hadn't realized this JIRA also involved a min/max and I hadn't realized the project workaround you mentioned.  However, that is excellent analysis.\r\n\r\nYou are correct that a project node would fix this issue.  However, a project node isn't normally inserted immediately after a scan node.  In fact, what is happening here, is that R always inserts a project node immediately _before_ an aggregate node.  Either way, that is a pretty significant workaround, as the project & filter nodes are already satisfied by the guarantee.\r\n\r\nStill, I'd like to leave this issue in place for the moment, though maybe it doesn't need to be a blocker.  Future Substrait queries would, in theory, be able to create plans without the preceding project node.  At some point the scan node will not emit these columns unless they are asked for so I don't think a project to satisfy the column-dropping emit will always be necessary either.",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=westonpace",
                        "name": "westonpace",
                        "key": "westonpace",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=34045",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34045",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34045",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34045"
                        },
                        "displayName": "Weston Pace",
                        "active": true,
                        "timeZone": "America/Los_Angeles"
                    },
                    "created": "2022-07-05T15:28:33.703+0000",
                    "updated": "2022-07-05T15:28:33.703+0000"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13447780/comment/17562732",
                    "id": "17562732",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=jvanstraten",
                        "name": "jvanstraten",
                        "key": "JIRAUSER282962",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=JIRAUSER282962&avatarId=48950",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=JIRAUSER282962&avatarId=48950",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=JIRAUSER282962&avatarId=48950",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=JIRAUSER282962&avatarId=48950"
                        },
                        "displayName": "Jeroen van Straten",
                        "active": true,
                        "timeZone": "Europe/Amsterdam"
                    },
                    "body": "So I guess that basically means that my PR is linked to the wrong issue? I'm not sure how to neatly resolve that, at least not without closing my PR and waiting for [~octalene]\u00a0to fix min/max (and test it appropriately) instead.\r\n\r\nFor the guarantee issue that remains, I'm inclined to place the blame on Scanner rather than all the nodes other than filter and project, and to just insert the code for a trivial projection into Scanner to leverage the existing SimplifyWithGuarantee implementation. I'm assuming that an expression that only selects an existing field will just result in a pointer copy, and that evaluating a literal expression to a scalar is also cheap (at least if the literal isn't massive). What do you think?\r\n\r\n> Future Substrait queries would, in theory, be able to create plans without the preceding project node.\r\n\r\nI'm not 100% sure on that one because of the tag fields that Scanner normally adds, which Substrait wouldn't know about. It feels fragile to leave them in because I imagine they would affect column indices after a join if not treated carefully. But I get your point.",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=jvanstraten",
                        "name": "jvanstraten",
                        "key": "JIRAUSER282962",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=JIRAUSER282962&avatarId=48950",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=JIRAUSER282962&avatarId=48950",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=JIRAUSER282962&avatarId=48950",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=JIRAUSER282962&avatarId=48950"
                        },
                        "displayName": "Jeroen van Straten",
                        "active": true,
                        "timeZone": "Europe/Amsterdam"
                    },
                    "created": "2022-07-05T15:56:41.250+0000",
                    "updated": "2022-07-05T15:56:41.250+0000"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13447780/comment/17562762",
                    "id": "17562762",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=westonpace",
                        "name": "westonpace",
                        "key": "westonpace",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=34045",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34045",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34045",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34045"
                        },
                        "displayName": "Weston Pace",
                        "active": true,
                        "timeZone": "America/Los_Angeles"
                    },
                    "body": "> So I guess that basically means that my PR is linked to the wrong issue? I'm not sure how to neatly resolve that\r\n\r\nI think you just need to update the title of the PR.  I'm not sure if that removes the linkage to this issue but that's probably ok.  It should add linkage to the correct PR.\r\n\r\n> For the guarantee issue that remains, I'm inclined to place the blame on Scanner rather than all the nodes other than filter and project, and to just insert the code for a trivial projection into Scanner to leverage the existing SimplifyWithGuarantee implementation\r\n\r\nI agree the best fix is on the scanner and this change should happen within the scan node.\r\n\r\n> I'm assuming that an expression that only selects an existing field will just result in a pointer copy, and that evaluating a literal expression to a scalar is also cheap (at least if the literal isn't massive). What do you think?\r\n\r\nI think you are correct here.  It should be cheap.\r\n\r\n> I'm not 100% sure on that one because of the tag fields that Scanner normally adds, which Substrait wouldn't know about. It feels fragile to leave them in because I imagine they would affect column indices after a join if not treated carefully. But I get your point.\r\n\r\nI'm not entirely sure I understand your point on the join.  The partition columns I think can just be normal columns as far as Substrait is considered.  Are you maybe thinking of the __fragment_index, __filename, etc. columns?",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=westonpace",
                        "name": "westonpace",
                        "key": "westonpace",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=34045",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34045",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34045",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34045"
                        },
                        "displayName": "Weston Pace",
                        "active": true,
                        "timeZone": "America/Los_Angeles"
                    },
                    "created": "2022-07-05T17:05:21.346+0000",
                    "updated": "2022-07-05T17:05:21.346+0000"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13447780/comment/17562771",
                    "id": "17562771",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=jvanstraten",
                        "name": "jvanstraten",
                        "key": "JIRAUSER282962",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=JIRAUSER282962&avatarId=48950",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=JIRAUSER282962&avatarId=48950",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=JIRAUSER282962&avatarId=48950",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=JIRAUSER282962&avatarId=48950"
                        },
                        "displayName": "Jeroen van Straten",
                        "active": true,
                        "timeZone": "Europe/Amsterdam"
                    },
                    "body": "> I think you just need to update the title of the PR. I'm not sure if that removes the linkage to this issue but that's probably ok. It should add linkage to the correct PR.\r\n\r\nThe (more) correct issue being [ARROW-16904|https://issues.apache.org/jira/projects/ARROW/issues/ARROW-16904], right?\r\n\r\n> I'm not entirely sure I understand your point on the join. The partition columns I think can just be normal columns as far as Substrait is considered. Are you maybe thinking of the __fragment_index, __filename, etc. columns?\r\n\r\nThe latter, I think ([these|https://github.com/apache/arrow/blob/c1a1f47b8a2772fc270832902e7d788ee467ea08/cpp/src/arrow/dataset/scanner.cc#L917-L920] to be specific). I don't know if it would actually be an issue at all, but it doesn't feel right that Scanner makes more columns than ReadRel if we're going to be treating them as if they map one-to-one to each other.\r\n\r\nAs for a resolution to this issue, I've now locally rewritten MakeExecBatch to take the guarantee as its argument, use ExtractKnownFieldValues to turn it into the map of constant columns (helper of SimplifyWithGuarantee; turned out to be way easier to just use that, and it's also more fit for this purpose), and prefer the constant scalar from that over the actual incoming data if known. It's currently giving me failures, but my code is also still a mess from all the debug printing so it's not that surprising.",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=jvanstraten",
                        "name": "jvanstraten",
                        "key": "JIRAUSER282962",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=JIRAUSER282962&avatarId=48950",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=JIRAUSER282962&avatarId=48950",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=JIRAUSER282962&avatarId=48950",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=JIRAUSER282962&avatarId=48950"
                        },
                        "displayName": "Jeroen van Straten",
                        "active": true,
                        "timeZone": "Europe/Amsterdam"
                    },
                    "created": "2022-07-05T17:34:18.157+0000",
                    "updated": "2022-07-05T17:34:18.157+0000"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13447780/comment/17562926",
                    "id": "17562926",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=westonpace",
                        "name": "westonpace",
                        "key": "westonpace",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=34045",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34045",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34045",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34045"
                        },
                        "displayName": "Weston Pace",
                        "active": true,
                        "timeZone": "America/Los_Angeles"
                    },
                    "body": "> but it doesn't feel right that Scanner makes more columns than ReadRel if we're going to be treating them as if they map one-to-one to each other.\r\n\r\nI agree there.  The ReadRel should be able to specify these columns and, if it doesn't, these columns should not be included.",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=westonpace",
                        "name": "westonpace",
                        "key": "westonpace",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=34045",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34045",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34045",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34045"
                        },
                        "displayName": "Weston Pace",
                        "active": true,
                        "timeZone": "America/Los_Angeles"
                    },
                    "created": "2022-07-06T02:40:30.814+0000",
                    "updated": "2022-07-06T02:40:30.814+0000"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13447780/comment/17570110",
                    "id": "17570110",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=westonpace",
                        "name": "westonpace",
                        "key": "westonpace",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=34045",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34045",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34045",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34045"
                        },
                        "displayName": "Weston Pace",
                        "active": true,
                        "timeZone": "America/Los_Angeles"
                    },
                    "body": "Issue resolved by pull request 13518\n[https://github.com/apache/arrow/pull/13518]",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=westonpace",
                        "name": "westonpace",
                        "key": "westonpace",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=34045",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34045",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34045",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34045"
                        },
                        "displayName": "Weston Pace",
                        "active": true,
                        "timeZone": "America/Los_Angeles"
                    },
                    "created": "2022-07-22T16:24:41.627+0000",
                    "updated": "2022-07-22T16:24:41.627+0000"
                }
            ],
            "maxResults": 10,
            "total": 10,
            "startAt": 0
        },
        "customfield_12311820": "0|z12uew:",
        "customfield_12314139": null
    }
}