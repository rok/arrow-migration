{
    "expand": "operations,versionedRepresentations,editmeta,changelog,renderedFields",
    "id": "13306881",
    "self": "https://issues.apache.org/jira/rest/api/2/issue/13306881",
    "key": "ARROW-8899",
    "fields": {
        "fixVersions": [
            {
                "self": "https://issues.apache.org/jira/rest/api/2/version/12347769",
                "id": "12347769",
                "description": "",
                "name": "1.0.0",
                "archived": false,
                "released": true,
                "releaseDate": "2020-07-24"
            }
        ],
        "resolution": {
            "self": "https://issues.apache.org/jira/rest/api/2/resolution/1",
            "id": "1",
            "description": "A fix for this issue is checked into the tree and tested.",
            "name": "Fixed"
        },
        "customfield_12312322": null,
        "customfield_12312323": null,
        "customfield_12312320": null,
        "customfield_12310420": "9223372036854775807",
        "customfield_12312321": null,
        "customfield_12312328": null,
        "customfield_12312329": null,
        "customfield_12312326": null,
        "customfield_12310300": null,
        "customfield_12312327": null,
        "customfield_12312324": null,
        "customfield_12312720": null,
        "customfield_12312325": null,
        "lastViewed": null,
        "priority": {
            "self": "https://issues.apache.org/jira/rest/api/2/priority/2",
            "iconUrl": "https://issues.apache.org/jira/images/icons/priorities/critical.svg",
            "name": "Critical",
            "id": "2"
        },
        "labels": [
            "pull-request-available"
        ],
        "customfield_12312333": null,
        "customfield_12312334": null,
        "customfield_12313422": "false",
        "customfield_12310310": "0.0",
        "customfield_12312331": null,
        "customfield_12312332": null,
        "aggregatetimeoriginalestimate": null,
        "timeestimate": 0,
        "customfield_12312330": null,
        "versions": [],
        "customfield_12311120": null,
        "customfield_12313826": null,
        "customfield_12312339": null,
        "issuelinks": [
            {
                "id": "12589153",
                "self": "https://issues.apache.org/jira/rest/api/2/issueLink/12589153",
                "type": {
                    "id": "10001",
                    "name": "dependent",
                    "inward": "is depended upon by",
                    "outward": "depends upon",
                    "self": "https://issues.apache.org/jira/rest/api/2/issueLinkType/10001"
                },
                "inwardIssue": {
                    "id": "13306018",
                    "key": "ARROW-8867",
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13306018",
                    "fields": {
                        "summary": "[R] Support converting POSIXlt type",
                        "status": {
                            "self": "https://issues.apache.org/jira/rest/api/2/status/5",
                            "description": "A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.",
                            "iconUrl": "https://issues.apache.org/jira/images/icons/statuses/resolved.png",
                            "name": "Resolved",
                            "id": "5",
                            "statusCategory": {
                                "self": "https://issues.apache.org/jira/rest/api/2/statuscategory/3",
                                "id": 3,
                                "key": "done",
                                "colorName": "green",
                                "name": "Done"
                            }
                        },
                        "priority": {
                            "self": "https://issues.apache.org/jira/rest/api/2/priority/3",
                            "iconUrl": "https://issues.apache.org/jira/images/icons/priorities/major.svg",
                            "name": "Major",
                            "id": "3"
                        },
                        "issuetype": {
                            "self": "https://issues.apache.org/jira/rest/api/2/issuetype/2",
                            "id": "2",
                            "description": "A new feature of the product, which has yet to be developed.",
                            "iconUrl": "https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21141&avatarType=issuetype",
                            "name": "New Feature",
                            "subtask": false,
                            "avatarId": 21141
                        }
                    }
                }
            },
            {
                "id": "12589152",
                "self": "https://issues.apache.org/jira/rest/api/2/issueLink/12589152",
                "type": {
                    "id": "10001",
                    "name": "dependent",
                    "inward": "is depended upon by",
                    "outward": "depends upon",
                    "self": "https://issues.apache.org/jira/rest/api/2/issueLinkType/10001"
                },
                "inwardIssue": {
                    "id": "13212107",
                    "key": "ARROW-4390",
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13212107",
                    "fields": {
                        "summary": "[R] Serialize \"labeled\" metadata in Feather files, IPC messages",
                        "status": {
                            "self": "https://issues.apache.org/jira/rest/api/2/status/5",
                            "description": "A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.",
                            "iconUrl": "https://issues.apache.org/jira/images/icons/statuses/resolved.png",
                            "name": "Resolved",
                            "id": "5",
                            "statusCategory": {
                                "self": "https://issues.apache.org/jira/rest/api/2/statuscategory/3",
                                "id": 3,
                                "key": "done",
                                "colorName": "green",
                                "name": "Done"
                            }
                        },
                        "priority": {
                            "self": "https://issues.apache.org/jira/rest/api/2/priority/3",
                            "iconUrl": "https://issues.apache.org/jira/images/icons/priorities/major.svg",
                            "name": "Major",
                            "id": "3"
                        },
                        "issuetype": {
                            "self": "https://issues.apache.org/jira/rest/api/2/issuetype/4",
                            "id": "4",
                            "description": "An improvement or enhancement to an existing feature or task.",
                            "iconUrl": "https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21140&avatarType=issuetype",
                            "name": "Improvement",
                            "subtask": false,
                            "avatarId": 21140
                        }
                    }
                }
            }
        ],
        "customfield_12313825": null,
        "assignee": {
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=romainfrancois",
            "name": "romainfrancois",
            "key": "romainfrancois",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=romainfrancois&avatarId=35092",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=romainfrancois&avatarId=35092",
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=romainfrancois&avatarId=35092",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=romainfrancois&avatarId=35092"
            },
            "displayName": "Romain Francois",
            "active": true,
            "timeZone": "Etc/UTC"
        },
        "customfield_12312337": null,
        "customfield_12313823": null,
        "customfield_12312338": null,
        "customfield_12311920": null,
        "customfield_12313822": null,
        "customfield_12312335": null,
        "customfield_12313821": null,
        "customfield_12312336": null,
        "customfield_12313820": null,
        "status": {
            "self": "https://issues.apache.org/jira/rest/api/2/status/5",
            "description": "A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.",
            "iconUrl": "https://issues.apache.org/jira/images/icons/statuses/resolved.png",
            "name": "Resolved",
            "id": "5",
            "statusCategory": {
                "self": "https://issues.apache.org/jira/rest/api/2/statuscategory/3",
                "id": 3,
                "key": "done",
                "colorName": "green",
                "name": "Done"
            }
        },
        "components": [
            {
                "self": "https://issues.apache.org/jira/rest/api/2/component/12333008",
                "id": "12333008",
                "name": "R"
            }
        ],
        "customfield_12312026": null,
        "customfield_12312023": null,
        "customfield_12312024": null,
        "aggregatetimeestimate": 0,
        "customfield_12312022": null,
        "customfield_12310921": null,
        "customfield_12310920": "9223372036854775807",
        "customfield_12312823": null,
        "creator": {
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=npr",
            "name": "npr",
            "key": "npr",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=34045",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34045",
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34045",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34045"
            },
            "displayName": "Neal Richardson",
            "active": true,
            "timeZone": "America/Los_Angeles"
        },
        "subtasks": [],
        "reporter": {
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=npr",
            "name": "npr",
            "key": "npr",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=34045",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34045",
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34045",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34045"
            },
            "displayName": "Neal Richardson",
            "active": true,
            "timeZone": "America/Los_Angeles"
        },
        "aggregateprogress": {
            "progress": 9600,
            "total": 9600,
            "percent": 100
        },
        "customfield_12313520": null,
        "customfield_12310250": null,
        "progress": {
            "progress": 9600,
            "total": 9600,
            "percent": 100
        },
        "customfield_12313924": null,
        "votes": {
            "self": "https://issues.apache.org/jira/rest/api/2/issue/ARROW-8899/votes",
            "votes": 0,
            "hasVoted": false
        },
        "worklog": {
            "startAt": 0,
            "maxResults": 20,
            "total": 16,
            "worklogs": [
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13306881/worklog/449825",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "romainfrancois opened a new pull request #7524:\nURL: https://github.com/apache/arrow/pull/7524\n\n\n   ``` r\r\n   library(arrow, warn.conflicts = FALSE)\r\n   \r\n   tab <- Table$create(\r\n     a = structure(1:4, foo = \"bar\"), \r\n     b = haven::labelled(1:4, label = \"description\")\r\n   )\r\n   tab$metadata$r\r\n   #> [1] \"A\\n3\\n262144\\n197888\\n5\\nUTF-8\\n19\\n2\\n254\\n531\\n2\\n1026\\n1\\n262153\\n3\\nfoo\\n16\\n1\\n262153\\n3\\nbar\\n254\\n1026\\n1\\n262153\\n5\\nlabel\\n16\\n1\\n262153\\n11\\ndescription\\n1026\\n1\\n262153\\n5\\nclass\\n16\\n3\\n262153\\n14\\nhaven_labelled\\n262153\\n10\\nvctrs_vctr\\n262153\\n7\\ninteger\\n254\\n1026\\n1\\n262153\\n5\\nnames\\n16\\n2\\n262153\\n1\\na\\n262153\\n1\\nb\\n254\\n\"\r\n   arrow:::.arrow_unserialize(tab$metadata$r)\r\n   #> [[1]]\r\n   #> NULL\r\n   #> \r\n   #> [[2]]\r\n   #> [[2]]$a\r\n   #> [[2]]$a$foo\r\n   #> [1] \"bar\"\r\n   #> \r\n   #> \r\n   #> [[2]]$b\r\n   #> [[2]]$b$label\r\n   #> [1] \"description\"\r\n   #> \r\n   #> [[2]]$b$class\r\n   #> [1] \"haven_labelled\" \"vctrs_vctr\"     \"integer\"\r\n   \r\n   df <- as.data.frame(tab)\r\n   df$a\r\n   #> [1] 1 2 3 4\r\n   #> attr(,\"foo\")\r\n   #> [1] \"bar\"\r\n   df$b\r\n   #> <labelled<integer>[4]>: description\r\n   #> [1] 1 2 3 4\r\n   ```\r\n   \r\n   <sup>Created on 2020-06-23 by the [reprex package](https://reprex.tidyverse.org) (v0.3.0.9001)</sup>\r\n   \r\n   `metadata$r$` gets a serialized string of a list with 2 things: \r\n     - attributes of the data frame itself\r\n     - named list of attributes of each column (possibly NULL)\r\n   \r\n   \r\n   \n\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2020-06-23T14:13:40.917+0000",
                    "updated": "2020-06-23T14:13:40.917+0000",
                    "started": "2020-06-23T14:13:40.917+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "449825",
                    "issueId": "13306881"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13306881/worklog/449829",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "github-actions[bot] commented on pull request #7524:\nURL: https://github.com/apache/arrow/pull/7524#issuecomment-648198565\n\n\n   https://issues.apache.org/jira/browse/ARROW-8899\n\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2020-06-23T14:32:06.665+0000",
                    "updated": "2020-06-23T14:32:06.665+0000",
                    "started": "2020-06-23T14:32:06.665+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "449829",
                    "issueId": "13306881"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13306881/worklog/449833",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "romainfrancois commented on a change in pull request #7524:\nURL: https://github.com/apache/arrow/pull/7524#discussion_r444273703\n\n\n\n##########\nFile path: r/tests/testthat/test-Table.R\n##########\n@@ -334,5 +334,5 @@ test_that(\"Table metadata\", {\n \n test_that(\"Table handles null type (ARROW-7064)\", {\n   tab <- Table$create(a = 1:10, n = vctrs::unspecified(10))\n-  expect_equal(tab$schema,  schema(a = int32(), n = null()))\n+  expect_true(tab$schema$Equals(schema(a = int32(), n = null()), FALSE))\n\nReview comment:\n       Maybe `vctrs::unspecified()` can be special cased so that it does not generate additional info in the schema (it's just the class) here. \r\n   \r\n   Or maybe the equality operator could disregard the metadata altogether (i.e. changing the default). \n\n\n\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2020-06-23T14:35:56.332+0000",
                    "updated": "2020-06-23T14:35:56.332+0000",
                    "started": "2020-06-23T14:35:56.332+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "449833",
                    "issueId": "13306881"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13306881/worklog/449851",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "nealrichardson commented on a change in pull request #7524:\nURL: https://github.com/apache/arrow/pull/7524#discussion_r444306795\n\n\n\n##########\nFile path: r/tests/testthat/test-Table.R\n##########\n@@ -334,5 +334,5 @@ test_that(\"Table metadata\", {\n \n test_that(\"Table handles null type (ARROW-7064)\", {\n   tab <- Table$create(a = 1:10, n = vctrs::unspecified(10))\n-  expect_equal(tab$schema,  schema(a = int32(), n = null()))\n+  expect_true(tab$schema$Equals(schema(a = int32(), n = null()), FALSE))\n\nReview comment:\n       I think you can use `expect_equivalent()` instead of `expect_equal` and it will skip the metadata comparison; cf. https://github.com/apache/arrow/blob/master/r/R/arrow-package.R#L111 \r\n   \r\n   (of course, we'll have to fix this for the new version of `testthat` that doesn't use all.equal under the hood)\n\n\n\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2020-06-23T15:19:54.743+0000",
                    "updated": "2020-06-23T15:19:54.743+0000",
                    "started": "2020-06-23T15:19:54.743+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "449851",
                    "issueId": "13306881"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13306881/worklog/449860",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "nealrichardson commented on a change in pull request #7524:\nURL: https://github.com/apache/arrow/pull/7524#discussion_r444311774\n\n\n\n##########\nFile path: r/R/table.R\n##########\n@@ -202,7 +210,27 @@ Table$create <- function(..., schema = NULL) {\n \n #' @export\n as.data.frame.Table <- function(x, row.names = NULL, optional = FALSE, ...) {\n-  Table__to_dataframe(x, use_threads = option_use_threads())\n+  df <- Table__to_dataframe(x, use_threads = option_use_threads())\n+\n+  if (!is.null(r_metadata <- x$metadata$r)) {\n+    r_metadata <- .arrow_unserialize(r_metadata)\n+\n+    df_metadata <- r_metadata[[1L]]\n\nReview comment:\n       IMO using a named list would be clearer than relying on position in an unnamed list\n\n##########\nFile path: r/src/table.cpp\n##########\n@@ -172,11 +172,20 @@ std::shared_ptr<arrow::Table> Table__from_dots(SEXP lst, SEXP schema_sxp) {\n   std::shared_ptr<arrow::Schema> schema;\n \n   if (Rf_isNull(schema_sxp)) {\n-    // infer the schema from the ...\n+    // infer the schema from the `...`\n\nReview comment:\n       I wonder if this whole block of code should be factored out so it can be used whether you're creating a Table or a RecordBatch. It's the same either way: return a Schema corresponding to the data given.\n\n\n\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2020-06-23T15:33:24.162+0000",
                    "updated": "2020-06-23T15:33:24.162+0000",
                    "started": "2020-06-23T15:33:24.162+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "449860",
                    "issueId": "13306881"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13306881/worklog/450257",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "romainfrancois commented on a change in pull request #7524:\nURL: https://github.com/apache/arrow/pull/7524#discussion_r444675449\n\n\n\n##########\nFile path: r/tests/testthat/test-Table.R\n##########\n@@ -334,5 +334,5 @@ test_that(\"Table metadata\", {\n \n test_that(\"Table handles null type (ARROW-7064)\", {\n   tab <- Table$create(a = 1:10, n = vctrs::unspecified(10))\n-  expect_equal(tab$schema,  schema(a = int32(), n = null()))\n+  expect_true(tab$schema$Equals(schema(a = int32(), n = null()), FALSE))\n\nReview comment:\n       Thanks. \n\n\n\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2020-06-24T06:37:39.600+0000",
                    "updated": "2020-06-24T06:37:39.600+0000",
                    "started": "2020-06-24T06:37:39.600+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "450257",
                    "issueId": "13306881"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13306881/worklog/450262",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "romainfrancois commented on a change in pull request #7524:\nURL: https://github.com/apache/arrow/pull/7524#discussion_r444682932\n\n\n\n##########\nFile path: r/R/table.R\n##########\n@@ -202,7 +210,27 @@ Table$create <- function(..., schema = NULL) {\n \n #' @export\n as.data.frame.Table <- function(x, row.names = NULL, optional = FALSE, ...) {\n-  Table__to_dataframe(x, use_threads = option_use_threads())\n+  df <- Table__to_dataframe(x, use_threads = option_use_threads())\n+\n+  if (!is.null(r_metadata <- x$metadata$r)) {\n+    r_metadata <- .arrow_unserialize(r_metadata)\n+\n+    df_metadata <- r_metadata[[1L]]\n\nReview comment:\n       Thanks\n\n\n\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2020-06-24T06:55:59.069+0000",
                    "updated": "2020-06-24T06:55:59.069+0000",
                    "started": "2020-06-24T06:55:59.069+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "450262",
                    "issueId": "13306881"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13306881/worklog/450462",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "romainfrancois commented on pull request #7524:\nURL: https://github.com/apache/arrow/pull/7524#issuecomment-648848097\n\n\n   Added support for record batches. \r\n   \r\n   Toying with the idea of a print method for the metadata, to make it less opaque: \r\n   \r\n   ``` r\r\n   library(arrow)\r\n   #> \r\n   #> Attaching package: 'arrow'\r\n   #> The following object is masked from 'package:utils':\r\n   #> \r\n   #>     timestamp\r\n   \r\n   Table$create(a = structure(1:2, foo = \"bar\"))$metadata\r\n   #> $r\r\n   #> [1] \"A\\n3\\n262144\\n197888\\n5\\nUTF-8\\n531\\n2\\n254\\n531\\n1\\n531\\n1\\n16\\n1\\n262153\\n3\\nbar\\n1026\\n1\\n262153\\n5\\nnames\\n16\\n1\\n262153\\n3\\nfoo\\n254\\n1026\\n511\\n16\\n1\\n262153\\n1\\na\\n254\\n1026\\n511\\n16\\n2\\n262153\\n4\\ndata\\n262153\\n7\\ncolumns\\n254\\n\"\r\n   #> List of 2\r\n   #>  $ data   : NULL\r\n   #>  $ columns:List of 1\r\n   #>   ..$ a:List of 1\r\n   #>   .. ..$ foo: chr \"bar\"\r\n   #> \r\n   #> attr(,\"class\")\r\n   #> [1] \"arrow:::metadata\"\r\n   record_batch(a = structure(1:2, foo = \"bar\"))$metadata\r\n   #> $r\r\n   #> [1] \"A\\n3\\n262144\\n197888\\n5\\nUTF-8\\n531\\n2\\n254\\n531\\n1\\n531\\n1\\n16\\n1\\n262153\\n3\\nbar\\n1026\\n1\\n262153\\n5\\nnames\\n16\\n1\\n262153\\n3\\nfoo\\n254\\n1026\\n511\\n16\\n1\\n262153\\n1\\na\\n254\\n1026\\n511\\n16\\n2\\n262153\\n4\\ndata\\n262153\\n7\\ncolumns\\n254\\n\"\r\n   #> List of 2\r\n   #>  $ data   : NULL\r\n   #>  $ columns:List of 1\r\n   #>   ..$ a:List of 1\r\n   #>   .. ..$ foo: chr \"bar\"\r\n   #> \r\n   #> attr(,\"class\")\r\n   #> [1] \"arrow:::metadata\"\r\n   ```\r\n   \r\n   <sup>Created on 2020-06-24 by the [reprex package](https://reprex.tidyverse.org) (v0.3.0.9001)</sup>\n\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2020-06-24T14:16:04.613+0000",
                    "updated": "2020-06-24T14:16:04.613+0000",
                    "started": "2020-06-24T14:16:04.613+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "450462",
                    "issueId": "13306881"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13306881/worklog/451406",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "romainfrancois commented on a change in pull request #7524:\nURL: https://github.com/apache/arrow/pull/7524#discussion_r445988639\n\n\n\n##########\nFile path: r/src/table.cpp\n##########\n@@ -172,11 +172,20 @@ std::shared_ptr<arrow::Table> Table__from_dots(SEXP lst, SEXP schema_sxp) {\n   std::shared_ptr<arrow::Schema> schema;\n \n   if (Rf_isNull(schema_sxp)) {\n-    // infer the schema from the ...\n+    // infer the schema from the `...`\n\nReview comment:\n       Thanks. They share some code now. \n\n\n\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2020-06-26T06:18:51.353+0000",
                    "updated": "2020-06-26T06:18:51.353+0000",
                    "started": "2020-06-26T06:18:51.352+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "451406",
                    "issueId": "13306881"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13306881/worklog/451622",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "nealrichardson commented on pull request #7524:\nURL: https://github.com/apache/arrow/pull/7524#issuecomment-650249655\n\n\n   @romainfrancois regarding tests, I think a fixture something like \r\n   \r\n   ```r\r\n   df <- tibble::tibble(\r\n     a = structure(\"one\", class = \"special_string\"),\r\n     b = 2,\r\n     c = tibble::tibble(\r\n       c1 = structure(\"inner\", extra_attr = \"something\"),\r\n       c2 = 4\r\n     )\r\n   )\r\n   ```\r\n   \r\n   could be sufficient. \r\n   \r\n   ```r\r\n   expect_identical(as.data.frame(Table$create(df)), df)\r\n   expect_identical(as.data.frame(record_batch(df)), df)\r\n   ```\r\n   \r\n   and then also confirm that it's identical round-tripping to Feather and Parquet.\n\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2020-06-26T15:44:16.343+0000",
                    "updated": "2020-06-26T15:44:16.343+0000",
                    "started": "2020-06-26T15:44:16.343+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "451622",
                    "issueId": "13306881"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13306881/worklog/452523",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "nealrichardson commented on pull request #7524:\nURL: https://github.com/apache/arrow/pull/7524#issuecomment-651263042\n\n\n   I'm taking this over. Outstanding TODOs:\r\n   \r\n   - [x] Add tests\r\n   - [x] Support record batches\r\n   - [ ] Support nested types (requires adapting the data structure and adding recursion)\r\n   - [ ] Test the print method\r\n   - [ ] Test/handle bad data in metadata$r; allow users to edit it manually?\n\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2020-06-29T17:39:26.905+0000",
                    "updated": "2020-06-29T17:39:26.905+0000",
                    "started": "2020-06-29T17:39:26.905+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "452523",
                    "issueId": "13306881"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13306881/worklog/452608",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "nealrichardson edited a comment on pull request #7524:\nURL: https://github.com/apache/arrow/pull/7524#issuecomment-651263042\n\n\n   I'm taking this over. Outstanding TODOs:\r\n   \r\n   - [x] Add tests\r\n   - [x] Support record batches\r\n   - [x] Support nested types (requires adapting the data structure and adding recursion)\r\n   - [ ] Test the print method\r\n   - [ ] Test/handle bad data in metadata$r; allow users to edit it manually?\n\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2020-06-29T20:31:09.221+0000",
                    "updated": "2020-06-29T20:31:09.221+0000",
                    "started": "2020-06-29T20:31:09.221+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "452608",
                    "issueId": "13306881"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13306881/worklog/452653",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "nealrichardson edited a comment on pull request #7524:\nURL: https://github.com/apache/arrow/pull/7524#issuecomment-651263042\n\n\n   I'm taking this over. Outstanding TODOs:\r\n   \r\n   - [x] Add tests\r\n   - [x] Support record batches\r\n   - [x] Support nested types (requires adapting the data structure and adding recursion)\r\n   - [x] Test the print method\r\n   - [ ] Test/handle bad data in metadata$r; allow users to edit it manually?\r\n   - [ ] Don't keep attributes (e.g. factor levels) that we explicitly translate to Arrow already\r\n   \r\n   Top-level dataset metadata is deferred to https://issues.apache.org/jira/browse/ARROW-9271.\n\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2020-06-29T21:42:14.391+0000",
                    "updated": "2020-06-29T21:42:14.391+0000",
                    "started": "2020-06-29T21:42:14.390+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "452653",
                    "issueId": "13306881"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13306881/worklog/452718",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "nealrichardson edited a comment on pull request #7524:\nURL: https://github.com/apache/arrow/pull/7524#issuecomment-651263042\n\n\n   I'm taking this over. Outstanding TODOs:\r\n   \r\n   - [x] Add tests\r\n   - [x] Support record batches\r\n   - [x] Support nested types (requires adapting the data structure and adding recursion)\r\n   - [x] Test the print method\r\n   - [ ] Test/handle bad data in metadata$r; allow users to edit it manually?\r\n   - [x] Don't keep attributes (e.g. factor levels) that we explicitly translate to Arrow already\r\n   \r\n   Top-level dataset metadata is deferred to https://issues.apache.org/jira/browse/ARROW-9271.\n\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2020-06-30T00:44:09.572+0000",
                    "updated": "2020-06-30T00:44:09.572+0000",
                    "started": "2020-06-30T00:44:09.572+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "452718",
                    "issueId": "13306881"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13306881/worklog/452764",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "nealrichardson edited a comment on pull request #7524:\nURL: https://github.com/apache/arrow/pull/7524#issuecomment-651263042\n\n\n   I'm taking this over. Outstanding TODOs:\r\n   \r\n   - [x] Add tests\r\n   - [x] Support record batches\r\n   - [x] Support nested types (requires adapting the data structure and adding recursion)\r\n   - [x] Test the print method\r\n   - [x] Test/handle bad data in metadata$r; allow users to edit it manually?\r\n   - [x] Don't keep attributes (e.g. factor levels) that we explicitly translate to Arrow already\r\n   \r\n   Top-level dataset metadata is deferred to https://issues.apache.org/jira/browse/ARROW-9271.\n\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2020-06-30T02:26:58.447+0000",
                    "updated": "2020-06-30T02:26:58.447+0000",
                    "started": "2020-06-30T02:26:58.447+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "452764",
                    "issueId": "13306881"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13306881/worklog/452767",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "nealrichardson commented on pull request #7524:\nURL: https://github.com/apache/arrow/pull/7524#issuecomment-651484901\n\n\n   Ok, this isn't necessarily pretty but I think it's done, or done enough for here. I'll add some more tests, probably some docs for the format, and poke around a bit more while doing the tickets for `haven::labelled` and `POSIXlt` types. @romainfrancois if you can glance at the changes I made and confirm that I haven't butchered things too badly, that would be great, thanks.\n\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2020-06-30T02:35:46.448+0000",
                    "updated": "2020-06-30T02:35:46.448+0000",
                    "started": "2020-06-30T02:35:46.448+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "452767",
                    "issueId": "13306881"
                }
            ]
        },
        "customfield_12313920": null,
        "issuetype": {
            "self": "https://issues.apache.org/jira/rest/api/2/issuetype/4",
            "id": "4",
            "description": "An improvement or enhancement to an existing feature or task.",
            "iconUrl": "https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21140&avatarType=issuetype",
            "name": "Improvement",
            "subtask": false,
            "avatarId": 21140
        },
        "timespent": 9600,
        "customfield_12314020": "{summaryBean=com.atlassian.jira.plugin.devstatus.rest.SummaryBean@7e28061f[summary={pullrequest=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@3f1993b[overall=PullRequestOverallBean{stateCount=0, state='OPEN', details=PullRequestOverallDetails{openCount=0, mergedCount=0, declinedCount=0}},byInstanceType={}], build=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@48b60f8b[overall=com.atlassian.jira.plugin.devstatus.summary.beans.BuildOverallBean@47016fe7[failedBuildCount=0,successfulBuildCount=0,unknownBuildCount=0,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], review=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@22be75cb[overall=com.atlassian.jira.plugin.devstatus.summary.beans.ReviewsOverallBean@5362eb93[stateCount=0,state=<null>,dueDate=<null>,overDue=false,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], deployment-environment=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@2bd07c23[overall=com.atlassian.jira.plugin.devstatus.summary.beans.DeploymentOverallBean@67e250e9[topEnvironments=[],showProjects=false,successfulCount=0,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], repository=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@36a361f3[overall=com.atlassian.jira.plugin.devstatus.summary.beans.CommitOverallBean@72d92ac7[count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], branch=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@5a4071db[overall=com.atlassian.jira.plugin.devstatus.summary.beans.BranchOverallBean@2f501762[count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}]},errors=[],configErrors=[]], devSummaryJson={\"cachedValue\":{\"errors\":[],\"configErrors\":[],\"summary\":{\"pullrequest\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"stateCount\":0,\"state\":\"OPEN\",\"details\":{\"openCount\":0,\"mergedCount\":0,\"declinedCount\":0,\"total\":0},\"open\":true},\"byInstanceType\":{}},\"build\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"failedBuildCount\":0,\"successfulBuildCount\":0,\"unknownBuildCount\":0},\"byInstanceType\":{}},\"review\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"stateCount\":0,\"state\":null,\"dueDate\":null,\"overDue\":false,\"completed\":false},\"byInstanceType\":{}},\"deployment-environment\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"topEnvironments\":[],\"showProjects\":false,\"successfulCount\":0},\"byInstanceType\":{}},\"repository\":{\"overall\":{\"count\":0,\"lastUpdated\":null},\"byInstanceType\":{}},\"branch\":{\"overall\":{\"count\":0,\"lastUpdated\":null},\"byInstanceType\":{}}}},\"isStale\":false}}",
        "customfield_12314141": null,
        "customfield_12314140": null,
        "project": {
            "self": "https://issues.apache.org/jira/rest/api/2/project/12319525",
            "id": "12319525",
            "key": "ARROW",
            "name": "Apache Arrow",
            "projectTypeKey": "software",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/projectavatar?pid=12319525&avatarId=10011",
                "24x24": "https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12319525&avatarId=10011",
                "16x16": "https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12319525&avatarId=10011",
                "32x32": "https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12319525&avatarId=10011"
            },
            "projectCategory": {
                "self": "https://issues.apache.org/jira/rest/api/2/projectCategory/13960",
                "id": "13960",
                "description": "Apache Arrow",
                "name": "Arrow"
            }
        },
        "aggregatetimespent": 9600,
        "customfield_12312520": null,
        "customfield_12312521": "Tue Jun 30 15:17:53 UTC 2020",
        "customfield_12314422": null,
        "customfield_12314421": null,
        "customfield_12314146": null,
        "customfield_12314420": null,
        "customfield_12314145": null,
        "customfield_12314144": null,
        "customfield_12314143": null,
        "resolutiondate": "2020-06-30T15:17:53.000+0000",
        "workratio": -1,
        "customfield_12312923": null,
        "customfield_12312920": null,
        "customfield_12312921": null,
        "watches": {
            "self": "https://issues.apache.org/jira/rest/api/2/issue/ARROW-8899/watchers",
            "watchCount": 2,
            "isWatching": false
        },
        "created": "2020-05-22T22:07:27.000+0000",
        "updated": "2020-06-30T15:17:53.000+0000",
        "timeoriginalestimate": null,
        "description": "Arrow Schema and Field objects have custom_metadata fields to store arbitrary strings in a key-value store. Pandas stores JSON in a \"pandas\" key and uses that to improve the fidelity of round-tripping data to Arrow/Parquet/Feather and back. https://pandas.pydata.org/docs/dev/development/developer.html#storing-pandas-dataframe-objects-in-apache-parquet-format describes this a bit.\r\n\r\nYou can see this pandas metadata in the sample Parquet file:\r\n\r\n{code:r}\r\ntab <- read_parquet(system.file(\"v0.7.1.parquet\", package=\"arrow\"), as_data_frame = FALSE)\r\ntab\r\n\r\n# Table\r\n# 10 rows x 11 columns\r\n# $carat <double>\r\n# $cut <string>\r\n# $color <string>\r\n# $clarity <string>\r\n# $depth <double>\r\n# $table <double>\r\n# $price <int64>\r\n# $x <double>\r\n# $y <double>\r\n# $z <double>\r\n# $__index_level_0__ <int64>\r\n\r\ntab$metadata\r\n\r\n# $pandas\r\n# [1] \"{\\\"index_columns\\\": [\\\"__index_level_0__\\\"], \\\"column_indexes\\\": [{\\\"name\\\": null, \\\"pandas_type\\\": \\\"string\\\", \\\"numpy_type\\\": \\\"object\\\", \\\"metadata\\\": null}], \\\"columns\\\": [{\\\"name\\\": \\\"carat\\\", \\\"pandas_type\\\": \\\"float64\\\", \\\"numpy_type\\\": \\\"float64\\\", \\\"metadata\\\": null}, {\\\"name\\\": \\\"cut\\\", \\\"pandas_type\\\": \\\"unicode\\\", \\\"numpy_type\\\": \\\"object\\\", \\\"metadata\\\": null}, {\\\"name\\\": \\\"color\\\", \\\"pandas_type\\\": \\\"unicode\\\", \\\"numpy_type\\\": \\\"object\\\", \\\"metadata\\\": null}, {\\\"name\\\": \\\"clarity\\\", \\\"pandas_type\\\": \\\"unicode\\\", \\\"numpy_type\\\": \\\"object\\\", \\\"metadata\\\": null}, {\\\"name\\\": \\\"depth\\\", \\\"pandas_type\\\": \\\"float64\\\", \\\"numpy_type\\\": \\\"float64\\\", \\\"metadata\\\": null}, {\\\"name\\\": \\\"table\\\", \\\"pandas_type\\\": \\\"float64\\\", \\\"numpy_type\\\": \\\"float64\\\", \\\"metadata\\\": null}, {\\\"name\\\": \\\"price\\\", \\\"pandas_type\\\": \\\"int64\\\", \\\"numpy_type\\\": \\\"int64\\\", \\\"metadata\\\": null}, {\\\"name\\\": \\\"x\\\", \\\"pandas_type\\\": \\\"float64\\\", \\\"numpy_type\\\": \\\"float64\\\", \\\"metadata\\\": null}, {\\\"name\\\": \\\"y\\\", \\\"pandas_type\\\": \\\"float64\\\", \\\"numpy_type\\\": \\\"float64\\\", \\\"metadata\\\": null}, {\\\"name\\\": \\\"z\\\", \\\"pandas_type\\\": \\\"float64\\\", \\\"numpy_type\\\": \\\"float64\\\", \\\"metadata\\\": null}, {\\\"name\\\": \\\"__index_level_0__\\\", \\\"pandas_type\\\": \\\"int64\\\", \\\"numpy_type\\\": \\\"int64\\\", \\\"metadata\\\": null}], \\\"pandas_version\\\": \\\"0.20.1\\\"}\"\r\n{code}\r\n\r\nWe should do something similar in R: store the \"attributes\" for each column in a data.frame when we convert to Arrow, and restore those attributes when we read from Arrow. \r\n\r\nSince ARROW-8703, you could naively do this all in R, something like:\r\n\r\n{code:r}\r\ntab$metadata$r <- lapply(df, attributes)\r\n{code}\r\n\r\non the conversion to Arrow, and in as.data.frame(), do\r\n\r\n{code:r}\r\nif (!is.null(tab$metadata$r)) {\r\n  df[] <- mapply(function(col, meta) {\r\n    attributes(col) <- meta\r\n  }, col = df, meta = tab$metadata$r)\r\n}\r\n{code}\r\n\r\nHowever, it's trickier than this because:\r\n\r\n* {{tab$metadata$r}} needs to be serialized to string and deserialized on the way back. Pandas uses JSON but arrow doesn't currently have a JSON R dependency. We could {{dput()}} to dump the R attributes, but that could introduce risks since you have to parse/eval code to consume it. My best idea at the moment is to try {{rawToChar(serialize(x, ascii = TRUE))}} on the way out (ascii = TRUE doesn't mean it requires ASCII inputs, it's about how it serializes) and {{unserialize(charToRaw(x))}} on the way back. But maybe there's some lower-level way to do this better.\r\n* We'll need to do the same for all places where Tables and RecordBatches are created/converted\r\n* We'll need to make sure that nested types (structs) get the same coverage\r\n* This metadata only is attached to Schemas, meaning that Arrays/ChunkedArrays don't have a place to store extra metadata. So we probably want to attach to the R6 (Chunked)Array objects a metadata/attributes field so that if we convert an R vector to array, or if we extract an array out of a record batch, we don't lose the attributes.\r\n\r\nDoing this should resolve ARROW-4390 and make ARROW-8867 trivial as well.\r\n\r\nFinally, a note about this custom metadata vs. extension types. Extension types can be defined by [adding metadata to a Field|https://arrow.apache.org/docs/format/Columnar.html#extension-types] (in a Schema). I think this is out of scope here because we're only concerned with R roundtrip fidelity. If there were a type that (for example) R and Pandas both had that Arrow did not, we could define an extension type so that we could share that across the implementations. But unless/until there is value in establishing that extension type standard, let's not worry with it. (In other words, in R we should ignore pandas metadata; if there's anything that pandas wants to share with R, it will define it somewhere else.)",
        "customfield_10010": null,
        "timetracking": {
            "remainingEstimate": "0h",
            "timeSpent": "2h 40m",
            "remainingEstimateSeconds": 0,
            "timeSpentSeconds": 9600
        },
        "customfield_12314523": null,
        "customfield_12314127": null,
        "customfield_12314522": null,
        "customfield_12314126": null,
        "customfield_12314521": null,
        "customfield_12314125": null,
        "customfield_12314520": null,
        "customfield_12314124": null,
        "attachment": [],
        "customfield_12312340": null,
        "customfield_12314123": null,
        "customfield_12312341": null,
        "customfield_12312220": null,
        "customfield_12314122": null,
        "customfield_12314121": null,
        "customfield_12314120": null,
        "customfield_12314129": null,
        "customfield_12314524": null,
        "customfield_12314128": null,
        "summary": "[R] Add R metadata like pandas metadata for round-trip fidelity",
        "customfield_12314130": null,
        "customfield_12310291": null,
        "customfield_12310290": null,
        "customfield_12314138": null,
        "customfield_12314137": null,
        "environment": null,
        "customfield_12314136": null,
        "customfield_12314135": null,
        "customfield_12311020": null,
        "customfield_12314134": null,
        "duedate": null,
        "customfield_12314132": null,
        "customfield_12314131": null,
        "comment": {
            "comments": [
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13306881/comment/17148765",
                    "id": "17148765",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=npr",
                        "name": "npr",
                        "key": "npr",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=34045",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34045",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34045",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34045"
                        },
                        "displayName": "Neal Richardson",
                        "active": true,
                        "timeZone": "America/Los_Angeles"
                    },
                    "body": "Issue resolved by pull request 7524\n[https://github.com/apache/arrow/pull/7524]",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=npr",
                        "name": "npr",
                        "key": "npr",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=34045",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34045",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34045",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34045"
                        },
                        "displayName": "Neal Richardson",
                        "active": true,
                        "timeZone": "America/Los_Angeles"
                    },
                    "created": "2020-06-30T15:17:53.811+0000",
                    "updated": "2020-06-30T15:17:53.811+0000"
                }
            ],
            "maxResults": 1,
            "total": 1,
            "startAt": 0
        },
        "customfield_12311820": "0|z0f2lk:",
        "customfield_12314139": null
    }
}