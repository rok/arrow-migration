{
    "expand": "operations,versionedRepresentations,editmeta,changelog,renderedFields",
    "id": "13155449",
    "self": "https://issues.apache.org/jira/rest/api/2/issue/13155449",
    "key": "ARROW-2515",
    "fields": {
        "fixVersions": [
            {
                "self": "https://issues.apache.org/jira/rest/api/2/version/12342562",
                "id": "12342562",
                "description": "",
                "name": "0.10.0",
                "archived": false,
                "released": true,
                "releaseDate": "2018-08-06"
            }
        ],
        "resolution": {
            "self": "https://issues.apache.org/jira/rest/api/2/resolution/1",
            "id": "1",
            "description": "A fix for this issue is checked into the tree and tested.",
            "name": "Fixed"
        },
        "customfield_12312322": null,
        "customfield_12312323": null,
        "customfield_12312320": null,
        "customfield_12310420": "9223372036854775807",
        "customfield_12312321": null,
        "customfield_12312328": null,
        "customfield_12312329": null,
        "customfield_12312326": null,
        "customfield_12310300": null,
        "customfield_12312327": null,
        "customfield_12312324": null,
        "customfield_12312720": null,
        "customfield_12312325": null,
        "lastViewed": null,
        "priority": {
            "self": "https://issues.apache.org/jira/rest/api/2/priority/3",
            "iconUrl": "https://issues.apache.org/jira/images/icons/priorities/major.svg",
            "name": "Major",
            "id": "3"
        },
        "labels": [
            "pull-request-available"
        ],
        "customfield_12312333": null,
        "customfield_12312334": null,
        "customfield_12313422": "false",
        "customfield_12310310": "0.0",
        "customfield_12312331": null,
        "customfield_12312332": null,
        "aggregatetimeoriginalestimate": 3600,
        "timeestimate": 0,
        "customfield_12312330": null,
        "versions": [
            {
                "self": "https://issues.apache.org/jira/rest/api/2/version/12341707",
                "id": "12341707",
                "description": "",
                "name": "0.9.0",
                "archived": false,
                "released": true,
                "releaseDate": "2018-03-19"
            }
        ],
        "customfield_12311120": null,
        "customfield_12313826": null,
        "customfield_12312339": null,
        "issuelinks": [],
        "customfield_12313825": null,
        "assignee": {
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=bkerby",
            "name": "bkerby",
            "key": "bkerby",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=34058",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34058",
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34058",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34058"
            },
            "displayName": "Brent Kerby",
            "active": true,
            "timeZone": "America/Denver"
        },
        "customfield_12312337": null,
        "customfield_12313823": null,
        "customfield_12312338": null,
        "customfield_12311920": null,
        "customfield_12313822": null,
        "customfield_12312335": null,
        "customfield_12313821": null,
        "customfield_12312336": null,
        "customfield_12313820": null,
        "status": {
            "self": "https://issues.apache.org/jira/rest/api/2/status/5",
            "description": "A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.",
            "iconUrl": "https://issues.apache.org/jira/images/icons/statuses/resolved.png",
            "name": "Resolved",
            "id": "5",
            "statusCategory": {
                "self": "https://issues.apache.org/jira/rest/api/2/statuscategory/3",
                "id": 3,
                "key": "done",
                "colorName": "green",
                "name": "Done"
            }
        },
        "components": [
            {
                "self": "https://issues.apache.org/jira/rest/api/2/component/12328936",
                "id": "12328936",
                "name": "Python"
            }
        ],
        "customfield_12312026": null,
        "customfield_12312023": null,
        "customfield_12312024": null,
        "aggregatetimeestimate": 0,
        "customfield_12312022": null,
        "customfield_12310921": null,
        "customfield_12310920": "9223372036854775807",
        "customfield_12312823": null,
        "creator": {
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=bkerby",
            "name": "bkerby",
            "key": "bkerby",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=34058",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34058",
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34058",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34058"
            },
            "displayName": "Brent Kerby",
            "active": true,
            "timeZone": "America/Denver"
        },
        "subtasks": [],
        "reporter": {
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=bkerby",
            "name": "bkerby",
            "key": "bkerby",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=34058",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34058",
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34058",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34058"
            },
            "displayName": "Brent Kerby",
            "active": true,
            "timeZone": "America/Denver"
        },
        "aggregateprogress": {
            "progress": 7200,
            "total": 7200,
            "percent": 100
        },
        "customfield_12313520": null,
        "customfield_12310250": null,
        "progress": {
            "progress": 7200,
            "total": 7200,
            "percent": 100
        },
        "customfield_12313924": null,
        "votes": {
            "self": "https://issues.apache.org/jira/rest/api/2/issue/ARROW-2515/votes",
            "votes": 0,
            "hasVoted": false
        },
        "worklog": {
            "startAt": 0,
            "maxResults": 20,
            "total": 12,
            "worklogs": [
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13155449/worklog/95715",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "blkerby opened a new pull request #1954: ARROW-2515 [Python] Add DictionaryValue class, fixing bugs with nested dictionaries\nURL: https://github.com/apache/arrow/pull/1954\n \n \n   This introduces a scalar value class DictionaryValue, which fixes a couple bugs involving dictionaries nested inside of ListArrays or inside of other DictionaryArrays. This also includes a new test, which failed previous to this commit but now passes. See https://issues.apache.org/jira/browse/ARROW-2515.\r\n   \r\n   This is my first time contributing, so feedback would be most welcome.\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2018-04-26T19:43:12.261+0000",
                    "updated": "2018-04-26T19:43:12.261+0000",
                    "started": "2018-04-26T19:43:12.261+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "95715",
                    "issueId": "13155449"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13155449/worklog/95953",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "pitrou commented on a change in pull request #1954: ARROW-2515 [Python] Add DictionaryValue class, fixing bugs with nested dictionaries\nURL: https://github.com/apache/arrow/pull/1954#discussion_r184625597\n \n \n\n ##########\n File path: python/pyarrow/scalar.pxi\n ##########\n @@ -402,6 +402,29 @@ cdef class StructValue(ArrayValue):\n             zip(child_names, wrapped_arrays)\n         }\n \n+cdef class DictionaryValue(ArrayValue):\n+\n+    def as_py(self):\n+        return self.dictionary_value.as_py()\n+\n+    property indices_value:\n \n Review comment:\n   It's a single index, so how about calling this `index`?\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2018-04-27T08:39:17.626+0000",
                    "updated": "2018-04-27T08:39:17.626+0000",
                    "started": "2018-04-27T08:39:17.561+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "95953",
                    "issueId": "13155449"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13155449/worklog/95954",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "pitrou commented on a change in pull request #1954: ARROW-2515 [Python] Add DictionaryValue class, fixing bugs with nested dictionaries\nURL: https://github.com/apache/arrow/pull/1954#discussion_r184626041\n \n \n\n ##########\n File path: python/pyarrow/scalar.pxi\n ##########\n @@ -402,6 +402,29 @@ cdef class StructValue(ArrayValue):\n             zip(child_names, wrapped_arrays)\n         }\n \n+cdef class DictionaryValue(ArrayValue):\n+\n+    def as_py(self):\n+        return self.dictionary_value.as_py()\n+\n+    property indices_value:\n+\n+        def __get__(self):\n+            cdef CDictionaryArray* darr\n+\n+            darr = <CDictionaryArray*>(self.sp_array.get())\n+            indices = pyarrow_wrap_array(darr.indices())\n+            return indices[self.index]\n+\n+    property dictionary_value:\n \n Review comment:\n   Perhaps simply `value`?\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2018-04-27T08:41:11.386+0000",
                    "updated": "2018-04-27T08:41:11.386+0000",
                    "started": "2018-04-27T08:41:11.386+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "95954",
                    "issueId": "13155449"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13155449/worklog/95957",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "pitrou commented on issue #1954: ARROW-2515 [Python] Add DictionaryValue class, fixing bugs with nested dictionaries\nURL: https://github.com/apache/arrow/pull/1954#issuecomment-384906442\n \n \n   Thanks for your contribution @blkerby ! In addition to the naming nits I posted, it would be nice to add a test for the new `DictionaryValue` properties in `test_scalars.py`. Could you do that?\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2018-04-27T08:43:33.641+0000",
                    "updated": "2018-04-27T08:43:33.641+0000",
                    "started": "2018-04-27T08:43:33.640+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "95957",
                    "issueId": "13155449"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13155449/worklog/96106",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "blkerby commented on a change in pull request #1954: ARROW-2515 [Python] Add DictionaryValue class, fixing bugs with nested dictionaries\nURL: https://github.com/apache/arrow/pull/1954#discussion_r184709119\n \n \n\n ##########\n File path: python/pyarrow/scalar.pxi\n ##########\n @@ -402,6 +402,29 @@ cdef class StructValue(ArrayValue):\n             zip(child_names, wrapped_arrays)\n         }\n \n+cdef class DictionaryValue(ArrayValue):\n+\n+    def as_py(self):\n+        return self.dictionary_value.as_py()\n+\n+    property indices_value:\n \n Review comment:\n   My thinking was to try to be consistent with the naming of the `indices` and `dictionary` properties of the DictionaryArray class, but I agree it's unwieldy and should be changed to simpler names if possible.  My first thought was to go with just `index` and `value` as well, but is there a potential clash with the `index` member of the parent class ArrayValue? I guess right now the inherited `index` is not visible (since it was declared in the Cython and not exposed as a property), but any chance this will change? It seems like all three of these could potentially have some use: `index` being the index into the `indices` array, `indices_value` the value in the `indices` array (which means it is also the index into the `dictionary` array), and then `dictionary_value` being the value in the `dictionary` array. \r\n   \r\n   But then again I guess it's possible to think of the ArrayValue `index` field as an implementation detail which maybe should never be exposed in the API, since it doesn't really provide information about the value itself but rather about its origin. If it is ever exposed, I suppose it could be through a different name, maybe something deliberately unappealing, such as `_index`, and in that case there's no name clash to be worried about in introducing `index` and `value` as DictionaryValue properties.\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2018-04-27T14:43:34.923+0000",
                    "updated": "2018-04-27T14:43:34.923+0000",
                    "started": "2018-04-27T14:43:34.923+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "96106",
                    "issueId": "13155449"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13155449/worklog/96108",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "blkerby commented on issue #1954: ARROW-2515 [Python] Add DictionaryValue class, fixing bugs with nested dictionaries\nURL: https://github.com/apache/arrow/pull/1954#issuecomment-384992562\n \n \n   Excellent suggestion, I'd be happy to add tests for those!\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2018-04-27T14:46:44.191+0000",
                    "updated": "2018-04-27T14:46:44.191+0000",
                    "started": "2018-04-27T14:46:44.190+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "96108",
                    "issueId": "13155449"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13155449/worklog/96451",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "pitrou commented on a change in pull request #1954: ARROW-2515 [Python] Add DictionaryValue class, fixing bugs with nested dictionaries\nURL: https://github.com/apache/arrow/pull/1954#discussion_r184858235\n \n \n\n ##########\n File path: python/pyarrow/scalar.pxi\n ##########\n @@ -402,6 +402,29 @@ cdef class StructValue(ArrayValue):\n             zip(child_names, wrapped_arrays)\n         }\n \n+cdef class DictionaryValue(ArrayValue):\n+\n+    def as_py(self):\n+        return self.dictionary_value.as_py()\n+\n+    property indices_value:\n \n Review comment:\n   Oh, yes, that's a good point. Then I would suggest:\r\n   * keep the current `index` for the index into the indices array\r\n   * use `index_value` for the value in the indices array\r\n   * use `dictionary_value` for the value in the dictionary array\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2018-04-28T15:58:47.846+0000",
                    "updated": "2018-04-28T15:58:47.846+0000",
                    "started": "2018-04-28T15:58:47.846+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "96451",
                    "issueId": "13155449"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13155449/worklog/96452",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "pitrou commented on a change in pull request #1954: ARROW-2515 [Python] Add DictionaryValue class, fixing bugs with nested dictionaries\nURL: https://github.com/apache/arrow/pull/1954#discussion_r184858235\n \n \n\n ##########\n File path: python/pyarrow/scalar.pxi\n ##########\n @@ -402,6 +402,29 @@ cdef class StructValue(ArrayValue):\n             zip(child_names, wrapped_arrays)\n         }\n \n+cdef class DictionaryValue(ArrayValue):\n+\n+    def as_py(self):\n+        return self.dictionary_value.as_py()\n+\n+    property indices_value:\n \n Review comment:\n   Oh, yes, that's a good point. Then I would suggest:\r\n   * keep the current `index` for the index into the indices array\r\n   * use `index_value` for the value in the indices array\r\n   * keep `dictionary_value` for the value in the dictionary array\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2018-04-28T15:58:59.727+0000",
                    "updated": "2018-04-28T15:58:59.727+0000",
                    "started": "2018-04-28T15:58:59.727+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "96452",
                    "issueId": "13155449"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13155449/worklog/96453",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "pitrou commented on a change in pull request #1954: ARROW-2515 [Python] Add DictionaryValue class, fixing bugs with nested dictionaries\nURL: https://github.com/apache/arrow/pull/1954#discussion_r184626041\n \n \n\n ##########\n File path: python/pyarrow/scalar.pxi\n ##########\n @@ -402,6 +402,29 @@ cdef class StructValue(ArrayValue):\n             zip(child_names, wrapped_arrays)\n         }\n \n+cdef class DictionaryValue(ArrayValue):\n+\n+    def as_py(self):\n+        return self.dictionary_value.as_py()\n+\n+    property indices_value:\n+\n+        def __get__(self):\n+            cdef CDictionaryArray* darr\n+\n+            darr = <CDictionaryArray*>(self.sp_array.get())\n+            indices = pyarrow_wrap_array(darr.indices())\n+            return indices[self.index]\n+\n+    property dictionary_value:\n \n Review comment:\n   Perhaps simply `value`?\r\n   \r\n   Edit: Actually, no, see above :-)\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2018-04-28T15:59:18.305+0000",
                    "updated": "2018-04-28T15:59:18.305+0000",
                    "started": "2018-04-28T15:59:18.305+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "96453",
                    "issueId": "13155449"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13155449/worklog/96514",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "blkerby commented on issue #1954: ARROW-2515 [Python] Add DictionaryValue class, fixing bugs with nested dictionaries\nURL: https://github.com/apache/arrow/pull/1954#issuecomment-385272809\n \n \n   Done!\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2018-04-29T18:53:06.872+0000",
                    "updated": "2018-04-29T18:53:06.872+0000",
                    "started": "2018-04-29T18:53:06.872+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "96514",
                    "issueId": "13155449"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13155449/worklog/96601",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "pitrou closed pull request #1954: ARROW-2515 [Python] Add DictionaryValue class, fixing bugs with nested dictionaries\nURL: https://github.com/apache/arrow/pull/1954\n \n \n   \n\nThis is a PR merged from a forked repository.\nAs GitHub hides the original diff on merge, it is displayed below for\nthe sake of provenance:\n\nAs this is a foreign pull request (from a fork), the diff is supplied\nbelow (as it won't show otherwise due to GitHub magic):\n\ndiff --git a/python/pyarrow/array.pxi b/python/pyarrow/array.pxi\nindex 32ea77f11..14f04ea49 100644\n--- a/python/pyarrow/array.pxi\n+++ b/python/pyarrow/array.pxi\n@@ -918,15 +918,6 @@ cdef class BinaryArray(Array):\n \n cdef class DictionaryArray(Array):\n \n-    cdef getitem(self, int64_t i):\n-        cdef Array dictionary = self.dictionary\n-        index = self.indices[i]\n-        if index is NA:\n-            return index\n-        else:\n-            return box_scalar(dictionary.type, dictionary.sp_array,\n-                              index.as_py())\n-\n     def dictionary_encode(self):\n         return self\n \ndiff --git a/python/pyarrow/scalar.pxi b/python/pyarrow/scalar.pxi\nindex 04ecc9cf4..adb5fa6c2 100644\n--- a/python/pyarrow/scalar.pxi\n+++ b/python/pyarrow/scalar.pxi\n@@ -402,6 +402,29 @@ cdef class StructValue(ArrayValue):\n             zip(child_names, wrapped_arrays)\n         }\n \n+cdef class DictionaryValue(ArrayValue):\n+\n+    def as_py(self):\n+        return self.dictionary_value.as_py()\n+\n+    property index_value:\n+\n+        def __get__(self):\n+            cdef CDictionaryArray* darr\n+\n+            darr = <CDictionaryArray*>(self.sp_array.get())\n+            indices = pyarrow_wrap_array(darr.indices())\n+            return indices[self.index]\n+\n+    property dictionary_value:\n+\n+        def __get__(self):\n+            cdef CDictionaryArray* darr\n+\n+            darr = <CDictionaryArray*>(self.sp_array.get())\n+            dictionary = pyarrow_wrap_array(darr.dictionary())\n+            return dictionary[self.index_value.as_py()]\n+\n \n cdef dict _scalar_classes = {\n     _Type_BOOL: BooleanValue,\n@@ -428,6 +451,7 @@ cdef dict _scalar_classes = {\n     _Type_FIXED_SIZE_BINARY: FixedSizeBinaryValue,\n     _Type_DECIMAL: DecimalValue,\n     _Type_STRUCT: StructValue,\n+    _Type_DICTIONARY: DictionaryValue,\n }\n \n \ndiff --git a/python/pyarrow/tests/test_array.py b/python/pyarrow/tests/test_array.py\nindex 7ed2cc9b7..6d7892a47 100644\n--- a/python/pyarrow/tests/test_array.py\n+++ b/python/pyarrow/tests/test_array.py\n@@ -841,3 +841,13 @@ def test_struct_array_flatten():\n     xs, ys = a[1:].flatten()\n     assert xs.to_pylist() == [None, None]\n     assert ys.to_pylist() == [None, 2.5]\n+\n+\n+def test_nested_dictionary_array():\n+    dict_arr = pa.DictionaryArray.from_arrays([0, 1, 0], ['a', 'b'])\n+    list_arr = pa.ListArray.from_arrays([0, 2, 3], dict_arr)\n+    assert list_arr.to_pylist() == [['a', 'b'], ['a']]\n+\n+    dict_arr = pa.DictionaryArray.from_arrays([0, 1, 0], ['a', 'b'])\n+    dict_arr2 = pa.DictionaryArray.from_arrays([0, 1, 2, 1, 0], dict_arr)\n+    assert dict_arr2.to_pylist() == ['a', 'b', 'a', 'b', 'a']\ndiff --git a/python/pyarrow/tests/test_scalars.py b/python/pyarrow/tests/test_scalars.py\nindex 9c86270c4..0a5c72a42 100644\n--- a/python/pyarrow/tests/test_scalars.py\n+++ b/python/pyarrow/tests/test_scalars.py\n@@ -180,6 +180,7 @@ def test_timestamp(self):\n \n     def test_dictionary(self):\n         colors = ['red', 'green', 'blue']\n+        colors_dict = {'red': 0, 'green': 1, 'blue': 2}\n         values = pd.Series(colors * 4)\n \n         categorical = pd.Categorical(values, categories=colors)\n@@ -188,6 +189,8 @@ def test_dictionary(self):\n                                            categorical.categories)\n         for i, c in enumerate(values):\n             assert v[i].as_py() == c\n+            assert v[i].dictionary_value == c\n+            assert v[i].index_value == colors_dict[c]\n \n     def test_int_hash(self):\n         # ARROW-640\n\n\n \n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2018-04-30T07:43:40.628+0000",
                    "updated": "2018-04-30T07:43:40.628+0000",
                    "started": "2018-04-30T07:43:40.628+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "96601",
                    "issueId": "13155449"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13155449/worklog/96602",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "pitrou commented on issue #1954: ARROW-2515 [Python] Add DictionaryValue class, fixing bugs with nested dictionaries\nURL: https://github.com/apache/arrow/pull/1954#issuecomment-385331276\n \n \n   Thanks for your contribution @blkerby !\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2018-04-30T07:44:40.525+0000",
                    "updated": "2018-04-30T07:44:40.525+0000",
                    "started": "2018-04-30T07:44:40.517+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "96602",
                    "issueId": "13155449"
                }
            ]
        },
        "customfield_12313920": null,
        "issuetype": {
            "self": "https://issues.apache.org/jira/rest/api/2/issuetype/1",
            "id": "1",
            "description": "A problem which impairs or prevents the functions of the product.",
            "iconUrl": "https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype",
            "name": "Bug",
            "subtask": false,
            "avatarId": 21133
        },
        "timespent": 7200,
        "customfield_12314020": "{summaryBean=com.atlassian.jira.plugin.devstatus.rest.SummaryBean@3b5c2c15[summary={pullrequest=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@33b13740[overall=PullRequestOverallBean{stateCount=0, state='OPEN', details=PullRequestOverallDetails{openCount=0, mergedCount=0, declinedCount=0}},byInstanceType={}], build=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@16f5ec3e[overall=com.atlassian.jira.plugin.devstatus.summary.beans.BuildOverallBean@2c44d297[failedBuildCount=0,successfulBuildCount=0,unknownBuildCount=0,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], review=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@4d2dcaae[overall=com.atlassian.jira.plugin.devstatus.summary.beans.ReviewsOverallBean@1b811c83[stateCount=0,state=<null>,dueDate=<null>,overDue=false,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], deployment-environment=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@22ac97d1[overall=com.atlassian.jira.plugin.devstatus.summary.beans.DeploymentOverallBean@28f63979[topEnvironments=[],showProjects=false,successfulCount=0,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], repository=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@b2dfe73[overall=com.atlassian.jira.plugin.devstatus.summary.beans.CommitOverallBean@185b8e91[count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], branch=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@5e8f9054[overall=com.atlassian.jira.plugin.devstatus.summary.beans.BranchOverallBean@472b570d[count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}]},errors=[],configErrors=[]], devSummaryJson={\"cachedValue\":{\"errors\":[],\"configErrors\":[],\"summary\":{\"pullrequest\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"stateCount\":0,\"state\":\"OPEN\",\"details\":{\"openCount\":0,\"mergedCount\":0,\"declinedCount\":0,\"total\":0},\"open\":true},\"byInstanceType\":{}},\"build\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"failedBuildCount\":0,\"successfulBuildCount\":0,\"unknownBuildCount\":0},\"byInstanceType\":{}},\"review\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"stateCount\":0,\"state\":null,\"dueDate\":null,\"overDue\":false,\"completed\":false},\"byInstanceType\":{}},\"deployment-environment\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"topEnvironments\":[],\"showProjects\":false,\"successfulCount\":0},\"byInstanceType\":{}},\"repository\":{\"overall\":{\"count\":0,\"lastUpdated\":null},\"byInstanceType\":{}},\"branch\":{\"overall\":{\"count\":0,\"lastUpdated\":null},\"byInstanceType\":{}}}},\"isStale\":false}}",
        "customfield_12314141": null,
        "customfield_12314140": null,
        "project": {
            "self": "https://issues.apache.org/jira/rest/api/2/project/12319525",
            "id": "12319525",
            "key": "ARROW",
            "name": "Apache Arrow",
            "projectTypeKey": "software",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/projectavatar?pid=12319525&avatarId=10011",
                "24x24": "https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12319525&avatarId=10011",
                "16x16": "https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12319525&avatarId=10011",
                "32x32": "https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12319525&avatarId=10011"
            },
            "projectCategory": {
                "self": "https://issues.apache.org/jira/rest/api/2/projectCategory/13960",
                "id": "13960",
                "description": "Apache Arrow",
                "name": "Arrow"
            }
        },
        "aggregatetimespent": 7200,
        "customfield_12312520": null,
        "customfield_12312521": "Mon Apr 30 07:43:38 UTC 2018",
        "customfield_12314422": null,
        "customfield_12314421": null,
        "customfield_12314146": null,
        "customfield_12314420": null,
        "customfield_12314145": null,
        "customfield_12314144": null,
        "customfield_12314143": null,
        "resolutiondate": "2018-04-30T07:43:38.000+0000",
        "workratio": 200,
        "customfield_12312923": null,
        "customfield_12312920": null,
        "customfield_12312921": null,
        "watches": {
            "self": "https://issues.apache.org/jira/rest/api/2/issue/ARROW-2515/watchers",
            "watchCount": 1,
            "isWatching": false
        },
        "created": "2018-04-26T15:53:07.000+0000",
        "updated": "2018-07-27T18:47:20.000+0000",
        "timeoriginalestimate": 3600,
        "description": "An exception (\"KeyError: 26\") is raised when .as_py() is called on elements of a ListArray over a DictionaryArray, or of a DictionaryArray with values in a DictionaryArray. Here are a couple tests that currently fail:\r\n\r\n\u00a0\r\n{code:java}\r\nimport pyarrow as pa\r\n\r\ndef test_dictionary_array_1():\r\n    dict_arr = pa.DictionaryArray.from_arrays([0, 1, 0], ['a', 'b'])\r\n    list_arr = pa.ListArray.from_arrays([0, 2, 3], dict_arr)\r\n    assert list_arr.to_pylist() == [['a', 'b'], ['a']]\r\n\r\ndef test_dictionary_array_2():\r\n    dict_arr = pa.DictionaryArray.from_arrays([0, 1, 0], ['a', 'b'])\r\n    dict_arr2 = pa.DictionaryArray.from_arrays([0, 1, 2, 1, 0], dict_arr)\r\n    assert dict_arr2.to_pylist() == ['a', 'b', 'a', 'b', 'a']\r\n{code}\r\nIt appears that the problem is caused by the fact that the function box_scalar in scalar.pxi does not handle the case of dictionary array, as we currently have no DictionaryValue type.\u00a0\r\n\r\nDictionaryArray.__getitem__ currently works around the\u00a0lack of DictionaryValue type by dereferencing the index and constructing a scalar based on the value in the underlying dictionary. In other words, if we have a dictionary with int8 indices and string values, then the result of __getitem__ will be a StringValue (rather than a DictionaryValue). This works in simple cases but not in the more complex scenarios illustrated above.\r\n\r\nI have a patch ready, which would add a DictionaryValue type similar to other scalar types, resolving these bugs and removing the need for a special-cased implementation of DictionaryArray.__getitem__. This DictionaryValue would contain a couple accessor properties, \"indices_value\" and \"dictionary_value\"\u00a0to\u00a0allow access to both the index in the dictionary as well as the looked-up value. Then\u00a0DictionaryValue.as_py() would simply call .as_py() on the underlying dictionary_value.\u00a0",
        "customfield_10010": null,
        "timetracking": {
            "originalEstimate": "1h",
            "remainingEstimate": "0h",
            "timeSpent": "2h",
            "originalEstimateSeconds": 3600,
            "remainingEstimateSeconds": 0,
            "timeSpentSeconds": 7200
        },
        "customfield_12314523": null,
        "customfield_12314127": null,
        "customfield_12314522": null,
        "customfield_12314126": null,
        "customfield_12314521": null,
        "customfield_12314125": null,
        "customfield_12314520": null,
        "customfield_12314124": null,
        "attachment": [],
        "customfield_12312340": null,
        "customfield_12314123": null,
        "customfield_12312341": null,
        "customfield_12312220": null,
        "customfield_12314122": null,
        "customfield_12314121": null,
        "customfield_12314120": null,
        "customfield_12314129": null,
        "customfield_12314524": null,
        "customfield_12314128": null,
        "summary": "Errors with DictionaryArray inside of ListArray or other DictionaryArray",
        "customfield_12314130": null,
        "customfield_12310291": null,
        "customfield_12310290": null,
        "customfield_12314138": null,
        "customfield_12314137": null,
        "environment": null,
        "customfield_12314136": null,
        "customfield_12314135": null,
        "customfield_12311020": null,
        "customfield_12314134": null,
        "duedate": null,
        "customfield_12314132": null,
        "customfield_12314131": null,
        "comment": {
            "comments": [
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13155449/comment/16458380",
                    "id": "16458380",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=apitrou",
                        "name": "apitrou",
                        "key": "pitrou",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=pitrou&avatarId=35049",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=pitrou&avatarId=35049",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=pitrou&avatarId=35049",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=pitrou&avatarId=35049"
                        },
                        "displayName": "Antoine Pitrou",
                        "active": true,
                        "timeZone": "Europe/Paris"
                    },
                    "body": "Issue resolved by pull request 1954\n[https://github.com/apache/arrow/pull/1954]",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=apitrou",
                        "name": "apitrou",
                        "key": "pitrou",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=pitrou&avatarId=35049",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=pitrou&avatarId=35049",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=pitrou&avatarId=35049",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=pitrou&avatarId=35049"
                        },
                        "displayName": "Antoine Pitrou",
                        "active": true,
                        "timeZone": "Europe/Paris"
                    },
                    "created": "2018-04-30T07:43:38.268+0000",
                    "updated": "2018-04-30T07:43:38.268+0000"
                }
            ],
            "maxResults": 1,
            "total": 1,
            "startAt": 0
        },
        "customfield_12311820": "0|i3t2bz:",
        "customfield_12314139": null
    }
}