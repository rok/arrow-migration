{
    "expand": "operations,versionedRepresentations,editmeta,changelog,renderedFields",
    "id": "13421133",
    "self": "https://issues.apache.org/jira/rest/api/2/issue/13421133",
    "key": "ARROW-15271",
    "fields": {
        "fixVersions": [
            {
                "self": "https://issues.apache.org/jira/rest/api/2/version/12351550",
                "id": "12351550",
                "name": "9.0.0",
                "archived": false,
                "released": true,
                "releaseDate": "2022-08-03"
            }
        ],
        "resolution": {
            "self": "https://issues.apache.org/jira/rest/api/2/resolution/1",
            "id": "1",
            "description": "A fix for this issue is checked into the tree and tested.",
            "name": "Fixed"
        },
        "customfield_12312322": null,
        "customfield_12312323": null,
        "customfield_12312320": null,
        "customfield_12310420": "9223372036854775807",
        "customfield_12312321": null,
        "customfield_12312328": null,
        "customfield_12312329": null,
        "customfield_12312326": null,
        "customfield_12310300": null,
        "customfield_12312327": null,
        "customfield_12312324": null,
        "customfield_12312720": null,
        "customfield_12312325": null,
        "lastViewed": null,
        "priority": {
            "self": "https://issues.apache.org/jira/rest/api/2/priority/3",
            "iconUrl": "https://issues.apache.org/jira/images/icons/priorities/major.svg",
            "name": "Major",
            "id": "3"
        },
        "labels": [
            "pull-request-available"
        ],
        "customfield_12312333": null,
        "customfield_12312334": null,
        "customfield_12313422": "false",
        "customfield_12310310": "0.0",
        "customfield_12312331": null,
        "customfield_12312332": null,
        "aggregatetimeoriginalestimate": null,
        "timeestimate": 0,
        "customfield_12312330": null,
        "versions": [
            {
                "self": "https://issues.apache.org/jira/rest/api/2/version/12350712",
                "id": "12350712",
                "description": "",
                "name": "6.0.1",
                "archived": false,
                "released": true,
                "releaseDate": "2021-11-18"
            }
        ],
        "customfield_12311120": null,
        "customfield_12313826": null,
        "customfield_12312339": null,
        "issuelinks": [
            {
                "id": "12630331",
                "self": "https://issues.apache.org/jira/rest/api/2/issueLink/12630331",
                "type": {
                    "id": "10030",
                    "name": "Reference",
                    "inward": "is related to",
                    "outward": "relates to",
                    "self": "https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"
                },
                "inwardIssue": {
                    "id": "13401919",
                    "key": "ARROW-14029",
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13401919",
                    "fields": {
                        "summary": "[R] Repair map_batches()",
                        "status": {
                            "self": "https://issues.apache.org/jira/rest/api/2/status/5",
                            "description": "A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.",
                            "iconUrl": "https://issues.apache.org/jira/images/icons/statuses/resolved.png",
                            "name": "Resolved",
                            "id": "5",
                            "statusCategory": {
                                "self": "https://issues.apache.org/jira/rest/api/2/statuscategory/3",
                                "id": 3,
                                "key": "done",
                                "colorName": "green",
                                "name": "Done"
                            }
                        },
                        "priority": {
                            "self": "https://issues.apache.org/jira/rest/api/2/priority/3",
                            "iconUrl": "https://issues.apache.org/jira/images/icons/priorities/major.svg",
                            "name": "Major",
                            "id": "3"
                        },
                        "issuetype": {
                            "self": "https://issues.apache.org/jira/rest/api/2/issuetype/1",
                            "id": "1",
                            "description": "A problem which impairs or prevents the functions of the product.",
                            "iconUrl": "https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype",
                            "name": "Bug",
                            "subtask": false,
                            "avatarId": 21133
                        }
                    }
                }
            },
            {
                "id": "12630330",
                "self": "https://issues.apache.org/jira/rest/api/2/issueLink/12630330",
                "type": {
                    "id": "10030",
                    "name": "Reference",
                    "inward": "is related to",
                    "outward": "relates to",
                    "self": "https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"
                },
                "inwardIssue": {
                    "id": "13416228",
                    "key": "ARROW-15040",
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13416228",
                    "fields": {
                        "summary": "[R] Enable write_csv_arrow to take Dataset or arrow_dplyr_query as input",
                        "status": {
                            "self": "https://issues.apache.org/jira/rest/api/2/status/5",
                            "description": "A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.",
                            "iconUrl": "https://issues.apache.org/jira/images/icons/statuses/resolved.png",
                            "name": "Resolved",
                            "id": "5",
                            "statusCategory": {
                                "self": "https://issues.apache.org/jira/rest/api/2/statuscategory/3",
                                "id": 3,
                                "key": "done",
                                "colorName": "green",
                                "name": "Done"
                            }
                        },
                        "priority": {
                            "self": "https://issues.apache.org/jira/rest/api/2/priority/3",
                            "iconUrl": "https://issues.apache.org/jira/images/icons/priorities/major.svg",
                            "name": "Major",
                            "id": "3"
                        },
                        "issuetype": {
                            "self": "https://issues.apache.org/jira/rest/api/2/issuetype/4",
                            "id": "4",
                            "description": "An improvement or enhancement to an existing feature or task.",
                            "iconUrl": "https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21140&avatarType=issuetype",
                            "name": "Improvement",
                            "subtask": false,
                            "avatarId": 21140
                        }
                    }
                }
            }
        ],
        "customfield_12313825": null,
        "assignee": {
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=npr",
            "name": "npr",
            "key": "npr",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=34045",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34045",
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34045",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34045"
            },
            "displayName": "Neal Richardson",
            "active": true,
            "timeZone": "America/Los_Angeles"
        },
        "customfield_12312337": null,
        "customfield_12313823": null,
        "customfield_12312338": null,
        "customfield_12311920": null,
        "customfield_12313822": null,
        "customfield_12312335": null,
        "customfield_12313821": null,
        "customfield_12312336": null,
        "customfield_12313820": null,
        "status": {
            "self": "https://issues.apache.org/jira/rest/api/2/status/5",
            "description": "A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.",
            "iconUrl": "https://issues.apache.org/jira/images/icons/statuses/resolved.png",
            "name": "Resolved",
            "id": "5",
            "statusCategory": {
                "self": "https://issues.apache.org/jira/rest/api/2/statuscategory/3",
                "id": 3,
                "key": "done",
                "colorName": "green",
                "name": "Done"
            }
        },
        "components": [
            {
                "self": "https://issues.apache.org/jira/rest/api/2/component/12333008",
                "id": "12333008",
                "name": "R"
            }
        ],
        "customfield_12312026": null,
        "customfield_12312023": null,
        "customfield_12312024": null,
        "aggregatetimeestimate": 0,
        "customfield_12312022": null,
        "customfield_12310921": null,
        "customfield_12310920": "9223372036854775807",
        "customfield_12312823": null,
        "creator": {
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=willjones127",
            "name": "willjones127",
            "key": "willjones127",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=34058",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34058",
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34058",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34058"
            },
            "displayName": "Will Jones",
            "active": true,
            "timeZone": "Etc/UTC"
        },
        "subtasks": [],
        "reporter": {
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=willjones127",
            "name": "willjones127",
            "key": "willjones127",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=34058",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34058",
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34058",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34058"
            },
            "displayName": "Will Jones",
            "active": true,
            "timeZone": "Etc/UTC"
        },
        "aggregateprogress": {
            "progress": 8400,
            "total": 8400,
            "percent": 100
        },
        "customfield_12313520": null,
        "customfield_12310250": null,
        "progress": {
            "progress": 8400,
            "total": 8400,
            "percent": 100
        },
        "customfield_12313924": null,
        "votes": {
            "self": "https://issues.apache.org/jira/rest/api/2/issue/ARROW-15271/votes",
            "votes": 0,
            "hasVoted": false
        },
        "worklog": {
            "startAt": 0,
            "maxResults": 20,
            "total": 14,
            "worklogs": [
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13421133/worklog/771058",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "nealrichardson opened a new pull request, #13170:\nURL: https://github.com/apache/arrow/pull/13170\n\n   Ticket title is misleading: this PR actually removes do_exec_plan(). plan$Run() now always returns a RBR; the two cases where Tables are used to post-process ExecPlan results are encapsulated in Run() now.\r\n   \r\n   There is one catch that still needs addressing, but I'll make another jira for it: you can provide schema metadata to the WriteNode but not the other SinkNodes, so anything that preserves R metadata needs to handle that separately because Run() will drop it. This seems to be a limitation of the C++ library.\r\n   \r\n   One other change here: map_batches() now returns a RBR and requires that the function it maps returns something that is coercible to a RecordBatch.\n\n\n",
                    "created": "2022-05-16T23:02:54.572+0000",
                    "updated": "2022-05-16T23:02:54.572+0000",
                    "started": "2022-05-16T23:02:54.571+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "771058",
                    "issueId": "13421133"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13421133/worklog/771059",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "github-actions[bot] commented on PR #13170:\nURL: https://github.com/apache/arrow/pull/13170#issuecomment-1128219541\n\n   https://issues.apache.org/jira/browse/ARROW-15271\n\n\n",
                    "created": "2022-05-16T23:03:14.434+0000",
                    "updated": "2022-05-16T23:03:14.434+0000",
                    "started": "2022-05-16T23:03:14.434+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "771059",
                    "issueId": "13421133"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13421133/worklog/771060",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "github-actions[bot] commented on PR #13170:\nURL: https://github.com/apache/arrow/pull/13170#issuecomment-1128219563\n\n   :warning: Ticket **has not been started in JIRA**, please click 'Start Progress'.\n\n\n",
                    "created": "2022-05-16T23:03:16.744+0000",
                    "updated": "2022-05-16T23:03:16.744+0000",
                    "started": "2022-05-16T23:03:16.744+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "771060",
                    "issueId": "13421133"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13421133/worklog/771910",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "nealrichardson commented on code in PR #13170:\nURL: https://github.com/apache/arrow/pull/13170#discussion_r875977868\n\n\n##########\nr/R/record-batch-reader.R:\n##########\n@@ -226,8 +237,8 @@ as_record_batch_reader.Dataset <- function(x, ...) {\n #' @rdname as_record_batch_reader\n #' @export\n as_record_batch_reader.arrow_dplyr_query <- function(x, ...) {\n-  # TODO(ARROW-15271): make ExecPlan return RBR\n-  as_record_batch_reader(collect.arrow_dplyr_query(x, as_data_frame = FALSE))\n+  # TODO(ARROW-15271): use ExecPlan directly when it handles metadata\n\nReview Comment:\n   ```suggestion\r\n     # TODO(ARROW-16607): use ExecPlan directly when it handles metadata\r\n   ```\n\n\n\n",
                    "created": "2022-05-18T14:34:32.026+0000",
                    "updated": "2022-05-18T14:34:32.026+0000",
                    "started": "2022-05-18T14:34:32.026+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "771910",
                    "issueId": "13421133"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13421133/worklog/771912",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "nealrichardson commented on code in PR #13170:\nURL: https://github.com/apache/arrow/pull/13170#discussion_r875981109\n\n\n##########\nr/R/dplyr-collect.R:\n##########\n@@ -27,15 +27,31 @@ collect.arrow_dplyr_query <- function(x, as_data_frame = TRUE, ...) {\n   }\n \n   # See query-engine.R for ExecPlan/Nodes\n+  plan <- ExecPlan$create()\n+  final_node <- plan$Build(x)\n   tryCatch(\n-    tab <- do_exec_plan(x),\n+    tab <- plan$Run(final_node)$read_table(),\n     # n = 4 because we want the error to show up as being from collect()\n     # and not handle_csv_read_error()\n     error = function(e, call = caller_env(n = 4)) {\n       handle_csv_read_error(e, x$.data$schema, call)\n     }\n   )\n \n+  # TODO: SinkNodeOptions need to take KVM like WriteNodeOptions\n+  # or need to be able to set metadata on RBR\n\nReview Comment:\n   ```suggestion\r\n     # TODO(ARROW-16607): move KVM handling into ExecPlan\r\n   ```\n\n\n\n",
                    "created": "2022-05-18T14:37:12.161+0000",
                    "updated": "2022-05-18T14:37:12.161+0000",
                    "started": "2022-05-18T14:37:12.161+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "771912",
                    "issueId": "13421133"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13421133/worklog/772150",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "wjones127 commented on code in PR #13170:\nURL: https://github.com/apache/arrow/pull/13170#discussion_r876399314\n\n\n##########\nr/R/dataset-scan.R:\n##########\n@@ -169,43 +169,57 @@ tail_from_batches <- function(batches, n) {\n     if (n <= 0) break\n   }\n   # rev() the result to put the batches back in the right order\n-  Table$create(!!!rev(result))\n+  RecordBatchReader$create(batches = rev(result))\n }\n \n #' Apply a function to a stream of RecordBatches\n #'\n #' As an alternative to calling `collect()` on a `Dataset` query, you can\n #' use this function to access the stream of `RecordBatch`es in the `Dataset`.\n-#' This lets you aggregate on each chunk and pull the intermediate results into\n-#' a `data.frame` for further aggregation, even if you couldn't fit the whole\n-#' `Dataset` result in memory.\n+#' This lets you do more complex operations in R that operate on chunks of data\n+#' without having to hold the entire Dataset in memory at once. You can include\n+#' `map_batches()` in a dplyr pipeline and do additional dplyr methods on the\n+#' stream of data in Arrow after it.\n #'\n-#' This is experimental and not recommended for production use.\n+#' Note that, unlike the core dplyr methods that are implemented in the Arrow\n+#' query engine, `map_batches()` is not lazy: it starts evaluating on the data\n+#' when you call it, even if you send its result to another pipeline function.\n+#'\n+#' This is experimental and not recommended for production use. It is also\n+#' single-threaded and runs in R not C++, so it won't be as fast as core\n+#' Arrow methods.\n #'\n #' @param X A `Dataset` or `arrow_dplyr_query` object, as returned by the\n #' `dplyr` methods on `Dataset`.\n #' @param FUN A function or `purrr`-style lambda expression to apply to each\n-#' batch\n+#' batch. It must return a RecordBatch or something coercible to one via\n+#' `as_record_batch()'.\n #' @param ... Additional arguments passed to `FUN`\n-#' @param .data.frame logical: collect the resulting chunks into a single\n-#' `data.frame`? Default `TRUE`\n+#' @param .data.frame Deprecated argument, ignored\n+#' @return An `arrow_dplyr_query`.\n #' @export\n-map_batches <- function(X, FUN, ..., .data.frame = TRUE) {\n-  # TODO: ARROW-15271 possibly refactor do_exec_plan to return a RecordBatchReader\n+map_batches <- function(X, FUN, ..., .data.frame = NULL) {\n+  if (!is.null(.data.frame)) {\n+    warning(\n+      \"The .data.frame argument is deprecated. \",\n+      \"Call collect() on the result to get a data.frame.\",\n+      call. = FALSE\n+    )\n+  }\n   plan <- ExecPlan$create()\n   final_node <- plan$Build(as_adq(X))\n   reader <- plan$Run(final_node)\n   FUN <- as_mapper(FUN)\n \n-  # TODO: wrap batch in arrow_dplyr_query with X$selected_columns,\n-  # X$temp_columns, and X$group_by_vars\n-  # if X is arrow_dplyr_query, if some other arg (.dplyr?) == TRUE\n+  # TODO: for future consideration\n+  # * Move eval to C++ and make it a generator so it can stream, not block\n\nReview Comment:\n   +1 that would be nice.\n\n\n\n##########\nr/R/dataset-scan.R:\n##########\n@@ -214,13 +228,7 @@ map_batches <- function(X, FUN, ..., .data.frame = TRUE) {\n     res <- res[seq_len(i)]\n   }\n \n-  if (.data.frame & inherits(res[[1]], \"arrow_dplyr_query\")) {\n-    res <- dplyr::bind_rows(map(res, dplyr::collect))\n-  } else if (.data.frame) {\n-    res <- dplyr::bind_rows(map(res, as.data.frame))\n-  }\n-\n-  res\n+  as_adq(RecordBatchReader$create(batches = res))\n\nReview Comment:\n   Question: Why return an ADQ instead of a straight RBR? RBR is a documented type, while ADQ is undocumented, and I think you can still use a RBR in a dplyr pipeline, right?\n\n\n\n##########\nr/R/record-batch-reader.R:\n##########\n@@ -104,6 +105,16 @@ RecordBatchReader <- R6Class(\"RecordBatchReader\",\n     schema = function() RecordBatchReader__schema(self)\n   )\n )\n+RecordBatchReader$create <- function(..., batches = list(...), schema = NULL) {\n\nReview Comment:\n   I think I just learned something new about R. `batches` here is the equivalent of Python's `*args`, right?\n\n\n\n",
                    "created": "2022-05-18T21:43:05.895+0000",
                    "updated": "2022-05-18T21:43:05.895+0000",
                    "started": "2022-05-18T21:43:05.895+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "772150",
                    "issueId": "13421133"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13421133/worklog/772153",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "nealrichardson commented on code in PR #13170:\nURL: https://github.com/apache/arrow/pull/13170#discussion_r876420634\n\n\n##########\nr/R/record-batch-reader.R:\n##########\n@@ -104,6 +105,16 @@ RecordBatchReader <- R6Class(\"RecordBatchReader\",\n     schema = function() RecordBatchReader__schema(self)\n   )\n )\n+RecordBatchReader$create <- function(..., batches = list(...), schema = NULL) {\n\nReview Comment:\n   In effect, yes, or `**kwargs`. This is a convenient pattern when you want to accept `...` to turn into a list but may have already assembled the list.\n\n\n\n",
                    "created": "2022-05-18T22:07:52.875+0000",
                    "updated": "2022-05-18T22:07:52.875+0000",
                    "started": "2022-05-18T22:07:52.874+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "772153",
                    "issueId": "13421133"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13421133/worklog/772158",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "nealrichardson commented on code in PR #13170:\nURL: https://github.com/apache/arrow/pull/13170#discussion_r876424751\n\n\n##########\nr/R/dataset-scan.R:\n##########\n@@ -214,13 +228,7 @@ map_batches <- function(X, FUN, ..., .data.frame = TRUE) {\n     res <- res[seq_len(i)]\n   }\n \n-  if (.data.frame & inherits(res[[1]], \"arrow_dplyr_query\")) {\n-    res <- dplyr::bind_rows(map(res, dplyr::collect))\n-  } else if (.data.frame) {\n-    res <- dplyr::bind_rows(map(res, as.data.frame))\n-  }\n-\n-  res\n+  as_adq(RecordBatchReader$create(batches = res))\n\nReview Comment:\n   I was thinking back to the discussion that ARROW-15489 refers to, where RBR didn't print usefully so it would be weird to get one back. But now that that issue has been done, you're right, RBR makes sense (it prints about the same as ADQ now). I can switch this one and also switch the duckdb to_arrow() one as well. \n\n\n\n",
                    "created": "2022-05-18T22:15:49.004+0000",
                    "updated": "2022-05-18T22:15:49.004+0000",
                    "started": "2022-05-18T22:15:49.004+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "772158",
                    "issueId": "13421133"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13421133/worklog/772160",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "nealrichardson commented on code in PR #13170:\nURL: https://github.com/apache/arrow/pull/13170#discussion_r876431555\n\n\n##########\nr/R/dataset-scan.R:\n##########\n@@ -214,13 +228,7 @@ map_batches <- function(X, FUN, ..., .data.frame = TRUE) {\n     res <- res[seq_len(i)]\n   }\n \n-  if (.data.frame & inherits(res[[1]], \"arrow_dplyr_query\")) {\n-    res <- dplyr::bind_rows(map(res, dplyr::collect))\n-  } else if (.data.frame) {\n-    res <- dplyr::bind_rows(map(res, as.data.frame))\n-  }\n-\n-  res\n+  as_adq(RecordBatchReader$create(batches = res))\n\nReview Comment:\n   Done in https://github.com/apache/arrow/pull/13170/commits/e12c633327439fef6857ea8c6b08a18af2301c96\n\n\n\n",
                    "created": "2022-05-18T22:29:05.151+0000",
                    "updated": "2022-05-18T22:29:05.151+0000",
                    "started": "2022-05-18T22:29:05.151+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "772160",
                    "issueId": "13421133"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13421133/worklog/772161",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "nealrichardson commented on code in PR #13170:\nURL: https://github.com/apache/arrow/pull/13170#discussion_r876431942\n\n\n##########\nr/R/duckdb.R:\n##########\n@@ -161,9 +157,5 @@ to_arrow <- function(.data, as_arrow_query = TRUE) {\n   # Run the query\n   res <- DBI::dbSendQuery(dbplyr::remote_con(.data), dbplyr::remote_query(.data), arrow = TRUE)\n \n-  if (as_arrow_query) {\n-    arrow_dplyr_query(duckdb::duckdb_fetch_record_batch(res))\n-  } else {\n-    duckdb::duckdb_fetch_record_batch(res)\n-  }\n+  duckdb::duckdb_fetch_record_batch(res)\n\nReview Comment:\n   @jonkeane FYI. See also https://github.com/apache/arrow/pull/11730#discussion_r794661445 for historical context\n\n\n\n",
                    "created": "2022-05-18T22:29:50.184+0000",
                    "updated": "2022-05-18T22:29:50.184+0000",
                    "started": "2022-05-18T22:29:50.184+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "772161",
                    "issueId": "13421133"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13421133/worklog/772184",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "jonkeane commented on code in PR #13170:\nURL: https://github.com/apache/arrow/pull/13170#discussion_r876456619\n\n\n##########\nr/R/duckdb.R:\n##########\n@@ -161,9 +157,5 @@ to_arrow <- function(.data, as_arrow_query = TRUE) {\n   # Run the query\n   res <- DBI::dbSendQuery(dbplyr::remote_con(.data), dbplyr::remote_query(.data), arrow = TRUE)\n \n-  if (as_arrow_query) {\n-    arrow_dplyr_query(duckdb::duckdb_fetch_record_batch(res))\n-  } else {\n-    duckdb::duckdb_fetch_record_batch(res)\n-  }\n+  duckdb::duckdb_fetch_record_batch(res)\n\nReview Comment:\n   I'm glad we can get this cleaned up \ud83c\udf89 \n\n\n\n",
                    "created": "2022-05-18T23:25:50.029+0000",
                    "updated": "2022-05-18T23:25:50.029+0000",
                    "started": "2022-05-18T23:25:50.029+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "772184",
                    "issueId": "13421133"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13421133/worklog/772185",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "nealrichardson closed pull request #13170: ARROW-15271: [R] Refactor do_exec_plan to return a RecordBatchReader\nURL: https://github.com/apache/arrow/pull/13170\n\n\n",
                    "created": "2022-05-18T23:27:31.649+0000",
                    "updated": "2022-05-18T23:27:31.649+0000",
                    "started": "2022-05-18T23:27:31.649+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "772185",
                    "issueId": "13421133"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13421133/worklog/772369",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "ursabot commented on PR #13170:\nURL: https://github.com/apache/arrow/pull/13170#issuecomment-1131530737\n\n   Benchmark runs are scheduled for baseline = 663dc325de1176a5caf32809942acae98abf7a8b and contender = dc39f83e2f9d05b0fcea1ad8ed4ed9e07da7bef0. dc39f83e2f9d05b0fcea1ad8ed4ed9e07da7bef0 is a master commit associated with this PR. Results will be available as each benchmark for each run completes.\n   Conbench compare runs links:\n   [Finished :arrow_down:0.0% :arrow_up:0.0%] [ec2-t3-xlarge-us-east-2](https://conbench.ursa.dev/compare/runs/679e4e4402d8439d9ff43edd41eb97de...9acf4b5cd6fe4f8d8539b78ac55a0ea3/)\n   [Failed :arrow_down:11.53% :arrow_up:0.0%] [test-mac-arm](https://conbench.ursa.dev/compare/runs/4883c8a43a764d42aa646ddbb28a3f46...55c6f23a3dcb4c20a616a108c47ad345/)\n   [Failed :arrow_down:0.37% :arrow_up:0.37%] [ursa-i9-9960x](https://conbench.ursa.dev/compare/runs/2880b9bcf61e46bc8de245f742a50900...69f4a27b959147c489dc11a6d5cdddfd/)\n   [Finished :arrow_down:0.32% :arrow_up:0.0%] [ursa-thinkcentre-m75q](https://conbench.ursa.dev/compare/runs/c14e1c957fce4c2da381ef9e6d42cc6f...085c7b1c3f034465990f2b74b5e337b1/)\n   Buildkite builds:\n   [Finished] [`dc39f83e` ec2-t3-xlarge-us-east-2](https://buildkite.com/apache-arrow/arrow-bci-benchmark-on-ec2-t3-xlarge-us-east-2/builds/791)\n   [Failed] [`dc39f83e` test-mac-arm](https://buildkite.com/apache-arrow/arrow-bci-benchmark-on-test-mac-arm/builds/788)\n   [Failed] [`dc39f83e` ursa-i9-9960x](https://buildkite.com/apache-arrow/arrow-bci-benchmark-on-ursa-i9-9960x/builds/778)\n   [Finished] [`dc39f83e` ursa-thinkcentre-m75q](https://buildkite.com/apache-arrow/arrow-bci-benchmark-on-ursa-thinkcentre-m75q/builds/794)\n   [Finished] [`663dc325` ec2-t3-xlarge-us-east-2](https://buildkite.com/apache-arrow/arrow-bci-benchmark-on-ec2-t3-xlarge-us-east-2/builds/790)\n   [Failed] [`663dc325` test-mac-arm](https://buildkite.com/apache-arrow/arrow-bci-benchmark-on-test-mac-arm/builds/787)\n   [Failed] [`663dc325` ursa-i9-9960x](https://buildkite.com/apache-arrow/arrow-bci-benchmark-on-ursa-i9-9960x/builds/777)\n   [Finished] [`663dc325` ursa-thinkcentre-m75q](https://buildkite.com/apache-arrow/arrow-bci-benchmark-on-ursa-thinkcentre-m75q/builds/793)\n   Supported benchmarks:\n   ec2-t3-xlarge-us-east-2: Supported benchmark langs: Python, R. Runs only benchmarks with cloud = True\n   test-mac-arm: Supported benchmark langs: C++, Python, R\n   ursa-i9-9960x: Supported benchmark langs: Python, R, JavaScript\n   ursa-thinkcentre-m75q: Supported benchmark langs: C++, Java\n   \n\n\n",
                    "created": "2022-05-19T10:41:45.051+0000",
                    "updated": "2022-05-19T10:41:45.051+0000",
                    "started": "2022-05-19T10:41:45.051+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "772369",
                    "issueId": "13421133"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13421133/worklog/772370",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "ursabot commented on PR #13170:\nURL: https://github.com/apache/arrow/pull/13170#issuecomment-1131530856\n\n   ['Python', 'R'] benchmarks have high level of regressions.\n   [ursa-i9-9960x](https://conbench.ursa.dev/compare/runs/2880b9bcf61e46bc8de245f742a50900...69f4a27b959147c489dc11a6d5cdddfd/)\n   \n\n\n",
                    "created": "2022-05-19T10:41:53.564+0000",
                    "updated": "2022-05-19T10:41:53.564+0000",
                    "started": "2022-05-19T10:41:53.564+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "772370",
                    "issueId": "13421133"
                }
            ]
        },
        "customfield_12313920": null,
        "issuetype": {
            "self": "https://issues.apache.org/jira/rest/api/2/issuetype/4",
            "id": "4",
            "description": "An improvement or enhancement to an existing feature or task.",
            "iconUrl": "https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21140&avatarType=issuetype",
            "name": "Improvement",
            "subtask": false,
            "avatarId": 21140
        },
        "timespent": 8400,
        "customfield_12314020": "{summaryBean=com.atlassian.jira.plugin.devstatus.rest.SummaryBean@2230a045[summary={pullrequest=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@49a3e391[overall=PullRequestOverallBean{stateCount=0, state='OPEN', details=PullRequestOverallDetails{openCount=0, mergedCount=0, declinedCount=0}},byInstanceType={}], build=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@52c034f5[overall=com.atlassian.jira.plugin.devstatus.summary.beans.BuildOverallBean@4a9fa57[failedBuildCount=0,successfulBuildCount=0,unknownBuildCount=0,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], review=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@38061330[overall=com.atlassian.jira.plugin.devstatus.summary.beans.ReviewsOverallBean@618e55b2[stateCount=0,state=<null>,dueDate=<null>,overDue=false,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], deployment-environment=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@323ab2ea[overall=com.atlassian.jira.plugin.devstatus.summary.beans.DeploymentOverallBean@790a8db8[topEnvironments=[],showProjects=false,successfulCount=0,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], repository=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@719d8e3a[overall=com.atlassian.jira.plugin.devstatus.summary.beans.CommitOverallBean@622d667e[count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], branch=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@5673533[overall=com.atlassian.jira.plugin.devstatus.summary.beans.BranchOverallBean@282d1f6a[count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}]},errors=[],configErrors=[]], devSummaryJson={\"cachedValue\":{\"errors\":[],\"configErrors\":[],\"summary\":{\"pullrequest\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"stateCount\":0,\"state\":\"OPEN\",\"details\":{\"openCount\":0,\"mergedCount\":0,\"declinedCount\":0,\"total\":0},\"open\":true},\"byInstanceType\":{}},\"build\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"failedBuildCount\":0,\"successfulBuildCount\":0,\"unknownBuildCount\":0},\"byInstanceType\":{}},\"review\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"stateCount\":0,\"state\":null,\"dueDate\":null,\"overDue\":false,\"completed\":false},\"byInstanceType\":{}},\"deployment-environment\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"topEnvironments\":[],\"showProjects\":false,\"successfulCount\":0},\"byInstanceType\":{}},\"repository\":{\"overall\":{\"count\":0,\"lastUpdated\":null},\"byInstanceType\":{}},\"branch\":{\"overall\":{\"count\":0,\"lastUpdated\":null},\"byInstanceType\":{}}}},\"isStale\":false}}",
        "customfield_12314141": null,
        "customfield_12314140": null,
        "project": {
            "self": "https://issues.apache.org/jira/rest/api/2/project/12319525",
            "id": "12319525",
            "key": "ARROW",
            "name": "Apache Arrow",
            "projectTypeKey": "software",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/projectavatar?pid=12319525&avatarId=10011",
                "24x24": "https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12319525&avatarId=10011",
                "16x16": "https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12319525&avatarId=10011",
                "32x32": "https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12319525&avatarId=10011"
            },
            "projectCategory": {
                "self": "https://issues.apache.org/jira/rest/api/2/projectCategory/13960",
                "id": "13960",
                "description": "Apache Arrow",
                "name": "Arrow"
            }
        },
        "aggregatetimespent": 8400,
        "customfield_12312520": null,
        "customfield_12312521": "Wed May 18 23:27:32 UTC 2022",
        "customfield_12314422": null,
        "customfield_12314421": [
            "R"
        ],
        "customfield_12314146": null,
        "customfield_12314420": null,
        "customfield_12314145": null,
        "customfield_12314144": null,
        "customfield_12314143": null,
        "resolutiondate": "2022-05-18T23:27:32.000+0000",
        "workratio": -1,
        "customfield_12312923": null,
        "customfield_12312920": null,
        "customfield_12312921": null,
        "watches": {
            "self": "https://issues.apache.org/jira/rest/api/2/issue/ARROW-15271/watchers",
            "watchCount": 3,
            "isWatching": false
        },
        "created": "2022-01-06T17:55:22.000+0000",
        "updated": "2022-05-19T10:41:54.000+0000",
        "timeoriginalestimate": null,
        "description": "Right now [{{do_exec_plan}}|https://github.com/apache/arrow/blob/master/r/R/query-engine.R#L18] returns an Arrow table because {{head}}, {{tail}}, and {{arrange}} do. If ARROW-14289 is completed and similar work is done for {{arrange}}, we may be able to alter {{do_exec_plan}} to return a RBR instead.\r\n\r\nThe {{map_batches()}} implementation (ARROW-14029) could benefit from this refactor. And it might make ARROW-15040 more useful.",
        "customfield_10010": null,
        "timetracking": {
            "remainingEstimate": "0h",
            "timeSpent": "2h 20m",
            "remainingEstimateSeconds": 0,
            "timeSpentSeconds": 8400
        },
        "customfield_12314523": null,
        "customfield_12314127": null,
        "customfield_12314522": null,
        "customfield_12314126": null,
        "customfield_12314521": null,
        "customfield_12314125": null,
        "customfield_12314520": null,
        "customfield_12314124": null,
        "attachment": [],
        "customfield_12312340": null,
        "customfield_12314123": null,
        "customfield_12312341": null,
        "customfield_12312220": null,
        "customfield_12314122": null,
        "customfield_12314121": null,
        "customfield_12314120": null,
        "customfield_12314129": null,
        "customfield_12314524": null,
        "customfield_12314128": null,
        "summary": "[R] Refactor do_exec_plan to return a RecordBatchReader",
        "customfield_12314130": null,
        "customfield_12310291": null,
        "customfield_12310290": null,
        "customfield_12314138": null,
        "customfield_12314137": null,
        "environment": null,
        "customfield_12314136": null,
        "customfield_12314135": null,
        "customfield_12311020": null,
        "customfield_12314134": null,
        "duedate": null,
        "customfield_12314132": null,
        "customfield_12314131": null,
        "comment": {
            "comments": [
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13421133/comment/17479636",
                    "id": "17479636",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=paleolimbot",
                        "name": "paleolimbot",
                        "key": "paleolimbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=paleolimbot&avatarId=47795",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=paleolimbot&avatarId=47795",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=paleolimbot&avatarId=47795",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=paleolimbot&avatarId=47795"
                        },
                        "displayName": "Dewey Dunnington",
                        "active": true,
                        "timeZone": "America/Halifax"
                    },
                    "body": "Just collecting a few related code comments here:\r\n\r\n- https://github.com/apache/arrow/blob/03219e21b42f17294fba3b3d2b22a9117fe0f080/r/R/dataset-scan.R#L89\r\n- https://github.com/apache/arrow/blob/03219e21b42f17294fba3b3d2b22a9117fe0f080/r/R/query-engine.R#L23-L26\r\n- https://github.com/apache/arrow/blob/03219e21b42f17294fba3b3d2b22a9117fe0f080/r/R/dataset-scan.R#L184\r\n\r\nRelated is the ability to write files directly in a query plan using the {{WriteNode}} that was added in ARROW-13542. For example, there is a ticket open for using the {{WriteNode}} to write data sets (ARROW-14266). Writing files is useful but perhaps orthogonal to the ability to iterate over a {{RecordBatchReader}}, which is exemplified by the revamped {{map_batches()}} + vignette addition.",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=paleolimbot",
                        "name": "paleolimbot",
                        "key": "paleolimbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=paleolimbot&avatarId=47795",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=paleolimbot&avatarId=47795",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=paleolimbot&avatarId=47795",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=paleolimbot&avatarId=47795"
                        },
                        "displayName": "Dewey Dunnington",
                        "active": true,
                        "timeZone": "America/Halifax"
                    },
                    "created": "2022-01-20T19:41:38.235+0000",
                    "updated": "2022-01-20T19:41:38.235+0000"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13421133/comment/17484733",
                    "id": "17484733",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=paleolimbot",
                        "name": "paleolimbot",
                        "key": "paleolimbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=paleolimbot&avatarId=47795",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=paleolimbot&avatarId=47795",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=paleolimbot&avatarId=47795",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=paleolimbot&avatarId=47795"
                        },
                        "displayName": "Dewey Dunnington",
                        "active": true,
                        "timeZone": "America/Halifax"
                    },
                    "body": "Just connecting ARROW-15489, since an improved RecordBatchReader class will make this more useful!",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=paleolimbot",
                        "name": "paleolimbot",
                        "key": "paleolimbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=paleolimbot&avatarId=47795",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=paleolimbot&avatarId=47795",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=paleolimbot&avatarId=47795",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=paleolimbot&avatarId=47795"
                        },
                        "displayName": "Dewey Dunnington",
                        "active": true,
                        "timeZone": "America/Halifax"
                    },
                    "created": "2022-01-31T15:03:57.287+0000",
                    "updated": "2022-01-31T15:03:57.287+0000"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13421133/comment/17524462",
                    "id": "17524462",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=npr",
                        "name": "npr",
                        "key": "npr",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=34045",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34045",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34045",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34045"
                        },
                        "displayName": "Neal Richardson",
                        "active": true,
                        "timeZone": "America/Los_Angeles"
                    },
                    "body": "The underlying issue is that there are some operations that can't be fully supported with the current ExecPlan:\r\n\r\n* sorting on a temporary expression (e.g. {{arrange(ds, x * y)}}): you have to project with the expression in it, collect the sorted data, and then drop the derived column, but if you drop the column using {{select()}} and run it through the ExecPlan again, you lose your sorting because sorting currently only happens in the last step (SinkNode)\r\n* {{arrange %>% tail}}: it's implemented as a topK operation, so for {{head}} you get data in the right order, but for tail, it's done as reversing the sort and taking topK (i.e. there's no bottomK that returns in that order). So you have to re-sort the result. This could I guess be done with another ExecPlan that re-sorts, so that could yield a RBR, though awkwardly.\r\n* ARROW-14289: head.RecordBatchReader returns Table not RBR, seems easily fixable. Also would be nice if ExecPlan had a limit node, or the SinkNode took a limit, or something.\r\n\r\nI'm not sure what the performance impact would be in these cases if we were to compute into a Table, do whatever finishing steps, and push back into a RBR, which in most cases is just going to be pulled back into a Table in R. But maybe these are sufficiently uncommon scenarios that we shouldn't let them shape our API to the extent that they are.\r\n\r\nWe also would need to pass the R metadata into ExecPlan_run to attach to the output_schema in {{compute::MakeGeneratorReader}} because it does not appear that you can modify the schema of an RBR.\r\n\r\nP.S. I haven't checked whether there are open JIRAs for all of those ExecPlan issues but there probably should be.",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=npr",
                        "name": "npr",
                        "key": "npr",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=34045",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34045",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34045",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34045"
                        },
                        "displayName": "Neal Richardson",
                        "active": true,
                        "timeZone": "America/Los_Angeles"
                    },
                    "created": "2022-04-19T17:36:21.093+0000",
                    "updated": "2022-04-19T18:59:13.146+0000"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13421133/comment/17539131",
                    "id": "17539131",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=npr",
                        "name": "npr",
                        "key": "npr",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=34045",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34045",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34045",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34045"
                        },
                        "displayName": "Neal Richardson",
                        "active": true,
                        "timeZone": "America/Los_Angeles"
                    },
                    "body": "Issue resolved by pull request 13170\n[https://github.com/apache/arrow/pull/13170]",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=npr",
                        "name": "npr",
                        "key": "npr",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=34045",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34045",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34045",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34045"
                        },
                        "displayName": "Neal Richardson",
                        "active": true,
                        "timeZone": "America/Los_Angeles"
                    },
                    "created": "2022-05-18T23:27:32.397+0000",
                    "updated": "2022-05-18T23:27:32.397+0000"
                }
            ],
            "maxResults": 4,
            "total": 4,
            "startAt": 0
        },
        "customfield_12311820": "0|z0ybnc:",
        "customfield_12314139": null
    }
}