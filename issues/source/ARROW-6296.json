{
    "expand": "operations,versionedRepresentations,editmeta,changelog,renderedFields",
    "id": "13251776",
    "self": "https://issues.apache.org/jira/rest/api/2/issue/13251776",
    "key": "ARROW-6296",
    "fields": {
        "fixVersions": [
            {
                "self": "https://issues.apache.org/jira/rest/api/2/version/12345978",
                "id": "12345978",
                "description": "",
                "name": "0.15.0",
                "archived": false,
                "released": true,
                "releaseDate": "2019-10-05"
            }
        ],
        "resolution": {
            "self": "https://issues.apache.org/jira/rest/api/2/resolution/1",
            "id": "1",
            "description": "A fix for this issue is checked into the tree and tested.",
            "name": "Fixed"
        },
        "customfield_12312322": null,
        "customfield_12312323": null,
        "customfield_12312320": null,
        "customfield_12310420": "9223372036854775807",
        "customfield_12312321": null,
        "customfield_12312328": null,
        "customfield_12312329": null,
        "customfield_12312326": null,
        "customfield_12310300": null,
        "customfield_12312327": null,
        "customfield_12312324": null,
        "customfield_12312720": null,
        "customfield_12312325": null,
        "lastViewed": null,
        "priority": {
            "self": "https://issues.apache.org/jira/rest/api/2/priority/3",
            "iconUrl": "https://issues.apache.org/jira/images/icons/priorities/major.svg",
            "name": "Major",
            "id": "3"
        },
        "labels": [
            "pull-request-available"
        ],
        "customfield_12312333": null,
        "customfield_12312334": null,
        "customfield_12313422": "false",
        "customfield_12310310": "0.0",
        "customfield_12312331": null,
        "customfield_12312332": null,
        "aggregatetimeoriginalestimate": null,
        "timeestimate": 0,
        "customfield_12312330": null,
        "versions": [],
        "customfield_12311120": null,
        "customfield_12313826": null,
        "customfield_12312339": null,
        "issuelinks": [],
        "customfield_12313825": null,
        "assignee": {
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=tianchen92",
            "name": "tianchen92",
            "key": "tianchen92",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=tianchen92&avatarId=40800",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tianchen92&avatarId=40800",
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tianchen92&avatarId=40800",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tianchen92&avatarId=40800"
            },
            "displayName": "Ji Liu",
            "active": true,
            "timeZone": "Asia/Gaza"
        },
        "customfield_12312337": null,
        "customfield_12313823": null,
        "customfield_12312338": null,
        "customfield_12311920": null,
        "customfield_12313822": null,
        "customfield_12312335": null,
        "customfield_12313821": null,
        "customfield_12312336": null,
        "customfield_12313820": null,
        "status": {
            "self": "https://issues.apache.org/jira/rest/api/2/status/5",
            "description": "A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.",
            "iconUrl": "https://issues.apache.org/jira/images/icons/statuses/resolved.png",
            "name": "Resolved",
            "id": "5",
            "statusCategory": {
                "self": "https://issues.apache.org/jira/rest/api/2/statuscategory/3",
                "id": 3,
                "key": "done",
                "colorName": "green",
                "name": "Done"
            }
        },
        "components": [
            {
                "self": "https://issues.apache.org/jira/rest/api/2/component/12328933",
                "id": "12328933",
                "name": "Java"
            }
        ],
        "customfield_12312026": null,
        "customfield_12312023": null,
        "customfield_12312024": null,
        "aggregatetimeestimate": 0,
        "customfield_12312022": null,
        "customfield_12310921": null,
        "customfield_12310920": "9223372036854775807",
        "customfield_12312823": null,
        "creator": {
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=emkornfield%40gmail.com",
            "name": "emkornfield@gmail.com",
            "key": "emkornfield@gmail.com",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
            },
            "displayName": "Micah Kornfield",
            "active": true,
            "timeZone": "Etc/UTC"
        },
        "subtasks": [],
        "reporter": {
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=emkornfield%40gmail.com",
            "name": "emkornfield@gmail.com",
            "key": "emkornfield@gmail.com",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
            },
            "displayName": "Micah Kornfield",
            "active": true,
            "timeZone": "Etc/UTC"
        },
        "aggregateprogress": {
            "progress": 17400,
            "total": 17400,
            "percent": 100
        },
        "customfield_12313520": null,
        "customfield_12310250": null,
        "progress": {
            "progress": 17400,
            "total": 17400,
            "percent": 100
        },
        "customfield_12313924": null,
        "votes": {
            "self": "https://issues.apache.org/jira/rest/api/2/issue/ARROW-6296/votes",
            "votes": 0,
            "hasVoted": false
        },
        "worklog": {
            "startAt": 0,
            "maxResults": 20,
            "total": 33,
            "worklogs": [
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13251776/worklog/298560",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "tianchen92 commented on pull request #5152: ARROW-6296: [Java] Cleanup JDBC interfaces and eliminate one memcopy for binary/varchar fields\nURL: https://github.com/apache/arrow/pull/5152\n \n \n   Related to [ARROW-6296](https://issues.apache.org/jira/browse/ARROW-6296).\r\n   i. If we use direct setting of fields, we can avoid the extra temporary buffer and memcpy by setting bytes directly.\r\n   ii. We should overwrite existing vectors in consumers before returning results, to avoid the possibility of closing vectors in use (or alternatively make sure we retain the underlying buffers).\r\n   iii. Try to eliminate some of the state in load() by moving initialization to the constructor.\n \n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2019-08-21T09:53:34.538+0000",
                    "updated": "2019-08-21T09:53:34.538+0000",
                    "started": "2019-08-21T09:53:34.537+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "298560",
                    "issueId": "13251776"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13251776/worklog/298561",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "tianchen92 commented on issue #5152: ARROW-6296: [Java] Cleanup JDBC interfaces and eliminate one memcopy for binary/varchar fields\nURL: https://github.com/apache/arrow/pull/5152#issuecomment-523386432\n \n \n   cc @emkornfield \n \n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2019-08-21T09:54:10.568+0000",
                    "updated": "2019-08-21T09:54:10.568+0000",
                    "started": "2019-08-21T09:54:10.567+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "298561",
                    "issueId": "13251776"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13251776/worklog/300679",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "codecov-io commented on issue #5152: ARROW-6296: [Java] Cleanup JDBC interfaces and eliminate one memcopy for binary/varchar fields\nURL: https://github.com/apache/arrow/pull/5152#issuecomment-524525100\n \n \n   # [Codecov](https://codecov.io/gh/apache/arrow/pull/5152?src=pr&el=h1) Report\n   > :exclamation: No coverage uploaded for pull request base (`master@94ba10b`). [Click here to learn what that means](https://docs.codecov.io/docs/error-reference#section-missing-base-commit).\n   > The diff coverage is `n/a`.\n   \n   [![Impacted file tree graph](https://codecov.io/gh/apache/arrow/pull/5152/graphs/tree.svg?width=650&token=LpTCFbqVT1&height=150&src=pr)](https://codecov.io/gh/apache/arrow/pull/5152?src=pr&el=tree)\n   \n   ```diff\n   @@            Coverage Diff            @@\n   ##             master    #5152   +/-   ##\n   =========================================\n     Coverage          ?   89.76%           \n   =========================================\n     Files             ?      682           \n     Lines             ?   101904           \n     Branches          ?        0           \n   =========================================\n     Hits              ?    91471           \n     Misses            ?    10433           \n     Partials          ?        0\n   ```\n   \n   \n   \n   ------\n   \n   [Continue to review full report at Codecov](https://codecov.io/gh/apache/arrow/pull/5152?src=pr&el=continue).\n   > **Legend** - [Click here to learn more](https://docs.codecov.io/docs/codecov-delta)\n   > `\u0394 = absolute <relative> (impact)`, `\u00f8 = not affected`, `? = missing data`\n   > Powered by [Codecov](https://codecov.io/gh/apache/arrow/pull/5152?src=pr&el=footer). Last update [94ba10b...e6bd999](https://codecov.io/gh/apache/arrow/pull/5152?src=pr&el=lastupdated). Read the [comment docs](https://docs.codecov.io/docs/pull-request-comments).\n   \n \n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2019-08-24T06:25:59.558+0000",
                    "updated": "2019-08-24T06:25:59.558+0000",
                    "started": "2019-08-24T06:25:59.557+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "300679",
                    "issueId": "13251776"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13251776/worklog/302581",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "emkornfield commented on pull request #5152: ARROW-6296: [Java] Cleanup JDBC interfaces and eliminate one memcopy for binary/varchar fields\nURL: https://github.com/apache/arrow/pull/5152#discussion_r316973309\n \n \n\n ##########\n File path: java/adapter/jdbc/src/main/java/org/apache/arrow/adapter/jdbc/JdbcToArrowUtils.java\n ##########\n @@ -360,13 +360,20 @@ public static void jdbcToArrowVectors(ResultSet rs, VectorSchemaRoot root, JdbcT\n           root.getVector(rsmd.getColumnName(i)), config);\n     }\n \n-    try (CompositeJdbcConsumer compositeConsumer = new CompositeJdbcConsumer(consumers)) {\n+    CompositeJdbcConsumer compositeConsumer = null;\n+    try {\n \n Review comment:\n   using try-with-resources seems cleaner to me, why this change?\n \n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2019-08-28T06:55:04.404+0000",
                    "updated": "2019-08-28T06:55:04.404+0000",
                    "started": "2019-08-28T06:55:04.404+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "302581",
                    "issueId": "13251776"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13251776/worklog/302582",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "emkornfield commented on pull request #5152: ARROW-6296: [Java] Cleanup JDBC interfaces and eliminate one memcopy for binary/varchar fields\nURL: https://github.com/apache/arrow/pull/5152#discussion_r316973379\n \n \n\n ##########\n File path: java/adapter/jdbc/src/main/java/org/apache/arrow/adapter/jdbc/ArrowVectorIterator.java\n ##########\n @@ -119,6 +110,26 @@ private void load() throws IOException, SQLException {\n       compositeConsumer.close();\n       throw new RuntimeException(\"Error occurs while consuming data.\", e);\n     }\n+  }\n+\n+  // Loads the next schema root or null if no more rows are available.\n+  private void load() throws SQLException {\n+    VectorSchemaRoot root = null;\n+    try {\n+      root = VectorSchemaRoot.create(schema, config.getAllocator());\n+      JdbcToArrowUtils.allocateVectors(root, JdbcToArrowUtils.DEFAULT_BUFFER_SIZE);\n+    } catch (Exception e) {\n+      if (root != null) {\n+        root.close();\n+      }\n+      throw new RuntimeException(\"Error occurs while creating schema root.\", e);\n \n Review comment:\n   ```suggestion\r\n         throw new RuntimeException(\"Error occured while creating schema root.\", e);\r\n   ```\n \n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2019-08-28T06:55:04.774+0000",
                    "updated": "2019-08-28T06:55:04.774+0000",
                    "started": "2019-08-28T06:55:04.773+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "302582",
                    "issueId": "13251776"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13251776/worklog/302583",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "emkornfield commented on pull request #5152: ARROW-6296: [Java] Cleanup JDBC interfaces and eliminate one memcopy for binary/varchar fields\nURL: https://github.com/apache/arrow/pull/5152#discussion_r316973563\n \n \n\n ##########\n File path: java/adapter/jdbc/src/main/java/org/apache/arrow/adapter/jdbc/consumer/ClobConsumer.java\n ##########\n @@ -38,58 +38,57 @@\n   private static final int BUFFER_SIZE = 256;\n \n   private VarCharWriter writer;\n+  private VarCharVector vector;\n   private final int columnIndexInResultSet;\n-  private BufferAllocator allocator;\n-\n-  private ArrowBuf reuse;\n \n   /**\n    * Instantiate a ClobConsumer.\n    */\n   public ClobConsumer(VarCharVector vector, int index) {\n+    this.vector = vector;\n     this.writer = new VarCharWriterImpl(vector);\n     this.columnIndexInResultSet = index;\n-\n-    this.allocator = vector.getAllocator();\n-    reuse = allocator.buffer(1024);\n   }\n \n   @Override\n   public void consume(ResultSet resultSet) throws SQLException {\n     Clob clob = resultSet.getClob(columnIndexInResultSet);\n+    int idx = writer.getPosition();\n     if (!resultSet.wasNull()) {\n       if (clob != null) {\n         long length = clob.length();\n-        if (length > reuse.capacity()) {\n-          reuse.close();\n-          reuse = allocator.buffer((int) length);\n-        }\n \n         int read = 1;\n         int readSize = length < BUFFER_SIZE ? (int) length : BUFFER_SIZE;\n         int totalBytes = 0;\n+\n+        ArrowBuf dataBuffer = vector.getDataBuffer();\n+        ArrowBuf offsetBuffer = vector.getOffsetBuffer();\n+        int startIndex = offsetBuffer.getInt(idx * 4);\n         while (read <= length) {\n           String str = clob.getSubString(read, readSize);\n           byte[] bytes = str.getBytes(StandardCharsets.UTF_8);\n-          reuse.setBytes(totalBytes, bytes, 0, bytes.length);\n+\n+          dataBuffer.setBytes(startIndex + totalBytes, bytes);\n           totalBytes += bytes.length;\n           read += readSize;\n         }\n-        writer.writeVarChar(0, totalBytes, reuse);\n+        offsetBuffer.setInt((idx + 1) * 4, startIndex + totalBytes);\n+        BitVectorHelper.setValidityBitToOne(vector.getValidityBuffer(), idx);\n+        vector.setLastSet(idx);\n       }\n     }\n     writer.setPosition(writer.getPosition() + 1);\n \n Review comment:\n   can probably get rid of the writer?\n \n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2019-08-28T06:55:04.996+0000",
                    "updated": "2019-08-28T06:55:04.996+0000",
                    "started": "2019-08-28T06:55:04.995+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "302583",
                    "issueId": "13251776"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13251776/worklog/302584",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "emkornfield commented on pull request #5152: ARROW-6296: [Java] Cleanup JDBC interfaces and eliminate one memcopy for binary/varchar fields\nURL: https://github.com/apache/arrow/pull/5152#discussion_r316974041\n \n \n\n ##########\n File path: java/adapter/jdbc/src/main/java/org/apache/arrow/adapter/jdbc/ArrowVectorIterator.java\n ##########\n @@ -119,6 +110,26 @@ private void load() throws IOException, SQLException {\n       compositeConsumer.close();\n       throw new RuntimeException(\"Error occurs while consuming data.\", e);\n     }\n+  }\n+\n+  // Loads the next schema root or null if no more rows are available.\n+  private void load() throws SQLException {\n+    VectorSchemaRoot root = null;\n \n Review comment:\n   put VectorSchemaRoot initialization into another private method\n \n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2019-08-28T06:55:05.000+0000",
                    "updated": "2019-08-28T06:55:05.000+0000",
                    "started": "2019-08-28T06:55:04.999+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "302584",
                    "issueId": "13251776"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13251776/worklog/302585",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "emkornfield commented on pull request #5152: ARROW-6296: [Java] Cleanup JDBC interfaces and eliminate one memcopy for binary/varchar fields\nURL: https://github.com/apache/arrow/pull/5152#discussion_r316973852\n \n \n\n ##########\n File path: java/adapter/jdbc/src/main/java/org/apache/arrow/adapter/jdbc/consumer/VarCharConsumer.java\n ##########\n @@ -36,46 +33,37 @@\n \n   private VarCharWriter writer;\n   private final int columnIndexInResultSet;\n-  private BufferAllocator allocator;\n \n-  private ArrowBuf reuse;\n+  private VarCharVector vector;\n \n   /**\n    * Instantiate a VarCharConsumer.\n    */\n   public VarCharConsumer(VarCharVector vector, int index) {\n+    this.vector = vector;\n     this.writer = new VarCharWriterImpl(vector);\n     this.columnIndexInResultSet = index;\n-    this.allocator = vector.getAllocator();\n   }\n \n   @Override\n   public void consume(ResultSet resultSet) throws SQLException {\n     String value = resultSet.getString(columnIndexInResultSet);\n     if (!resultSet.wasNull()) {\n       byte[] bytes = value.getBytes(StandardCharsets.UTF_8);\n-      if (reuse == null) {\n-        reuse = allocator.buffer(bytes.length);\n-      }\n-      if (bytes.length > reuse.capacity()) {\n-        reuse.close();\n-        reuse = allocator.buffer(bytes.length);\n-      }\n-      reuse.setBytes(0, bytes, 0, bytes.length);\n-      writer.writeVarChar(0, bytes.length, reuse);\n+\n+      vector.set(writer.getPosition(), bytes);\n \n Review comment:\n   can probably elimintate writer?\n \n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2019-08-28T06:55:05.010+0000",
                    "updated": "2019-08-28T06:55:05.010+0000",
                    "started": "2019-08-28T06:55:05.010+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "302585",
                    "issueId": "13251776"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13251776/worklog/302586",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "emkornfield commented on pull request #5152: ARROW-6296: [Java] Cleanup JDBC interfaces and eliminate one memcopy for binary/varchar fields\nURL: https://github.com/apache/arrow/pull/5152#discussion_r316974359\n \n \n\n ##########\n File path: java/adapter/jdbc/src/main/java/org/apache/arrow/adapter/jdbc/JdbcToArrowUtils.java\n ##########\n @@ -360,13 +360,20 @@ public static void jdbcToArrowVectors(ResultSet rs, VectorSchemaRoot root, JdbcT\n           root.getVector(rsmd.getColumnName(i)), config);\n     }\n \n-    try (CompositeJdbcConsumer compositeConsumer = new CompositeJdbcConsumer(consumers)) {\n+    CompositeJdbcConsumer compositeConsumer = null;\n+    try {\n \n Review comment:\n   Ah I see, so you only close on error.  I think it would be cleaner to call reset or something similar on the composite consumer atthe end of the try block and comment why you are doing it.\n \n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2019-08-28T06:55:05.016+0000",
                    "updated": "2019-08-28T06:55:05.016+0000",
                    "started": "2019-08-28T06:55:05.016+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "302586",
                    "issueId": "13251776"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13251776/worklog/302587",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "emkornfield commented on pull request #5152: ARROW-6296: [Java] Cleanup JDBC interfaces and eliminate one memcopy for binary/varchar fields\nURL: https://github.com/apache/arrow/pull/5152#discussion_r316975398\n \n \n\n ##########\n File path: java/adapter/jdbc/src/main/java/org/apache/arrow/adapter/jdbc/ArrowVectorIterator.java\n ##########\n @@ -62,6 +60,23 @@ private ArrowVectorIterator(ResultSet resultSet, JdbcToArrowConfig config) throw\n     this.compositeConsumer = new CompositeJdbcConsumer(consumers);\n   }\n \n+  private void initialize() throws SQLException {\n+    try {\n+      nextBatch = VectorSchemaRoot.create(schema, config.getAllocator());\n+      JdbcToArrowUtils.allocateVectors(nextBatch, JdbcToArrowUtils.DEFAULT_BUFFER_SIZE);\n+    } catch (Exception e) {\n+      close();\n+      throw new RuntimeException(\"Error occurs while initializing.\", e);\n+    }\n+\n+    for (int i = 1; i <= consumers.length; i++) {\n+      consumers[i - 1] = JdbcToArrowUtils.getConsumer(resultSet, i, resultSet.getMetaData().getColumnType(i),\n \n Review comment:\n   I think if you didn't pass the vector here you could factor out initialization from the initialization of VectorSchemaRoot and just call load after consumers are constructed.\n \n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2019-08-28T06:55:05.093+0000",
                    "updated": "2019-08-28T06:55:05.093+0000",
                    "started": "2019-08-28T06:55:05.093+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "302587",
                    "issueId": "13251776"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13251776/worklog/302588",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "emkornfield commented on pull request #5152: ARROW-6296: [Java] Cleanup JDBC interfaces and eliminate one memcopy for binary/varchar fields\nURL: https://github.com/apache/arrow/pull/5152#discussion_r316976057\n \n \n\n ##########\n File path: java/adapter/jdbc/src/main/java/org/apache/arrow/adapter/jdbc/consumer/CompositeJdbcConsumer.java\n ##########\n @@ -47,10 +47,15 @@ public void consume(ResultSet rs) throws SQLException, IOException {\n \n   @Override\n   public void close() {\n-    // clean up\n-    for (JdbcConsumer consumer : consumers) {\n-      consumer.close();\n+    try {\n \n Review comment:\n   use AutoCloseables\n \n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2019-08-28T06:55:05.096+0000",
                    "updated": "2019-08-28T06:55:05.096+0000",
                    "started": "2019-08-28T06:55:05.096+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "302588",
                    "issueId": "13251776"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13251776/worklog/302703",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "tianchen92 commented on pull request #5152: ARROW-6296: [Java] Cleanup JDBC interfaces and eliminate one memcopy for binary/varchar fields\nURL: https://github.com/apache/arrow/pull/5152#discussion_r318477064\n \n \n\n ##########\n File path: java/adapter/jdbc/src/main/java/org/apache/arrow/adapter/jdbc/consumer/ClobConsumer.java\n ##########\n @@ -38,58 +38,57 @@\n   private static final int BUFFER_SIZE = 256;\n \n   private VarCharWriter writer;\n+  private VarCharVector vector;\n   private final int columnIndexInResultSet;\n-  private BufferAllocator allocator;\n-\n-  private ArrowBuf reuse;\n \n   /**\n    * Instantiate a ClobConsumer.\n    */\n   public ClobConsumer(VarCharVector vector, int index) {\n+    this.vector = vector;\n     this.writer = new VarCharWriterImpl(vector);\n     this.columnIndexInResultSet = index;\n-\n-    this.allocator = vector.getAllocator();\n-    reuse = allocator.buffer(1024);\n   }\n \n   @Override\n   public void consume(ResultSet resultSet) throws SQLException {\n     Clob clob = resultSet.getClob(columnIndexInResultSet);\n+    int idx = writer.getPosition();\n     if (!resultSet.wasNull()) {\n       if (clob != null) {\n         long length = clob.length();\n-        if (length > reuse.capacity()) {\n-          reuse.close();\n-          reuse = allocator.buffer((int) length);\n-        }\n \n         int read = 1;\n         int readSize = length < BUFFER_SIZE ? (int) length : BUFFER_SIZE;\n         int totalBytes = 0;\n+\n+        ArrowBuf dataBuffer = vector.getDataBuffer();\n+        ArrowBuf offsetBuffer = vector.getOffsetBuffer();\n+        int startIndex = offsetBuffer.getInt(idx * 4);\n         while (read <= length) {\n           String str = clob.getSubString(read, readSize);\n           byte[] bytes = str.getBytes(StandardCharsets.UTF_8);\n-          reuse.setBytes(totalBytes, bytes, 0, bytes.length);\n+\n+          dataBuffer.setBytes(startIndex + totalBytes, bytes);\n           totalBytes += bytes.length;\n           read += readSize;\n         }\n-        writer.writeVarChar(0, totalBytes, reuse);\n+        offsetBuffer.setInt((idx + 1) * 4, startIndex + totalBytes);\n+        BitVectorHelper.setValidityBitToOne(vector.getValidityBuffer(), idx);\n+        vector.setLastSet(idx);\n       }\n     }\n     writer.setPosition(writer.getPosition() + 1);\n \n Review comment:\n   I believe the code is outdated since I have removed writer already.\n \n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2019-08-28T09:18:32.325+0000",
                    "updated": "2019-08-28T09:18:32.325+0000",
                    "started": "2019-08-28T09:18:32.325+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "302703",
                    "issueId": "13251776"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13251776/worklog/302728",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "tianchen92 commented on pull request #5152: ARROW-6296: [Java] Cleanup JDBC interfaces and eliminate one memcopy for binary/varchar fields\nURL: https://github.com/apache/arrow/pull/5152#discussion_r318497920\n \n \n\n ##########\n File path: java/adapter/jdbc/src/main/java/org/apache/arrow/adapter/jdbc/JdbcToArrowUtils.java\n ##########\n @@ -360,13 +360,20 @@ public static void jdbcToArrowVectors(ResultSet rs, VectorSchemaRoot root, JdbcT\n           root.getVector(rsmd.getColumnName(i)), config);\n     }\n \n-    try (CompositeJdbcConsumer compositeConsumer = new CompositeJdbcConsumer(consumers)) {\n+    CompositeJdbcConsumer compositeConsumer = null;\n+    try {\n \n Review comment:\n   Added some comments for why only clean resource on error.  resetVector is called in load() and unnecessary to invoke here?\n \n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2019-08-28T10:06:46.390+0000",
                    "updated": "2019-08-28T10:06:46.390+0000",
                    "started": "2019-08-28T10:06:46.390+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "302728",
                    "issueId": "13251776"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13251776/worklog/302729",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "tianchen92 commented on pull request #5152: ARROW-6296: [Java] Cleanup JDBC interfaces and eliminate one memcopy for binary/varchar fields\nURL: https://github.com/apache/arrow/pull/5152#discussion_r318498083\n \n \n\n ##########\n File path: java/adapter/jdbc/src/main/java/org/apache/arrow/adapter/jdbc/consumer/VarCharConsumer.java\n ##########\n @@ -36,46 +33,37 @@\n \n   private VarCharWriter writer;\n   private final int columnIndexInResultSet;\n-  private BufferAllocator allocator;\n \n-  private ArrowBuf reuse;\n+  private VarCharVector vector;\n \n   /**\n    * Instantiate a VarCharConsumer.\n    */\n   public VarCharConsumer(VarCharVector vector, int index) {\n+    this.vector = vector;\n     this.writer = new VarCharWriterImpl(vector);\n     this.columnIndexInResultSet = index;\n-    this.allocator = vector.getAllocator();\n   }\n \n   @Override\n   public void consume(ResultSet resultSet) throws SQLException {\n     String value = resultSet.getString(columnIndexInResultSet);\n     if (!resultSet.wasNull()) {\n       byte[] bytes = value.getBytes(StandardCharsets.UTF_8);\n-      if (reuse == null) {\n-        reuse = allocator.buffer(bytes.length);\n-      }\n-      if (bytes.length > reuse.capacity()) {\n-        reuse.close();\n-        reuse = allocator.buffer(bytes.length);\n-      }\n-      reuse.setBytes(0, bytes, 0, bytes.length);\n-      writer.writeVarChar(0, bytes.length, reuse);\n+\n+      vector.set(writer.getPosition(), bytes);\n \n Review comment:\n   I believe the code is outdated since I have removed writer already.\n \n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2019-08-28T10:07:09.067+0000",
                    "updated": "2019-08-28T10:07:09.067+0000",
                    "started": "2019-08-28T10:07:09.065+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "302729",
                    "issueId": "13251776"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13251776/worklog/302730",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "tianchen92 commented on pull request #5152: ARROW-6296: [Java] Cleanup JDBC interfaces and eliminate one memcopy for binary/varchar fields\nURL: https://github.com/apache/arrow/pull/5152#discussion_r318498461\n \n \n\n ##########\n File path: java/adapter/jdbc/src/main/java/org/apache/arrow/adapter/jdbc/ArrowVectorIterator.java\n ##########\n @@ -119,6 +110,26 @@ private void load() throws IOException, SQLException {\n       compositeConsumer.close();\n       throw new RuntimeException(\"Error occurs while consuming data.\", e);\n     }\n+  }\n+\n+  // Loads the next schema root or null if no more rows are available.\n+  private void load() throws SQLException {\n+    VectorSchemaRoot root = null;\n \n Review comment:\n   Thanks, fixed.\n \n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2019-08-28T10:07:49.926+0000",
                    "updated": "2019-08-28T10:07:49.926+0000",
                    "started": "2019-08-28T10:07:49.926+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "302730",
                    "issueId": "13251776"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13251776/worklog/302731",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "tianchen92 commented on pull request #5152: ARROW-6296: [Java] Cleanup JDBC interfaces and eliminate one memcopy for binary/varchar fields\nURL: https://github.com/apache/arrow/pull/5152#discussion_r318498516\n \n \n\n ##########\n File path: java/adapter/jdbc/src/main/java/org/apache/arrow/adapter/jdbc/consumer/CompositeJdbcConsumer.java\n ##########\n @@ -47,10 +47,15 @@ public void consume(ResultSet rs) throws SQLException, IOException {\n \n   @Override\n   public void close() {\n-    // clean up\n-    for (JdbcConsumer consumer : consumers) {\n-      consumer.close();\n+    try {\n \n Review comment:\n   fixed.\n \n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2019-08-28T10:07:58.365+0000",
                    "updated": "2019-08-28T10:07:58.365+0000",
                    "started": "2019-08-28T10:07:58.365+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "302731",
                    "issueId": "13251776"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13251776/worklog/302732",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "tianchen92 commented on pull request #5152: ARROW-6296: [Java] Cleanup JDBC interfaces and eliminate one memcopy for binary/varchar fields\nURL: https://github.com/apache/arrow/pull/5152#discussion_r318498764\n \n \n\n ##########\n File path: java/adapter/jdbc/src/main/java/org/apache/arrow/adapter/jdbc/ArrowVectorIterator.java\n ##########\n @@ -62,6 +60,23 @@ private ArrowVectorIterator(ResultSet resultSet, JdbcToArrowConfig config) throw\n     this.compositeConsumer = new CompositeJdbcConsumer(consumers);\n   }\n \n+  private void initialize() throws SQLException {\n+    try {\n+      nextBatch = VectorSchemaRoot.create(schema, config.getAllocator());\n+      JdbcToArrowUtils.allocateVectors(nextBatch, JdbcToArrowUtils.DEFAULT_BUFFER_SIZE);\n+    } catch (Exception e) {\n+      close();\n+      throw new RuntimeException(\"Error occurs while initializing.\", e);\n+    }\n+\n+    for (int i = 1; i <= consumers.length; i++) {\n+      consumers[i - 1] = JdbcToArrowUtils.getConsumer(resultSet, i, resultSet.getMetaData().getColumnType(i),\n \n Review comment:\n   Sounds good, looks cleaner, fixed.\n \n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2019-08-28T10:08:33.844+0000",
                    "updated": "2019-08-28T10:08:33.844+0000",
                    "started": "2019-08-28T10:08:33.843+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "302732",
                    "issueId": "13251776"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13251776/worklog/302923",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "tianchen92 commented on pull request #5152: ARROW-6296: [Java] Cleanup JDBC interfaces and eliminate one memcopy for binary/varchar fields\nURL: https://github.com/apache/arrow/pull/5152\n \n \n   \n \n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2019-08-28T14:44:00.627+0000",
                    "updated": "2019-08-28T14:44:00.627+0000",
                    "started": "2019-08-28T14:44:00.626+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "302923",
                    "issueId": "13251776"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13251776/worklog/302924",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "tianchen92 commented on pull request #5152: ARROW-6296: [Java] Cleanup JDBC interfaces and eliminate one memcopy for binary/varchar fields\nURL: https://github.com/apache/arrow/pull/5152\n \n \n   Related to [ARROW-6296](https://issues.apache.org/jira/browse/ARROW-6296).\r\n   i. If we use direct setting of fields, we can avoid the extra temporary buffer and memcpy by setting bytes directly.\r\n   ii. We should overwrite existing vectors in consumers before returning results, to avoid the possibility of closing vectors in use (or alternatively make sure we retain the underlying buffers).\r\n   iii. Try to eliminate some of the state in load() by moving initialization to the constructor.\n \n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2019-08-28T14:44:03.027+0000",
                    "updated": "2019-08-28T14:44:03.027+0000",
                    "started": "2019-08-28T14:44:03.027+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "302924",
                    "issueId": "13251776"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13251776/worklog/303345",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "tianchen92 commented on issue #5152: ARROW-6296: [Java] Cleanup JDBC interfaces and eliminate one memcopy for binary/varchar fields\nURL: https://github.com/apache/arrow/pull/5152#issuecomment-526009976\n \n \n   @emkornfield PR updated, please help take a look, thanks!\n \n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2019-08-29T03:52:39.349+0000",
                    "updated": "2019-08-29T03:52:39.349+0000",
                    "started": "2019-08-29T03:52:39.348+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "303345",
                    "issueId": "13251776"
                }
            ]
        },
        "customfield_12313920": null,
        "issuetype": {
            "self": "https://issues.apache.org/jira/rest/api/2/issuetype/4",
            "id": "4",
            "description": "An improvement or enhancement to an existing feature or task.",
            "iconUrl": "https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21140&avatarType=issuetype",
            "name": "Improvement",
            "subtask": false,
            "avatarId": 21140
        },
        "timespent": 17400,
        "customfield_12314020": "{summaryBean=com.atlassian.jira.plugin.devstatus.rest.SummaryBean@222a8710[summary={pullrequest=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@4325ff2b[overall=PullRequestOverallBean{stateCount=0, state='OPEN', details=PullRequestOverallDetails{openCount=0, mergedCount=0, declinedCount=0}},byInstanceType={}], build=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@75a6e21[overall=com.atlassian.jira.plugin.devstatus.summary.beans.BuildOverallBean@6bea1546[failedBuildCount=0,successfulBuildCount=0,unknownBuildCount=0,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], review=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@7ee3fff0[overall=com.atlassian.jira.plugin.devstatus.summary.beans.ReviewsOverallBean@7cf78bc0[stateCount=0,state=<null>,dueDate=<null>,overDue=false,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], deployment-environment=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@2808c919[overall=com.atlassian.jira.plugin.devstatus.summary.beans.DeploymentOverallBean@1373b97b[topEnvironments=[],showProjects=false,successfulCount=0,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], repository=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@728ec89a[overall=com.atlassian.jira.plugin.devstatus.summary.beans.CommitOverallBean@32e7e480[count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], branch=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@5c49b3c4[overall=com.atlassian.jira.plugin.devstatus.summary.beans.BranchOverallBean@52ff6157[count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}]},errors=[],configErrors=[]], devSummaryJson={\"cachedValue\":{\"errors\":[],\"configErrors\":[],\"summary\":{\"pullrequest\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"stateCount\":0,\"state\":\"OPEN\",\"details\":{\"openCount\":0,\"mergedCount\":0,\"declinedCount\":0,\"total\":0},\"open\":true},\"byInstanceType\":{}},\"build\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"failedBuildCount\":0,\"successfulBuildCount\":0,\"unknownBuildCount\":0},\"byInstanceType\":{}},\"review\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"stateCount\":0,\"state\":null,\"dueDate\":null,\"overDue\":false,\"completed\":false},\"byInstanceType\":{}},\"deployment-environment\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"topEnvironments\":[],\"showProjects\":false,\"successfulCount\":0},\"byInstanceType\":{}},\"repository\":{\"overall\":{\"count\":0,\"lastUpdated\":null},\"byInstanceType\":{}},\"branch\":{\"overall\":{\"count\":0,\"lastUpdated\":null},\"byInstanceType\":{}}}},\"isStale\":false}}",
        "customfield_12314141": null,
        "customfield_12314140": null,
        "project": {
            "self": "https://issues.apache.org/jira/rest/api/2/project/12319525",
            "id": "12319525",
            "key": "ARROW",
            "name": "Apache Arrow",
            "projectTypeKey": "software",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/projectavatar?pid=12319525&avatarId=10011",
                "24x24": "https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12319525&avatarId=10011",
                "16x16": "https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12319525&avatarId=10011",
                "32x32": "https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12319525&avatarId=10011"
            },
            "projectCategory": {
                "self": "https://issues.apache.org/jira/rest/api/2/projectCategory/13960",
                "id": "13960",
                "description": "Apache Arrow",
                "name": "Arrow"
            }
        },
        "aggregatetimespent": 17400,
        "customfield_12312520": null,
        "customfield_12312521": "Wed Sep 04 07:24:42 UTC 2019",
        "customfield_12314422": null,
        "customfield_12314421": null,
        "customfield_12314146": null,
        "customfield_12314420": null,
        "customfield_12314145": null,
        "customfield_12314144": null,
        "customfield_12314143": null,
        "resolutiondate": "2019-09-04T07:24:42.000+0000",
        "workratio": -1,
        "customfield_12312923": null,
        "customfield_12312920": null,
        "customfield_12312921": null,
        "watches": {
            "self": "https://issues.apache.org/jira/rest/api/2/issue/ARROW-6296/watchers",
            "watchCount": 2,
            "isWatching": false
        },
        "created": "2019-08-20T08:21:36.000+0000",
        "updated": "2019-09-04T07:24:42.000+0000",
        "timeoriginalestimate": null,
        "description": "* If we use direct setting of fields, we can avoid the extra temporary buffer and memcpy by setting bytes directly.\r\n * We should overwrite existing vectors in consumers before returning results, to avoid the possibility of closing vectors in use (or alternatively make sure we retain the underlying buffers).\r\n * Try to eliminate some of the state in load() by moving initialization to the constructor.",
        "customfield_10010": null,
        "timetracking": {
            "remainingEstimate": "0h",
            "timeSpent": "4h 50m",
            "remainingEstimateSeconds": 0,
            "timeSpentSeconds": 17400
        },
        "customfield_12314523": null,
        "customfield_12314127": null,
        "customfield_12314522": null,
        "customfield_12314126": null,
        "customfield_12314521": null,
        "customfield_12314125": null,
        "customfield_12314520": null,
        "customfield_12314124": null,
        "attachment": [],
        "customfield_12312340": null,
        "customfield_12314123": null,
        "customfield_12312341": null,
        "customfield_12312220": null,
        "customfield_12314122": null,
        "customfield_12314121": null,
        "customfield_12314120": null,
        "customfield_12314129": null,
        "customfield_12314524": null,
        "customfield_12314128": null,
        "summary": "[Java] Cleanup JDBC interfaces and eliminate one memcopy for binary/varchar fields",
        "customfield_12314130": null,
        "customfield_12310291": null,
        "customfield_12310290": null,
        "customfield_12314138": null,
        "customfield_12314137": null,
        "environment": null,
        "customfield_12314136": null,
        "customfield_12314135": null,
        "customfield_12311020": null,
        "customfield_12314134": null,
        "duedate": null,
        "customfield_12314132": null,
        "customfield_12314131": null,
        "comment": {
            "comments": [
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13251776/comment/16911103",
                    "id": "16911103",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=tianchen92",
                        "name": "tianchen92",
                        "key": "tianchen92",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=tianchen92&avatarId=40800",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tianchen92&avatarId=40800",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tianchen92&avatarId=40800",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tianchen92&avatarId=40800"
                        },
                        "displayName": "Ji Liu",
                        "active": true,
                        "timeZone": "Asia/Gaza"
                    },
                    "body": "Are you planning to do this yourself?",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=tianchen92",
                        "name": "tianchen92",
                        "key": "tianchen92",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=tianchen92&avatarId=40800",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=tianchen92&avatarId=40800",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=tianchen92&avatarId=40800",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=tianchen92&avatarId=40800"
                        },
                        "displayName": "Ji Liu",
                        "active": true,
                        "timeZone": "Asia/Gaza"
                    },
                    "created": "2019-08-20T08:26:32.569+0000",
                    "updated": "2019-08-20T08:26:32.569+0000"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13251776/comment/16922230",
                    "id": "16922230",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=emkornfield%40gmail.com",
                        "name": "emkornfield@gmail.com",
                        "key": "emkornfield@gmail.com",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "Micah Kornfield",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "body": "Issue resolved by pull request 5152\n[https://github.com/apache/arrow/pull/5152]",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=emkornfield%40gmail.com",
                        "name": "emkornfield@gmail.com",
                        "key": "emkornfield@gmail.com",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "Micah Kornfield",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "created": "2019-09-04T07:24:42.446+0000",
                    "updated": "2019-09-04T07:24:42.446+0000"
                }
            ],
            "maxResults": 2,
            "total": 2,
            "startAt": 0
        },
        "customfield_12311820": "0|z05trs:",
        "customfield_12314139": null
    }
}