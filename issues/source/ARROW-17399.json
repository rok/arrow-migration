{
    "expand": "operations,versionedRepresentations,editmeta,changelog,renderedFields",
    "id": "13476590",
    "self": "https://issues.apache.org/jira/rest/api/2/issue/13476590",
    "key": "ARROW-17399",
    "fields": {
        "fixVersions": [],
        "resolution": null,
        "customfield_12312322": null,
        "customfield_12312323": null,
        "customfield_12312320": null,
        "customfield_12310420": "9223372036854775807",
        "customfield_12312321": null,
        "customfield_12312328": null,
        "customfield_12312329": null,
        "customfield_12312326": null,
        "customfield_12310300": null,
        "customfield_12312327": null,
        "customfield_12312324": null,
        "customfield_12312720": null,
        "customfield_12312325": null,
        "lastViewed": "2022-11-14T19:48:25.677+0000",
        "priority": {
            "self": "https://issues.apache.org/jira/rest/api/2/priority/3",
            "iconUrl": "https://issues.apache.org/jira/images/icons/priorities/major.svg",
            "name": "Major",
            "id": "3"
        },
        "labels": [],
        "customfield_12312333": null,
        "customfield_12312334": null,
        "customfield_12313422": "false",
        "customfield_12310310": "1.0",
        "customfield_12312331": null,
        "customfield_12312332": null,
        "aggregatetimeoriginalestimate": null,
        "timeestimate": null,
        "customfield_12312330": null,
        "versions": [
            {
                "self": "https://issues.apache.org/jira/rest/api/2/version/12351550",
                "id": "12351550",
                "name": "9.0.0",
                "archived": false,
                "released": true,
                "releaseDate": "2022-08-03"
            }
        ],
        "customfield_12311120": null,
        "customfield_12313826": null,
        "customfield_12312339": null,
        "issuelinks": [],
        "customfield_12313825": null,
        "assignee": null,
        "customfield_12312337": null,
        "customfield_12313823": null,
        "customfield_12312338": null,
        "customfield_12311920": null,
        "customfield_12313822": null,
        "customfield_12312335": null,
        "customfield_12313821": null,
        "customfield_12312336": null,
        "customfield_12313820": null,
        "status": {
            "self": "https://issues.apache.org/jira/rest/api/2/status/1",
            "description": "The issue is open and ready for the assignee to start work on it.",
            "iconUrl": "https://issues.apache.org/jira/images/icons/statuses/open.png",
            "name": "Open",
            "id": "1",
            "statusCategory": {
                "self": "https://issues.apache.org/jira/rest/api/2/statuscategory/2",
                "id": 2,
                "key": "new",
                "colorName": "blue-gray",
                "name": "To Do"
            }
        },
        "components": [
            {
                "self": "https://issues.apache.org/jira/rest/api/2/component/12337837",
                "id": "12337837",
                "name": "Parquet"
            },
            {
                "self": "https://issues.apache.org/jira/rest/api/2/component/12328936",
                "id": "12328936",
                "name": "Python"
            }
        ],
        "customfield_12312026": null,
        "customfield_12312023": null,
        "customfield_12312024": null,
        "aggregatetimeestimate": null,
        "customfield_12312022": null,
        "customfield_12310921": null,
        "customfield_12310920": "9223372036854775807",
        "customfield_12312823": null,
        "creator": {
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=gianluca313",
            "name": "gianluca313",
            "key": "JIRAUSER294344",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=34043",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34043",
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34043",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34043"
            },
            "displayName": "Gianluca Ficarelli",
            "active": true,
            "timeZone": "Europe/Zurich"
        },
        "subtasks": [],
        "reporter": {
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=gianluca313",
            "name": "gianluca313",
            "key": "JIRAUSER294344",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=34043",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34043",
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34043",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34043"
            },
            "displayName": "Gianluca Ficarelli",
            "active": true,
            "timeZone": "Europe/Zurich"
        },
        "aggregateprogress": {
            "progress": 0,
            "total": 0
        },
        "customfield_12313520": null,
        "customfield_12310250": null,
        "progress": {
            "progress": 0,
            "total": 0
        },
        "customfield_12313924": null,
        "votes": {
            "self": "https://issues.apache.org/jira/rest/api/2/issue/ARROW-17399/votes",
            "votes": 1,
            "hasVoted": false
        },
        "worklog": {
            "startAt": 0,
            "maxResults": 20,
            "total": 0,
            "worklogs": []
        },
        "customfield_12313920": null,
        "issuetype": {
            "self": "https://issues.apache.org/jira/rest/api/2/issuetype/1",
            "id": "1",
            "description": "A problem which impairs or prevents the functions of the product.",
            "iconUrl": "https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype",
            "name": "Bug",
            "subtask": false,
            "avatarId": 21133
        },
        "timespent": null,
        "customfield_12314020": "{summaryBean=com.atlassian.jira.plugin.devstatus.rest.SummaryBean@5034bf25[summary={pullrequest=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@18039539[overall=PullRequestOverallBean{stateCount=0, state='OPEN', details=PullRequestOverallDetails{openCount=0, mergedCount=0, declinedCount=0}},byInstanceType={}], build=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@2249c950[overall=com.atlassian.jira.plugin.devstatus.summary.beans.BuildOverallBean@26e73a7d[failedBuildCount=0,successfulBuildCount=0,unknownBuildCount=0,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], review=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@30248ed9[overall=com.atlassian.jira.plugin.devstatus.summary.beans.ReviewsOverallBean@6b465838[stateCount=0,state=<null>,dueDate=<null>,overDue=false,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], deployment-environment=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@7291f49[overall=com.atlassian.jira.plugin.devstatus.summary.beans.DeploymentOverallBean@1802f903[topEnvironments=[],showProjects=false,successfulCount=0,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], repository=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@c44ee9c[overall=com.atlassian.jira.plugin.devstatus.summary.beans.CommitOverallBean@559af0b4[count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], branch=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@1a067e19[overall=com.atlassian.jira.plugin.devstatus.summary.beans.BranchOverallBean@15c356bb[count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}]},errors=[],configErrors=[]], devSummaryJson={\"cachedValue\":{\"errors\":[],\"configErrors\":[],\"summary\":{\"pullrequest\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"stateCount\":0,\"state\":\"OPEN\",\"details\":{\"openCount\":0,\"mergedCount\":0,\"declinedCount\":0,\"total\":0},\"open\":true},\"byInstanceType\":{}},\"build\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"failedBuildCount\":0,\"successfulBuildCount\":0,\"unknownBuildCount\":0},\"byInstanceType\":{}},\"review\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"stateCount\":0,\"state\":null,\"dueDate\":null,\"overDue\":false,\"completed\":false},\"byInstanceType\":{}},\"deployment-environment\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"topEnvironments\":[],\"showProjects\":false,\"successfulCount\":0},\"byInstanceType\":{}},\"repository\":{\"overall\":{\"count\":0,\"lastUpdated\":null},\"byInstanceType\":{}},\"branch\":{\"overall\":{\"count\":0,\"lastUpdated\":null},\"byInstanceType\":{}}}},\"isStale\":false}}",
        "customfield_12314141": null,
        "customfield_12314140": null,
        "project": {
            "self": "https://issues.apache.org/jira/rest/api/2/project/12319525",
            "id": "12319525",
            "key": "ARROW",
            "name": "Apache Arrow",
            "projectTypeKey": "software",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/projectavatar?pid=12319525&avatarId=10011",
                "24x24": "https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12319525&avatarId=10011",
                "16x16": "https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12319525&avatarId=10011",
                "32x32": "https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12319525&avatarId=10011"
            },
            "projectCategory": {
                "self": "https://issues.apache.org/jira/rest/api/2/projectCategory/13960",
                "id": "13960",
                "description": "Apache Arrow",
                "name": "Arrow"
            }
        },
        "aggregatetimespent": null,
        "customfield_12312520": null,
        "customfield_12312521": "Tue Aug 30 14:30:10 UTC 2022",
        "customfield_12314422": null,
        "customfield_12314421": [
            "Python"
        ],
        "customfield_12314146": null,
        "customfield_12314420": null,
        "customfield_12314145": null,
        "customfield_12314144": null,
        "customfield_12314143": null,
        "resolutiondate": null,
        "workratio": -1,
        "customfield_12312923": null,
        "customfield_12312920": null,
        "customfield_12312921": null,
        "watches": {
            "self": "https://issues.apache.org/jira/rest/api/2/issue/ARROW-17399/watchers",
            "watchCount": 5,
            "isWatching": false
        },
        "created": "2022-08-12T15:34:27.000+0000",
        "updated": "2022-08-30T14:32:58.000+0000",
        "timeoriginalestimate": null,
        "description": "When a pandas dataframe is loaded from a parquet file using {{{}pyarrow.parquet.read_table{}}}, the memory usage may grow a lot more than what should be needed to load the dataframe, and it's not freed until the dataframe is deleted.\r\n\r\nThe problem is evident when the dataframe has a {*}column containing lists or numpy arrays{*}, while it seems absent (or not noticeable) if the column contains only integer or floats.\r\n\r\nI'm attaching a simple script to reproduce the issue, and a graph created with memory-profiler showing the memory usage.\r\n\r\nIn this example, the dataframe created with pandas needs around 1.2 GB, but the memory usage after loading it from parquet is around 16 GB.\r\n\r\nThe items of the column are created as numpy arrays and not lists, to be consistent with the types loaded from parquet (pyarrow produces numpy arrays and not lists).\r\n\r\n\u00a0\r\n{code:python}\r\nimport gc\r\nimport time\r\nimport numpy as np\r\nimport pandas as pd\r\nimport pyarrow\r\nimport pyarrow.parquet\r\nimport psutil\r\n\r\ndef pyarrow_dump(filename, df, compression=\"snappy\"):\r\n    table = pyarrow.Table.from_pandas(df)\r\n    pyarrow.parquet.write_table(table, filename, compression=compression)\r\n\r\ndef pyarrow_load(filename):\r\n    table = pyarrow.parquet.read_table(filename)\r\n    return table.to_pandas()\r\n\r\ndef print_mem(msg, start_time=time.monotonic(), process=psutil.Process()):\r\n    # gc.collect()\r\n    current_time = time.monotonic() - start_time\r\n    rss = process.memory_info().rss / 2 ** 20\r\n    print(f\"{msg:>3} time:{current_time:>10.1f} rss:{rss:>10.1f}\")\r\n\r\nif __name__ == \"__main__\":\r\n    print_mem(0)\r\n\r\n    rows = 5000000\r\n    df = pd.DataFrame({\"a\": [np.arange(10) for i in range(rows)]})\r\n    print_mem(1)\r\n    \r\n    pyarrow_dump(\"example.parquet\", df)\r\n    print_mem(2)\r\n    \r\n    del df\r\n    print_mem(3)\r\n    time.sleep(3)\r\n    print_mem(4)\r\n\r\n    df = pyarrow_load(\"example.parquet\")\r\n    print_mem(5)\r\n    time.sleep(3)\r\n    print_mem(6)\r\n\r\n    del df\r\n    print_mem(7)\r\n    time.sleep(3)\r\n    print_mem(8)\r\n{code}\r\nRun with memory-profiler:\r\n{code:bash}\r\nmprof run --multiprocess python test_pyarrow.py\r\n{code}\r\nOutput:\r\n{code:java}\r\nmprof: Sampling memory every 0.1s\r\nrunning new process\r\n  0 time:       0.0 rss:     135.4\r\n  1 time:       4.9 rss:    1252.2\r\n  2 time:       7.1 rss:    1265.0\r\n  3 time:       7.5 rss:     760.2\r\n  4 time:      10.7 rss:     758.9\r\n  5 time:      19.6 rss:   16745.4\r\n  6 time:      22.6 rss:   16335.4\r\n  7 time:      22.9 rss:   15833.0\r\n  8 time:      25.9 rss:     955.0\r\n{code}",
        "customfield_10010": null,
        "timetracking": {},
        "customfield_12314523": null,
        "customfield_12314127": null,
        "customfield_12314522": null,
        "customfield_12314126": null,
        "customfield_12314521": null,
        "customfield_12314125": null,
        "customfield_12314520": null,
        "customfield_12314124": null,
        "attachment": [
            {
                "self": "https://issues.apache.org/jira/rest/api/2/attachment/13048063",
                "id": "13048063",
                "filename": "memory-profiler.png",
                "author": {
                    "self": "https://issues.apache.org/jira/rest/api/2/user?username=gianluca313",
                    "name": "gianluca313",
                    "key": "JIRAUSER294344",
                    "avatarUrls": {
                        "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=34043",
                        "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34043",
                        "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34043",
                        "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34043"
                    },
                    "displayName": "Gianluca Ficarelli",
                    "active": true,
                    "timeZone": "Europe/Zurich"
                },
                "created": "2022-08-12T15:29:29.639+0000",
                "size": 171916,
                "mimeType": "image/png",
                "content": "https://issues.apache.org/jira/secure/attachment/13048063/memory-profiler.png"
            }
        ],
        "customfield_12312340": null,
        "customfield_12314123": null,
        "customfield_12312341": null,
        "customfield_12312220": null,
        "customfield_12314122": null,
        "customfield_12314121": null,
        "customfield_12314120": null,
        "customfield_12314129": null,
        "customfield_12314524": null,
        "customfield_12314128": null,
        "summary": "pyarrow may use a lot of memory to load a dataframe from parquet",
        "customfield_12314130": null,
        "customfield_12310291": null,
        "customfield_12310290": null,
        "customfield_12314138": null,
        "customfield_12314137": null,
        "environment": "linux",
        "customfield_12314136": null,
        "customfield_12314135": null,
        "customfield_12311020": null,
        "customfield_12314134": null,
        "duedate": null,
        "customfield_12314132": null,
        "customfield_12314131": null,
        "comment": {
            "comments": [
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13476590/comment/17579071",
                    "id": "17579071",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=willjones127",
                        "name": "willjones127",
                        "key": "willjones127",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=34058",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34058",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34058",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34058"
                        },
                        "displayName": "Will Jones",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "body": "Hi Gianluca,\r\n\r\nThere are two conversions happening when reading: first, Parquet data is deserialized into Arrow data; second, Arrow data is converted into Pandas / numpy data. Are you able to narrow down during which conversion memory is increasing?\r\n",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=willjones127",
                        "name": "willjones127",
                        "key": "willjones127",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=34058",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34058",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34058",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34058"
                        },
                        "displayName": "Will Jones",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "created": "2022-08-12T17:52:11.308+0000",
                    "updated": "2022-08-12T17:52:11.308+0000"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13476590/comment/17579086",
                    "id": "17579086",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=gianluca313",
                        "name": "gianluca313",
                        "key": "JIRAUSER294344",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=34043",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34043",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34043",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34043"
                        },
                        "displayName": "Gianluca Ficarelli",
                        "active": true,
                        "timeZone": "Europe/Zurich"
                    },
                    "body": "Hi [~willjones127] , sure, I added two additional prints in this function:\r\n{code:python}\r\ndef pyarrow_load(filename):\r\n    table = pyarrow.parquet.read_table(filename)\r\n    print_mem(41)\r\n    df = table.to_pandas()\r\n    print_mem(42)\r\n    return df\r\n {code}\r\nAnd the result is:\r\n{code:java}\r\nmprof: Sampling memory every 0.1s\r\nrunning new process\r\n  0 time:       0.0 rss:     139.4\r\n  1 time:       4.5 rss:    1256.2\r\n  2 time:       6.7 rss:    1269.0\r\n  3 time:       7.0 rss:     763.0\r\n  4 time:      10.3 rss:     763.0\r\n 41 time:      11.1 rss:    1674.6\r\n 42 time:      18.9 rss:   16751.4\r\n  5 time:      18.9 rss:   16751.4\r\n  6 time:      21.9 rss:   16341.4\r\n  7 time:      22.1 rss:   15838.9\r\n  8 time:      25.1 rss:     960.9\r\n{code}\r\nSo it seems that the big memory increase is happening when calling {{table.to_pandas()}}",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=gianluca313",
                        "name": "gianluca313",
                        "key": "JIRAUSER294344",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=34043",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34043",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34043",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34043"
                        },
                        "displayName": "Gianluca Ficarelli",
                        "active": true,
                        "timeZone": "Europe/Zurich"
                    },
                    "created": "2022-08-12T18:41:31.164+0000",
                    "updated": "2022-08-12T18:41:31.164+0000"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13476590/comment/17579120",
                    "id": "17579120",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=willjones127",
                        "name": "willjones127",
                        "key": "willjones127",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=34058",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34058",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34058",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34058"
                        },
                        "displayName": "Will Jones",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "body": "That's helps narrow it down. Are you able to narrow down and share the specific data types ({{table.schema}}}) that seem to be problematic?",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=willjones127",
                        "name": "willjones127",
                        "key": "willjones127",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=34058",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34058",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34058",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34058"
                        },
                        "displayName": "Will Jones",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "created": "2022-08-12T19:46:09.843+0000",
                    "updated": "2022-08-12T19:46:09.843+0000"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13476590/comment/17580947",
                    "id": "17580947",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=gianluca313",
                        "name": "gianluca313",
                        "key": "JIRAUSER294344",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=34043",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34043",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34043",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34043"
                        },
                        "displayName": "Gianluca Ficarelli",
                        "active": true,
                        "timeZone": "Europe/Zurich"
                    },
                    "body": "Hi [~willjones127] , the data in the example are self generated by the script to be as simple and reproducible as possible, and the dataframe contains only a column.\r\n\r\nIn particular I get this:\r\n{code:java}\r\n>>> table.schema\r\na: list<item: int64>\r\n\u00a0 child 0, item: int64\r\n-- schema metadata --\r\npandas: '{\"index_columns\": [{\"kind\": \"range\", \"name\": null, \"start\": 0, \"' + 370\r\n {code}\r\nand\r\n{code:java}\r\nprint(json.dumps(json.loads(table.schema.metadata[b'pandas']), indent=2))\r\n{\r\n\u00a0 \"index_columns\": [\r\n\u00a0 \u00a0 {\r\n\u00a0 \u00a0 \u00a0 \"kind\": \"range\",\r\n\u00a0 \u00a0 \u00a0 \"name\": null,\r\n\u00a0 \u00a0 \u00a0 \"start\": 0,\r\n\u00a0 \u00a0 \u00a0 \"stop\": 5000000,\r\n\u00a0 \u00a0 \u00a0 \"step\": 1\r\n\u00a0 \u00a0 }\r\n\u00a0 ],\r\n\u00a0 \"column_indexes\": [\r\n\u00a0 \u00a0 {\r\n\u00a0 \u00a0 \u00a0 \"name\": null,\r\n\u00a0 \u00a0 \u00a0 \"field_name\": null,\r\n\u00a0 \u00a0 \u00a0 \"pandas_type\": \"unicode\",\r\n\u00a0 \u00a0 \u00a0 \"numpy_type\": \"object\",\r\n\u00a0 \u00a0 \u00a0 \"metadata\": {\r\n\u00a0 \u00a0 \u00a0 \u00a0 \"encoding\": \"UTF-8\"\r\n\u00a0 \u00a0 \u00a0 }\r\n\u00a0 \u00a0 }\r\n\u00a0 ],\r\n\u00a0 \"columns\": [\r\n\u00a0 \u00a0 {\r\n\u00a0 \u00a0 \u00a0 \"name\": \"a\",\r\n\u00a0 \u00a0 \u00a0 \"field_name\": \"a\",\r\n\u00a0 \u00a0 \u00a0 \"pandas_type\": \"list[int64]\",\r\n\u00a0 \u00a0 \u00a0 \"numpy_type\": \"object\",\r\n\u00a0 \u00a0 \u00a0 \"metadata\": null\r\n\u00a0 \u00a0 }\r\n\u00a0 ],\r\n\u00a0 \"creator\": {\r\n\u00a0 \u00a0 \"library\": \"pyarrow\",\r\n\u00a0 \u00a0 \"version\": \"9.0.0\"\r\n\u00a0 },\r\n\u00a0 \"pandas_version\": \"1.4.3\"\r\n} {code}\r\nand\r\n{code:java}\r\n>>> df\r\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 a\r\n0\u00a0 \u00a0 \u00a0 \u00a0 [0, 1, 2, 3, 4, 5, 6, 7, 8, 9]\r\n1\u00a0 \u00a0 \u00a0 \u00a0 [0, 1, 2, 3, 4, 5, 6, 7, 8, 9]\r\n2\u00a0 \u00a0 \u00a0 \u00a0 [0, 1, 2, 3, 4, 5, 6, 7, 8, 9]\r\n3\u00a0 \u00a0 \u00a0 \u00a0 [0, 1, 2, 3, 4, 5, 6, 7, 8, 9]\r\n4\u00a0 \u00a0 \u00a0 \u00a0 [0, 1, 2, 3, 4, 5, 6, 7, 8, 9]\r\n... \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 ...\r\n4999995\u00a0 [0, 1, 2, 3, 4, 5, 6, 7, 8, 9]\r\n4999996\u00a0 [0, 1, 2, 3, 4, 5, 6, 7, 8, 9]\r\n4999997\u00a0 [0, 1, 2, 3, 4, 5, 6, 7, 8, 9]\r\n4999998\u00a0 [0, 1, 2, 3, 4, 5, 6, 7, 8, 9]\r\n4999999\u00a0 [0, 1, 2, 3, 4, 5, 6, 7, 8, 9]\r\n\r\n\r\n[5000000 rows x 1 columns]{code}\r\nDoes it help?",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=gianluca313",
                        "name": "gianluca313",
                        "key": "JIRAUSER294344",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=34043",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34043",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34043",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34043"
                        },
                        "displayName": "Gianluca Ficarelli",
                        "active": true,
                        "timeZone": "Europe/Zurich"
                    },
                    "created": "2022-08-17T18:47:57.855+0000",
                    "updated": "2022-08-17T18:53:36.966+0000"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13476590/comment/17597400",
                    "id": "17597400",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=willjones127",
                        "name": "willjones127",
                        "key": "willjones127",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=34058",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34058",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34058",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34058"
                        },
                        "displayName": "Will Jones",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "body": "Sorry, you are right you had a single column there already.\r\n\r\nI tried your repro on my M1 Macbook and didn't see the memory usage you are seeing. (This is with mimalloc allocator, but I got similar results with jemalloc and the system allocator.)\r\n\r\nAre you able to reproduce this on the latest versions of Pandas and Numpy? And could you confirm your package version numbers?\r\n\r\n{code:none}\r\n\u276f python test_pyarrow.py\r\n  0 time:       0.0 rss:      79.5\r\n  1 time:       2.0 rss:     617.1\r\n  2 time:       3.4 rss:    1090.6\r\n  3 time:       3.7 rss:     633.6\r\n  4 time:       6.7 rss:     633.6\r\n  5 time:      10.1 rss:    1942.9\r\n  6 time:      13.1 rss:    1942.9\r\n  7 time:      13.6 rss:     664.8\r\n  8 time:      16.6 rss:     664.8\r\n{code}",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=willjones127",
                        "name": "willjones127",
                        "key": "willjones127",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=34058",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34058",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34058",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34058"
                        },
                        "displayName": "Will Jones",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "created": "2022-08-29T21:19:45.199+0000",
                    "updated": "2022-08-29T21:19:45.199+0000"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13476590/comment/17597832",
                    "id": "17597832",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=gianluca313",
                        "name": "gianluca313",
                        "key": "JIRAUSER294344",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=34043",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34043",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34043",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34043"
                        },
                        "displayName": "Gianluca Ficarelli",
                        "active": true,
                        "timeZone": "Europe/Zurich"
                    },
                    "body": "I tried with a fresh virtualenv, on both Linux and Mac (Intel):\r\n\r\nLinux (Ubuntu 20.04, 32 GB):\r\n{code:java}\r\n$ python -V\r\nPython 3.9.9\r\n\r\n$ pip freeze\r\nnumpy==1.23.2\r\npandas==1.4.3\r\npsutil==5.9.1\r\npyarrow==9.0.0\r\npython-dateutil==2.8.2\r\npytz==2022.2.1\r\nsix==1.16.0\r\n\r\n$ python test_pyarrow.py\u00a0\r\n\u00a0 0 time: \u00a0 \u00a0 \u00a0 0.0 rss:\u00a0 \u00a0 \u00a0 90.8\r\n\u00a0 1 time: \u00a0 \u00a0 \u00a0 3.0 rss:\u00a0 \u00a0 1205.7\r\n\u00a0 2 time: \u00a0 \u00a0 \u00a0 4.6 rss:\u00a0 \u00a0 1212.6\r\n\u00a0 3 time: \u00a0 \u00a0 \u00a0 4.8 rss: \u00a0 \u00a0 710.0\r\n\u00a0 4 time: \u00a0 \u00a0 \u00a0 8.0 rss: \u00a0 \u00a0 708.2\r\n\u00a0 5 time:\u00a0 \u00a0 \u00a0 14.6 rss: \u00a0 16652.9\r\n\u00a0 6 time:\u00a0 \u00a0 \u00a0 17.6 rss: \u00a0 16242.9\r\n\u00a0 7 time:\u00a0 \u00a0 \u00a0 17.7 rss: \u00a0 15743.5\r\n\u00a0 8 time:\u00a0 \u00a0 \u00a0 20.7 rss: \u00a0 \u00a0 866.2\r\n{code}\r\nMac (Monterey 12.5, 16 GB):\r\n{code:java}\r\n$ python -V\r\nPython 3.9.9\r\n\r\n$ pip freeze\r\nnumpy==1.23.2\r\npandas==1.4.3\r\npsutil==5.9.1\r\npyarrow==9.0.0\r\npython-dateutil==2.8.2\r\npytz==2022.2.1\r\nsix==1.16.0\r\n\r\n$ python test_pyarrow.py\u00a0\r\n  0 time: \u00a0 \u00a0 \u00a0 0.0 rss:\u00a0 \u00a0 \u00a0 64.0\r\n\u00a0 1 time: \u00a0 \u00a0 \u00a0 4.0 rss:\u00a0 \u00a0 1075.0\r\n\u00a0 2 time: \u00a0 \u00a0 \u00a0 6.2 rss:\u00a0 \u00a0 1136.6\r\n\u00a0 3 time: \u00a0 \u00a0 \u00a0 6.8 rss: \u00a0 \u00a0 671.8\r\n\u00a0 4 time: \u00a0 \u00a0 \u00a0 9.8 rss: \u00a0 \u00a0 671.8\r\n\u00a0 5 time:\u00a0 \u00a0 \u00a0 22.9 rss:\u00a0 \u00a0 2477.4\r\n\u00a0 6 time:\u00a0 \u00a0 \u00a0 25.9 rss:\u00a0 \u00a0 2423.4\r\n\u00a0 7 time:\u00a0 \u00a0 \u00a0 27.1 rss: \u00a0 \u00a0 180.6\r\n\u00a0 8 time:\u00a0 \u00a0 \u00a0 30.1 rss: \u00a0 \u00a0 180.6\r\n {code}\r\nbut when the same script is retried there is some variability on Mac in the lines 5 and 6 (I observed from 1261 to 4140 MB), while on Linux is always the same (around 16 GB in lines 5, 6, 7).\r\n\r\nSo it seems that the rss memory usage is high on linux only.",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=gianluca313",
                        "name": "gianluca313",
                        "key": "JIRAUSER294344",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=34043",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34043",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34043",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34043"
                        },
                        "displayName": "Gianluca Ficarelli",
                        "active": true,
                        "timeZone": "Europe/Zurich"
                    },
                    "created": "2022-08-30T12:11:51.938+0000",
                    "updated": "2022-08-30T12:14:36.128+0000"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13476590/comment/17597904",
                    "id": "17597904",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=gianluca313",
                        "name": "gianluca313",
                        "key": "JIRAUSER294344",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=34043",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34043",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34043",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34043"
                        },
                        "displayName": "Gianluca Ficarelli",
                        "active": true,
                        "timeZone": "Europe/Zurich"
                    },
                    "body": "I tested on Linux the previous versions of pyarrow, here are the results:\r\n * pyarrow==9.0.0\r\n\r\n{code:java}\r\npip freeze\r\nnumpy==1.23.2\r\npandas==1.4.3\r\npsutil==5.9.1\r\npyarrow==9.0.0\r\npython-dateutil==2.8.2\r\npytz==2022.2.1\r\nsix==1.16.0\r\n\r\npython test_pyarrow_orig.py\u00a0\r\n\u00a0 0 time: \u00a0 \u00a0 \u00a0 0.0 rss:\u00a0 \u00a0 \u00a0 90.6\r\n\u00a0 1 time: \u00a0 \u00a0 \u00a0 2.8 rss:\u00a0 \u00a0 1205.4\r\n\u00a0 2 time: \u00a0 \u00a0 \u00a0 4.4 rss:\u00a0 \u00a0 1212.3\r\n\u00a0 3 time: \u00a0 \u00a0 \u00a0 4.7 rss: \u00a0 \u00a0 709.7\r\n\u00a0 4 time: \u00a0 \u00a0 \u00a0 7.8 rss: \u00a0 \u00a0 707.9\r\n\u00a0 5 time:\u00a0 \u00a0 \u00a0 14.4 rss: \u00a0 16656.0\r\n\u00a0 6 time:\u00a0 \u00a0 \u00a0 17.4 rss: \u00a0 16246.0\r\n\u00a0 7 time:\u00a0 \u00a0 \u00a0 17.5 rss: \u00a0 15743.6\r\n\u00a0 8 time:\u00a0 \u00a0 \u00a0 20.5 rss: \u00a0 \u00a0 866.3{code}\r\n * pyarrow==8.0.0\r\n\r\n{code:java}\r\npip freeze\r\nnumpy==1.23.2\r\npandas==1.4.3\r\npsutil==5.9.1\r\npyarrow==8.0.0\r\npython-dateutil==2.8.2\r\npytz==2022.2.1\r\nsix==1.16.0\r\n\r\npython test_pyarrow_orig.py\u00a0\r\n\u00a0 0 time: \u00a0 \u00a0 \u00a0 0.0 rss:\u00a0 \u00a0 \u00a0 86.2\r\n\u00a0 1 time: \u00a0 \u00a0 \u00a0 2.8 rss:\u00a0 \u00a0 1200.9\r\n\u00a0 2 time: \u00a0 \u00a0 \u00a0 4.3 rss:\u00a0 \u00a0 2266.2\r\n\u00a0 3 time: \u00a0 \u00a0 \u00a0 4.6 rss:\u00a0 \u00a0 1443.6\r\n\u00a0 4 time: \u00a0 \u00a0 \u00a0 7.7 rss: \u00a0 \u00a0 703.5\r\n\u00a0 5 time:\u00a0 \u00a0 \u00a0 14.3 rss: \u00a0 16648.0\r\n\u00a0 6 time:\u00a0 \u00a0 \u00a0 17.3 rss: \u00a0 16238.0\r\n\u00a0 7 time:\u00a0 \u00a0 \u00a0 17.4 rss: \u00a0 15738.6\r\n\u00a0 8 time:\u00a0 \u00a0 \u00a0 20.4 rss: \u00a0 \u00a0 861.3{code}\r\n * pyarrow==7.0.0\r\n\r\n{code:java}\r\npip freeze\r\nnumpy==1.23.2\r\npandas==1.4.3\r\npsutil==5.9.1\r\npyarrow==7.0.0\r\npython-dateutil==2.8.2\r\npytz==2022.2.1\r\nsix==1.16.0\r\n\r\npython test_pyarrow_orig.py\u00a0\r\n\u00a0 0 time: \u00a0 \u00a0 \u00a0 0.0 rss:\u00a0 \u00a0 \u00a0 84.3\r\n\u00a0 1 time: \u00a0 \u00a0 \u00a0 2.8 rss:\u00a0 \u00a0 1199.1\r\n\u00a0 2 time: \u00a0 \u00a0 \u00a0 4.4 rss:\u00a0 \u00a0 2263.7\r\n\u00a0 3 time: \u00a0 \u00a0 \u00a0 4.6 rss:\u00a0 \u00a0 1441.8\r\n\u00a0 4 time: \u00a0 \u00a0 \u00a0 7.7 rss: \u00a0 \u00a0 701.6\r\n\u00a0 5 time: \u00a0 \u00a0 \u00a0 9.8 rss:\u00a0 \u00a0 3679.9\r\n\u00a0 6 time:\u00a0 \u00a0 \u00a0 12.8 rss:\u00a0 \u00a0 3268.3\r\n\u00a0 7 time:\u00a0 \u00a0 \u00a0 12.9 rss:\u00a0 \u00a0 2766.6\r\n\u00a0 8 time:\u00a0 \u00a0 \u00a0 15.9 rss: \u00a0 \u00a0 859.2\r\n {code}\r\n * pyarrow==6.0.1\r\n\r\n{code:java}\r\npip freeze\r\nnumpy==1.23.2\r\npandas==1.4.3\r\npsutil==5.9.1\r\npyarrow==6.0.1\r\npython-dateutil==2.8.2\r\npytz==2022.2.1\r\nsix==1.16.0\r\n\r\npython test_pyarrow_orig.py\u00a0\r\n\u00a0 0 time: \u00a0 \u00a0 \u00a0 0.0 rss:\u00a0 \u00a0 \u00a0 81.9\r\n\u00a0 1 time: \u00a0 \u00a0 \u00a0 2.9 rss:\u00a0 \u00a0 1196.8\r\n\u00a0 2 time: \u00a0 \u00a0 \u00a0 4.5 rss:\u00a0 \u00a0 2261.4\r\n\u00a0 3 time: \u00a0 \u00a0 \u00a0 4.7 rss:\u00a0 \u00a0 1439.0\r\n\u00a0 4 time: \u00a0 \u00a0 \u00a0 7.8 rss: \u00a0 \u00a0 698.9\r\n\u00a0 5 time: \u00a0 \u00a0 \u00a0 9.2 rss:\u00a0 \u00a0 2224.0\r\n\u00a0 6 time:\u00a0 \u00a0 \u00a0 12.2 rss:\u00a0 \u00a0 1740.4\r\n\u00a0 7 time:\u00a0 \u00a0 \u00a0 12.3 rss:\u00a0 \u00a0 1238.1\r\n\u00a0 8 time:\u00a0 \u00a0 \u00a0 15.3 rss: \u00a0 \u00a0 856.6{code}\r\n * pyarrow==6.0.0\r\n\r\n{code:java}\r\n pip freeze\r\nnumpy==1.23.2\r\npandas==1.4.3\r\npsutil==5.9.1\r\npyarrow==6.0.0\r\npython-dateutil==2.8.2\r\npytz==2022.2.1\r\nsix==1.16.0\r\n\r\npython test_pyarrow_orig.py\u00a0\r\n\u00a0 0 time: \u00a0 \u00a0 \u00a0 0.0 rss:\u00a0 \u00a0 \u00a0 81.7\r\n\u00a0 1 time: \u00a0 \u00a0 \u00a0 2.9 rss:\u00a0 \u00a0 1196.6\r\n\u00a0 2 time: \u00a0 \u00a0 \u00a0 4.5 rss:\u00a0 \u00a0 2261.1\r\n\u00a0 3 time: \u00a0 \u00a0 \u00a0 4.7 rss:\u00a0 \u00a0 1438.5\r\n\u00a0 4 time: \u00a0 \u00a0 \u00a0 7.8 rss: \u00a0 \u00a0 698.4\r\n\u00a0 5 time: \u00a0 \u00a0 \u00a0 9.2 rss:\u00a0 \u00a0 2224.9\r\n\u00a0 6 time:\u00a0 \u00a0 \u00a0 12.2 rss:\u00a0 \u00a0 1740.1\r\n\u00a0 7 time:\u00a0 \u00a0 \u00a0 12.3 rss:\u00a0 \u00a0 1237.7\r\n\u00a0 8 time:\u00a0 \u00a0 \u00a0 15.3 rss: \u00a0 \u00a0 856.2{code}\r\n * pyarrow==5.0.0\r\n\r\n{code:java}\r\npip freeze\r\nnumpy==1.23.2\r\npandas==1.4.3\r\npsutil==5.9.1\r\npyarrow==5.0.0\r\npython-dateutil==2.8.2\r\npytz==2022.2.1\r\nsix==1.16.0\r\n\r\npython test_pyarrow_orig.py\u00a0\r\n\u00a0 0 time: \u00a0 \u00a0 \u00a0 0.0 rss:\u00a0 \u00a0 \u00a0 79.2\r\n\u00a0 1 time: \u00a0 \u00a0 \u00a0 2.8 rss:\u00a0 \u00a0 1194.0\r\n\u00a0 2 time: \u00a0 \u00a0 \u00a0 4.3 rss:\u00a0 \u00a0 2258.3\r\n\u00a0 3 time: \u00a0 \u00a0 \u00a0 4.5 rss:\u00a0 \u00a0 1436.2\r\n\u00a0 4 time: \u00a0 \u00a0 \u00a0 7.7 rss: \u00a0 \u00a0 696.1\r\n\u00a0 5 time: \u00a0 \u00a0 \u00a0 9.1 rss:\u00a0 \u00a0 2221.1\r\n\u00a0 6 time:\u00a0 \u00a0 \u00a0 12.1 rss:\u00a0 \u00a0 1736.3\r\n\u00a0 7 time:\u00a0 \u00a0 \u00a0 12.2 rss:\u00a0 \u00a0 1235.0\r\n\u00a0 8 time:\u00a0 \u00a0 \u00a0 15.3 rss: \u00a0 \u00a0 853.5{code}\r\nSo:\r\n * with pyarrow 9.0.0 and 8.0.0 the results are similar\r\n * with pyarrow 7.0.0 the used memory seems lower (and faster)\r\n * with pyarrow 6.0.0, 6.0.1, 5.0.0 the used memory is even lower (and faster)",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=gianluca313",
                        "name": "gianluca313",
                        "key": "JIRAUSER294344",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=34043",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34043",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34043",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34043"
                        },
                        "displayName": "Gianluca Ficarelli",
                        "active": true,
                        "timeZone": "Europe/Zurich"
                    },
                    "created": "2022-08-30T14:30:10.504+0000",
                    "updated": "2022-08-30T14:32:58.181+0000"
                }
            ],
            "maxResults": 7,
            "total": 7,
            "startAt": 0
        },
        "customfield_12311820": "0|z17pvc:",
        "customfield_12314139": null
    }
}