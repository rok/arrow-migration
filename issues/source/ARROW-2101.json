{
    "expand": "operations,versionedRepresentations,editmeta,changelog,renderedFields",
    "id": "13136651",
    "self": "https://issues.apache.org/jira/rest/api/2/issue/13136651",
    "key": "ARROW-2101",
    "fields": {
        "fixVersions": [
            {
                "self": "https://issues.apache.org/jira/rest/api/2/version/12342562",
                "id": "12342562",
                "description": "",
                "name": "0.10.0",
                "archived": false,
                "released": true,
                "releaseDate": "2018-08-06"
            }
        ],
        "resolution": {
            "self": "https://issues.apache.org/jira/rest/api/2/resolution/1",
            "id": "1",
            "description": "A fix for this issue is checked into the tree and tested.",
            "name": "Fixed"
        },
        "customfield_12312322": null,
        "customfield_12312323": null,
        "customfield_12312320": null,
        "customfield_12310420": "9223372036854775807",
        "customfield_12312321": null,
        "customfield_12312328": null,
        "customfield_12312329": null,
        "customfield_12312326": null,
        "customfield_12310300": null,
        "customfield_12312327": null,
        "customfield_12312324": null,
        "customfield_12312720": null,
        "customfield_12312325": null,
        "lastViewed": null,
        "priority": {
            "self": "https://issues.apache.org/jira/rest/api/2/priority/3",
            "iconUrl": "https://issues.apache.org/jira/images/icons/priorities/major.svg",
            "name": "Major",
            "id": "3"
        },
        "labels": [
            "pull-request-available"
        ],
        "customfield_12312333": null,
        "customfield_12312334": null,
        "customfield_12313422": "false",
        "customfield_12310310": "0.0",
        "customfield_12312331": null,
        "customfield_12312332": null,
        "aggregatetimeoriginalestimate": null,
        "timeestimate": null,
        "customfield_12312330": null,
        "versions": [
            {
                "self": "https://issues.apache.org/jira/rest/api/2/version/12341352",
                "id": "12341352",
                "name": "0.8.0",
                "archived": false,
                "released": true,
                "releaseDate": "2017-12-18"
            }
        ],
        "customfield_12311120": null,
        "customfield_12313826": null,
        "customfield_12312339": null,
        "issuelinks": [],
        "customfield_12313825": null,
        "assignee": {
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=joshuastorck",
            "name": "joshuastorck",
            "key": "joshuastorck",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
            },
            "displayName": "Joshua Storck",
            "active": true,
            "timeZone": "Etc/UTC"
        },
        "customfield_12312337": null,
        "customfield_12313823": null,
        "customfield_12312338": null,
        "customfield_12311920": null,
        "customfield_12313822": null,
        "customfield_12312335": null,
        "customfield_12313821": null,
        "customfield_12312336": null,
        "customfield_12313820": null,
        "status": {
            "self": "https://issues.apache.org/jira/rest/api/2/status/5",
            "description": "A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.",
            "iconUrl": "https://issues.apache.org/jira/images/icons/statuses/resolved.png",
            "name": "Resolved",
            "id": "5",
            "statusCategory": {
                "self": "https://issues.apache.org/jira/rest/api/2/statuscategory/3",
                "id": 3,
                "key": "done",
                "colorName": "green",
                "name": "Done"
            }
        },
        "components": [
            {
                "self": "https://issues.apache.org/jira/rest/api/2/component/12328936",
                "id": "12328936",
                "name": "Python"
            }
        ],
        "customfield_12312026": null,
        "customfield_12312023": null,
        "customfield_12312024": null,
        "aggregatetimeestimate": null,
        "customfield_12312022": null,
        "customfield_12310921": null,
        "customfield_12310920": "9223372036854775807",
        "customfield_12312823": null,
        "creator": {
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=bryanc",
            "name": "bryanc",
            "key": "bryanc",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=bryanc&avatarId=23479",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=bryanc&avatarId=23479",
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=bryanc&avatarId=23479",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=bryanc&avatarId=23479"
            },
            "displayName": "Bryan Cutler",
            "active": true,
            "timeZone": "America/Los_Angeles"
        },
        "subtasks": [],
        "reporter": {
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=bryanc",
            "name": "bryanc",
            "key": "bryanc",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=bryanc&avatarId=23479",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=bryanc&avatarId=23479",
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=bryanc&avatarId=23479",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=bryanc&avatarId=23479"
            },
            "displayName": "Bryan Cutler",
            "active": true,
            "timeZone": "America/Los_Angeles"
        },
        "aggregateprogress": {
            "progress": 0,
            "total": 0
        },
        "customfield_12313520": null,
        "customfield_12310250": null,
        "progress": {
            "progress": 0,
            "total": 0
        },
        "customfield_12313924": null,
        "votes": {
            "self": "https://issues.apache.org/jira/rest/api/2/issue/ARROW-2101/votes",
            "votes": 0,
            "hasVoted": false
        },
        "worklog": {
            "startAt": 0,
            "maxResults": 20,
            "total": 0,
            "worklogs": []
        },
        "customfield_12313920": null,
        "issuetype": {
            "self": "https://issues.apache.org/jira/rest/api/2/issuetype/1",
            "id": "1",
            "description": "A problem which impairs or prevents the functions of the product.",
            "iconUrl": "https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype",
            "name": "Bug",
            "subtask": false,
            "avatarId": 21133
        },
        "timespent": null,
        "customfield_12314020": "{summaryBean=com.atlassian.jira.plugin.devstatus.rest.SummaryBean@84be73f[summary={pullrequest=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@7e5e852a[overall=PullRequestOverallBean{stateCount=0, state='OPEN', details=PullRequestOverallDetails{openCount=0, mergedCount=0, declinedCount=0}},byInstanceType={}], build=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@3db65992[overall=com.atlassian.jira.plugin.devstatus.summary.beans.BuildOverallBean@374bfcdb[failedBuildCount=0,successfulBuildCount=0,unknownBuildCount=0,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], review=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@1b13d295[overall=com.atlassian.jira.plugin.devstatus.summary.beans.ReviewsOverallBean@683c34ae[stateCount=0,state=<null>,dueDate=<null>,overDue=false,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], deployment-environment=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@67c99af2[overall=com.atlassian.jira.plugin.devstatus.summary.beans.DeploymentOverallBean@f8c1ff4[topEnvironments=[],showProjects=false,successfulCount=0,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], repository=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@a0ef3ea[overall=com.atlassian.jira.plugin.devstatus.summary.beans.CommitOverallBean@39e3f41[count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], branch=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@28ab3bca[overall=com.atlassian.jira.plugin.devstatus.summary.beans.BranchOverallBean@4737e294[count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}]},errors=[],configErrors=[]], devSummaryJson={\"cachedValue\":{\"errors\":[],\"configErrors\":[],\"summary\":{\"pullrequest\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"stateCount\":0,\"state\":\"OPEN\",\"details\":{\"openCount\":0,\"mergedCount\":0,\"declinedCount\":0,\"total\":0},\"open\":true},\"byInstanceType\":{}},\"build\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"failedBuildCount\":0,\"successfulBuildCount\":0,\"unknownBuildCount\":0},\"byInstanceType\":{}},\"review\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"stateCount\":0,\"state\":null,\"dueDate\":null,\"overDue\":false,\"completed\":false},\"byInstanceType\":{}},\"deployment-environment\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"topEnvironments\":[],\"showProjects\":false,\"successfulCount\":0},\"byInstanceType\":{}},\"repository\":{\"overall\":{\"count\":0,\"lastUpdated\":null},\"byInstanceType\":{}},\"branch\":{\"overall\":{\"count\":0,\"lastUpdated\":null},\"byInstanceType\":{}}}},\"isStale\":false}}",
        "customfield_12314141": null,
        "customfield_12314140": null,
        "project": {
            "self": "https://issues.apache.org/jira/rest/api/2/project/12319525",
            "id": "12319525",
            "key": "ARROW",
            "name": "Apache Arrow",
            "projectTypeKey": "software",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/projectavatar?pid=12319525&avatarId=10011",
                "24x24": "https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12319525&avatarId=10011",
                "16x16": "https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12319525&avatarId=10011",
                "32x32": "https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12319525&avatarId=10011"
            },
            "projectCategory": {
                "self": "https://issues.apache.org/jira/rest/api/2/projectCategory/13960",
                "id": "13960",
                "description": "Apache Arrow",
                "name": "Arrow"
            }
        },
        "aggregatetimespent": null,
        "customfield_12312520": null,
        "customfield_12312521": "Tue Apr 17 15:06:34 UTC 2018",
        "customfield_12314422": null,
        "customfield_12314421": null,
        "customfield_12314146": null,
        "customfield_12314420": null,
        "customfield_12314145": null,
        "customfield_12314144": null,
        "customfield_12314143": null,
        "resolutiondate": "2018-04-16T10:12:00.000+0000",
        "workratio": -1,
        "customfield_12312923": null,
        "customfield_12312920": null,
        "customfield_12312921": null,
        "watches": {
            "self": "https://issues.apache.org/jira/rest/api/2/issue/ARROW-2101/watchers",
            "watchCount": 7,
            "isWatching": false
        },
        "created": "2018-02-06T19:24:48.000+0000",
        "updated": "2018-04-17T15:06:34.000+0000",
        "timeoriginalestimate": null,
        "description": "Using Python 2, converting Pandas with 'str' data to Arrow results in Arrow data of binary type, even if the user supplies type information.  conversion of 'unicode' type works to create Arrow data of string types.  For example\r\n\r\n{code}\r\nIn [25]: pa.Array.from_pandas(pd.Series(['a'])).type\r\nOut[25]: DataType(binary)\r\n\r\nIn [26]: pa.Array.from_pandas(pd.Series(['a']), type=pa.string()).type\r\nOut[26]: DataType(binary)\r\n\r\nIn [27]: pa.Array.from_pandas(pd.Series([u'a'])).type\r\nOut[27]: DataType(string)\r\n{code}",
        "customfield_10010": null,
        "timetracking": {},
        "customfield_12314523": null,
        "customfield_12314127": null,
        "customfield_12314522": null,
        "customfield_12314126": null,
        "customfield_12314521": null,
        "customfield_12314125": null,
        "customfield_12314520": null,
        "customfield_12314124": null,
        "attachment": [],
        "customfield_12312340": null,
        "customfield_12314123": null,
        "customfield_12312341": null,
        "customfield_12312220": null,
        "customfield_12314122": null,
        "customfield_12314121": null,
        "customfield_12314120": null,
        "customfield_12314129": null,
        "customfield_12314524": null,
        "customfield_12314128": null,
        "summary": "[Python] from_pandas reads 'str' type as binary Arrow data with Python 2",
        "customfield_12314130": null,
        "customfield_12310291": null,
        "customfield_12310290": null,
        "customfield_12314138": null,
        "customfield_12314137": null,
        "environment": null,
        "customfield_12314136": null,
        "customfield_12314135": null,
        "customfield_12311020": null,
        "customfield_12314134": null,
        "duedate": null,
        "customfield_12314132": null,
        "customfield_12314131": null,
        "comment": {
            "comments": [
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13136651/comment/16427462",
                    "id": "16427462",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=kszucs",
                        "name": "kszucs",
                        "key": "kszucs",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "Krisztian Szucs",
                        "active": true,
                        "timeZone": "Europe/Budapest"
                    },
                    "body": "I thins here https://github.com/apache/arrow/blob/master/cpp/src/arrow/python/numpy_to_arrow.cc#L839\r\nis the relevant code, the comments nicely explain what happens. \r\n\r\nThe example with explicit string datatype presumes the opposite direction.\r\n Of course a high level decode('utf-8') would work. What is the preferred way to do this kind of conversions?",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=kszucs",
                        "name": "kszucs",
                        "key": "kszucs",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "Krisztian Szucs",
                        "active": true,
                        "timeZone": "Europe/Budapest"
                    },
                    "created": "2018-04-05T19:11:41.932+0000",
                    "updated": "2018-04-05T19:11:41.932+0000"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13136651/comment/16427643",
                    "id": "16427643",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=bryanc",
                        "name": "bryanc",
                        "key": "bryanc",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=bryanc&avatarId=23479",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=bryanc&avatarId=23479",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=bryanc&avatarId=23479",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=bryanc&avatarId=23479"
                        },
                        "displayName": "Bryan Cutler",
                        "active": true,
                        "timeZone": "America/Los_Angeles"
                    },
                    "body": "I'm not exactly sure what the right behavior for this is.  If you are just staying in a Python 2 env, then it makes sense that {{str}} would correspond to a binary type column and it doesn't cause a problem going to/from Pandas.  In PySpark, we are sending Arrow data to Java and it seems like specifying {{pa.string()}} should lead to a string column in Java (a VarCharVector).  Currently, we do a check and \"decode('utf-8')\" before calling {{from_pandas}} which works fine, but I thought maybe that pyarrow should perform a conversion to UTF-8 automatically if the user specifies the type. However, it's also possible that casting to UTF-8 wouldn't be wanted, e.g. if you are only in a Python 2 env and don't mind treating it as a binary column.\r\n\r\nI guess to sum this issue up, is {{pa.string()}} meant to correspond to an Arrow UTF-8 type or is it special in this case as it depends on if your {{str}} came from Python 2 or 3?  cc [~wesmckinn] [~xhochy] [~pitrou] for thoughts",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=bryanc",
                        "name": "bryanc",
                        "key": "bryanc",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=bryanc&avatarId=23479",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=bryanc&avatarId=23479",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=bryanc&avatarId=23479",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=bryanc&avatarId=23479"
                        },
                        "displayName": "Bryan Cutler",
                        "active": true,
                        "timeZone": "America/Los_Angeles"
                    },
                    "created": "2018-04-05T21:41:42.253+0000",
                    "updated": "2018-04-05T21:41:42.253+0000"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13136651/comment/16427646",
                    "id": "16427646",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=apitrou",
                        "name": "apitrou",
                        "key": "pitrou",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=pitrou&avatarId=35049",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=pitrou&avatarId=35049",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=pitrou&avatarId=35049",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=pitrou&avatarId=35049"
                        },
                        "displayName": "Antoine Pitrou",
                        "active": true,
                        "timeZone": "Europe/Paris"
                    },
                    "body": "{{pa.string()}} should definitely return a string array IMHO.\r\n\r\nNote the following discrepancy (Python 3):\r\n{code:python}\r\n>>> pa.array([b'x'], type=pa.string())\r\n<pyarrow.lib.StringArray object at 0x7fdffc7de458>\r\n[\r\n  'x'\r\n]\r\n>>> pa.array(np.array([b'x'], dtype=object), type=pa.string())\r\n<pyarrow.lib.BinaryArray object at 0x7fdffc7dedb8>\r\n[\r\n  b'x'\r\n]\r\n{code}",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=apitrou",
                        "name": "apitrou",
                        "key": "pitrou",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=pitrou&avatarId=35049",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=pitrou&avatarId=35049",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=pitrou&avatarId=35049",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=pitrou&avatarId=35049"
                        },
                        "displayName": "Antoine Pitrou",
                        "active": true,
                        "timeZone": "Europe/Paris"
                    },
                    "created": "2018-04-05T21:46:26.210+0000",
                    "updated": "2018-04-05T21:46:26.210+0000"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13136651/comment/16436215",
                    "id": "16436215",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "body": "joshuastorck opened a new pull request #1886: Bug fix for ARROW-2101\nURL: https://github.com/apache/arrow/pull/1886\n \n \n   See https://issues.apache.org/jira/browse/ARROW-2101.\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "created": "2018-04-12T19:58:05.128+0000",
                    "updated": "2018-04-12T19:58:05.128+0000"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13136651/comment/16436368",
                    "id": "16436368",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "body": "cpcloud commented on a change in pull request #1886: Bug fix for ARROW-2101\nURL: https://github.com/apache/arrow/pull/1886#discussion_r181236498\n \n \n\n ##########\n File path: cpp/src/arrow/python/numpy_to_arrow.cc\n ##########\n @@ -228,11 +228,15 @@ static Status AppendObjectBinaries(PyArrayObject* arr, PyArrayObject* mask,\n /// can fit\n ///\n /// \\param[in] offset starting offset for appending\n+/// \\param[in] check_valid if set to true and the input array\n+/// contains values that cannot be converted to unicode, returns\n+/// a Status code containing a Python exception message\n /// \\param[out] end_offset ending offset where we stopped appending. Will\n /// be length of arr if fully consumed\n /// \\param[out] have_bytes true if we encountered any PyBytes object\n static Status AppendObjectStrings(PyArrayObject* arr, PyArrayObject* mask, int64_t offset,\n-                                  StringBuilder* builder, int64_t* end_offset,\n+                                  bool check_valid, StringBuilder* builder,\n+\t\t\t\t  int64_t* end_offset,\n \n Review comment:\n   `make format` should take care of this.\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "created": "2018-04-12T22:08:43.799+0000",
                    "updated": "2018-04-12T22:08:43.799+0000"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13136651/comment/16436372",
                    "id": "16436372",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "body": "cpcloud commented on a change in pull request #1886: Bug fix for ARROW-2101\nURL: https://github.com/apache/arrow/pull/1886#discussion_r181236715\n \n \n\n ##########\n File path: cpp/src/arrow/python/numpy_to_arrow.cc\n ##########\n @@ -844,6 +848,13 @@ Status NumPyConverter::ConvertObjectStrings() {\n   StringBuilder builder(pool_);\n   RETURN_NOT_OK(builder.Resize(length_));\n \n+  // If the creator of this NumPyConverter specified a type,\n+  // then we want to force the output type to be utf8. If\n+  // the input data is PyBytes and not PyUnicode and\n+  // not convertible to utf8, the call to AppendObjectStrings\n+  // below will fail because we pass force_string as the\n+  // value for check_valid.\n+  bool force_string = type_ != 0 && type_->Equals(utf8());\n \n Review comment:\n   We usually compare to `nullptr`\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "created": "2018-04-12T22:09:50.199+0000",
                    "updated": "2018-04-12T22:09:50.199+0000"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13136651/comment/16436375",
                    "id": "16436375",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "body": "cpcloud commented on a change in pull request #1886: Bug fix for ARROW-2101\nURL: https://github.com/apache/arrow/pull/1886#discussion_r181236801\n \n \n\n ##########\n File path: cpp/src/arrow/python/numpy_to_arrow.cc\n ##########\n @@ -1393,7 +1412,13 @@ inline Status NumPyConverter::ConvertTypedLists<NPY_OBJECT, StringType>(\n       RETURN_NOT_OK(CheckFlatNumpyArray(numpy_array, NPY_OBJECT));\n \n       int64_t offset = 0;\n-      RETURN_NOT_OK(AppendObjectStrings(numpy_array, nullptr, 0, value_builder, &offset,\n+      // If a type was specified and it was utf8, then we set\n+      // check_valid to true. If any of the input cannot be\n+      // converted, then we will exit early here.\n+      auto check_valid = type_ != 0 && type_->Equals(::arrow::utf8());\n \n Review comment:\n   `nullptr` here as well\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "created": "2018-04-12T22:10:18.181+0000",
                    "updated": "2018-04-12T22:10:18.181+0000"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13136651/comment/16436376",
                    "id": "16436376",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "body": "cpcloud commented on a change in pull request #1886: Bug fix for ARROW-2101\nURL: https://github.com/apache/arrow/pull/1886#discussion_r181236836\n \n \n\n ##########\n File path: cpp/src/arrow/python/numpy_to_arrow.cc\n ##########\n @@ -1393,7 +1412,13 @@ inline Status NumPyConverter::ConvertTypedLists<NPY_OBJECT, StringType>(\n       RETURN_NOT_OK(CheckFlatNumpyArray(numpy_array, NPY_OBJECT));\n \n       int64_t offset = 0;\n-      RETURN_NOT_OK(AppendObjectStrings(numpy_array, nullptr, 0, value_builder, &offset,\n+      // If a type was specified and it was utf8, then we set\n+      // check_valid to true. If any of the input cannot be\n+      // converted, then we will exit early here.\n+      auto check_valid = type_ != 0 && type_->Equals(::arrow::utf8());\n+      RETURN_NOT_OK(AppendObjectStrings(numpy_array, nullptr, 0,\n+\t\t\t\t\tcheck_valid,\n+\t\t\t\t\tvalue_builder, &offset,\n \n Review comment:\n   `make format` for this as well.\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "created": "2018-04-12T22:10:27.627+0000",
                    "updated": "2018-04-12T22:10:27.627+0000"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13136651/comment/16436379",
                    "id": "16436379",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "body": "cpcloud commented on a change in pull request #1886: Bug fix for ARROW-2101\nURL: https://github.com/apache/arrow/pull/1886#discussion_r181237063\n \n \n\n ##########\n File path: cpp/src/arrow/python/python-test.cc\n ##########\n @@ -383,5 +384,57 @@ TEST(PythonTest, ConstructStringArrayWithLeadingZeros) {\n   ASSERT_OK(ConvertPySequence(list, pool, &out));\n }\n \n+class NdarrayToArrowTest: public ::testing::Test {\n \n Review comment:\n   You'll probably get a format check error because of missing a space before the colon after `ArrowTest`.\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "created": "2018-04-12T22:11:22.806+0000",
                    "updated": "2018-04-12T22:11:22.806+0000"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13136651/comment/16436382",
                    "id": "16436382",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "body": "cpcloud commented on a change in pull request #1886: Bug fix for ARROW-2101\nURL: https://github.com/apache/arrow/pull/1886#discussion_r181237392\n \n \n\n ##########\n File path: cpp/src/arrow/python/python-test.cc\n ##########\n @@ -383,5 +384,57 @@ TEST(PythonTest, ConstructStringArrayWithLeadingZeros) {\n   ASSERT_OK(ConvertPySequence(list, pool, &out));\n }\n \n+class NdarrayToArrowTest: public ::testing::Test {\n+\n+public:\n+\n+  void CreateNdarrayWithOneString(const char* value, OwnedRef& ref)\n+  {\n+    npy_intp dims[1];\n+    dims[0] = 1;\n+    auto array_object = PyArray_SimpleNew(1, dims, NPY_OBJECT);\n+    auto array = reinterpret_cast<PyArrayObject*>(array_object);\n+    ASSERT_TRUE(array != 0);\n+    dims[0] = 0;\n+    auto dest = PyArray_GetPtr(array, dims);\n+    auto bytes_object = PyBytes_FromString(value);\n \n Review comment:\n   Should we assert that this isn't `nullptr`?\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "created": "2018-04-12T22:13:17.363+0000",
                    "updated": "2018-04-12T22:13:17.363+0000"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13136651/comment/16436389",
                    "id": "16436389",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "body": "cpcloud commented on a change in pull request #1886: Bug fix for ARROW-2101\nURL: https://github.com/apache/arrow/pull/1886#discussion_r181238447\n \n \n\n ##########\n File path: cpp/src/arrow/python/python-test.cc\n ##########\n @@ -383,5 +384,57 @@ TEST(PythonTest, ConstructStringArrayWithLeadingZeros) {\n   ASSERT_OK(ConvertPySequence(list, pool, &out));\n }\n \n+class NdarrayToArrowTest: public ::testing::Test {\n+\n+public:\n+\n+  void CreateNdarrayWithOneString(const char* value, OwnedRef& ref)\n+  {\n+    npy_intp dims[1];\n+    dims[0] = 1;\n+    auto array_object = PyArray_SimpleNew(1, dims, NPY_OBJECT);\n+    auto array = reinterpret_cast<PyArrayObject*>(array_object);\n+    ASSERT_TRUE(array != 0);\n+    dims[0] = 0;\n+    auto dest = PyArray_GetPtr(array, dims);\n+    auto bytes_object = PyBytes_FromString(value);\n+    ASSERT_NE(-1, PyArray_SETITEM(array, reinterpret_cast<char*>(dest), bytes_object));\n \n Review comment:\n   Does this steal a reference?\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "created": "2018-04-12T22:18:44.843+0000",
                    "updated": "2018-04-12T22:18:44.843+0000"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13136651/comment/16436390",
                    "id": "16436390",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "body": "cpcloud commented on a change in pull request #1886: Bug fix for ARROW-2101\nURL: https://github.com/apache/arrow/pull/1886#discussion_r181238494\n \n \n\n ##########\n File path: cpp/src/arrow/python/python-test.cc\n ##########\n @@ -383,5 +384,57 @@ TEST(PythonTest, ConstructStringArrayWithLeadingZeros) {\n   ASSERT_OK(ConvertPySequence(list, pool, &out));\n }\n \n+class NdarrayToArrowTest: public ::testing::Test {\n+\n+public:\n+\n+  void CreateNdarrayWithOneString(const char* value, OwnedRef& ref)\n+  {\n+    npy_intp dims[1];\n+    dims[0] = 1;\n+    auto array_object = PyArray_SimpleNew(1, dims, NPY_OBJECT);\n+    auto array = reinterpret_cast<PyArrayObject*>(array_object);\n+    ASSERT_TRUE(array != 0);\n+    dims[0] = 0;\n+    auto dest = PyArray_GetPtr(array, dims);\n+    auto bytes_object = PyBytes_FromString(value);\n+    ASSERT_NE(-1, PyArray_SETITEM(array, reinterpret_cast<char*>(dest), bytes_object));\n+\n+    Py_XDECREF(bytes_object);\n+\n+    ref.reset(array_object);\n+  }\n+\n+};\n+\n+// Regression for ARROW-2101\n+TEST_F(NdarrayToArrowTest, BytesToStringWhenTypeSpecified)\n+{\n+  OwnedRef array;\n+  this->CreateNdarrayWithOneString(\"x\", array);\n+\n+  auto arrow_type = ::arrow::utf8();\n+  std::shared_ptr<ChunkedArray> arrow_array;\n+  ASSERT_OK(NdarrayToArrow(default_memory_pool(), reinterpret_cast<PyObject*>(array.obj()), 0,\n+\t\t\t   true, arrow_type, &arrow_array));\n \n Review comment:\n   `make format`\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "created": "2018-04-12T22:18:54.434+0000",
                    "updated": "2018-04-12T22:18:54.434+0000"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13136651/comment/16436491",
                    "id": "16436491",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "body": "BryanCutler commented on issue #1886: Bug fix for ARROW-2101\nURL: https://github.com/apache/arrow/pull/1886#issuecomment-380977087\n \n \n   Thanks for the PR @joshuastorck !  Could you please update the title to start with \"ARROW-2101: [Python] ...\" and make it and the description a little more informative rather than just referencing the JIRA?  Also, in the future, could you assign or make a comment in the JIRA that you are working on it to let people know and prevent duplicate efforts?\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "created": "2018-04-12T23:44:49.074+0000",
                    "updated": "2018-04-12T23:44:49.074+0000"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13136651/comment/16436517",
                    "id": "16436517",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "body": "BryanCutler commented on issue #1886: Bug fix for ARROW-2101\nURL: https://github.com/apache/arrow/pull/1886#issuecomment-380981795\n \n \n   Just so I have this straight, the old behavior was when the user specifies an explicit type as `pa.string()` and a binary object was found, it would fallback to `BinaryArray` and continue.  This changes it to try to convert the object to utf-8 and raises an error if it fails, only if the type is specified?\r\n   \r\n   Does anyone know if there was a reason to fallback in this case?  I think this change makes sense, but just want to make sure we are not breaking anything.\r\n   \r\n   Also, this doesn't change anything for Python 2 if using 'str' objects and the type is not specified, it will still create a `BinaryArray`, is this what we want?\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "created": "2018-04-13T00:13:10.771+0000",
                    "updated": "2018-04-13T00:13:10.771+0000"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13136651/comment/16436545",
                    "id": "16436545",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "body": "BryanCutler commented on a change in pull request #1886: Bug fix for ARROW-2101\nURL: https://github.com/apache/arrow/pull/1886#discussion_r181258433\n \n \n\n ##########\n File path: cpp/src/arrow/python/numpy_to_arrow.cc\n ##########\n @@ -1393,7 +1412,13 @@ inline Status NumPyConverter::ConvertTypedLists<NPY_OBJECT, StringType>(\n       RETURN_NOT_OK(CheckFlatNumpyArray(numpy_array, NPY_OBJECT));\n \n       int64_t offset = 0;\n-      RETURN_NOT_OK(AppendObjectStrings(numpy_array, nullptr, 0, value_builder, &offset,\n+      // If a type was specified and it was utf8, then we set\n+      // check_valid to true. If any of the input cannot be\n+      // converted, then we will exit early here.\n+      auto check_valid = type_ != 0 && type_->Equals(::arrow::utf8());\n \n Review comment:\n   no need to use `auto` here\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "created": "2018-04-13T00:27:48.423+0000",
                    "updated": "2018-04-13T00:27:48.423+0000"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13136651/comment/16436552",
                    "id": "16436552",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "body": "BryanCutler commented on a change in pull request #1886: Bug fix for ARROW-2101\nURL: https://github.com/apache/arrow/pull/1886#discussion_r181258704\n \n \n\n ##########\n File path: python/pyarrow/tests/test_convert_numpy.py\n ##########\n @@ -0,0 +1,35 @@\n+# -*- coding: utf-8 -*-\n+# Licensed to the Apache Software Foundation (ASF) under one\n+# or more contributor license agreements.  See the NOTICE file\n+# distributed with this work for additional information\n+# regarding copyright ownership.  The ASF licenses this file\n+# to you under the Apache License, Version 2.0 (the\n+# \"License\"); you may not use this file except in compliance\n+# with the License.  You may obtain a copy of the License at\n+#\n+#   http://www.apache.org/licenses/LICENSE-2.0\n+#\n+# Unless required by applicable law or agreed to in writing,\n+# software distributed under the License is distributed on an\n+# \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+# KIND, either express or implied.  See the License for the\n+# specific language governing permissions and limitations\n+# under the License.\n+\n+import numpy as np\n+import pyarrow as pa\n+\n+import pytest\n+\n+# Regression test for ARROW-2101\n+def test_convert_numpy_array_of_bytes_to_arrow_array_of_strings():\n+    converted = pa.array(np.array([b'x'], dtype=object), pa.string())\n+    assert converted.type == pa.string()\n+\n+# Make sure that if an ndarray of bytes is passed to the array\n+# constructor and the type is string, it will fail if those bytes\n+# cannot be converted to utf-8\n+def test_convert_numpy_array_of_bytes_to_arrow_array_of_strings_bad_data():\n+    with pytest.raises(pa.lib.ArrowException,\n+                       message=\"Unknown error: 'utf-8' codec can't decode byte 0x80 in position 0: invalid start byte\"):\n+        pa.array(np.array([b'\\x80\\x81'], dtype=object), pa.string())\n \n Review comment:\n   I think these tests would be fine in 'test_convert_pandas'\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "created": "2018-04-13T00:30:25.086+0000",
                    "updated": "2018-04-13T00:30:25.086+0000"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13136651/comment/16437279",
                    "id": "16437279",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "body": "pitrou commented on a change in pull request #1886: Bug fix for ARROW-2101\nURL: https://github.com/apache/arrow/pull/1886#discussion_r181381388\n \n \n\n ##########\n File path: python/pyarrow/tests/test_convert_numpy.py\n ##########\n @@ -0,0 +1,35 @@\n+# -*- coding: utf-8 -*-\n+# Licensed to the Apache Software Foundation (ASF) under one\n+# or more contributor license agreements.  See the NOTICE file\n+# distributed with this work for additional information\n+# regarding copyright ownership.  The ASF licenses this file\n+# to you under the Apache License, Version 2.0 (the\n+# \"License\"); you may not use this file except in compliance\n+# with the License.  You may obtain a copy of the License at\n+#\n+#   http://www.apache.org/licenses/LICENSE-2.0\n+#\n+# Unless required by applicable law or agreed to in writing,\n+# software distributed under the License is distributed on an\n+# \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+# KIND, either express or implied.  See the License for the\n+# specific language governing permissions and limitations\n+# under the License.\n+\n+import numpy as np\n+import pyarrow as pa\n+\n+import pytest\n+\n+# Regression test for ARROW-2101\n+def test_convert_numpy_array_of_bytes_to_arrow_array_of_strings():\n+    converted = pa.array(np.array([b'x'], dtype=object), pa.string())\n+    assert converted.type == pa.string()\n+\n+# Make sure that if an ndarray of bytes is passed to the array\n+# constructor and the type is string, it will fail if those bytes\n+# cannot be converted to utf-8\n+def test_convert_numpy_array_of_bytes_to_arrow_array_of_strings_bad_data():\n+    with pytest.raises(pa.lib.ArrowException,\n+                       message=\"Unknown error: 'utf-8' codec can't decode byte 0x80 in position 0: invalid start byte\"):\n+        pa.array(np.array([b'\\x80\\x81'], dtype=object), pa.string())\n \n Review comment:\n   Indeed. Also I don't think we need both Python and C++ tests. Given the difference in verbosity and maintainability, I'd favour writing the tests on the Python side.\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "created": "2018-04-13T13:06:48.887+0000",
                    "updated": "2018-04-13T13:06:48.887+0000"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13136651/comment/16437748",
                    "id": "16437748",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "body": "pitrou commented on issue #1886: ARROW-2101: [Python/C++] Correctly convert numpy arrays of bytes to arrow arrays of strings when user specifies arrow type of string\nURL: https://github.com/apache/arrow/pull/1886#issuecomment-381230244\n \n \n   > Also, this doesn't change anything for Python 2 if using 'str' objects and the type is not specified, it will still create a BinaryArray, is this what we want?\r\n   \r\n   *Probably*. Python 2 `str` objects are bytestrings just like Python 3 `bytes` objects.\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "created": "2018-04-13T18:55:00.517+0000",
                    "updated": "2018-04-13T18:55:00.517+0000"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13136651/comment/16437752",
                    "id": "16437752",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "body": "pitrou commented on issue #1886: ARROW-2101: [Python/C++] Correctly convert numpy arrays of bytes to arrow arrays of strings when user specifies arrow type of string\nURL: https://github.com/apache/arrow/pull/1886#issuecomment-381231182\n \n \n   By the way, the validity check is expensive since it utf8-decodes the bytestring.\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "created": "2018-04-13T18:58:37.543+0000",
                    "updated": "2018-04-13T18:58:37.543+0000"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13136651/comment/16437757",
                    "id": "16437757",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "body": "pitrou commented on a change in pull request #1886: ARROW-2101: [Python/C++] Correctly convert numpy arrays of bytes to arrow arrays of strings when user specifies arrow type of string\nURL: https://github.com/apache/arrow/pull/1886#discussion_r181482519\n \n \n\n ##########\n File path: cpp/src/arrow/python/numpy_to_arrow.cc\n ##########\n @@ -844,6 +846,13 @@ Status NumPyConverter::ConvertObjectStrings() {\n   StringBuilder builder(pool_);\n   RETURN_NOT_OK(builder.Resize(length_));\n \n+  // If the creator of this NumPyConverter specified a type,\n+  // then we want to force the output type to be utf8. If\n+  // the input data is PyBytes and not PyUnicode and\n+  // not convertible to utf8, the call to AppendObjectStrings\n+  // below will fail because we pass force_string as the\n+  // value for check_valid.\n+  bool force_string = type_ != std::nullptr && type_->Equals(utf8());\n \n Review comment:\n   Apparently some compilers don't like `std::nullptr`. Just use `type_ != nullptr`.\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "created": "2018-04-13T19:02:01.806+0000",
                    "updated": "2018-04-13T19:02:01.806+0000"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13136651/comment/16437938",
                    "id": "16437938",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "body": "joshuastorck commented on issue #1886: ARROW-2101: [Python/C++] Correctly convert numpy arrays of bytes to arrow arrays of strings when user specifies arrow type of string\nURL: https://github.com/apache/arrow/pull/1886#issuecomment-381263228\n \n \n   I built for Python 2 and confirmed the behavior is the same. \r\n   \r\n   @pitrou, in regards to the inefficiency of utf-8 encoding, it could be moved below to the check of global_have_bytes. Would you prefer this?\r\n   \r\n   ```cpp\r\n     if (global_have_bytes) {\r\n       if (force_string)\r\n       {\r\n           PyObject* obj;\r\n   \r\n   \tNdarray1DIndexer<PyObject*> objects(arr_);\r\n   \tNdarray1DIndexer<uint8_t> mask_values;\r\n   \t\r\n   \tbool have_mask = false;\r\n   \tif (mask_ != nullptr) {\r\n   \t  mask_values.Init(mask_);\r\n   \t  have_mask = true;\r\n   \t}\r\n   \t\r\n   \tfor (int64_t offset = 0; offset < objects.size(); ++offset) {\r\n   \t  OwnedRef tmp_obj;\r\n   \t  obj = objects[offset];\r\n   \t  if ((have_mask && mask_values[offset]) || internal::PandasObjectIsNull(obj)) {\r\n   \t    continue;\r\n   \t  }\r\n   \t  OwnedRef(PyUnicode_AsUTF8String(obj));\r\n   \t  RETURN_IF_PYERROR();\r\n   \t}\r\n       }\r\n       else\r\n       {\r\n         for (size_t i = 0; i < out_arrays_.size(); ++i) {\r\n   \tauto binary_data = out_arrays_[i]->data()->Copy();c\r\n   \tbinary_data->type = ::arrow::binary();\r\n   \tout_arrays_[i] = std::make_shared<BinaryArray>(binary_data);\r\n         }\r\n       }\r\n   ```\r\n   \r\n   I'm not fond of how much code I had to copy from AppendObjectStrings to write that loop. I think it would be helpful to have iterators that look like this:\r\n   \r\n   ```cpp\r\n   NdArray1DIndexer<PyObject*> array(array_);\r\n   auto mask = NdArray1DIndexer<uint64_t>::from_mask(mask_);\r\n   NdArray1DMaskedIterator iterator(array.begin() + offset, array.end(), mask, true /* include masked value */);\r\n   for (OwnedRef& obj: iterator)\r\n   {\r\n      // Maybe we use None to indicate masked values?\r\n   }\r\n   ```\r\n   Or even better, we use pybind11 and these are light wrappers over them?\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "created": "2018-04-13T21:19:15.358+0000",
                    "updated": "2018-04-13T21:19:15.358+0000"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13136651/comment/16437944",
                    "id": "16437944",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "body": "pitrou commented on issue #1886: ARROW-2101: [Python/C++] Correctly convert numpy arrays of bytes to arrow arrays of strings when user specifies arrow type of string\nURL: https://github.com/apache/arrow/pull/1886#issuecomment-381263863\n \n \n   @joshuastorck The utf8 decoding check is in `BuilderAppend(StringBuilder*, ...)`.\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "created": "2018-04-13T21:22:26.035+0000",
                    "updated": "2018-04-13T21:22:26.035+0000"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13136651/comment/16437947",
                    "id": "16437947",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "body": "pitrou commented on issue #1886: ARROW-2101: [Python/C++] Correctly convert numpy arrays of bytes to arrow arrays of strings when user specifies arrow type of string\nURL: https://github.com/apache/arrow/pull/1886#issuecomment-381264065\n \n \n   > I think it would be helpful to have iterators that look like this:\r\n   \r\n   Probably, though that would be another PR :-)\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "created": "2018-04-13T21:23:28.679+0000",
                    "updated": "2018-04-13T21:23:28.679+0000"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13136651/comment/16438623",
                    "id": "16438623",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "body": "xhochy commented on issue #1886: ARROW-2101: [Python/C++] Correctly convert numpy arrays of bytes to arrow arrays of strings when user specifies arrow type of string\nURL: https://github.com/apache/arrow/pull/1886#issuecomment-381388117\n \n \n   Not sure if there were more comment on it, but just want to iterate on \r\n   \r\n   >> Also, this doesn't change anything for Python 2 if using 'str' objects and the type is not specified, it will still create a BinaryArray, is this what we want?\r\n   \r\n   > Probably. Python 2 str objects are bytestrings just like Python 3 bytes objects.\r\n   \r\n   Yes this is definitely the indented behaviour. We had some discussion in the past about it and stuck to the following when no type is specified:\r\n   \r\n   ```\r\n   str(PY2) / bytes(PY3) \u2013> pa.binary\r\n   unicode(PY2) / str(PY3) \u2013> pa.string\r\n   ```\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "created": "2018-04-15T08:03:47.017+0000",
                    "updated": "2018-04-15T08:03:47.017+0000"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13136651/comment/16438715",
                    "id": "16438715",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "body": "joshuastorck commented on issue #1886: ARROW-2101: [Python/C++] Correctly convert numpy arrays of bytes to arrow arrays of strings when user specifies arrow type of string\nURL: https://github.com/apache/arrow/pull/1886#issuecomment-381263228\n \n \n   I built for Python 2 and confirmed the behavior is the same. \r\n   \r\n   @pitrou, in regards to the inefficiency of utf-8 encoding, it could be moved below to the check of global_have_bytes. Would you prefer this?\r\n   \r\n   ```cpp\r\n     if (global_have_bytes) {\r\n       if (force_string)\r\n       {\r\n           PyObject* obj;\r\n   \r\n   \tNdarray1DIndexer<PyObject*> objects(arr_);\r\n   \tNdarray1DIndexer<uint8_t> mask_values;\r\n   \t\r\n   \tbool have_mask = false;\r\n   \tif (mask_ != nullptr) {\r\n   \t  mask_values.Init(mask_);\r\n   \t  have_mask = true;\r\n   \t}\r\n   \t\r\n   \tPyBytesView view;\r\n   \tfor (int64_t offset = 0; offset < objects.size(); ++offset) {\r\n   \t  OwnedRef tmp_obj;\r\n   \t  obj = objects[offset];\r\n   \t  if ((have_mask && mask_values[offset]) || internal::PandasObjectIsNull(obj)) {\r\n   \t    continue;\r\n   \t  }\r\n             RETURN_NOT_OK(view.FromString(obj, true);\r\n   \t}\r\n       }\r\n       else\r\n       {\r\n         for (size_t i = 0; i < out_arrays_.size(); ++i) {\r\n   \tauto binary_data = out_arrays_[i]->data()->Copy();c\r\n   \tbinary_data->type = ::arrow::binary();\r\n   \tout_arrays_[i] = std::make_shared<BinaryArray>(binary_data);\r\n         }\r\n       }\r\n   ```\r\n   \r\n   I'm not fond of how much code I had to copy from AppendObjectStrings to write that loop. I think it would be helpful to have iterators that look like this:\r\n   \r\n   ```cpp\r\n   NdArray1DIndexer<PyObject*> array(array_);\r\n   auto mask = NdArray1DIndexer<uint64_t>::from_mask(mask_);\r\n   NdArray1DMaskedIterator iterator(array.begin() + offset, array.end(), mask, true /* include masked value */);\r\n   for (OwnedRef& obj: iterator)\r\n   {\r\n      // Maybe we use None to indicate masked values?\r\n   }\r\n   ```\r\n   Or even better, we use pybind11 and these are light wrappers over them?\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "created": "2018-04-15T14:08:57.731+0000",
                    "updated": "2018-04-15T14:08:57.731+0000"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13136651/comment/16438721",
                    "id": "16438721",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "body": "joshuastorck commented on issue #1886: ARROW-2101: [Python/C++] Correctly convert numpy arrays of bytes to arrow arrays of strings when user specifies arrow type of string\nURL: https://github.com/apache/arrow/pull/1886#issuecomment-381410530\n \n \n   @pitrou, on second look it won't be more efficient to move the check to outside of AppendObjectStrings. When passing check_valid to AppendObjectStrings, the UTF-8 decoding/check only happens if the data is Python 3 bytes or Python 2 strings. However, if the user passes Python 3 strings or Python 2 unicode and wants a string type, no extra checks are done. In the case where the user wants the output type to be an arrow string, then we need to do the check on each bytes object. Otherwise, we will return a StringArray that has data that's not actually UTF-8.\r\n   \r\n   Please let me know if that makes sense, and if not, let me know how you would make it faster. \r\n   \n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "created": "2018-04-15T14:24:59.088+0000",
                    "updated": "2018-04-15T14:24:59.088+0000"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13136651/comment/16438794",
                    "id": "16438794",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "body": "pitrou commented on issue #1886: ARROW-2101: [Python/C++] Correctly convert numpy arrays of bytes to arrow arrays of strings when user specifies arrow type of string\nURL: https://github.com/apache/arrow/pull/1886#issuecomment-381426651\n \n \n   I'm not saying we should necessarily make it faster, just wanted to make sure people are aware of the inefficiency.\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "created": "2018-04-15T18:19:00.723+0000",
                    "updated": "2018-04-15T18:19:00.723+0000"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13136651/comment/16439224",
                    "id": "16439224",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "body": "pitrou closed pull request #1886: ARROW-2101: [Python/C++] Correctly convert numpy arrays of bytes to arrow arrays of strings when user specifies arrow type of string\nURL: https://github.com/apache/arrow/pull/1886\n \n \n   \n\nThis is a PR merged from a forked repository.\nAs GitHub hides the original diff on merge, it is displayed below for\nthe sake of provenance:\n\nAs this is a foreign pull request (from a fork), the diff is supplied\nbelow (as it won't show otherwise due to GitHub magic):\n\ndiff --git a/cpp/src/arrow/python/numpy_to_arrow.cc b/cpp/src/arrow/python/numpy_to_arrow.cc\nindex e37013c7e..dcb96a48a 100644\n--- a/cpp/src/arrow/python/numpy_to_arrow.cc\n+++ b/cpp/src/arrow/python/numpy_to_arrow.cc\n@@ -228,12 +228,15 @@ static Status AppendObjectBinaries(PyArrayObject* arr, PyArrayObject* mask,\n /// can fit\n ///\n /// \\param[in] offset starting offset for appending\n+/// \\param[in] check_valid if set to true and the input array\n+/// contains values that cannot be converted to unicode, returns\n+/// a Status code containing a Python exception message\n /// \\param[out] end_offset ending offset where we stopped appending. Will\n /// be length of arr if fully consumed\n /// \\param[out] have_bytes true if we encountered any PyBytes object\n static Status AppendObjectStrings(PyArrayObject* arr, PyArrayObject* mask, int64_t offset,\n-                                  StringBuilder* builder, int64_t* end_offset,\n-                                  bool* have_bytes) {\n+                                  bool check_valid, StringBuilder* builder,\n+                                  int64_t* end_offset, bool* have_bytes) {\n   PyObject* obj;\n \n   Ndarray1DIndexer<PyObject*> objects(arr);\n@@ -256,8 +259,7 @@ static Status AppendObjectStrings(PyArrayObject* arr, PyArrayObject* mask, int64\n       *have_bytes = true;\n     }\n     bool is_full;\n-    RETURN_NOT_OK(\n-        internal::BuilderAppend(builder, obj, false /* check_valid */, &is_full));\n+    RETURN_NOT_OK(internal::BuilderAppend(builder, obj, check_valid, &is_full));\n     if (is_full) {\n       break;\n     }\n@@ -844,6 +846,13 @@ Status NumPyConverter::ConvertObjectStrings() {\n   StringBuilder builder(pool_);\n   RETURN_NOT_OK(builder.Resize(length_));\n \n+  // If the creator of this NumPyConverter specified a type,\n+  // then we want to force the output type to be utf8. If\n+  // the input data is PyBytes and not PyUnicode and\n+  // not convertible to utf8, the call to AppendObjectStrings\n+  // below will fail because we pass force_string as the\n+  // value for check_valid.\n+  bool force_string = type_ != nullptr && type_->Equals(utf8());\n   bool global_have_bytes = false;\n   if (length_ == 0) {\n     // Produce an empty chunk\n@@ -854,8 +863,10 @@ Status NumPyConverter::ConvertObjectStrings() {\n     int64_t offset = 0;\n     while (offset < length_) {\n       bool chunk_have_bytes = false;\n-      RETURN_NOT_OK(\n-          AppendObjectStrings(arr_, mask_, offset, &builder, &offset, &chunk_have_bytes));\n+      // Always set check_valid to true when force_string is true\n+      RETURN_NOT_OK(AppendObjectStrings(arr_, mask_, offset,\n+                                        force_string /* check_valid */, &builder, &offset,\n+                                        &chunk_have_bytes));\n \n       global_have_bytes = global_have_bytes | chunk_have_bytes;\n       std::shared_ptr<Array> chunk;\n@@ -864,8 +875,13 @@ Status NumPyConverter::ConvertObjectStrings() {\n     }\n   }\n \n-  // If we saw PyBytes, convert everything to BinaryArray\n-  if (global_have_bytes) {\n+  // If we saw bytes, convert it to a binary array. If\n+  // force_string was set to true, the input data could\n+  // have been bytes but we've checked to make sure that\n+  // it can be converted to utf-8 in the call to\n+  // AppendObjectStrings. In that case, we can safely leave\n+  // it as a utf8 type.\n+  if (!force_string && global_have_bytes) {\n     for (size_t i = 0; i < out_arrays_.size(); ++i) {\n       auto binary_data = out_arrays_[i]->data()->Copy();\n       binary_data->type = ::arrow::binary();\n@@ -1393,8 +1409,12 @@ inline Status NumPyConverter::ConvertTypedLists<NPY_OBJECT, StringType>(\n       RETURN_NOT_OK(CheckFlatNumpyArray(numpy_array, NPY_OBJECT));\n \n       int64_t offset = 0;\n-      RETURN_NOT_OK(AppendObjectStrings(numpy_array, nullptr, 0, value_builder, &offset,\n-                                        &have_bytes));\n+      // If a type was specified and it was utf8, then we set\n+      // check_valid to true. If any of the input cannot be\n+      // converted, then we will exit early here.\n+      bool check_valid = type_ != nullptr && type_->Equals(::arrow::utf8());\n+      RETURN_NOT_OK(AppendObjectStrings(numpy_array, nullptr, 0, check_valid,\n+                                        value_builder, &offset, &have_bytes));\n       if (offset < PyArray_SIZE(numpy_array)) {\n         return Status::Invalid(\"Array cell value exceeded 2GB\");\n       }\ndiff --git a/python/pyarrow/tests/test_convert_pandas.py b/python/pyarrow/tests/test_convert_pandas.py\nindex c6e2b75be..83a6c458c 100644\n--- a/python/pyarrow/tests/test_convert_pandas.py\n+++ b/python/pyarrow/tests/test_convert_pandas.py\n@@ -1188,6 +1188,21 @@ def test_table_str_to_categorical_with_na(self):\n             table.to_pandas(strings_to_categorical=True,\n                             zero_copy_only=True)\n \n+    # Regression test for ARROW-2101\n+    def test_array_of_bytes_to_strings(self):\n+        converted = pa.array(np.array([b'x'], dtype=object), pa.string())\n+        assert converted.type == pa.string()\n+\n+    # Make sure that if an ndarray of bytes is passed to the array\n+    # constructor and the type is string, it will fail if those bytes\n+    # cannot be converted to utf-8\n+    def test_array_of_bytes_to_strings_bad_data(self):\n+        with pytest.raises(\n+                pa.lib.ArrowException,\n+                message=\"Unknown error: 'utf-8' codec can't decode byte 0x80 \"\n+                \"in position 0: invalid start byte\"):\n+            pa.array(np.array([b'\\x80\\x81'], dtype=object), pa.string())\n+\n \n class TestConvertDecimalTypes(object):\n     \"\"\"\n\n\n \n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "created": "2018-04-16T10:11:59.123+0000",
                    "updated": "2018-04-16T10:11:59.123+0000"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13136651/comment/16439225",
                    "id": "16439225",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=apitrou",
                        "name": "apitrou",
                        "key": "pitrou",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=pitrou&avatarId=35049",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=pitrou&avatarId=35049",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=pitrou&avatarId=35049",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=pitrou&avatarId=35049"
                        },
                        "displayName": "Antoine Pitrou",
                        "active": true,
                        "timeZone": "Europe/Paris"
                    },
                    "body": "Issue resolved by pull request 1886\n[https://github.com/apache/arrow/pull/1886]",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=apitrou",
                        "name": "apitrou",
                        "key": "pitrou",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=pitrou&avatarId=35049",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=pitrou&avatarId=35049",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=pitrou&avatarId=35049",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=pitrou&avatarId=35049"
                        },
                        "displayName": "Antoine Pitrou",
                        "active": true,
                        "timeZone": "Europe/Paris"
                    },
                    "created": "2018-04-16T10:12:00.179+0000",
                    "updated": "2018-04-16T10:12:00.179+0000"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13136651/comment/16439227",
                    "id": "16439227",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "body": "pitrou commented on issue #1886: ARROW-2101: [Python/C++] Correctly convert numpy arrays of bytes to arrow arrays of strings when user specifies arrow type of string\nURL: https://github.com/apache/arrow/pull/1886#issuecomment-381550267\n \n \n   Thank you @joshuastorck !\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "created": "2018-04-16T10:13:50.188+0000",
                    "updated": "2018-04-16T10:13:50.188+0000"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13136651/comment/16439735",
                    "id": "16439735",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "body": "BryanCutler commented on issue #1886: ARROW-2101: [Python/C++] Correctly convert numpy arrays of bytes to arrow arrays of strings when user specifies arrow type of string\nURL: https://github.com/apache/arrow/pull/1886#issuecomment-381681329\n \n \n   Thanks for the clarification of Python 2 behaviour @xhochy , and thanks for the fix @joshuastorck ! \n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "created": "2018-04-16T17:16:07.516+0000",
                    "updated": "2018-04-16T17:16:07.516+0000"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13136651/comment/16439743",
                    "id": "16439743",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "body": "BryanCutler commented on issue #1886: ARROW-2101: [Python/C++] Correctly convert numpy arrays of bytes to arrow arrays of strings when user specifies arrow type of string\nURL: https://github.com/apache/arrow/pull/1886#issuecomment-381682065\n \n \n   @joshuastorck , what is your JIRA username so I can assign the issue to you?\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "created": "2018-04-16T17:18:32.236+0000",
                    "updated": "2018-04-16T17:18:32.236+0000"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13136651/comment/16439856",
                    "id": "16439856",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "body": "joshuastorck commented on issue #1886: ARROW-2101: [Python/C++] Correctly convert numpy arrays of bytes to arrow arrays of strings when user specifies arrow type of string\nURL: https://github.com/apache/arrow/pull/1886#issuecomment-381708268\n \n \n   @BryanCutler, my JIRA username is joshuastorck\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "created": "2018-04-16T18:44:41.534+0000",
                    "updated": "2018-04-16T18:44:41.534+0000"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13136651/comment/16439912",
                    "id": "16439912",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "body": "BryanCutler commented on issue #1886: ARROW-2101: [Python/C++] Correctly convert numpy arrays of bytes to arrow arrays of strings when user specifies arrow type of string\nURL: https://github.com/apache/arrow/pull/1886#issuecomment-381719872\n \n \n   It looks like you need to be given rights to have issues assigned, and I guess I'm not able to do that.  @pitrou or @xhochy , would you mind doing this?\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "created": "2018-04-16T19:24:18.875+0000",
                    "updated": "2018-04-16T19:24:18.875+0000"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13136651/comment/16439914",
                    "id": "16439914",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "body": "pitrou commented on issue #1886: ARROW-2101: [Python/C++] Correctly convert numpy arrays of bytes to arrow arrays of strings when user specifies arrow type of string\nURL: https://github.com/apache/arrow/pull/1886#issuecomment-381720123\n \n \n   I'm not able to it either, but I think @xhochy  is :-)\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "created": "2018-04-16T19:25:11.616+0000",
                    "updated": "2018-04-16T19:25:11.616+0000"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13136651/comment/16440981",
                    "id": "16440981",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "body": "xhochy commented on issue #1886: ARROW-2101: [Python/C++] Correctly convert numpy arrays of bytes to arrow arrays of strings when user specifies arrow type of string\nURL: https://github.com/apache/arrow/pull/1886#issuecomment-382027194\n \n \n   @joshuastorck Gave you the necessary karma and assigned the issue to you, too.\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "created": "2018-04-17T15:06:34.306+0000",
                    "updated": "2018-04-17T15:06:34.306+0000"
                }
            ],
            "maxResults": 36,
            "total": 36,
            "startAt": 0
        },
        "customfield_12311820": "0|i3pv3r:",
        "customfield_12314139": null
    }
}