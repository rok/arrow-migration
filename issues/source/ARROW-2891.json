{
    "expand": "operations,versionedRepresentations,editmeta,changelog,renderedFields",
    "id": "13173576",
    "self": "https://issues.apache.org/jira/rest/api/2/issue/13173576",
    "key": "ARROW-2891",
    "fields": {
        "fixVersions": [
            {
                "self": "https://issues.apache.org/jira/rest/api/2/version/12342562",
                "id": "12342562",
                "description": "",
                "name": "0.10.0",
                "archived": false,
                "released": true,
                "releaseDate": "2018-08-06"
            }
        ],
        "resolution": {
            "self": "https://issues.apache.org/jira/rest/api/2/resolution/1",
            "id": "1",
            "description": "A fix for this issue is checked into the tree and tested.",
            "name": "Fixed"
        },
        "customfield_12312322": null,
        "customfield_12312323": null,
        "customfield_12312320": null,
        "customfield_12310420": "9223372036854775807",
        "customfield_12312321": null,
        "customfield_12312328": null,
        "customfield_12312329": null,
        "customfield_12312326": null,
        "customfield_12310300": null,
        "customfield_12312327": null,
        "customfield_12312324": null,
        "customfield_12312720": null,
        "customfield_12312325": null,
        "lastViewed": null,
        "priority": {
            "self": "https://issues.apache.org/jira/rest/api/2/priority/3",
            "iconUrl": "https://issues.apache.org/jira/images/icons/priorities/major.svg",
            "name": "Major",
            "id": "3"
        },
        "labels": [
            "pull-request-available"
        ],
        "customfield_12312333": null,
        "customfield_12312334": null,
        "customfield_12313422": "false",
        "customfield_12310310": "0.0",
        "customfield_12312331": null,
        "customfield_12312332": null,
        "aggregatetimeoriginalestimate": null,
        "timeestimate": 0,
        "customfield_12312330": null,
        "versions": [
            {
                "self": "https://issues.apache.org/jira/rest/api/2/version/12341707",
                "id": "12341707",
                "description": "",
                "name": "0.9.0",
                "archived": false,
                "released": true,
                "releaseDate": "2018-03-19"
            }
        ],
        "customfield_12311120": null,
        "customfield_12313826": null,
        "customfield_12312339": null,
        "issuelinks": [
            {
                "id": "12560392",
                "self": "https://issues.apache.org/jira/rest/api/2/issueLink/12560392",
                "type": {
                    "id": "12310000",
                    "name": "Duplicate",
                    "inward": "is duplicated by",
                    "outward": "duplicates",
                    "self": "https://issues.apache.org/jira/rest/api/2/issueLinkType/12310000"
                },
                "outwardIssue": {
                    "id": "13184145",
                    "key": "ARROW-3210",
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13184145",
                    "fields": {
                        "summary": "[Python] Creating ParquetDataset creates partitioned ParquetFiles with mismatched Parquet schemas",
                        "status": {
                            "self": "https://issues.apache.org/jira/rest/api/2/status/6",
                            "description": "The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.",
                            "iconUrl": "https://issues.apache.org/jira/images/icons/statuses/closed.png",
                            "name": "Closed",
                            "id": "6",
                            "statusCategory": {
                                "self": "https://issues.apache.org/jira/rest/api/2/statuscategory/3",
                                "id": 3,
                                "key": "done",
                                "colorName": "green",
                                "name": "Done"
                            }
                        },
                        "priority": {
                            "self": "https://issues.apache.org/jira/rest/api/2/priority/3",
                            "iconUrl": "https://issues.apache.org/jira/images/icons/priorities/major.svg",
                            "name": "Major",
                            "id": "3"
                        },
                        "issuetype": {
                            "self": "https://issues.apache.org/jira/rest/api/2/issuetype/1",
                            "id": "1",
                            "description": "A problem which impairs or prevents the functions of the product.",
                            "iconUrl": "https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype",
                            "name": "Bug",
                            "subtask": false,
                            "avatarId": 21133
                        }
                    }
                }
            }
        ],
        "customfield_12313825": null,
        "assignee": {
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=jkulzick",
            "name": "jkulzick",
            "key": "jkulzick",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
            },
            "displayName": "Jonathan Kulzick",
            "active": true,
            "timeZone": "America/Chicago"
        },
        "customfield_12312337": null,
        "customfield_12313823": null,
        "customfield_12312338": null,
        "customfield_12311920": null,
        "customfield_12313822": null,
        "customfield_12312335": null,
        "customfield_12313821": null,
        "customfield_12312336": null,
        "customfield_12313820": null,
        "status": {
            "self": "https://issues.apache.org/jira/rest/api/2/status/5",
            "description": "A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.",
            "iconUrl": "https://issues.apache.org/jira/images/icons/statuses/resolved.png",
            "name": "Resolved",
            "id": "5",
            "statusCategory": {
                "self": "https://issues.apache.org/jira/rest/api/2/statuscategory/3",
                "id": 3,
                "key": "done",
                "colorName": "green",
                "name": "Done"
            }
        },
        "components": [
            {
                "self": "https://issues.apache.org/jira/rest/api/2/component/12328936",
                "id": "12328936",
                "name": "Python"
            }
        ],
        "customfield_12312026": null,
        "customfield_12312023": null,
        "customfield_12312024": null,
        "aggregatetimeestimate": 0,
        "customfield_12312022": null,
        "customfield_12310921": null,
        "customfield_12310920": "9223372036854775807",
        "customfield_12312823": null,
        "creator": {
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=jkulzick",
            "name": "jkulzick",
            "key": "jkulzick",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
            },
            "displayName": "Jonathan Kulzick",
            "active": true,
            "timeZone": "America/Chicago"
        },
        "subtasks": [],
        "reporter": {
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=jkulzick",
            "name": "jkulzick",
            "key": "jkulzick",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
            },
            "displayName": "Jonathan Kulzick",
            "active": true,
            "timeZone": "America/Chicago"
        },
        "aggregateprogress": {
            "progress": 6600,
            "total": 6600,
            "percent": 100
        },
        "customfield_12313520": null,
        "customfield_12310250": null,
        "progress": {
            "progress": 6600,
            "total": 6600,
            "percent": 100
        },
        "customfield_12313924": null,
        "votes": {
            "self": "https://issues.apache.org/jira/rest/api/2/issue/ARROW-2891/votes",
            "votes": 0,
            "hasVoted": false
        },
        "worklog": {
            "startAt": 0,
            "maxResults": 20,
            "total": 11,
            "worklogs": [
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13173576/worklog/125811",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "jkulzick opened a new pull request #2302: ARROW-2891: [Python] Preserve schema in write_to_dataset\nURL: https://github.com/apache/arrow/pull/2302\n \n \n   \n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2018-07-22T18:55:49.738+0000",
                    "updated": "2018-07-22T18:55:49.738+0000",
                    "started": "2018-07-22T18:55:49.738+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "125811",
                    "issueId": "13173576"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13173576/worklog/125820",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "codecov-io commented on issue #2302: ARROW-2891: [Python] Preserve schema in write_to_dataset\nURL: https://github.com/apache/arrow/pull/2302#issuecomment-406894858\n \n \n   # [Codecov](https://codecov.io/gh/apache/arrow/pull/2302?src=pr&el=h1) Report\n   > Merging [#2302](https://codecov.io/gh/apache/arrow/pull/2302?src=pr&el=desc) into [master](https://codecov.io/gh/apache/arrow/commit/2ff870806c37ff204c72f2658eada5ab5c5da062?src=pr&el=desc) will **increase** coverage by `2.39%`.\n   > The diff coverage is `100%`.\n   \n   [![Impacted file tree graph](https://codecov.io/gh/apache/arrow/pull/2302/graphs/tree.svg?src=pr&width=650&token=LpTCFbqVT1&height=150)](https://codecov.io/gh/apache/arrow/pull/2302?src=pr&el=tree)\n   \n   ```diff\n   @@            Coverage Diff            @@\n   ##           master   #2302      +/-   ##\n   =========================================\n   + Coverage    84.4%   86.8%   +2.39%     \n   =========================================\n     Files         293     237      -56     \n     Lines       44652   41918    -2734     \n   =========================================\n   - Hits        37688   36386    -1302     \n   + Misses       6933    5532    -1401     \n   + Partials       31       0      -31\n   ```\n   \n   \n   | [Impacted Files](https://codecov.io/gh/apache/arrow/pull/2302?src=pr&el=tree) | Coverage \u0394 | |\n   |---|---|---|\n   | [python/pyarrow/tests/test\\_parquet.py](https://codecov.io/gh/apache/arrow/pull/2302/diff?src=pr&el=tree#diff-cHl0aG9uL3B5YXJyb3cvdGVzdHMvdGVzdF9wYXJxdWV0LnB5) | `96.97% <100%> (\u00f8)` | :arrow_up: |\n   | [python/pyarrow/parquet.py](https://codecov.io/gh/apache/arrow/pull/2302/diff?src=pr&el=tree#diff-cHl0aG9uL3B5YXJyb3cvcGFycXVldC5weQ==) | `90.54% <100%> (+0.07%)` | :arrow_up: |\n   | [cpp/src/arrow/util/thread-pool-test.cc](https://codecov.io/gh/apache/arrow/pull/2302/diff?src=pr&el=tree#diff-Y3BwL3NyYy9hcnJvdy91dGlsL3RocmVhZC1wb29sLXRlc3QuY2M=) | `98.91% <0%> (-0.55%)` | :arrow_down: |\n   | [go/arrow/math/int64.go](https://codecov.io/gh/apache/arrow/pull/2302/diff?src=pr&el=tree#diff-Z28vYXJyb3cvbWF0aC9pbnQ2NC5nbw==) | | |\n   | [go/arrow/array/numeric.gen.go](https://codecov.io/gh/apache/arrow/pull/2302/diff?src=pr&el=tree#diff-Z28vYXJyb3cvYXJyYXkvbnVtZXJpYy5nZW4uZ28=) | | |\n   | [rust/src/array.rs](https://codecov.io/gh/apache/arrow/pull/2302/diff?src=pr&el=tree#diff-cnVzdC9zcmMvYXJyYXkucnM=) | | |\n   | [go/arrow/type\\_string.go](https://codecov.io/gh/apache/arrow/pull/2302/diff?src=pr&el=tree#diff-Z28vYXJyb3cvdHlwZV9zdHJpbmcuZ28=) | | |\n   | [go/arrow/array/data.go](https://codecov.io/gh/apache/arrow/pull/2302/diff?src=pr&el=tree#diff-Z28vYXJyb3cvYXJyYXkvZGF0YS5nbw==) | | |\n   | [go/arrow/math/uint64\\_amd64.go](https://codecov.io/gh/apache/arrow/pull/2302/diff?src=pr&el=tree#diff-Z28vYXJyb3cvbWF0aC91aW50NjRfYW1kNjQuZ28=) | | |\n   | [go/arrow/datatype\\_numeric.gen.go](https://codecov.io/gh/apache/arrow/pull/2302/diff?src=pr&el=tree#diff-Z28vYXJyb3cvZGF0YXR5cGVfbnVtZXJpYy5nZW4uZ28=) | | |\n   | ... and [50 more](https://codecov.io/gh/apache/arrow/pull/2302/diff?src=pr&el=tree-more) | |\n   \n   ------\n   \n   [Continue to review full report at Codecov](https://codecov.io/gh/apache/arrow/pull/2302?src=pr&el=continue).\n   > **Legend** - [Click here to learn more](https://docs.codecov.io/docs/codecov-delta)\n   > `\u0394 = absolute <relative> (impact)`, `\u00f8 = not affected`, `? = missing data`\n   > Powered by [Codecov](https://codecov.io/gh/apache/arrow/pull/2302?src=pr&el=footer). Last update [2ff8708...83d0048](https://codecov.io/gh/apache/arrow/pull/2302?src=pr&el=lastupdated). Read the [comment docs](https://docs.codecov.io/docs/pull-request-comments).\n   \n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2018-07-22T20:37:04.930+0000",
                    "updated": "2018-07-22T20:37:04.930+0000",
                    "started": "2018-07-22T20:37:04.929+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "125820",
                    "issueId": "13173576"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13173576/worklog/125890",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "xhochy commented on a change in pull request #2302: ARROW-2891: [Python] Preserve schema in write_to_dataset\nURL: https://github.com/apache/arrow/pull/2302#discussion_r204292036\n \n \n\n ##########\n File path: python/pyarrow/parquet.py\n ##########\n @@ -1137,14 +1138,21 @@ def write_to_dataset(table, root_path, partition_cols=None,\n         data_cols = df.columns.drop(partition_cols)\n         if len(data_cols) == 0:\n             raise ValueError(\"No data left to save outside partition columns\")\n+        subschema = copy(table.schema)\n \n Review comment:\n   No need to copy the schema. It is immutable and thus, in the lines below you create a new instance.\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2018-07-23T06:27:13.390+0000",
                    "updated": "2018-07-23T06:27:13.390+0000",
                    "started": "2018-07-23T06:27:13.390+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "125890",
                    "issueId": "13173576"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13173576/worklog/126049",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "codecov-io edited a comment on issue #2302: ARROW-2891: [Python] Preserve schema in write_to_dataset\nURL: https://github.com/apache/arrow/pull/2302#issuecomment-406894858\n \n \n   # [Codecov](https://codecov.io/gh/apache/arrow/pull/2302?src=pr&el=h1) Report\n   > Merging [#2302](https://codecov.io/gh/apache/arrow/pull/2302?src=pr&el=desc) into [master](https://codecov.io/gh/apache/arrow/commit/2ff870806c37ff204c72f2658eada5ab5c5da062?src=pr&el=desc) will **increase** coverage by `2.36%`.\n   > The diff coverage is `100%`.\n   \n   [![Impacted file tree graph](https://codecov.io/gh/apache/arrow/pull/2302/graphs/tree.svg?width=650&height=150&src=pr&token=LpTCFbqVT1)](https://codecov.io/gh/apache/arrow/pull/2302?src=pr&el=tree)\n   \n   ```diff\n   @@            Coverage Diff             @@\n   ##           master    #2302      +/-   ##\n   ==========================================\n   + Coverage    84.4%   86.76%   +2.36%     \n   ==========================================\n     Files         293      237      -56     \n     Lines       44652    42006    -2646     \n   ==========================================\n   - Hits        37688    36448    -1240     \n   + Misses       6933     5558    -1375     \n   + Partials       31        0      -31\n   ```\n   \n   \n   | [Impacted Files](https://codecov.io/gh/apache/arrow/pull/2302?src=pr&el=tree) | Coverage \u0394 | |\n   |---|---|---|\n   | [python/pyarrow/tests/test\\_parquet.py](https://codecov.io/gh/apache/arrow/pull/2302/diff?src=pr&el=tree#diff-cHl0aG9uL3B5YXJyb3cvdGVzdHMvdGVzdF9wYXJxdWV0LnB5) | `96.97% <100%> (\u00f8)` | :arrow_up: |\n   | [python/pyarrow/parquet.py](https://codecov.io/gh/apache/arrow/pull/2302/diff?src=pr&el=tree#diff-cHl0aG9uL3B5YXJyb3cvcGFycXVldC5weQ==) | `90.52% <100%> (+0.05%)` | :arrow_up: |\n   | [python/pyarrow/io.pxi](https://codecov.io/gh/apache/arrow/pull/2302/diff?src=pr&el=tree#diff-cHl0aG9uL3B5YXJyb3cvaW8ucHhp) | `60.56% <0%> (-1.63%)` | :arrow_down: |\n   | [rust/src/array.rs](https://codecov.io/gh/apache/arrow/pull/2302/diff?src=pr&el=tree#diff-cnVzdC9zcmMvYXJyYXkucnM=) | | |\n   | [go/arrow/datatype\\_binary.go](https://codecov.io/gh/apache/arrow/pull/2302/diff?src=pr&el=tree#diff-Z28vYXJyb3cvZGF0YXR5cGVfYmluYXJ5Lmdv) | | |\n   | [go/arrow/internal/testing/tools/bits.go](https://codecov.io/gh/apache/arrow/pull/2302/diff?src=pr&el=tree#diff-Z28vYXJyb3cvaW50ZXJuYWwvdGVzdGluZy90b29scy9iaXRzLmdv) | | |\n   | [go/arrow/math/int64\\_amd64.go](https://codecov.io/gh/apache/arrow/pull/2302/diff?src=pr&el=tree#diff-Z28vYXJyb3cvbWF0aC9pbnQ2NF9hbWQ2NC5nbw==) | | |\n   | [go/arrow/math/int64\\_avx2\\_amd64.go](https://codecov.io/gh/apache/arrow/pull/2302/diff?src=pr&el=tree#diff-Z28vYXJyb3cvbWF0aC9pbnQ2NF9hdngyX2FtZDY0Lmdv) | | |\n   | [go/arrow/array/binary.go](https://codecov.io/gh/apache/arrow/pull/2302/diff?src=pr&el=tree#diff-Z28vYXJyb3cvYXJyYXkvYmluYXJ5Lmdv) | | |\n   | [go/arrow/math/uint64\\_sse4\\_amd64.go](https://codecov.io/gh/apache/arrow/pull/2302/diff?src=pr&el=tree#diff-Z28vYXJyb3cvbWF0aC91aW50NjRfc3NlNF9hbWQ2NC5nbw==) | | |\n   | ... and [52 more](https://codecov.io/gh/apache/arrow/pull/2302/diff?src=pr&el=tree-more) | |\n   \n   ------\n   \n   [Continue to review full report at Codecov](https://codecov.io/gh/apache/arrow/pull/2302?src=pr&el=continue).\n   > **Legend** - [Click here to learn more](https://docs.codecov.io/docs/codecov-delta)\n   > `\u0394 = absolute <relative> (impact)`, `\u00f8 = not affected`, `? = missing data`\n   > Powered by [Codecov](https://codecov.io/gh/apache/arrow/pull/2302?src=pr&el=footer). Last update [2ff8708...09ff40c](https://codecov.io/gh/apache/arrow/pull/2302?src=pr&el=lastupdated). Read the [comment docs](https://docs.codecov.io/docs/pull-request-comments).\n   \n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2018-07-23T14:33:32.539+0000",
                    "updated": "2018-07-23T14:33:32.539+0000",
                    "started": "2018-07-23T14:33:32.538+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "126049",
                    "issueId": "13173576"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13173576/worklog/126105",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "xhochy closed pull request #2302: ARROW-2891: [Python] Preserve schema in write_to_dataset\nURL: https://github.com/apache/arrow/pull/2302\n \n \n   \n\nThis is a PR merged from a forked repository.\nAs GitHub hides the original diff on merge, it is displayed below for\nthe sake of provenance:\n\nAs this is a foreign pull request (from a fork), the diff is supplied\nbelow (as it won't show otherwise due to GitHub magic):\n\ndiff --git a/python/pyarrow/parquet.py b/python/pyarrow/parquet.py\nindex f97c871ad4..85cec6712b 100644\n--- a/python/pyarrow/parquet.py\n+++ b/python/pyarrow/parquet.py\n@@ -1137,6 +1137,12 @@ def write_to_dataset(table, root_path, partition_cols=None,\n         data_cols = df.columns.drop(partition_cols)\n         if len(data_cols) == 0:\n             raise ValueError(\"No data left to save outside partition columns\")\n+        subschema = table.schema\n+        # ARROW-2891: Ensure the output_schema is preserved when writing a\n+        # partitioned dataset\n+        for partition_col in partition_cols:\n+            subschema = subschema.remove(\n+                subschema.get_field_index(partition_col))\n         for keys, subgroup in data_df.groupby(partition_keys):\n             if not isinstance(keys, tuple):\n                 keys = (keys,)\n@@ -1144,7 +1150,8 @@ def write_to_dataset(table, root_path, partition_cols=None,\n                 [\"{colname}={value}\".format(colname=name, value=val)\n                  for name, val in zip(partition_cols, keys)])\n             subtable = Table.from_pandas(subgroup,\n-                                         preserve_index=preserve_index)\n+                                         preserve_index=preserve_index,\n+                                         schema=subschema)\n             prefix = \"/\".join([root_path, subdir])\n             _mkdir_if_not_exists(fs, prefix)\n             outfile = compat.guid() + \".parquet\"\ndiff --git a/python/pyarrow/tests/test_parquet.py b/python/pyarrow/tests/test_parquet.py\nindex fec65b93cb..d6ca7dd8fd 100644\n--- a/python/pyarrow/tests/test_parquet.py\n+++ b/python/pyarrow/tests/test_parquet.py\n@@ -1731,18 +1731,21 @@ def test_read_table_doesnt_warn():\n     assert len(record) == 0\n \n \n-def _test_write_to_dataset_with_partitions(base_path, filesystem=None):\n+def _test_write_to_dataset_with_partitions(base_path,\n+                                           filesystem=None,\n+                                           schema=None):\n     # ARROW-1400\n     import pyarrow.parquet as pq\n \n     output_df = pd.DataFrame({'group1': list('aaabbbbccc'),\n                               'group2': list('eefeffgeee'),\n                               'num': list(range(10)),\n+                              'nan': [pd.np.nan] * 10,\n                               'date': np.arange('2017-01-01', '2017-01-11',\n                                                 dtype='datetime64[D]')})\n     cols = output_df.columns.tolist()\n     partition_by = ['group1', 'group2']\n-    output_table = pa.Table.from_pandas(output_df)\n+    output_table = pa.Table.from_pandas(output_df, schema=schema)\n     pq.write_to_dataset(output_table, base_path, partition_by,\n                         filesystem=filesystem)\n \n@@ -1754,7 +1757,11 @@ def _test_write_to_dataset_with_partitions(base_path, filesystem=None):\n     else:\n         pq.write_metadata(output_table.schema, metadata_path)\n \n-    dataset = pq.ParquetDataset(base_path, filesystem=filesystem)\n+    # ARROW-2891: Ensure the output_schema is preserved when writing a\n+    # partitioned dataset\n+    dataset = pq.ParquetDataset(base_path,\n+                                filesystem=filesystem,\n+                                validate_schema=True)\n     # ARROW-2209: Ensure the dataset schema also includes the partition columns\n     dataset_cols = set(dataset.schema.to_arrow_schema().names)\n     assert dataset_cols == set(output_table.schema.names)\n@@ -1813,6 +1820,16 @@ def test_write_to_dataset_with_partitions(tmpdir):\n     _test_write_to_dataset_with_partitions(str(tmpdir))\n \n \n+@parquet\n+def test_write_to_dataset_with_partitions_and_schema(tmpdir):\n+    schema = pa.schema([pa.field('group1', type=pa.string()),\n+                        pa.field('group2', type=pa.string()),\n+                        pa.field('num', type=pa.int64()),\n+                        pa.field('nan', type=pa.int32()),\n+                        pa.field('date', type=pa.timestamp(unit='us'))])\n+    _test_write_to_dataset_with_partitions(str(tmpdir), schema=schema)\n+\n+\n @parquet\n def test_write_to_dataset_no_partitions(tmpdir):\n     _test_write_to_dataset_no_partitions(str(tmpdir))\n\n\n \n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2018-07-23T16:32:30.454+0000",
                    "updated": "2018-07-23T16:32:30.454+0000",
                    "started": "2018-07-23T16:32:30.453+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "126105",
                    "issueId": "13173576"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13173576/worklog/126109",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "xhochy commented on issue #2302: ARROW-2891: [Python] Preserve schema in write_to_dataset\nURL: https://github.com/apache/arrow/pull/2302#issuecomment-407120489\n \n \n   @jkulzick Thank you for having the patience to fix this!\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2018-07-23T16:34:12.379+0000",
                    "updated": "2018-07-23T16:34:12.379+0000",
                    "started": "2018-07-23T16:34:12.379+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "126109",
                    "issueId": "13173576"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13173576/worklog/126116",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "jkulzick commented on issue #2302: ARROW-2891: [Python] Preserve schema in write_to_dataset\nURL: https://github.com/apache/arrow/pull/2302#issuecomment-407122422\n \n \n   @xhochy Happy to contribute. Thanks for this great package!\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2018-07-23T16:40:26.658+0000",
                    "updated": "2018-07-23T16:40:26.658+0000",
                    "started": "2018-07-23T16:40:26.657+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "126116",
                    "issueId": "13173576"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13173576/worklog/126187",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "wesm commented on issue #2302: ARROW-2891: [Python] Preserve schema in write_to_dataset\nURL: https://github.com/apache/arrow/pull/2302#issuecomment-407152767\n \n \n   Thanks @jkulzick! \n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2018-07-23T18:17:48.471+0000",
                    "updated": "2018-07-23T18:17:48.471+0000",
                    "started": "2018-07-23T18:17:48.470+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "126187",
                    "issueId": "13173576"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13173576/worklog/127616",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "ScubaDrew commented on issue #2302: ARROW-2891: [Python] Preserve schema in write_to_dataset\nURL: https://github.com/apache/arrow/pull/2302#issuecomment-407943903\n \n \n   Thank you @jkulzick -- running into this issue right now!\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2018-07-26T01:08:33.559+0000",
                    "updated": "2018-07-26T01:08:33.559+0000",
                    "started": "2018-07-26T01:08:33.558+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "127616",
                    "issueId": "13173576"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13173576/worklog/128980",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "ScubaDrew commented on issue #2302: ARROW-2891: [Python] Preserve schema in write_to_dataset\nURL: https://github.com/apache/arrow/pull/2302#issuecomment-409028495\n \n \n   I've looked everywhere I could think of. Is there any place which provides an estimation of when the next release including this fix might be made? -- Thanks!\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2018-07-30T22:10:20.287+0000",
                    "updated": "2018-07-30T22:10:20.287+0000",
                    "started": "2018-07-30T22:10:20.286+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "128980",
                    "issueId": "13173576"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13173576/worklog/131282",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "wesm commented on issue #2302: ARROW-2891: [Python] Preserve schema in write_to_dataset\nURL: https://github.com/apache/arrow/pull/2302#issuecomment-410545345\n \n \n   @ScubaDrew please follow on the mailing list. The release is being voted on and should be up this coming week (week of August 6). Note that we provide all the infrastructure you need to build your own Python wheels in between releases\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2018-08-05T20:22:33.947+0000",
                    "updated": "2018-08-05T20:22:33.947+0000",
                    "started": "2018-08-05T20:22:33.947+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "131282",
                    "issueId": "13173576"
                }
            ]
        },
        "customfield_12313920": null,
        "issuetype": {
            "self": "https://issues.apache.org/jira/rest/api/2/issuetype/1",
            "id": "1",
            "description": "A problem which impairs or prevents the functions of the product.",
            "iconUrl": "https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype",
            "name": "Bug",
            "subtask": false,
            "avatarId": 21133
        },
        "timespent": 6600,
        "customfield_12314020": "{summaryBean=com.atlassian.jira.plugin.devstatus.rest.SummaryBean@79d05cd3[summary={pullrequest=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@154b5b2b[overall=PullRequestOverallBean{stateCount=0, state='OPEN', details=PullRequestOverallDetails{openCount=0, mergedCount=0, declinedCount=0}},byInstanceType={}], build=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@332d837c[overall=com.atlassian.jira.plugin.devstatus.summary.beans.BuildOverallBean@7c701431[failedBuildCount=0,successfulBuildCount=0,unknownBuildCount=0,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], review=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@16593f51[overall=com.atlassian.jira.plugin.devstatus.summary.beans.ReviewsOverallBean@5d315e3d[stateCount=0,state=<null>,dueDate=<null>,overDue=false,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], deployment-environment=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@2580084[overall=com.atlassian.jira.plugin.devstatus.summary.beans.DeploymentOverallBean@7ef54d62[topEnvironments=[],showProjects=false,successfulCount=0,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], repository=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@2109565a[overall=com.atlassian.jira.plugin.devstatus.summary.beans.CommitOverallBean@761e24f0[count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], branch=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@34804697[overall=com.atlassian.jira.plugin.devstatus.summary.beans.BranchOverallBean@60ca8338[count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}]},errors=[],configErrors=[]], devSummaryJson={\"cachedValue\":{\"errors\":[],\"configErrors\":[],\"summary\":{\"pullrequest\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"stateCount\":0,\"state\":\"OPEN\",\"details\":{\"openCount\":0,\"mergedCount\":0,\"declinedCount\":0,\"total\":0},\"open\":true},\"byInstanceType\":{}},\"build\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"failedBuildCount\":0,\"successfulBuildCount\":0,\"unknownBuildCount\":0},\"byInstanceType\":{}},\"review\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"stateCount\":0,\"state\":null,\"dueDate\":null,\"overDue\":false,\"completed\":false},\"byInstanceType\":{}},\"deployment-environment\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"topEnvironments\":[],\"showProjects\":false,\"successfulCount\":0},\"byInstanceType\":{}},\"repository\":{\"overall\":{\"count\":0,\"lastUpdated\":null},\"byInstanceType\":{}},\"branch\":{\"overall\":{\"count\":0,\"lastUpdated\":null},\"byInstanceType\":{}}}},\"isStale\":false}}",
        "customfield_12314141": null,
        "customfield_12314140": null,
        "project": {
            "self": "https://issues.apache.org/jira/rest/api/2/project/12319525",
            "id": "12319525",
            "key": "ARROW",
            "name": "Apache Arrow",
            "projectTypeKey": "software",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/projectavatar?pid=12319525&avatarId=10011",
                "24x24": "https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12319525&avatarId=10011",
                "16x16": "https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12319525&avatarId=10011",
                "32x32": "https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12319525&avatarId=10011"
            },
            "projectCategory": {
                "self": "https://issues.apache.org/jira/rest/api/2/projectCategory/13960",
                "id": "13960",
                "description": "Apache Arrow",
                "name": "Arrow"
            }
        },
        "aggregatetimespent": 6600,
        "customfield_12312520": null,
        "customfield_12312521": "Mon Jul 23 16:32:27 UTC 2018",
        "customfield_12314422": null,
        "customfield_12314421": null,
        "customfield_12314146": null,
        "customfield_12314420": null,
        "customfield_12314145": null,
        "customfield_12314144": null,
        "customfield_12314143": null,
        "resolutiondate": "2018-07-23T16:32:27.000+0000",
        "workratio": -1,
        "customfield_12312923": null,
        "customfield_12312920": null,
        "customfield_12312921": null,
        "watches": {
            "self": "https://issues.apache.org/jira/rest/api/2/issue/ARROW-2891/watchers",
            "watchCount": 1,
            "isWatching": false
        },
        "created": "2018-07-21T04:40:15.000+0000",
        "updated": "2019-05-08T11:35:54.000+0000",
        "timeoriginalestimate": null,
        "description": "When using `pyarrow.parquet.write_to_dataset` with `partition_cols` set, the schema of the `table` passed into the function is not enforced when iterating over the `subgroup` to create the `subtable`. See\u00a0[here|[https://github.com/apache/arrow/blob/master/python/pyarrow/parquet.py#L1146]].\r\n\r\nSince pandas is used to generate the subtables, there is a risk that some specificity is lost from the original `table.schema` due to the data types supported by pandas and some of the internal type conversions pandas performs. It would be ideal if a `subschema` was generated from `table.schema` and passed to `Table` when instantiating the `subtable` to allow the user to enforce the original schema.\r\n\r\nHere is a simple example of where we are running into issues while trying to preserve a valid schema. This use case is more likely to occur when working with sparse data sets.\r\n\r\n\u00a0\r\n{code:java}\r\n>>> from io import StringIO\r\n>>> import pandas as pd\r\n>>> import numpy as np\r\n>>> import pyarrow as pa\r\n>>> import parquet as pq\r\n>>> import pyarrow.parquet as pq\r\n\r\n# in csv col2 has no NaNs and in csv_nan col2 only has NaNs\r\n>>> csv = StringIO('\"1\",\"10\",\"100\"')\r\n>>> csv_nan = StringIO('\"2\",\"\",\"200\"')\r\n\r\n# read in col2 as a float since pandas does not support NaNs in ints\r\n>>> pd_dtype = {'col1': np.int32, 'col2': np.float32, 'col3': np.int32}\r\n>>> df = pd.read_csv(csv, header=None, names=['col1', 'col2', 'col3'], dtype=pd_dtype)\r\n>>> df_nan = pd.read_csv(csv_nan, header=None, names=['col1', 'col2', 'col3'], dtype=pd_dtype)\r\n\r\n# verify both dfs and their dtypes\r\n>>> df\r\ncol1 col2 col3\r\n0 1 10.0 100\r\n\r\n>>> df.dtypes\r\ncol1 int32\r\ncol2 float32\r\ncol3 int32\r\ndtype: object\r\n\r\n>>> df_nan\r\ncol1 col2 col3\r\n0 2 NaN 200\r\n\r\n>>> df_nan.dtypes\r\ncol1 int32\r\ncol2 float32\r\ncol3 int32\r\ndtype: object\r\n\r\n# define col2 as an int32 since pyarrow does support NaNs in ints\r\n# we want to preserve the original schema we started with and not\r\n# upcast just because we're using pandas to go from csv to pyarrow\r\n>>> schema = pa.schema([pa.field('col1', type=pa.int32()),\r\npa.field('col2', type=pa.int32()),\r\npa.field('col3', type=pa.int32())])\r\n\r\n# verify schema\r\n>>> schema\r\ncol1: int32\r\ncol2: int32\r\ncol3: int32\r\n\r\n# create tables\r\n>>> table = pa.Table.from_pandas(df, schema=schema, preserve_index=False)\r\n>>> table_nan = pa.Table.from_pandas(df_nan, schema=schema, preserve_index=False)\r\n\r\n# verify table schemas and metadata\r\n# col2 has pandas_type int32 and numpy_type float32 in both tables\r\n>>> table\r\npyarrow.Table\r\ncol1: int32\r\ncol2: int32\r\ncol3: int32\r\nmetadata\r\n--------\r\n{b'pandas': b'{\"index_columns\": [], \"column_indexes\": [], \"columns\": [{\"name\":'\r\nb' \"col1\", \"field_name\": \"col1\", \"pandas_type\": \"int32\", \"numpy_ty'\r\nb'pe\": \"int32\", \"metadata\": null}, {\"name\": \"col2\", \"field_name\": '\r\nb'\"col2\", \"pandas_type\": \"int32\", \"numpy_type\": \"float32\", \"metada'\r\nb'ta\": null}, {\"name\": \"col3\", \"field_name\": \"col3\", \"pandas_type\"'\r\nb': \"int32\", \"numpy_type\": \"int32\", \"metadata\": null}], \"pandas_ve'\r\nb'rsion\": \"0.22.0\"}'}\r\n\r\n>>> table_nan\r\npyarrow.Table\r\ncol1: int32\r\ncol2: int32\r\ncol3: int32\r\nmetadata\r\n--------\r\n{b'pandas': b'{\"index_columns\": [], \"column_indexes\": [], \"columns\": [{\"name\":'\r\nb' \"col1\", \"field_name\": \"col1\", \"pandas_type\": \"int32\", \"numpy_ty'\r\nb'pe\": \"int32\", \"metadata\": null}, {\"name\": \"col2\", \"field_name\": '\r\nb'\"col2\", \"pandas_type\": \"int32\", \"numpy_type\": \"float32\", \"metada'\r\nb'ta\": null}, {\"name\": \"col3\", \"field_name\": \"col3\", \"pandas_type\"'\r\nb': \"int32\", \"numpy_type\": \"int32\", \"metadata\": null}], \"pandas_ve'\r\nb'rsion\": \"0.22.0\"}'}\r\n\r\n# write both tables to local filesystem\r\n>>> pq.write_to_dataset(table, '/Users/jkulzick/pyarrow_example',\r\npartition_cols=['col1'],\r\npreserve_index=False)\r\n>>> pq.write_to_dataset(table_nan, '/Users/jkulzick/pyarrow_example',\r\npartition_cols=['col1'],\r\npreserve_index=False)\r\n\r\n# read parquet files into a ParquetDataset to validate the schemas\r\n# the metadata and schemas for both files is different from their original tables\r\n# table now has pandas_type int32 and numpy_type int32 (was float32) for col2\r\n# table_nan now has pandas_type float64 (was int32) and numpy_type int64 (was float32) for col2\r\n>>> ds = pq.ParquetDataset('/Users/jkulzick/pyarrow_example')\r\nTraceback (most recent call last):\r\nFile \"<stdin>\", line 1, in <module>\r\nFile \"/Users/jkulzick/miniconda3/envs/bowerbird/lib/python3.6/site-packages/pyarrow/parquet.py\", line 745, in __init__\r\nself.validate_schemas()\r\nFile \"/Users/jkulzick/miniconda3/envs/bowerbird/lib/python3.6/site-packages/pyarrow/parquet.py\", line 775, in validate_schemas\r\ndataset_schema))\r\nValueError: Schema in partition[col1=1] /Users/jkulzick/pyarrow_example/col1=2/b7b42ce9de6a46a786a5361c42d28731.parquet was different. \r\ncol2: double\r\ncol3: int32\r\nmetadata\r\n--------\r\n{b'pandas': b'{\"index_columns\": [], \"column_indexes\": [], \"columns\": [{\"name\":'\r\nb' \"col2\", \"field_name\": \"col2\", \"pandas_type\": \"float64\", \"numpy_'\r\nb'type\": \"float64\", \"metadata\": null}, {\"name\": \"col3\", \"field_nam'\r\nb'e\": \"col3\", \"pandas_type\": \"int32\", \"numpy_type\": \"int32\", \"meta'\r\nb'data\": null}], \"pandas_version\": \"0.22.0\"}'}\r\n\r\nvs\r\n\r\ncol2: int32\r\ncol3: int32\r\nmetadata\r\n--------\r\n{b'pandas': b'{\"index_columns\": [], \"column_indexes\": [], \"columns\": [{\"name\":'\r\nb' \"col2\", \"field_name\": \"col2\", \"pandas_type\": \"int32\", \"numpy_ty'\r\nb'pe\": \"int32\", \"metadata\": null}, {\"name\": \"col3\", \"field_name\": '\r\nb'\"col3\", \"pandas_type\": \"int32\", \"numpy_type\": \"int32\", \"metadata'\r\nb'\": null}], \"pandas_version\": \"0.22.0\"}'}{code}",
        "customfield_10010": null,
        "timetracking": {
            "remainingEstimate": "0h",
            "timeSpent": "1h 50m",
            "remainingEstimateSeconds": 0,
            "timeSpentSeconds": 6600
        },
        "customfield_12314523": null,
        "customfield_12314127": null,
        "customfield_12314522": null,
        "customfield_12314126": null,
        "customfield_12314521": null,
        "customfield_12314125": null,
        "customfield_12314520": null,
        "customfield_12314124": null,
        "attachment": [],
        "customfield_12312340": null,
        "customfield_12314123": null,
        "customfield_12312341": null,
        "customfield_12312220": null,
        "customfield_12314122": null,
        "customfield_12314121": null,
        "customfield_12314120": null,
        "customfield_12314129": null,
        "customfield_12314524": null,
        "customfield_12314128": null,
        "summary": "[Python] Preserve schema in write_to_dataset",
        "customfield_12314130": null,
        "customfield_12310291": null,
        "customfield_12310290": null,
        "customfield_12314138": null,
        "customfield_12314137": null,
        "environment": null,
        "customfield_12314136": null,
        "customfield_12314135": null,
        "customfield_12311020": null,
        "customfield_12314134": null,
        "duedate": null,
        "customfield_12314132": null,
        "customfield_12314131": null,
        "comment": {
            "comments": [
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13173576/comment/16553079",
                    "id": "16553079",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=uwe",
                        "name": "uwe",
                        "key": "xhochy",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=xhochy&avatarId=30652",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=xhochy&avatarId=30652",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=xhochy&avatarId=30652",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=xhochy&avatarId=30652"
                        },
                        "displayName": "Uwe Korn",
                        "active": true,
                        "timeZone": "Europe/Berlin"
                    },
                    "body": "Issue resolved by pull request 2302\n[https://github.com/apache/arrow/pull/2302]",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=uwe",
                        "name": "uwe",
                        "key": "xhochy",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=xhochy&avatarId=30652",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=xhochy&avatarId=30652",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=xhochy&avatarId=30652",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=xhochy&avatarId=30652"
                        },
                        "displayName": "Uwe Korn",
                        "active": true,
                        "timeZone": "Europe/Berlin"
                    },
                    "created": "2018-07-23T16:32:27.984+0000",
                    "updated": "2018-07-23T16:32:27.984+0000"
                }
            ],
            "maxResults": 1,
            "total": 1,
            "startAt": 0
        },
        "customfield_12311820": "0|i3w4uv:",
        "customfield_12314139": null
    }
}