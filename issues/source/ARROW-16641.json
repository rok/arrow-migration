{
    "expand": "operations,versionedRepresentations,editmeta,changelog,renderedFields",
    "id": "13446585",
    "self": "https://issues.apache.org/jira/rest/api/2/issue/13446585",
    "key": "ARROW-16641",
    "fields": {
        "fixVersions": [],
        "resolution": {
            "self": "https://issues.apache.org/jira/rest/api/2/resolution/10008",
            "id": "10008",
            "description": "Information Provided",
            "name": "Information Provided"
        },
        "customfield_12312322": null,
        "customfield_12312323": null,
        "customfield_12312320": null,
        "customfield_12310420": "9223372036854775807",
        "customfield_12312321": null,
        "customfield_12312328": null,
        "customfield_12312329": null,
        "customfield_12312326": null,
        "customfield_12310300": null,
        "customfield_12312327": null,
        "customfield_12312324": null,
        "customfield_12312720": null,
        "customfield_12312325": null,
        "lastViewed": null,
        "priority": {
            "self": "https://issues.apache.org/jira/rest/api/2/priority/4",
            "iconUrl": "https://issues.apache.org/jira/images/icons/priorities/minor.svg",
            "name": "Minor",
            "id": "4"
        },
        "labels": [],
        "customfield_12312333": null,
        "customfield_12312334": null,
        "customfield_12313422": "false",
        "customfield_12310310": "0.0",
        "customfield_12312331": null,
        "customfield_12312332": null,
        "aggregatetimeoriginalestimate": null,
        "timeestimate": null,
        "customfield_12312330": null,
        "versions": [],
        "customfield_12311120": null,
        "customfield_12313826": null,
        "customfield_12312339": null,
        "issuelinks": [
            {
                "id": "12640985",
                "self": "https://issues.apache.org/jira/rest/api/2/issueLink/12640985",
                "type": {
                    "id": "10030",
                    "name": "Reference",
                    "inward": "is related to",
                    "outward": "relates to",
                    "self": "https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"
                },
                "outwardIssue": {
                    "id": "13447792",
                    "key": "ARROW-16702",
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13447792",
                    "fields": {
                        "summary": "[C++] Add compute functions for list array containment",
                        "status": {
                            "self": "https://issues.apache.org/jira/rest/api/2/status/1",
                            "description": "The issue is open and ready for the assignee to start work on it.",
                            "iconUrl": "https://issues.apache.org/jira/images/icons/statuses/open.png",
                            "name": "Open",
                            "id": "1",
                            "statusCategory": {
                                "self": "https://issues.apache.org/jira/rest/api/2/statuscategory/2",
                                "id": 2,
                                "key": "new",
                                "colorName": "blue-gray",
                                "name": "To Do"
                            }
                        },
                        "priority": {
                            "self": "https://issues.apache.org/jira/rest/api/2/priority/3",
                            "iconUrl": "https://issues.apache.org/jira/images/icons/priorities/major.svg",
                            "name": "Major",
                            "id": "3"
                        },
                        "issuetype": {
                            "self": "https://issues.apache.org/jira/rest/api/2/issuetype/2",
                            "id": "2",
                            "description": "A new feature of the product, which has yet to be developed.",
                            "iconUrl": "https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21141&avatarType=issuetype",
                            "name": "New Feature",
                            "subtask": false,
                            "avatarId": 21141
                        }
                    }
                }
            }
        ],
        "customfield_12313825": null,
        "assignee": {
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=willjones127",
            "name": "willjones127",
            "key": "willjones127",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=34058",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34058",
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34058",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34058"
            },
            "displayName": "Will Jones",
            "active": true,
            "timeZone": "Etc/UTC"
        },
        "customfield_12312337": null,
        "customfield_12313823": null,
        "customfield_12312338": null,
        "customfield_12311920": null,
        "customfield_12313822": null,
        "customfield_12312335": null,
        "customfield_12313821": null,
        "customfield_12312336": null,
        "customfield_12313820": null,
        "status": {
            "self": "https://issues.apache.org/jira/rest/api/2/status/6",
            "description": "The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.",
            "iconUrl": "https://issues.apache.org/jira/images/icons/statuses/closed.png",
            "name": "Closed",
            "id": "6",
            "statusCategory": {
                "self": "https://issues.apache.org/jira/rest/api/2/statuscategory/3",
                "id": 3,
                "key": "done",
                "colorName": "green",
                "name": "Done"
            }
        },
        "components": [
            {
                "self": "https://issues.apache.org/jira/rest/api/2/component/12333008",
                "id": "12333008",
                "name": "R"
            }
        ],
        "customfield_12312026": null,
        "customfield_12312023": null,
        "customfield_12312024": null,
        "aggregatetimeestimate": null,
        "customfield_12312022": null,
        "customfield_12310921": null,
        "customfield_12310920": "9223372036854775807",
        "customfield_12312823": null,
        "creator": {
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=Mikryukov",
            "name": "Mikryukov",
            "key": "JIRAUSER289939",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=34052",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34052",
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34052",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34052"
            },
            "displayName": "Vladimir",
            "active": true,
            "timeZone": "Europe/Tallinn"
        },
        "subtasks": [],
        "reporter": {
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=Mikryukov",
            "name": "Mikryukov",
            "key": "JIRAUSER289939",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=34052",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34052",
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34052",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34052"
            },
            "displayName": "Vladimir",
            "active": true,
            "timeZone": "Europe/Tallinn"
        },
        "aggregateprogress": {
            "progress": 0,
            "total": 0
        },
        "customfield_12313520": null,
        "customfield_12310250": null,
        "progress": {
            "progress": 0,
            "total": 0
        },
        "customfield_12313924": null,
        "votes": {
            "self": "https://issues.apache.org/jira/rest/api/2/issue/ARROW-16641/votes",
            "votes": 0,
            "hasVoted": false
        },
        "worklog": {
            "startAt": 0,
            "maxResults": 20,
            "total": 0,
            "worklogs": []
        },
        "customfield_12313920": null,
        "issuetype": {
            "self": "https://issues.apache.org/jira/rest/api/2/issuetype/5",
            "id": "5",
            "description": "General wishlist item.",
            "iconUrl": "https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21140&avatarType=issuetype",
            "name": "Wish",
            "subtask": false,
            "avatarId": 21140
        },
        "timespent": null,
        "customfield_12314020": "{summaryBean=com.atlassian.jira.plugin.devstatus.rest.SummaryBean@7273854d[summary={pullrequest=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@2dac0ae1[overall=PullRequestOverallBean{stateCount=0, state='OPEN', details=PullRequestOverallDetails{openCount=0, mergedCount=0, declinedCount=0}},byInstanceType={}], build=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@2e585c52[overall=com.atlassian.jira.plugin.devstatus.summary.beans.BuildOverallBean@636eb07a[failedBuildCount=0,successfulBuildCount=0,unknownBuildCount=0,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], review=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@274ba1b2[overall=com.atlassian.jira.plugin.devstatus.summary.beans.ReviewsOverallBean@181c45ac[stateCount=0,state=<null>,dueDate=<null>,overDue=false,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], deployment-environment=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@74ca2031[overall=com.atlassian.jira.plugin.devstatus.summary.beans.DeploymentOverallBean@6231b3b2[topEnvironments=[],showProjects=false,successfulCount=0,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], repository=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@180dd877[overall=com.atlassian.jira.plugin.devstatus.summary.beans.CommitOverallBean@6246dfff[count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], branch=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@4728a02e[overall=com.atlassian.jira.plugin.devstatus.summary.beans.BranchOverallBean@28eb275a[count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}]},errors=[],configErrors=[]], devSummaryJson={\"cachedValue\":{\"errors\":[],\"configErrors\":[],\"summary\":{\"pullrequest\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"stateCount\":0,\"state\":\"OPEN\",\"details\":{\"openCount\":0,\"mergedCount\":0,\"declinedCount\":0,\"total\":0},\"open\":true},\"byInstanceType\":{}},\"build\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"failedBuildCount\":0,\"successfulBuildCount\":0,\"unknownBuildCount\":0},\"byInstanceType\":{}},\"review\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"stateCount\":0,\"state\":null,\"dueDate\":null,\"overDue\":false,\"completed\":false},\"byInstanceType\":{}},\"deployment-environment\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"topEnvironments\":[],\"showProjects\":false,\"successfulCount\":0},\"byInstanceType\":{}},\"repository\":{\"overall\":{\"count\":0,\"lastUpdated\":null},\"byInstanceType\":{}},\"branch\":{\"overall\":{\"count\":0,\"lastUpdated\":null},\"byInstanceType\":{}}}},\"isStale\":false}}",
        "customfield_12314141": null,
        "customfield_12314140": null,
        "project": {
            "self": "https://issues.apache.org/jira/rest/api/2/project/12319525",
            "id": "12319525",
            "key": "ARROW",
            "name": "Apache Arrow",
            "projectTypeKey": "software",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/projectavatar?pid=12319525&avatarId=10011",
                "24x24": "https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12319525&avatarId=10011",
                "16x16": "https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12319525&avatarId=10011",
                "32x32": "https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12319525&avatarId=10011"
            },
            "projectCategory": {
                "self": "https://issues.apache.org/jira/rest/api/2/projectCategory/13960",
                "id": "13960",
                "description": "Apache Arrow",
                "name": "Arrow"
            }
        },
        "aggregatetimespent": null,
        "customfield_12312520": null,
        "customfield_12312521": "Tue May 31 21:03:04 UTC 2022",
        "customfield_12314422": null,
        "customfield_12314421": null,
        "customfield_12314146": null,
        "customfield_12314420": null,
        "customfield_12314145": null,
        "customfield_12314144": null,
        "customfield_12314143": null,
        "resolutiondate": "2022-06-30T16:18:47.000+0000",
        "workratio": -1,
        "customfield_12312923": null,
        "customfield_12312920": null,
        "customfield_12312921": null,
        "watches": {
            "self": "https://issues.apache.org/jira/rest/api/2/issue/ARROW-16641/watchers",
            "watchCount": 2,
            "isWatching": false
        },
        "created": "2022-05-24T13:55:34.000+0000",
        "updated": "2022-06-30T16:18:47.000+0000",
        "timeoriginalestimate": null,
        "description": "In the parquet data we have, there is a column with the array data type ({*}list<array_element <string>>{*}), which flags records that have different issues. For each record, multiple values could be stored in the column. For example, `{_}[A, B, C]{_}`.\r\n\r\nI'm trying to perform a data filtering step and exclude some flagged records.\r\n\r\nFiltering is trivial for the regular columns that contain just a single value. E.g.,\r\n{code:java}\r\nflags_to_exclude <- c(\"A\", \"B\")\r\ndatt %>% filter(! col %in% flags_to_exclude)\r\n{code}\r\nGiven the array column, is it possible to exclude records with at least one of the flags from `flags_to_exclude` using the arrow R package?\r\n\r\nI really appreciate any advice you can provide!",
        "customfield_10010": null,
        "timetracking": {},
        "customfield_12314523": null,
        "customfield_12314127": null,
        "customfield_12314522": null,
        "customfield_12314126": null,
        "customfield_12314521": null,
        "customfield_12314125": null,
        "customfield_12314520": null,
        "customfield_12314124": null,
        "attachment": [],
        "customfield_12312340": null,
        "customfield_12314123": null,
        "customfield_12312341": null,
        "customfield_12312220": null,
        "customfield_12314122": null,
        "customfield_12314121": null,
        "customfield_12314120": null,
        "customfield_12314129": null,
        "customfield_12314524": null,
        "customfield_12314128": null,
        "summary": "[R] How to filter array columns?",
        "customfield_12314130": null,
        "customfield_12310291": null,
        "customfield_12310290": null,
        "customfield_12314138": null,
        "customfield_12314137": null,
        "environment": null,
        "customfield_12314136": null,
        "customfield_12314135": null,
        "customfield_12311020": null,
        "customfield_12314134": null,
        "duedate": null,
        "customfield_12314132": null,
        "customfield_12314131": null,
        "comment": {
            "comments": [
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13446585/comment/17541596",
                    "id": "17541596",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=willjones127",
                        "name": "willjones127",
                        "key": "willjones127",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=34058",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34058",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34058",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34058"
                        },
                        "displayName": "Will Jones",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "body": "I don't think there's a compute function that does what you want directly, but you should be able to achieve this by flattening the list, doing the filter, and aggregating on the indices to get a filter vector.\u00a0\r\n\r\nIs the following example helpful?\r\n{code:r}\r\nlibrary(arrow)\r\nlibrary(dplyr)\r\n\r\n# Filter `tab` for and `tab$x` in `valid`\r\nvalid <- Array$create(c(2))\r\n\r\ntab <- arrow_table(\r\n\u00a0 x = Array$create(list(c(1, 2), c(3, 2), c(1, 3))),\r\n\u00a0 y = Array$create(c(\"a\", \"b\", \"c\"))\r\n)\r\n\r\ntab_exploded <- arrow_table(\r\n\u00a0 i = call_function(\"list_parent_indices\", tab$x),\r\n\u00a0 x_flat = call_function(\"list_flatten\", tab$x)\r\n)\r\n\r\nto_keep <- tab_exploded %>%\r\n\u00a0 group_by(i) %>%\r\n\u00a0 summarise(keep = any(x_flat %in% valid)) %>%\r\n\u00a0 compute() %>%\r\n\u00a0 .$keep\r\n\r\nres <- tab[to_keep,]\r\nas_tibble(res)\r\n#> # A tibble: 2 \u00d7 2\r\n#> \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0x y \u00a0 \u00a0\r\n#> \u00a0 <list<double>> <chr>\r\n#> 1 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0[2] a \u00a0 \u00a0\r\n#> 2 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0[2] b\r\nres$x\r\n#> ChunkedArray\r\n#> [\r\n#> \u00a0 [\r\n#> \u00a0 \u00a0 [\r\n#> \u00a0 \u00a0 \u00a0 1,\r\n#> \u00a0 \u00a0 \u00a0 2\r\n#> \u00a0 \u00a0 ],\r\n#> \u00a0 \u00a0 [\r\n#> \u00a0 \u00a0 \u00a0 3,\r\n#> \u00a0 \u00a0 \u00a0 2\r\n#> \u00a0 \u00a0 ]\r\n#> \u00a0 ]\r\n#> ]\r\n{code}",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=willjones127",
                        "name": "willjones127",
                        "key": "willjones127",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=34058",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34058",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34058",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34058"
                        },
                        "displayName": "Will Jones",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "created": "2022-05-24T16:08:37.808+0000",
                    "updated": "2022-05-24T16:39:08.109+0000"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13446585/comment/17541611",
                    "id": "17541611",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=willjones127",
                        "name": "willjones127",
                        "key": "willjones127",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=34058",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34058",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34058",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34058"
                        },
                        "displayName": "Will Jones",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "body": "Oh correction: to flatten a chunked array, you should use\u00a0\r\n{code:R}\r\n  x_flat = call_function(\"list_flatten\", tab$x)\r\n{code}",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=willjones127",
                        "name": "willjones127",
                        "key": "willjones127",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=34058",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34058",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34058",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34058"
                        },
                        "displayName": "Will Jones",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "created": "2022-05-24T16:38:43.285+0000",
                    "updated": "2022-05-24T16:38:43.285+0000"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13446585/comment/17541934",
                    "id": "17541934",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=Mikryukov",
                        "name": "Mikryukov",
                        "key": "JIRAUSER289939",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=34052",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34052",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34052",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34052"
                        },
                        "displayName": "Vladimir",
                        "active": true,
                        "timeZone": "Europe/Tallinn"
                    },
                    "body": "Thank you very much for the comprehensive answer! It's very helpful!\r\n\r\nAs I understand, {{list_parent_indices}} discards records without any flags ({{{}NULL{}}} values). Is it possible to keep the nulls? I've tried to specify the options ({{{}skip_nulls = \"false\" {}}}or {{{}skip_nulls = FALSE{}}}), but it doesn't have any effect.\r\n\r\n\u00a0\r\n{code:java}\r\ntab <- arrow_table(\r\n  x = Array$create(list(c(1, 2), 1, NULL)),\r\n  y = Array$create(c(\"a\", \"b\", \"c\"))\r\n)\r\ntab_exploded <- arrow_table(\r\n\u00a0 i = call_function(\"list_parent_indices\", tab$x, options = list(skip_nulls = \"false\")),\r\n\u00a0 x_flat = call_function(\"list_flatten\", tab$x)\r\n)\r\n{code}\r\n\u00a0\r\n\r\n\u00a0",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=Mikryukov",
                        "name": "Mikryukov",
                        "key": "JIRAUSER289939",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=34052",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34052",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34052",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34052"
                        },
                        "displayName": "Vladimir",
                        "active": true,
                        "timeZone": "Europe/Tallinn"
                    },
                    "created": "2022-05-25T09:33:14.239+0000",
                    "updated": "2022-05-25T09:33:14.239+0000"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13446585/comment/17542142",
                    "id": "17542142",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=willjones127",
                        "name": "willjones127",
                        "key": "willjones127",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=34058",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34058",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34058",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34058"
                        },
                        "displayName": "Will Jones",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "body": "Yes that option doesn't seem to do anything here. I think the semantics are a little tough to design for that. {{list_parent_indices}} returns a value per value in the subarray; if there are zero values, should there not be zero indices?\r\n\r\nIt does make this set filtering more awkward though; this probably deserves it's own function.\r\n\r\nA different approach might be constructing the indices to exclude:\r\n\r\n{code:R}\r\nlibrary(arrow)\r\nlibrary(dplyr)\r\n\r\n# Filter `tab` for any `tab$x` in that doesn't contain value in `exclude`\r\nexclude <- Array$create(c(1))\r\n\r\ntab <- arrow_table(\r\n  x = Array$create(list(c(1, 2), c(3, 2), c(), c(1, 3))),\r\n  y = Array$create(c(\"a\", \"b\", \"c\", \"d\"))\r\n)\r\n\r\ntab_exploded <- arrow_table(\r\n  i = call_function(\"list_parent_indices\", tab$x),\r\n  x_flat = call_function(\"list_flatten\", tab$x)\r\n  #x_flat = tab$x$chunk(0)$values()\r\n)\r\n\r\nto_drop <- tab_exploded %>%\r\n  group_by(i) %>%\r\n  summarise(to_drop = any((x_flat %in% exclude))) %>%\r\n  filter(to_drop) %>%\r\n  compute() %>%\r\n  .$i\r\n\r\nselection <- !(1:nrow(tab) %in% as.vector(to_drop + 1))\r\nres <- tab[selection,]\r\nas_tibble(res)\r\n#> # A tibble: 2 \u00d7 2\r\n#>                x y    \r\n#>   <list<double>> <chr>\r\n#> 1            [2] b    \r\n#> 2                c\r\nres$x\r\n#> ChunkedArray\r\n#> [\r\n#>   [\r\n#>     [\r\n#>       3,\r\n#>       2\r\n#>     ],\r\n#>     null\r\n#>   ]\r\n#> ]\r\n{code}\r\n\r\n",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=willjones127",
                        "name": "willjones127",
                        "key": "willjones127",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=34058",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34058",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34058",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34058"
                        },
                        "displayName": "Will Jones",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "created": "2022-05-25T17:26:11.568+0000",
                    "updated": "2022-05-25T17:26:11.568+0000"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13446585/comment/17542849",
                    "id": "17542849",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=Mikryukov",
                        "name": "Mikryukov",
                        "key": "JIRAUSER289939",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=34052",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34052",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34052",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34052"
                        },
                        "displayName": "Vladimir",
                        "active": true,
                        "timeZone": "Europe/Tallinn"
                    },
                    "body": "Will, thank you very much for your support!\r\nThe solution you proposed works very well.\r\n\r\n\r\nHowever, there is an issue applying it to a real dataset. It looks like the `{{{}call_function(\"list_parent_indices\"){}}}` does not work with a `{{{}FileSystemDataset{}}}` (parquet files opened with `{{{}arrow::open_dataset(){}}}`). So to prepare an \"exploded table\", we need to load the full dataset into memory. And the \"exploded table\" becomes huge if there are multiple flags per record. So I'm running out of RAM very quickly (>100 GB).\r\n\r\nI've also tried the other way to filter the records - using `DuckDB`+`arrow` with \u00a0SQL query of form \"{{{}SELECT * FROM my_table WHERE 'FlagA' != ANY (my_table.issue) AND 'FlagB' != ANY (my_table.issue){}}}\". But this approach is also very RAM-consuming.\r\n\r\nSo probably currently, there is no simple way to perform this filtering in one pass, and we need to split the data into chunks.\r\n\r\nIt would be pretty cool if one day `arrow` would have a built-in function to perform such a task on the fly!\r\n\r\nPS. The dataset we are working on is in open access - it's [GBIF occurrence records|https://github.com/gbif/occurrence/blob/master/aws-public-data.md]. It has almost 2 billion records, and some of the records could have ~10 flags (column `issue`).\r\n\r\n\r\n\r\n\u00a0",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=Mikryukov",
                        "name": "Mikryukov",
                        "key": "JIRAUSER289939",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=34052",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34052",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34052",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34052"
                        },
                        "displayName": "Vladimir",
                        "active": true,
                        "timeZone": "Europe/Tallinn"
                    },
                    "created": "2022-05-27T09:23:55.450+0000",
                    "updated": "2022-05-27T09:23:55.450+0000"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13446585/comment/17544604",
                    "id": "17544604",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=willjones127",
                        "name": "willjones127",
                        "key": "willjones127",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=34058",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34058",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34058",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34058"
                        },
                        "displayName": "Will Jones",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "body": "{quote}It would be pretty cool if one day `arrow` would have a built-in function to perform such a task on the fly!\r\n{quote}\r\nYes, I agree. I believe what you are looking for is the {{arrays_overlap()}} function in Spark or the {{&&}} operator in PostgreSQL, so I've created a new ticket to implement that: https://issues.apache.org/jira/browse/ARROW-16702\r\n{quote}So to prepare an \"exploded table\", we need to load the full dataset into memory.\r\n{quote}\r\nI'd also add that for cases like this, {{map_batches()}} will one day be a good solution. Right now it collects its results fully into memory, but we should eventually let it stream out the results. For now, it does process the _inputs_ one-by-one, so it works well for reducing/aggregating.",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=willjones127",
                        "name": "willjones127",
                        "key": "willjones127",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=34058",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34058",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34058",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34058"
                        },
                        "displayName": "Will Jones",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "created": "2022-05-31T21:03:04.580+0000",
                    "updated": "2022-05-31T21:03:04.580+0000"
                }
            ],
            "maxResults": 6,
            "total": 6,
            "startAt": 0
        },
        "customfield_12311820": "0|z12n40:",
        "customfield_12314139": null
    }
}