{
    "expand": "operations,versionedRepresentations,editmeta,changelog,renderedFields",
    "id": "13322183",
    "self": "https://issues.apache.org/jira/rest/api/2/issue/13322183",
    "key": "ARROW-9699",
    "fields": {
        "fixVersions": [
            {
                "self": "https://issues.apache.org/jira/rest/api/2/version/12345977",
                "id": "12345977",
                "description": "",
                "name": "2.0.0",
                "archived": false,
                "released": true,
                "releaseDate": "2020-10-19"
            }
        ],
        "resolution": {
            "self": "https://issues.apache.org/jira/rest/api/2/resolution/1",
            "id": "1",
            "description": "A fix for this issue is checked into the tree and tested.",
            "name": "Fixed"
        },
        "customfield_12312322": null,
        "customfield_12312323": null,
        "customfield_12312320": null,
        "customfield_12310420": "9223372036854775807",
        "customfield_12312321": null,
        "customfield_12312328": null,
        "customfield_12312329": null,
        "customfield_12312326": null,
        "customfield_12310300": null,
        "customfield_12312327": null,
        "customfield_12312324": null,
        "customfield_12312720": null,
        "customfield_12312325": null,
        "lastViewed": null,
        "priority": {
            "self": "https://issues.apache.org/jira/rest/api/2/priority/4",
            "iconUrl": "https://issues.apache.org/jira/images/icons/priorities/minor.svg",
            "name": "Minor",
            "id": "4"
        },
        "labels": [
            "pull-request-available"
        ],
        "customfield_12312333": null,
        "customfield_12312334": null,
        "customfield_12313422": "false",
        "customfield_12310310": "0.0",
        "customfield_12312331": null,
        "customfield_12312332": null,
        "aggregatetimeoriginalestimate": null,
        "timeestimate": 0,
        "customfield_12312330": null,
        "versions": [],
        "customfield_12311120": null,
        "customfield_12313826": null,
        "customfield_12312339": null,
        "issuelinks": [],
        "customfield_12313825": null,
        "assignee": {
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=yibocai",
            "name": "yibocai",
            "key": "yibo",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=yibo&avatarId=47542",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=yibo&avatarId=47542",
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=yibo&avatarId=47542",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=yibo&avatarId=47542"
            },
            "displayName": "Yibo Cai",
            "active": true,
            "timeZone": "Etc/UTC"
        },
        "customfield_12312337": null,
        "customfield_12313823": null,
        "customfield_12312338": null,
        "customfield_12311920": null,
        "customfield_12313822": null,
        "customfield_12312335": null,
        "customfield_12313821": null,
        "customfield_12312336": null,
        "customfield_12313820": null,
        "status": {
            "self": "https://issues.apache.org/jira/rest/api/2/status/5",
            "description": "A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.",
            "iconUrl": "https://issues.apache.org/jira/images/icons/statuses/resolved.png",
            "name": "Resolved",
            "id": "5",
            "statusCategory": {
                "self": "https://issues.apache.org/jira/rest/api/2/statuscategory/3",
                "id": 3,
                "key": "done",
                "colorName": "green",
                "name": "Done"
            }
        },
        "components": [
            {
                "self": "https://issues.apache.org/jira/rest/api/2/component/12328935",
                "id": "12328935",
                "name": "C++"
            }
        ],
        "customfield_12312026": null,
        "customfield_12312023": null,
        "customfield_12312024": null,
        "aggregatetimeestimate": 0,
        "customfield_12312022": null,
        "customfield_12310921": null,
        "customfield_12310920": "9223372036854775807",
        "customfield_12312823": null,
        "creator": {
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=yibocai",
            "name": "yibocai",
            "key": "yibo",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=yibo&avatarId=47542",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=yibo&avatarId=47542",
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=yibo&avatarId=47542",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=yibo&avatarId=47542"
            },
            "displayName": "Yibo Cai",
            "active": true,
            "timeZone": "Etc/UTC"
        },
        "subtasks": [],
        "reporter": {
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=yibocai",
            "name": "yibocai",
            "key": "yibo",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=yibo&avatarId=47542",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=yibo&avatarId=47542",
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=yibo&avatarId=47542",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=yibo&avatarId=47542"
            },
            "displayName": "Yibo Cai",
            "active": true,
            "timeZone": "Etc/UTC"
        },
        "aggregateprogress": {
            "progress": 4800,
            "total": 4800,
            "percent": 100
        },
        "customfield_12313520": null,
        "customfield_12310250": null,
        "progress": {
            "progress": 4800,
            "total": 4800,
            "percent": 100
        },
        "customfield_12313924": null,
        "votes": {
            "self": "https://issues.apache.org/jira/rest/api/2/issue/ARROW-9699/votes",
            "votes": 0,
            "hasVoted": false
        },
        "worklog": {
            "startAt": 0,
            "maxResults": 20,
            "total": 8,
            "worklogs": [
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13322183/worklog/470529",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "cyb70289 opened a new pull request #7963:\nURL: https://github.com/apache/arrow/pull/7963\n\n\n   For small integers(bool, int8, uint8), instead of general hash table,\r\n   using a value indexed array improves performance about 2x ~ 6x.\r\n   \r\n   Get another 15% improvement by reading array raw_values[] directly.\n\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2020-08-14T01:44:50.793+0000",
                    "updated": "2020-08-14T01:44:50.793+0000",
                    "started": "2020-08-14T01:44:50.793+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "470529",
                    "issueId": "13322183"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13322183/worklog/470530",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "github-actions[bot] commented on pull request #7963:\nURL: https://github.com/apache/arrow/pull/7963#issuecomment-673830331\n\n\n   https://issues.apache.org/jira/browse/ARROW-9699\n\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2020-08-14T01:46:41.983+0000",
                    "updated": "2020-08-14T01:46:41.983+0000",
                    "started": "2020-08-14T01:46:41.983+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "470530",
                    "issueId": "13322183"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13322183/worklog/470531",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "cyb70289 commented on pull request #7963:\nURL: https://github.com/apache/arrow/pull/7963#issuecomment-673834858\n\n\n   **Removed unrelated tests for clarity.\r\n   100% null benchmark is not stable, can be ignored.**\r\n   \r\n   ```\r\n   $ archery benchmark diff --suite-filter=\"arrow-compute-aggregate-benchmark\" --cc=clang-9 --cxx=clang++-9\r\n   \r\n                         benchmark         baseline        contender  change % \r\n      ModeKernelInt8/1048576/10000   60.196 MiB/sec  477.048 MiB/sec   692.487 'null_percent': 0.01\r\n        ModeKernelInt8/1048576/100   60.548 MiB/sec  470.066 MiB/sec   676.351, 'null_percent': 1.0\r\n          ModeKernelInt8/1048576/0   63.520 MiB/sec  472.362 MiB/sec   643.638, 'null_percent': 0.0\r\n         ModeKernelInt8/1048576/10   62.997 MiB/sec  420.059 MiB/sec   566.788 'null_percent': 10.0\r\n      ModeKernelBoolean/1048576/10    7.640 MiB/sec   28.329 MiB/sec   270.793 'null_percent': 10.0\r\n   ModeKernelBoolean/1048576/10000    7.332 MiB/sec   26.496 MiB/sec   261.362 'null_percent': 0.01\r\n     ModeKernelBoolean/1048576/100    7.415 MiB/sec   26.710 MiB/sec   260.212, 'null_percent': 1.0\r\n       ModeKernelBoolean/1048576/0    8.079 MiB/sec   28.428 MiB/sec   251.895, 'null_percent': 0.0\r\n          ModeKernelInt8/1048576/2   80.291 MiB/sec  265.673 MiB/sec   230.887 'null_percent': 50.0\r\n       ModeKernelBoolean/1048576/2   12.449 MiB/sec   27.915 MiB/sec   124.235 'null_percent': 50.0\r\n          ModeKernelInt8/1048576/1  864.966 MiB/sec    1.313 GiB/sec    55.455'null_percent': 100.0\r\n       ModeKernelBoolean/1048576/1  115.581 MiB/sec  153.801 MiB/sec    33.067'null_percent': 100.0\r\n     ModeKernelInt32/1048576/10000  228.572 MiB/sec  263.524 MiB/sec    15.292 'null_percent': 0.01\r\n       ModeKernelInt32/1048576/100  230.087 MiB/sec  265.102 MiB/sec    15.218, 'null_percent': 1.0\r\n     ModeKernelInt16/1048576/10000  115.973 MiB/sec  132.465 MiB/sec    14.221 'null_percent': 0.01\r\n       ModeKernelInt16/1048576/100  116.657 MiB/sec  132.673 MiB/sec    13.729, 'null_percent': 1.0\r\n        ModeKernelInt32/1048576/10  241.338 MiB/sec  270.446 MiB/sec    12.061 'null_percent': 10.0\r\n        ModeKernelInt16/1048576/10  122.426 MiB/sec  135.675 MiB/sec    10.822 'null_percent': 10.0\r\n     ModeKernelInt64/1048576/10000  481.018 MiB/sec  523.582 MiB/sec     8.849 'null_percent': 0.01\r\n       ModeKernelInt64/1048576/100  485.800 MiB/sec  527.232 MiB/sec     8.529, 'null_percent': 1.0\r\n        ModeKernelInt64/1048576/10  526.491 MiB/sec  569.412 MiB/sec     8.152 'null_percent': 10.0\r\n         ModeKernelInt64/1048576/1    6.671 GiB/sec    7.180 GiB/sec     7.623'null_percent': 100.0\r\n         ModeKernelInt64/1048576/2  783.253 MiB/sec  813.436 MiB/sec     3.854 'null_percent': 50.0\r\n         ModeKernelInt32/1048576/0  257.627 MiB/sec  265.602 MiB/sec     3.096, 'null_percent': 0.0\r\n         ModeKernelInt16/1048576/0  128.580 MiB/sec  132.340 MiB/sec     2.924, 'null_percent': 0.0\r\n         ModeKernelInt16/1048576/2  160.189 MiB/sec  164.776 MiB/sec     2.863 'null_percent': 50.0\r\n         ModeKernelInt64/1048576/0  514.855 MiB/sec  528.897 MiB/sec     2.727, 'null_percent': 0.0\r\n         ModeKernelInt32/1048576/2  321.334 MiB/sec  324.092 MiB/sec     0.858 'null_percent': 50.0\r\n         ModeKernelInt16/1048576/1    1.860 GiB/sec    1.653 GiB/sec   -11.109'null_percent': 100.0\r\n         ModeKernelInt32/1048576/1    5.728 GiB/sec    3.263 GiB/sec   -43.038'null_percent': 100.0\r\n   ```\n\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2020-08-14T01:49:58.417+0000",
                    "updated": "2020-08-14T01:49:58.417+0000",
                    "started": "2020-08-14T01:49:58.417+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "470531",
                    "issueId": "13322183"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13322183/worklog/473002",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "pitrou commented on a change in pull request #7963:\nURL: https://github.com/apache/arrow/pull/7963#discussion_r474146349\n\n\n\n##########\nFile path: cpp/src/arrow/compute/kernels/aggregate_mode.cc\n##########\n@@ -69,28 +72,83 @@ struct ModeState {\n   std::unordered_map<T, int64_t> value_counts{};\n };\n \n+// Use array to count small integers(bool, int8, uint8), improves performance 2x ~ 6x\n+template <typename ArrowType>\n+struct ModeState<ArrowType, enable_if_t<(sizeof(typename ArrowType::c_type) == 1)>> {\n+  using ThisType = ModeState<ArrowType>;\n+  using T = typename ArrowType::c_type;\n+  using Limits = std::numeric_limits<T>;\n+\n+  ModeState() : value_counts(Limits::max() - Limits::min() + 1) {}\n+\n+  void MergeFrom(const ThisType& state) {\n+    std::transform(this->value_counts.cbegin(), this->value_counts.cend(),\n+                   state.value_counts.cbegin(), this->value_counts.begin(),\n+                   std::plus<int64_t>{});\n+  }\n+\n+  void MergeOne(T value) { ++this->value_counts[value - Limits::min()]; }\n+\n+  std::pair<T, int64_t> Finalize() {\n+    T mode = Limits::min();\n+    int64_t count = 0;\n+\n+    for (int i = 0; i <= Limits::max() - Limits::min(); ++i) {\n+      T this_value = static_cast<T>(i + Limits::min());\n+      int64_t this_count = this->value_counts[i];\n+      if (this_count > count || (this_count == count && this_value < mode)) {\n+        count = this_count;\n+        mode = this_value;\n+      }\n+    }\n+    return std::make_pair(mode, count);\n+  }\n+\n+  std::vector<int64_t> value_counts;\n+};\n+\n+// read raw_values[] directly improves performance ~15%\n\nReview comment:\n       This is probably heavily compiler-dependent. In any case, such micro-optimizations mostly complicate the code for no real benefit.\n\n##########\nFile path: cpp/src/arrow/compute/kernels/aggregate_test.cc\n##########\n@@ -685,5 +687,10 @@ TYPED_TEST(TestFloatingModeKernel, Floats) {\n   this->AssertModeIsNull(\"[]\");\n }\n \n+TEST_F(TestInt8ModeKernelValueRange, Basics) {\n\nReview comment:\n       Are these tests useful? `int8` should already be tested in `TestIntegerModeKernel`, right?\n\n\n\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2020-08-20T17:17:42.187+0000",
                    "updated": "2020-08-20T17:17:42.187+0000",
                    "started": "2020-08-20T17:17:42.187+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "473002",
                    "issueId": "13322183"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13322183/worklog/473282",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "cyb70289 commented on a change in pull request #7963:\nURL: https://github.com/apache/arrow/pull/7963#discussion_r474658427\n\n\n\n##########\nFile path: cpp/src/arrow/compute/kernels/aggregate_mode.cc\n##########\n@@ -69,28 +72,83 @@ struct ModeState {\n   std::unordered_map<T, int64_t> value_counts{};\n };\n \n+// Use array to count small integers(bool, int8, uint8), improves performance 2x ~ 6x\n+template <typename ArrowType>\n+struct ModeState<ArrowType, enable_if_t<(sizeof(typename ArrowType::c_type) == 1)>> {\n+  using ThisType = ModeState<ArrowType>;\n+  using T = typename ArrowType::c_type;\n+  using Limits = std::numeric_limits<T>;\n+\n+  ModeState() : value_counts(Limits::max() - Limits::min() + 1) {}\n+\n+  void MergeFrom(const ThisType& state) {\n+    std::transform(this->value_counts.cbegin(), this->value_counts.cend(),\n+                   state.value_counts.cbegin(), this->value_counts.begin(),\n+                   std::plus<int64_t>{});\n+  }\n+\n+  void MergeOne(T value) { ++this->value_counts[value - Limits::min()]; }\n+\n+  std::pair<T, int64_t> Finalize() {\n+    T mode = Limits::min();\n+    int64_t count = 0;\n+\n+    for (int i = 0; i <= Limits::max() - Limits::min(); ++i) {\n+      T this_value = static_cast<T>(i + Limits::min());\n+      int64_t this_count = this->value_counts[i];\n+      if (this_count > count || (this_count == count && this_value < mode)) {\n+        count = this_count;\n+        mode = this_value;\n+      }\n+    }\n+    return std::make_pair(mode, count);\n+  }\n+\n+  std::vector<int64_t> value_counts;\n+};\n+\n+// read raw_values[] directly improves performance ~15%\n\nReview comment:\n       Agreed. Will remove it.\n\n\n\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2020-08-21T12:14:14.892+0000",
                    "updated": "2020-08-21T12:14:14.892+0000",
                    "started": "2020-08-21T12:14:14.891+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "473282",
                    "issueId": "13322183"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13322183/worklog/473283",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "cyb70289 commented on a change in pull request #7963:\nURL: https://github.com/apache/arrow/pull/7963#discussion_r474660357\n\n\n\n##########\nFile path: cpp/src/arrow/compute/kernels/aggregate_test.cc\n##########\n@@ -685,5 +687,10 @@ TYPED_TEST(TestFloatingModeKernel, Floats) {\n   this->AssertModeIsNull(\"[]\");\n }\n \n+TEST_F(TestInt8ModeKernelValueRange, Basics) {\n\nReview comment:\n       Old code uses std::unordered_map, new code uses an vector with calculated size. Just to make sure boundary condition is correctly handled, so test with the minimal(-128) and maximal(127) value.\n\n\n\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2020-08-21T12:18:32.311+0000",
                    "updated": "2020-08-21T12:18:32.311+0000",
                    "started": "2020-08-21T12:18:32.310+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "473283",
                    "issueId": "13322183"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13322183/worklog/474255",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "pitrou commented on a change in pull request #7963:\nURL: https://github.com/apache/arrow/pull/7963#discussion_r476395265\n\n\n\n##########\nFile path: cpp/src/arrow/compute/kernels/aggregate_test.cc\n##########\n@@ -685,5 +687,10 @@ TYPED_TEST(TestFloatingModeKernel, Floats) {\n   this->AssertModeIsNull(\"[]\");\n }\n \n+TEST_F(TestInt8ModeKernelValueRange, Basics) {\n\nReview comment:\n       Good, thank you.\n\n\n\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2020-08-25T12:04:01.854+0000",
                    "updated": "2020-08-25T12:04:01.854+0000",
                    "started": "2020-08-25T12:04:01.854+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "474255",
                    "issueId": "13322183"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13322183/worklog/474256",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "pitrou closed pull request #7963:\nURL: https://github.com/apache/arrow/pull/7963\n\n\n   \n\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2020-08-25T12:06:19.975+0000",
                    "updated": "2020-08-25T12:06:19.975+0000",
                    "started": "2020-08-25T12:06:19.975+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "474256",
                    "issueId": "13322183"
                }
            ]
        },
        "customfield_12313920": null,
        "issuetype": {
            "self": "https://issues.apache.org/jira/rest/api/2/issuetype/4",
            "id": "4",
            "description": "An improvement or enhancement to an existing feature or task.",
            "iconUrl": "https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21140&avatarType=issuetype",
            "name": "Improvement",
            "subtask": false,
            "avatarId": 21140
        },
        "timespent": 4800,
        "customfield_12314020": "{summaryBean=com.atlassian.jira.plugin.devstatus.rest.SummaryBean@727bf985[summary={pullrequest=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@3e7844bb[overall=PullRequestOverallBean{stateCount=0, state='OPEN', details=PullRequestOverallDetails{openCount=0, mergedCount=0, declinedCount=0}},byInstanceType={}], build=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@17adc95f[overall=com.atlassian.jira.plugin.devstatus.summary.beans.BuildOverallBean@6b8c1a8d[failedBuildCount=0,successfulBuildCount=0,unknownBuildCount=0,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], review=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@547dc9dd[overall=com.atlassian.jira.plugin.devstatus.summary.beans.ReviewsOverallBean@530f664f[stateCount=0,state=<null>,dueDate=<null>,overDue=false,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], deployment-environment=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@2a11ba40[overall=com.atlassian.jira.plugin.devstatus.summary.beans.DeploymentOverallBean@21c285fd[topEnvironments=[],showProjects=false,successfulCount=0,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], repository=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@1bcb9339[overall=com.atlassian.jira.plugin.devstatus.summary.beans.CommitOverallBean@33deb311[count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], branch=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@143acc90[overall=com.atlassian.jira.plugin.devstatus.summary.beans.BranchOverallBean@21e24e87[count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}]},errors=[],configErrors=[]], devSummaryJson={\"cachedValue\":{\"errors\":[],\"configErrors\":[],\"summary\":{\"pullrequest\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"stateCount\":0,\"state\":\"OPEN\",\"details\":{\"openCount\":0,\"mergedCount\":0,\"declinedCount\":0,\"total\":0},\"open\":true},\"byInstanceType\":{}},\"build\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"failedBuildCount\":0,\"successfulBuildCount\":0,\"unknownBuildCount\":0},\"byInstanceType\":{}},\"review\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"stateCount\":0,\"state\":null,\"dueDate\":null,\"overDue\":false,\"completed\":false},\"byInstanceType\":{}},\"deployment-environment\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"topEnvironments\":[],\"showProjects\":false,\"successfulCount\":0},\"byInstanceType\":{}},\"repository\":{\"overall\":{\"count\":0,\"lastUpdated\":null},\"byInstanceType\":{}},\"branch\":{\"overall\":{\"count\":0,\"lastUpdated\":null},\"byInstanceType\":{}}}},\"isStale\":false}}",
        "customfield_12314141": null,
        "customfield_12314140": null,
        "project": {
            "self": "https://issues.apache.org/jira/rest/api/2/project/12319525",
            "id": "12319525",
            "key": "ARROW",
            "name": "Apache Arrow",
            "projectTypeKey": "software",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/projectavatar?pid=12319525&avatarId=10011",
                "24x24": "https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12319525&avatarId=10011",
                "16x16": "https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12319525&avatarId=10011",
                "32x32": "https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12319525&avatarId=10011"
            },
            "projectCategory": {
                "self": "https://issues.apache.org/jira/rest/api/2/projectCategory/13960",
                "id": "13960",
                "description": "Apache Arrow",
                "name": "Arrow"
            }
        },
        "aggregatetimespent": 4800,
        "customfield_12312520": null,
        "customfield_12312521": "Tue Aug 25 12:06:42 UTC 2020",
        "customfield_12314422": null,
        "customfield_12314421": null,
        "customfield_12314146": null,
        "customfield_12314420": null,
        "customfield_12314145": null,
        "customfield_12314144": null,
        "customfield_12314143": null,
        "resolutiondate": "2020-08-25T12:06:42.000+0000",
        "workratio": -1,
        "customfield_12312923": null,
        "customfield_12312920": null,
        "customfield_12312921": null,
        "watches": {
            "self": "https://issues.apache.org/jira/rest/api/2/issue/ARROW-9699/watchers",
            "watchCount": 1,
            "isWatching": false
        },
        "created": "2020-08-12T04:26:01.000+0000",
        "updated": "2020-08-25T12:06:42.000+0000",
        "timeoriginalestimate": null,
        "description": "Mode kernel usesl hash table to count distinct values. For small integer types (bool, int8, uint8), counting directly with a value indexed array can be more efficient. This card is to evaluate the approach and upstream patch if workable.",
        "customfield_10010": null,
        "timetracking": {
            "remainingEstimate": "0h",
            "timeSpent": "1h 20m",
            "remainingEstimateSeconds": 0,
            "timeSpentSeconds": 4800
        },
        "customfield_12314523": null,
        "customfield_12314127": null,
        "customfield_12314522": null,
        "customfield_12314126": null,
        "customfield_12314521": null,
        "customfield_12314125": null,
        "customfield_12314520": null,
        "customfield_12314124": null,
        "attachment": [],
        "customfield_12312340": null,
        "customfield_12314123": null,
        "customfield_12312341": null,
        "customfield_12312220": null,
        "customfield_12314122": null,
        "customfield_12314121": null,
        "customfield_12314120": null,
        "customfield_12314129": null,
        "customfield_12314524": null,
        "customfield_12314128": null,
        "summary": "[C++][Compute] Improve mode kernel performance for small integer types",
        "customfield_12314130": null,
        "customfield_12310291": null,
        "customfield_12310290": null,
        "customfield_12314138": null,
        "customfield_12314137": null,
        "environment": null,
        "customfield_12314136": null,
        "customfield_12314135": null,
        "customfield_12311020": null,
        "customfield_12314134": null,
        "duedate": null,
        "customfield_12314132": null,
        "customfield_12314131": null,
        "comment": {
            "comments": [
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13322183/comment/17183972",
                    "id": "17183972",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=apitrou",
                        "name": "apitrou",
                        "key": "pitrou",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=pitrou&avatarId=35049",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=pitrou&avatarId=35049",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=pitrou&avatarId=35049",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=pitrou&avatarId=35049"
                        },
                        "displayName": "Antoine Pitrou",
                        "active": true,
                        "timeZone": "Europe/Paris"
                    },
                    "body": "Issue resolved by pull request 7963\n[https://github.com/apache/arrow/pull/7963]",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=apitrou",
                        "name": "apitrou",
                        "key": "pitrou",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=pitrou&avatarId=35049",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=pitrou&avatarId=35049",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=pitrou&avatarId=35049",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=pitrou&avatarId=35049"
                        },
                        "displayName": "Antoine Pitrou",
                        "active": true,
                        "timeZone": "Europe/Paris"
                    },
                    "created": "2020-08-25T12:06:42.382+0000",
                    "updated": "2020-08-25T12:06:42.382+0000"
                }
            ],
            "maxResults": 1,
            "total": 1,
            "startAt": 0
        },
        "customfield_12311820": "0|z0hok0:",
        "customfield_12314139": null
    }
}