{
    "expand": "operations,versionedRepresentations,editmeta,changelog,renderedFields",
    "id": "13269564",
    "self": "https://issues.apache.org/jira/rest/api/2/issue/13269564",
    "key": "ARROW-7216",
    "fields": {
        "fixVersions": [
            {
                "self": "https://issues.apache.org/jira/rest/api/2/version/12340948",
                "id": "12340948",
                "description": "",
                "name": "0.16.0",
                "archived": false,
                "released": true,
                "releaseDate": "2020-02-07"
            }
        ],
        "resolution": {
            "self": "https://issues.apache.org/jira/rest/api/2/resolution/1",
            "id": "1",
            "description": "A fix for this issue is checked into the tree and tested.",
            "name": "Fixed"
        },
        "customfield_12312322": null,
        "customfield_12312323": null,
        "customfield_12312320": null,
        "customfield_12310420": "9223372036854775807",
        "customfield_12312321": null,
        "customfield_12312328": null,
        "customfield_12312329": null,
        "customfield_12312326": null,
        "customfield_12310300": null,
        "customfield_12312327": null,
        "customfield_12312324": null,
        "customfield_12312720": null,
        "customfield_12312325": null,
        "lastViewed": null,
        "priority": {
            "self": "https://issues.apache.org/jira/rest/api/2/priority/3",
            "iconUrl": "https://issues.apache.org/jira/images/icons/priorities/major.svg",
            "name": "Major",
            "id": "3"
        },
        "labels": [
            "pull-request-available"
        ],
        "customfield_12312333": null,
        "customfield_12312334": null,
        "customfield_12313422": "false",
        "customfield_12310310": "0.0",
        "customfield_12312331": null,
        "customfield_12312332": null,
        "aggregatetimeoriginalestimate": null,
        "timeestimate": 0,
        "customfield_12312330": null,
        "versions": [],
        "customfield_12311120": null,
        "customfield_12313826": null,
        "customfield_12312339": null,
        "issuelinks": [],
        "customfield_12313825": null,
        "assignee": {
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=fan_li_ya",
            "name": "fan_li_ya",
            "key": "fan_li_ya",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=34045",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34045",
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34045",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34045"
            },
            "displayName": "Liya Fan",
            "active": true,
            "timeZone": "Asia/Shanghai"
        },
        "customfield_12312337": null,
        "customfield_12313823": null,
        "customfield_12312338": null,
        "customfield_12311920": null,
        "customfield_12313822": null,
        "customfield_12312335": null,
        "customfield_12313821": null,
        "customfield_12312336": null,
        "customfield_12313820": null,
        "status": {
            "self": "https://issues.apache.org/jira/rest/api/2/status/5",
            "description": "A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.",
            "iconUrl": "https://issues.apache.org/jira/images/icons/statuses/resolved.png",
            "name": "Resolved",
            "id": "5",
            "statusCategory": {
                "self": "https://issues.apache.org/jira/rest/api/2/statuscategory/3",
                "id": 3,
                "key": "done",
                "colorName": "green",
                "name": "Done"
            }
        },
        "components": [
            {
                "self": "https://issues.apache.org/jira/rest/api/2/component/12328933",
                "id": "12328933",
                "name": "Java"
            }
        ],
        "customfield_12312026": null,
        "customfield_12312023": null,
        "customfield_12312024": null,
        "aggregatetimeestimate": 0,
        "customfield_12312022": null,
        "customfield_12310921": null,
        "customfield_12310920": "9223372036854775807",
        "customfield_12312823": null,
        "creator": {
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=fan_li_ya",
            "name": "fan_li_ya",
            "key": "fan_li_ya",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=34045",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34045",
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34045",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34045"
            },
            "displayName": "Liya Fan",
            "active": true,
            "timeZone": "Asia/Shanghai"
        },
        "subtasks": [],
        "reporter": {
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=fan_li_ya",
            "name": "fan_li_ya",
            "key": "fan_li_ya",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=34045",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34045",
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34045",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34045"
            },
            "displayName": "Liya Fan",
            "active": true,
            "timeZone": "Asia/Shanghai"
        },
        "aggregateprogress": {
            "progress": 10200,
            "total": 10200,
            "percent": 100
        },
        "customfield_12313520": null,
        "customfield_12310250": null,
        "progress": {
            "progress": 10200,
            "total": 10200,
            "percent": 100
        },
        "customfield_12313924": null,
        "votes": {
            "self": "https://issues.apache.org/jira/rest/api/2/issue/ARROW-7216/votes",
            "votes": 0,
            "hasVoted": false
        },
        "worklog": {
            "startAt": 0,
            "maxResults": 20,
            "total": 17,
            "worklogs": [
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13269564/worklog/346611",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "liyafan82 commented on pull request #5872: ARROW-7216: [Java] Improve the performance of setting/clearing individual bits\nURL: https://github.com/apache/arrow/pull/5872\n \n \n   Setting/clearing individual bits are key operations for Arrow. In this issue, we improve the performance these operations by:\r\n   \r\n   1. replacing arithmetic operations with bit-wise operations\r\n   2. remove unnecessary casts between int/byte\r\n   3. provide new API to remove the if branch\r\n   \r\n   Benchmark results show that for clearing a bit, the performance improve by 11%, and for general set/clear operation, the performance improve by 4.7%:\r\n   \r\n   before:\r\n   BitVectorHelperBenchmarks.setValidityBitBenchmark avgt 5 4.524 \u00b1 0.015 us/op\r\n   \r\n   after:\r\n   BitVectorHelperBenchmarks.setValidityBitBenchmark avgt 5 4.313 \u00b1 0.011 us/op\r\n   BitVectorHelperBenchmarks.setValidityBitToZeroBenchmark avgt 5 4.020 \u00b1 0.016 us/op\n \n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2019-11-20T10:42:43.902+0000",
                    "updated": "2019-11-20T10:42:43.902+0000",
                    "started": "2019-11-20T10:42:43.902+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "346611",
                    "issueId": "13269564"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13269564/worklog/346615",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "github-actions[bot] commented on issue #5872: ARROW-7216: [Java] Improve the performance of setting/clearing individual bits\nURL: https://github.com/apache/arrow/pull/5872#issuecomment-555947916\n \n \n   https://issues.apache.org/jira/browse/ARROW-7216\n \n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2019-11-20T10:45:48.464+0000",
                    "updated": "2019-11-20T10:45:48.464+0000",
                    "started": "2019-11-20T10:45:48.464+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "346615",
                    "issueId": "13269564"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13269564/worklog/347180",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "emkornfield commented on pull request #5872: ARROW-7216: [Java] Improve the performance of setting/clearing individual bits\nURL: https://github.com/apache/arrow/pull/5872#discussion_r348900110\n \n \n\n ##########\n File path: java/vector/src/main/java/org/apache/arrow/vector/BitVectorHelper.java\n ##########\n @@ -58,12 +58,27 @@ public static int bitIndex(int absoluteBitIndex) {\n   public static void setValidityBitToOne(ArrowBuf validityBuffer, int index) {\n     final int byteIndex = byteIndex(index);\n     final int bitIndex = bitIndex(index);\n-    byte currentByte = validityBuffer.getByte(byteIndex);\n-    final byte bitMask = (byte) (1L << bitIndex);\n+    int currentByte = validityBuffer.getByte(byteIndex);\n+    final int bitMask = 1 << bitIndex;\n     currentByte |= bitMask;\n     validityBuffer.setByte(byteIndex, currentByte);\n   }\n \n+  /**\n+   * Set the bit at provided index to 0.\n+   *\n+   * @param validityBuffer validity buffer of the vector\n+   * @param index index to be set\n+   */\n+  public static void setValidityBitToZero(ArrowBuf validityBuffer, int index) {\n+    final int byteIndex = byteIndex(index);\n \n Review comment:\n   can this delegate to setValidityBit instead?  I think it is likely JIT will inline and do dead-code elimination?\n \n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2019-11-21T05:20:51.000+0000",
                    "updated": "2019-11-21T05:20:51.000+0000",
                    "started": "2019-11-21T05:20:50.999+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "347180",
                    "issueId": "13269564"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13269564/worklog/347181",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "emkornfield commented on pull request #5872: ARROW-7216: [Java] Improve the performance of setting/clearing individual bits\nURL: https://github.com/apache/arrow/pull/5872#discussion_r348900392\n \n \n\n ##########\n File path: java/vector/src/main/java/org/apache/arrow/vector/BitVectorHelper.java\n ##########\n @@ -58,12 +58,27 @@ public static int bitIndex(int absoluteBitIndex) {\n   public static void setValidityBitToOne(ArrowBuf validityBuffer, int index) {\n     final int byteIndex = byteIndex(index);\n     final int bitIndex = bitIndex(index);\n-    byte currentByte = validityBuffer.getByte(byteIndex);\n-    final byte bitMask = (byte) (1L << bitIndex);\n+    int currentByte = validityBuffer.getByte(byteIndex);\n+    final int bitMask = 1 << bitIndex;\n     currentByte |= bitMask;\n     validityBuffer.setByte(byteIndex, currentByte);\n   }\n \n+  /**\n+   * Set the bit at provided index to 0.\n+   *\n+   * @param validityBuffer validity buffer of the vector\n+   * @param index index to be set\n+   */\n+  public static void setValidityBitToZero(ArrowBuf validityBuffer, int index) {\n \n Review comment:\n   I know this mimics the existing setValidityBitToOne, but I think unsetBit would be a better name (we can consider adding an alias for setValidityBitToOne as \"setBit\" as well? \n \n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2019-11-21T05:22:28.642+0000",
                    "updated": "2019-11-21T05:22:28.642+0000",
                    "started": "2019-11-21T05:22:28.642+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "347181",
                    "issueId": "13269564"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13269564/worklog/347182",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "emkornfield commented on pull request #5872: ARROW-7216: [Java] Improve the performance of setting/clearing individual bits\nURL: https://github.com/apache/arrow/pull/5872#discussion_r348900656\n \n \n\n ##########\n File path: java/vector/src/main/java/org/apache/arrow/vector/BitVectorHelper.java\n ##########\n @@ -58,12 +58,27 @@ public static int bitIndex(int absoluteBitIndex) {\n   public static void setValidityBitToOne(ArrowBuf validityBuffer, int index) {\n     final int byteIndex = byteIndex(index);\n     final int bitIndex = bitIndex(index);\n-    byte currentByte = validityBuffer.getByte(byteIndex);\n-    final byte bitMask = (byte) (1L << bitIndex);\n+    int currentByte = validityBuffer.getByte(byteIndex);\n \n Review comment:\n   please provide a comment on why you are assigning a byte to an int.\n \n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2019-11-21T05:24:02.780+0000",
                    "updated": "2019-11-21T05:24:02.780+0000",
                    "started": "2019-11-21T05:24:02.780+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "347182",
                    "issueId": "13269564"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13269564/worklog/347183",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "emkornfield commented on pull request #5872: ARROW-7216: [Java] Improve the performance of setting/clearing individual bits\nURL: https://github.com/apache/arrow/pull/5872#discussion_r348900719\n \n \n\n ##########\n File path: java/vector/src/main/java/org/apache/arrow/vector/BitVectorHelper.java\n ##########\n @@ -74,12 +89,12 @@ public static void setValidityBitToOne(ArrowBuf validityBuffer, int index) {\n   public static void setValidityBit(ArrowBuf validityBuffer, int index, int value) {\n     final int byteIndex = byteIndex(index);\n     final int bitIndex = bitIndex(index);\n-    byte currentByte = validityBuffer.getByte(byteIndex);\n-    final byte bitMask = (byte) (1L << bitIndex);\n+    int currentByte = validityBuffer.getByte(byteIndex);\n \n Review comment:\n   please comment on the assignment.\n \n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2019-11-21T05:24:21.798+0000",
                    "updated": "2019-11-21T05:24:21.798+0000",
                    "started": "2019-11-21T05:24:21.798+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "347183",
                    "issueId": "13269564"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13269564/worklog/347184",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "emkornfield commented on pull request #5872: ARROW-7216: [Java] Improve the performance of setting/clearing individual bits\nURL: https://github.com/apache/arrow/pull/5872#discussion_r348900756\n \n \n\n ##########\n File path: java/vector/src/main/java/org/apache/arrow/vector/BitVectorHelper.java\n ##########\n @@ -74,12 +89,12 @@ public static void setValidityBitToOne(ArrowBuf validityBuffer, int index) {\n   public static void setValidityBit(ArrowBuf validityBuffer, int index, int value) {\n \n Review comment:\n   is this still used?  can it be marked as deprecated?\n \n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2019-11-21T05:24:35.313+0000",
                    "updated": "2019-11-21T05:24:35.313+0000",
                    "started": "2019-11-21T05:24:35.312+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "347184",
                    "issueId": "13269564"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13269564/worklog/347187",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "liyafan82 commented on pull request #5872: ARROW-7216: [Java] Improve the performance of setting/clearing individual bits\nURL: https://github.com/apache/arrow/pull/5872#discussion_r348902684\n \n \n\n ##########\n File path: java/vector/src/main/java/org/apache/arrow/vector/BitVectorHelper.java\n ##########\n @@ -58,12 +58,27 @@ public static int bitIndex(int absoluteBitIndex) {\n   public static void setValidityBitToOne(ArrowBuf validityBuffer, int index) {\n     final int byteIndex = byteIndex(index);\n     final int bitIndex = bitIndex(index);\n-    byte currentByte = validityBuffer.getByte(byteIndex);\n-    final byte bitMask = (byte) (1L << bitIndex);\n+    int currentByte = validityBuffer.getByte(byteIndex);\n+    final int bitMask = 1 << bitIndex;\n     currentByte |= bitMask;\n     validityBuffer.setByte(byteIndex, currentByte);\n   }\n \n+  /**\n+   * Set the bit at provided index to 0.\n+   *\n+   * @param validityBuffer validity buffer of the vector\n+   * @param index index to be set\n+   */\n+  public static void setValidityBitToZero(ArrowBuf validityBuffer, int index) {\n+    final int byteIndex = byteIndex(index);\n \n Review comment:\n   I am sorry I don't understand this comment. You mean this method should be called from setValidityBit?\n \n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2019-11-21T05:34:44.937+0000",
                    "updated": "2019-11-21T05:34:44.937+0000",
                    "started": "2019-11-21T05:34:44.937+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "347187",
                    "issueId": "13269564"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13269564/worklog/347188",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "liyafan82 commented on pull request #5872: ARROW-7216: [Java] Improve the performance of setting/clearing individual bits\nURL: https://github.com/apache/arrow/pull/5872#discussion_r348902871\n \n \n\n ##########\n File path: java/vector/src/main/java/org/apache/arrow/vector/BitVectorHelper.java\n ##########\n @@ -58,12 +58,27 @@ public static int bitIndex(int absoluteBitIndex) {\n   public static void setValidityBitToOne(ArrowBuf validityBuffer, int index) {\n     final int byteIndex = byteIndex(index);\n     final int bitIndex = bitIndex(index);\n-    byte currentByte = validityBuffer.getByte(byteIndex);\n-    final byte bitMask = (byte) (1L << bitIndex);\n+    int currentByte = validityBuffer.getByte(byteIndex);\n+    final int bitMask = 1 << bitIndex;\n     currentByte |= bitMask;\n     validityBuffer.setByte(byteIndex, currentByte);\n   }\n \n+  /**\n+   * Set the bit at provided index to 0.\n+   *\n+   * @param validityBuffer validity buffer of the vector\n+   * @param index index to be set\n+   */\n+  public static void setValidityBitToZero(ArrowBuf validityBuffer, int index) {\n \n Review comment:\n   Sounds good to me. Will provide the alias later.\n \n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2019-11-21T05:35:36.441+0000",
                    "updated": "2019-11-21T05:35:36.441+0000",
                    "started": "2019-11-21T05:35:36.441+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "347188",
                    "issueId": "13269564"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13269564/worklog/347190",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "liyafan82 commented on pull request #5872: ARROW-7216: [Java] Improve the performance of setting/clearing individual bits\nURL: https://github.com/apache/arrow/pull/5872#discussion_r348903289\n \n \n\n ##########\n File path: java/vector/src/main/java/org/apache/arrow/vector/BitVectorHelper.java\n ##########\n @@ -74,12 +89,12 @@ public static void setValidityBitToOne(ArrowBuf validityBuffer, int index) {\n   public static void setValidityBit(ArrowBuf validityBuffer, int index, int value) {\n \n Review comment:\n   I am afraid not. This will be used in scenarios where the bit to set is unknown a priori. \r\n   For example, in BaseVariableWidthVector#public void set(int index, int isSet, int start, int end, ArrowBuf buffer).\n \n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2019-11-21T05:38:06.285+0000",
                    "updated": "2019-11-21T05:38:06.285+0000",
                    "started": "2019-11-21T05:38:06.285+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "347190",
                    "issueId": "13269564"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13269564/worklog/347196",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "liyafan82 commented on pull request #5872: ARROW-7216: [Java] Improve the performance of setting/clearing individual bits\nURL: https://github.com/apache/arrow/pull/5872#discussion_r348906969\n \n \n\n ##########\n File path: java/vector/src/main/java/org/apache/arrow/vector/BitVectorHelper.java\n ##########\n @@ -58,12 +58,27 @@ public static int bitIndex(int absoluteBitIndex) {\n   public static void setValidityBitToOne(ArrowBuf validityBuffer, int index) {\n     final int byteIndex = byteIndex(index);\n     final int bitIndex = bitIndex(index);\n-    byte currentByte = validityBuffer.getByte(byteIndex);\n-    final byte bitMask = (byte) (1L << bitIndex);\n+    int currentByte = validityBuffer.getByte(byteIndex);\n \n Review comment:\n   Good point. Comment added.\n \n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2019-11-21T05:57:10.464+0000",
                    "updated": "2019-11-21T05:57:10.464+0000",
                    "started": "2019-11-21T05:57:10.463+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "347196",
                    "issueId": "13269564"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13269564/worklog/347197",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "liyafan82 commented on pull request #5872: ARROW-7216: [Java] Improve the performance of setting/clearing individual bits\nURL: https://github.com/apache/arrow/pull/5872#discussion_r348907015\n \n \n\n ##########\n File path: java/vector/src/main/java/org/apache/arrow/vector/BitVectorHelper.java\n ##########\n @@ -74,12 +89,12 @@ public static void setValidityBitToOne(ArrowBuf validityBuffer, int index) {\n   public static void setValidityBit(ArrowBuf validityBuffer, int index, int value) {\n     final int byteIndex = byteIndex(index);\n     final int bitIndex = bitIndex(index);\n-    byte currentByte = validityBuffer.getByte(byteIndex);\n-    final byte bitMask = (byte) (1L << bitIndex);\n+    int currentByte = validityBuffer.getByte(byteIndex);\n \n Review comment:\n   Comment added. Thank you.\n \n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2019-11-21T05:57:22.118+0000",
                    "updated": "2019-11-21T05:57:22.118+0000",
                    "started": "2019-11-21T05:57:22.118+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "347197",
                    "issueId": "13269564"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13269564/worklog/347218",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "liyafan82 commented on pull request #5872: ARROW-7216: [Java] Improve the performance of setting/clearing individual bits\nURL: https://github.com/apache/arrow/pull/5872#discussion_r348917446\n \n \n\n ##########\n File path: java/vector/src/main/java/org/apache/arrow/vector/BitVectorHelper.java\n ##########\n @@ -58,12 +58,27 @@ public static int bitIndex(int absoluteBitIndex) {\n   public static void setValidityBitToOne(ArrowBuf validityBuffer, int index) {\n     final int byteIndex = byteIndex(index);\n     final int bitIndex = bitIndex(index);\n-    byte currentByte = validityBuffer.getByte(byteIndex);\n-    final byte bitMask = (byte) (1L << bitIndex);\n+    int currentByte = validityBuffer.getByte(byteIndex);\n+    final int bitMask = 1 << bitIndex;\n     currentByte |= bitMask;\n     validityBuffer.setByte(byteIndex, currentByte);\n   }\n \n+  /**\n+   * Set the bit at provided index to 0.\n+   *\n+   * @param validityBuffer validity buffer of the vector\n+   * @param index index to be set\n+   */\n+  public static void setValidityBitToZero(ArrowBuf validityBuffer, int index) {\n \n Review comment:\n   Alias provided. Please take a look. Thank you.\n \n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2019-11-21T06:46:00.077+0000",
                    "updated": "2019-11-21T06:46:00.077+0000",
                    "started": "2019-11-21T06:46:00.077+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "347218",
                    "issueId": "13269564"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13269564/worklog/347222",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "emkornfield commented on pull request #5872: ARROW-7216: [Java] Improve the performance of setting/clearing individual bits\nURL: https://github.com/apache/arrow/pull/5872#discussion_r348920022\n \n \n\n ##########\n File path: java/vector/src/main/java/org/apache/arrow/vector/BitVectorHelper.java\n ##########\n @@ -58,12 +58,27 @@ public static int bitIndex(int absoluteBitIndex) {\n   public static void setValidityBitToOne(ArrowBuf validityBuffer, int index) {\n     final int byteIndex = byteIndex(index);\n     final int bitIndex = bitIndex(index);\n-    byte currentByte = validityBuffer.getByte(byteIndex);\n-    final byte bitMask = (byte) (1L << bitIndex);\n+    int currentByte = validityBuffer.getByte(byteIndex);\n+    final int bitMask = 1 << bitIndex;\n     currentByte |= bitMask;\n     validityBuffer.setByte(byteIndex, currentByte);\n   }\n \n+  /**\n+   * Set the bit at provided index to 0.\n+   *\n+   * @param validityBuffer validity buffer of the vector\n+   * @param index index to be set\n+   */\n+  public static void setValidityBitToZero(ArrowBuf validityBuffer, int index) {\n+    final int byteIndex = byteIndex(index);\n \n Review comment:\n   sorry I thought I replied here, the performance benchmarks show the JIT will not eliminate the branches.  we should comment on why code duplication is necessary instead of calling setValidityBit below.\n \n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2019-11-21T06:56:39.798+0000",
                    "updated": "2019-11-21T06:56:39.798+0000",
                    "started": "2019-11-21T06:56:39.798+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "347222",
                    "issueId": "13269564"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13269564/worklog/347234",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "liyafan82 commented on pull request #5872: ARROW-7216: [Java] Improve the performance of setting/clearing individual bits\nURL: https://github.com/apache/arrow/pull/5872#discussion_r348924209\n \n \n\n ##########\n File path: java/vector/src/main/java/org/apache/arrow/vector/BitVectorHelper.java\n ##########\n @@ -58,12 +58,27 @@ public static int bitIndex(int absoluteBitIndex) {\n   public static void setValidityBitToOne(ArrowBuf validityBuffer, int index) {\n     final int byteIndex = byteIndex(index);\n     final int bitIndex = bitIndex(index);\n-    byte currentByte = validityBuffer.getByte(byteIndex);\n-    final byte bitMask = (byte) (1L << bitIndex);\n+    int currentByte = validityBuffer.getByte(byteIndex);\n+    final int bitMask = 1 << bitIndex;\n     currentByte |= bitMask;\n     validityBuffer.setByte(byteIndex, currentByte);\n   }\n \n+  /**\n+   * Set the bit at provided index to 0.\n+   *\n+   * @param validityBuffer validity buffer of the vector\n+   * @param index index to be set\n+   */\n+  public static void setValidityBitToZero(ArrowBuf validityBuffer, int index) {\n+    final int byteIndex = byteIndex(index);\n \n Review comment:\n   I see. Thanks for the clarification.\r\n   I have added comments explicitly to discuss this. \n \n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2019-11-21T07:13:39.295+0000",
                    "updated": "2019-11-21T07:13:39.295+0000",
                    "started": "2019-11-21T07:13:39.295+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "347234",
                    "issueId": "13269564"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13269564/worklog/347932",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "emkornfield commented on issue #5872: ARROW-7216: [Java] Improve the performance of setting/clearing individual bits\nURL: https://github.com/apache/arrow/pull/5872#issuecomment-557398493\n \n \n   +1, thank you.\n \n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2019-11-22T05:44:58.332+0000",
                    "updated": "2019-11-22T05:44:58.332+0000",
                    "started": "2019-11-22T05:44:58.332+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "347932",
                    "issueId": "13269564"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13269564/worklog/347933",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "emkornfield commented on pull request #5872: ARROW-7216: [Java] Improve the performance of setting/clearing individual bits\nURL: https://github.com/apache/arrow/pull/5872\n \n \n   \n \n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2019-11-22T05:45:31.304+0000",
                    "updated": "2019-11-22T05:45:31.304+0000",
                    "started": "2019-11-22T05:45:31.303+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "347933",
                    "issueId": "13269564"
                }
            ]
        },
        "customfield_12313920": null,
        "issuetype": {
            "self": "https://issues.apache.org/jira/rest/api/2/issuetype/4",
            "id": "4",
            "description": "An improvement or enhancement to an existing feature or task.",
            "iconUrl": "https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21140&avatarType=issuetype",
            "name": "Improvement",
            "subtask": false,
            "avatarId": 21140
        },
        "timespent": 10200,
        "customfield_12314020": "{summaryBean=com.atlassian.jira.plugin.devstatus.rest.SummaryBean@11296b27[summary={pullrequest=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@77c3ec5e[overall=PullRequestOverallBean{stateCount=0, state='OPEN', details=PullRequestOverallDetails{openCount=0, mergedCount=0, declinedCount=0}},byInstanceType={}], build=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@a9b4667[overall=com.atlassian.jira.plugin.devstatus.summary.beans.BuildOverallBean@62d2fa76[failedBuildCount=0,successfulBuildCount=0,unknownBuildCount=0,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], review=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@288c6b37[overall=com.atlassian.jira.plugin.devstatus.summary.beans.ReviewsOverallBean@739ef064[stateCount=0,state=<null>,dueDate=<null>,overDue=false,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], deployment-environment=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@23e6280e[overall=com.atlassian.jira.plugin.devstatus.summary.beans.DeploymentOverallBean@5692774e[topEnvironments=[],showProjects=false,successfulCount=0,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], repository=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@1d8c6b78[overall=com.atlassian.jira.plugin.devstatus.summary.beans.CommitOverallBean@1915a57d[count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], branch=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@b214809[overall=com.atlassian.jira.plugin.devstatus.summary.beans.BranchOverallBean@4e4c6624[count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}]},errors=[],configErrors=[]], devSummaryJson={\"cachedValue\":{\"errors\":[],\"configErrors\":[],\"summary\":{\"pullrequest\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"stateCount\":0,\"state\":\"OPEN\",\"details\":{\"openCount\":0,\"mergedCount\":0,\"declinedCount\":0,\"total\":0},\"open\":true},\"byInstanceType\":{}},\"build\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"failedBuildCount\":0,\"successfulBuildCount\":0,\"unknownBuildCount\":0},\"byInstanceType\":{}},\"review\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"stateCount\":0,\"state\":null,\"dueDate\":null,\"overDue\":false,\"completed\":false},\"byInstanceType\":{}},\"deployment-environment\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"topEnvironments\":[],\"showProjects\":false,\"successfulCount\":0},\"byInstanceType\":{}},\"repository\":{\"overall\":{\"count\":0,\"lastUpdated\":null},\"byInstanceType\":{}},\"branch\":{\"overall\":{\"count\":0,\"lastUpdated\":null},\"byInstanceType\":{}}}},\"isStale\":false}}",
        "customfield_12314141": null,
        "customfield_12314140": null,
        "project": {
            "self": "https://issues.apache.org/jira/rest/api/2/project/12319525",
            "id": "12319525",
            "key": "ARROW",
            "name": "Apache Arrow",
            "projectTypeKey": "software",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/projectavatar?pid=12319525&avatarId=10011",
                "24x24": "https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12319525&avatarId=10011",
                "16x16": "https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12319525&avatarId=10011",
                "32x32": "https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12319525&avatarId=10011"
            },
            "projectCategory": {
                "self": "https://issues.apache.org/jira/rest/api/2/projectCategory/13960",
                "id": "13960",
                "description": "Apache Arrow",
                "name": "Arrow"
            }
        },
        "aggregatetimespent": 10200,
        "customfield_12312520": null,
        "customfield_12312521": "Fri Nov 22 05:45:34 UTC 2019",
        "customfield_12314422": null,
        "customfield_12314421": null,
        "customfield_12314146": null,
        "customfield_12314420": null,
        "customfield_12314145": null,
        "customfield_12314144": null,
        "customfield_12314143": null,
        "resolutiondate": "2019-11-22T05:45:33.000+0000",
        "workratio": -1,
        "customfield_12312923": null,
        "customfield_12312920": null,
        "customfield_12312921": null,
        "watches": {
            "self": "https://issues.apache.org/jira/rest/api/2/issue/ARROW-7216/watchers",
            "watchCount": 1,
            "isWatching": false
        },
        "created": "2019-11-20T10:28:39.000+0000",
        "updated": "2019-11-22T05:45:34.000+0000",
        "timeoriginalestimate": null,
        "description": "Setting/clearing individual bits are key operations for Arrow. In this issue, we improve the performance these operations by:\r\n\r\n1. replacing arithmetic operations with bit-wise operations\r\n2. remove unnecessary casts between int/byte\r\n3. provide new API to remove the if branch\r\n\r\nBenchmark results show that for clearing a bit, the performance improve by 11%, and for general set/clear operation, the performance improve by 4.7%:\r\n\r\nbefore:\r\nBitVectorHelperBenchmarks.setValidityBitBenchmark        avgt    5  4.524 \u00b1 0.015  us/op\r\n\r\nafter:\r\nBitVectorHelperBenchmarks.setValidityBitBenchmark        avgt    5  4.313 \u00b1 0.011  us/op\r\nBitVectorHelperBenchmarks.setValidityBitToZeroBenchmark  avgt    5  4.020 \u00b1 0.016  us/op\r\n\r\n",
        "customfield_10010": null,
        "timetracking": {
            "remainingEstimate": "0h",
            "timeSpent": "2h 50m",
            "remainingEstimateSeconds": 0,
            "timeSpentSeconds": 10200
        },
        "customfield_12314523": null,
        "customfield_12314127": null,
        "customfield_12314522": null,
        "customfield_12314126": null,
        "customfield_12314521": null,
        "customfield_12314125": null,
        "customfield_12314520": null,
        "customfield_12314124": null,
        "attachment": [],
        "customfield_12312340": null,
        "customfield_12314123": null,
        "customfield_12312341": null,
        "customfield_12312220": null,
        "customfield_12314122": null,
        "customfield_12314121": null,
        "customfield_12314120": null,
        "customfield_12314129": null,
        "customfield_12314524": null,
        "customfield_12314128": null,
        "summary": "[Java] Improve the performance of setting/clearing individual bits",
        "customfield_12314130": null,
        "customfield_12310291": null,
        "customfield_12310290": null,
        "customfield_12314138": null,
        "customfield_12314137": null,
        "environment": null,
        "customfield_12314136": null,
        "customfield_12314135": null,
        "customfield_12311020": null,
        "customfield_12314134": null,
        "duedate": null,
        "customfield_12314132": null,
        "customfield_12314131": null,
        "comment": {
            "comments": [
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13269564/comment/16979876",
                    "id": "16979876",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=emkornfield%40gmail.com",
                        "name": "emkornfield@gmail.com",
                        "key": "emkornfield@gmail.com",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "Micah Kornfield",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "body": "Issue resolved by pull request 5872\n[https://github.com/apache/arrow/pull/5872]",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=emkornfield%40gmail.com",
                        "name": "emkornfield@gmail.com",
                        "key": "emkornfield@gmail.com",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "Micah Kornfield",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "created": "2019-11-22T05:45:34.020+0000",
                    "updated": "2019-11-22T05:45:34.020+0000"
                }
            ],
            "maxResults": 1,
            "total": 1,
            "startAt": 0
        },
        "customfield_12311820": "0|z08trk:",
        "customfield_12314139": null
    }
}