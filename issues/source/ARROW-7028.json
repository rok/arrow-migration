{
    "expand": "operations,versionedRepresentations,editmeta,changelog,renderedFields",
    "id": "13265246",
    "self": "https://issues.apache.org/jira/rest/api/2/issue/13265246",
    "key": "ARROW-7028",
    "fields": {
        "fixVersions": [
            {
                "self": "https://issues.apache.org/jira/rest/api/2/version/12347769",
                "id": "12347769",
                "description": "",
                "name": "1.0.0",
                "archived": false,
                "released": true,
                "releaseDate": "2020-07-24"
            }
        ],
        "resolution": {
            "self": "https://issues.apache.org/jira/rest/api/2/resolution/1",
            "id": "1",
            "description": "A fix for this issue is checked into the tree and tested.",
            "name": "Fixed"
        },
        "customfield_12312322": null,
        "customfield_12312323": null,
        "customfield_12312320": null,
        "customfield_12310420": "9223372036854775807",
        "customfield_12312321": null,
        "customfield_12312328": null,
        "customfield_12312329": null,
        "customfield_12312326": null,
        "customfield_12310300": null,
        "customfield_12312327": null,
        "customfield_12312324": null,
        "customfield_12312720": null,
        "customfield_12312325": null,
        "lastViewed": null,
        "priority": {
            "self": "https://issues.apache.org/jira/rest/api/2/priority/3",
            "iconUrl": "https://issues.apache.org/jira/images/icons/priorities/major.svg",
            "name": "Major",
            "id": "3"
        },
        "labels": [
            "pull-request-available"
        ],
        "customfield_12312333": null,
        "customfield_12312334": null,
        "customfield_12313422": "false",
        "customfield_12310310": "1.0",
        "customfield_12312331": null,
        "customfield_12312332": null,
        "aggregatetimeoriginalestimate": null,
        "timeestimate": 0,
        "customfield_12312330": null,
        "versions": [
            {
                "self": "https://issues.apache.org/jira/rest/api/2/version/12345978",
                "id": "12345978",
                "description": "",
                "name": "0.15.0",
                "archived": false,
                "released": true,
                "releaseDate": "2019-10-05"
            }
        ],
        "customfield_12311120": null,
        "customfield_12313826": null,
        "customfield_12312339": null,
        "issuelinks": [],
        "customfield_12313825": null,
        "assignee": {
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=romainfrancois",
            "name": "romainfrancois",
            "key": "romainfrancois",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=romainfrancois&avatarId=35092",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=romainfrancois&avatarId=35092",
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=romainfrancois&avatarId=35092",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=romainfrancois&avatarId=35092"
            },
            "displayName": "Romain Francois",
            "active": true,
            "timeZone": "Etc/UTC"
        },
        "customfield_12312337": null,
        "customfield_12313823": null,
        "customfield_12312338": null,
        "customfield_12311920": null,
        "customfield_12313822": null,
        "customfield_12312335": null,
        "customfield_12313821": null,
        "customfield_12312336": null,
        "customfield_12313820": null,
        "status": {
            "self": "https://issues.apache.org/jira/rest/api/2/status/5",
            "description": "A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.",
            "iconUrl": "https://issues.apache.org/jira/images/icons/statuses/resolved.png",
            "name": "Resolved",
            "id": "5",
            "statusCategory": {
                "self": "https://issues.apache.org/jira/rest/api/2/statuscategory/3",
                "id": 3,
                "key": "done",
                "colorName": "green",
                "name": "Done"
            }
        },
        "components": [
            {
                "self": "https://issues.apache.org/jira/rest/api/2/component/12333008",
                "id": "12333008",
                "name": "R"
            }
        ],
        "customfield_12312026": null,
        "customfield_12312023": null,
        "customfield_12312024": null,
        "aggregatetimeestimate": 0,
        "customfield_12312022": null,
        "customfield_12310921": null,
        "customfield_12310920": "9223372036854775807",
        "customfield_12312823": null,
        "creator": {
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=Daab",
            "name": "Daab",
            "key": "daab",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
            },
            "displayName": "Sascha",
            "active": true,
            "timeZone": "Europe/Berlin"
        },
        "subtasks": [],
        "reporter": {
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=Daab",
            "name": "Daab",
            "key": "daab",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
            },
            "displayName": "Sascha",
            "active": true,
            "timeZone": "Europe/Berlin"
        },
        "aggregateprogress": {
            "progress": 5400,
            "total": 5400,
            "percent": 100
        },
        "customfield_12313520": null,
        "customfield_12310250": null,
        "progress": {
            "progress": 5400,
            "total": 5400,
            "percent": 100
        },
        "customfield_12313924": null,
        "votes": {
            "self": "https://issues.apache.org/jira/rest/api/2/issue/ARROW-7028/votes",
            "votes": 0,
            "hasVoted": false
        },
        "worklog": {
            "startAt": 0,
            "maxResults": 20,
            "total": 9,
            "worklogs": [
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13265246/worklog/444778",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "romainfrancois opened a new pull request #7415:\nURL: https://github.com/apache/arrow/pull/7415\n\n\n   Although it's to some extent tolerated that Date vectors are backed by `integer` vectors, it's much more common that they are backed by numeric: \r\n   \r\n   ``` r\r\n   .Internal(inspect(Sys.Date()))\r\n   #> @7fb95b8178c0 14 REALSXP g0c1 [OBJ,ATT] (len=1, tl=0) 18425\r\n   #> ATTRIB:\r\n   #>   @7fb9586b1808 02 LISTSXP g0c0 [REF(1)] \r\n   #>     TAG: @7fb957004fd0 01 SYMSXP g0c0 [MARK,REF(25905),LCK,gp=0x6000] \"class\" (has value)\r\n   #>     @7fb95b817888 16 STRSXP g0c1 [REF(1)] (len=1, tl=0)\r\n   #>       @7fb9571c1530 09 CHARSXP g0c1 [MARK,REF(191),gp=0x61] [ASCII] [cached] \"Date\"\r\n   .Internal(inspect(as.Date(\"1982-05-15\")))\r\n   #> @7fb95c10eb58 14 REALSXP g0c1 [OBJ,ATT] (len=1, tl=0) 4517\r\n   #> ATTRIB:\r\n   #>   @7fb9587cbc48 02 LISTSXP g0c0 [REF(1)] \r\n   #>     TAG: @7fb957004fd0 01 SYMSXP g0c0 [MARK,REF(25948),LCK,gp=0x6000] \"class\" (has value)\r\n   #>     @7fb95c10eb20 16 STRSXP g0c1 [REF(1)] (len=1, tl=0)\r\n   #>       @7fb9571c1530 09 CHARSXP g0c1 [MARK,REF(192),gp=0x61] [ASCII] [cached] \"Date\"\r\n   ```\r\n   \r\n   <sup>Created on 2020-06-12 by the [reprex package](https://reprex.tidyverse.org) (v0.3.0)</sup>\r\n   \r\n   So I've changed `Converter_Date32` to convert to a numeric vector: \r\n   \r\n   ``` r\r\n   library(dplyr, warn.conflicts = FALSE)\r\n   \r\n   tmp = tempdir()\r\n   dat = tibble(tag = as.Date(\"2018-01-01\"))\r\n   dat2 = tibble(tag2 = as.Date(\"2019-01-01\"))\r\n   \r\n   arrow::write_parquet(dat, file.path(tmp, \"dat.parquet\"))\r\n   dat = arrow::read_parquet(file.path(tmp, \"dat.parquet\"))\r\n   \r\n   typeof(dat$tag)\r\n   #> [1] \"double\"\r\n   typeof(dat2$tag2)\r\n   #> [1] \"double\"\r\n   \r\n   bind_cols(dat, dat2) %>%\r\n     mutate(comparison = if_else(TRUE, tag, tag2))\r\n   #> # A tibble: 1 x 3\r\n   #>   tag        tag2       comparison\r\n   #>   <date>     <date>     <date>    \r\n   #> 1 2018-01-01 2019-01-01 2018-01-01\r\n   ```\r\n   \r\n   <sup>Created on 2020-06-12 by the [reprex package](https://reprex.tidyverse.org) (v0.3.0)</sup>\r\n   \r\n   Note: `dplyr::if_else` is due a rewrite, probably in `funs::` that will be more `vctrs`-correct and perhaps would deal with the issue: \r\n   \r\n   ``` r\r\n   library(dplyr, warn.conflicts = FALSE)\r\n   \r\n   today_dbl <- Sys.Date()\r\n   today_int <- structure(as.integer(today_dbl), class = \"Date\")\r\n   \r\n   dplyr::if_else(TRUE, today_dbl, today_int)\r\n   #> Error: `false` must be a `Date` object, not a `Date` object.\r\n   ```\r\n   \r\n   <sup>Created on 2020-06-12 by the [reprex package](https://reprex.tidyverse.org) (v0.3.0)</sup>\r\n   \r\n   This might be a usecase for `vctrs::vec_cast_common()`. ping @lionel- @DavisVaughan: \r\n   \r\n   ``` r\r\n   library(dplyr, warn.conflicts = FALSE)\r\n   \r\n   today_dbl <- Sys.Date()\r\n   today_int <- structure(as.integer(today_dbl), class = \"Date\")\r\n   .Internal(inspect(\r\n     vctrs::vec_cast_common(today_dbl, today_int)\r\n   ))\r\n   #> @7ffe825f1688 19 VECSXP g0c2 [] (len=2, tl=0)\r\n   #>   @7ffe823aeaa0 14 REALSXP g0c1 [OBJ,REF(12),ATT] (len=1, tl=0) 18425\r\n   #>   ATTRIB:\r\n   #>     @7ffe823b5408 02 LISTSXP g0c0 [REF(1)] \r\n   #>       TAG: @7ffe80804fd0 01 SYMSXP g1c0 [MARK,REF(33031),LCK,gp=0x6000] \"class\" (has value)\r\n   #>       @7ffe823aea68 16 STRSXP g0c1 [REF(65535)] (len=1, tl=0)\r\n   #>  @7ffe809c1530 09 CHARSXP g1c1 [MARK,REF(395),gp=0x61] [ASCII] [cached] \"Date\"\r\n   #>   @7ffe8265eb30 14 REALSXP g0c1 [OBJ,REF(1),ATT] (len=1, tl=0) 18425\r\n   #>   ATTRIB:\r\n   #>     @7ffe82664938 02 LISTSXP g0c0 [REF(1)] \r\n   #>       TAG: @7ffe80804fd0 01 SYMSXP g1c0 [MARK,REF(33031),LCK,gp=0x6000] \"class\" (has value)\r\n   #>       @7ffe82d15d60 16 STRSXP g1c1 [MARK,REF(65535)] (len=1, tl=0)\r\n   #>  @7ffe809c1530 09 CHARSXP g1c1 [MARK,REF(395),gp=0x61] [ASCII] [cached] \"Date\"\r\n   ```\r\n   \r\n   <sup>Created on 2020-06-12 by the [reprex package](https://reprex.tidyverse.org) (v0.3.0)</sup>\n\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2020-06-12T09:10:52.709+0000",
                    "updated": "2020-06-12T09:10:52.709+0000",
                    "started": "2020-06-12T09:10:52.709+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "444778",
                    "issueId": "13265246"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13265246/worklog/444781",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "github-actions[bot] commented on pull request #7415:\nURL: https://github.com/apache/arrow/pull/7415#issuecomment-643169120\n\n\n   https://issues.apache.org/jira/browse/ARROW-7028\n\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2020-06-12T09:17:03.074+0000",
                    "updated": "2020-06-12T09:17:03.074+0000",
                    "started": "2020-06-12T09:17:03.074+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "444781",
                    "issueId": "13265246"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13265246/worklog/444828",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "DavisVaughan commented on pull request #7415:\nURL: https://github.com/apache/arrow/pull/7415#issuecomment-643237635\n\n\n   @romainfrancois `funs::if_else()` is one of the few functions that is already implemented in funs and it does handle this correctly. `vec_cast()` and `vec_ptype2()` always push towards numeric Dates, no matter what the input is. I would imagine the same should happen here.\r\n   \r\n   I would say the round trip options are:\r\n   \r\n   ```\r\n   Date<int> -> arrow -> Date<dbl>\r\n   Date<dbl> -> arrow -> Date<dbl>\r\n   ```\n\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2020-06-12T12:12:22.221+0000",
                    "updated": "2020-06-12T12:12:22.221+0000",
                    "started": "2020-06-12T12:12:22.220+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "444828",
                    "issueId": "13265246"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13265246/worklog/444880",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "romainfrancois commented on pull request #7415:\nURL: https://github.com/apache/arrow/pull/7415#issuecomment-643274152\n\n\n   Thanks, I had not checked `funs::if_else()`.\r\n   \r\n   Yeah, a Date32 arrow gets converted to a `Date<dbl>` no matter what, that means data copy as arrow backs it with a int vector internally but `Date<int>` is a weird thing in R. \n\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2020-06-12T13:36:06.785+0000",
                    "updated": "2020-06-12T13:36:06.785+0000",
                    "started": "2020-06-12T13:36:06.785+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "444880",
                    "issueId": "13265246"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13265246/worklog/444960",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "nealrichardson commented on pull request #7415:\nURL: https://github.com/apache/arrow/pull/7415#issuecomment-643332789\n\n\n   Thanks y'all for looking into this. Given where we are right now, this PR is probably an improvement on the status quo. If we had benchmarks that the conversion to Date<dbl> had a big penalty, that would be different, but we don't. But I have to ask: if `funs::if_else()` handles this situation correctly (which I read to mean doesn't error when mixing integer vs. numeric Dates, but maybe I misunderstand what \"correctly\" means), why make the change here? \r\n   \r\n   Longer discussion: Since the R and Arrow data types aren't exactly the same, there's tension between different objectives of the `arrow` package here:\r\n   \r\n   1. Efficiency and fidelity of moving data from/to Arrow memory, zero-copy where possible (which IIUC would point to using integer)\r\n   2. Usability in R and fidelity of R data round trip (which would point to using numeric)\r\n   \r\n   We have a few related issues open currently:\r\n   \r\n   * https://jira.apache.org/jira/browse/ARROW-9083 (int64)\r\n   * https://jira.apache.org/jira/browse/ARROW-7798 (related, discussion of R <--> Arrow conversion code)\r\n   * https://jira.apache.org/jira/browse/ARROW-7657 (handling Arrow dictionary arrays that don't have string type values)\r\n   * https://jira.apache.org/jira/browse/ARROW-6235 (BinaryArray conversion, which doesn't have an exact R analog)\r\n   * https://jira.apache.org/jira/browse/ARROW-3628 (Decimal128 conversion)\r\n   * https://jira.apache.org/jira/browse/ARROW-3446 (documenting how integer types are converted)\r\n   \r\n   I wonder whether for things like this, there should be option(s) for choosing how to do the conversion, based on your use case and needs. \r\n   \n\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2020-06-12T15:23:43.124+0000",
                    "updated": "2020-06-12T15:23:43.124+0000",
                    "started": "2020-06-12T15:23:43.124+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "444960",
                    "issueId": "13265246"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13265246/worklog/444961",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "nealrichardson commented on pull request #7415:\nURL: https://github.com/apache/arrow/pull/7415#issuecomment-643333272\n\n\n   @github-actions autotune everything\n\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2020-06-12T15:24:46.879+0000",
                    "updated": "2020-06-12T15:24:46.879+0000",
                    "started": "2020-06-12T15:24:46.879+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "444961",
                    "issueId": "13265246"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13265246/worklog/446002",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "nealrichardson commented on pull request #7415:\nURL: https://github.com/apache/arrow/pull/7415#issuecomment-644306996\n\n\n   It turns out we don't ever, AFAICT, move data from Arrow to R with zero copy (https://issues.apache.org/jira/browse/ARROW-9140), so I don't have any objections to making this change.\n\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2020-06-15T18:35:42.246+0000",
                    "updated": "2020-06-15T18:35:42.246+0000",
                    "started": "2020-06-15T18:35:42.246+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "446002",
                    "issueId": "13265246"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13265246/worklog/446007",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "nealrichardson commented on a change in pull request #7415:\nURL: https://github.com/apache/arrow/pull/7415#discussion_r440371130\n\n\n\n##########\nFile path: r/tests/testthat/test-Array.R\n##########\n@@ -202,6 +202,8 @@ test_that(\"array supports Date (ARROW-3340)\", {\n   expect_array_roundtrip(d2, date32())\n   # PSA: IngestDoubleRange(Date32Builder) truncates decimals, so this only\n   # works where the dates are integer-ish\n+\n+  expect_equal(typeof(Array$create(d)$as_vector()), \"double\")\n\nReview comment:\n       If we want to assert about R storage type, I'd move the into `expect_array_roundtrip()` defined at the top of this file, below L30:\r\n   \r\n   ```r\r\n   expect_identical(typeof(as.vector(a)), typeof(x))\r\n   ```\r\n   \r\n   so that we can test all types. (I did this locally just now on master, and only Date fails.)\r\n   \r\n   I also wonder if it would be good to add a test here with `dplyr::if_else` to reproduce the original issue. IMO the storage mode is only interesting because of the behavior side effects.\n\n\n\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2020-06-15T18:45:02.739+0000",
                    "updated": "2020-06-15T18:45:02.739+0000",
                    "started": "2020-06-15T18:45:02.738+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "446007",
                    "issueId": "13265246"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13265246/worklog/447406",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "nealrichardson closed pull request #7415:\nURL: https://github.com/apache/arrow/pull/7415\n\n\n   \n\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2020-06-17T17:07:15.084+0000",
                    "updated": "2020-06-17T17:07:15.084+0000",
                    "started": "2020-06-17T17:07:15.083+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "447406",
                    "issueId": "13265246"
                }
            ]
        },
        "customfield_12313920": null,
        "issuetype": {
            "self": "https://issues.apache.org/jira/rest/api/2/issuetype/1",
            "id": "1",
            "description": "A problem which impairs or prevents the functions of the product.",
            "iconUrl": "https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype",
            "name": "Bug",
            "subtask": false,
            "avatarId": 21133
        },
        "timespent": 5400,
        "customfield_12314020": "{summaryBean=com.atlassian.jira.plugin.devstatus.rest.SummaryBean@457072bd[summary={pullrequest=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@4974dac2[overall=PullRequestOverallBean{stateCount=0, state='OPEN', details=PullRequestOverallDetails{openCount=0, mergedCount=0, declinedCount=0}},byInstanceType={}], build=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@57e93d51[overall=com.atlassian.jira.plugin.devstatus.summary.beans.BuildOverallBean@38245fa4[failedBuildCount=0,successfulBuildCount=0,unknownBuildCount=0,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], review=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@1cadc145[overall=com.atlassian.jira.plugin.devstatus.summary.beans.ReviewsOverallBean@5f26b2b7[stateCount=0,state=<null>,dueDate=<null>,overDue=false,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], deployment-environment=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@413b0fb7[overall=com.atlassian.jira.plugin.devstatus.summary.beans.DeploymentOverallBean@5bf8a14b[topEnvironments=[],showProjects=false,successfulCount=0,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], repository=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@29ade498[overall=com.atlassian.jira.plugin.devstatus.summary.beans.CommitOverallBean@43744810[count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], branch=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@5aaba17e[overall=com.atlassian.jira.plugin.devstatus.summary.beans.BranchOverallBean@44c7a199[count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}]},errors=[],configErrors=[]], devSummaryJson={\"cachedValue\":{\"errors\":[],\"configErrors\":[],\"summary\":{\"pullrequest\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"stateCount\":0,\"state\":\"OPEN\",\"details\":{\"openCount\":0,\"mergedCount\":0,\"declinedCount\":0,\"total\":0},\"open\":true},\"byInstanceType\":{}},\"build\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"failedBuildCount\":0,\"successfulBuildCount\":0,\"unknownBuildCount\":0},\"byInstanceType\":{}},\"review\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"stateCount\":0,\"state\":null,\"dueDate\":null,\"overDue\":false,\"completed\":false},\"byInstanceType\":{}},\"deployment-environment\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"topEnvironments\":[],\"showProjects\":false,\"successfulCount\":0},\"byInstanceType\":{}},\"repository\":{\"overall\":{\"count\":0,\"lastUpdated\":null},\"byInstanceType\":{}},\"branch\":{\"overall\":{\"count\":0,\"lastUpdated\":null},\"byInstanceType\":{}}}},\"isStale\":false}}",
        "customfield_12314141": null,
        "customfield_12314140": null,
        "project": {
            "self": "https://issues.apache.org/jira/rest/api/2/project/12319525",
            "id": "12319525",
            "key": "ARROW",
            "name": "Apache Arrow",
            "projectTypeKey": "software",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/projectavatar?pid=12319525&avatarId=10011",
                "24x24": "https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12319525&avatarId=10011",
                "16x16": "https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12319525&avatarId=10011",
                "32x32": "https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12319525&avatarId=10011"
            },
            "projectCategory": {
                "self": "https://issues.apache.org/jira/rest/api/2/projectCategory/13960",
                "id": "13960",
                "description": "Apache Arrow",
                "name": "Arrow"
            }
        },
        "aggregatetimespent": 5400,
        "customfield_12312520": null,
        "customfield_12312521": "Wed Jun 17 17:07:02 UTC 2020",
        "customfield_12314422": null,
        "customfield_12314421": null,
        "customfield_12314146": null,
        "customfield_12314420": null,
        "customfield_12314145": null,
        "customfield_12314144": null,
        "customfield_12314143": null,
        "resolutiondate": "2020-06-17T17:07:02.000+0000",
        "workratio": -1,
        "customfield_12312923": null,
        "customfield_12312920": null,
        "customfield_12312921": null,
        "watches": {
            "self": "https://issues.apache.org/jira/rest/api/2/issue/ARROW-7028/watchers",
            "watchCount": 5,
            "isWatching": false
        },
        "created": "2019-10-30T09:35:31.000+0000",
        "updated": "2020-06-17T17:07:16.000+0000",
        "timeoriginalestimate": null,
        "description": "When saving R-dataframes with parquet and loading them again, the internal representation of Dates changes, leading e.g. to errors when comparing them in dplyr::if_else.\r\n\r\n{code}\r\nlibrary(dplyr)\r\n#> \r\n#> Attaching package: 'dplyr'\r\n#> The following objects are masked from 'package:stats':\r\n#> \r\n#> filter, lag\r\n#> The following objects are masked from 'package:base':\r\n#> \r\n#> intersect, setdiff, setequal, union\r\n\r\ntmp = tempdir()\r\ndat = tibble(tag = as.Date(\"2018-01-01\"))\r\ndat2 = tibble(tag2 = as.Date(\"2019-01-01\"))\r\n\r\narrow::write_parquet(dat, file.path(tmp, \"dat.parquet\"))\r\ndat = arrow::read_parquet(file.path(tmp, \"dat.parquet\"))\r\n\r\ntypeof(dat$tag)\r\n#> [1] \"integer\"\r\ntypeof(dat2$tag2)\r\n#> [1] \"double\"\r\n\r\nbind_cols(dat, dat2) %>%\r\n mutate(comparison = if_else(TRUE, tag, tag2))\r\n#> `false` must be a `Date` object, not a `Date` object\r\n{code}\r\n\r\nCreated on 2019-10-30 by the [reprex package](https://reprex.tidyverse.org) (v0.3.0)",
        "customfield_10010": null,
        "timetracking": {
            "remainingEstimate": "0h",
            "timeSpent": "1.5h",
            "remainingEstimateSeconds": 0,
            "timeSpentSeconds": 5400
        },
        "customfield_12314523": null,
        "customfield_12314127": null,
        "customfield_12314522": null,
        "customfield_12314126": null,
        "customfield_12314521": null,
        "customfield_12314125": null,
        "customfield_12314520": null,
        "customfield_12314124": null,
        "attachment": [
            {
                "self": "https://issues.apache.org/jira/rest/api/2/attachment/12984420",
                "id": "12984420",
                "filename": "image-2019-10-30-23-08-17-296.png",
                "author": {
                    "self": "https://issues.apache.org/jira/rest/api/2/user?username=Daab",
                    "name": "Daab",
                    "key": "daab",
                    "avatarUrls": {
                        "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                        "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                        "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                        "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                    },
                    "displayName": "Sascha",
                    "active": true,
                    "timeZone": "Europe/Berlin"
                },
                "created": "2019-10-30T22:08:17.437+0000",
                "size": 148920,
                "mimeType": "image/png",
                "content": "https://issues.apache.org/jira/secure/attachment/12984420/image-2019-10-30-23-08-17-296.png"
            }
        ],
        "customfield_12312340": null,
        "customfield_12314123": null,
        "customfield_12312341": null,
        "customfield_12312220": null,
        "customfield_12314122": null,
        "customfield_12314121": null,
        "customfield_12314120": null,
        "customfield_12314129": null,
        "customfield_12314524": null,
        "customfield_12314128": null,
        "summary": "[R] Date roundtrip results in different R storage mode",
        "customfield_12314130": null,
        "customfield_12310291": null,
        "customfield_12310290": null,
        "customfield_12314138": null,
        "customfield_12314137": null,
        "environment": null,
        "customfield_12314136": null,
        "customfield_12314135": null,
        "customfield_12311020": null,
        "customfield_12314134": null,
        "duedate": null,
        "customfield_12314132": null,
        "customfield_12314131": null,
        "comment": {
            "comments": [
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13265246/comment/16962860",
                    "id": "16962860",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=uwe",
                        "name": "uwe",
                        "key": "xhochy",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=xhochy&avatarId=30652",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=xhochy&avatarId=30652",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=xhochy&avatarId=30652",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=xhochy&avatarId=30652"
                        },
                        "displayName": "Uwe Korn",
                        "active": true,
                        "timeZone": "Europe/Berlin"
                    },
                    "body": "cc [~npr]\u00a0This is the issue I talked about on Zulip yesterday. This time with an argument why we should ensure better reconstruction.",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=uwe",
                        "name": "uwe",
                        "key": "xhochy",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=xhochy&avatarId=30652",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=xhochy&avatarId=30652",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=xhochy&avatarId=30652",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=xhochy&avatarId=30652"
                        },
                        "displayName": "Uwe Korn",
                        "active": true,
                        "timeZone": "Europe/Berlin"
                    },
                    "created": "2019-10-30T09:44:56.049+0000",
                    "updated": "2019-10-30T09:44:56.049+0000"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13265246/comment/16963238",
                    "id": "16963238",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=npr",
                        "name": "npr",
                        "key": "npr",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=34045",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34045",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34045",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34045"
                        },
                        "displayName": "Neal Richardson",
                        "active": true,
                        "timeZone": "America/Los_Angeles"
                    },
                    "body": "I actually think this is a dplyr bug. The error message {{must be a `Date` object, not a `Date` object}} certainly sounds like it. I did some digging in dplyr source, found where that error message comes from, removed the check, and then {{if_else}} works as expected for Dates because the underlying R methods it calls don't care about the difference between integer and double. For example:\r\n\r\n{code}\r\n> dates1 <- structure(18190:18199, class=\"Date\")\r\n> dates1\r\n [1] \"2019-10-21\" \"2019-10-22\" \"2019-10-23\" \"2019-10-24\" \"2019-10-25\"\r\n [6] \"2019-10-26\" \"2019-10-27\" \"2019-10-28\" \"2019-10-29\" \"2019-10-30\"\r\n> typeof(dates1)\r\n[1] \"integer\"\r\n> dates2 <- structure(as.numeric(18180:18189), class=\"Date\")\r\n> dates2\r\n [1] \"2019-10-11\" \"2019-10-12\" \"2019-10-13\" \"2019-10-14\" \"2019-10-15\"\r\n [6] \"2019-10-16\" \"2019-10-17\" \"2019-10-18\" \"2019-10-19\" \"2019-10-20\"\r\n> typeof(dates2)\r\n[1] \"double\"\r\n> dates1[c(TRUE, FALSE)] <- dates2[c(TRUE, FALSE)]\r\n> dates1\r\n [1] \"2019-10-11\" \"2019-10-22\" \"2019-10-13\" \"2019-10-24\" \"2019-10-15\"\r\n [6] \"2019-10-26\" \"2019-10-17\" \"2019-10-28\" \"2019-10-19\" \"2019-10-30\"\r\n{code}\r\n\r\nI know {{dplyr::if_else}} is supposed to be stricter than {{base::ifelse}} but I'm not sure this is appropriate for Dates. I'll file an issue/PR to dplyr about this. If dplyr maintainers disagree, I'm not sure how to proceed on the Arrow side. It strikes me as wrong to cast the underlying integers in the Arrow Date32 type (or whatever we write R Date types as) to doubles, just in case someone might call dplyr::if_else on it. ",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=npr",
                        "name": "npr",
                        "key": "npr",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=34045",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34045",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34045",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34045"
                        },
                        "displayName": "Neal Richardson",
                        "active": true,
                        "timeZone": "America/Los_Angeles"
                    },
                    "created": "2019-10-30T17:11:38.690+0000",
                    "updated": "2019-10-30T17:11:38.690+0000"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13265246/comment/16963474",
                    "id": "16963474",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=Daab",
                        "name": "Daab",
                        "key": "daab",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "Sascha",
                        "active": true,
                        "timeZone": "Europe/Berlin"
                    },
                    "body": "It seems that R itself can handle numeric values as Dates, but also in a slightly inconsistent way.\r\n\r\n``` r\r\nlibrary(dplyr)\r\n#> \r\n#> Attaching package: 'dplyr'\r\n#> The following objects are masked from 'package:stats':\r\n#> \r\n#> filter, lag\r\n#> The following objects are masked from 'package:base':\r\n#> \r\n#> intersect, setdiff, setequal, union\r\n\r\ntmp = tempdir()\r\n\r\ndat1 = tibble(dt = as.Date(1.5, origin = \"1970-01-01\"))\r\ndat2 = tibble(dt = as.Date(1, origin = \"1970-01-01\"))\r\n\r\ndat1\r\n#> # A tibble: 1 x 1\r\n#> dt \r\n#> <date> \r\n#> 1 1970-01-02\r\ndat2\r\n#> # A tibble: 1 x 1\r\n#> dt \r\n#> <date> \r\n#> 1 1970-01-02\r\n\r\nall.equal(dat1$dt, dat2$dt)\r\n#> [1] \"Mean relative difference: 0.3333333\"\r\n\r\nas.POSIXct(dat1$dt)\r\n#> [1] \"1970-01-02 13:00:00 CET\"\r\nas.POSIXct(dat2$dt)\r\n#> [1] \"1970-01-02 01:00:00 CET\"\r\n\r\nall.equal(as.POSIXct(dat1$dt), dat1$dt)\r\n#> [1] TRUE\r\n\r\nas.Date(dat1$dt) %>% as.numeric()\r\n#> [1] 1.5\r\nas.Date(as.POSIXct(dat1$dt)) %>% as.numeric()\r\n#> [1] 1\r\n\r\narrow::write_parquet(dat1, file.path(tmp, \"dat1.parquet\"))\r\ndat1pq = arrow::read_parquet(file.path(tmp, \"dat1.parquet\"))\r\n\r\nall.equal(dat1$dt, dat1pq$dt)\r\n#> [1] \"Mean relative difference: 0.3333333\"\r\n```\r\n\r\n<sup>Created on 2019-10-30 by the [reprex package](https://reprex.tidyverse.org) (v0.3.0)</sup>\r\n\r\n\u00a0",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=Daab",
                        "name": "Daab",
                        "key": "daab",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "Sascha",
                        "active": true,
                        "timeZone": "Europe/Berlin"
                    },
                    "created": "2019-10-30T22:16:17.530+0000",
                    "updated": "2019-10-30T22:16:17.530+0000"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13265246/comment/16963479",
                    "id": "16963479",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=npr",
                        "name": "npr",
                        "key": "npr",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=34045",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34045",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34045",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34045"
                        },
                        "displayName": "Neal Richardson",
                        "active": true,
                        "timeZone": "America/Los_Angeles"
                    },
                    "body": "In your example, you don't have any actual integer in the underlying storage:\r\n\r\n{code}\r\n> typeof(as.Date(1.5, origin = \"1970-01-01\"))\r\n[1] \"double\"\r\n> typeof(as.Date(1, origin = \"1970-01-01\"))\r\n[1] \"double\"\r\n{code}\r\n\r\nEven if you give as.Date an integer, it becomes a double because of how it handles {{origin}}: \r\n\r\n{code}\r\n> typeof(as.Date(1L, origin = \"1970-01-01\"))\r\n[1] \"double\"\r\n{code}\r\n\r\nThis is why I constructed the dates in my example the way I did, to get around that. So this is not a situation you can easily get yourself into with base R functions. A Date is just a numeric (integer or double, doesn't matter) with a \"Date\" class attribute.",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=npr",
                        "name": "npr",
                        "key": "npr",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=34045",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34045",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34045",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34045"
                        },
                        "displayName": "Neal Richardson",
                        "active": true,
                        "timeZone": "America/Los_Angeles"
                    },
                    "created": "2019-10-30T22:23:41.111+0000",
                    "updated": "2019-10-30T22:23:41.111+0000"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13265246/comment/16964195",
                    "id": "16964195",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=Daab",
                        "name": "Daab",
                        "key": "daab",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "Sascha",
                        "active": true,
                        "timeZone": "Europe/Berlin"
                    },
                    "body": "Jup, agree. Just wanted to say, depending on what you put in your Date class, when saving and loading as parquet you may also run into problems independent of the dplyr-verse as long as parquet converts the numerics to integer...",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=Daab",
                        "name": "Daab",
                        "key": "daab",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "Sascha",
                        "active": true,
                        "timeZone": "Europe/Berlin"
                    },
                    "created": "2019-10-31T16:40:58.661+0000",
                    "updated": "2019-10-31T16:40:58.661+0000"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13265246/comment/16966644",
                    "id": "16966644",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=turtledough",
                        "name": "turtledough",
                        "key": "turtledough",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "Bai Ming",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "body": "Hi, I've just recently tried out the arrow R package, and I've ran into a similar issue, so just wanted to flag this out (otherwise it's been working great for me - thanks!).\r\n\r\nThe underlying cause is the same, but I'm working with the data.table package in R, and the change in internal representation causes some date arithmetic and reassignment to the same column to fail (see code example below). Not sure if arrow was meant to work with data.table, but I think it would be helpful to get back the same type of date column after reading.\r\n\r\nIn my case, I tried to convert my \"integer\" Date to \"double\" Date after reading (by converting the column to character and then to Date again), but it was slow as the data was quite large (or perhaps I didn't do it optimally). Eventually I settled on a workaround to simply avoid reassigning to the same column by creating a new column.\r\n{code:java}\r\nlibrary(dplyr)\r\nlibrary(data.table)\r\n\r\ntmp = tempdir()\r\ndat = tibble(tag = as.Date(\"2018-01-01\"), group = \"A\")\r\ndat2 = tibble(tag2 = as.Date(\"2019-01-01\"), group = \"A\")\r\n\r\narrow::write_parquet(dat, file.path(tmp, \"dat.parquet\"))\r\ndat = arrow::read_parquet(file.path(tmp, \"dat.parquet\"))\r\n\r\ndt <- as.data.table(dat) # Convert to data.table\r\ndt[, tag := tag + 1, group] # Some date operation to add one day and reassign to same column (This line gives an error)\r\n\r\n# Error in `[.data.table`(dt, , `:=`(tag, tag + 1), group) : \r\n#   Type of RHS ('double') must match LHS ('integer'). To check \r\n#   and coerce would impact performance too much for the fastest cases.\r\n#   Either change the type of the target column, or coerce the RHS of :=\r\n#   yourself (e.g. by using 1L instead of 1)\r\n{code}",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=turtledough",
                        "name": "turtledough",
                        "key": "turtledough",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "Bai Ming",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "created": "2019-11-04T13:04:58.389+0000",
                    "updated": "2019-11-04T13:04:58.389+0000"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13265246/comment/16966831",
                    "id": "16966831",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=npr",
                        "name": "npr",
                        "key": "npr",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=34045",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34045",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34045",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34045"
                        },
                        "displayName": "Neal Richardson",
                        "active": true,
                        "timeZone": "America/Los_Angeles"
                    },
                    "body": "The error message suggests a workaround that avoids coercion: \r\n\r\n{code:r}\r\n> dt[, tag := tag + 1, group] \r\nError in `[.data.table`(dt, , `:=`(tag, tag + 1), group) : \r\n  Type of RHS ('double') must match LHS ('integer'). To check and coerce would impact performance too much for the fastest cases. Either change the type of the target column, or coerce the RHS of := yourself (e.g. by using 1L instead of 1)\r\n\r\n> dt[, tag := tag + 1L, group] \r\n> dt\r\n          tag group\r\n1: 2018-01-02     A\r\n{code}\r\n",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=npr",
                        "name": "npr",
                        "key": "npr",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=34045",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34045",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34045",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34045"
                        },
                        "displayName": "Neal Richardson",
                        "active": true,
                        "timeZone": "America/Los_Angeles"
                    },
                    "created": "2019-11-04T17:05:04.198+0000",
                    "updated": "2019-11-04T17:05:04.198+0000"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13265246/comment/16968798",
                    "id": "16968798",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=turtledough",
                        "name": "turtledough",
                        "key": "turtledough",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "Bai Ming",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "body": "Thanks for the workaround, tested it and it works, will use that instead.",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=turtledough",
                        "name": "turtledough",
                        "key": "turtledough",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "Bai Ming",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "created": "2019-11-06T23:51:18.528+0000",
                    "updated": "2019-11-06T23:51:18.528+0000"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13265246/comment/17138649",
                    "id": "17138649",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=npr",
                        "name": "npr",
                        "key": "npr",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=34045",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34045",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34045",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34045"
                        },
                        "displayName": "Neal Richardson",
                        "active": true,
                        "timeZone": "America/Los_Angeles"
                    },
                    "body": "Issue resolved by pull request 7415\n[https://github.com/apache/arrow/pull/7415]",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=npr",
                        "name": "npr",
                        "key": "npr",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=34045",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34045",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34045",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34045"
                        },
                        "displayName": "Neal Richardson",
                        "active": true,
                        "timeZone": "America/Los_Angeles"
                    },
                    "created": "2020-06-17T17:07:02.787+0000",
                    "updated": "2020-06-17T17:07:02.787+0000"
                }
            ],
            "maxResults": 9,
            "total": 9,
            "startAt": 0
        },
        "customfield_12311820": "0|z0834g:",
        "customfield_12314139": null
    }
}