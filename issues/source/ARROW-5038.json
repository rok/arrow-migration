{
    "expand": "operations,versionedRepresentations,editmeta,changelog,renderedFields",
    "id": "13224361",
    "self": "https://issues.apache.org/jira/rest/api/2/issue/13224361",
    "key": "ARROW-5038",
    "fields": {
        "fixVersions": [
            {
                "self": "https://issues.apache.org/jira/rest/api/2/version/12344925",
                "id": "12344925",
                "description": "",
                "name": "0.14.0",
                "archived": false,
                "released": true,
                "releaseDate": "2019-07-04"
            }
        ],
        "resolution": {
            "self": "https://issues.apache.org/jira/rest/api/2/resolution/1",
            "id": "1",
            "description": "A fix for this issue is checked into the tree and tested.",
            "name": "Fixed"
        },
        "customfield_12312322": null,
        "customfield_12312323": null,
        "customfield_12312320": null,
        "customfield_12310420": "9223372036854775807",
        "customfield_12312321": null,
        "customfield_12312328": null,
        "customfield_12312329": null,
        "customfield_12312326": null,
        "customfield_12310300": null,
        "customfield_12312327": null,
        "customfield_12312324": null,
        "customfield_12312720": null,
        "customfield_12312325": null,
        "lastViewed": null,
        "priority": {
            "self": "https://issues.apache.org/jira/rest/api/2/priority/3",
            "iconUrl": "https://issues.apache.org/jira/images/icons/priorities/major.svg",
            "name": "Major",
            "id": "3"
        },
        "labels": [
            "pull-request-available"
        ],
        "customfield_12312333": null,
        "customfield_12312334": null,
        "customfield_12313422": "false",
        "customfield_12310310": "0.0",
        "customfield_12312331": null,
        "customfield_12312332": null,
        "aggregatetimeoriginalestimate": null,
        "timeestimate": 0,
        "customfield_12312330": null,
        "versions": [
            {
                "self": "https://issues.apache.org/jira/rest/api/2/version/12343937",
                "id": "12343937",
                "description": "",
                "name": "0.13.0",
                "archived": false,
                "released": true,
                "releaseDate": "2019-04-01"
            }
        ],
        "customfield_12311120": null,
        "customfield_12313826": null,
        "customfield_12312339": null,
        "issuelinks": [],
        "customfield_12313825": null,
        "assignee": {
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=zhiyuan.zheng",
            "name": "zhiyuan.zheng",
            "key": "zhiyuan.zheng",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
            },
            "displayName": "Zhiyuan Zheng",
            "active": true,
            "timeZone": "Asia/Shanghai"
        },
        "customfield_12312337": null,
        "customfield_12313823": null,
        "customfield_12312338": null,
        "customfield_12311920": null,
        "customfield_12313822": null,
        "customfield_12312335": null,
        "customfield_12313821": null,
        "customfield_12312336": null,
        "customfield_12313820": null,
        "status": {
            "self": "https://issues.apache.org/jira/rest/api/2/status/5",
            "description": "A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.",
            "iconUrl": "https://issues.apache.org/jira/images/icons/statuses/resolved.png",
            "name": "Resolved",
            "id": "5",
            "statusCategory": {
                "self": "https://issues.apache.org/jira/rest/api/2/statuscategory/3",
                "id": 3,
                "key": "done",
                "colorName": "green",
                "name": "Done"
            }
        },
        "components": [
            {
                "self": "https://issues.apache.org/jira/rest/api/2/component/12333773",
                "id": "12333773",
                "name": "Rust"
            },
            {
                "self": "https://issues.apache.org/jira/rest/api/2/component/12335005",
                "id": "12335005",
                "name": "Rust - DataFusion"
            }
        ],
        "customfield_12312026": null,
        "customfield_12312023": null,
        "customfield_12312024": null,
        "aggregatetimeestimate": 0,
        "customfield_12312022": null,
        "customfield_12310921": null,
        "customfield_12310920": "9223372036854775807",
        "customfield_12312823": null,
        "creator": {
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=andygrove",
            "name": "andygrove",
            "key": "andygrove",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=andygrove&avatarId=28239",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=andygrove&avatarId=28239",
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=andygrove&avatarId=28239",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=andygrove&avatarId=28239"
            },
            "displayName": "Andy Grove",
            "active": true,
            "timeZone": "America/Denver"
        },
        "subtasks": [],
        "reporter": {
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=andygrove",
            "name": "andygrove",
            "key": "andygrove",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=andygrove&avatarId=28239",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=andygrove&avatarId=28239",
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=andygrove&avatarId=28239",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=andygrove&avatarId=28239"
            },
            "displayName": "Andy Grove",
            "active": true,
            "timeZone": "America/Denver"
        },
        "aggregateprogress": {
            "progress": 9000,
            "total": 9000,
            "percent": 100
        },
        "customfield_12313520": null,
        "customfield_12310250": null,
        "progress": {
            "progress": 9000,
            "total": 9000,
            "percent": 100
        },
        "customfield_12313924": null,
        "votes": {
            "self": "https://issues.apache.org/jira/rest/api/2/issue/ARROW-5038/votes",
            "votes": 0,
            "hasVoted": false
        },
        "worklog": {
            "startAt": 0,
            "maxResults": 20,
            "total": 16,
            "worklogs": [
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13224361/worklog/223709",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "zhzy0077 commented on pull request #4120: ARROW-5038: [Rust] [DataFusion] Implement AVG aggregate function\nURL: https://github.com/apache/arrow/pull/4120\n \n \n   Implement the AVG aggregate function for DataFusion.\r\n   \r\n   Split `accumulate_scalar` function into `accumulate_scalar` & `accumulate_batch` for single value update and batch update.\r\n   \r\n   I am a newbie to Arrow. Please take careful review for this @andygrove .\n \n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2019-04-05T16:57:20.021+0000",
                    "updated": "2019-04-05T16:57:20.021+0000",
                    "started": "2019-04-05T16:57:20.020+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "223709",
                    "issueId": "13224361"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13224361/worklog/224067",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "andygrove commented on issue #4120: ARROW-5038: [Rust] [DataFusion] Implement AVG aggregate function\nURL: https://github.com/apache/arrow/pull/4120#issuecomment-480519127\n \n \n   Thanks @zhzy0077 ! I took a quick look and this is looking good. I'll find time for a real review in the next few days.\n \n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2019-04-06T16:49:46.449+0000",
                    "updated": "2019-04-06T16:49:46.449+0000",
                    "started": "2019-04-06T16:49:46.448+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "224067",
                    "issueId": "13224361"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13224361/worklog/224192",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "paddyhoran commented on pull request #4120: ARROW-5038: [Rust] [DataFusion] Implement AVG aggregate function\nURL: https://github.com/apache/arrow/pull/4120#discussion_r272878305\n \n \n\n ##########\n File path: rust/datafusion/src/execution/aggregate.rs\n ##########\n @@ -364,28 +430,27 @@ impl AggregateFunction for CountFunction {\n         \"count\"\n     }\n \n-    fn accumulate_scalar(\n-        &mut self,\n-        value: &Option<ScalarValue>,\n-        rollup: bool,\n-    ) -> Result<()> {\n-        if rollup {\n-            // in rollup mode, the counts are added together\n-            if let Some(ScalarValue::UInt64(n)) = value {\n-                self.value = match self.value {\n-                    Some(cur_value) => Some(cur_value + *n),\n-                    _ => Some(*n),\n-                }\n-            }\n-        } else {\n-            // count the value if it is not null\n-            if value.is_some() {\n-                self.value = match self.value {\n-                    Some(cur_value) => Some(cur_value + 1),\n-                    _ => Some(1),\n-                }\n+    fn accumulate_scalar(&mut self, value: &Option<ScalarValue>) -> Result<()> {\n+        if value.is_some() {\n+            self.value = match self.value {\n+                Some(cur_value) => Some(cur_value + 1),\n+                _ => Some(1),\n \n Review comment:\n   Same as above.\n \n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2019-04-08T04:02:31.335+0000",
                    "updated": "2019-04-08T04:02:31.335+0000",
                    "started": "2019-04-08T04:02:31.334+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "224192",
                    "issueId": "13224361"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13224361/worklog/224193",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "paddyhoran commented on pull request #4120: ARROW-5038: [Rust] [DataFusion] Implement AVG aggregate function\nURL: https://github.com/apache/arrow/pull/4120#discussion_r272878171\n \n \n\n ##########\n File path: rust/datafusion/src/execution/aggregate.rs\n ##########\n @@ -347,6 +346,73 @@ impl AggregateFunction for SumFunction {\n     }\n }\n \n+/// Implementation of AVG aggregate function\n+#[derive(Debug)]\n+struct AvgFunction {\n+    data_type: DataType,\n+    sum_value: SumFunction,\n+    count_value: CountFunction,\n+}\n+\n+impl AvgFunction {\n+    fn new(data_type: &DataType) -> Self {\n+        Self {\n+            data_type: DataType::Float64,\n+            sum_value: SumFunction::new(data_type),\n+            count_value: CountFunction::new(),\n+        }\n+    }\n+}\n+\n+impl AggregateFunction for AvgFunction {\n+    fn name(&self) -> &str {\n+        \"avg\"\n+    }\n+\n+    fn accumulate_scalar(&mut self, value: &Option<ScalarValue>) -> Result<()> {\n+        self.sum_value.accumulate_scalar(value)?;\n+        self.count_value.accumulate_scalar(value)?;\n+\n+        Ok(())\n+    }\n+\n+    fn accumulate_batch(&mut self, array: ArrayRef) -> Result<()> {\n+        self.sum_value.accumulate_batch(array.clone())?;\n+        self.count_value.accumulate_batch(array)?;\n+\n+        Ok(())\n+    }\n+\n+    fn result(&self) -> Option<ScalarValue> {\n+        let sum = match self.sum_value.result() {\n+            Some(ScalarValue::UInt8(a)) => a as f64,\n+            Some(ScalarValue::UInt16(a)) => a as f64,\n+            Some(ScalarValue::UInt32(a)) => a as f64,\n+            Some(ScalarValue::UInt64(a)) => a as f64,\n+            Some(ScalarValue::Int8(a)) => a as f64,\n+            Some(ScalarValue::Int16(a)) => a as f64,\n+            Some(ScalarValue::Int32(a)) => a as f64,\n+            Some(ScalarValue::Int64(a)) => a as f64,\n+            Some(ScalarValue::Float32(a)) => a as f64,\n+            Some(ScalarValue::Float64(a)) => a as f64,\n+            _ => {\n+                return None;\n+            }\n+        };\n+        let count = match self.count_value.result() {\n+            Some(ScalarValue::UInt64(a)) => a as f64,\n+            _ => {\n \n Review comment:\n   The only case here is `None` so better to be explicit instead of using `_`\n \n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2019-04-08T04:02:31.339+0000",
                    "updated": "2019-04-08T04:02:31.339+0000",
                    "started": "2019-04-08T04:02:31.338+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "224193",
                    "issueId": "13224361"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13224361/worklog/224194",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "paddyhoran commented on pull request #4120: ARROW-5038: [Rust] [DataFusion] Implement AVG aggregate function\nURL: https://github.com/apache/arrow/pull/4120#discussion_r272878533\n \n \n\n ##########\n File path: rust/datafusion/src/execution/aggregate.rs\n ##########\n @@ -364,28 +430,27 @@ impl AggregateFunction for CountFunction {\n         \"count\"\n     }\n \n-    fn accumulate_scalar(\n-        &mut self,\n-        value: &Option<ScalarValue>,\n-        rollup: bool,\n-    ) -> Result<()> {\n-        if rollup {\n-            // in rollup mode, the counts are added together\n-            if let Some(ScalarValue::UInt64(n)) = value {\n-                self.value = match self.value {\n-                    Some(cur_value) => Some(cur_value + *n),\n-                    _ => Some(*n),\n-                }\n-            }\n-        } else {\n-            // count the value if it is not null\n-            if value.is_some() {\n-                self.value = match self.value {\n-                    Some(cur_value) => Some(cur_value + 1),\n-                    _ => Some(1),\n-                }\n+    fn accumulate_scalar(&mut self, value: &Option<ScalarValue>) -> Result<()> {\n+        if value.is_some() {\n+            self.value = match self.value {\n+                Some(cur_value) => Some(cur_value + 1),\n+                _ => Some(1),\n             }\n         }\n+\n+        Ok(())\n+    }\n+\n+    fn accumulate_batch(&mut self, array: ArrayRef) -> Result<()> {\n+        let accumulated_value = array_count(array)?;\n+\n+        if let Some(ScalarValue::UInt64(n)) = accumulated_value {\n+            self.value = match self.value {\n+                Some(cur_value) => Some(cur_value + n),\n+                _ => Some(n),\n \n Review comment:\n   Same as above.\n \n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2019-04-08T04:02:31.359+0000",
                    "updated": "2019-04-08T04:02:31.359+0000",
                    "started": "2019-04-08T04:02:31.359+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "224194",
                    "issueId": "13224361"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13224361/worklog/224195",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "zhzy0077 commented on pull request #4120: ARROW-5038: [Rust] [DataFusion] Implement AVG aggregate function\nURL: https://github.com/apache/arrow/pull/4120#discussion_r272884608\n \n \n\n ##########\n File path: rust/datafusion/src/execution/aggregate.rs\n ##########\n @@ -347,6 +346,73 @@ impl AggregateFunction for SumFunction {\n     }\n }\n \n+/// Implementation of AVG aggregate function\n+#[derive(Debug)]\n+struct AvgFunction {\n+    data_type: DataType,\n+    sum_value: SumFunction,\n+    count_value: CountFunction,\n+}\n+\n+impl AvgFunction {\n+    fn new(data_type: &DataType) -> Self {\n+        Self {\n+            data_type: DataType::Float64,\n+            sum_value: SumFunction::new(data_type),\n+            count_value: CountFunction::new(),\n+        }\n+    }\n+}\n+\n+impl AggregateFunction for AvgFunction {\n+    fn name(&self) -> &str {\n+        \"avg\"\n+    }\n+\n+    fn accumulate_scalar(&mut self, value: &Option<ScalarValue>) -> Result<()> {\n+        self.sum_value.accumulate_scalar(value)?;\n+        self.count_value.accumulate_scalar(value)?;\n+\n+        Ok(())\n+    }\n+\n+    fn accumulate_batch(&mut self, array: ArrayRef) -> Result<()> {\n+        self.sum_value.accumulate_batch(array.clone())?;\n+        self.count_value.accumulate_batch(array)?;\n+\n+        Ok(())\n+    }\n+\n+    fn result(&self) -> Option<ScalarValue> {\n+        let sum = match self.sum_value.result() {\n+            Some(ScalarValue::UInt8(a)) => a as f64,\n+            Some(ScalarValue::UInt16(a)) => a as f64,\n+            Some(ScalarValue::UInt32(a)) => a as f64,\n+            Some(ScalarValue::UInt64(a)) => a as f64,\n+            Some(ScalarValue::Int8(a)) => a as f64,\n+            Some(ScalarValue::Int16(a)) => a as f64,\n+            Some(ScalarValue::Int32(a)) => a as f64,\n+            Some(ScalarValue::Int64(a)) => a as f64,\n+            Some(ScalarValue::Float32(a)) => a as f64,\n+            Some(ScalarValue::Float64(a)) => a as f64,\n+            _ => {\n+                return None;\n+            }\n+        };\n+        let count = match self.count_value.result() {\n+            Some(ScalarValue::UInt64(a)) => a as f64,\n+            _ => {\n \n Review comment:\n   Nop, all `ScalerValue` except `UInt64` won't be accepted. The `_` is mandatory here.\n \n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2019-04-08T04:47:18.385+0000",
                    "updated": "2019-04-08T04:47:18.385+0000",
                    "started": "2019-04-08T04:47:18.384+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "224195",
                    "issueId": "13224361"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13224361/worklog/224198",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "zhzy0077 commented on issue #4120: ARROW-5038: [Rust] [DataFusion] Implement AVG aggregate function\nURL: https://github.com/apache/arrow/pull/4120#issuecomment-480695164\n \n \n   @paddyhoran Thanks for your advice. Multi batch tests have been added.\n \n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2019-04-08T06:03:20.759+0000",
                    "updated": "2019-04-08T06:03:20.759+0000",
                    "started": "2019-04-08T06:03:20.759+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "224198",
                    "issueId": "13224361"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13224361/worklog/224301",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "paddyhoran commented on pull request #4120: ARROW-5038: [Rust] [DataFusion] Implement AVG aggregate function\nURL: https://github.com/apache/arrow/pull/4120#discussion_r273014256\n \n \n\n ##########\n File path: rust/datafusion/src/execution/aggregate.rs\n ##########\n @@ -347,6 +346,73 @@ impl AggregateFunction for SumFunction {\n     }\n }\n \n+/// Implementation of AVG aggregate function\n+#[derive(Debug)]\n+struct AvgFunction {\n+    data_type: DataType,\n+    sum_value: SumFunction,\n+    count_value: CountFunction,\n+}\n+\n+impl AvgFunction {\n+    fn new(data_type: &DataType) -> Self {\n+        Self {\n+            data_type: DataType::Float64,\n+            sum_value: SumFunction::new(data_type),\n+            count_value: CountFunction::new(),\n+        }\n+    }\n+}\n+\n+impl AggregateFunction for AvgFunction {\n+    fn name(&self) -> &str {\n+        \"avg\"\n+    }\n+\n+    fn accumulate_scalar(&mut self, value: &Option<ScalarValue>) -> Result<()> {\n+        self.sum_value.accumulate_scalar(value)?;\n+        self.count_value.accumulate_scalar(value)?;\n+\n+        Ok(())\n+    }\n+\n+    fn accumulate_batch(&mut self, array: ArrayRef) -> Result<()> {\n+        self.sum_value.accumulate_batch(array.clone())?;\n+        self.count_value.accumulate_batch(array)?;\n+\n+        Ok(())\n+    }\n+\n+    fn result(&self) -> Option<ScalarValue> {\n+        let sum = match self.sum_value.result() {\n+            Some(ScalarValue::UInt8(a)) => a as f64,\n+            Some(ScalarValue::UInt16(a)) => a as f64,\n+            Some(ScalarValue::UInt32(a)) => a as f64,\n+            Some(ScalarValue::UInt64(a)) => a as f64,\n+            Some(ScalarValue::Int8(a)) => a as f64,\n+            Some(ScalarValue::Int16(a)) => a as f64,\n+            Some(ScalarValue::Int32(a)) => a as f64,\n+            Some(ScalarValue::Int64(a)) => a as f64,\n+            Some(ScalarValue::Float32(a)) => a as f64,\n+            Some(ScalarValue::Float64(a)) => a as f64,\n+            _ => {\n+                return None;\n+            }\n+        };\n+        let count = match self.count_value.result() {\n+            Some(ScalarValue::UInt64(a)) => a as f64,\n+            _ => {\n \n Review comment:\n   Right but I mean it's better to be explicit about what is acceptable.  `None` is a valid variant but any other variant except `ScalarVaue::UInt64` is an error.\n \n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2019-04-08T12:12:50.669+0000",
                    "updated": "2019-04-08T12:12:50.669+0000",
                    "started": "2019-04-08T12:12:50.668+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "224301",
                    "issueId": "13224361"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13224361/worklog/224303",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "paddyhoran commented on issue #4120: ARROW-5038: [Rust] [DataFusion] Implement AVG aggregate function\nURL: https://github.com/apache/arrow/pull/4120#issuecomment-480807309\n \n \n   @zhzy0077 It seems you added the fix for ARROW-5126 after your changes.  This is will cause issues with tooling we use to merge.  Could you please revert this commit?  If there is a merge conflict with master you should rebase your changes onto master.\n \n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2019-04-08T12:17:08.042+0000",
                    "updated": "2019-04-08T12:17:08.042+0000",
                    "started": "2019-04-08T12:17:08.041+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "224303",
                    "issueId": "13224361"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13224361/worklog/224306",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "paddyhoran commented on issue #4120: ARROW-5038: [Rust] [DataFusion] Implement AVG aggregate function\nURL: https://github.com/apache/arrow/pull/4120#issuecomment-480809783\n \n \n   I'll leave this up to @andygrove but I think we should be using the term `mean` instead of `avg`.  This is a more accurate description of the calculation (avg is a more general term) and the cpp impl uses `mean`.\n \n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2019-04-08T12:25:00.158+0000",
                    "updated": "2019-04-08T12:25:00.158+0000",
                    "started": "2019-04-08T12:25:00.157+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "224306",
                    "issueId": "13224361"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13224361/worklog/224309",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "zhzy0077 commented on issue #4120: ARROW-5038: [Rust] [DataFusion] Implement AVG aggregate function\nURL: https://github.com/apache/arrow/pull/4120#issuecomment-480811869\n \n \n   Thanks for the hint @paddyhoran . I have force-push to the branch and everything looks good now.\n \n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2019-04-08T12:31:26.880+0000",
                    "updated": "2019-04-08T12:31:26.880+0000",
                    "started": "2019-04-08T12:31:26.879+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "224309",
                    "issueId": "13224361"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13224361/worklog/224316",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "paddyhoran commented on issue #4120: ARROW-5038: [Rust] [DataFusion] Implement AVG aggregate function\nURL: https://github.com/apache/arrow/pull/4120#issuecomment-480807309\n \n \n   @zhzy0077 It seems you added the fix for ARROW-5126 after your changes.  This will cause issues with tooling we use to merge.  Could you please revert this commit?  If there is a merge conflict with master you should rebase your changes onto master.\n \n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2019-04-08T13:00:17.652+0000",
                    "updated": "2019-04-08T13:00:17.652+0000",
                    "started": "2019-04-08T13:00:17.651+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "224316",
                    "issueId": "13224361"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13224361/worklog/224378",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "zhzy0077 commented on pull request #4120: ARROW-5038: [Rust] [DataFusion] Implement AVG aggregate function\nURL: https://github.com/apache/arrow/pull/4120#discussion_r273090084\n \n \n\n ##########\n File path: rust/datafusion/src/execution/aggregate.rs\n ##########\n @@ -347,6 +346,73 @@ impl AggregateFunction for SumFunction {\n     }\n }\n \n+/// Implementation of AVG aggregate function\n+#[derive(Debug)]\n+struct AvgFunction {\n+    data_type: DataType,\n+    sum_value: SumFunction,\n+    count_value: CountFunction,\n+}\n+\n+impl AvgFunction {\n+    fn new(data_type: &DataType) -> Self {\n+        Self {\n+            data_type: DataType::Float64,\n+            sum_value: SumFunction::new(data_type),\n+            count_value: CountFunction::new(),\n+        }\n+    }\n+}\n+\n+impl AggregateFunction for AvgFunction {\n+    fn name(&self) -> &str {\n+        \"avg\"\n+    }\n+\n+    fn accumulate_scalar(&mut self, value: &Option<ScalarValue>) -> Result<()> {\n+        self.sum_value.accumulate_scalar(value)?;\n+        self.count_value.accumulate_scalar(value)?;\n+\n+        Ok(())\n+    }\n+\n+    fn accumulate_batch(&mut self, array: ArrayRef) -> Result<()> {\n+        self.sum_value.accumulate_batch(array.clone())?;\n+        self.count_value.accumulate_batch(array)?;\n+\n+        Ok(())\n+    }\n+\n+    fn result(&self) -> Option<ScalarValue> {\n+        let sum = match self.sum_value.result() {\n+            Some(ScalarValue::UInt8(a)) => a as f64,\n+            Some(ScalarValue::UInt16(a)) => a as f64,\n+            Some(ScalarValue::UInt32(a)) => a as f64,\n+            Some(ScalarValue::UInt64(a)) => a as f64,\n+            Some(ScalarValue::Int8(a)) => a as f64,\n+            Some(ScalarValue::Int16(a)) => a as f64,\n+            Some(ScalarValue::Int32(a)) => a as f64,\n+            Some(ScalarValue::Int64(a)) => a as f64,\n+            Some(ScalarValue::Float32(a)) => a as f64,\n+            Some(ScalarValue::Float64(a)) => a as f64,\n+            _ => {\n+                return None;\n+            }\n+        };\n+        let count = match self.count_value.result() {\n+            Some(ScalarValue::UInt64(a)) => a as f64,\n+            _ => {\n \n Review comment:\n   You are right, but function `result` returns an `Option`. Do we need to change its signature to return a `Result` in order to represent a error case?\n \n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2019-04-08T14:54:36.341+0000",
                    "updated": "2019-04-08T14:54:36.341+0000",
                    "started": "2019-04-08T14:54:36.341+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "224378",
                    "issueId": "13224361"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13224361/worklog/224380",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "paddyhoran commented on issue #4120: ARROW-5038: [Rust] [DataFusion] Implement AVG aggregate function\nURL: https://github.com/apache/arrow/pull/4120#issuecomment-480866982\n \n \n   LGTM thanks @zhzy0077.\n \n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2019-04-08T14:55:37.191+0000",
                    "updated": "2019-04-08T14:55:37.191+0000",
                    "started": "2019-04-08T14:55:37.190+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "224380",
                    "issueId": "13224361"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13224361/worklog/224470",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "paddyhoran commented on pull request #4120: ARROW-5038: [Rust] [DataFusion] Implement AVG aggregate function\nURL: https://github.com/apache/arrow/pull/4120#discussion_r273143104\n \n \n\n ##########\n File path: rust/datafusion/src/execution/aggregate.rs\n ##########\n @@ -347,6 +346,73 @@ impl AggregateFunction for SumFunction {\n     }\n }\n \n+/// Implementation of AVG aggregate function\n+#[derive(Debug)]\n+struct AvgFunction {\n+    data_type: DataType,\n+    sum_value: SumFunction,\n+    count_value: CountFunction,\n+}\n+\n+impl AvgFunction {\n+    fn new(data_type: &DataType) -> Self {\n+        Self {\n+            data_type: DataType::Float64,\n+            sum_value: SumFunction::new(data_type),\n+            count_value: CountFunction::new(),\n+        }\n+    }\n+}\n+\n+impl AggregateFunction for AvgFunction {\n+    fn name(&self) -> &str {\n+        \"avg\"\n+    }\n+\n+    fn accumulate_scalar(&mut self, value: &Option<ScalarValue>) -> Result<()> {\n+        self.sum_value.accumulate_scalar(value)?;\n+        self.count_value.accumulate_scalar(value)?;\n+\n+        Ok(())\n+    }\n+\n+    fn accumulate_batch(&mut self, array: ArrayRef) -> Result<()> {\n+        self.sum_value.accumulate_batch(array.clone())?;\n+        self.count_value.accumulate_batch(array)?;\n+\n+        Ok(())\n+    }\n+\n+    fn result(&self) -> Option<ScalarValue> {\n+        let sum = match self.sum_value.result() {\n+            Some(ScalarValue::UInt8(a)) => a as f64,\n+            Some(ScalarValue::UInt16(a)) => a as f64,\n+            Some(ScalarValue::UInt32(a)) => a as f64,\n+            Some(ScalarValue::UInt64(a)) => a as f64,\n+            Some(ScalarValue::Int8(a)) => a as f64,\n+            Some(ScalarValue::Int16(a)) => a as f64,\n+            Some(ScalarValue::Int32(a)) => a as f64,\n+            Some(ScalarValue::Int64(a)) => a as f64,\n+            Some(ScalarValue::Float32(a)) => a as f64,\n+            Some(ScalarValue::Float64(a)) => a as f64,\n+            _ => {\n+                return None;\n+            }\n+        };\n+        let count = match self.count_value.result() {\n+            Some(ScalarValue::UInt64(a)) => a as f64,\n+            _ => {\n \n Review comment:\n   Yea, I was going to say just panic, but I'm not sure that's the best either....  Let's see what Andy thinks.  In any case, this can be addressed (if at all) in a follow up PR.\n \n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2019-04-08T16:52:15.647+0000",
                    "updated": "2019-04-08T16:52:15.647+0000",
                    "started": "2019-04-08T16:52:15.646+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "224470",
                    "issueId": "13224361"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13224361/worklog/225471",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "kszucs commented on pull request #4120: ARROW-5038: [Rust] [DataFusion] Implement AVG aggregate function\nURL: https://github.com/apache/arrow/pull/4120\n \n \n   \n \n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2019-04-10T10:14:49.430+0000",
                    "updated": "2019-04-10T10:14:49.430+0000",
                    "started": "2019-04-10T10:14:49.430+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "225471",
                    "issueId": "13224361"
                }
            ]
        },
        "customfield_12313920": null,
        "issuetype": {
            "self": "https://issues.apache.org/jira/rest/api/2/issuetype/4",
            "id": "4",
            "description": "An improvement or enhancement to an existing feature or task.",
            "iconUrl": "https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21140&avatarType=issuetype",
            "name": "Improvement",
            "subtask": false,
            "avatarId": 21140
        },
        "timespent": 9000,
        "customfield_12314020": "{summaryBean=com.atlassian.jira.plugin.devstatus.rest.SummaryBean@2a62fb97[summary={pullrequest=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@4f263d90[overall=PullRequestOverallBean{stateCount=0, state='OPEN', details=PullRequestOverallDetails{openCount=0, mergedCount=0, declinedCount=0}},byInstanceType={}], build=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@6a9d712[overall=com.atlassian.jira.plugin.devstatus.summary.beans.BuildOverallBean@789db0ea[failedBuildCount=0,successfulBuildCount=0,unknownBuildCount=0,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], review=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@594182df[overall=com.atlassian.jira.plugin.devstatus.summary.beans.ReviewsOverallBean@336c6b71[stateCount=0,state=<null>,dueDate=<null>,overDue=false,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], deployment-environment=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@7bb52b49[overall=com.atlassian.jira.plugin.devstatus.summary.beans.DeploymentOverallBean@6e3ade35[topEnvironments=[],showProjects=false,successfulCount=0,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], repository=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@3b38ee57[overall=com.atlassian.jira.plugin.devstatus.summary.beans.CommitOverallBean@6bdf2da2[count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], branch=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@39e2acf3[overall=com.atlassian.jira.plugin.devstatus.summary.beans.BranchOverallBean@111068c[count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}]},errors=[],configErrors=[]], devSummaryJson={\"cachedValue\":{\"errors\":[],\"configErrors\":[],\"summary\":{\"pullrequest\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"stateCount\":0,\"state\":\"OPEN\",\"details\":{\"openCount\":0,\"mergedCount\":0,\"declinedCount\":0,\"total\":0},\"open\":true},\"byInstanceType\":{}},\"build\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"failedBuildCount\":0,\"successfulBuildCount\":0,\"unknownBuildCount\":0},\"byInstanceType\":{}},\"review\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"stateCount\":0,\"state\":null,\"dueDate\":null,\"overDue\":false,\"completed\":false},\"byInstanceType\":{}},\"deployment-environment\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"topEnvironments\":[],\"showProjects\":false,\"successfulCount\":0},\"byInstanceType\":{}},\"repository\":{\"overall\":{\"count\":0,\"lastUpdated\":null},\"byInstanceType\":{}},\"branch\":{\"overall\":{\"count\":0,\"lastUpdated\":null},\"byInstanceType\":{}}}},\"isStale\":false}}",
        "customfield_12314141": null,
        "customfield_12314140": null,
        "project": {
            "self": "https://issues.apache.org/jira/rest/api/2/project/12319525",
            "id": "12319525",
            "key": "ARROW",
            "name": "Apache Arrow",
            "projectTypeKey": "software",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/projectavatar?pid=12319525&avatarId=10011",
                "24x24": "https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12319525&avatarId=10011",
                "16x16": "https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12319525&avatarId=10011",
                "32x32": "https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12319525&avatarId=10011"
            },
            "projectCategory": {
                "self": "https://issues.apache.org/jira/rest/api/2/projectCategory/13960",
                "id": "13960",
                "description": "Apache Arrow",
                "name": "Arrow"
            }
        },
        "aggregatetimespent": 9000,
        "customfield_12312520": null,
        "customfield_12312521": "Wed Apr 10 10:14:46 UTC 2019",
        "customfield_12314422": null,
        "customfield_12314421": null,
        "customfield_12314146": null,
        "customfield_12314420": null,
        "customfield_12314145": null,
        "customfield_12314144": null,
        "customfield_12314143": null,
        "resolutiondate": "2019-04-10T10:14:46.000+0000",
        "workratio": -1,
        "customfield_12312923": null,
        "customfield_12312920": null,
        "customfield_12312921": null,
        "watches": {
            "self": "https://issues.apache.org/jira/rest/api/2/issue/ARROW-5038/watchers",
            "watchCount": 1,
            "isWatching": false
        },
        "created": "2019-03-27T16:33:46.000+0000",
        "updated": "2019-04-10T10:17:46.000+0000",
        "timeoriginalestimate": null,
        "description": "Implement AVG aggregate function, based on the existing COUNT and SUM functions.\r\n\r\n\u00a0\r\n\r\n\u00a0",
        "customfield_10010": null,
        "timetracking": {
            "remainingEstimate": "0h",
            "timeSpent": "2.5h",
            "remainingEstimateSeconds": 0,
            "timeSpentSeconds": 9000
        },
        "customfield_12314523": null,
        "customfield_12314127": null,
        "customfield_12314522": null,
        "customfield_12314126": null,
        "customfield_12314521": null,
        "customfield_12314125": null,
        "customfield_12314520": null,
        "customfield_12314124": null,
        "attachment": [],
        "customfield_12312340": null,
        "customfield_12314123": null,
        "customfield_12312341": null,
        "customfield_12312220": null,
        "customfield_12314122": null,
        "customfield_12314121": null,
        "customfield_12314120": null,
        "customfield_12314129": null,
        "customfield_12314524": null,
        "customfield_12314128": null,
        "summary": "[Rust] [DataFusion] Implement AVG aggregate function",
        "customfield_12314130": null,
        "customfield_12310291": null,
        "customfield_12310290": null,
        "customfield_12314138": null,
        "customfield_12314137": null,
        "environment": null,
        "customfield_12314136": null,
        "customfield_12314135": null,
        "customfield_12311020": null,
        "customfield_12314134": null,
        "duedate": null,
        "customfield_12314132": null,
        "customfield_12314131": null,
        "comment": {
            "comments": [
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13224361/comment/16814293",
                    "id": "16814293",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=kszucs",
                        "name": "kszucs",
                        "key": "kszucs",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "Krisztian Szucs",
                        "active": true,
                        "timeZone": "Europe/Budapest"
                    },
                    "body": "Issue resolved by pull request 4120\n[https://github.com/apache/arrow/pull/4120]",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=kszucs",
                        "name": "kszucs",
                        "key": "kszucs",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "Krisztian Szucs",
                        "active": true,
                        "timeZone": "Europe/Budapest"
                    },
                    "created": "2019-04-10T10:14:46.322+0000",
                    "updated": "2019-04-10T10:14:46.322+0000"
                }
            ],
            "maxResults": 1,
            "total": 1,
            "startAt": 0
        },
        "customfield_12311820": "0|z01608:",
        "customfield_12314139": null
    }
}