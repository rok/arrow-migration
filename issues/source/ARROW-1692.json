{
    "expand": "operations,versionedRepresentations,editmeta,changelog,renderedFields",
    "id": "13110864",
    "self": "https://issues.apache.org/jira/rest/api/2/issue/13110864",
    "key": "ARROW-1692",
    "fields": {
        "fixVersions": [
            {
                "self": "https://issues.apache.org/jira/rest/api/2/version/12347769",
                "id": "12347769",
                "description": "",
                "name": "1.0.0",
                "archived": false,
                "released": true,
                "releaseDate": "2020-07-24"
            }
        ],
        "resolution": {
            "self": "https://issues.apache.org/jira/rest/api/2/resolution/1",
            "id": "1",
            "description": "A fix for this issue is checked into the tree and tested.",
            "name": "Fixed"
        },
        "customfield_12312322": null,
        "customfield_12312323": null,
        "customfield_12312320": null,
        "customfield_12310420": "9223372036854775807",
        "customfield_12312321": null,
        "customfield_12312328": null,
        "customfield_12312329": null,
        "customfield_12312326": null,
        "customfield_12310300": null,
        "customfield_12312327": null,
        "customfield_12312324": null,
        "customfield_12312720": null,
        "customfield_12312325": null,
        "lastViewed": null,
        "priority": {
            "self": "https://issues.apache.org/jira/rest/api/2/priority/1",
            "iconUrl": "https://issues.apache.org/jira/images/icons/priorities/blocker.svg",
            "name": "Blocker",
            "id": "1"
        },
        "labels": [
            "columnar-format-1.0",
            "pull-request-available"
        ],
        "customfield_12312333": null,
        "customfield_12312334": null,
        "customfield_12313422": "false",
        "customfield_12310310": "1.0",
        "customfield_12312331": null,
        "customfield_12312332": null,
        "aggregatetimeoriginalestimate": null,
        "timeestimate": 0,
        "customfield_12312330": null,
        "versions": [],
        "customfield_12311120": null,
        "customfield_12313826": null,
        "customfield_12312339": null,
        "issuelinks": [
            {
                "id": "12556447",
                "self": "https://issues.apache.org/jira/rest/api/2/issueLink/12556447",
                "type": {
                    "id": "10032",
                    "name": "Blocker",
                    "inward": "is blocked by",
                    "outward": "blocks",
                    "self": "https://issues.apache.org/jira/rest/api/2/issueLinkType/10032"
                },
                "inwardIssue": {
                    "id": "13047147",
                    "key": "ARROW-590",
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13047147",
                    "fields": {
                        "summary": "[Integration] Add integration tests for Union types",
                        "status": {
                            "self": "https://issues.apache.org/jira/rest/api/2/status/5",
                            "description": "A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.",
                            "iconUrl": "https://issues.apache.org/jira/images/icons/statuses/resolved.png",
                            "name": "Resolved",
                            "id": "5",
                            "statusCategory": {
                                "self": "https://issues.apache.org/jira/rest/api/2/statuscategory/3",
                                "id": 3,
                                "key": "done",
                                "colorName": "green",
                                "name": "Done"
                            }
                        },
                        "priority": {
                            "self": "https://issues.apache.org/jira/rest/api/2/priority/1",
                            "iconUrl": "https://issues.apache.org/jira/images/icons/priorities/blocker.svg",
                            "name": "Blocker",
                            "id": "1"
                        },
                        "issuetype": {
                            "self": "https://issues.apache.org/jira/rest/api/2/issuetype/2",
                            "id": "2",
                            "description": "A new feature of the product, which has yet to be developed.",
                            "iconUrl": "https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21141&avatarType=issuetype",
                            "name": "New Feature",
                            "subtask": false,
                            "avatarId": 21141
                        }
                    }
                }
            },
            {
                "id": "12593300",
                "self": "https://issues.apache.org/jira/rest/api/2/issueLink/12593300",
                "type": {
                    "id": "12310000",
                    "name": "Duplicate",
                    "inward": "is duplicated by",
                    "outward": "duplicates",
                    "self": "https://issues.apache.org/jira/rest/api/2/issueLinkType/12310000"
                },
                "inwardIssue": {
                    "id": "13314347",
                    "key": "ARROW-9284",
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13314347",
                    "fields": {
                        "summary": "[Java] getMinorTypeForArrowType returns sparse minor type for dense union types",
                        "status": {
                            "self": "https://issues.apache.org/jira/rest/api/2/status/6",
                            "description": "The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.",
                            "iconUrl": "https://issues.apache.org/jira/images/icons/statuses/closed.png",
                            "name": "Closed",
                            "id": "6",
                            "statusCategory": {
                                "self": "https://issues.apache.org/jira/rest/api/2/statuscategory/3",
                                "id": 3,
                                "key": "done",
                                "colorName": "green",
                                "name": "Done"
                            }
                        },
                        "priority": {
                            "self": "https://issues.apache.org/jira/rest/api/2/priority/3",
                            "iconUrl": "https://issues.apache.org/jira/images/icons/priorities/major.svg",
                            "name": "Major",
                            "id": "3"
                        },
                        "issuetype": {
                            "self": "https://issues.apache.org/jira/rest/api/2/issuetype/1",
                            "id": "1",
                            "description": "A problem which impairs or prevents the functions of the product.",
                            "iconUrl": "https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype",
                            "name": "Bug",
                            "subtask": false,
                            "avatarId": 21133
                        }
                    }
                }
            }
        ],
        "customfield_12313825": null,
        "assignee": {
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=rymurr",
            "name": "rymurr",
            "key": "rymurr",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
            },
            "displayName": "Ryan Murray",
            "active": true,
            "timeZone": "Etc/UTC"
        },
        "customfield_12312337": null,
        "customfield_12313823": null,
        "customfield_12312338": null,
        "customfield_12311920": null,
        "customfield_12313822": null,
        "customfield_12312335": null,
        "customfield_12313821": null,
        "customfield_12312336": null,
        "customfield_12313820": null,
        "status": {
            "self": "https://issues.apache.org/jira/rest/api/2/status/5",
            "description": "A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.",
            "iconUrl": "https://issues.apache.org/jira/images/icons/statuses/resolved.png",
            "name": "Resolved",
            "id": "5",
            "statusCategory": {
                "self": "https://issues.apache.org/jira/rest/api/2/statuscategory/3",
                "id": 3,
                "key": "done",
                "colorName": "green",
                "name": "Done"
            }
        },
        "components": [
            {
                "self": "https://issues.apache.org/jira/rest/api/2/component/12333774",
                "id": "12333774",
                "name": "Integration",
                "description": "Issues related to integration / compatibility tests between implementations"
            },
            {
                "self": "https://issues.apache.org/jira/rest/api/2/component/12328933",
                "id": "12328933",
                "name": "Java"
            },
            {
                "self": "https://issues.apache.org/jira/rest/api/2/component/12328936",
                "id": "12328936",
                "name": "Python"
            }
        ],
        "customfield_12312026": null,
        "customfield_12312023": null,
        "customfield_12312024": null,
        "aggregatetimeestimate": 0,
        "customfield_12312022": null,
        "customfield_12310921": null,
        "customfield_12310920": "9223372036854775807",
        "customfield_12312823": null,
        "creator": {
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=pcmoritz",
            "name": "pcmoritz",
            "key": "pcmoritz",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
            },
            "displayName": "Philipp Moritz",
            "active": true,
            "timeZone": "Etc/UTC"
        },
        "subtasks": [],
        "reporter": {
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=pcmoritz",
            "name": "pcmoritz",
            "key": "pcmoritz",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
            },
            "displayName": "Philipp Moritz",
            "active": true,
            "timeZone": "Etc/UTC"
        },
        "aggregateprogress": {
            "progress": 31200,
            "total": 31200,
            "percent": 100
        },
        "customfield_12313520": null,
        "customfield_12310250": null,
        "progress": {
            "progress": 31200,
            "total": 31200,
            "percent": 100
        },
        "customfield_12313924": null,
        "votes": {
            "self": "https://issues.apache.org/jira/rest/api/2/issue/ARROW-1692/votes",
            "votes": 1,
            "hasVoted": false
        },
        "worklog": {
            "startAt": 0,
            "maxResults": 20,
            "total": 52,
            "worklogs": [
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13110864/worklog/437777",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "rymurr opened a new pull request #7290:\nURL: https://github.com/apache/arrow/pull/7290\n\n\n   This fixes the integration tests for Union Arrays.\r\n   \r\n   Both Dense and Sparse unions now work:\r\n   \r\n   * validity buffer added to Sparse Union\r\n   * both Union types now track logical types rather than MinorType enum ordinal\r\n   \r\n   Dependent on #7289 for duplicate field names.\n\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2020-05-27T13:12:23.729+0000",
                    "updated": "2020-05-27T13:12:23.729+0000",
                    "started": "2020-05-27T13:12:23.729+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "437777",
                    "issueId": "13110864"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13110864/worklog/437780",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "github-actions[bot] commented on pull request #7290:\nURL: https://github.com/apache/arrow/pull/7290#issuecomment-634652668\n\n\n   https://issues.apache.org/jira/browse/ARROW-1692\n\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2020-05-27T13:16:44.271+0000",
                    "updated": "2020-05-27T13:16:44.271+0000",
                    "started": "2020-05-27T13:16:44.271+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "437780",
                    "issueId": "13110864"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13110864/worklog/444255",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "lidavidm commented on pull request #7290:\nURL: https://github.com/apache/arrow/pull/7290#issuecomment-642630745\n\n\n   It looks like the integration tests are still failing for union arrays between C++ and Java.\n\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2020-06-11T12:59:06.449+0000",
                    "updated": "2020-06-11T12:59:06.449+0000",
                    "started": "2020-06-11T12:59:06.449+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "444255",
                    "issueId": "13110864"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13110864/worklog/444264",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "rymurr commented on pull request #7290:\nURL: https://github.com/apache/arrow/pull/7290#issuecomment-642647124\n\n\n   > It looks like the integration tests are still failing for union arrays between C++ and Java.\r\n   \r\n   yeah, something w/ Flight, though the IPC works fine. Checking what is different in flight now...\n\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2020-06-11T13:26:58.778+0000",
                    "updated": "2020-06-11T13:26:58.778+0000",
                    "started": "2020-06-11T13:26:58.778+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "444264",
                    "issueId": "13110864"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13110864/worklog/444793",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "liyafan82 commented on a change in pull request #7290:\nURL: https://github.com/apache/arrow/pull/7290#discussion_r439325184\n\n\n\n##########\nFile path: java/vector/src/main/codegen/templates/DenseUnionVector.java\n##########\n@@ -104,6 +105,7 @@\n    * The index is the type id, and the value is the type field.\n    */\n   private Field[] typeFields = new Field[Byte.MAX_VALUE + 1];\n+  private byte[] typeMapFields = new byte[Byte.MAX_VALUE + 1];\n\nReview comment:\n       Could you please write some comments about the indices & values of the array?\n\n\n\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2020-06-12T09:58:42.201+0000",
                    "updated": "2020-06-12T09:58:42.201+0000",
                    "started": "2020-06-12T09:58:42.200+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "444793",
                    "issueId": "13110864"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13110864/worklog/444797",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "liyafan82 commented on a change in pull request #7290:\nURL: https://github.com/apache/arrow/pull/7290#discussion_r439334686\n\n\n\n##########\nFile path: java/vector/src/main/codegen/templates/UnionVector.java\n##########\n@@ -325,12 +361,45 @@ private void allocateTypeBuffer() {\n     typeBuffer.setZero(0, typeBuffer.capacity());\n   }\n \n+  private void allocateValidityBuffer() {\n+    validityBuffer = allocator.buffer(validityBufferAllocationSizeInBytes);\n+    validityBuffer.readerIndex(0);\n+    validityBuffer.setZero(0, validityBuffer.capacity());\n+  }\n+\n   @Override\n   public void reAlloc() {\n     internalStruct.reAlloc();\n+    reallocValidityBuffer();\n     reallocTypeBuffer();\n   }\n \n+  private void reallocValidityBuffer() {\n+    final long currentBufferCapacity = validityBuffer.capacity();\n+    long newAllocationSize = currentBufferCapacity * 2;\n+    if (newAllocationSize == 0) {\n+      if (validityBufferAllocationSizeInBytes > 0) {\n+        newAllocationSize = validityBufferAllocationSizeInBytes;\n+      } else {\n+        newAllocationSize = DataSizeRoundingUtil.divideBy8Ceil(BaseValueVector.INITIAL_VALUE_ALLOCATION) * 2;\n+      }\n\nReview comment:\n       do we need to multiply by 2 here?\n\n\n\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2020-06-12T10:20:28.349+0000",
                    "updated": "2020-06-12T10:20:28.349+0000",
                    "started": "2020-06-12T10:20:28.349+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "444797",
                    "issueId": "13110864"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13110864/worklog/444798",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "liyafan82 commented on a change in pull request #7290:\nURL: https://github.com/apache/arrow/pull/7290#discussion_r439335068\n\n\n\n##########\nFile path: java/vector/src/main/codegen/templates/UnionVector.java\n##########\n@@ -325,12 +361,45 @@ private void allocateTypeBuffer() {\n     typeBuffer.setZero(0, typeBuffer.capacity());\n   }\n \n+  private void allocateValidityBuffer() {\n+    validityBuffer = allocator.buffer(validityBufferAllocationSizeInBytes);\n+    validityBuffer.readerIndex(0);\n+    validityBuffer.setZero(0, validityBuffer.capacity());\n+  }\n+\n   @Override\n   public void reAlloc() {\n     internalStruct.reAlloc();\n+    reallocValidityBuffer();\n     reallocTypeBuffer();\n   }\n \n+  private void reallocValidityBuffer() {\n+    final long currentBufferCapacity = validityBuffer.capacity();\n+    long newAllocationSize = currentBufferCapacity * 2;\n+    if (newAllocationSize == 0) {\n+      if (validityBufferAllocationSizeInBytes > 0) {\n+        newAllocationSize = validityBufferAllocationSizeInBytes;\n+      } else {\n+        newAllocationSize = DataSizeRoundingUtil.divideBy8Ceil(BaseValueVector.INITIAL_VALUE_ALLOCATION) * 2;\n+      }\n+    }\n+\n+    newAllocationSize = CommonUtil.nextPowerOfTwo(newAllocationSize);\n+    assert newAllocationSize >= 1;\n+\n+    if (newAllocationSize > BaseValueVector.MAX_ALLOCATION_SIZE) {\n+      throw new OversizedAllocationException(\"Unable to expand the buffer\");\n+    }\n+\n+    final ArrowBuf newBuf = allocator.buffer((int)newAllocationSize);\n+    newBuf.setBytes(0, validityBuffer, 0, currentBufferCapacity);\n+    newBuf.setZero(currentBufferCapacity, newBuf.capacity() - currentBufferCapacity);\n+    validityBuffer.getReferenceManager().release(1);\n+    validityBuffer = newBuf;\n+    validityBufferAllocationSizeInBytes = (int)newAllocationSize;\n\nReview comment:\n       there should be a space after the cast, or the style check would fail?\n\n\n\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2020-06-12T10:21:11.800+0000",
                    "updated": "2020-06-12T10:21:11.800+0000",
                    "started": "2020-06-12T10:21:11.800+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "444798",
                    "issueId": "13110864"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13110864/worklog/444802",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "liyafan82 commented on a change in pull request #7290:\nURL: https://github.com/apache/arrow/pull/7290#discussion_r439336805\n\n\n\n##########\nFile path: java/vector/src/main/codegen/templates/UnionVector.java\n##########\n@@ -493,6 +576,19 @@ public void splitAndTransfer(int startIndex, int length) {\n       Preconditions.checkArgument(startIndex >= 0 && length >= 0 && startIndex + length <= valueCount,\n           \"Invalid parameters startIndex: %s, length: %s for valueCount: %s\", startIndex, length, valueCount);\n       to.clear();\n+      // transfer validity buffer\n+      while (to.getValidityBufferValueCapacity() < length) {\n+        to.reallocValidityBuffer();\n+      }\n+      for (int i = 0; i < length; i++) {\n+        int validity = BitVectorHelper.get(validityBuffer, startIndex + i);\n+        if (validity == 0) {\n+          BitVectorHelper.unsetBit(to.validityBuffer, i);\n+        } else {\n+          BitVectorHelper.setBit(to.validityBuffer, i);\n+        }\n\nReview comment:\n       Maybe we can use \r\n   ```\r\n   setValidityBit(ArrowBuf validityBuffer, int index, int value)\r\n   ```\r\n   here to make the code more concise?\n\n\n\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2020-06-12T10:25:20.585+0000",
                    "updated": "2020-06-12T10:25:20.585+0000",
                    "started": "2020-06-12T10:25:20.585+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "444802",
                    "issueId": "13110864"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13110864/worklog/444805",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "liyafan82 commented on a change in pull request #7290:\nURL: https://github.com/apache/arrow/pull/7290#discussion_r439338218\n\n\n\n##########\nFile path: java/vector/src/main/codegen/templates/UnionVector.java\n##########\n@@ -586,7 +686,9 @@ public ValueVector getVectorByType(int typeId) {\n   }\n \n     public ValueVector getVectorByType(int typeId, ArrowType arrowType) {\n-      switch (MinorType.values()[typeId]) {\n+      Types.MinorType type = (typeIds[typeId] != null) ?\n+          Types.getMinorTypeForArrowType(typeIds[typeId].getType()) : Types.MinorType.values()[typeId];\n+      switch (type) {\n\nReview comment:\n       Here we are still relying on the MinorType ordinal as the type ID?\r\n   If so, the sparse union vector is still not aligning with the specification, and that causes the integration test to fail?\n\n\n\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2020-06-12T10:28:45.643+0000",
                    "updated": "2020-06-12T10:28:45.643+0000",
                    "started": "2020-06-12T10:28:45.643+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "444805",
                    "issueId": "13110864"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13110864/worklog/444806",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "liyafan82 commented on a change in pull request #7290:\nURL: https://github.com/apache/arrow/pull/7290#discussion_r439336805\n\n\n\n##########\nFile path: java/vector/src/main/codegen/templates/UnionVector.java\n##########\n@@ -493,6 +576,19 @@ public void splitAndTransfer(int startIndex, int length) {\n       Preconditions.checkArgument(startIndex >= 0 && length >= 0 && startIndex + length <= valueCount,\n           \"Invalid parameters startIndex: %s, length: %s for valueCount: %s\", startIndex, length, valueCount);\n       to.clear();\n+      // transfer validity buffer\n+      while (to.getValidityBufferValueCapacity() < length) {\n+        to.reallocValidityBuffer();\n+      }\n+      for (int i = 0; i < length; i++) {\n+        int validity = BitVectorHelper.get(validityBuffer, startIndex + i);\n+        if (validity == 0) {\n+          BitVectorHelper.unsetBit(to.validityBuffer, i);\n+        } else {\n+          BitVectorHelper.setBit(to.validityBuffer, i);\n+        }\n\nReview comment:\n       nit: Maybe we can use \r\n   ```\r\n   setValidityBit(ArrowBuf validityBuffer, int index, int value)\r\n   ```\r\n   here to make the code more concise?\n\n\n\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2020-06-12T10:29:21.044+0000",
                    "updated": "2020-06-12T10:29:21.044+0000",
                    "started": "2020-06-12T10:29:21.044+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "444806",
                    "issueId": "13110864"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13110864/worklog/444944",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "emkornfield commented on pull request #7290:\nURL: https://github.com/apache/arrow/pull/7290#issuecomment-643320990\n\n\n   @jacques-n I think you had some concerns the last time sparse unions were made.  Do these changes raise the same issues?\n\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2020-06-12T15:02:57.957+0000",
                    "updated": "2020-06-12T15:02:57.957+0000",
                    "started": "2020-06-12T15:02:57.957+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "444944",
                    "issueId": "13110864"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13110864/worklog/446807",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "rymurr commented on a change in pull request #7290:\nURL: https://github.com/apache/arrow/pull/7290#discussion_r441045982\n\n\n\n##########\nFile path: java/vector/src/main/codegen/templates/DenseUnionVector.java\n##########\n@@ -104,6 +105,7 @@\n    * The index is the type id, and the value is the type field.\n    */\n   private Field[] typeFields = new Field[Byte.MAX_VALUE + 1];\n+  private byte[] typeMapFields = new byte[Byte.MAX_VALUE + 1];\n\nReview comment:\n       done\n\n\n\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2020-06-16T18:10:36.839+0000",
                    "updated": "2020-06-16T18:10:36.839+0000",
                    "started": "2020-06-16T18:10:36.839+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "446807",
                    "issueId": "13110864"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13110864/worklog/446809",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "rymurr commented on a change in pull request #7290:\nURL: https://github.com/apache/arrow/pull/7290#discussion_r441047163\n\n\n\n##########\nFile path: java/vector/src/main/codegen/templates/UnionVector.java\n##########\n@@ -493,6 +576,19 @@ public void splitAndTransfer(int startIndex, int length) {\n       Preconditions.checkArgument(startIndex >= 0 && length >= 0 && startIndex + length <= valueCount,\n           \"Invalid parameters startIndex: %s, length: %s for valueCount: %s\", startIndex, length, valueCount);\n       to.clear();\n+      // transfer validity buffer\n+      while (to.getValidityBufferValueCapacity() < length) {\n+        to.reallocValidityBuffer();\n+      }\n+      for (int i = 0; i < length; i++) {\n+        int validity = BitVectorHelper.get(validityBuffer, startIndex + i);\n+        if (validity == 0) {\n+          BitVectorHelper.unsetBit(to.validityBuffer, i);\n+        } else {\n+          BitVectorHelper.setBit(to.validityBuffer, i);\n+        }\n\nReview comment:\n       done\n\n\n\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2020-06-16T18:12:36.734+0000",
                    "updated": "2020-06-16T18:12:36.734+0000",
                    "started": "2020-06-16T18:12:36.734+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "446809",
                    "issueId": "13110864"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13110864/worklog/446811",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "rymurr commented on a change in pull request #7290:\nURL: https://github.com/apache/arrow/pull/7290#discussion_r441050322\n\n\n\n##########\nFile path: java/vector/src/main/codegen/templates/UnionVector.java\n##########\n@@ -586,7 +686,9 @@ public ValueVector getVectorByType(int typeId) {\n   }\n \n     public ValueVector getVectorByType(int typeId, ArrowType arrowType) {\n-      switch (MinorType.values()[typeId]) {\n+      Types.MinorType type = (typeIds[typeId] != null) ?\n+          Types.getMinorTypeForArrowType(typeIds[typeId].getType()) : Types.MinorType.values()[typeId];\n+      switch (type) {\n\nReview comment:\n       This switch uses the `typeIds` array to extract the MinorType associated with the logical type. If it does not exist in the array (usually because a logical type wasn't previously assigned) it defaults to the id of the minor type. So Java always uses the MinorType as the type id and allows c++ (and others) to send arbitrary type mappings.\n\n\n\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2020-06-16T18:17:44.694+0000",
                    "updated": "2020-06-16T18:17:44.694+0000",
                    "started": "2020-06-16T18:17:44.694+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "446811",
                    "issueId": "13110864"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13110864/worklog/446813",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "rymurr commented on a change in pull request #7290:\nURL: https://github.com/apache/arrow/pull/7290#discussion_r441052320\n\n\n\n##########\nFile path: java/vector/src/main/codegen/templates/UnionVector.java\n##########\n@@ -325,12 +361,45 @@ private void allocateTypeBuffer() {\n     typeBuffer.setZero(0, typeBuffer.capacity());\n   }\n \n+  private void allocateValidityBuffer() {\n+    validityBuffer = allocator.buffer(validityBufferAllocationSizeInBytes);\n+    validityBuffer.readerIndex(0);\n+    validityBuffer.setZero(0, validityBuffer.capacity());\n+  }\n+\n   @Override\n   public void reAlloc() {\n     internalStruct.reAlloc();\n+    reallocValidityBuffer();\n     reallocTypeBuffer();\n   }\n \n+  private void reallocValidityBuffer() {\n+    final long currentBufferCapacity = validityBuffer.capacity();\n+    long newAllocationSize = currentBufferCapacity * 2;\n+    if (newAllocationSize == 0) {\n+      if (validityBufferAllocationSizeInBytes > 0) {\n+        newAllocationSize = validityBufferAllocationSizeInBytes;\n+      } else {\n+        newAllocationSize = DataSizeRoundingUtil.divideBy8Ceil(BaseValueVector.INITIAL_VALUE_ALLOCATION) * 2;\n+      }\n\nReview comment:\n       removed. Probably a copy/paste error\n\n\n\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2020-06-16T18:19:53.222+0000",
                    "updated": "2020-06-16T18:19:53.222+0000",
                    "started": "2020-06-16T18:19:53.222+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "446813",
                    "issueId": "13110864"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13110864/worklog/449340",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "nealrichardson commented on pull request #7290:\nURL: https://github.com/apache/arrow/pull/7290#issuecomment-647589883\n\n\n   Assuming CI is still passing, is this good to merge? What is left to do, or who needs to approve?\n\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2020-06-22T15:26:53.524+0000",
                    "updated": "2020-06-22T15:26:53.524+0000",
                    "started": "2020-06-22T15:26:53.524+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "449340",
                    "issueId": "13110864"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13110864/worklog/449632",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "emkornfield commented on pull request #7290:\nURL: https://github.com/apache/arrow/pull/7290#issuecomment-647903916\n\n\n   It would be great if @jacques-n could confirm he is OK with these changes.  I believe on a previous PR the extra indirection was a concern.\n\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2020-06-23T04:43:51.942+0000",
                    "updated": "2020-06-23T04:43:51.942+0000",
                    "started": "2020-06-23T04:43:51.942+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "449632",
                    "issueId": "13110864"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13110864/worklog/450018",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "jacques-n commented on pull request #7290:\nURL: https://github.com/apache/arrow/pull/7290#issuecomment-648427018\n\n\n   I'm really struggling with these changes. I don't understand why there is a validity buffer at the union level as well as at the cell level. I'm not sure what it even means that a a union value is valid but the inner value is not. I think there was an inconsistent understanding on my part when that change was proposed in the spec over what the Java implementation was doing. @wesm why would we have validity at both the top level and the inner level? Or is the C++ impl only at the top level and not the inner level (which means that this java code is incorrect since the inner vectors have their own validity vectors.\n\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2020-06-23T21:08:58.624+0000",
                    "updated": "2020-06-23T21:08:58.624+0000",
                    "started": "2020-06-23T21:08:58.624+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "450018",
                    "issueId": "13110864"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13110864/worklog/450019",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "jacques-n edited a comment on pull request #7290:\nURL: https://github.com/apache/arrow/pull/7290#issuecomment-648427018\n\n\n   I'm really struggling with these changes. I don't understand why there is a validity buffer at the union level as well as at the cell level. I'm not sure what it even means that a a union value is valid but the inner value is not. I think there was an inconsistent understanding on my part when that change was proposed in the format (versus what the Java implementation was already doing). @wesm why would we have validity at both the top level and the inner level? Or is the C++ impl only at the top level and not the inner level (which means that this java code is incorrect since the inner vectors have their own validity vectors.\n\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2020-06-23T21:09:21.783+0000",
                    "updated": "2020-06-23T21:09:21.783+0000",
                    "started": "2020-06-23T21:09:21.783+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "450019",
                    "issueId": "13110864"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13110864/worklog/450020",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "jacques-n commented on pull request #7290:\nURL: https://github.com/apache/arrow/pull/7290#issuecomment-648428724\n\n\n   Adding to my previous comments: if only at the top level, I'm not sure what the ramification of that would mean at the Java codebase. I think it would require a fairly massive refactoring.\n\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2020-06-23T21:10:24.936+0000",
                    "updated": "2020-06-23T21:10:24.936+0000",
                    "started": "2020-06-23T21:10:24.936+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "450020",
                    "issueId": "13110864"
                }
            ]
        },
        "customfield_12313920": null,
        "issuetype": {
            "self": "https://issues.apache.org/jira/rest/api/2/issuetype/1",
            "id": "1",
            "description": "A problem which impairs or prevents the functions of the product.",
            "iconUrl": "https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype",
            "name": "Bug",
            "subtask": false,
            "avatarId": 21133
        },
        "timespent": 31200,
        "customfield_12314020": "{summaryBean=com.atlassian.jira.plugin.devstatus.rest.SummaryBean@6c039bc8[summary={pullrequest=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@5ef2e541[overall=PullRequestOverallBean{stateCount=0, state='OPEN', details=PullRequestOverallDetails{openCount=0, mergedCount=0, declinedCount=0}},byInstanceType={}], build=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@5e0358c[overall=com.atlassian.jira.plugin.devstatus.summary.beans.BuildOverallBean@4cf1009c[failedBuildCount=0,successfulBuildCount=0,unknownBuildCount=0,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], review=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@a7113e3[overall=com.atlassian.jira.plugin.devstatus.summary.beans.ReviewsOverallBean@16c93b16[stateCount=0,state=<null>,dueDate=<null>,overDue=false,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], deployment-environment=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@12812016[overall=com.atlassian.jira.plugin.devstatus.summary.beans.DeploymentOverallBean@5630373a[topEnvironments=[],showProjects=false,successfulCount=0,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], repository=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@545cd814[overall=com.atlassian.jira.plugin.devstatus.summary.beans.CommitOverallBean@b125802[count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], branch=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@108858e6[overall=com.atlassian.jira.plugin.devstatus.summary.beans.BranchOverallBean@47d6242a[count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}]},errors=[],configErrors=[]], devSummaryJson={\"cachedValue\":{\"errors\":[],\"configErrors\":[],\"summary\":{\"pullrequest\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"stateCount\":0,\"state\":\"OPEN\",\"details\":{\"openCount\":0,\"mergedCount\":0,\"declinedCount\":0,\"total\":0},\"open\":true},\"byInstanceType\":{}},\"build\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"failedBuildCount\":0,\"successfulBuildCount\":0,\"unknownBuildCount\":0},\"byInstanceType\":{}},\"review\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"stateCount\":0,\"state\":null,\"dueDate\":null,\"overDue\":false,\"completed\":false},\"byInstanceType\":{}},\"deployment-environment\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"topEnvironments\":[],\"showProjects\":false,\"successfulCount\":0},\"byInstanceType\":{}},\"repository\":{\"overall\":{\"count\":0,\"lastUpdated\":null},\"byInstanceType\":{}},\"branch\":{\"overall\":{\"count\":0,\"lastUpdated\":null},\"byInstanceType\":{}}}},\"isStale\":false}}",
        "customfield_12314141": null,
        "customfield_12314140": null,
        "project": {
            "self": "https://issues.apache.org/jira/rest/api/2/project/12319525",
            "id": "12319525",
            "key": "ARROW",
            "name": "Apache Arrow",
            "projectTypeKey": "software",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/projectavatar?pid=12319525&avatarId=10011",
                "24x24": "https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12319525&avatarId=10011",
                "16x16": "https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12319525&avatarId=10011",
                "32x32": "https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12319525&avatarId=10011"
            },
            "projectCategory": {
                "self": "https://issues.apache.org/jira/rest/api/2/projectCategory/13960",
                "id": "13960",
                "description": "Apache Arrow",
                "name": "Arrow"
            }
        },
        "aggregatetimespent": 31200,
        "customfield_12312520": null,
        "customfield_12312521": "Sat Jul 11 22:48:24 UTC 2020",
        "customfield_12314422": null,
        "customfield_12314421": null,
        "customfield_12314146": null,
        "customfield_12314420": null,
        "customfield_12314145": null,
        "customfield_12314144": null,
        "customfield_12314143": null,
        "resolutiondate": "2020-07-11T22:48:24.000+0000",
        "workratio": -1,
        "customfield_12312923": null,
        "customfield_12312920": null,
        "customfield_12312921": null,
        "watches": {
            "self": "https://issues.apache.org/jira/rest/api/2/issue/ARROW-1692/watchers",
            "watchCount": 5,
            "isWatching": false
        },
        "created": "2017-10-20T03:00:12.000+0000",
        "updated": "2020-07-12T22:02:55.000+0000",
        "timeoriginalestimate": null,
        "description": "I'm currently working on making pyarrow.serialization data available from the Java side, one problem I was running into is that it seems the Java implementation cannot read UnionArrays generated from C++. To make this easily reproducible I created a clean Python implementation for creating UnionArrays: https://github.com/apache/arrow/pull/1216\r\n\r\nThe data is generated with the following script:\r\n\r\n{code}\r\nimport pyarrow as pa\r\n\r\nbinary = pa.array([b'a', b'b', b'c', b'd'], type='binary')\r\nint64 = pa.array([1, 2, 3], type='int64')\r\ntypes = pa.array([0, 1, 0, 0, 1, 1, 0], type='int8')\r\nvalue_offsets = pa.array([0, 0, 2, 1, 1, 2, 3], type='int32')\r\n\r\nresult = pa.UnionArray.from_arrays([binary, int64], types, value_offsets)\r\n\r\nbatch = pa.RecordBatch.from_arrays([result], [\"test\"])\r\n\r\nsink = pa.BufferOutputStream()\r\nwriter = pa.RecordBatchStreamWriter(sink, batch.schema)\r\n\r\nwriter.write_batch(batch)\r\n\r\nsink.close()\r\n\r\nb = sink.get_result()\r\n\r\nwith open(\"union_array.arrow\", \"wb\") as f:\r\n    f.write(b)\r\n\r\n# Sanity check: Read the batch in again\r\n\r\nwith open(\"union_array.arrow\", \"rb\") as f:\r\n    b = f.read()\r\n    reader = pa.RecordBatchStreamReader(pa.BufferReader(b))\r\n\r\nbatch = reader.read_next_batch()\r\n\r\nprint(\"union array is\", batch.column(0))\r\n{code}\r\n\r\nI attached the file generated by that script. Then when I run the following code in Java:\r\n\r\n{code}\r\nRootAllocator allocator = new RootAllocator(1000000000);\r\n\r\nByteArrayInputStream in = new ByteArrayInputStream(Files.readAllBytes(Paths.get(\"union_array.arrow\")));\r\n\r\nArrowStreamReader reader = new ArrowStreamReader(in, allocator);\r\n\r\nreader.loadNextBatch()\r\n{code}\r\n\r\nI get the following error:\r\n\r\n{code}\r\n|  java.lang.IllegalArgumentException thrown: Could not load buffers for field test: Union(Sparse, [22, 5])<0: Binary, 1: Int(64, true)>. error message: can not truncate buffer to a larger size 7: 0\r\n|        at VectorLoader.loadBuffers (VectorLoader.java:83)\r\n|        at VectorLoader.load (VectorLoader.java:62)\r\n|        at ArrowReader$1.visit (ArrowReader.java:125)\r\n|        at ArrowReader$1.visit (ArrowReader.java:111)\r\n|        at ArrowRecordBatch.accepts (ArrowRecordBatch.java:128)\r\n|        at ArrowReader.loadNextBatch (ArrowReader.java:137)\r\n|        at (#7:1)\r\n{code}\r\n\r\nIt seems like Java is not picking up that the UnionArray is Dense instead of Sparse. After changing the default in java/vector/src/main/codegen/templates/UnionVector.java from Sparse to Dense, I get this:\r\n\r\n{code}\r\njshell> reader.getVectorSchemaRoot().getSchema()\r\n$9 ==> Schema<list: Union(Dense, [0])<: Struct<list: List<item: Union(Dense, [0])<: Int(64, true)>>>>>\r\n{code}\r\n\r\nbut then reading doesn't work:\r\n\r\n{code}\r\njshell> reader.loadNextBatch()\r\n|  java.lang.IllegalArgumentException thrown: Could not load buffers for field list: Union(Dense, [1])<: Struct<list: List<$data$: Union(Dense, [5])<: Int(64, true)>>>>. error message: can not truncate buffer to a larger size 1: 0\r\n|        at VectorLoader.loadBuffers (VectorLoader.java:83)\r\n|        at VectorLoader.load (VectorLoader.java:62)\r\n|        at ArrowReader$1.visit (ArrowReader.java:125)\r\n|        at ArrowReader$1.visit (ArrowReader.java:111)\r\n|        at ArrowRecordBatch.accepts (ArrowRecordBatch.java:128)\r\n|        at ArrowReader.loadNextBatch (ArrowReader.java:137)\r\n|        at (#8:1)\r\n{code}\r\n\r\nAny help with this is appreciated!",
        "customfield_10010": null,
        "timetracking": {
            "remainingEstimate": "0h",
            "timeSpent": "8h 40m",
            "remainingEstimateSeconds": 0,
            "timeSpentSeconds": 31200
        },
        "customfield_12314523": null,
        "customfield_12314127": null,
        "customfield_12314522": null,
        "customfield_12314126": null,
        "customfield_12314521": null,
        "customfield_12314125": null,
        "customfield_12314520": null,
        "customfield_12314124": null,
        "attachment": [
            {
                "self": "https://issues.apache.org/jira/rest/api/2/attachment/12893161",
                "id": "12893161",
                "filename": "union_array.arrow",
                "author": {
                    "self": "https://issues.apache.org/jira/rest/api/2/user?username=pcmoritz",
                    "name": "pcmoritz",
                    "key": "pcmoritz",
                    "avatarUrls": {
                        "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                        "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                        "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                        "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                    },
                    "displayName": "Philipp Moritz",
                    "active": true,
                    "timeZone": "Etc/UTC"
                },
                "created": "2017-10-20T01:39:50.532+0000",
                "size": 816,
                "mimeType": "application/octet-stream",
                "content": "https://issues.apache.org/jira/secure/attachment/12893161/union_array.arrow"
            }
        ],
        "customfield_12312340": null,
        "customfield_12314123": null,
        "customfield_12312341": null,
        "customfield_12312220": null,
        "customfield_12314122": null,
        "customfield_12314121": null,
        "customfield_12314120": null,
        "customfield_12314129": null,
        "customfield_12314524": null,
        "customfield_12314128": null,
        "summary": "[Python, Java] UnionArray round trip not working",
        "customfield_12314130": null,
        "customfield_12310291": null,
        "customfield_12310290": null,
        "customfield_12314138": null,
        "customfield_12314137": null,
        "environment": null,
        "customfield_12314136": null,
        "customfield_12314135": null,
        "customfield_12311020": null,
        "customfield_12314134": null,
        "duedate": null,
        "customfield_12314132": null,
        "customfield_12314131": null,
        "comment": {
            "comments": [
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13110864/comment/16212898",
                    "id": "16212898",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=wesm",
                        "name": "wesm",
                        "key": "wesmckinn",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=wesmckinn&avatarId=29931",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=wesmckinn&avatarId=29931",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=wesmckinn&avatarId=29931",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=wesmckinn&avatarId=29931"
                        },
                        "displayName": "Wes McKinney",
                        "active": true,
                        "timeZone": "America/New_York"
                    },
                    "body": "We have yet to complete integration tests for unions, so it does not surprise me that there are some small issues. \r\n\r\nSee open PR https://github.com/apache/arrow/pull/987",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=wesm",
                        "name": "wesm",
                        "key": "wesmckinn",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=wesmckinn&avatarId=29931",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=wesmckinn&avatarId=29931",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=wesmckinn&avatarId=29931",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=wesmckinn&avatarId=29931"
                        },
                        "displayName": "Wes McKinney",
                        "active": true,
                        "timeZone": "America/New_York"
                    },
                    "created": "2017-10-20T17:07:14.218+0000",
                    "updated": "2017-10-20T17:07:14.218+0000"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13110864/comment/16212899",
                    "id": "16212899",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=wesm",
                        "name": "wesm",
                        "key": "wesmckinn",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=wesmckinn&avatarId=29931",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=wesmckinn&avatarId=29931",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=wesmckinn&avatarId=29931",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=wesmckinn&avatarId=29931"
                        },
                        "displayName": "Wes McKinney",
                        "active": true,
                        "timeZone": "America/New_York"
                    },
                    "body": "cc [~icexelloss]",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=wesm",
                        "name": "wesm",
                        "key": "wesmckinn",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=wesmckinn&avatarId=29931",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=wesmckinn&avatarId=29931",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=wesmckinn&avatarId=29931",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=wesmckinn&avatarId=29931"
                        },
                        "displayName": "Wes McKinney",
                        "active": true,
                        "timeZone": "America/New_York"
                    },
                    "created": "2017-10-20T17:07:26.823+0000",
                    "updated": "2017-10-20T17:07:26.823+0000"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13110864/comment/16212958",
                    "id": "16212958",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=icexelloss",
                        "name": "icexelloss",
                        "key": "icexelloss",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "Li Jin",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "body": "Yeah Union type doesn't work between java/c++ because they have different presentation. (The java one is incorrect I think)",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=icexelloss",
                        "name": "icexelloss",
                        "key": "icexelloss",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "Li Jin",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "created": "2017-10-20T17:56:39.618+0000",
                    "updated": "2017-10-20T17:56:39.618+0000"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13110864/comment/16212961",
                    "id": "16212961",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=icexelloss",
                        "name": "icexelloss",
                        "key": "icexelloss",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "Li Jin",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "body": "We can probably do the integration for Union in 0.8 if the refactor work finishes ahead of schedule, otherwise I'd suggest we prioritize refactoring work and ensure its quality.  ",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=icexelloss",
                        "name": "icexelloss",
                        "key": "icexelloss",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "Li Jin",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "created": "2017-10-20T17:58:51.094+0000",
                    "updated": "2017-10-20T17:58:51.094+0000"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13110864/comment/16214423",
                    "id": "16214423",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=pcmoritz",
                        "name": "pcmoritz",
                        "key": "pcmoritz",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "Philipp Moritz",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "body": "Thanks for your help! I tried to make it work on top of https://github.com/apache/arrow/pull/987 but the Dense Union integration there is also not compatible with C++ and if this code will be deprecated soon it probably doesn't make much sense to fix it.\r\n\r\nIf there is anything I can do to speed up us having Dense Union support in Java that interoperates with C++ let me know!",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=pcmoritz",
                        "name": "pcmoritz",
                        "key": "pcmoritz",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "Philipp Moritz",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "created": "2017-10-22T19:26:43.577+0000",
                    "updated": "2017-10-22T19:26:43.577+0000"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13110864/comment/16291814",
                    "id": "16291814",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=pcmoritz",
                        "name": "pcmoritz",
                        "key": "pcmoritz",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "Philipp Moritz",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "body": "I tried this again with 0.8 and it gives the following error:\r\n\r\n{code}\r\njshell> ArrowStreamReader reader = new ArrowStreamReader(in, allocator);\r\nreader ==> org.apache.arrow.vector.ipc.ArrowStreamReader@55cf0d14\r\n\r\njshell> ByteArrayInputStream in = new ByteArrayInputStream(Files.readAllBytes(Paths.get(\"/Users/pcmoritz/arrow/python/union_array.arrow\")));\r\nin ==> java.io.ByteArrayInputStream@3b74ac8\r\n\r\njshell> ArrowStreamReader reader = new ArrowStreamReader(in, allocator);\r\nreader ==> org.apache.arrow.vector.ipc.ArrowStreamReader@27adc16e\r\n\r\njshell> reader.loadNextBatch()\r\n|  java.lang.IndexOutOfBoundsException thrown: \r\n|        at Buffer.checkIndex (Buffer.java:675)\r\n|        at HeapByteBuffer.getInt (HeapByteBuffer.java:405)\r\n|        at Table.__string (Table.java:50)\r\n|        at KeyValue.key (KeyValue.java:21)\r\n|        at Field.convertField (Field.java:126)\r\n|        at Field.convertField (Field.java:118)\r\n|        at Schema.convertSchema (Schema.java:85)\r\n|        at MessageSerializer.deserializeSchema (MessageSerializer.java:112)\r\n|        at ArrowStreamReader.readSchema (ArrowStreamReader.java:128)\r\n|        at ArrowReader.initialize (ArrowReader.java:181)\r\n|        at ArrowReader.ensureInitialized (ArrowReader.java:172)\r\n|        at ArrowReader.prepareLoadNextBatch (ArrowReader.java:211)\r\n|        at ArrowStreamReader.loadNextBatch (ArrowStreamReader.java:103)\r\n|        at (#12:1)\r\n{code}",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=pcmoritz",
                        "name": "pcmoritz",
                        "key": "pcmoritz",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "Philipp Moritz",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "created": "2017-12-15T00:05:20.932+0000",
                    "updated": "2017-12-15T00:05:20.932+0000"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13110864/comment/16527756",
                    "id": "16527756",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=wesm",
                        "name": "wesm",
                        "key": "wesmckinn",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=wesmckinn&avatarId=29931",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=wesmckinn&avatarId=29931",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=wesmckinn&avatarId=29931",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=wesmckinn&avatarId=29931"
                        },
                        "displayName": "Wes McKinney",
                        "active": true,
                        "timeZone": "America/New_York"
                    },
                    "body": "I hope we can resolve this in the 0.11 release cycle",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=wesm",
                        "name": "wesm",
                        "key": "wesmckinn",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=wesmckinn&avatarId=29931",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=wesmckinn&avatarId=29931",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=wesmckinn&avatarId=29931",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=wesmckinn&avatarId=29931"
                        },
                        "displayName": "Wes McKinney",
                        "active": true,
                        "timeZone": "America/New_York"
                    },
                    "created": "2018-06-29T14:50:22.223+0000",
                    "updated": "2018-06-29T14:50:22.223+0000"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13110864/comment/17156159",
                    "id": "17156159",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=wesm",
                        "name": "wesm",
                        "key": "wesmckinn",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=wesmckinn&avatarId=29931",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=wesmckinn&avatarId=29931",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=wesmckinn&avatarId=29931",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=wesmckinn&avatarId=29931"
                        },
                        "displayName": "Wes McKinney",
                        "active": true,
                        "timeZone": "America/New_York"
                    },
                    "body": "Issue resolved by pull request 7290\n[https://github.com/apache/arrow/pull/7290]",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=wesm",
                        "name": "wesm",
                        "key": "wesmckinn",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=wesmckinn&avatarId=29931",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=wesmckinn&avatarId=29931",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=wesmckinn&avatarId=29931",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=wesmckinn&avatarId=29931"
                        },
                        "displayName": "Wes McKinney",
                        "active": true,
                        "timeZone": "America/New_York"
                    },
                    "created": "2020-07-11T22:48:24.312+0000",
                    "updated": "2020-07-11T22:48:24.312+0000"
                }
            ],
            "maxResults": 8,
            "total": 8,
            "startAt": 0
        },
        "customfield_12311820": "0|i3lhxb:",
        "customfield_12314139": null
    }
}