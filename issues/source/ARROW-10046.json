{
    "expand": "operations,versionedRepresentations,editmeta,changelog,renderedFields",
    "id": "13328400",
    "self": "https://issues.apache.org/jira/rest/api/2/issue/13328400",
    "key": "ARROW-10046",
    "fields": {
        "fixVersions": [
            {
                "self": "https://issues.apache.org/jira/rest/api/2/version/12345977",
                "id": "12345977",
                "description": "",
                "name": "2.0.0",
                "archived": false,
                "released": true,
                "releaseDate": "2020-10-19"
            }
        ],
        "resolution": {
            "self": "https://issues.apache.org/jira/rest/api/2/resolution/1",
            "id": "1",
            "description": "A fix for this issue is checked into the tree and tested.",
            "name": "Fixed"
        },
        "customfield_12312322": null,
        "customfield_12312323": null,
        "customfield_12312320": null,
        "customfield_12310420": "9223372036854775807",
        "customfield_12312321": null,
        "customfield_12312328": null,
        "customfield_12312329": null,
        "customfield_12312326": null,
        "customfield_12310300": null,
        "customfield_12312327": null,
        "customfield_12312324": null,
        "customfield_12312720": null,
        "customfield_12312325": null,
        "lastViewed": null,
        "priority": {
            "self": "https://issues.apache.org/jira/rest/api/2/priority/3",
            "iconUrl": "https://issues.apache.org/jira/images/icons/priorities/major.svg",
            "name": "Major",
            "id": "3"
        },
        "labels": [
            "pull-request-available"
        ],
        "customfield_12312333": null,
        "customfield_12312334": null,
        "customfield_12313422": "false",
        "customfield_12310310": "0.0",
        "customfield_12312331": null,
        "customfield_12312332": null,
        "aggregatetimeoriginalestimate": null,
        "timeestimate": 0,
        "customfield_12312330": null,
        "versions": [],
        "customfield_12311120": null,
        "customfield_12313826": null,
        "customfield_12312339": null,
        "issuelinks": [],
        "customfield_12313825": null,
        "assignee": {
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=jorgecarleitao",
            "name": "jorgecarleitao",
            "key": "jorgecarleitao",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=jorgecarleitao&avatarId=43827",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jorgecarleitao&avatarId=43827",
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jorgecarleitao&avatarId=43827",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jorgecarleitao&avatarId=43827"
            },
            "displayName": "Jorge Leit\u00e3o",
            "active": true,
            "timeZone": "Etc/UTC"
        },
        "customfield_12312337": null,
        "customfield_12313823": null,
        "customfield_12312338": null,
        "customfield_12311920": null,
        "customfield_12313822": null,
        "customfield_12312335": null,
        "customfield_12313821": null,
        "customfield_12312336": null,
        "customfield_12313820": null,
        "status": {
            "self": "https://issues.apache.org/jira/rest/api/2/status/5",
            "description": "A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.",
            "iconUrl": "https://issues.apache.org/jira/images/icons/statuses/resolved.png",
            "name": "Resolved",
            "id": "5",
            "statusCategory": {
                "self": "https://issues.apache.org/jira/rest/api/2/statuscategory/3",
                "id": 3,
                "key": "done",
                "colorName": "green",
                "name": "Done"
            }
        },
        "components": [
            {
                "self": "https://issues.apache.org/jira/rest/api/2/component/12333773",
                "id": "12333773",
                "name": "Rust"
            },
            {
                "self": "https://issues.apache.org/jira/rest/api/2/component/12335005",
                "id": "12335005",
                "name": "Rust - DataFusion"
            }
        ],
        "customfield_12312026": null,
        "customfield_12312023": null,
        "customfield_12312024": null,
        "aggregatetimeestimate": 0,
        "customfield_12312022": null,
        "customfield_12310921": null,
        "customfield_12310920": "9223372036854775807",
        "customfield_12312823": null,
        "creator": {
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=jorgecarleitao",
            "name": "jorgecarleitao",
            "key": "jorgecarleitao",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=jorgecarleitao&avatarId=43827",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jorgecarleitao&avatarId=43827",
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jorgecarleitao&avatarId=43827",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jorgecarleitao&avatarId=43827"
            },
            "displayName": "Jorge Leit\u00e3o",
            "active": true,
            "timeZone": "Etc/UTC"
        },
        "subtasks": [],
        "reporter": {
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=jorgecarleitao",
            "name": "jorgecarleitao",
            "key": "jorgecarleitao",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=jorgecarleitao&avatarId=43827",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=jorgecarleitao&avatarId=43827",
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=jorgecarleitao&avatarId=43827",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=jorgecarleitao&avatarId=43827"
            },
            "displayName": "Jorge Leit\u00e3o",
            "active": true,
            "timeZone": "Etc/UTC"
        },
        "aggregateprogress": {
            "progress": 6000,
            "total": 6000,
            "percent": 100
        },
        "customfield_12313520": null,
        "customfield_12310250": null,
        "progress": {
            "progress": 6000,
            "total": 6000,
            "percent": 100
        },
        "customfield_12313924": null,
        "votes": {
            "self": "https://issues.apache.org/jira/rest/api/2/issue/ARROW-10046/votes",
            "votes": 0,
            "hasVoted": false
        },
        "worklog": {
            "startAt": 0,
            "maxResults": 20,
            "total": 10,
            "worklogs": [
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13328400/worklog/486644",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "jorgecarleitao opened a new pull request #8225:\nURL: https://github.com/apache/arrow/pull/8225\n\n\n   This is a proposal to change how we programmatically iterate over record batches in arrow and datafusion.\r\n   \r\n   Instead of \r\n   \r\n   ```\r\n   pub fn collect(\r\n       it: Arc<Mutex<dyn RecordBatchReader + Send + Sync>>,\r\n   ) -> Result<Vec<RecordBatch>> {\r\n       let mut reader = it.lock().unwrap();\r\n       let mut results: Vec<RecordBatch> = vec![];\r\n       loop {\r\n           match reader.next_batch() {\r\n               Ok(Some(batch)) => {\r\n                   results.push(batch);\r\n               }\r\n               Ok(None) => {\r\n                   // end of result set\r\n                   return Ok(results);\r\n               }\r\n               Err(e) => return Err(ExecutionError::from(e)),\r\n           }\r\n       }\r\n   }\r\n   ```\r\n   \r\n   use \r\n   \r\n   ```\r\n   /// Create a vector of record batches from an iterator\r\n   pub fn collect(\r\n       it: Arc<Mutex<dyn RecordBatchReader + Send + Sync>>,\r\n   ) -> Result<Vec<RecordBatch>> {\r\n       it.lock()\r\n           .unwrap()\r\n           .into_iter()\r\n           .collect::<ArrowResult<Vec<_>>>()\r\n           .map_err(|e| ExecutionError::from(e))\r\n   }\r\n   ```\r\n   \r\n   I.e. via the iterator API.\r\n   \r\n   This allow us to write more expressive code, as well as offer a well documented and popular API to our users (Iterator).\r\n   \r\n   Finally, this change also opens the possibility to implement `future::Stream`, which is the async version of `Iterator`.\n\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2020-09-20T10:34:12.824+0000",
                    "updated": "2020-09-20T10:34:12.824+0000",
                    "started": "2020-09-20T10:34:12.822+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "486644",
                    "issueId": "13328400"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13328400/worklog/486646",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "github-actions[bot] commented on pull request #8225:\nURL: https://github.com/apache/arrow/pull/8225#issuecomment-695772272\n\n\n   https://issues.apache.org/jira/browse/ARROW-10046\n\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2020-09-20T10:46:54.302+0000",
                    "updated": "2020-09-20T10:46:54.302+0000",
                    "started": "2020-09-20T10:46:54.302+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "486646",
                    "issueId": "13328400"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13328400/worklog/487475",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "github-actions[bot] commented on pull request #8225:\nURL: https://github.com/apache/arrow/pull/8225#issuecomment-695772272\n\n\n   https://issues.apache.org/jira/browse/ARROW-10046\n\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2020-09-22T03:05:01.251+0000",
                    "updated": "2020-09-22T03:05:01.251+0000",
                    "started": "2020-09-22T03:05:01.251+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "487475",
                    "issueId": "13328400"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13328400/worklog/487611",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "jorgecarleitao opened a new pull request #8225:\nURL: https://github.com/apache/arrow/pull/8225\n\n\n   This is a proposal to change how we programmatically iterate over record batches in arrow and datafusion.\r\n   \r\n   Instead of \r\n   \r\n   ```\r\n   pub fn collect(\r\n       it: Arc<Mutex<dyn RecordBatchReader + Send + Sync>>,\r\n   ) -> Result<Vec<RecordBatch>> {\r\n       let mut reader = it.lock().unwrap();\r\n       let mut results: Vec<RecordBatch> = vec![];\r\n       loop {\r\n           match reader.next_batch() {\r\n               Ok(Some(batch)) => {\r\n                   results.push(batch);\r\n               }\r\n               Ok(None) => {\r\n                   // end of result set\r\n                   return Ok(results);\r\n               }\r\n               Err(e) => return Err(ExecutionError::from(e)),\r\n           }\r\n       }\r\n   }\r\n   ```\r\n   \r\n   use \r\n   \r\n   ```\r\n   /// Create a vector of record batches from an iterator\r\n   pub fn collect(\r\n       it: Arc<Mutex<dyn RecordBatchReader + Send + Sync>>,\r\n   ) -> Result<Vec<RecordBatch>> {\r\n       it.lock()\r\n           .unwrap()\r\n           .into_iter()\r\n           .collect::<ArrowResult<Vec<_>>>()\r\n           .map_err(|e| ExecutionError::from(e))\r\n   }\r\n   ```\r\n   \r\n   I.e. via the iterator API.\r\n   \r\n   This allow us to write more expressive code, as well as offer a well documented and popular API to our users (Iterator).\r\n   \r\n   Finally, this change also opens the possibility to implement `future::Stream`, which is the async version of `Iterator`.\n\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2020-09-22T03:20:39.775+0000",
                    "updated": "2020-09-22T03:20:39.775+0000",
                    "started": "2020-09-22T03:20:39.775+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "487611",
                    "issueId": "13328400"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13328400/worklog/491530",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "jorgecarleitao commented on pull request #8225:\nURL: https://github.com/apache/arrow/pull/8225#issuecomment-699440937\n\n\n   FYI, I am trying to summarize how DataFusion iterates over data, and I came up with [this summary](https://docs.google.com/document/d/1yREyFSA1Fx1WMC0swUAZBbNlKPmTyebzAiQ8Eu6Ynpg/edit?usp=sharing).\n\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2020-09-26T06:42:52.639+0000",
                    "updated": "2020-09-26T06:42:52.639+0000",
                    "started": "2020-09-26T06:42:52.639+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "491530",
                    "issueId": "13328400"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13328400/worklog/493541",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "alamb commented on a change in pull request #8225:\nURL: https://github.com/apache/arrow/pull/8225#discussion_r498325552\n\n\n\n##########\nFile path: rust/arrow-flight/src/utils.rs\n##########\n@@ -129,21 +129,29 @@ impl TryFrom<&SchemaResult> for Schema {\n pub fn flight_data_to_arrow_batch(\n     data: &FlightData,\n     schema: SchemaRef,\n-) -> Result<Option<RecordBatch>> {\n+) -> Option<Result<RecordBatch>> {\n\nReview comment:\n       Is the reason for this change because a Rust iterator has to return an `Option`  (so it can signal none)?\n\n##########\nFile path: rust/arrow/src/record_batch.rs\n##########\n@@ -217,15 +217,12 @@ impl Into<StructArray> for RecordBatch {\n }\n \n /// Trait for types that can read `RecordBatch`'s.\n-pub trait RecordBatchReader {\n+pub trait RecordBatchReader: Iterator<Item = Result<RecordBatch>> {\n     /// Returns the schema of this `RecordBatchReader`.\n     ///\n     /// Implementation of this trait should guarantee that all `RecordBatch`'s returned by this\n     /// reader should have the same schema as returned from this method.\n     fn schema(&self) -> SchemaRef;\n-\n-    /// Reads the next `RecordBatch`.\n\nReview comment:\n       I wonder if you could leave this function in the trait (and provide a default implementation it in terms of `self.next()`) if you wanted to reduce the changes required for existing code (maybe it could be marked as deprecated?)\n\n##########\nFile path: rust/arrow/src/ipc/reader.rs\n##########\n@@ -945,7 +959,7 @@ mod tests {\n             let arrow_json = read_gzip_json(path);\n             assert!(arrow_json.equals_reader(&mut reader));\n             // the next batch must be empty\n-            assert!(reader.next_batch().unwrap().is_none());\n+            assert!(reader.next().is_none());\n\nReview comment:\n       \ud83d\udc4d \n\n##########\nFile path: rust/datafusion/src/datasource/memory.rs\n##########\n@@ -64,10 +65,7 @@ impl MemTable {\n         for partition in 0..exec.output_partitioning().partition_count() {\n             let it = exec.execute(partition).await?;\n             let mut it = it.lock().unwrap();\n-            let mut partition_batches = vec![];\n-            while let Ok(Some(batch)) = it.next_batch() {\n-                partition_batches.push(batch);\n-            }\n+            let partition_batches = it.into_iter().collect::<ArrowResult<Vec<_>>>()?;\n\nReview comment:\n       this is so much nicer. \u2764\ufe0f \n\n##########\nFile path: rust/arrow/src/record_batch.rs\n##########\n@@ -217,15 +217,12 @@ impl Into<StructArray> for RecordBatch {\n }\n \n /// Trait for types that can read `RecordBatch`'s.\n-pub trait RecordBatchReader {\n+pub trait RecordBatchReader: Iterator<Item = Result<RecordBatch>> {\n\nReview comment:\n       \ud83c\udf89 \n\n##########\nFile path: rust/datafusion/tests/user_defined_plan.rs\n##########\n@@ -450,73 +449,69 @@ impl TopKReader {\n             self.top_values.remove(&smallest_revenue);\n         }\n     }\n-}\n \n-impl RecordBatchReader for TopKReader {\n-    fn schema(&self) -> SchemaRef {\n-        self.input.lock().expect(\"locked input reader\").schema()\n+    // how we process a whole batch\n+    fn accumulate_batch(&mut self, input_batch: &RecordBatch) -> Result<()> {\n\nReview comment:\n       \ud83d\udc4d \n\n\n\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2020-10-01T15:31:02.205+0000",
                    "updated": "2020-10-01T15:31:02.205+0000",
                    "started": "2020-10-01T15:31:02.204+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "493541",
                    "issueId": "13328400"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13328400/worklog/493553",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "jorgecarleitao commented on a change in pull request #8225:\nURL: https://github.com/apache/arrow/pull/8225#discussion_r498348983\n\n\n\n##########\nFile path: rust/arrow-flight/src/utils.rs\n##########\n@@ -129,21 +129,29 @@ impl TryFrom<&SchemaResult> for Schema {\n pub fn flight_data_to_arrow_batch(\n     data: &FlightData,\n     schema: SchemaRef,\n-) -> Result<Option<RecordBatch>> {\n+) -> Option<Result<RecordBatch>> {\n\nReview comment:\n       Yes, that is the reason. we could [`transpose`](https://doc.rust-lang.org/std/result/enum.Result.html#method.transpose) these operations elsewhere, but the gist is that the iterator `next` needs the `Option` to come first (which is not very user-friendly as it limits the usage of `?`)\n\n\n\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2020-10-01T15:50:21.345+0000",
                    "updated": "2020-10-01T15:50:21.345+0000",
                    "started": "2020-10-01T15:50:21.345+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "493553",
                    "issueId": "13328400"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13328400/worklog/493556",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "jorgecarleitao commented on a change in pull request #8225:\nURL: https://github.com/apache/arrow/pull/8225#discussion_r498351491\n\n\n\n##########\nFile path: rust/arrow/src/record_batch.rs\n##########\n@@ -217,15 +217,12 @@ impl Into<StructArray> for RecordBatch {\n }\n \n /// Trait for types that can read `RecordBatch`'s.\n-pub trait RecordBatchReader {\n+pub trait RecordBatchReader: Iterator<Item = Result<RecordBatch>> {\n     /// Returns the schema of this `RecordBatchReader`.\n     ///\n     /// Implementation of this trait should guarantee that all `RecordBatch`'s returned by this\n     /// reader should have the same schema as returned from this method.\n     fn schema(&self) -> SchemaRef;\n-\n-    /// Reads the next `RecordBatch`.\n\nReview comment:\n       That is a good idea. I will try that.\r\n   \n\n\n\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2020-10-01T15:54:12.555+0000",
                    "updated": "2020-10-01T15:54:12.555+0000",
                    "started": "2020-10-01T15:54:12.555+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "493556",
                    "issueId": "13328400"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13328400/worklog/493580",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "jorgecarleitao commented on a change in pull request #8225:\nURL: https://github.com/apache/arrow/pull/8225#discussion_r498373221\n\n\n\n##########\nFile path: rust/arrow/src/record_batch.rs\n##########\n@@ -217,15 +217,12 @@ impl Into<StructArray> for RecordBatch {\n }\n \n /// Trait for types that can read `RecordBatch`'s.\n-pub trait RecordBatchReader {\n+pub trait RecordBatchReader: Iterator<Item = Result<RecordBatch>> {\n     /// Returns the schema of this `RecordBatchReader`.\n     ///\n     /// Implementation of this trait should guarantee that all `RecordBatch`'s returned by this\n     /// reader should have the same schema as returned from this method.\n     fn schema(&self) -> SchemaRef;\n-\n-    /// Reads the next `RecordBatch`.\n\nReview comment:\n       Done. Really good idea, @alamb. Thanks a lot for this and all the other reviews! (fyi, I can't merge to master yet, so we both need to wait for someone to take these and yours \ud83d\udd50)\n\n\n\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2020-10-01T16:29:28.796+0000",
                    "updated": "2020-10-01T16:29:28.796+0000",
                    "started": "2020-10-01T16:29:28.796+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "493580",
                    "issueId": "13328400"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13328400/worklog/493788",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "andygrove closed pull request #8225:\nURL: https://github.com/apache/arrow/pull/8225\n\n\n   \n\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2020-10-02T02:42:41.705+0000",
                    "updated": "2020-10-02T02:42:41.705+0000",
                    "started": "2020-10-02T02:42:41.704+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "493788",
                    "issueId": "13328400"
                }
            ]
        },
        "customfield_12313920": null,
        "issuetype": {
            "self": "https://issues.apache.org/jira/rest/api/2/issuetype/4",
            "id": "4",
            "description": "An improvement or enhancement to an existing feature or task.",
            "iconUrl": "https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21140&avatarType=issuetype",
            "name": "Improvement",
            "subtask": false,
            "avatarId": 21140
        },
        "timespent": 6000,
        "customfield_12314020": "{summaryBean=com.atlassian.jira.plugin.devstatus.rest.SummaryBean@151f2c8d[summary={pullrequest=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@26531bfd[overall=PullRequestOverallBean{stateCount=0, state='OPEN', details=PullRequestOverallDetails{openCount=0, mergedCount=0, declinedCount=0}},byInstanceType={}], build=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@62bd81d7[overall=com.atlassian.jira.plugin.devstatus.summary.beans.BuildOverallBean@5c0fe28e[failedBuildCount=0,successfulBuildCount=0,unknownBuildCount=0,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], review=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@6ea56d37[overall=com.atlassian.jira.plugin.devstatus.summary.beans.ReviewsOverallBean@35aa53df[stateCount=0,state=<null>,dueDate=<null>,overDue=false,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], deployment-environment=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@3b17df84[overall=com.atlassian.jira.plugin.devstatus.summary.beans.DeploymentOverallBean@18af51fa[topEnvironments=[],showProjects=false,successfulCount=0,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], repository=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@5da65b0d[overall=com.atlassian.jira.plugin.devstatus.summary.beans.CommitOverallBean@3af5cfcd[count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], branch=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@3f9bdce8[overall=com.atlassian.jira.plugin.devstatus.summary.beans.BranchOverallBean@5d596a60[count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}]},errors=[],configErrors=[]], devSummaryJson={\"cachedValue\":{\"errors\":[],\"configErrors\":[],\"summary\":{\"pullrequest\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"stateCount\":0,\"state\":\"OPEN\",\"details\":{\"openCount\":0,\"mergedCount\":0,\"declinedCount\":0,\"total\":0},\"open\":true},\"byInstanceType\":{}},\"build\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"failedBuildCount\":0,\"successfulBuildCount\":0,\"unknownBuildCount\":0},\"byInstanceType\":{}},\"review\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"stateCount\":0,\"state\":null,\"dueDate\":null,\"overDue\":false,\"completed\":false},\"byInstanceType\":{}},\"deployment-environment\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"topEnvironments\":[],\"showProjects\":false,\"successfulCount\":0},\"byInstanceType\":{}},\"repository\":{\"overall\":{\"count\":0,\"lastUpdated\":null},\"byInstanceType\":{}},\"branch\":{\"overall\":{\"count\":0,\"lastUpdated\":null},\"byInstanceType\":{}}}},\"isStale\":false}}",
        "customfield_12314141": null,
        "customfield_12314140": null,
        "project": {
            "self": "https://issues.apache.org/jira/rest/api/2/project/12319525",
            "id": "12319525",
            "key": "ARROW",
            "name": "Apache Arrow",
            "projectTypeKey": "software",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/projectavatar?pid=12319525&avatarId=10011",
                "24x24": "https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12319525&avatarId=10011",
                "16x16": "https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12319525&avatarId=10011",
                "32x32": "https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12319525&avatarId=10011"
            },
            "projectCategory": {
                "self": "https://issues.apache.org/jira/rest/api/2/projectCategory/13960",
                "id": "13960",
                "description": "Apache Arrow",
                "name": "Arrow"
            }
        },
        "aggregatetimespent": 6000,
        "customfield_12312520": null,
        "customfield_12312521": "Fri Oct 02 02:42:34 UTC 2020",
        "customfield_12314422": null,
        "customfield_12314421": null,
        "customfield_12314146": null,
        "customfield_12314420": null,
        "customfield_12314145": null,
        "customfield_12314144": null,
        "customfield_12314143": null,
        "resolutiondate": "2020-10-02T02:42:34.000+0000",
        "workratio": -1,
        "customfield_12312923": null,
        "customfield_12312920": null,
        "customfield_12312921": null,
        "watches": {
            "self": "https://issues.apache.org/jira/rest/api/2/issue/ARROW-10046/watchers",
            "watchCount": 1,
            "isWatching": false
        },
        "created": "2020-09-20T10:23:29.000+0000",
        "updated": "2020-10-02T02:42:42.000+0000",
        "timeoriginalestimate": null,
        "description": "Currently, we use\u00a0{{next_batch -> Result<Option<RecordBatch>>}} to iterate over batches. However, this is very similar to the iterator pattern that Rust offers.\r\n\r\nThis issue concerns migrating our code from\u00a0{{next() -> Option<Result<RecordBatch>>}}\r\n\r\non the trait Iterator, so that we can leverage the rich Rust iterator API.\r\n\r\n\u00a0",
        "customfield_10010": null,
        "timetracking": {
            "remainingEstimate": "0h",
            "timeSpent": "1h 40m",
            "remainingEstimateSeconds": 0,
            "timeSpentSeconds": 6000
        },
        "customfield_12314523": null,
        "customfield_12314127": null,
        "customfield_12314522": null,
        "customfield_12314126": null,
        "customfield_12314521": null,
        "customfield_12314125": null,
        "customfield_12314520": null,
        "customfield_12314124": null,
        "attachment": [],
        "customfield_12312340": null,
        "customfield_12314123": null,
        "customfield_12312341": null,
        "customfield_12312220": null,
        "customfield_12314122": null,
        "customfield_12314121": null,
        "customfield_12314120": null,
        "customfield_12314129": null,
        "customfield_12314524": null,
        "customfield_12314128": null,
        "summary": "[Rust] [DataFusion] Made `*Iterator` implement Iterator",
        "customfield_12314130": null,
        "customfield_12310291": null,
        "customfield_12310290": null,
        "customfield_12314138": null,
        "customfield_12314137": null,
        "environment": null,
        "customfield_12314136": null,
        "customfield_12314135": null,
        "customfield_12311020": null,
        "customfield_12314134": null,
        "duedate": null,
        "customfield_12314132": null,
        "customfield_12314131": null,
        "comment": {
            "comments": [
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13328400/comment/17205946",
                    "id": "17205946",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=andygrove",
                        "name": "andygrove",
                        "key": "andygrove",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=andygrove&avatarId=28239",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=andygrove&avatarId=28239",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=andygrove&avatarId=28239",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=andygrove&avatarId=28239"
                        },
                        "displayName": "Andy Grove",
                        "active": true,
                        "timeZone": "America/Denver"
                    },
                    "body": "Issue resolved by pull request 8225\n[https://github.com/apache/arrow/pull/8225]",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=andygrove",
                        "name": "andygrove",
                        "key": "andygrove",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=andygrove&avatarId=28239",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=andygrove&avatarId=28239",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=andygrove&avatarId=28239",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=andygrove&avatarId=28239"
                        },
                        "displayName": "Andy Grove",
                        "active": true,
                        "timeZone": "America/Denver"
                    },
                    "created": "2020-10-02T02:42:34.893+0000",
                    "updated": "2020-10-02T02:42:34.893+0000"
                }
            ],
            "maxResults": 1,
            "total": 1,
            "startAt": 0
        },
        "customfield_12311820": "0|z0iqu8:",
        "customfield_12314139": null
    }
}