{
    "expand": "operations,versionedRepresentations,editmeta,changelog,renderedFields",
    "id": "13359333",
    "self": "https://issues.apache.org/jira/rest/api/2/issue/13359333",
    "key": "ARROW-11688",
    "fields": {
        "fixVersions": [
            {
                "self": "https://issues.apache.org/jira/rest/api/2/version/12349493",
                "id": "12349493",
                "description": "",
                "name": "4.0.0",
                "archived": false,
                "released": true,
                "releaseDate": "2021-04-26"
            }
        ],
        "resolution": {
            "self": "https://issues.apache.org/jira/rest/api/2/resolution/1",
            "id": "1",
            "description": "A fix for this issue is checked into the tree and tested.",
            "name": "Fixed"
        },
        "customfield_12312322": null,
        "customfield_12312323": null,
        "customfield_12312320": null,
        "customfield_12310420": "9223372036854775807",
        "customfield_12312321": null,
        "customfield_12312328": null,
        "customfield_12312329": null,
        "customfield_12312326": null,
        "customfield_12310300": null,
        "customfield_12312327": null,
        "customfield_12312324": null,
        "customfield_12312720": null,
        "customfield_12312325": null,
        "lastViewed": null,
        "priority": {
            "self": "https://issues.apache.org/jira/rest/api/2/priority/3",
            "iconUrl": "https://issues.apache.org/jira/images/icons/priorities/major.svg",
            "name": "Major",
            "id": "3"
        },
        "labels": [
            "pull-request-available"
        ],
        "customfield_12312333": null,
        "customfield_12312334": null,
        "customfield_12313422": "false",
        "customfield_12310310": "0.0",
        "customfield_12312331": null,
        "customfield_12312332": null,
        "aggregatetimeoriginalestimate": null,
        "timeestimate": 0,
        "customfield_12312330": null,
        "versions": [],
        "customfield_12311120": null,
        "customfield_12313826": null,
        "customfield_12312339": null,
        "issuelinks": [],
        "customfield_12313825": null,
        "assignee": {
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=ritchie46",
            "name": "ritchie46",
            "key": "ritchie46",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=34059",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34059",
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34059",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34059"
            },
            "displayName": "Ritchie",
            "active": true,
            "timeZone": "Etc/UTC"
        },
        "customfield_12312337": null,
        "customfield_12313823": null,
        "customfield_12312338": null,
        "customfield_12311920": null,
        "customfield_12313822": null,
        "customfield_12312335": null,
        "customfield_12313821": null,
        "customfield_12312336": null,
        "customfield_12313820": null,
        "status": {
            "self": "https://issues.apache.org/jira/rest/api/2/status/5",
            "description": "A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.",
            "iconUrl": "https://issues.apache.org/jira/images/icons/statuses/resolved.png",
            "name": "Resolved",
            "id": "5",
            "statusCategory": {
                "self": "https://issues.apache.org/jira/rest/api/2/statuscategory/3",
                "id": 3,
                "key": "done",
                "colorName": "green",
                "name": "Done"
            }
        },
        "components": [
            {
                "self": "https://issues.apache.org/jira/rest/api/2/component/12333773",
                "id": "12333773",
                "name": "Rust"
            }
        ],
        "customfield_12312026": null,
        "customfield_12312023": null,
        "customfield_12312024": null,
        "aggregatetimeestimate": 0,
        "customfield_12312022": null,
        "customfield_12310921": null,
        "customfield_12310920": "9223372036854775807",
        "customfield_12312823": null,
        "creator": {
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=ritchie46",
            "name": "ritchie46",
            "key": "ritchie46",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=34059",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34059",
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34059",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34059"
            },
            "displayName": "Ritchie",
            "active": true,
            "timeZone": "Etc/UTC"
        },
        "subtasks": [],
        "reporter": {
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=ritchie46",
            "name": "ritchie46",
            "key": "ritchie46",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=34059",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34059",
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34059",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34059"
            },
            "displayName": "Ritchie",
            "active": true,
            "timeZone": "Etc/UTC"
        },
        "aggregateprogress": {
            "progress": 4200,
            "total": 4200,
            "percent": 100
        },
        "customfield_12313520": null,
        "customfield_12310250": null,
        "progress": {
            "progress": 4200,
            "total": 4200,
            "percent": 100
        },
        "customfield_12313924": null,
        "votes": {
            "self": "https://issues.apache.org/jira/rest/api/2/issue/ARROW-11688/votes",
            "votes": 0,
            "hasVoted": false
        },
        "worklog": {
            "startAt": 0,
            "maxResults": 20,
            "total": 7,
            "worklogs": [
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13359333/worklog/554254",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "ritchie46 opened a new pull request #9526:\nURL: https://github.com/apache/arrow/pull/9526\n\n\n   This PR makes it possible to cast between `utf8` and `large-utf8` arrays.\n\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2021-02-18T13:55:47.214+0000",
                    "updated": "2021-02-18T13:55:47.214+0000",
                    "started": "2021-02-18T13:55:47.214+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "554254",
                    "issueId": "13359333"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13359333/worklog/554255",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "github-actions[bot] commented on pull request #9526:\nURL: https://github.com/apache/arrow/pull/9526#issuecomment-781360206\n\n\n   https://issues.apache.org/jira/browse/ARROW-11688\n\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2021-02-18T13:56:00.535+0000",
                    "updated": "2021-02-18T13:56:00.535+0000",
                    "started": "2021-02-18T13:56:00.535+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "554255",
                    "issueId": "13359333"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13359333/worklog/555167",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "alamb commented on a change in pull request #9526:\nURL: https://github.com/apache/arrow/pull/9526#discussion_r579650998\n\n\n\n##########\nFile path: rust/arrow/src/compute/kernels/cast.rs\n##########\n@@ -1297,6 +1301,57 @@ fn cast_list_inner<OffsetSize: OffsetSizeTrait>(\n     Ok(Arc::new(list) as ArrayRef)\n }\n \n+/// Helper function to cast from Utf8 > LargeUtf8 and vice versa. If the LargeUtf8 it too large for\n+/// a Utf8 array it will return an Error.\n\nReview comment:\n       ```suggestion\r\n   /// Helper function to cast from `Utf8` to `LargeUtf8` and vice versa. If the `LargeUtf8` is too large for\r\n   /// a `Utf8` array it will return an Error.\r\n   ```\n\n##########\nFile path: rust/arrow/src/compute/kernels/cast.rs\n##########\n@@ -1778,6 +1833,26 @@ mod tests {\n         assert_eq!(out, vec![Some(\"1\"), Some(\"2\"), Some(\"3\")]);\n     }\n \n+    #[test]\n+    fn test_str_to_str_casts() {\n\nReview comment:\n       I recommend two other tests:\r\n   1.  The other way as well -- `StringArray` --> `LargeStringArray`\r\n   2. Nulls  (maybe `        let a = Arc::new(LargeStringArray::from(vec![Some(\"foo\"), None, Some(\"ham\")])) as ArrayRef;` for example)\r\n   \r\n   \r\n   \n\n##########\nFile path: rust/arrow/src/compute/kernels/cast.rs\n##########\n@@ -1297,6 +1301,57 @@ fn cast_list_inner<OffsetSize: OffsetSizeTrait>(\n     Ok(Arc::new(list) as ArrayRef)\n }\n \n+/// Helper function to cast from Utf8 > LargeUtf8 and vice versa. If the LargeUtf8 it too large for\n+/// a Utf8 array it will return an Error.\n+fn cast_str_container<OffsetSizeFrom, OffsetSizeTo>(array: &dyn Array) -> Result<ArrayRef>\n+where\n+    OffsetSizeFrom: StringOffsetSizeTrait + ToPrimitive,\n+    OffsetSizeTo: StringOffsetSizeTrait + NumCast + ArrowNativeType,\n+{\n+    let str_array = array\n+        .as_any()\n+        .downcast_ref::<GenericStringArray<OffsetSizeFrom>>()\n+        .unwrap();\n+    let list_data = array.data();\n+    let str_values_buf = str_array.value_data();\n+\n+    let offsets = unsafe { list_data.buffers()[0].typed_data::<OffsetSizeFrom>() };\n+\n+    let mut offset_builder = BufferBuilder::<OffsetSizeTo>::new(offsets.len());\n+    offsets.iter().try_for_each(|offset| {\n+        let offset = match OffsetSizeTo::from(*offset) {\n+            Some(idx) => idx,\n+            None => {\n+                return Err(ArrowError::ComputeError(\n+                    \"large-utf8 array too large to cast to utf8-array\".into(),\n+                ))\n+            }\n+        };\n+        offset_builder.append(offset);\n+        Ok(())\n+    })?;\n+\n+    offset_builder.append(OffsetSizeTo::from_usize(str_values_buf.len()).unwrap());\n\nReview comment:\n       I am surprised you have to special case the last `str_values_buf.len()` (shouldn't that have already been in the source buffer's offsets already, if it was needed?)\n\n##########\nFile path: rust/arrow/src/compute/kernels/cast.rs\n##########\n@@ -1297,6 +1301,57 @@ fn cast_list_inner<OffsetSize: OffsetSizeTrait>(\n     Ok(Arc::new(list) as ArrayRef)\n }\n \n+/// Helper function to cast from Utf8 > LargeUtf8 and vice versa. If the LargeUtf8 it too large for\n+/// a Utf8 array it will return an Error.\n+fn cast_str_container<OffsetSizeFrom, OffsetSizeTo>(array: &dyn Array) -> Result<ArrayRef>\n+where\n+    OffsetSizeFrom: StringOffsetSizeTrait + ToPrimitive,\n+    OffsetSizeTo: StringOffsetSizeTrait + NumCast + ArrowNativeType,\n+{\n+    let str_array = array\n+        .as_any()\n+        .downcast_ref::<GenericStringArray<OffsetSizeFrom>>()\n+        .unwrap();\n+    let list_data = array.data();\n+    let str_values_buf = str_array.value_data();\n+\n+    let offsets = unsafe { list_data.buffers()[0].typed_data::<OffsetSizeFrom>() };\n+\n+    let mut offset_builder = BufferBuilder::<OffsetSizeTo>::new(offsets.len());\n+    offsets.iter().try_for_each(|offset| {\n+        let offset = match OffsetSizeTo::from(*offset) {\n+            Some(idx) => idx,\n+            None => {\n+                return Err(ArrowError::ComputeError(\n+                    \"large-utf8 array too large to cast to utf8-array\".into(),\n+                ))\n+            }\n+        };\n\nReview comment:\n       You might be able to use something like `ok_or_else` here  if you wanted to avoid some repetition / be more idomatic: \r\n   \r\n   ```suggestion\r\n           let offset = OffsetSizeTo::from(*offset).ok_or_else(|| {\r\n                   ArrowError::ComputeError(\r\n                       \"large-utf8 array too large to cast to utf8-array\".into(),\r\n                   )\r\n               })?;\r\n   ```\n\n\n\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2021-02-20T12:40:58.436+0000",
                    "updated": "2021-02-20T12:40:58.436+0000",
                    "started": "2021-02-20T12:40:58.435+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "555167",
                    "issueId": "13359333"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13359333/worklog/555216",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "ritchie46 commented on a change in pull request #9526:\nURL: https://github.com/apache/arrow/pull/9526#discussion_r579666318\n\n\n\n##########\nFile path: rust/arrow/src/compute/kernels/cast.rs\n##########\n@@ -1297,6 +1301,57 @@ fn cast_list_inner<OffsetSize: OffsetSizeTrait>(\n     Ok(Arc::new(list) as ArrayRef)\n }\n \n+/// Helper function to cast from Utf8 > LargeUtf8 and vice versa. If the LargeUtf8 it too large for\n+/// a Utf8 array it will return an Error.\n+fn cast_str_container<OffsetSizeFrom, OffsetSizeTo>(array: &dyn Array) -> Result<ArrayRef>\n+where\n+    OffsetSizeFrom: StringOffsetSizeTrait + ToPrimitive,\n+    OffsetSizeTo: StringOffsetSizeTrait + NumCast + ArrowNativeType,\n+{\n+    let str_array = array\n+        .as_any()\n+        .downcast_ref::<GenericStringArray<OffsetSizeFrom>>()\n+        .unwrap();\n+    let list_data = array.data();\n+    let str_values_buf = str_array.value_data();\n+\n+    let offsets = unsafe { list_data.buffers()[0].typed_data::<OffsetSizeFrom>() };\n+\n+    let mut offset_builder = BufferBuilder::<OffsetSizeTo>::new(offsets.len());\n+    offsets.iter().try_for_each(|offset| {\n+        let offset = match OffsetSizeTo::from(*offset) {\n+            Some(idx) => idx,\n+            None => {\n+                return Err(ArrowError::ComputeError(\n+                    \"large-utf8 array too large to cast to utf8-array\".into(),\n+                ))\n+            }\n+        };\n\nReview comment:\n       Yes. I missed the clippy warning amongst the many.\n\n\n\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2021-02-20T14:49:01.767+0000",
                    "updated": "2021-02-20T14:49:01.767+0000",
                    "started": "2021-02-20T14:49:01.766+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "555216",
                    "issueId": "13359333"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13359333/worklog/555217",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "ritchie46 commented on a change in pull request #9526:\nURL: https://github.com/apache/arrow/pull/9526#discussion_r579666340\n\n\n\n##########\nFile path: rust/arrow/src/compute/kernels/cast.rs\n##########\n@@ -1297,6 +1301,57 @@ fn cast_list_inner<OffsetSize: OffsetSizeTrait>(\n     Ok(Arc::new(list) as ArrayRef)\n }\n \n+/// Helper function to cast from Utf8 > LargeUtf8 and vice versa. If the LargeUtf8 it too large for\n+/// a Utf8 array it will return an Error.\n+fn cast_str_container<OffsetSizeFrom, OffsetSizeTo>(array: &dyn Array) -> Result<ArrayRef>\n+where\n+    OffsetSizeFrom: StringOffsetSizeTrait + ToPrimitive,\n+    OffsetSizeTo: StringOffsetSizeTrait + NumCast + ArrowNativeType,\n+{\n+    let str_array = array\n+        .as_any()\n+        .downcast_ref::<GenericStringArray<OffsetSizeFrom>>()\n+        .unwrap();\n+    let list_data = array.data();\n+    let str_values_buf = str_array.value_data();\n+\n+    let offsets = unsafe { list_data.buffers()[0].typed_data::<OffsetSizeFrom>() };\n+\n+    let mut offset_builder = BufferBuilder::<OffsetSizeTo>::new(offsets.len());\n+    offsets.iter().try_for_each(|offset| {\n+        let offset = match OffsetSizeTo::from(*offset) {\n+            Some(idx) => idx,\n+            None => {\n+                return Err(ArrowError::ComputeError(\n+                    \"large-utf8 array too large to cast to utf8-array\".into(),\n+                ))\n+            }\n+        };\n+        offset_builder.append(offset);\n+        Ok(())\n+    })?;\n+\n+    offset_builder.append(OffsetSizeTo::from_usize(str_values_buf.len()).unwrap());\n\nReview comment:\n       Yes you are right. Fixed.\n\n\n\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2021-02-20T14:49:14.747+0000",
                    "updated": "2021-02-20T14:49:14.747+0000",
                    "started": "2021-02-20T14:49:14.747+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "555217",
                    "issueId": "13359333"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13359333/worklog/555224",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "codecov-io commented on pull request #9526:\nURL: https://github.com/apache/arrow/pull/9526#issuecomment-782695152\n\n\n   # [Codecov](https://codecov.io/gh/apache/arrow/pull/9526?src=pr&el=h1) Report\n   > Merging [#9526](https://codecov.io/gh/apache/arrow/pull/9526?src=pr&el=desc) (5c3c085) into [master](https://codecov.io/gh/apache/arrow/commit/bca7d2fe84ccd8fc1129cb4d85448eb0779c52c3?el=desc) (bca7d2f) will **increase** coverage by `0.04%`.\n   > The diff coverage is `92.36%`.\n   \n   [![Impacted file tree graph](https://codecov.io/gh/apache/arrow/pull/9526/graphs/tree.svg?width=650&height=150&src=pr&token=LpTCFbqVT1)](https://codecov.io/gh/apache/arrow/pull/9526?src=pr&el=tree)\n   \n   ```diff\n   @@            Coverage Diff             @@\n   ##           master    #9526      +/-   ##\n   ==========================================\n   + Coverage   82.24%   82.28%   +0.04%     \n   ==========================================\n     Files         244      244              \n     Lines       55289    55435     +146     \n   ==========================================\n   + Hits        45470    45614     +144     \n   - Misses       9819     9821       +2     \n   ```\n   \n   \n   | [Impacted Files](https://codecov.io/gh/apache/arrow/pull/9526?src=pr&el=tree) | Coverage \u0394 | |\n   |---|---|---|\n   | [rust/arrow/src/compute/kernels/comparison.rs](https://codecov.io/gh/apache/arrow/pull/9526/diff?src=pr&el=tree#diff-cnVzdC9hcnJvdy9zcmMvY29tcHV0ZS9rZXJuZWxzL2NvbXBhcmlzb24ucnM=) | `95.84% <\u00f8> (\u00f8)` | |\n   | [rust/arrow/src/json/reader.rs](https://codecov.io/gh/apache/arrow/pull/9526/diff?src=pr&el=tree#diff-cnVzdC9hcnJvdy9zcmMvanNvbi9yZWFkZXIucnM=) | `83.57% <89.89%> (+0.75%)` | :arrow_up: |\n   | [rust/arrow/src/compute/kernels/cast.rs](https://codecov.io/gh/apache/arrow/pull/9526/diff?src=pr&el=tree#diff-cnVzdC9hcnJvdy9zcmMvY29tcHV0ZS9rZXJuZWxzL2Nhc3QucnM=) | `97.23% <97.56%> (-0.01%)` | :arrow_down: |\n   | [rust/datafusion/src/physical\\_plan/limit.rs](https://codecov.io/gh/apache/arrow/pull/9526/diff?src=pr&el=tree#diff-cnVzdC9kYXRhZnVzaW9uL3NyYy9waHlzaWNhbF9wbGFuL2xpbWl0LnJz) | `57.47% <100.00%> (-0.49%)` | :arrow_down: |\n   | [rust/datafusion/src/physical\\_plan/planner.rs](https://codecov.io/gh/apache/arrow/pull/9526/diff?src=pr&el=tree#diff-cnVzdC9kYXRhZnVzaW9uL3NyYy9waHlzaWNhbF9wbGFuL3BsYW5uZXIucnM=) | `79.58% <100.00%> (-0.05%)` | :arrow_down: |\n   | [rust/datafusion/src/physical\\_plan/sort.rs](https://codecov.io/gh/apache/arrow/pull/9526/diff?src=pr&el=tree#diff-cnVzdC9kYXRhZnVzaW9uL3NyYy9waHlzaWNhbF9wbGFuL3NvcnQucnM=) | `90.17% <100.00%> (+0.90%)` | :arrow_up: |\n   | [rust/arrow/src/array/transform/fixed\\_binary.rs](https://codecov.io/gh/apache/arrow/pull/9526/diff?src=pr&el=tree#diff-cnVzdC9hcnJvdy9zcmMvYXJyYXkvdHJhbnNmb3JtL2ZpeGVkX2JpbmFyeS5ycw==) | `78.94% <0.00%> (-5.27%)` | :arrow_down: |\n   | [rust/arrow/src/array/equal/utils.rs](https://codecov.io/gh/apache/arrow/pull/9526/diff?src=pr&el=tree#diff-cnVzdC9hcnJvdy9zcmMvYXJyYXkvZXF1YWwvdXRpbHMucnM=) | `75.49% <0.00%> (-0.99%)` | :arrow_down: |\n   | [rust/arrow/src/record\\_batch.rs](https://codecov.io/gh/apache/arrow/pull/9526/diff?src=pr&el=tree#diff-cnVzdC9hcnJvdy9zcmMvcmVjb3JkX2JhdGNoLnJz) | `83.70% <0.00%> (-0.63%)` | :arrow_down: |\n   | ... and [4 more](https://codecov.io/gh/apache/arrow/pull/9526/diff?src=pr&el=tree-more) | |\n   \n   ------\n   \n   [Continue to review full report at Codecov](https://codecov.io/gh/apache/arrow/pull/9526?src=pr&el=continue).\n   > **Legend** - [Click here to learn more](https://docs.codecov.io/docs/codecov-delta)\n   > `\u0394 = absolute <relative> (impact)`, `\u00f8 = not affected`, `? = missing data`\n   > Powered by [Codecov](https://codecov.io/gh/apache/arrow/pull/9526?src=pr&el=footer). Last update [a951c6c...5c3c085](https://codecov.io/gh/apache/arrow/pull/9526?src=pr&el=lastupdated). Read the [comment docs](https://docs.codecov.io/docs/pull-request-comments).\n   \n\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2021-02-20T15:05:16.160+0000",
                    "updated": "2021-02-20T15:05:16.160+0000",
                    "started": "2021-02-20T15:05:16.160+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "555224",
                    "issueId": "13359333"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13359333/worklog/556613",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "alamb closed pull request #9526:\nURL: https://github.com/apache/arrow/pull/9526\n\n\n   \n\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n\nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2021-02-23T22:52:43.294+0000",
                    "updated": "2021-02-23T22:52:43.294+0000",
                    "started": "2021-02-23T22:52:43.294+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "556613",
                    "issueId": "13359333"
                }
            ]
        },
        "customfield_12313920": null,
        "issuetype": {
            "self": "https://issues.apache.org/jira/rest/api/2/issuetype/4",
            "id": "4",
            "description": "An improvement or enhancement to an existing feature or task.",
            "iconUrl": "https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21140&avatarType=issuetype",
            "name": "Improvement",
            "subtask": false,
            "avatarId": 21140
        },
        "timespent": 4200,
        "customfield_12314020": "{summaryBean=com.atlassian.jira.plugin.devstatus.rest.SummaryBean@2cec9f23[summary={pullrequest=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@57c40712[overall=PullRequestOverallBean{stateCount=0, state='OPEN', details=PullRequestOverallDetails{openCount=0, mergedCount=0, declinedCount=0}},byInstanceType={}], build=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@3c3b65c1[overall=com.atlassian.jira.plugin.devstatus.summary.beans.BuildOverallBean@4bb019c3[failedBuildCount=0,successfulBuildCount=0,unknownBuildCount=0,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], review=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@bf329e2[overall=com.atlassian.jira.plugin.devstatus.summary.beans.ReviewsOverallBean@4819b0d4[stateCount=0,state=<null>,dueDate=<null>,overDue=false,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], deployment-environment=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@2f6bc17b[overall=com.atlassian.jira.plugin.devstatus.summary.beans.DeploymentOverallBean@645ebb54[topEnvironments=[],showProjects=false,successfulCount=0,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], repository=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@76f03204[overall=com.atlassian.jira.plugin.devstatus.summary.beans.CommitOverallBean@73eab31e[count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], branch=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@2fbd401[overall=com.atlassian.jira.plugin.devstatus.summary.beans.BranchOverallBean@13ee5b11[count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}]},errors=[],configErrors=[]], devSummaryJson={\"cachedValue\":{\"errors\":[],\"configErrors\":[],\"summary\":{\"pullrequest\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"stateCount\":0,\"state\":\"OPEN\",\"details\":{\"openCount\":0,\"mergedCount\":0,\"declinedCount\":0,\"total\":0},\"open\":true},\"byInstanceType\":{}},\"build\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"failedBuildCount\":0,\"successfulBuildCount\":0,\"unknownBuildCount\":0},\"byInstanceType\":{}},\"review\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"stateCount\":0,\"state\":null,\"dueDate\":null,\"overDue\":false,\"completed\":false},\"byInstanceType\":{}},\"deployment-environment\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"topEnvironments\":[],\"showProjects\":false,\"successfulCount\":0},\"byInstanceType\":{}},\"repository\":{\"overall\":{\"count\":0,\"lastUpdated\":null},\"byInstanceType\":{}},\"branch\":{\"overall\":{\"count\":0,\"lastUpdated\":null},\"byInstanceType\":{}}}},\"isStale\":false}}",
        "customfield_12314141": null,
        "customfield_12314140": null,
        "project": {
            "self": "https://issues.apache.org/jira/rest/api/2/project/12319525",
            "id": "12319525",
            "key": "ARROW",
            "name": "Apache Arrow",
            "projectTypeKey": "software",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/projectavatar?pid=12319525&avatarId=10011",
                "24x24": "https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12319525&avatarId=10011",
                "16x16": "https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12319525&avatarId=10011",
                "32x32": "https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12319525&avatarId=10011"
            },
            "projectCategory": {
                "self": "https://issues.apache.org/jira/rest/api/2/projectCategory/13960",
                "id": "13960",
                "description": "Apache Arrow",
                "name": "Arrow"
            }
        },
        "aggregatetimespent": 4200,
        "customfield_12312520": null,
        "customfield_12312521": "Tue Feb 23 22:52:33 UTC 2021",
        "customfield_12314422": null,
        "customfield_12314421": null,
        "customfield_12314146": null,
        "customfield_12314420": null,
        "customfield_12314145": null,
        "customfield_12314144": null,
        "customfield_12314143": null,
        "resolutiondate": "2021-02-23T22:52:33.000+0000",
        "workratio": -1,
        "customfield_12312923": null,
        "customfield_12312920": null,
        "customfield_12312921": null,
        "watches": {
            "self": "https://issues.apache.org/jira/rest/api/2/issue/ARROW-11688/watchers",
            "watchCount": 2,
            "isWatching": false
        },
        "created": "2021-02-18T13:54:20.000+0000",
        "updated": "2021-02-23T22:52:44.000+0000",
        "timeoriginalestimate": null,
        "description": null,
        "customfield_10010": null,
        "timetracking": {
            "remainingEstimate": "0h",
            "timeSpent": "1h 10m",
            "remainingEstimateSeconds": 0,
            "timeSpentSeconds": 4200
        },
        "customfield_12314523": null,
        "customfield_12314127": null,
        "customfield_12314522": null,
        "customfield_12314126": null,
        "customfield_12314521": null,
        "customfield_12314125": null,
        "customfield_12314520": null,
        "customfield_12314124": null,
        "attachment": [],
        "customfield_12312340": null,
        "customfield_12314123": null,
        "customfield_12312341": null,
        "customfield_12312220": null,
        "customfield_12314122": null,
        "customfield_12314121": null,
        "customfield_12314120": null,
        "customfield_12314129": null,
        "customfield_12314524": null,
        "customfield_12314128": null,
        "summary": "[Rust] Casts between utf8 and large-utf8",
        "customfield_12314130": null,
        "customfield_12310291": null,
        "customfield_12310290": null,
        "customfield_12314138": null,
        "customfield_12314137": null,
        "environment": null,
        "customfield_12314136": null,
        "customfield_12314135": null,
        "customfield_12311020": null,
        "customfield_12314134": null,
        "duedate": null,
        "customfield_12314132": null,
        "customfield_12314131": null,
        "comment": {
            "comments": [
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13359333/comment/17289413",
                    "id": "17289413",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=alamb",
                        "name": "alamb",
                        "key": "alamb",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=alamb&avatarId=43364",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=alamb&avatarId=43364",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=alamb&avatarId=43364",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=alamb&avatarId=43364"
                        },
                        "displayName": "Andrew Lamb",
                        "active": true,
                        "timeZone": "America/New_York"
                    },
                    "body": "Issue resolved by pull request 9526\n[https://github.com/apache/arrow/pull/9526]",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=alamb",
                        "name": "alamb",
                        "key": "alamb",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=alamb&avatarId=43364",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=alamb&avatarId=43364",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=alamb&avatarId=43364",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=alamb&avatarId=43364"
                        },
                        "displayName": "Andrew Lamb",
                        "active": true,
                        "timeZone": "America/New_York"
                    },
                    "created": "2021-02-23T22:52:33.952+0000",
                    "updated": "2021-02-23T22:52:33.952+0000"
                }
            ],
            "maxResults": 1,
            "total": 1,
            "startAt": 0
        },
        "customfield_12311820": "0|z0nsso:",
        "customfield_12314139": null
    }
}