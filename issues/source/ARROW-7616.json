{
    "expand": "operations,versionedRepresentations,editmeta,changelog,renderedFields",
    "id": "13280525",
    "self": "https://issues.apache.org/jira/rest/api/2/issue/13280525",
    "key": "ARROW-7616",
    "fields": {
        "fixVersions": [
            {
                "self": "https://issues.apache.org/jira/rest/api/2/version/12346687",
                "id": "12346687",
                "description": "",
                "name": "0.17.0",
                "archived": false,
                "released": true,
                "releaseDate": "2020-04-20"
            }
        ],
        "resolution": {
            "self": "https://issues.apache.org/jira/rest/api/2/resolution/1",
            "id": "1",
            "description": "A fix for this issue is checked into the tree and tested.",
            "name": "Fixed"
        },
        "customfield_12312322": null,
        "customfield_12312323": null,
        "customfield_12312320": null,
        "customfield_12310420": "9223372036854775807",
        "customfield_12312321": null,
        "customfield_12312328": null,
        "customfield_12312329": null,
        "customfield_12312326": null,
        "customfield_12310300": null,
        "customfield_12312327": null,
        "customfield_12312324": null,
        "customfield_12312720": null,
        "customfield_12312325": null,
        "lastViewed": null,
        "priority": {
            "self": "https://issues.apache.org/jira/rest/api/2/priority/3",
            "iconUrl": "https://issues.apache.org/jira/images/icons/priorities/major.svg",
            "name": "Major",
            "id": "3"
        },
        "labels": [
            "pull-request-available"
        ],
        "customfield_12312333": null,
        "customfield_12312334": null,
        "customfield_12313422": "false",
        "customfield_12310310": "0.0",
        "customfield_12312331": null,
        "customfield_12312332": null,
        "aggregatetimeoriginalestimate": null,
        "timeestimate": 0,
        "customfield_12312330": null,
        "versions": [],
        "customfield_12311120": null,
        "customfield_12313826": null,
        "customfield_12312339": null,
        "issuelinks": [],
        "customfield_12313825": null,
        "assignee": {
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=fan_li_ya",
            "name": "fan_li_ya",
            "key": "fan_li_ya",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=34045",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34045",
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34045",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34045"
            },
            "displayName": "Liya Fan",
            "active": true,
            "timeZone": "Asia/Shanghai"
        },
        "customfield_12312337": null,
        "customfield_12313823": null,
        "customfield_12312338": null,
        "customfield_12311920": null,
        "customfield_12313822": null,
        "customfield_12312335": null,
        "customfield_12313821": null,
        "customfield_12312336": null,
        "customfield_12313820": null,
        "status": {
            "self": "https://issues.apache.org/jira/rest/api/2/status/5",
            "description": "A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.",
            "iconUrl": "https://issues.apache.org/jira/images/icons/statuses/resolved.png",
            "name": "Resolved",
            "id": "5",
            "statusCategory": {
                "self": "https://issues.apache.org/jira/rest/api/2/statuscategory/3",
                "id": 3,
                "key": "done",
                "colorName": "green",
                "name": "Done"
            }
        },
        "components": [
            {
                "self": "https://issues.apache.org/jira/rest/api/2/component/12328933",
                "id": "12328933",
                "name": "Java"
            }
        ],
        "customfield_12312026": null,
        "customfield_12312023": null,
        "customfield_12312024": null,
        "aggregatetimeestimate": 0,
        "customfield_12312022": null,
        "customfield_12310921": null,
        "customfield_12310920": "9223372036854775807",
        "customfield_12312823": null,
        "creator": {
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=fan_li_ya",
            "name": "fan_li_ya",
            "key": "fan_li_ya",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=34045",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34045",
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34045",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34045"
            },
            "displayName": "Liya Fan",
            "active": true,
            "timeZone": "Asia/Shanghai"
        },
        "subtasks": [],
        "reporter": {
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=fan_li_ya",
            "name": "fan_li_ya",
            "key": "fan_li_ya",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=34045",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=34045",
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=34045",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=34045"
            },
            "displayName": "Liya Fan",
            "active": true,
            "timeZone": "Asia/Shanghai"
        },
        "aggregateprogress": {
            "progress": 6000,
            "total": 6000,
            "percent": 100
        },
        "customfield_12313520": null,
        "customfield_12310250": null,
        "progress": {
            "progress": 6000,
            "total": 6000,
            "percent": 100
        },
        "customfield_12313924": null,
        "votes": {
            "self": "https://issues.apache.org/jira/rest/api/2/issue/ARROW-7616/votes",
            "votes": 0,
            "hasVoted": false
        },
        "worklog": {
            "startAt": 0,
            "maxResults": 20,
            "total": 10,
            "worklogs": [
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13280525/worklog/382170",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "liyafan82 commented on pull request #6355: ARROW-7616: [Java] Support comparing value ranges for dense union vector\nURL: https://github.com/apache/arrow/pull/6355\n \n \n   After we support dense union vectors, we should support range value comparisons for them.\n \n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2020-02-05T09:52:08.883+0000",
                    "updated": "2020-02-05T09:52:08.883+0000",
                    "started": "2020-02-05T09:52:08.883+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "382170",
                    "issueId": "13280525"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13280525/worklog/382173",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "github-actions[bot] commented on issue #6355: ARROW-7616: [Java] Support comparing value ranges for dense union vector\nURL: https://github.com/apache/arrow/pull/6355#issuecomment-582331396\n \n \n   https://issues.apache.org/jira/browse/ARROW-7616\n \n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2020-02-05T10:03:13.789+0000",
                    "updated": "2020-02-05T10:03:13.789+0000",
                    "started": "2020-02-05T10:03:13.788+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "382173",
                    "issueId": "13280525"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13280525/worklog/388657",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "emkornfield commented on issue #6355: ARROW-7616: [Java] Support comparing value ranges for dense union vector\nURL: https://github.com/apache/arrow/pull/6355#issuecomment-587274641\n \n \n   @TheNeuralBit do you have time to review?\n \n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2020-02-18T04:38:25.470+0000",
                    "updated": "2020-02-18T04:38:25.470+0000",
                    "started": "2020-02-18T04:38:25.469+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "388657",
                    "issueId": "13280525"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13280525/worklog/391206",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "TheNeuralBit commented on pull request #6355: ARROW-7616: [Java] Support comparing value ranges for dense union vector\nURL: https://github.com/apache/arrow/pull/6355#discussion_r382931447\n \n \n\n ##########\n File path: java/vector/src/main/codegen/templates/DenseUnionVector.java\n ##########\n @@ -512,12 +518,15 @@ public void reset() {\n \n   @Override\n   public Field getField() {\n-    List<org.apache.arrow.vector.types.pojo.Field> childFields = new ArrayList<>();\n-    List<FieldVector> children = internalStruct.getChildren();\n-    int[] typeIds = new int[children.size()];\n-    for (ValueVector v : children) {\n-      typeIds[childFields.size()] = v.getMinorType().ordinal();\n-      childFields.add(v.getField());\n+    int childCount = (int) Arrays.stream(typeFields).filter(field -> field != null).count();\n+    List<org.apache.arrow.vector.types.pojo.Field> childFields = new ArrayList<>(childCount);\n+    int[] typeIds = new int[childCount];\n+    for (int i = 0; i < typeFields.length; i++) {\n+      if (typeFields[i] != null) {\n+        int curIdx = childFields.size();\n+        typeIds[curIdx] = i;\n+        childFields.add(typeFields[i]);\n+      }\n \n Review comment:\n   Could you explain the motivation for this change? I'm not really following why it's necessary to add support for comparing value ranges?\n \n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2020-02-22T18:23:46.723+0000",
                    "updated": "2020-02-22T18:23:46.723+0000",
                    "started": "2020-02-22T18:23:46.722+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "391206",
                    "issueId": "13280525"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13280525/worklog/391485",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "liyafan82 commented on pull request #6355: ARROW-7616: [Java] Support comparing value ranges for dense union vector\nURL: https://github.com/apache/arrow/pull/6355#discussion_r383071097\n \n \n\n ##########\n File path: java/vector/src/main/codegen/templates/DenseUnionVector.java\n ##########\n @@ -512,12 +518,15 @@ public void reset() {\n \n   @Override\n   public Field getField() {\n-    List<org.apache.arrow.vector.types.pojo.Field> childFields = new ArrayList<>();\n-    List<FieldVector> children = internalStruct.getChildren();\n-    int[] typeIds = new int[children.size()];\n-    for (ValueVector v : children) {\n-      typeIds[childFields.size()] = v.getMinorType().ordinal();\n-      childFields.add(v.getField());\n+    int childCount = (int) Arrays.stream(typeFields).filter(field -> field != null).count();\n+    List<org.apache.arrow.vector.types.pojo.Field> childFields = new ArrayList<>(childCount);\n+    int[] typeIds = new int[childCount];\n+    for (int i = 0; i < typeFields.length; i++) {\n+      if (typeFields[i] != null) {\n+        int curIdx = childFields.size();\n+        typeIds[curIdx] = i;\n+        childFields.add(typeFields[i]);\n+      }\n \n Review comment:\n   @TheNeuralBit Thanks a lot for your feedback.\r\n   \r\n   Motivation for comparing value ranges:\r\n   For each type of vector, we need a way to compare individual elements/contiguous range of elements. This is implemented in class RangeEqualsVisitor, with each overload method processing one type of vectors.\r\n   \r\n   Recently, we have introduced a new vector type: DenseUnionVector, so we need to add a new overload to support it. \r\n   \r\n   Motivation for this change:\r\n   \r\n   The old implementation of this method mimics that of class UnionVector, as they are both union vectors, and share many similarities. When implementating this PR, we found this implementation caused some problems. So we fix it now.\r\n   \r\n   The fundamental reason is that the type ids are defined differently for union and dense union vectors. For union vectors, the type id is the ordinal of the minor type of the child vector; whereas for dense union vectors, the type id is an incremental tiny int allocated by the vector when registering a child vector. \r\n   \r\n   When comparing vector elements, we need to compare their fields first, and the fields include child vector ids (type ids), so we need to change this method. \r\n   \r\n   If there are any other problems, please feel free to contact us. Thanks a lot. \n \n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2020-02-24T03:00:52.916+0000",
                    "updated": "2020-02-24T03:00:52.916+0000",
                    "started": "2020-02-24T03:00:52.916+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "391485",
                    "issueId": "13280525"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13280525/worklog/399217",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "TheNeuralBit commented on pull request #6355: ARROW-7616: [Java] Support comparing value ranges for dense union vector\nURL: https://github.com/apache/arrow/pull/6355#discussion_r389012521\n \n \n\n ##########\n File path: java/vector/src/main/codegen/templates/DenseUnionVector.java\n ##########\n @@ -512,12 +518,15 @@ public void reset() {\n \n   @Override\n   public Field getField() {\n-    List<org.apache.arrow.vector.types.pojo.Field> childFields = new ArrayList<>();\n-    List<FieldVector> children = internalStruct.getChildren();\n-    int[] typeIds = new int[children.size()];\n-    for (ValueVector v : children) {\n-      typeIds[childFields.size()] = v.getMinorType().ordinal();\n-      childFields.add(v.getField());\n+    int childCount = (int) Arrays.stream(typeFields).filter(field -> field != null).count();\n+    List<org.apache.arrow.vector.types.pojo.Field> childFields = new ArrayList<>(childCount);\n+    int[] typeIds = new int[childCount];\n+    for (int i = 0; i < typeFields.length; i++) {\n+      if (typeFields[i] != null) {\n+        int curIdx = childFields.size();\n+        typeIds[curIdx] = i;\n+        childFields.add(typeFields[i]);\n+      }\n \n Review comment:\n   > The fundamental reason is that the type ids are defined differently for union and dense union vectors.\r\n   \r\n   But why is there this difference? I don't actually see anything in the [specification](http://arrow.apache.org/docs/format/Columnar.html#union-layout) about a difference between type ids for sparse vs. dense unions. To me it looks like this PR is creating that difference.\r\n   \r\n   It just seems like an unrelated change that's been pulled into this PR. An answer to this question would help me understand: Could you add support for comparing value ranges _without_ this change to type ids? If not, why not?\r\n   \r\n   \n \n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2020-03-06T16:41:01.610+0000",
                    "updated": "2020-03-06T16:41:01.610+0000",
                    "started": "2020-03-06T16:41:01.610+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "399217",
                    "issueId": "13280525"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13280525/worklog/399532",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "liyafan82 commented on pull request #6355: ARROW-7616: [Java] Support comparing value ranges for dense union vector\nURL: https://github.com/apache/arrow/pull/6355#discussion_r389225409\n \n \n\n ##########\n File path: java/vector/src/main/codegen/templates/DenseUnionVector.java\n ##########\n @@ -512,12 +518,15 @@ public void reset() {\n \n   @Override\n   public Field getField() {\n-    List<org.apache.arrow.vector.types.pojo.Field> childFields = new ArrayList<>();\n-    List<FieldVector> children = internalStruct.getChildren();\n-    int[] typeIds = new int[children.size()];\n-    for (ValueVector v : children) {\n-      typeIds[childFields.size()] = v.getMinorType().ordinal();\n-      childFields.add(v.getField());\n+    int childCount = (int) Arrays.stream(typeFields).filter(field -> field != null).count();\n+    List<org.apache.arrow.vector.types.pojo.Field> childFields = new ArrayList<>(childCount);\n+    int[] typeIds = new int[childCount];\n+    for (int i = 0; i < typeFields.length; i++) {\n+      if (typeFields[i] != null) {\n+        int curIdx = childFields.size();\n+        typeIds[curIdx] = i;\n+        childFields.add(typeFields[i]);\n+      }\n \n Review comment:\n   @TheNeuralBit Good question.\r\n   \r\n   You are right, as the difference is not mentioned in the specification. \r\n   \r\n   For Java, the dense union is aligning with the specification, while the sparse union is not. The dense union was implemented only recently, while the sparse union was implemented long ago. So it is not easy to fix the layout of sparse union, for the sake of backward compatibility. \r\n   \r\n   So it is the implementation of dense union that started introducing the difference, and this change makes the difference complete. I am afraid it is difficult to remove the difference, at least in the near future. \n \n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2020-03-07T03:58:34.759+0000",
                    "updated": "2020-03-07T03:58:34.759+0000",
                    "started": "2020-03-07T03:58:34.758+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "399532",
                    "issueId": "13280525"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13280525/worklog/401877",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "TheNeuralBit commented on pull request #6355: ARROW-7616: [Java] Support comparing value ranges for dense union vector\nURL: https://github.com/apache/arrow/pull/6355#discussion_r391339380\n \n \n\n ##########\n File path: java/vector/src/main/codegen/templates/DenseUnionVector.java\n ##########\n @@ -512,12 +518,15 @@ public void reset() {\n \n   @Override\n   public Field getField() {\n-    List<org.apache.arrow.vector.types.pojo.Field> childFields = new ArrayList<>();\n-    List<FieldVector> children = internalStruct.getChildren();\n-    int[] typeIds = new int[children.size()];\n-    for (ValueVector v : children) {\n-      typeIds[childFields.size()] = v.getMinorType().ordinal();\n-      childFields.add(v.getField());\n+    int childCount = (int) Arrays.stream(typeFields).filter(field -> field != null).count();\n+    List<org.apache.arrow.vector.types.pojo.Field> childFields = new ArrayList<>(childCount);\n+    int[] typeIds = new int[childCount];\n+    for (int i = 0; i < typeFields.length; i++) {\n+      if (typeFields[i] != null) {\n+        int curIdx = childFields.size();\n+        typeIds[curIdx] = i;\n+        childFields.add(typeFields[i]);\n+      }\n \n Review comment:\n   Understood, thanks for the explanation\n \n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2020-03-12T00:13:44.275+0000",
                    "updated": "2020-03-12T00:13:44.275+0000",
                    "started": "2020-03-12T00:13:44.275+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "401877",
                    "issueId": "13280525"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13280525/worklog/402019",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "liyafan82 commented on issue #6355: ARROW-7616: [Java] Support comparing value ranges for dense union vector\nURL: https://github.com/apache/arrow/pull/6355#issuecomment-598055652\n \n \n   > LGTM. Thanks for the contribution and for your patience :)\r\n   \r\n   Thanks a lot for your effort.\n \n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2020-03-12T08:01:34.537+0000",
                    "updated": "2020-03-12T08:01:34.537+0000",
                    "started": "2020-03-12T08:01:34.537+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "402019",
                    "issueId": "13280525"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13280525/worklog/404407",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "comment": "TheNeuralBit commented on pull request #6355: ARROW-7616: [Java] Support comparing value ranges for dense union vector\nURL: https://github.com/apache/arrow/pull/6355\n \n \n   \n \n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on to GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "created": "2020-03-17T02:33:09.872+0000",
                    "updated": "2020-03-17T02:33:09.872+0000",
                    "started": "2020-03-17T02:33:09.872+0000",
                    "timeSpent": "10m",
                    "timeSpentSeconds": 600,
                    "id": "404407",
                    "issueId": "13280525"
                }
            ]
        },
        "customfield_12313920": null,
        "issuetype": {
            "self": "https://issues.apache.org/jira/rest/api/2/issuetype/2",
            "id": "2",
            "description": "A new feature of the product, which has yet to be developed.",
            "iconUrl": "https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21141&avatarType=issuetype",
            "name": "New Feature",
            "subtask": false,
            "avatarId": 21141
        },
        "timespent": 6000,
        "customfield_12314020": "{summaryBean=com.atlassian.jira.plugin.devstatus.rest.SummaryBean@802d2d1[summary={pullrequest=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@5674d00b[overall=PullRequestOverallBean{stateCount=0, state='OPEN', details=PullRequestOverallDetails{openCount=0, mergedCount=0, declinedCount=0}},byInstanceType={}], build=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@68046614[overall=com.atlassian.jira.plugin.devstatus.summary.beans.BuildOverallBean@18000797[failedBuildCount=0,successfulBuildCount=0,unknownBuildCount=0,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], review=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@380f79ce[overall=com.atlassian.jira.plugin.devstatus.summary.beans.ReviewsOverallBean@3bb09447[stateCount=0,state=<null>,dueDate=<null>,overDue=false,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], deployment-environment=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@704f61e3[overall=com.atlassian.jira.plugin.devstatus.summary.beans.DeploymentOverallBean@686bfcc2[topEnvironments=[],showProjects=false,successfulCount=0,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], repository=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@2b692908[overall=com.atlassian.jira.plugin.devstatus.summary.beans.CommitOverallBean@14c4928e[count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], branch=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@1f0fb98c[overall=com.atlassian.jira.plugin.devstatus.summary.beans.BranchOverallBean@2835db43[count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}]},errors=[],configErrors=[]], devSummaryJson={\"cachedValue\":{\"errors\":[],\"configErrors\":[],\"summary\":{\"pullrequest\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"stateCount\":0,\"state\":\"OPEN\",\"details\":{\"openCount\":0,\"mergedCount\":0,\"declinedCount\":0,\"total\":0},\"open\":true},\"byInstanceType\":{}},\"build\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"failedBuildCount\":0,\"successfulBuildCount\":0,\"unknownBuildCount\":0},\"byInstanceType\":{}},\"review\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"stateCount\":0,\"state\":null,\"dueDate\":null,\"overDue\":false,\"completed\":false},\"byInstanceType\":{}},\"deployment-environment\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"topEnvironments\":[],\"showProjects\":false,\"successfulCount\":0},\"byInstanceType\":{}},\"repository\":{\"overall\":{\"count\":0,\"lastUpdated\":null},\"byInstanceType\":{}},\"branch\":{\"overall\":{\"count\":0,\"lastUpdated\":null},\"byInstanceType\":{}}}},\"isStale\":false}}",
        "customfield_12314141": null,
        "customfield_12314140": null,
        "project": {
            "self": "https://issues.apache.org/jira/rest/api/2/project/12319525",
            "id": "12319525",
            "key": "ARROW",
            "name": "Apache Arrow",
            "projectTypeKey": "software",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/projectavatar?pid=12319525&avatarId=10011",
                "24x24": "https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12319525&avatarId=10011",
                "16x16": "https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12319525&avatarId=10011",
                "32x32": "https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12319525&avatarId=10011"
            },
            "projectCategory": {
                "self": "https://issues.apache.org/jira/rest/api/2/projectCategory/13960",
                "id": "13960",
                "description": "Apache Arrow",
                "name": "Arrow"
            }
        },
        "aggregatetimespent": 6000,
        "customfield_12312520": null,
        "customfield_12312521": "Tue Mar 17 02:33:13 UTC 2020",
        "customfield_12314422": null,
        "customfield_12314421": null,
        "customfield_12314146": null,
        "customfield_12314420": null,
        "customfield_12314145": null,
        "customfield_12314144": null,
        "customfield_12314143": null,
        "resolutiondate": "2020-03-17T02:33:12.000+0000",
        "workratio": -1,
        "customfield_12312923": null,
        "customfield_12312920": null,
        "customfield_12312921": null,
        "watches": {
            "self": "https://issues.apache.org/jira/rest/api/2/issue/ARROW-7616/watchers",
            "watchCount": 1,
            "isWatching": false
        },
        "created": "2020-01-20T10:52:36.000+0000",
        "updated": "2020-03-17T02:33:13.000+0000",
        "timeoriginalestimate": null,
        "description": "After we support dense union vectors, we should support range value comparisons for them.",
        "customfield_10010": null,
        "timetracking": {
            "remainingEstimate": "0h",
            "timeSpent": "1h 40m",
            "remainingEstimateSeconds": 0,
            "timeSpentSeconds": 6000
        },
        "customfield_12314523": null,
        "customfield_12314127": null,
        "customfield_12314522": null,
        "customfield_12314126": null,
        "customfield_12314521": null,
        "customfield_12314125": null,
        "customfield_12314520": null,
        "customfield_12314124": null,
        "attachment": [],
        "customfield_12312340": null,
        "customfield_12314123": null,
        "customfield_12312341": null,
        "customfield_12312220": null,
        "customfield_12314122": null,
        "customfield_12314121": null,
        "customfield_12314120": null,
        "customfield_12314129": null,
        "customfield_12314524": null,
        "customfield_12314128": null,
        "summary": "[Java] Support comparing value ranges for dense union vector",
        "customfield_12314130": null,
        "customfield_12310291": null,
        "customfield_12310290": null,
        "customfield_12314138": null,
        "customfield_12314137": null,
        "environment": null,
        "customfield_12314136": null,
        "customfield_12314135": null,
        "customfield_12311020": null,
        "customfield_12314134": null,
        "duedate": null,
        "customfield_12314132": null,
        "customfield_12314131": null,
        "comment": {
            "comments": [
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13280525/comment/17060587",
                    "id": "17060587",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=bhulette",
                        "name": "bhulette",
                        "key": "bhulette",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "Brian Hulette",
                        "active": true,
                        "timeZone": "America/Vancouver"
                    },
                    "body": "Issue resolved by pull request 6355\n[https://github.com/apache/arrow/pull/6355]",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=bhulette",
                        "name": "bhulette",
                        "key": "bhulette",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "Brian Hulette",
                        "active": true,
                        "timeZone": "America/Vancouver"
                    },
                    "created": "2020-03-17T02:33:13.000+0000",
                    "updated": "2020-03-17T02:33:13.000+0000"
                }
            ],
            "maxResults": 1,
            "total": 1,
            "startAt": 0
        },
        "customfield_12311820": "0|z0aoog:",
        "customfield_12314139": null
    }
}