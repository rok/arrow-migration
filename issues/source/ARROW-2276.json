{
    "expand": "operations,versionedRepresentations,editmeta,changelog,renderedFields",
    "id": "13142893",
    "self": "https://issues.apache.org/jira/rest/api/2/issue/13142893",
    "key": "ARROW-2276",
    "fields": {
        "fixVersions": [
            {
                "self": "https://issues.apache.org/jira/rest/api/2/version/12342562",
                "id": "12342562",
                "description": "",
                "name": "0.10.0",
                "archived": false,
                "released": true,
                "releaseDate": "2018-08-06"
            }
        ],
        "resolution": {
            "self": "https://issues.apache.org/jira/rest/api/2/resolution/1",
            "id": "1",
            "description": "A fix for this issue is checked into the tree and tested.",
            "name": "Fixed"
        },
        "customfield_12312322": null,
        "customfield_12312323": null,
        "customfield_12312320": null,
        "customfield_12310420": "9223372036854775807",
        "customfield_12312321": null,
        "customfield_12312328": null,
        "customfield_12312329": null,
        "customfield_12312326": null,
        "customfield_12310300": null,
        "customfield_12312327": null,
        "customfield_12312324": null,
        "customfield_12312720": null,
        "customfield_12312325": null,
        "lastViewed": null,
        "priority": {
            "self": "https://issues.apache.org/jira/rest/api/2/priority/3",
            "iconUrl": "https://issues.apache.org/jira/images/icons/priorities/major.svg",
            "name": "Major",
            "id": "3"
        },
        "labels": [
            "pull-request-available"
        ],
        "customfield_12312333": null,
        "customfield_12312334": null,
        "customfield_12313422": "false",
        "customfield_12310310": "0.0",
        "customfield_12312331": null,
        "customfield_12312332": null,
        "aggregatetimeoriginalestimate": null,
        "timeestimate": null,
        "customfield_12312330": null,
        "versions": [
            {
                "self": "https://issues.apache.org/jira/rest/api/2/version/12341352",
                "id": "12341352",
                "name": "0.8.0",
                "archived": false,
                "released": true,
                "releaseDate": "2017-12-18"
            }
        ],
        "customfield_12311120": null,
        "customfield_12313826": null,
        "customfield_12312339": null,
        "issuelinks": [],
        "customfield_12313825": null,
        "assignee": {
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=apitrou",
            "name": "apitrou",
            "key": "pitrou",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=pitrou&avatarId=35049",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=pitrou&avatarId=35049",
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=pitrou&avatarId=35049",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=pitrou&avatarId=35049"
            },
            "displayName": "Antoine Pitrou",
            "active": true,
            "timeZone": "Europe/Paris"
        },
        "customfield_12312337": null,
        "customfield_12313823": null,
        "customfield_12312338": null,
        "customfield_12311920": null,
        "customfield_12313822": null,
        "customfield_12312335": null,
        "customfield_12313821": null,
        "customfield_12312336": null,
        "customfield_12313820": null,
        "status": {
            "self": "https://issues.apache.org/jira/rest/api/2/status/5",
            "description": "A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.",
            "iconUrl": "https://issues.apache.org/jira/images/icons/statuses/resolved.png",
            "name": "Resolved",
            "id": "5",
            "statusCategory": {
                "self": "https://issues.apache.org/jira/rest/api/2/statuscategory/3",
                "id": 3,
                "key": "done",
                "colorName": "green",
                "name": "Done"
            }
        },
        "components": [
            {
                "self": "https://issues.apache.org/jira/rest/api/2/component/12328936",
                "id": "12328936",
                "name": "Python"
            }
        ],
        "customfield_12312026": null,
        "customfield_12312023": null,
        "customfield_12312024": null,
        "aggregatetimeestimate": null,
        "customfield_12312022": null,
        "customfield_12310921": null,
        "customfield_12310920": "9223372036854775807",
        "customfield_12312823": null,
        "creator": {
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=apitrou",
            "name": "apitrou",
            "key": "pitrou",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=pitrou&avatarId=35049",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=pitrou&avatarId=35049",
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=pitrou&avatarId=35049",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=pitrou&avatarId=35049"
            },
            "displayName": "Antoine Pitrou",
            "active": true,
            "timeZone": "Europe/Paris"
        },
        "subtasks": [],
        "reporter": {
            "self": "https://issues.apache.org/jira/rest/api/2/user?username=apitrou",
            "name": "apitrou",
            "key": "pitrou",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=pitrou&avatarId=35049",
                "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=pitrou&avatarId=35049",
                "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=pitrou&avatarId=35049",
                "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=pitrou&avatarId=35049"
            },
            "displayName": "Antoine Pitrou",
            "active": true,
            "timeZone": "Europe/Paris"
        },
        "aggregateprogress": {
            "progress": 0,
            "total": 0
        },
        "customfield_12313520": null,
        "customfield_12310250": null,
        "progress": {
            "progress": 0,
            "total": 0
        },
        "customfield_12313924": null,
        "votes": {
            "self": "https://issues.apache.org/jira/rest/api/2/issue/ARROW-2276/votes",
            "votes": 0,
            "hasVoted": false
        },
        "worklog": {
            "startAt": 0,
            "maxResults": 20,
            "total": 0,
            "worklogs": []
        },
        "customfield_12313920": null,
        "issuetype": {
            "self": "https://issues.apache.org/jira/rest/api/2/issuetype/4",
            "id": "4",
            "description": "An improvement or enhancement to an existing feature or task.",
            "iconUrl": "https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21140&avatarType=issuetype",
            "name": "Improvement",
            "subtask": false,
            "avatarId": 21140
        },
        "timespent": null,
        "customfield_12314020": "{summaryBean=com.atlassian.jira.plugin.devstatus.rest.SummaryBean@66d9bad7[summary={pullrequest=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@399acffc[overall=PullRequestOverallBean{stateCount=0, state='OPEN', details=PullRequestOverallDetails{openCount=0, mergedCount=0, declinedCount=0}},byInstanceType={}], build=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@4fc7b4db[overall=com.atlassian.jira.plugin.devstatus.summary.beans.BuildOverallBean@204d77f0[failedBuildCount=0,successfulBuildCount=0,unknownBuildCount=0,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], review=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@1ed6ca6e[overall=com.atlassian.jira.plugin.devstatus.summary.beans.ReviewsOverallBean@67603383[stateCount=0,state=<null>,dueDate=<null>,overDue=false,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], deployment-environment=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@157322d8[overall=com.atlassian.jira.plugin.devstatus.summary.beans.DeploymentOverallBean@5eca3571[topEnvironments=[],showProjects=false,successfulCount=0,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], repository=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@76e7117c[overall=com.atlassian.jira.plugin.devstatus.summary.beans.CommitOverallBean@10fdc808[count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], branch=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@1c945d2d[overall=com.atlassian.jira.plugin.devstatus.summary.beans.BranchOverallBean@137a9273[count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}]},errors=[],configErrors=[]], devSummaryJson={\"cachedValue\":{\"errors\":[],\"configErrors\":[],\"summary\":{\"pullrequest\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"stateCount\":0,\"state\":\"OPEN\",\"details\":{\"openCount\":0,\"mergedCount\":0,\"declinedCount\":0,\"total\":0},\"open\":true},\"byInstanceType\":{}},\"build\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"failedBuildCount\":0,\"successfulBuildCount\":0,\"unknownBuildCount\":0},\"byInstanceType\":{}},\"review\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"stateCount\":0,\"state\":null,\"dueDate\":null,\"overDue\":false,\"completed\":false},\"byInstanceType\":{}},\"deployment-environment\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"topEnvironments\":[],\"showProjects\":false,\"successfulCount\":0},\"byInstanceType\":{}},\"repository\":{\"overall\":{\"count\":0,\"lastUpdated\":null},\"byInstanceType\":{}},\"branch\":{\"overall\":{\"count\":0,\"lastUpdated\":null},\"byInstanceType\":{}}}},\"isStale\":false}}",
        "customfield_12314141": null,
        "customfield_12314140": null,
        "project": {
            "self": "https://issues.apache.org/jira/rest/api/2/project/12319525",
            "id": "12319525",
            "key": "ARROW",
            "name": "Apache Arrow",
            "projectTypeKey": "software",
            "avatarUrls": {
                "48x48": "https://issues.apache.org/jira/secure/projectavatar?pid=12319525&avatarId=10011",
                "24x24": "https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12319525&avatarId=10011",
                "16x16": "https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12319525&avatarId=10011",
                "32x32": "https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12319525&avatarId=10011"
            },
            "projectCategory": {
                "self": "https://issues.apache.org/jira/rest/api/2/projectCategory/13960",
                "id": "13960",
                "description": "Apache Arrow",
                "name": "Arrow"
            }
        },
        "aggregatetimespent": null,
        "customfield_12312520": null,
        "customfield_12312521": "Wed Apr 04 19:55:56 UTC 2018",
        "customfield_12314422": null,
        "customfield_12314421": null,
        "customfield_12314146": null,
        "customfield_12314420": null,
        "customfield_12314145": null,
        "customfield_12314144": null,
        "customfield_12314143": null,
        "resolutiondate": "2018-04-04T19:55:23.000+0000",
        "workratio": -1,
        "customfield_12312923": null,
        "customfield_12312920": null,
        "customfield_12312921": null,
        "watches": {
            "self": "https://issues.apache.org/jira/rest/api/2/issue/ARROW-2276/watchers",
            "watchCount": 2,
            "isWatching": false
        },
        "created": "2018-03-06T15:47:04.000+0000",
        "updated": "2018-04-04T19:56:04.000+0000",
        "timeoriginalestimate": null,
        "description": "Tensors have an underlying buffer, a data type, shape and strides. It seems like they could implement the Python buffer protocol.",
        "customfield_10010": null,
        "timetracking": {},
        "customfield_12314523": null,
        "customfield_12314127": null,
        "customfield_12314522": null,
        "customfield_12314126": null,
        "customfield_12314521": null,
        "customfield_12314125": null,
        "customfield_12314520": null,
        "customfield_12314124": null,
        "attachment": [],
        "customfield_12312340": null,
        "customfield_12314123": null,
        "customfield_12312341": null,
        "customfield_12312220": null,
        "customfield_12314122": null,
        "customfield_12314121": null,
        "customfield_12314120": null,
        "customfield_12314129": null,
        "customfield_12314524": null,
        "customfield_12314128": null,
        "summary": "[Python] Tensor could implement the buffer protocol",
        "customfield_12314130": null,
        "customfield_12310291": null,
        "customfield_12310290": null,
        "customfield_12314138": null,
        "customfield_12314137": null,
        "environment": null,
        "customfield_12314136": null,
        "customfield_12314135": null,
        "customfield_12311020": null,
        "customfield_12314134": null,
        "duedate": null,
        "customfield_12314132": null,
        "customfield_12314131": null,
        "comment": {
            "comments": [
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13142893/comment/16397259",
                    "id": "16397259",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "body": "pitrou opened a new pull request #1741: ARROW-2276: [Python] Expose buffer protocol on Tensor\nURL: https://github.com/apache/arrow/pull/1741\n \n \n   Also add a bit_width property to the DataType class.\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "created": "2018-03-13T16:59:23.445+0000",
                    "updated": "2018-03-13T16:59:23.445+0000"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13142893/comment/16426041",
                    "id": "16426041",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "body": "pitrou commented on issue #1741: ARROW-2276: [Python] Expose buffer protocol on Tensor\nURL: https://github.com/apache/arrow/pull/1741#issuecomment-378714922\n \n \n   AppVeyor at https://ci.appveyor.com/project/pitrou/arrow/build/1.0.262\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "created": "2018-04-04T19:18:56.608+0000",
                    "updated": "2018-04-04T19:18:56.608+0000"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13142893/comment/16426088",
                    "id": "16426088",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "body": "pitrou closed pull request #1741: ARROW-2276: [Python] Expose buffer protocol on Tensor\nURL: https://github.com/apache/arrow/pull/1741\n \n \n   \n\nThis is a PR merged from a forked repository.\nAs GitHub hides the original diff on merge, it is displayed below for\nthe sake of provenance:\n\nAs this is a foreign pull request (from a fork), the diff is supplied\nbelow (as it won't show otherwise due to GitHub magic):\n\ndiff --git a/python/pyarrow/array.pxi b/python/pyarrow/array.pxi\nindex a67bd8b62..490a37b0f 100644\n--- a/python/pyarrow/array.pxi\n+++ b/python/pyarrow/array.pxi\n@@ -651,6 +651,30 @@ strides: {0.strides}\"\"\".format(self)\n         self._validate()\n         return tuple(self.tp.strides())\n \n+    def __getbuffer__(self, cp.Py_buffer* buffer, int flags):\n+        self._validate()\n+\n+        buffer.buf = <char *> self.tp.data().get().data()\n+        pep3118_format = self.type.pep3118_format\n+        if pep3118_format is None:\n+            raise NotImplementedError(\"type %s not supported for buffer \"\n+                                      \"protocol\" % (self.type,))\n+        buffer.format = pep3118_format\n+        buffer.itemsize = self.type.bit_width // 8\n+        buffer.internal = NULL\n+        buffer.len = self.tp.size() * buffer.itemsize\n+        buffer.ndim = self.tp.ndim()\n+        buffer.obj = self\n+        if self.tp.is_mutable():\n+            buffer.readonly = 0\n+        else:\n+            buffer.readonly = 1\n+        # NOTE: This assumes Py_ssize_t == int64_t, and that the shape\n+        # and strides arrays lifetime is tied to the tensor's\n+        buffer.shape = <Py_ssize_t *> &self.tp.shape()[0]\n+        buffer.strides = <Py_ssize_t *> &self.tp.strides()[0]\n+        buffer.suboffsets = NULL\n+\n \n cdef wrap_array_output(PyObject* output):\n     cdef object obj = PyObject_to_object(output)\ndiff --git a/python/pyarrow/lib.pxd b/python/pyarrow/lib.pxd\nindex 4c24b486f..6f4100fd0 100644\n--- a/python/pyarrow/lib.pxd\n+++ b/python/pyarrow/lib.pxd\n@@ -20,6 +20,8 @@ from pyarrow.includes.libarrow cimport *\n from pyarrow.includes.libarrow cimport CStatus\n from cpython cimport PyObject\n from libcpp cimport nullptr\n+from libcpp.cast cimport dynamic_cast\n+\n \n cdef extern from \"Python.h\":\n     int PySlice_Check(object)\n@@ -42,6 +44,7 @@ cdef class DataType:\n     cdef:\n         shared_ptr[CDataType] sp_type\n         CDataType* type\n+        bytes pep3118_format\n \n     cdef void init(self, const shared_ptr[CDataType]& type)\n \ndiff --git a/python/pyarrow/tests/test_tensor.py b/python/pyarrow/tests/test_tensor.py\nindex 093bc86c3..188a4a5e1 100644\n--- a/python/pyarrow/tests/test_tensor.py\n+++ b/python/pyarrow/tests/test_tensor.py\n@@ -165,3 +165,30 @@ def test_read_tensor(tmpdir):\n     read_mmap = pa.memory_map(path, mode='r')\n     array = pa.read_tensor(read_mmap).to_numpy()\n     np.testing.assert_equal(data, array)\n+\n+\n+@pytest.mark.skipif(sys.version_info < (3,),\n+                    reason=\"requires Python 3+\")\n+def test_tensor_memoryview():\n+    # Tensors support the PEP 3118 buffer protocol\n+    for dtype, expected_format in [(np.int8, '=b'),\n+                                   (np.int64, '=q'),\n+                                   (np.uint64, '=Q'),\n+                                   (np.float16, 'e'),\n+                                   (np.float64, 'd'),\n+                                   ]:\n+        data = np.arange(10, dtype=dtype)\n+        dtype = data.dtype\n+        lst = data.tolist()\n+        tensor = pa.Tensor.from_numpy(data)\n+        m = memoryview(tensor)\n+        assert m.format == expected_format\n+        assert m.shape == data.shape\n+        assert m.strides == data.strides\n+        assert m.ndim == 1\n+        assert m.nbytes == data.nbytes\n+        assert m.itemsize == data.itemsize\n+        assert m.itemsize * 8 == tensor.type.bit_width\n+        assert np.frombuffer(m, dtype).tolist() == lst\n+        del tensor, data\n+        assert np.frombuffer(m, dtype).tolist() == lst\ndiff --git a/python/pyarrow/tests/test_types.py b/python/pyarrow/tests/test_types.py\nindex b5170203c..50573591f 100644\n--- a/python/pyarrow/tests/test_types.py\n+++ b/python/pyarrow/tests/test_types.py\n@@ -230,6 +230,19 @@ def test_exact_primitive_types(t, check_func):\n     assert check_func(t)\n \n \n+def test_bit_width():\n+    for ty, expected in [(pa.bool_(), 1),\n+                         (pa.int8(), 8),\n+                         (pa.uint32(), 32),\n+                         (pa.float16(), 16),\n+                         (pa.decimal128(19, 4), 128),\n+                         (pa.binary(42), 42 * 8)]:\n+        assert ty.bit_width == expected\n+    for ty in [pa.binary(), pa.string(), pa.list_(pa.int16())]:\n+        with pytest.raises(ValueError, match=\"fixed width\"):\n+            ty.bit_width\n+\n+\n def test_fixed_size_binary_byte_width():\n     ty = pa.binary(5)\n     assert ty.byte_width == 5\ndiff --git a/python/pyarrow/types.pxi b/python/pyarrow/types.pxi\nindex 2abdb30a3..cb3a72d8d 100644\n--- a/python/pyarrow/types.pxi\n+++ b/python/pyarrow/types.pxi\n@@ -43,6 +43,42 @@ cdef dict _pandas_type_map = {\n     _Type_DECIMAL: np.object_,\n }\n \n+cdef dict _pep3118_type_map = {\n+    _Type_INT8: b'b',\n+    _Type_INT16: b'h',\n+    _Type_INT32: b'i',\n+    _Type_INT64: b'q',\n+    _Type_UINT8: b'B',\n+    _Type_UINT16: b'H',\n+    _Type_UINT32: b'I',\n+    _Type_UINT64: b'Q',\n+    _Type_HALF_FLOAT: b'e',\n+    _Type_FLOAT: b'f',\n+    _Type_DOUBLE: b'd',\n+}\n+\n+\n+cdef bytes _datatype_to_pep3118(CDataType* type):\n+    \"\"\"\n+    Construct a PEP 3118 format string describing the given datatype.\n+    None is returned for unsupported types.\n+    \"\"\"\n+    try:\n+        char = _pep3118_type_map[type.id()]\n+    except KeyError:\n+        return None\n+    else:\n+        if char in b'bBhHiIqQ':\n+            # Use \"standard\" int widths, not native\n+            return b'=' + char\n+        else:\n+            return char\n+\n+\n+# Workaround for Cython parsing bug\n+# https://github.com/cython/cython/issues/2143\n+ctypedef CFixedWidthType* _CFixedWidthTypePtr\n+\n \n cdef class DataType:\n     \"\"\"\n@@ -54,12 +90,22 @@ cdef class DataType:\n     cdef void init(self, const shared_ptr[CDataType]& type):\n         self.sp_type = type\n         self.type = type.get()\n+        self.pep3118_format = _datatype_to_pep3118(self.type)\n \n     property id:\n \n         def __get__(self):\n             return self.type.id()\n \n+    property bit_width:\n+\n+        def __get__(self):\n+            cdef _CFixedWidthTypePtr ty\n+            ty = dynamic_cast[_CFixedWidthTypePtr](self.type)\n+            if ty == nullptr:\n+                raise ValueError(\"Non-fixed width type\")\n+            return ty.bit_width()\n+\n     def __str__(self):\n         if self.type is NULL:\n             raise TypeError(\n\n\n \n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "created": "2018-04-04T19:54:59.851+0000",
                    "updated": "2018-04-04T19:54:59.851+0000"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13142893/comment/16426090",
                    "id": "16426090",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=apitrou",
                        "name": "apitrou",
                        "key": "pitrou",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=pitrou&avatarId=35049",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=pitrou&avatarId=35049",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=pitrou&avatarId=35049",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=pitrou&avatarId=35049"
                        },
                        "displayName": "Antoine Pitrou",
                        "active": true,
                        "timeZone": "Europe/Paris"
                    },
                    "body": "Issue resolved by pull request 1741\n[https://github.com/apache/arrow/pull/1741]",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=apitrou",
                        "name": "apitrou",
                        "key": "pitrou",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?ownerId=pitrou&avatarId=35049",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=pitrou&avatarId=35049",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=pitrou&avatarId=35049",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=pitrou&avatarId=35049"
                        },
                        "displayName": "Antoine Pitrou",
                        "active": true,
                        "timeZone": "Europe/Paris"
                    },
                    "created": "2018-04-04T19:55:23.233+0000",
                    "updated": "2018-04-04T19:55:23.233+0000"
                },
                {
                    "self": "https://issues.apache.org/jira/rest/api/2/issue/13142893/comment/16426092",
                    "id": "16426092",
                    "author": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "body": "pitrou commented on issue #1741: ARROW-2276: [Python] Expose buffer protocol on Tensor\nURL: https://github.com/apache/arrow/pull/1741#issuecomment-378725279\n \n \n   Thanks for the review, @xhochy !\n\n----------------------------------------------------------------\nThis is an automated message from the Apache Git Service.\nTo respond to the message, please log on GitHub and use the\nURL above to go to the specific comment.\n \nFor queries about this service, please contact Infrastructure at:\nusers@infra.apache.org\n",
                    "updateAuthor": {
                        "self": "https://issues.apache.org/jira/rest/api/2/user?username=githubbot",
                        "name": "githubbot",
                        "key": "githubbot",
                        "avatarUrls": {
                            "48x48": "https://issues.apache.org/jira/secure/useravatar?avatarId=10452",
                            "24x24": "https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452",
                            "16x16": "https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452",
                            "32x32": "https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"
                        },
                        "displayName": "ASF GitHub Bot",
                        "active": true,
                        "timeZone": "Etc/UTC"
                    },
                    "created": "2018-04-04T19:55:56.054+0000",
                    "updated": "2018-04-04T19:55:56.054+0000"
                }
            ],
            "maxResults": 5,
            "total": 5,
            "startAt": 0
        },
        "customfield_12311820": "0|i3qxk7:",
        "customfield_12314139": null
    }
}