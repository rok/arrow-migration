{
    "issue": {
        "title": "OSError: Invalid IPC stream: negative continuation token",
        "body": "***Note**: This issue was originally created as [ARROW-12733](https://issues.apache.org/jira/browse/ARROW-12733). Please see the [migration documentation](https://gist.github.com/toddfarmer/12aa88361532d21902818a6044fda4c3) for further details.*\n\n### Original Issue Description:\npyarrow 4.0.0\r\n\r\n\u00a0\r\n```java\n\r\n\u00a0\r\nFile \"/home/ftdb/anaconda3/lib/python3.8/site-packages/pandas/io/feather_format.py\", line 127, in read_feather\r\n 84 def read_feather(\r\n 85 path, columns=None, use_threads: bool = True, storage_options: StorageOptions = None\r\n 86 ):\r\n (...)\r\n 123 with get_handle(\r\n 124 path, \"rb\", storage_options=storage_options, is_text=False\r\n 125 ) as handles:\r\n 126 \r\n--> 127 return feather.read_feather(\r\n 128 handles.handle, columns=columns, use_threads=bool(use_threads)\r\n ..................................................\r\n path = PosixPath('/home/ftdb/data/jobs1.feather.011')\r\n columns = None\r\n use_threads = True\r\n storage_options = None\r\n StorageOptions = typing.Union[typing.Dict[str, typing.Any], NoneType]\r\n handles = IOHandles(handle=<_io.BufferedReader name='/home/ftdb/data/j\r\n obs1.feather.011'>, compression={'method': None}, created_ha\r\n ndles=[], is_wrapped=False, is_mmap=False)\r\n feather.read_feather = <function 'read_feather' feather.py:195>\r\n handles.handle = <_io.BufferedReader name='/home/ftdb/data/jobs1.feather.011'\r\n >\r\n ..................................................\r\nFile \"/home/ftdb/anaconda3/lib/python3.8/site-packages/pyarrow/feather.py\", line 216, in read_feather\r\n 195 def read_feather(source, columns=None, use_threads=True, memory_map=True):\r\n (...)\r\n 212 -------\r\n 213 df : pandas.DataFrame\r\n 214 \"\"\"\r\n 215 _check_pandas_version()\r\n--> 216 return (read_table(source, columns=columns, memory_map=memory_map)\r\n 217 .to_pandas(use_threads=use_threads))\r\n ..................................................\r\n source = <_io.BufferedReader name='/home/ftdb/data/jobs1.feather.011'\r\n >\r\n columns = None\r\n use_threads = True\r\n memory_map = True\r\n ..................................................\r\nFile \"/home/ftdb/anaconda3/lib/python3.8/site-packages/pyarrow/feather.py\", line 241, in read_table\r\n 220 def read_table(source, columns=None, memory_map=True):\r\n (...)\r\n 237 reader = ext.FeatherReader()\r\n 238 reader.open(source, use_memory_map=memory_map)\r\n 239 \r\n 240 if columns is None:\r\n--> 241 return reader.read()\r\n 242 \r\n ..................................................\r\n source = <_io.BufferedReader name='/home/ftdb/data/jobs1.feather.011'\r\n >\r\n columns = None\r\n memory_map = True\r\n reader = <pyarrow.lib.FeatherReader object at 0x7f5f0afc2180>\r\n ext.FeatherReader = <class 'pyarrow.lib.FeatherReader'>\r\n ..................................................\r\nFile \"pyarrow/feather.pxi\", line 76, in pyarrow.lib.FeatherReader.read\r\nFile \"pyarrow/error.pxi\", line 112, in pyarrow.lib.check_status\r\n---- (full traceback above) ----\r\nFile \"/home/ftdb/anaconda3/lib/python3.8/site-packages/IPython/core/interactiveshell.py\", line 3437, in run_code\r\n exec(code_obj, self.user_global_ns, self.user_ns)\r\nFile \"<ipython-input-4-a3c2240634fd>\", line 1, in <module>\r\n df = read_feather(p)\r\nFile \"/storage/code/fintechdb/Ftools/ftools/functoolz.py\", line 22, in inner\r\n return func(*args, **kwargs)\r\nFile \"/storage/code/fintechdb/Ftools/ftools/pathtools.py\", line 51, in inner\r\n return func(**new_kwargs)\r\nFile \"/storage/code/fintechdb/Ftools/ftools/io.py\", line 506, in read_feather\r\n data = pd.read_feather(path, columns, use_threads=True)\r\nFile \"/home/ftdb/anaconda3/lib/python3.8/site-packages/pandas/io/feather_format.py\", line 127, in read_feather\r\n return feather.read_feather(\r\nFile \"/home/ftdb/anaconda3/lib/python3.8/site-packages/pyarrow/feather.py\", line 216, in read_feather\r\n return (read_table(source, columns=columns, memory_map=memory_map)\r\nFile \"/home/ftdb/anaconda3/lib/python3.8/site-packages/pyarrow/feather.py\", line 241, in read_table\r\n return reader.read()\r\nFile \"pyarrow/feather.pxi\", line 76, in pyarrow.lib.FeatherReader.read\r\nFile \"pyarrow/error.pxi\", line 112, in pyarrow.lib.check_status\r\nOSError: Invalid IPC stream: negative continuation token\r\n```\r\n\u00a0",
        "created_at": "2021-05-11T06:42:02.000Z",
        "updated_at": "2021-05-11T11:22:29.000Z",
        "labels": [
            "Migrated from Jira",
            "Component: Python",
            "Type: bug"
        ],
        "closed": false
    },
    "comments": [
        {
            "created_at": "2021-05-11T08:45:16.431Z",
            "body": "***Note**: [Comment](https://issues.apache.org/jira/browse/ARROW-12733?focusedCommentId=17342419) by Antoine Pitrou (apitrou):*\nHi `[~tsoernes]` , can you explain how you encountered this error? Can you post the file you're trying to read somewhere, and/or can you explain how it was generated?"
        },
        {
            "created_at": "2021-05-11T09:32:30.222Z",
            "body": "***Note**: [Comment](https://issues.apache.org/jira/browse/ARROW-12733?focusedCommentId=17342452) by Joris Van den Bossche (jorisvandenbossche):*\nHi `[~tsoernes]`, can you provide some more information, and ideally a reproducible example?  \r\n(eg was the feather file written with the same version of pyarrow or with a previous one? And if a previous one, which version? Did you use compression? What kind of data does the file contain? Could you provide a small script that generates a feather file that reproduces the issue?)\r\n\r\nEDIT: whoops, sorry for the duplicate comment asking for more information. JIRA isn't very good at refreshing / indicating there are newer comments if the tab was already open ..."
        },
        {
            "created_at": "2021-05-11T10:20:11.572Z",
            "body": "***Note**: [Comment](https://issues.apache.org/jira/browse/ARROW-12733?focusedCommentId=17342470) by Torstein S\u00f8rnes (tsoernes):*\n`[~jorisvandenbossche]` `[~apitrou]`\r\n\r\nThe file is compressed with lz4. It is a Pandas dataframe. The code for writing it, is:\r\n```java\n\r\ndf.to_feather(path, compression='lz4')\n```\r\nwhere df is a pandas dataframe.\r\n\r\nThe file was written with the same version of pyarrow and pandas, as it is trying to being read.\r\n\r\nI have written, and read, successfully, hundreds of pandas dataframe arrow files using exactly the same code, and library versions. I have no idea why this in particular, fails.\r\n\r\nThe file is too big to upload here. Does this link work?\r\n\r\n<https://ml-pull.s3.eu-central-1.amazonaws.com/Jobs/glassdoor/jobs1.feather.011>\r\n\r\nCheers, and thanks for you work."
        },
        {
            "created_at": "2021-05-11T10:25:51.436Z",
            "body": "***Note**: [Comment](https://issues.apache.org/jira/browse/ARROW-12733?focusedCommentId=17342473) by Antoine Pitrou (apitrou):*\nThank you, I'll take a look."
        },
        {
            "created_at": "2021-05-11T11:22:29.184Z",
            "body": "***Note**: [Comment](https://issues.apache.org/jira/browse/ARROW-12733?focusedCommentId=17342491) by Antoine Pitrou (apitrou):*\n`[~tsoernes]` It seems the file is invalid indeed. Have you tried recreating it from the exact same data?"
        }
    ]
}