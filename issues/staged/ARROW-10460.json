{
    "issue": {
        "title": "[FlightRPC][Python] FlightRPC authentication mechanism changed and is undocumented, breaking current working code",
        "body": "***Note**: This issue was originally created as [ARROW-10460](https://issues.apache.org/jira/browse/ARROW-10460). Please see the [migration documentation](https://gist.github.com/toddfarmer/12aa88361532d21902818a6044fda4c3) for further details.*\n\n### Original Issue Description:\nAuthentication with FlightClient changed from version 1.0.1 to 2.0.0 and is undocumented.\u00a0\r\n\r\n\u00a0\r\n\r\n`>>> from pyarrow import ___version___`\r\n\r\n`>> print(`_`_version`_`_)`\r\n\r\n`'1.0.1'`\r\n\r\n`>>> from handlers import ApiKeyClientAuthHandler\u00a0 # custom handler`}}\r\n `>>> from pyarrow.flight import FlightClient`\r\n `>>> client = FlightClient(location=\"grpc+tcp://xxxxxxxxxx.com\")`\r\n `>>> client.authenticate(ApiKeyClientAuthHandler(api_key=\"xxxxx\"))`\r\n\r\n`>>>`\r\n\r\n\u00a0\r\n\r\nAnd the exact same code in 2.0.0 breaks\r\n\r\n\u00a0\r\n\r\n`>>> from pyarrow import ___version___`\r\n\r\n`>> print(`_`_version`_`_)`\r\n\r\n`'2.0.0'`\r\n\r\n`>>> from handlers import ApiKeyClientAuthHandler\u00a0 # custom handler`}}\r\n `>>> from pyarrow.flight import FlightClient`\r\n `>>> client = FlightClient(location=\"grpc+tcp://xxxxxxxxxx.com\")`\r\n `>>> client.authenticate(ApiKeyClientAuthHandler(api_key=\"xxxxx\"))`\r\n\r\n`Traceback (most recent call last):`\r\n `\u00a0 \u00a0File \"scratch.py\", line 15, in <module>`\r\n `\u00a0 \u00a0 \u00a0client.authenticate(ApiKeyClientAuthHandler(api_key=\"xxxxxxxxxx\"))`\r\n `\u00a0 \u00a0File \"pyarrow/_flight.pyx\", line 1149, in pyarrow._flight.FlightClient.authenticate`\r\n `\u00a0 \u00a0File \"pyarrow/_flight.pyx\", line 70, in pyarrow._flight.check_flight_status`\r\n `pyarrow._flight.FlightUnavailableError: gRPC returned unavailable error, with message: failed to connect to all addresses`\r\n\r\n\u00a0\r\n\r\nWhat happened?\r\n\r\n\u00a0",
        "created_at": "2020-11-02T12:23:37.000Z",
        "updated_at": "2022-07-01T15:57:46.000Z",
        "labels": [
            "Migrated from Jira",
            "Component: FlightRPC",
            "Component: Python",
            "Type: bug"
        ],
        "closed": true,
        "closed_at": "2022-07-01T15:57:46.000Z"
    },
    "comments": [
        {
            "created_at": "2020-11-02T16:20:32.839Z",
            "body": "***Note**: [Comment](https://issues.apache.org/jira/browse/ARROW-10460?focusedCommentId=17224783) by David Li (lidavidm):*\n`[~carlomazzaferro]` how is the server implemented (C++/Python/Java)?\r\n\r\nCan you run the client with these env vars to debug what's happening? `env GRPC_VERBOSITY=debug GRPC_TRACE=channel,http python ...`"
        },
        {
            "created_at": "2020-11-02T16:42:00.724Z",
            "body": "***Note**: [Comment](https://issues.apache.org/jira/browse/ARROW-10460?focusedCommentId=17224794) by Carlo Mazzaferro (carlomazzaferro):*\nIt's a python server running behind a Traefik ingress controller (using h2c server scheme), server runs on 5005. For some obscure reason, with version 2.0.0 I am able to fix the issue by adding port `443` to the location, which wasn't needed with version 1.0.1. FWIW, here's the trace log without the port added, v2.0.0\r\n\r\n\u00a0\r\n\r\n\u00a0\r\n\r\n`D1102 17:41:42.069247000 4477541824 ev_posix.cc:174] Using polling engine: poll`\r\n `D1102 17:41:42.069323000 4477541824 lb_policy_registry.cc:38] registering LB policy factory for \"grpclb\"`\r\n `D1102 17:41:42.069333000 4477541824 lb_policy_registry.cc:38] registering LB policy factory for \"cds_experimental\"`\r\n `D1102 17:41:42.069338000 4477541824 lb_policy_registry.cc:38] registering LB policy factory for \"eds_experimental\"`\r\n `D1102 17:41:42.069344000 4477541824 lb_policy_registry.cc:38] registering LB policy factory for \"lrs_experimental\"`\r\n `D1102 17:41:42.069349000 4477541824 lb_policy_registry.cc:38] registering LB policy factory for \"priority_experimental\"`\r\n `D1102 17:41:42.069353000 4477541824 lb_policy_registry.cc:38] registering LB policy factory for \"weighted_target_experimental\"`\r\n `D1102 17:41:42.069360000 4477541824 lb_policy_registry.cc:38] registering LB policy factory for \"xds_routing_experimental\"`\r\n `D1102 17:41:42.069366000 4477541824 lb_policy_registry.cc:38] registering LB policy factory for \"pick_first\"`\r\n `D1102 17:41:42.069370000 4477541824 lb_policy_registry.cc:38] registering LB policy factory for \"round_robin\"`\r\n `D1102 17:41:42.069470000 4477541824 dns_resolver_ares.cc:503] Using ares dns resolver`\r\n `I1102 17:41:42.069753000 4477541824 call.cc:626] OP[client-channel:0x7fd4bd0e69c0]: SEND_INITIAL_METADATA{key=3a 70 61 74 68 ':path' value=2f 61 72 72 6f 77 2e 66 6c 69 67 68 74 2e 70 72 6f 74 6f 63 6f 6c 2e 46 6c 69 67 68 74 53 65 72 76 69 63 65 2f 48 61 6e 64 73 68 61 6b 65 '/arrow.flight.protocol.FlightService/Handshake'`}\r\n `I1102 17:41:42.077093000 4477541824 subchannel.cc:1003] Connect failed: {\"created\":\"@1604335302.077058000\",\"description\":\"Can't assign requested address\",\"errno\":49,\"file\":\"/Users/travis/build/ursa-labs/crossbow/arrow/cpp/build/grpc_ep-prefix/src/grpc_ep/src/core/lib/iomgr/tcp_client_posix.cc\",\"file_line\":307,\"os_error\":\"Can't assign requested address\",\"syscall\":\"connect\"`}\r\n `I1102 17:41:42.077219000 4477541824 subchannel.cc:1003] Connect failed: {\"created\":\"@1604335302.077197000\",\"description\":\"Can't assign requested address\",\"errno\":49,\"file\":\"/Users/travis/build/ursa-labs/crossbow/arrow/cpp/build/grpc_ep-prefix/src/grpc_ep/src/core/lib/iomgr/tcp_client_posix.cc\",\"file_line\":307,\"os_error\":\"Can't assign requested address\",\"syscall\":\"connect\"`}\r\n `I1102 17:41:42.077320000 4477541824 subchannel.cc:1003] Connect failed: {\"created\":\"@1604335302.077298000\",\"description\":\"Can't assign requested address\",\"errno\":49,\"file\":\"/Users/travis/build/ursa-labs/crossbow/arrow/cpp/build/grpc_ep-prefix/src/grpc_ep/src/core/lib/iomgr/tcp_client_posix.cc\",\"file_line\":307,\"os_error\":\"Can't assign requested address\",\"syscall\":\"connect\"`}\r\n `I1102 17:41:42.077354000 4477541824 subchannel.cc:942] Subchannel 0x7fd4c2a108e0: Retry in 100 milliseconds`\r\n {{I1102 17:41:42.077434000 4477541824 call.cc:626] OP[client-channel:0x7fd4bd0e69c0]: CANCEL:{\"created\":\"@1604335302.077349000\",\"description\":\"Failed to pick subchannel\",\"file\":\"/Users/travis/build/ursa-labs/crossbow/arrow/cpp/build/grpc_ep-prefix/src/grpc_ep/src/core/ext/filters/client_channel/client_channel.cc\",\"file_line\":3962,\"referenced_errors\":[\r\n\r\n{\"created\":\"@1604335302.077347000\",\"description\":\"failed to connect to all addresses\",\"file\":\"/Users/travis/build/ursa-labs/crossbow/arrow/cpp/build/grpc_ep-prefix/src/grpc_ep/src/core/ext/filters/client_channel/lb_policy/pick_first/pick_first.cc\",\"file_line\":394,\"grpc_status\":14}\r\n\r\n]}}}\r\n `I1102 17:41:42.077811000 4477541824 call.cc:626] OP[client-channel:0x7fd4bd0e69c0]: SEND_MESSAGE:flags=0x00000000:len=38`\r\n `I1102 17:41:42.077839000 4477541824 call.cc:626] OP[client-channel:0x7fd4bd0e69c0]: RECV_INITIAL_METADATA RECV_TRAILING_METADATA`\r\n `Traceback (most recent call last):`\r\n \\` File \"scratch.py\", line 32, in <module>`\r\n \\` ApiKeyClientAuthHandler(api_key=\"xxxxxxxxxxxxxxxx\"),`\r\n \\` File \"pyarrow/_flight.pyx\", line 1149, in pyarrow._flight.FlightClient.authenticate`\r\n \\` File \"pyarrow/_flight.pyx\", line 70, in pyarrow._flight.check_flight_status`\r\n `pyarrow._flight.FlightUnavailableError: gRPC returned unavailable error, with message: failed to connect to all addresses`"
        },
        {
            "created_at": "2020-11-02T22:47:29.581Z",
            "body": "***Note**: [Comment](https://issues.apache.org/jira/browse/ARROW-10460?focusedCommentId=17225002) by David Li (lidavidm):*\nHmm, if you never specified a port, I'm surprised it ever worked - unlike typical HTTP usage, gRPC doesn't have any well-defined/standard ports (i.e. 80/443 is not assumed).\r\n\r\nFWIW, I just tried this myself with PyArrow 1.0.1 and port 443 without specifying a port and I also get \"failed to connect to all addresses\"."
        },
        {
            "created_at": "2022-07-01T15:57:46.102Z",
            "body": "***Note**: [Comment](https://issues.apache.org/jira/browse/ARROW-10460?focusedCommentId=17561513) by David Li (lidavidm):*\nI'm going to close this, since this appears to be gRPC behavior/not specifying a port was not meant to be supported."
        }
    ]
}