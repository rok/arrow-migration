{
    "issue": {
        "title": "Unable to use `red-arrow` gem on Heroku/Ubuntu 20.04 (focal)",
        "body": "***Note**: This issue was originally created as [ARROW-14076](https://issues.apache.org/jira/browse/ARROW-14076). Please see the [migration documentation](https://gist.github.com/toddfarmer/12aa88361532d21902818a6044fda4c3) for further details.*\n\n### Original Issue Description:\n\u00a0\r\n\r\nHello,\r\n\r\n\u00a0\r\n\r\nI am not able to get the Ruby gems, `red-arrow` and `red-parquet`, to work properly on Heroku.\u00a0 Heroku itself is merely an Ubuntu 20.04 LTS (focal) container so this really is a question about what dependencies must be installed to get these gems to work on Focal?\r\n\r\nSo far I have specified the following in Heroku's `Aptfile`:\u00a0\r\n```java\n\r\n# Get Heroku's Ubuntu distro for your Stack.  Heroku-20 = focal\r\n# Running bash on \u2b22 <app_name>... up, run.1471 (Hobby)\r\n# ~ $ lsb_release --codename --short\r\n\r\n:repo:deb [trusted=yes arch=amd64] https://apache.jfrog.io/artifactory/arrow/ubuntu/ focal mainlibarrow-dev\r\n\r\nlibparquet-dev\r\nlibarrow-glib-dev\r\nlibparquet-glib-dev\r\nlibgirepository-1.0-1\r\nlibgirepository1.0-dev\r\nlibglib2.0-dev\r\nlibglib2.0-0\r\ngir1.2-glib-2.0\r\ngobject-introspection\r\n```\r\nNote: the above contains additional packages that were required by `red-arrow` that WERE NOT SPECIFIED in the Installation guide at\u00a0[https://arrow.apache.org/install/.](https://arrow.apache.org/install/)\r\n\r\nDespite all my efforts, I am unable to solve this issue:\r\n```java\n\r\n2021-09-21T23:05:11.469561+00:00 heroku[worker.1]: Process exited with status 1\r\n2021-09-21T23:05:11.263179+00:00 app[worker.1]: bundler: failed to load command: sidekiq (/app/vendor/bundle/ruby/2.7.0/bin/sidekiq)\r\n2021-09-21T23:05:11.263465+00:00 app[worker.1]: /app/vendor/bundle/ruby/2.7.0/gems/zeitwerk-2.4.2/lib/zeitwerk/kernel.rb:34:in `require': /tmp/build_29fd2902/vendor/bundle/ruby/2.7.0/gems/extpp-0.0.9/ext/extpp/libruby-extpp.so: cannot open shared object file: No such file or directory - /app/vendor/bundle/ruby/2.7.0/gems/red-arrow-4.0.0/lib/arrow.so (LoadError)\r\n2021-09-21T23:05:11.263508+00:00 app[worker.1]: from /app/vendor/bundle/ruby/2.7.0/gems/zeitwerk-2.4.2/lib/zeitwerk/kernel.rb:34:in `require'\r\n2021-09-21T23:05:11.263521+00:00 app[worker.1]: from /app/vendor/bundle/ruby/2.7.0/gems/red-arrow-4.0.0/lib/arrow/loader.rb:112:in `require_extension_library'\r\n2021-09-21T23:05:11.263532+00:00 app[worker.1]: from /app/vendor/bundle/ruby/2.7.0/gems/red-arrow-4.0.0/lib/arrow/loader.rb:31:in `post_load'\r\n2021-09-21T23:05:11.263544+00:00 app[worker.1]: from /app/vendor/bundle/ruby/2.7.0/gems/gobject-introspection-3.4.4/lib/gobject-introspection/loader.rb:45:in `load'\r\n2021-09-21T23:05:11.263565+00:00 app[worker.1]: from /app/vendor/bundle/ruby/2.7.0/gems/gobject-introspection-3.4.4/lib/gobject-introspection/loader.rb:25:in `load'\r\n```\r\n\u00a0What is super frustrating is that the directory, `/app/vendor/bundle/ruby/2.7.0/gems/red-arrow-4.0.0/lib`, is specified in `LD_LIBRARY_PATH`, so I'm not sure why it's not being found.\r\n\r\n**_Any help determining the full list of dependent packages for Ubuntu 20.04 (focal) would be greatly appreciated._**\u00a0\u00a0\r\n\r\n\u00a0\r\n\r\n**Extra environment details:**\r\n\r\n\u00a0\r\n\r\nRuby 2.7.4 on Ubuntu 20.04/Heroku\r\n\r\n\u00a0\r\n\r\n**Relevant gem versions:**\r\n\r\nred-arrow (4.0.0)\r\n\r\nred-parquet (4.0.0)\r\n\r\ngio2 (3.4.4)\r\n\r\ngobject-introspection (3.4.4)\r\n\r\n\u00a0\r\n\r\n\u00a0\r\n\r\n\u00a0",
        "created_at": "2021-09-22T16:21:23.000Z",
        "updated_at": "2021-10-05T01:32:52.000Z",
        "labels": [
            "Migrated from Jira",
            "Component: Ruby",
            "Type: bug"
        ],
        "closed": true,
        "closed_at": "2021-10-05T01:32:52.000Z"
    },
    "comments": [
        {
            "created_at": "2021-09-22T21:14:46.861Z",
            "body": "***Note**: [Comment](https://issues.apache.org/jira/browse/ARROW-14076?focusedCommentId=17418834) by Kouhei Sutou (kou):*\nCould you also add `/app/vendor/bundle/ruby/2.7.0/gems/extpp-0.0.9/lib` to `LD_LIBRARY_PATH`?"
        },
        {
            "created_at": "2021-09-28T18:31:36.970Z",
            "body": "***Note**: [Comment](https://issues.apache.org/jira/browse/ARROW-14076?focusedCommentId=17421601) by Daniel Rice (danielricecodes):*\nI will try that."
        },
        {
            "created_at": "2021-09-28T18:39:36.400Z",
            "body": "***Note**: [Comment](https://issues.apache.org/jira/browse/ARROW-14076?focusedCommentId=17421607) by Daniel Rice (danielricecodes):*\nI'm still having the same issue.\u00a0 Here's some more environmental information from `heroku run bash`:\r\n\r\n\u00a0\r\n```\n\r\nRunning *bash* on \u2b22\u00a0\u00a0... up, run.6036 (Hobby)\r\n\r\n*~* *$* echo $LD_LIBRARY_PATH\r\n\r\n/app/.apt/usr/lib/x86_64-linux-gnu:/app/.apt/usr/lib/i386-linux-gnu:/app/.apt/usr/lib:/app/vendor/bundle/ruby/2.7.0/gems/extpp-0.0.9/lib:/app/vendor/bundle/ruby/2.7.0/gems/red-arrow-4.0.0/lib\r\n\r\n*~* *$* ls -al /app/vendor/bundle/ruby/2.7.0/gems/red-arrow-4.0.0/lib\r\n\r\ntotal 972\r\n\r\ndrwx------ 3 u7677 dyno \u00a0 4096 Sep 21 18:40 .\r\n\r\ndrwx------ 7 u7677 dyno \u00a0 4096 Sep 21 18:40 ..\r\n\r\ndrwx------ 2 u7677 dyno \u00a0 4096 Sep 21 18:40 arrow\r\n\r\n-rw------- 1 u7677 dyno\u00a0 \u00a0 941 Sep 21 18:40 arrow.rb\r\n\r\n-rwx------ 1 u7677 dyno 976336 Sep 21 18:40 arrow.so\r\n\r\n*~* *$* ls -al /app/vendor/bundle/ruby/2.7.0/gems/extpp-0.0.9/lib\r\n\r\ntotal 192\r\n\r\ndrwx------ 3 u7677 dyno \u00a0 4096 Sep 21 18:35 .\r\n\r\ndrwx------ 8 u7677 dyno \u00a0 4096 Sep 21 18:35 ..\r\n\r\ndrwx------ 2 u7677 dyno \u00a0 4096 Sep 21 18:35 extpp\r\n\r\n-rw------- 1 u7677 dyno \u00a0 1049 Sep 21 18:35 extpp.rb\r\n\r\n-rwx------ 1 u7677 dyno 177576 Sep 21 18:35 libruby-extpp.so\r\n\r\n*~* *$*\r\n```"
        },
        {
            "created_at": "2021-09-28T21:19:13.881Z",
            "body": "***Note**: [Comment](https://issues.apache.org/jira/browse/ARROW-14076?focusedCommentId=17421793) by Kouhei Sutou (kou):*\nCould you show the output of `ldd /app/vendor/bundle/ruby/2.7.0/gems/red-arrow-4.0.0/lib/arrow.so`?"
        },
        {
            "created_at": "2021-09-28T21:51:01.188Z",
            "body": "***Note**: [Comment](https://issues.apache.org/jira/browse/ARROW-14076?focusedCommentId=17421804) by Daniel Rice (danielricecodes):*\n\u00a0\r\n```java\n\r\n~ $ ldd /app/vendor/bundle/ruby/2.7.0/gems/red-arrow-4.0.0/lib/arrow.so \r\n\tlinux-vdso.so.1 (0x00007fffbcd6f000)\r\n\tlibruby.so.2.7 => not found\r\n\tlibarrow.so.500 => /app/.apt/usr/lib/x86_64-linux-gnu/libarrow.so.500 (0x00007f8fd7389000)\r\n\tlibarrow-glib.so.500 => /app/.apt/usr/lib/x86_64-linux-gnu/libarrow-glib.so.500 (0x00007f8fd7243000)\r\n\tlibgobject-2.0.so.0 => /app/.apt/usr/lib/x86_64-linux-gnu/libgobject-2.0.so.0 (0x00007f8fd71e3000)\r\n\t/tmp/build_29fd2902/vendor/bundle/ruby/2.7.0/gems/extpp-0.0.9/ext/extpp/libruby-extpp.so => not found\r\n\tlibstdc++.so.6 => /lib/x86_64-linux-gnu/libstdc++.so.6 (0x00007f8fd6fff000)\r\n\tlibc.so.6 => /lib/x86_64-linux-gnu/libc.so.6 (0x00007f8fd6e0d000)\r\n\tlibgcc_s.so.1 => /lib/x86_64-linux-gnu/libgcc_s.so.1 (0x00007f8fd6df2000)\r\n\tlibbrotlienc.so.1 => /lib/x86_64-linux-gnu/libbrotlienc.so.1 (0x00007f8fd6d69000)\r\n\tlibbrotlidec.so.1 => /lib/x86_64-linux-gnu/libbrotlidec.so.1 (0x00007f8fd6d5b000)\r\n\tlibutf8proc.so.2 => /app/.apt/usr/lib/x86_64-linux-gnu/libutf8proc.so.2 (0x00007f8fd6d0c000)\r\n\tlibre2.so.5 => /app/.apt/usr/lib/x86_64-linux-gnu/libre2.so.5 (0x00007f8fd6c9b000)\r\n\tlibdl.so.2 => /lib/x86_64-linux-gnu/libdl.so.2 (0x00007f8fd6c95000)\r\n\tlibcrypto.so.1.1 => /lib/x86_64-linux-gnu/libcrypto.so.1.1 (0x00007f8fd69bf000)\r\n\tlibbz2.so.1.0 => /lib/x86_64-linux-gnu/libbz2.so.1.0 (0x00007f8fd69ac000)\r\n\tliblz4.so.1 => /lib/x86_64-linux-gnu/liblz4.so.1 (0x00007f8fd698b000)\r\n\tlibsnappy.so.1 => /app/.apt/usr/lib/x86_64-linux-gnu/libsnappy.so.1 (0x00007f8fd697e000)\r\n\tlibz.so.1 => /lib/x86_64-linux-gnu/libz.so.1 (0x00007f8fd6962000)\r\n\tlibzstd.so.1 => /lib/x86_64-linux-gnu/libzstd.so.1 (0x00007f8fd68b9000)\r\n\tlibcurl.so.4 => /lib/x86_64-linux-gnu/libcurl.so.4 (0x00007f8fd6828000)\r\n\tlibm.so.6 => /lib/x86_64-linux-gnu/libm.so.6 (0x00007f8fd66d9000)\r\n\tlibpthread.so.0 => /lib/x86_64-linux-gnu/libpthread.so.0 (0x00007f8fd66b6000)\r\n\t/lib64/ld-linux-x86-64.so.2 (0x00007f8fd8a68000)\r\n\tlibglib-2.0.so.0 => /app/.apt/usr/lib/x86_64-linux-gnu/libglib-2.0.so.0 (0x00007f8fd658b000)\r\n\tlibgio-2.0.so.0 => /app/.apt/usr/lib/x86_64-linux-gnu/libgio-2.0.so.0 (0x00007f8fd63aa000)\r\n\tlibffi.so.7 => /lib/x86_64-linux-gnu/libffi.so.7 (0x00007f8fd639e000)\r\n\tlibbrotlicommon.so.1 => /lib/x86_64-linux-gnu/libbrotlicommon.so.1 (0x00007f8fd637b000)\r\n\tlibnghttp2.so.14 => /lib/x86_64-linux-gnu/libnghttp2.so.14 (0x00007f8fd6352000)\r\n\tlibidn2.so.0 => /lib/x86_64-linux-gnu/libidn2.so.0 (0x00007f8fd632f000)\r\n\tlibrtmp.so.1 => /lib/x86_64-linux-gnu/librtmp.so.1 (0x00007f8fd630f000)\r\n\tlibssh.so.4 => /lib/x86_64-linux-gnu/libssh.so.4 (0x00007f8fd62a1000)\r\n\tlibpsl.so.5 => /lib/x86_64-linux-gnu/libpsl.so.5 (0x00007f8fd628e000)\r\n\tlibssl.so.1.1 => /lib/x86_64-linux-gnu/libssl.so.1.1 (0x00007f8fd61fb000)\r\n\tlibgssapi_krb5.so.2 => /lib/x86_64-linux-gnu/libgssapi_krb5.so.2 (0x00007f8fd61ae000)\r\n\tlibldap_r-2.4.so.2 => /lib/x86_64-linux-gnu/libldap_r-2.4.so.2 (0x00007f8fd6156000)\r\n\tliblber-2.4.so.2 => /lib/x86_64-linux-gnu/liblber-2.4.so.2 (0x00007f8fd6145000)\r\n\tlibpcre.so.3 => /lib/x86_64-linux-gnu/libpcre.so.3 (0x00007f8fd60d2000)\r\n\tlibgmodule-2.0.so.0 => /app/.apt/usr/lib/x86_64-linux-gnu/libgmodule-2.0.so.0 (0x00007f8fd60cc000)\r\n\tlibmount.so.1 => /lib/x86_64-linux-gnu/libmount.so.1 (0x00007f8fd606c000)\r\n\tlibselinux.so.1 => /lib/x86_64-linux-gnu/libselinux.so.1 (0x00007f8fd603f000)\r\n\tlibresolv.so.2 => /lib/x86_64-linux-gnu/libresolv.so.2 (0x00007f8fd6023000)\r\n\tlibunistring.so.2 => /lib/x86_64-linux-gnu/libunistring.so.2 (0x00007f8fd5ea1000)\r\n\tlibgnutls.so.30 => /lib/x86_64-linux-gnu/libgnutls.so.30 (0x00007f8fd5ccb000)\r\n\tlibhogweed.so.5 => /lib/x86_64-linux-gnu/libhogweed.so.5 (0x00007f8fd5c94000)\r\n\tlibnettle.so.7 => /lib/x86_64-linux-gnu/libnettle.so.7 (0x00007f8fd5c5a000)\r\n\tlibgmp.so.10 => /lib/x86_64-linux-gnu/libgmp.so.10 (0x00007f8fd5bd4000)\r\n\tlibkrb5.so.3 => /lib/x86_64-linux-gnu/libkrb5.so.3 (0x00007f8fd5af7000)\r\n\tlibk5crypto.so.3 => /lib/x86_64-linux-gnu/libk5crypto.so.3 (0x00007f8fd5ac6000)\r\n\tlibcom_err.so.2 => /lib/x86_64-linux-gnu/libcom_err.so.2 (0x00007f8fd5abf000)\r\n\tlibkrb5support.so.0 => /lib/x86_64-linux-gnu/libkrb5support.so.0 (0x00007f8fd5ab0000)\r\n\tlibsasl2.so.2 => /lib/x86_64-linux-gnu/libsasl2.so.2 (0x00007f8fd5a91000)\r\n\tlibgssapi.so.3 => /lib/x86_64-linux-gnu/libgssapi.so.3 (0x00007f8fd5a4c000)\r\n\tlibblkid.so.1 => /lib/x86_64-linux-gnu/libblkid.so.1 (0x00007f8fd59f5000)\r\n\tlibpcre2-8.so.0 => /lib/x86_64-linux-gnu/libpcre2-8.so.0 (0x00007f8fd5965000)\r\n\tlibp11-kit.so.0 => /lib/x86_64-linux-gnu/libp11-kit.so.0 (0x00007f8fd582f000)\r\n\tlibtasn1.so.6 => /lib/x86_64-linux-gnu/libtasn1.so.6 (0x00007f8fd5817000)\r\n\tlibkeyutils.so.1 => /lib/x86_64-linux-gnu/libkeyutils.so.1 (0x00007f8fd5810000)\r\n\tlibheimntlm.so.0 => /lib/x86_64-linux-gnu/libheimntlm.so.0 (0x00007f8fd5804000)\r\n\tlibkrb5.so.26 => /lib/x86_64-linux-gnu/libkrb5.so.26 (0x00007f8fd5771000)\r\n\tlibasn1.so.8 => /lib/x86_64-linux-gnu/libasn1.so.8 (0x00007f8fd56ca000)\r\n\tlibhcrypto.so.4 => /lib/x86_64-linux-gnu/libhcrypto.so.4 (0x00007f8fd5690000)\r\n\tlibroken.so.18 => /lib/x86_64-linux-gnu/libroken.so.18 (0x00007f8fd5677000)\r\n\tlibwind.so.0 => /lib/x86_64-linux-gnu/libwind.so.0 (0x00007f8fd564d000)\r\n\tlibheimbase.so.1 => /lib/x86_64-linux-gnu/libheimbase.so.1 (0x00007f8fd563b000)\r\n\tlibhx509.so.5 => /lib/x86_64-linux-gnu/libhx509.so.5 (0x00007f8fd55ed000)\r\n\tlibsqlite3.so.0 => /lib/x86_64-linux-gnu/libsqlite3.so.0 (0x00007f8fd54c2000)\r\n\tlibcrypt.so.1 => /lib/x86_64-linux-gnu/libcrypt.so.1 (0x00007f8fd5487000)\r\n```"
        },
        {
            "created_at": "2021-09-29T18:45:06.371Z",
            "body": "***Note**: [Comment](https://issues.apache.org/jira/browse/ARROW-14076?focusedCommentId=17422329) by Daniel Rice (danielricecodes):*\nI'm assuming we should focus on this line?\r\n/tmp/build_29fd2902/vendor/bundle/ruby/2.7.0/gems/extpp-0.0.9/ext/extpp/libruby-extpp.so => not found\r\nI'm not sure why this file path is prefixed with /tmp/build_XXXX/; however,\u00a0libruby-extpp.so file is found in /app where it ought to be.\u00a0\r\n```java\n\r\n~ $ ls -al /app/vendor/bundle/ruby/2.7.0/gems/extpp-0.0.9/lib/libruby-extpp.so\r\n-rwx------ 1 u57180 dyno 177576 Sep 21 18:35 /app/vendor/bundle/ruby/2.7.0/gems/extpp-0.0.9/lib/libruby-extpp.so\r\n```\r\nWhere does `arrow.so` get the path to `libruby-extpp.so` from then?"
        },
        {
            "created_at": "2021-09-29T21:25:32.289Z",
            "body": "***Note**: [Comment](https://issues.apache.org/jira/browse/ARROW-14076?focusedCommentId=17422404) by Kouhei Sutou (kou):*\nThanks.\r\nIt seems that absolute link path isn't suitable for Heroku.\r\nI'll re-implement extpp gem as header only library. Then we don't need to link to `libruby-extpp.so`.\r\n\r\nFYI: `libruby-extpp.so`'s path is detected by here: https://github.com/red-data-tools/extpp/blob/0.0.9/lib/extpp.rb#L32"
        },
        {
            "created_at": "2021-10-02T21:33:34.049Z",
            "body": "***Note**: [Comment](https://issues.apache.org/jira/browse/ARROW-14076?focusedCommentId=17423600) by Kouhei Sutou (kou):*\nCould you try extpp 0.1.0?"
        },
        {
            "created_at": "2021-10-04T22:25:05.236Z",
            "body": "***Note**: [Comment](https://issues.apache.org/jira/browse/ARROW-14076?focusedCommentId=17424215) by Daniel Rice (danielricecodes):*\n`[~kou]` \u00a0- it does appear to be working.\u00a0 All dynos are up and running now and the only change was `bundle update extpp` to version 0.1.0.\u00a0 Thank you."
        },
        {
            "created_at": "2021-10-05T01:32:52.454Z",
            "body": "***Note**: [Comment](https://issues.apache.org/jira/browse/ARROW-14076?focusedCommentId=17424251) by Kouhei Sutou (kou):*\nThanks for confirming this."
        }
    ]
}