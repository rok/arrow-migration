{
    "issue": {
        "title": "[R] Linux static build should always bundle dependencies",
        "body": "***Note**: This issue was originally created as [ARROW-9303](https://issues.apache.org/jira/browse/ARROW-9303). Please see the [migration documentation](https://gist.github.com/toddfarmer/12aa88361532d21902818a6044fda4c3) for further details.*\n\n### Original Issue Description:\nI'm following the instructions here: https://arrow.apache.org/install/\r\n\r\narrow::install_arrow()\r\n\r\ngives error:\r\n\r\n`./configure: line 132: cd: libarrow/arrow-0.17.1/lib: No such file or directory`\r\n\r\n`This leaves me without a working arrow::read_feather.`",
        "created_at": "2020-07-02T23:52:56.000Z",
        "updated_at": "2020-07-10T17:40:48.000Z",
        "labels": [
            "Migrated from Jira",
            "Component: R",
            "Type: bug"
        ],
        "closed": true,
        "closed_at": "2020-07-10T15:59:33.000Z"
    },
    "comments": [
        {
            "created_at": "2020-07-03T14:59:07.937Z",
            "body": "***Note**: [Comment](https://issues.apache.org/jira/browse/ARROW-9303?focusedCommentId=17151025) by Neal Richardson (npr):*\nCould be this: https://github.com/apache/arrow/blob/master/r/vignettes/install.Rmd#L261-L263\r\n\r\nIf not, please provide more information. ARROW-8586 is a good model for the kinds of questions we'll need to answer in order to help."
        },
        {
            "created_at": "2020-07-06T07:12:15.495Z",
            "body": "***Note**: [Comment](https://issues.apache.org/jira/browse/ARROW-9303?focusedCommentId=17151823) by Nathan TeBlunthuis (groceryheist):*\nThanks for the response.\u00a0 I double-checked that the issue is not the CC and CCX environment variables.\u00a0 From the linked issue it seems like the C++ build was failing.\u00a0 I tried again and saw an error that my cmake version was less than 3.2.\u00a0\u00a0 I tried again with an updated cmake and it seems to work.\u00a0 I suggest that raising this error if the build fails or at least updating the R documentation to indicate dependency on cmake>-3.2 may improve the user experience for those using R on HPCs."
        },
        {
            "created_at": "2020-07-06T08:20:16.569Z",
            "body": "***Note**: [Comment](https://issues.apache.org/jira/browse/ARROW-9303?focusedCommentId=17151864) by Nathan TeBlunthuis (groceryheist):*\nOk so it turns out that the cmake wasn't my only problem\r\n\r\nThe version that built didn't have support for any compression codecs, so I tried setting LIBARROW_BINARY=centos-7 and reinstalling to see if the C++ binaries will work.\u00a0\r\n\r\nR fails to load the package built this way with error: Error: package or namespace load failed for \u2018arrow\u2019 in dyn.load(file, DLLpath = DLLpath, ...):\r\nunable to load shared object '/.../R_4.0.2_libs/00LOCK-arrow/00new/arrow/libs/arrow.so':\r\n/.../R_4.0.2_libs/00LOCK-arrow/00new/arrow/libs/arrow.so: undefined symbol: _ZN5arrow5fieldENSt7__cxx1112basic_stringIcSt11char_traitsIcESaIcEEESt10shared_ptrINS_8DataTypeEEbS6_IKNS_16KeyValueMetadataEE\r\n\r\n\r\n\\*\\*\\* Successfully retrieved C++ binaries for centos-7\r\nPKG_CFLAGS=-I/.../tempdir/RtmpWcNNLr/R.INSTALL59cf4fd1c7ac/arrow/libarrow/arrow-0.17.1/include -DARROW_R_WITH_ARROW\r\nPKG_LIBS=-L/.../tempdir/RtmpWcNNLr/R.INSTALL59cf4fd1c7ac/arrow/libarrow/arrow-0.17.1/lib -larrow_dataset -lparquet -larrow -larrow -larrow_dataset -lboost_filesystem -lboost_regex -lboost_system -lbrotlidec-static -lbrotlienc-static -lbrotlizzz-static -lbz2 -ljemalloc_pic -llz4 -lparquet -lsnappy -lthrift -lz -lzstd\r\n\\*\\* libs\r\ng++ -std=gnu++11 -I\"/.../R/4.0.2/lib64/R/include\" -DNDEBUG -I/.../tempdir/RtmpWcNNLr/R.INSTALL59cf4fd1c7ac/arrow/libarrow/arrow-0.17.1/include -DARROW_R_WITH_ARROW -I'/.../R/4.0.2/lib64/R/library/Rcpp/include' -I/usr/local/include -fpic -O3 -march=native -mtune=native -fPIC -c array.cpp -o array.o\r\ng++ -std=gnu++11 -I\"/.../R/4.0.2/lib64/R/include\" -DNDEBUG -I/.../tempdir/RtmpWcNNLr/R.INSTALL59cf4fd1c7ac/arrow/libarrow/arrow-0.17.1/include -DARROW_R_WITH_ARROW -I'/.../R/4.0.2/lib64/R/library/Rcpp/include' -I/usr/local/include -fpic -O3 -march=native -mtune=native -fPIC -c array_from_vector.cpp -o array_from_vector.o\r\ng++ -std=gnu++11 -I\"/.../R/4.0.2/lib64/R/include\" -DNDEBUG -I/.../tempdir/RtmpWcNNLr/R.INSTALL59cf4fd1c7ac/arrow/libarrow/arrow-0.17.1/include -DARROW_R_WITH_ARROW -I'/.../R/4.0.2/lib64/R/library/Rcpp/include' -I/usr/local/include -fpic -O3 -march=native -mtune=native -fPIC -c array_to_vector.cpp -o array_to_vector.o\r\ng++ -std=gnu++11 -I\"/.../R/4.0.2/lib64/R/include\" -DNDEBUG -I/.../tempdir/RtmpWcNNLr/R.INSTALL59cf4fd1c7ac/arrow/libarrow/arrow-0.17.1/include -DARROW_R_WITH_ARROW -I'/.../R/4.0.2/lib64/R/library/Rcpp/include' -I/usr/local/include -fpic -O3 -march=native -mtune=native -fPIC -c arraydata.cpp -o arraydata.o\r\ng++ -std=gnu++11 -I\"/.../R/4.0.2/lib64/R/include\" -DNDEBUG -I/.../tempdir/RtmpWcNNLr/R.INSTALL59cf4fd1c7ac/arrow/libarrow/arrow-0.17.1/include -DARROW_R_WITH_ARROW -I'/.../R/4.0.2/lib64/R/library/Rcpp/include' -I/usr/local/include -fpic -O3 -march=native -mtune=native -fPIC -c arrowExports.cpp -o arrowExports.o\r\ng++ -std=gnu++11 -I\"/.../R/4.0.2/lib64/R/include\" -DNDEBUG -I/.../tempdir/RtmpWcNNLr/R.INSTALL59cf4fd1c7ac/arrow/libarrow/arrow-0.17.1/include -DARROW_R_WITH_ARROW -I'/.../R/4.0.2/lib64/R/library/Rcpp/include' -I/usr/local/include -fpic -O3 -march=native -mtune=native -fPIC -c buffer.cpp -o buffer.o\r\ng++ -std=gnu++11 -I\"/.../R/4.0.2/lib64/R/include\" -DNDEBUG -I/.../tempdir/RtmpWcNNLr/R.INSTALL59cf4fd1c7ac/arrow/libarrow/arrow-0.17.1/include -DARROW_R_WITH_ARROW -I'/.../R/4.0.2/lib64/R/library/Rcpp/include' -I/usr/local/include -fpic -O3 -march=native -mtune=native -fPIC -c chunkedarray.cpp -o chunkedarray.o\r\ng++ -std=gnu++11 -I\"/.../R/4.0.2/lib64/R/include\" -DNDEBUG -I/.../tempdir/RtmpWcNNLr/R.INSTALL59cf4fd1c7ac/arrow/libarrow/arrow-0.17.1/include -DARROW_R_WITH_ARROW -I'/.../R/4.0.2/lib64/R/library/Rcpp/include' -I/usr/local/include -fpic -O3 -march=native -mtune=native -fPIC -c compression.cpp -o compression.o\r\ng++ -std=gnu++11 -I\"/.../R/4.0.2/lib64/R/include\" -DNDEBUG -I/.../tempdir/RtmpWcNNLr/R.INSTALL59cf4fd1c7ac/arrow/libarrow/arrow-0.17.1/include -DARROW_R_WITH_ARROW -I'/.../R/4.0.2/lib64/R/library/Rcpp/include' -I/usr/local/include -fpic -O3 -march=native -mtune=native -fPIC -c compute.cpp -o compute.o\r\ng++ -std=gnu++11 -I\"/.../R/4.0.2/lib64/R/include\" -DNDEBUG -I/.../tempdir/RtmpWcNNLr/R.INSTALL59cf4fd1c7ac/arrow/libarrow/arrow-0.17.1/include -DARROW_R_WITH_ARROW -I'/.../R/4.0.2/lib64/R/library/Rcpp/include' -I/usr/local/include -fpic -O3 -march=native -mtune=native -fPIC -c csv.cpp -o csv.o\r\ng++ -std=gnu++11 -I\"/.../R/4.0.2/lib64/R/include\" -DNDEBUG -I/.../tempdir/RtmpWcNNLr/R.INSTALL59cf4fd1c7ac/arrow/libarrow/arrow-0.17.1/include -DARROW_R_WITH_ARROW -I'/.../R/4.0.2/lib64/R/library/Rcpp/include' -I/usr/local/include -fpic -O3 -march=native -mtune=native -fPIC -c dataset.cpp -o dataset.o\r\ng++ -std=gnu++11 -I\"/.../R/4.0.2/lib64/R/include\" -DNDEBUG -I/.../tempdir/RtmpWcNNLr/R.INSTALL59cf4fd1c7ac/arrow/libarrow/arrow-0.17.1/include -DARROW_R_WITH_ARROW -I'/.../R/4.0.2/lib64/R/library/Rcpp/include' -I/usr/local/include -fpic -O3 -march=native -mtune=native -fPIC -c datatype.cpp -o datatype.o\r\ng++ -std=gnu++11 -I\"/.../R/4.0.2/lib64/R/include\" -DNDEBUG -I/.../tempdir/RtmpWcNNLr/R.INSTALL59cf4fd1c7ac/arrow/libarrow/arrow-0.17.1/include -DARROW_R_WITH_ARROW -I'/.../R/4.0.2/lib64/R/library/Rcpp/include' -I/usr/local/include -fpic -O3 -march=native -mtune=native -fPIC -c expression.cpp -o expression.o\r\ng++ -std=gnu++11 -I\"/.../R/4.0.2/lib64/R/include\" -DNDEBUG -I/.../tempdir/RtmpWcNNLr/R.INSTALL59cf4fd1c7ac/arrow/libarrow/arrow-0.17.1/include -DARROW_R_WITH_ARROW -I'/.../R/4.0.2/lib64/R/library/Rcpp/include' -I/usr/local/include -fpic -O3 -march=native -mtune=native -fPIC -c feather.cpp -o feather.o\r\ng++ -std=gnu++11 -I\"/.../R/4.0.2/lib64/R/include\" -DNDEBUG -I/.../tempdir/RtmpWcNNLr/R.INSTALL59cf4fd1c7ac/arrow/libarrow/arrow-0.17.1/include -DARROW_R_WITH_ARROW -I'/.../R/4.0.2/lib64/R/library/Rcpp/include' -I/usr/local/include -fpic -O3 -march=native -mtune=native -fPIC -c field.cpp -o field.o\r\ng++ -std=gnu++11 -I\"/.../R/4.0.2/lib64/R/include\" -DNDEBUG -I/.../tempdir/RtmpWcNNLr/R.INSTALL59cf4fd1c7ac/arrow/libarrow/arrow-0.17.1/include -DARROW_R_WITH_ARROW -I'/.../R/4.0.2/lib64/R/library/Rcpp/include' -I/usr/local/include -fpic -O3 -march=native -mtune=native -fPIC -c filesystem.cpp -o filesystem.o\r\ng++ -std=gnu++11 -I\"/.../R/4.0.2/lib64/R/include\" -DNDEBUG -I/.../tempdir/RtmpWcNNLr/R.INSTALL59cf4fd1c7ac/arrow/libarrow/arrow-0.17.1/include -DARROW_R_WITH_ARROW -I'/.../R/4.0.2/lib64/R/library/Rcpp/include' -I/usr/local/include -fpic -O3 -march=native -mtune=native -fPIC -c io.cpp -o io.o\r\ng++ -std=gnu++11 -I\"/.../R/4.0.2/lib64/R/include\" -DNDEBUG -I/.../tempdir/RtmpWcNNLr/R.INSTALL59cf4fd1c7ac/arrow/libarrow/arrow-0.17.1/include -DARROW_R_WITH_ARROW -I'/.../R/4.0.2/lib64/R/library/Rcpp/include' -I/usr/local/include -fpic -O3 -march=native -mtune=native -fPIC -c json.cpp -o json.o\r\ng++ -std=gnu++11 -I\"/.../R/4.0.2/lib64/R/include\" -DNDEBUG -I/.../tempdir/RtmpWcNNLr/R.INSTALL59cf4fd1c7ac/arrow/libarrow/arrow-0.17.1/include -DARROW_R_WITH_ARROW -I'/.../R/4.0.2/lib64/R/library/Rcpp/include' -I/usr/local/include -fpic -O3 -march=native -mtune=native -fPIC -c memorypool.cpp -o memorypool.o\r\ng++ -std=gnu++11 -I\"/.../R/4.0.2/lib64/R/include\" -DNDEBUG -I/.../tempdir/RtmpWcNNLr/R.INSTALL59cf4fd1c7ac/arrow/libarrow/arrow-0.17.1/include -DARROW_R_WITH_ARROW -I'/.../R/4.0.2/lib64/R/library/Rcpp/include' -I/usr/local/include -fpic -O3 -march=native -mtune=native -fPIC -c message.cpp -o message.o\r\ng++ -std=gnu++11 -I\"/.../R/4.0.2/lib64/R/include\" -DNDEBUG -I/.../tempdir/RtmpWcNNLr/R.INSTALL59cf4fd1c7ac/arrow/libarrow/arrow-0.17.1/include -DARROW_R_WITH_ARROW -I'/.../R/4.0.2/lib64/R/library/Rcpp/include' -I/usr/local/include -fpic -O3 -march=native -mtune=native -fPIC -c parquet.cpp -o parquet.o\r\ng++ -std=gnu++11 -I\"/.../R/4.0.2/lib64/R/include\" -DNDEBUG -I/.../tempdir/RtmpWcNNLr/R.INSTALL59cf4fd1c7ac/arrow/libarrow/arrow-0.17.1/include -DARROW_R_WITH_ARROW -I'/.../R/4.0.2/lib64/R/library/Rcpp/include' -I/usr/local/include -fpic -O3 -march=native -mtune=native -fPIC -c py-to-r.cpp -o py-to-r.o\r\ng++ -std=gnu++11 -I\"/.../R/4.0.2/lib64/R/include\" -DNDEBUG -I/.../tempdir/RtmpWcNNLr/R.INSTALL59cf4fd1c7ac/arrow/libarrow/arrow-0.17.1/include -DARROW_R_WITH_ARROW -I'/.../R/4.0.2/lib64/R/library/Rcpp/include' -I/usr/local/include -fpic -O3 -march=native -mtune=native -fPIC -c recordbatch.cpp -o recordbatch.o\r\ng++ -std=gnu++11 -I\"/.../R/4.0.2/lib64/R/include\" -DNDEBUG -I/.../tempdir/RtmpWcNNLr/R.INSTALL59cf4fd1c7ac/arrow/libarrow/arrow-0.17.1/include -DARROW_R_WITH_ARROW -I'/.../R/4.0.2/lib64/R/library/Rcpp/include' -I/usr/local/include -fpic -O3 -march=native -mtune=native -fPIC -c recordbatchreader.cpp -o recordbatchreader.o\r\ng++ -std=gnu++11 -I\"/.../R/4.0.2/lib64/R/include\" -DNDEBUG -I/.../tempdir/RtmpWcNNLr/R.INSTALL59cf4fd1c7ac/arrow/libarrow/arrow-0.17.1/include -DARROW_R_WITH_ARROW -I'/.../R/4.0.2/lib64/R/library/Rcpp/include' -I/usr/local/include -fpic -O3 -march=native -mtune=native -fPIC -c recordbatchwriter.cpp -o recordbatchwriter.o\r\ng++ -std=gnu++11 -I\"/.../R/4.0.2/lib64/R/include\" -DNDEBUG -I/.../tempdir/RtmpWcNNLr/R.INSTALL59cf4fd1c7ac/arrow/libarrow/arrow-0.17.1/include -DARROW_R_WITH_ARROW -I'/.../R/4.0.2/lib64/R/library/Rcpp/include' -I/usr/local/include -fpic -O3 -march=native -mtune=native -fPIC -c schema.cpp -o schema.o\r\ng++ -std=gnu++11 -I\"/.../R/4.0.2/lib64/R/include\" -DNDEBUG -I/.../tempdir/RtmpWcNNLr/R.INSTALL59cf4fd1c7ac/arrow/libarrow/arrow-0.17.1/include -DARROW_R_WITH_ARROW -I'/.../R/4.0.2/lib64/R/library/Rcpp/include' -I/usr/local/include -fpic -O3 -march=native -mtune=native -fPIC -c symbols.cpp -o symbols.o\r\ng++ -std=gnu++11 -I\"/.../R/4.0.2/lib64/R/include\" -DNDEBUG -I/.../tempdir/RtmpWcNNLr/R.INSTALL59cf4fd1c7ac/arrow/libarrow/arrow-0.17.1/include -DARROW_R_WITH_ARROW -I'/.../R/4.0.2/lib64/R/library/Rcpp/include' -I/usr/local/include -fpic -O3 -march=native -mtune=native -fPIC -c table.cpp -o table.o\r\ng++ -std=gnu++11 -I\"/.../R/4.0.2/lib64/R/include\" -DNDEBUG -I/.../tempdir/RtmpWcNNLr/R.INSTALL59cf4fd1c7ac/arrow/libarrow/arrow-0.17.1/include -DARROW_R_WITH_ARROW -I'/.../R/4.0.2/lib64/R/library/Rcpp/include' -I/usr/local/include -fpic -O3 -march=native -mtune=native -fPIC -c threadpool.cpp -o threadpool.o\r\ng++ -std=gnu++11 -shared -L/.../R/4.0.2/lib64/R/lib -L/usr/local/lib64 -o arrow.so array.o array_from_vector.o array_to_vector.o arraydata.o arrowExports.o buffer.o chunkedarray.o compression.o compute.o csv.o dataset.o datatype.o expression.o feather.o field.o filesystem.o io.o json.o memorypool.o message.o parquet.o py-to-r.o recordbatch.o recordbatchreader.o recordbatchwriter.o schema.o symbols.o table.o threadpool.o -L/.../tempdir/RtmpWcNNLr/R.INSTALL59cf4fd1c7ac/arrow/libarrow/arrow-0.17.1/lib -larrow_dataset -lparquet -larrow -larrow -larrow_dataset -lboost_filesystem -lboost_regex -lboost_system -lbrotlidec-static -lbrotlienc-static -lbrotlizzz-static -lbz2 -ljemalloc_pic -llz4 -lparquet -lsnappy -lthrift -lz -lzstd -L/.../R/4.0.2/lib64/R/lib -lR\r\ninstalling to /.../R_4.0.2_libs/00LOCK-arrow/00new/arrow/libs\r\n\\*\\* R\r\n\\*\\* inst\r\n\\*\\* byte-compile and prepare package for lazy loading\\*\\* help\r\n\\*\\*\\* installing help indices\r\n\\*\\* building package indices\r\n\\*\\* installing vignettes\r\n\\*\\* testing if installed package can be loaded from temporary location\r\nError: package or namespace load failed for \u2018arrow\u2019 in dyn.load(file, DLLpath = DLLpath, ...):\r\nunable to load shared object '/.../R_4.0.2_libs/00LOCK-arrow/00new/arrow/libs/arrow.so':\r\n/.../R_4.0.2_libs/00LOCK-arrow/00new/arrow/libs/arrow.so: undefined symbol: _ZN5arrow5fieldENSt7__cxx1112basic_stringIcSt11char_traitsIcESaIcEEESt10shared_ptrINS_8DataTypeEEbS6_IKNS_16KeyValueMetadataEE\r\nError: loading failed\r\nExecution halted\r\nERROR: loading failed\r\n- removing \u2018/.../R_4.0.2_libs/arrow\u2019"
        },
        {
            "created_at": "2020-07-06T17:50:16.908Z",
            "body": "***Note**: [Comment](https://issues.apache.org/jira/browse/ARROW-9303?focusedCommentId=17152216) by Neal Richardson (npr):*\nWe can probably add a minimum cmake version check. \r\n\r\nIf you're using the prebuilt binary, can you try with setting CC and CXX? The binary was built with https://github.com/ursa-labs/arrow-r-nightly/blob/master/linux/yum.Dockerfile#L18-L19\r\n\r\nIf you want to build everything from source and you want compression codecs built, you can set `LIBARROW_MINIMAL=false`, or you can pick and choose the specific `ARROW_WITH_X` codecs to set, per https://github.com/apache/arrow/blob/master/r/inst/build_arrow_static.sh"
        },
        {
            "created_at": "2020-07-06T19:06:18.632Z",
            "body": "***Note**: [Comment](https://issues.apache.org/jira/browse/ARROW-9303?focusedCommentId=17152257) by Nathan TeBlunthuis (groceryheist):*\nHi Neal,\r\n\r\nThanks for your help so far!\r\n\r\nMy CC and CXX environment variables were not set to /usr/bin/gcc and /usr/bin/g++ because the system gcc is pretty old so I use a modern one (gcc 8.3.0)\u00a0 installed in user space.\r\n\r\nI tried installing the binaries with CC and CXX both with gcc 8.3.0 and with the system gcc (4.8.5). I get teh same undefined symbol error (as above) in either case.\r\n\r\nI also tried building from source with LIBARROW_MINIMAL=FALSE and with LZ4, BZIP,\u00a0 SNAPPY and LZMA flags set. Compilation succeeds but R cannot load the package, with a somewhat different error.\r\n\r\nError: package or namespace load failed for \u2018arrow\u2019 in dyn.load(file, DLLpath = DLLpath, ...):\r\n unable to load shared object '/.../R_4.0.2_libs/00LOCK-arrow/00new/arrow/libs/arrow.so':\r\n /.../R_4.0.2_libs/00LOCK-arrow/00new/arrow/libs/arrow.so: undefined symbol: _ZTIN5boost11regex_errorE\r\nError: loading failed\r\n\r\n\u2013 Nate\r\n\r\n\u00a0\r\n\r\n\u00a0"
        },
        {
            "created_at": "2020-07-06T19:49:58.798Z",
            "body": "***Note**: [Comment](https://issues.apache.org/jira/browse/ARROW-9303?focusedCommentId=17152275) by Neal Richardson (npr):*\n> I tried installing the binaries with CC and CXX both with gcc 8.3.0 and with the system gcc (4.8.5). I get teh same undefined symbol error (as above) in either case.\r\n\r\nOdd, I wouldn't expect the _same_ undefined symbol error with those gcc versions. \r\n\r\n> Error: package or namespace load failed for \u2018arrow\u2019 in dyn.load(file, DLLpath = DLLpath, ...):\n> unable to load shared object '/.../R_4.0.2_libs/00LOCK-arrow/00new/arrow/libs/arrow.so':\n> /.../R_4.0.2_libs/00LOCK-arrow/00new/arrow/libs/arrow.so: undefined symbol: _ZTIN5boost11regex_errorE\n> Error: loading failed\r\n\r\nCould you share the verbose build logs (with `ARROW_R_DEV=true` set) from that? And is that using gcc 8 or gcc 4.8? Boost regex is only needed when compiling with gcc < 4.9. "
        },
        {
            "created_at": "2020-07-06T20:47:49.829Z",
            "body": "***Note**: [Comment](https://issues.apache.org/jira/browse/ARROW-9303?focusedCommentId=17152313) by Nathan TeBlunthuis (groceryheist):*\nI double checked that I'm using gcc 8.3.0 this time. Maybe last time I left CC and CCX set to 4.8.5 ?\r\n\r\nMy build log is attached. [build_arrow.txt](build_arrow.txt)\r\n\r\nThanks again\r\n\r\n\u00a0"
        },
        {
            "created_at": "2020-07-06T20:56:06.163Z",
            "body": "***Note**: [Comment](https://issues.apache.org/jira/browse/ARROW-9303?focusedCommentId=17152318) by Neal Richardson (npr):*\nThanks. We're getting closer. Can you unset the various `ARROW_WITH_X` vars and just use `LIBARROW_MINIMAL=false`, which will set all of those for you? I'm not immediately seeing why it's looking for snappy but it didn't build it, but my first guess is a confusion between the way you set those WITH env vars, as `TRUE`, vs. how cmake prefers them (as `ON`). "
        },
        {
            "created_at": "2020-07-06T21:01:40.673Z",
            "body": "***Note**: [Comment](https://issues.apache.org/jira/browse/ARROW-9303?focusedCommentId=17152319) by Nathan TeBlunthuis (groceryheist):*\nHi Neal,\r\n\r\nI set ARROW_WITH_SNAPPY=FALSE (and the rest of the codecs to TRUE) it works fine with support for the rest of the codecs.\u00a0 So it seems we have traced the issue to snappy."
        },
        {
            "created_at": "2020-07-06T21:07:11.808Z",
            "body": "***Note**: [Comment](https://issues.apache.org/jira/browse/ARROW-9303?focusedCommentId=17152326) by Neal Richardson (npr):*\nI'm still curious to see how it goes using ON/OFF instead of TRUE/FALSE. I suspect the (current) problem is somewhere in how the library is determining whether support for a codec has been built, and not in building the codec itself, since I didn't see a compilation error."
        },
        {
            "created_at": "2020-07-06T21:08:58.508Z",
            "body": "***Note**: [Comment](https://issues.apache.org/jira/browse/ARROW-9303?focusedCommentId=17152328) by Nathan TeBlunthuis (groceryheist):*\nOk I'll try again with all the codecs set to ON."
        },
        {
            "created_at": "2020-07-06T21:21:56.315Z",
            "body": "***Note**: [Comment](https://issues.apache.org/jira/browse/ARROW-9303?focusedCommentId=17152334) by Nathan TeBlunthuis (groceryheist):*\nWith all the codecs set to ON, instead of TRUE things are much the same as before.\u00a0 [build_arrow_2.txt](build_arrow_2.txt)"
        },
        {
            "created_at": "2020-07-06T22:12:48.892Z",
            "body": "***Note**: [Comment](https://issues.apache.org/jira/browse/ARROW-9303?focusedCommentId=17152351) by Neal Richardson (npr):*\nHmm. Can you try setting `EXTRA_CMAKE_FLAGS='-DSnappy_SOURCE=BUNDLED'` and see if that forces it to build snappy? Looking at https://github.com/apache/arrow/blob/master/cpp/cmake_modules/ThirdpartyToolchain.cmake#L838-L862, it looks like there's some way it could build \"with snappy\" and not report that it was using system snappy, which could be a problem somehow?"
        },
        {
            "created_at": "2020-07-06T22:49:27.427Z",
            "body": "***Note**: [Comment](https://issues.apache.org/jira/browse/ARROW-9303?focusedCommentId=17152361) by Nathan TeBlunthuis (groceryheist):*\nNow the build completes and I end up with a working package, but snappy is unavailable. [build_arrow_3.txt](build_arrow_3.txt)"
        },
        {
            "created_at": "2020-07-08T18:16:10.618Z",
            "body": "***Note**: [Comment](https://issues.apache.org/jira/browse/ARROW-9303?focusedCommentId=17153834) by Alok Saldanha (alokito):*\nI am not sure if I should be mentioning it here, but I am getting the same \"undefined symbol: _ZN6snappy11RawCompressEPKcmPcPm\" error on CentOS 7, and I found that I could install an old version of arrow with\r\n```java\n\r\nPackageUrl <- \"https://cran.r-project.org/src/contrib/Archive/arrow/arrow_0.16.0.2.tar.gz\" install.packages(PackageUrl, repos=NULL, type=\"source\") \n```\r\nSo the issue may have been introduced into the build process between 0.16.0.2 and 0.17.1 (I haven't tried 0.17.0 yet)."
        },
        {
            "created_at": "2020-07-08T18:21:26.071Z",
            "body": "***Note**: [Comment](https://issues.apache.org/jira/browse/ARROW-9303?focusedCommentId=17153840) by Neal Richardson (npr):*\nDo either of you have snappy installed on your system?"
        },
        {
            "created_at": "2020-07-08T18:57:05.839Z",
            "body": "***Note**: [Comment](https://issues.apache.org/jira/browse/ARROW-9303?focusedCommentId=17153858) by Alok Saldanha (alokito):*\nI am working on a shared CentOS system with a file in\u00a0/usr/lib64/libsnappy.so... I don't know how else to tell if I have snappy. I'm using arrow to read parquet files that (I think) are not compressed with snappy.\r\n\r\nAlso the issue is also present with R 3.6.3 and 3.6.2."
        },
        {
            "created_at": "2020-07-08T19:38:11.820Z",
            "body": "***Note**: [Comment](https://issues.apache.org/jira/browse/ARROW-9303?focusedCommentId=17153911) by Nathan TeBlunthuis (groceryheist):*\nI have libsnappy.so.1 and libsnappy.so.1.1.4 in /usr/lib64.\r\n\r\n\u00a0"
        },
        {
            "created_at": "2020-07-09T18:02:21.270Z",
            "body": "***Note**: [Comment](https://issues.apache.org/jira/browse/ARROW-9303?focusedCommentId=17154768) by Neal Richardson (npr):*\nOk. So it seems that the primary issue here is that there's a gap in the logic when we don't bundle all of the C++ dependencies. There is a [comment TODO](https://github.com/apache/arrow/commit/b57b95532713522df202f5031bd7f693bdff99ef#diff-530ae4dd9579af205336fa88f093d9b9R131) that recognizes this, in fact, but that commit also [switched the default behavior](https://github.com/apache/arrow/commit/b57b95532713522df202f5031bd7f693bdff99ef#diff-fca6664f2d521c610d2027c1218657d3R65) in a way that would trigger the problem for folks (like you) who have these optional dependencies installed on their system.  \r\n\r\nIIUC ARROW-6312 is part of the proper fix for this, but short of that, I think we need to go back to always building the bundled dependencies."
        },
        {
            "created_at": "2020-07-10T15:59:33.927Z",
            "body": "***Note**: [Comment](https://issues.apache.org/jira/browse/ARROW-9303?focusedCommentId=17155563) by Neal Richardson (npr):*\nIssue resolved by pull request 7699\n<https://github.com/apache/arrow/pull/7699>"
        },
        {
            "created_at": "2020-07-10T16:00:58.290Z",
            "body": "***Note**: [Comment](https://issues.apache.org/jira/browse/ARROW-9303?focusedCommentId=17155568) by Neal Richardson (npr):*\nThanks for your patience and help debugging this. I've switched it to always build the bundled dependencies and also to check for a minimum cmake version. This may not resolve all of the issues encountered in this thread, but it's a step forward."
        },
        {
            "created_at": "2020-07-10T17:40:48.146Z",
            "body": "***Note**: [Comment](https://issues.apache.org/jira/browse/ARROW-9303?focusedCommentId=17155637) by Nathan TeBlunthuis (groceryheist):*\nWhoo hoo! I manually applied your patch and was able to install arrow with working snappy!\u00a0 Thank you for working on this!"
        }
    ]
}