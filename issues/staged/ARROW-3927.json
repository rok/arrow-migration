{
    "issue": {
        "title": "[C++] JSON integration test segfaults on Alpine",
        "body": "***Note**: This issue was originally created as [ARROW-3927](https://issues.apache.org/jira/browse/ARROW-3927). Please see the [migration documentation](https://gist.github.com/toddfarmer/12aa88361532d21902818a6044fda4c3) for further details.*\n\n### Original Issue Description:\n```Java\n\r\n$ docker-compose build cpp-alpine\r\n$ docker-compose run cpp-alpine bash\r\nbash-4.4# ulimit -c unlimited\r\nbash-4.4# /arrow/ci/docker_build_cpp.sh\r\nbash-4.4# /build/cpp/debug/json-integration-test\r\n[==========] Running 2 tests from 1 test case.\r\n[----------] Global test environment set-up.\r\n[----------] 2 tests from TestJSONIntegration\r\n[ RUN      ] TestJSONIntegration.ConvertAndValidate\r\nunknown file: Failure\r\nC++ exception with description \"std::bad_alloc\" thrown in the test body.\r\n[  FAILED  ] TestJSONIntegration.ConvertAndValidate (19 ms)\r\n[ RUN      ] TestJSONIntegration.ErrorStates\r\nSegmentation fault (core dumped)\r\n```\r\n\r\nBacktrace:\r\n\r\n```Java\n\r\nbash-4.4# gdb /build/cpp/debug/json-integration-test -c core\r\nGNU gdb (GDB) 8.0.1\r\nCopyright (C) 2017 Free Software Foundation, Inc.\r\nLicense GPLv3+: GNU GPL version 3 or later <http://gnu.org/licenses/gpl.html>\r\nThis is free software: you are free to change and redistribute it.\r\nThere is NO WARRANTY, to the extent permitted by law.  Type \"show copying\"\r\nand \"show warranty\" for details.\r\nThis GDB was configured as \"x86_64-alpine-linux-musl\".\r\nType \"show configuration\" for configuration details.\r\nFor bug reporting instructions, please see:\r\n<http://www.gnu.org/software/gdb/bugs/>.\r\nFind the GDB manual and other documentation resources online at:\r\n<http://www.gnu.org/software/gdb/documentation/>.\r\nFor help, type \"help\".\r\nType \"apropos word\" to search for commands related to \"word\"...\r\nReading symbols from /build/cpp/debug/json-integration-test...done.\r\n\r\nwarning: core file may not match specified executable file.\r\n[New LWP 225]\r\n\r\nwarning: Can't read pathname for load map: No error information.\r\nCore was generated by `/build/cpp/debug/json-integration-test'.\r\nProgram terminated with signal SIGSEGV, Segmentation fault.\r\n#0  0x00007f4458ad8c9e in std::string::_Rep::_M_dispose(std::allocator<char> const&) () from /usr/lib/libstdc++.so.6\r\n(gdb) bt\r\n#0  0x00007f4458ad8c9e in std::string::_Rep::_M_dispose(std::allocator<char> const&) () from /usr/lib/libstdc++.so.6\r\n#1  0x00007f4458ad8cd3 in std::basic_string<char, std::char_traits<char>, std::allocator<char> >::~basic_string() () from /usr/lib/libstdc++.so.6\r\n#2  0x000055eb9abdc402 in boost::filesystem::path::~path (this=0x7ffda38537f8, __in_chrg=<optimized out>) at /usr/include/boost/filesystem/path.hpp:56\r\n#3  0x000055eb9abd97c7 in arrow::ipc::temp_path () at /arrow/cpp/src/arrow/ipc/json-integration-test.cc:241\r\n#4  0x000055eb9abdca1a in arrow::ipc::TestJSONIntegration::mkstemp (this=0x7f4458f7c3c0) at /arrow/cpp/src/arrow/ipc/json-integration-test.cc:249\r\n#5  0x000055eb9abda347 in arrow::ipc::TestJSONIntegration_ErrorStates_Test::TestBody (this=0x7f4458f7c3c0) at /arrow/cpp/src/arrow/ipc/json-integration-test.cc:391\r\n#6  0x00007f4459c26877 in testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void> (object=0x7f4458f7c3c0, method=&virtual testing::Test::TestBody(), location=0x7f4459c36c4b \"the test body\")\r\n    at /build/cpp/googletest_ep-prefix/src/googletest_ep/googletest/src/gtest.cc:2402\r\n#7  0x00007f4459c20b3f in testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void> (object=0x7f4458f7c3c0, method=&virtual testing::Test::TestBody(), location=0x7f4459c36c4b \"the test body\")\r\n    at /build/cpp/googletest_ep-prefix/src/googletest_ep/googletest/src/gtest.cc:2438\r\n#8  0x00007f4459c05150 in testing::Test::Run (this=0x7f4458f7c3c0) at /build/cpp/googletest_ep-prefix/src/googletest_ep/googletest/src/gtest.cc:2475\r\n#9  0x00007f4459c05a22 in testing::TestInfo::Run (this=0x7f4458a0ec20) at /build/cpp/googletest_ep-prefix/src/googletest_ep/googletest/src/gtest.cc:2656\r\n#10 0x00007f4459c060b1 in testing::TestCase::Run (this=0x7f4458a0e9c0) at /build/cpp/googletest_ep-prefix/src/googletest_ep/googletest/src/gtest.cc:2774\r\n#11 0x00007f4459c0cd80 in testing::internal::UnitTestImpl::RunAllTests (this=0x7f4458a0e640) at /build/cpp/googletest_ep-prefix/src/googletest_ep/googletest/src/gtest.cc:4649\r\n#12 0x00007f4459c277d1 in testing::internal::HandleSehExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool> (object=0x7f4458a0e640,\r\n    method=(bool (testing::internal::UnitTestImpl::*)(testing::internal::UnitTestImpl * const)) 0x7f4459c0caae <testing::internal::UnitTestImpl::RunAllTests()>,\r\n    location=0x7f4459c37488 \"auxiliary test code (environments or event listeners)\") at /build/cpp/googletest_ep-prefix/src/googletest_ep/googletest/src/gtest.cc:2402\r\n#13 0x00007f4459c21913 in testing::internal::HandleExceptionsInMethodIfSupported<testing::internal::UnitTestImpl, bool> (object=0x7f4458a0e640,\r\n    method=(bool (testing::internal::UnitTestImpl::*)(testing::internal::UnitTestImpl * const)) 0x7f4459c0caae <testing::internal::UnitTestImpl::RunAllTests()>,\r\n    location=0x7f4459c37488 \"auxiliary test code (environments or event listeners)\") at /build/cpp/googletest_ep-prefix/src/googletest_ep/googletest/src/gtest.cc:2438\r\n#14 0x00007f4459c0b98e in testing::UnitTest::Run (this=0x7f4459e5d180 <testing::UnitTest::GetInstance()::instance>) at /build/cpp/googletest_ep-prefix/src/googletest_ep/googletest/src/gtest.cc:4257\r\n#15 0x000055eb9abdbb4a in RUN_ALL_TESTS () at googletest_ep-prefix/src/googletest_ep/include/gtest/gtest.h:2233\r\n#16 0x000055eb9abdb24d in main (argc=1, argv=0x7ffda3853d98) at /arrow/cpp/src/arrow/ipc/json-integration-test.cc:424\r\n```",
        "created_at": "2018-12-02T10:45:41.000Z",
        "updated_at": "2019-06-12T22:17:21.000Z",
        "labels": [
            "Migrated from Jira",
            "Component: C++",
            "Type: bug"
        ],
        "closed": true,
        "closed_at": "2019-06-12T22:17:21.000Z"
    },
    "comments": [
        {
            "created_at": "2019-06-11T18:36:47.533Z",
            "body": "***Note**: [Comment](https://issues.apache.org/jira/browse/ARROW-3927?focusedCommentId=16861335) by Antoine Pitrou (apitrou):*\nThe build fails here:\r\n```Java\n\r\nFAILED: debug/libarrow_testing.so.14.0.0 \r\n: && /usr/bin/ccache /usr/bin/g++ -fPIC -Wno-noexcept-type  -fdiagnostics-color=always -ggdb -O0  -Wall -Wno-conversion -Wno-sign-conversion -Wno-unused-variable -Werror -msse4.2  -g   -shared -Wl,-soname,libarrow_testing.so.14 -o debug/libarrow_testing.so.14.0.0 src/arrow/CMakeFiles/arrow_testing_objlib.dir/io/test-common.cc.o src/arrow/CMakeFiles/arrow_testing_objlib.dir/ipc/test-common.cc.o src/arrow/CMakeFiles/arrow_testing_objlib.dir/filesystem/test-util.cc.o src/arrow/CMakeFiles/arrow_testing_objlib.dir/testing/gtest_util.cc.o src/arrow/CMakeFiles/arrow_testing_objlib.dir/testing/random.cc.o  -Wl,-rpath,/build/cpp/debug:/build/cpp/googletest_ep-prefix/src/googletest_ep/lib: debug/libarrow.so.14.0.0 googletest_ep-prefix/src/googletest_ep/lib/libgtestd.so double-conversion_ep/src/double-conversion_ep/lib/libdouble-conversion.a /usr/lib/libcrypto.so brotli_ep/src/brotli_ep-install/lib/libbrotlienc-static.a brotli_ep/src/brotli_ep-install/lib/libbrotlidec-static.a brotli_ep/src/brotli_ep-install/lib/libbrotlicommon-static.a glog_ep-prefix/src/glog_ep/lib/libglog.a -ldl jemalloc_ep-prefix/src/jemalloc_ep/dist//lib/libjemalloc_pic.a -lrt && :\r\ng++: error: googletest_ep-prefix/src/googletest_ep/lib/libgtestd.so: No such file or directory\r\n```"
        },
        {
            "created_at": "2019-06-12T22:17:21.787Z",
            "body": "***Note**: [Comment](https://issues.apache.org/jira/browse/ARROW-3927?focusedCommentId=16862501) by Wes McKinney (wesm):*\nIn my patch for ARROW-5577 (which addresses the googletest shared library linking issue) this does not occur"
        }
    ]
}