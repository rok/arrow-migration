{
    "issue": {
        "title": "PyArrow: RuntimeError: AppendRowGroups requires equal schemas when writing _metadata file",
        "body": "***Note**: This issue was originally created as [ARROW-16287](https://issues.apache.org/jira/browse/ARROW-16287). Please see the [migration documentation](https://gist.github.com/toddfarmer/12aa88361532d21902818a6044fda4c3) for further details.*\n\n### Original Issue Description:\nI'm trying to follow the example here: <https://arrow.apache.org/docs/python/parquet.html#writing-metadata-and-common-medata-files> to write an example partitioned dataset. But I'm consistently getting an error about non-equal schemas. Here's a mcve:\r\n```java\n\r\nfrom pathlib import Path\r\nimport numpy as np\r\nimport pandas as pd\r\nimport pyarrow as pa\r\nimport pyarrow.parquet as pq\r\nsize = 100_000_000\r\npartition_col = np.random.randint(0, 10, size)\r\nvalues = np.random.rand(size)\r\ntable = pa.Table.from_pandas(\r\n\u00a0 \u00a0 pd.DataFrame({\"partition_col\": partition_col, \"values\": values})\r\n)\r\nmetadata_collector = []\r\nroot_path = Path(\"random.parquet\")\r\npq.write_to_dataset(\r\n\u00a0 \u00a0 table,\r\n\u00a0 \u00a0 root_path,\r\n\u00a0 \u00a0 partition_cols=[\"partition_col\"],\r\n\u00a0 \u00a0 metadata_collector=metadata_collector,\r\n)\r\n\r\nWrite the ``_common_metadata`` parquet file without row groups statistics\r\npq.write_metadata(table.schema, root_path / \"_common_metadata\")\r\n\r\n\r\nWrite the ``_metadata`` parquet file with row groups statistics of all files\r\npq.write_metadata(\r\n\u00a0 \u00a0 table.schema, root_path / \"_metadata\", metadata_collector=metadata_collector\r\n) \n```\r\nThis raises the error\r\n```java\n\r\n---------------------------------------------------------------------------\r\nRuntimeError \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0Traceback (most recent call last)\r\nInput In [92], in <cell line: 1>()\r\n----> 1 pq.write_metadata(\r\n\u00a0 \u00a0 \u00a0 2 \u00a0 \u00a0 table.schema, root_path / \"_metadata\", metadata_collector=metadata_collector\r\n\u00a0 \u00a0 \u00a0 3 )\r\nFile ~/tmp/env/lib/python3.8/site-packages/pyarrow/parquet.py:2324, in write_metadata(schema, where, metadata_collector, **kwargs)\r\n\u00a0 \u00a02322 metadata = read_metadata(where)\r\n\u00a0 \u00a02323 for m in metadata_collector:\r\n-> 2324 \u00a0 \u00a0 metadata.append_row_groups(m)\r\n\u00a0 \u00a02325 metadata.write_metadata_file(where)\r\nFile ~/tmp/env/lib/python3.8/site-packages/pyarrow/_parquet.pyx:628, in pyarrow._parquet.FileMetaData.append_row_groups()\r\nRuntimeError: AppendRowGroups requires equal schemas. \n```\r\nBut all schemas in the `metadata_collector` list seem to be the same:\r\n```java\n\r\nall(metadata_collector[0].schema == meta.schema for meta in metadata_collector)\r\n# True \n```",
        "created_at": "2022-04-22T17:16:11.000Z",
        "updated_at": "2022-04-22T17:17:20.000Z",
        "labels": [
            "Migrated from Jira",
            "Component: Parquet",
            "Type: bug"
        ],
        "closed": false
    },
    "comments": []
}