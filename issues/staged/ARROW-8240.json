{
    "issue": {
        "title": "[Python] New FS interface (pyarrow.fs) does not seem to work correctly for HDFS (Python 3.6, pyarrow 0.16.0)",
        "body": "***Note**: This issue was originally created as [ARROW-8240](https://issues.apache.org/jira/browse/ARROW-8240). Please see the [migration documentation](https://gist.github.com/toddfarmer/12aa88361532d21902818a6044fda4c3) for further details.*\n\n### Original Issue Description:\nI'll preface this with the limited setup I had to do:\r\n\r\n\r\n`export CLASSPATH=$(hadoop classpath --glob)`\r\n\r\n`export ARROW_LIBHDFS_DIR=/opt/cloudera/parcels/CDH-5.15.1-1.cdh5.15.1.p0.4/lib64`\r\n\r\n\u00a0\r\nThen I ran the following:\r\n\r\n```Java\n\r\nIn [1]: import pyarrow.fs                                                                                                                                                                                                                     \r\n\r\nIn [2]: c = pyarrow.fs.HadoopFileSystem()                                                                                                                                                                                                     \r\n\r\nIn [3]: sel = pyarrow.fs.FileSelector('/user/rwiumli')                                                                                                                                                                                        \r\n\r\nIn [4]: c.get_target_stats(sel)                                                                                                                                                                                                               \r\n---------------------------------------------------------------------------\r\nOSError                                   Traceback (most recent call last)\r\n<ipython-input-4-f92157e01e47> in <module>\r\n----> 1 c.get_target_stats(sel)\r\n\r\n~/tmp/venv/lib/python3.6/site-packages/pyarrow/_fs.pyx in pyarrow._fs.FileSystem.get_target_stats()\r\n\r\n~/tmp/venv/lib/python3.6/site-packages/pyarrow/error.pxi in pyarrow.lib.pyarrow_internal_check_status()\r\n\r\n~/tmp/venv/lib/python3.6/site-packages/pyarrow/error.pxi in pyarrow.lib.check_status()\r\n\r\nOSError: HDFS list directory failed, errno: 2 (No such file or directory)\r\n\r\nIn [5]: sel = pyarrow.fs.FileSelector('.')                                                                                                                                                                                                    \r\n\r\nIn [6]: c.get_target_stats(sel)                                                                                                                                                                                                               \r\nOut[6]: \r\n[<FileStats for 'sandeep': type=FileType.Directory>,\r\n <FileStats for 'venv': type=FileType.Directory>,\r\n <FileStats for 'sample.py': type=FileType.File, size=506>]\r\n\r\nIn [7]: !ls                                                                                                                                                                                                                                   \r\nsample.py  sandeep  venv\r\n\r\nIn [8]:   \r\n```\r\n\r\nIt looks like the new hadoop fs interface is doing a local lookup?\r\n\r\nOk fine...\r\n\r\n```Java\n\r\nIn [8]: sel = pyarrow.fs.FileSelector('hdfs:///user/rwiumli') # shouldnt have to do this                                                                                                                                                      \r\n\r\nIn [9]: c.get_target_stats(sel)                                                                                                                                                                                                               \r\nhdfsGetPathInfo(hdfs:///user/rwiumli): getFileInfo error:\r\nIllegalArgumentException: Wrong FS: hdfs:/user/rwiumli, expected: file:///java.lang.IllegalArgumentException: Wrong FS: hdfs:/user/rwiumli, expected: file:///\r\n\tat org.apache.hadoop.fs.FileSystem.checkPath(FileSystem.java:662)\r\n\tat org.apache.hadoop.fs.RawLocalFileSystem.pathToFile(RawLocalFileSystem.java:82)\r\n\tat org.apache.hadoop.fs.RawLocalFileSystem.deprecatedGetFileStatus(RawLocalFileSystem.java:593)\r\n\tat org.apache.hadoop.fs.RawLocalFileSystem.getFileLinkStatusInternal(RawLocalFileSystem.java:811)\r\n\tat org.apache.hadoop.fs.RawLocalFileSystem.getFileStatus(RawLocalFileSystem.java:588)\r\n\tat org.apache.hadoop.fs.FilterFileSystem.getFileStatus(FilterFileSystem.java:432)\r\n\tat org.apache.hadoop.fs.FileSystem.exists(FileSystem.java:1418)\r\nhdfsListDirectory(hdfs:///user/rwiumli): FileSystem#listStatus error:\r\nIllegalArgumentException: Wrong FS: hdfs:/user/rwiumli, expected: file:///java.lang.IllegalArgumentException: Wrong FS: hdfs:/user/rwiumli, expected: file:///\r\n\tat org.apache.hadoop.fs.FileSystem.checkPath(FileSystem.java:662)\r\n\tat org.apache.hadoop.fs.RawLocalFileSystem.pathToFile(RawLocalFileSystem.java:82)\r\n\tat org.apache.hadoop.fs.RawLocalFileSystem.listStatus(RawLocalFileSystem.java:410)\r\n\tat org.apache.hadoop.fs.FileSystem.listStatus(FileSystem.java:1566)\r\n\tat org.apache.hadoop.fs.FileSystem.listStatus(FileSystem.java:1609)\r\n\tat org.apache.hadoop.fs.ChecksumFileSystem.listStatus(ChecksumFileSystem.java:667)\r\n---------------------------------------------------------------------------\r\nOSError                                   Traceback (most recent call last)\r\n<ipython-input-9-f92157e01e47> in <module>\r\n----> 1 c.get_target_stats(sel)\r\n\r\n~/tmp/venv/lib/python3.6/site-packages/pyarrow/_fs.pyx in pyarrow._fs.FileSystem.get_target_stats()\r\n\r\n~/tmp/venv/lib/python3.6/site-packages/pyarrow/error.pxi in pyarrow.lib.pyarrow_internal_check_status()\r\n\r\n~/tmp/venv/lib/python3.6/site-packages/pyarrow/error.pxi in pyarrow.lib.check_status()\r\n\r\nOSError: HDFS list directory failed, errno: 22 (Invalid argument)\r\n\r\nIn [10]:   \r\n```\r\n\r\nand heres the rub\r\n\r\n```Java\n\r\nIn [10]: c = pyarrow.hdfs.HadoopFileSystem()                                                                                                                                                                                                  \r\n20/03/27 09:16:15 WARN util.NativeCodeLoader: Unable to load native-hadoop library for your platform... using builtin-java classes where applicable\r\n\r\nIn [11]: c.ls('/user/rwiumli')                                                                                                                                                                                                                \r\nOut[11]: \r\n['hdfs://nameservice/user/rwiumli/.Trash',\r\n 'hdfs://nameservice/user/rwiumli/.sparkStaging',\r\n 'hdfs://nameservice/user/rwiumli/.staging',\r\n 'hdfs://nameservice/user/rwiumli/acceptance',\r\n 'hdfs://nameservice/user/rwiumli/copy_test',\r\n 'hdfs://nameservice/user/rwiumli/hive-site.xml',\r\n 'hdfs://nameservice/user/rwiumli/mli',\r\n 'hdfs://nameservice/user/rwiumli/model_63702762843888.txt',\r\n 'hdfs://nameservice/user/rwiumli/oozie-oozi',\r\n 'hdfs://nameservice/user/rwiumli/sqoop',\r\n 'hdfs://nameservice/user/rwiumli/test',\r\n 'hdfs://nameservice/user/rwiumli/test_all.yml',\r\n 'hdfs://nameservice/user/rwiumli/user']\r\n\r\nIn [12]:   \r\n```\r\n\r\nFinally, system info:\r\n\r\n```Java\n\r\nIn [12]: !python --version                                                                                                                                                                                                                    \r\nPython 3.6.8\r\n\r\nIn [13]: !pip list                                                                                                                                                                                                                            \r\nPackage          Version\r\n---------------- -------\r\nbackcall         0.1.0  \r\ndecorator        4.4.1  \r\nipython          7.12.0 \r\nipython-genutils 0.2.0  \r\njedi             0.16.0 \r\njoblib           0.14.1 \r\nlightgbm         2.3.1  \r\nnumpy            1.18.1 \r\nparso            0.6.1  \r\npexpect          4.8.0  \r\npickleshare      0.7.5  \r\npip              20.0.2 \r\nprompt-toolkit   3.0.3  \r\nptyprocess       0.6.0  \r\npyarrow          0.16.0 \r\nPygments         2.5.2  \r\nscikit-learn     0.22.1 \r\nscipy            1.4.1  \r\nsetuptools       45.1.0 \r\nsix              1.14.0 \r\ntraitlets        4.3.3  \r\nwcwidth          0.1.8  \r\nwheel            0.34.2 \r\n\r\nIn [14]:  \r\n```",
        "created_at": "2020-03-27T13:20:12.000Z",
        "updated_at": "2021-05-12T17:14:50.000Z",
        "labels": [
            "Migrated from Jira",
            "Component: Python",
            "Type: bug"
        ],
        "closed": true,
        "closed_at": "2021-05-12T17:14:50.000Z"
    },
    "comments": [
        {
            "created_at": "2020-03-27T13:25:09.511Z",
            "body": "***Note**: [Comment](https://issues.apache.org/jira/browse/ARROW-8240?focusedCommentId=17068693) by Antoine Pitrou (apitrou):*\ncc `[~kszucs]`"
        },
        {
            "created_at": "2021-05-12T17:14:50.881Z",
            "body": "***Note**: [Comment](https://issues.apache.org/jira/browse/ARROW-8240?focusedCommentId=17343373) by Antoine Pitrou (apitrou):*\nI can't reproduce with PyArrow 4.0.0. `[~yalwan-iqvia]` \u00a0 If you still encounter this problem on the latest PyArrow version, feel free to ping."
        }
    ]
}