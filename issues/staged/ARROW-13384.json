{
    "issue": {
        "title": "[C++] Specify minimum required zstd version in cmake",
        "body": "***Note**: This issue was originally created as [ARROW-13384](https://issues.apache.org/jira/browse/ARROW-13384). Please see the [migration documentation](https://gist.github.com/toddfarmer/12aa88361532d21902818a6044fda4c3) for further details.*\n\n### Original Issue Description:\nThis causes the build to fail as ZSTD_minCLevel() can't be found <https://github.com/ursacomputing/crossbow/runs/3105438383> \r\n```\n\r\n[ 54%] Building CXX object src/arrow/CMakeFiles/arrow_objlib.dir/csv/converter.cc.o\r\ncd /private/var/folders/24/8k48jl6d249_n_qfxwsl6xvm0000gn/T/hbtmp/apache-arrow-20210719-2645-6nb4zw/build/src/arrow && /private/var/folders/24/8k48jl6d249_n_qfxwsl6xvm0000gn/T/build-apache-arrow/Library/Homebrew/shims/mac/super/clang++ -DARROW_EXPORTING -DARROW_HAVE_RUNTIME_AVX2 -DARROW_HAVE_RUNTIME_AVX512 -DARROW_HAVE_RUNTIME_BMI2 -DARROW_HAVE_RUNTIME_SSE4_2 -DARROW_HAVE_SSE4_2 -DARROW_JEMALLOC -DARROW_JEMALLOC_INCLUDE_DIR=\"\" -DARROW_MIMALLOC -DARROW_WITH_BACKTRACE -DARROW_WITH_LZ4 -DARROW_WITH_RE2 -DARROW_WITH_SNAPPY -DARROW_WITH_TIMING_TESTS -DARROW_WITH_UTF8PROC -DARROW_WITH_ZLIB -DARROW_WITH_ZSTD -DURI_STATIC_BUILD -DUTF8PROC_STATIC -I/private/var/folders/24/8k48jl6d249_n_qfxwsl6xvm0000gn/T/hbtmp/apache-arrow-20210719-2645-6nb4zw/build/src -I/private/var/folders/24/8k48jl6d249_n_qfxwsl6xvm0000gn/T/hbtmp/apache-arrow-20210719-2645-6nb4zw/cpp/src -I/private/var/folders/24/8k48jl6d249_n_qfxwsl6xvm0000gn/T/hbtmp/apache-arrow-20210719-2645-6nb4zw/cpp/src/generated -isystem /private/var/folders/24/8k48jl6d249_n_qfxwsl6xvm0000gn/T/hbtmp/apache-arrow-20210719-2645-6nb4zw/cpp/thirdparty/flatbuffers/include -isystem /private/var/folders/24/8k48jl6d249_n_qfxwsl6xvm0000gn/T/hbtmp/apache-arrow-20210719-2645-6nb4zw/build/jemalloc_ep-prefix/src -isystem /private/var/folders/24/8k48jl6d249_n_qfxwsl6xvm0000gn/T/hbtmp/apache-arrow-20210719-2645-6nb4zw/build/mimalloc_ep/src/mimalloc_ep/lib/mimalloc-1.6/include -isystem /private/var/folders/24/8k48jl6d249_n_qfxwsl6xvm0000gn/T/hbtmp/apache-arrow-20210719-2645-6nb4zw/build/rapidjson_ep/src/rapidjson_ep-install/include -isystem /private/var/folders/24/8k48jl6d249_n_qfxwsl6xvm0000gn/T/hbtmp/apache-arrow-20210719-2645-6nb4zw/build/xsimd_ep/src/xsimd_ep-install/include -isystem /private/var/folders/24/8k48jl6d249_n_qfxwsl6xvm0000gn/T/hbtmp/apache-arrow-20210719-2645-6nb4zw/build/re2_ep-install/include -isystem /private/var/folders/24/8k48jl6d249_n_qfxwsl6xvm0000gn/T/hbtmp/apache-arrow-20210719-2645-6nb4zw/build/utf8proc_ep-install/include -isystem /private/var/folders/24/8k48jl6d249_n_qfxwsl6xvm0000gn/T/hbtmp/apache-arrow-20210719-2645-6nb4zw/cpp/thirdparty/hadoop/include -Qunused-arguments -fcolor-diagnostics -O3 -DNDEBUG  -Wall -Wno-unknown-Note-option -Wno-pass-failed -stdlib=libc++ -msse4.2  -DNDEBUG -isysroot /Applications/Xcode_12.4.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX11.1.sdk -mmacosx-version-min=10.15 -fPIC -std=c++11 -o CMakeFiles/arrow_objlib.dir/csv/converter.cc.o -c /private/var/folders/24/8k48jl6d249_n_qfxwsl6xvm0000gn/T/hbtmp/apache-arrow-20210719-2645-6nb4zw/cpp/src/arrow/csv/converter.cc\r\n/private/var/folders/24/8k48jl6d249_n_qfxwsl6xvm0000gn/T/hbtmp/apache-arrow-20210719-2645-6nb4zw/cpp/src/arrow/util/compression_zstd.cc:231:59: error: use of undeclared identifier 'ZSTD_minCLevel'; did you mean 'ZSTD_maxCLevel'?\r\n  int minimum_compression_level() const override { return ZSTD_minCLevel(); }\r\n                                                          ^~~~~~~~~~~~~~\r\n                                                          ZSTD_maxCLevel\r\n/private/var/folders/24/8k48jl6d249_n_qfxwsl6xvm0000gn/T/build-apache-arrow/include/zstd.h:142:25: note: 'ZSTD_maxCLevel' declared here\r\nZSTDLIB_API int         ZSTD_maxCLevel(void);               /*!< maximum compression level available */\r\n                        ^\r\n1 error generated.\r\nmake[2]: *** [src/arrow/CMakeFiles/arrow_objlib.dir/util/compression_zstd.cc.o] Error 1\r\nmake[2]: *** Waiting for unfinished jobs....\r\nmake[1]: *** [src/arrow/CMakeFiles/arrow_objlib.dir/all] Error 2\r\nmake: *** [all] Error 2==> Formula\r\nPath: /Users/runner/work/crossbow/crossbow/arrow/r/check/arrow.Rcheck/00_pkg_src/arrow/tools/apache-arrow.rb\r\n==> Configuration\r\nHOMEBREW_VERSION: >=1.7.1 (shallow or no git repository)\r\nORIGIN: (none)\r\nHEAD: (none)\r\nLast commit: never\r\nCore tap ORIGIN: https://github.com/autobrew/homebrew-core\r\nCore tap HEAD: 73b60196102b25b6a91197210cad74ae7833b871\r\nCore tap last commit: 8 weeks ago\r\nHOMEBREW_PREFIX: /private/var/folders/24/8k48jl6d249_n_qfxwsl6xvm0000gn/T/build-apache-arrow\r\nHOMEBREW_REPOSITORY: /private/var/folders/24/8k48jl6d249_n_qfxwsl6xvm0000gn/T/build-apache-arrow\r\nHOMEBREW_CELLAR: /private/var/folders/24/8k48jl6d249_n_qfxwsl6xvm0000gn/T/build-apache-arrow/Cellar\r\nHOMEBREW_CACHE: /var/folders/24/8k48jl6d249_n_qfxwsl6xvm0000gn/T/\r\nHOMEBREW_TEMP: /private/var/folders/24/8k48jl6d249_n_qfxwsl6xvm0000gn/T/hbtmp\r\nHOMEBREW_CASK_OPTS: --no-quarantine\r\nHOMEBREW_CLEANUP_PERIODIC_FULL_DAYS: 3650\r\nHOMEBREW_GIT: git\r\nHOMEBREW_NO_ANALYTICS: 1\r\nHOMEBREW_NO_AUTO_UPDATE: 1\r\nCPU: 3-core 64-bit ivybridge\r\nHomebrew Ruby: 2.3.7 => /private/var/folders/24/8k48jl6d249_n_qfxwsl6xvm0000gn/T/build-apache-arrow/Library/Homebrew/vendor/portable-ruby/2.3.7/bin/ruby\r\nClang: 12.0 build 1200\r\nGit: 2.24.3 => /Applications/Xcode_12.4.app/Contents/Developer/usr/bin/git\r\nCurl: 7.64.1 => /usr/bin/curl\r\nJava: 14.0.2, 13.0.2, 12.0.2, 11.0.11, 1.8.0_292\r\nmacOS: 10.15.7-x86_64\r\nCLT: 12.4.0.0.1.1610135815\r\nCLT headers: 12.4.0.0.1.1610135815\r\nXcode: 12.4 => /Applications/Xcode_12.4.app/Contents/Developer\r\nError: Error: apache-arrow HEAD-91a6ea4 did not build \n```",
        "created_at": "2021-07-19T16:48:21.000Z",
        "updated_at": "2021-07-20T12:25:06.000Z",
        "labels": [
            "Migrated from Jira",
            "Component: C++",
            "Type: bug"
        ],
        "closed": true,
        "closed_at": "2021-07-20T01:25:11.000Z"
    },
    "comments": [
        {
            "created_at": "2021-07-19T16:49:14.704Z",
            "body": "***Note**: [Comment](https://issues.apache.org/jira/browse/ARROW-13384?focusedCommentId=17383449) by David Li (lidavidm):*\nWe're installing zstd 1.3.5:\r\n```\n\r\n* installing *source* package \u2018arrow\u2019 ...\r\n** using staged installation\r\n*** Downloading apache-arrow\r\n**** Using local manifest for apache-arrow\r\nMon Jul 19 15:21:39 UTC 2021: Auto-brewing apache-arrow in /var/folders/24/8k48jl6d249_n_qfxwsl6xvm0000gn/T//build-apache-arrow...\r\n==> Tapping autobrew/core from https://github.com/autobrew/homebrew-core\r\nTapped 2 commands and 4636 formulae (4,885 files, 12.7MB).\r\naws-sdk-cpp\r\nlz4\r\nsnappy\r\nopenssl\r\nthrift\r\nzstd\r\n==> Downloading https://autobrew.github.io/bottles/aws-sdk-cpp-1.7.364.high_sierra.bottle.2.tar.gz\r\n==> Pouring aws-sdk-cpp-1.7.364.high_sierra.bottle.2.tar.gz\r\n==> Skipping post_install step for autobrew...\r\n\ud83c\udf7a  /private/var/folders/24/8k48jl6d249_n_qfxwsl6xvm0000gn/T/build-apache-arrow/Cellar/aws-sdk-cpp/1.7.364: 967 files, 21.8MB\r\n==> Downloading https://bintray-archive.github.io/bottles/lz4-1.8.3.high_sierra.bottle.tar.gz\r\n==> Pouring lz4-1.8.3.high_sierra.bottle.tar.gz\r\n==> Skipping post_install step for autobrew...\r\n\ud83c\udf7a  /private/var/folders/24/8k48jl6d249_n_qfxwsl6xvm0000gn/T/build-apache-arrow/Cellar/lz4/1.8.3: 22 files, 487.9KB\r\n==> Downloading https://bintray-archive.github.io/bottles/snappy-1.1.7_1.high_sierra.bottle.tar.gz\r\n==> Pouring snappy-1.1.7_1.high_sierra.bottle.tar.gz\r\n==> Skipping post_install step for autobrew...\r\n\ud83c\udf7a  /private/var/folders/24/8k48jl6d249_n_qfxwsl6xvm0000gn/T/build-apache-arrow/Cellar/snappy/1.1.7_1: 18 files, 118.1KB\r\n==> Downloading https://bintray-archive.github.io/bottles/openssl-1.0.2p.high_sierra.bottle.tar.gz\r\n==> Pouring openssl-1.0.2p.high_sierra.bottle.tar.gz\r\n==> Skipping post_install step for autobrew...\r\n\ud83c\udf7a  /private/var/folders/24/8k48jl6d249_n_qfxwsl6xvm0000gn/T/build-apache-arrow/Cellar/openssl/1.0.2p: 1,793 files, 12.3MB\r\n==> Downloading https://bintray-archive.github.io/bottles/thrift-0.11.0.high_sierra.bottle.tar.gz\r\n==> Pouring thrift-0.11.0.high_sierra.bottle.tar.gz\r\n==> Skipping post_install step for autobrew...\r\n\ud83c\udf7a  /private/var/folders/24/8k48jl6d249_n_qfxwsl6xvm0000gn/T/build-apache-arrow/Cellar/thrift/0.11.0: 102 files, 7MB\r\n==> Downloading https://bintray-archive.github.io/bottles/zstd-1.3.5.high_sierra.bottle.tar.gz\r\n==> Pouring zstd-1.3.5.high_sierra.bottle.tar.gz\r\n==> Skipping post_install step for autobrew... \n```"
        },
        {
            "created_at": "2021-07-19T16:51:00.738Z",
            "body": "***Note**: [Comment](https://issues.apache.org/jira/browse/ARROW-13384?focusedCommentId=17383450) by David Li (lidavidm):*\nLikely it's because GHA uses High Sierra which is not supported by Homebrew anymore and so only an old version is available as a bottle"
        },
        {
            "created_at": "2021-07-19T16:57:20.878Z",
            "body": "***Note**: [Comment](https://issues.apache.org/jira/browse/ARROW-13384?focusedCommentId=17383456) by Neal Richardson (npr):*\nIDK that this is GHA's fault actually, but in any case we should be able to get the zstd version updated for autobrew. I'll look into it. \r\n\r\nMore generally though, is there a minimum version we require? Should that be checked/enforced in cmake?"
        },
        {
            "created_at": "2021-07-19T17:00:58.609Z",
            "body": "***Note**: [Comment](https://issues.apache.org/jira/browse/ARROW-13384?focusedCommentId=17383458) by David Li (lidavidm):*\nSince ARROW-13091 we require v1.3.6 for minCLevel <https://github.com/facebook/zstd/blob/705a62b612151cff06f453bc3452b9e99088a574/CHANGELOG#L312>\r\n\r\nWe should probably enforce that in CMake, yeah."
        },
        {
            "created_at": "2021-07-19T17:07:18.473Z",
            "body": "***Note**: [Comment](https://issues.apache.org/jira/browse/ARROW-13384?focusedCommentId=17383460) by Neal Richardson (npr):*\nOk, submitted PR to bump the version in the autobrew bottles https://github.com/autobrew/homebrew-core/pull/72 cc `[~jeroenooms]`\r\n\r\nI'll make a PR here to add the cmake version check."
        },
        {
            "created_at": "2021-07-20T01:25:11.649Z",
            "body": "***Note**: [Comment](https://issues.apache.org/jira/browse/ARROW-13384?focusedCommentId=17383685) by Kouhei Sutou (kou):*\nIssue resolved by pull request 10747\n<https://github.com/apache/arrow/pull/10747>"
        }
    ]
}