{
    "issue": {
        "title": "[Python] test_plasma.py fails",
        "body": "***Note**: This issue was originally created as [ARROW-3095](https://issues.apache.org/jira/browse/ARROW-3095). Please see the [migration documentation](https://gist.github.com/toddfarmer/12aa88361532d21902818a6044fda4c3) for further details.*\n\n### Original Issue Description:\nAll tests in `test_plasma.py` fail here. It seems that plasma_store fails launching or something:\r\n```Java\n\r\n$ python -m pytest -x -r s --tb=native pyarrow/tests/test_plasma.py \r\n==================================================================== test session starts ====================================================================\r\nplatform linux -- Python 3.7.0, pytest-3.7.2, py-1.5.4, pluggy-0.7.1\r\nrootdir: /home/antoine/arrow/python, inifile: setup.cfg\r\nplugins: timeout-1.3.1, faulthandler-1.5.0\r\ncollected 24 items                                                                                                                                          \r\n\r\npyarrow/tests/test_plasma.py E\r\n\r\n=========================================================================== ERRORS ===========================================================================\r\n________________________________________ ERROR at setup of TestPlasmaClient.test_connection_failure_raises_exception _________________________________________\r\nTraceback (most recent call last):\r\n  File \"/home/antoine/arrow/python/pyarrow/tests/test_plasma.py\", line 119, in setup_method\r\n    self.plasma_client = plasma.connect(plasma_store_name, \"\", 64)\r\n  File \"pyarrow/_plasma.pyx\", line 691, in pyarrow._plasma.connect\r\n    check_status(result.client.get()\r\n  File \"pyarrow/error.pxi\", line 83, in pyarrow.lib.check_status\r\n    raise ArrowIOError(message)\r\npyarrow.lib.ArrowIOError: ../src/plasma/client.cc:921 code: ConnectIpcSocketRetry(store_socket_name, num_retries, -1, &store_conn_)\r\nCould not connect to socket /tmp/test_plasma-ikgi25pf/plasma.sock\r\n------------------------------------------------------------------- Captured stderr setup --------------------------------------------------------------------\r\nConnection to IPC socket failed for pathname /tmp/test_plasma-ikgi25pf/plasma.sock, retrying 50 more times\r\nConnection to IPC socket failed for pathname /tmp/test_plasma-ikgi25pf/plasma.sock, retrying 49 more times\r\nConnection to IPC socket failed for pathname /tmp/test_plasma-ikgi25pf/plasma.sock, retrying 48 more times\r\nConnection to IPC socket failed for pathname /tmp/test_plasma-ikgi25pf/plasma.sock, retrying 47 more times\r\nConnection to IPC socket failed for pathname /tmp/test_plasma-ikgi25pf/plasma.sock, retrying 46 more times\r\nConnection to IPC socket failed for pathname /tmp/test_plasma-ikgi25pf/plasma.sock, retrying 45 more times\r\nConnection to IPC socket failed for pathname /tmp/test_plasma-ikgi25pf/plasma.sock, retrying 44 more times\r\nConnection to IPC socket failed for pathname /tmp/test_plasma-ikgi25pf/plasma.sock, retrying 43 more times\r\nConnection to IPC socket failed for pathname /tmp/test_plasma-ikgi25pf/plasma.sock, retrying 42 more times\r\nConnection to IPC socket failed for pathname /tmp/test_plasma-ikgi25pf/plasma.sock, retrying 41 more times\r\nConnection to IPC socket failed for pathname /tmp/test_plasma-ikgi25pf/plasma.sock, retrying 40 more times\r\nConnection to IPC socket failed for pathname /tmp/test_plasma-ikgi25pf/plasma.sock, retrying 39 more times\r\nConnection to IPC socket failed for pathname /tmp/test_plasma-ikgi25pf/plasma.sock, retrying 38 more times\r\nConnection to IPC socket failed for pathname /tmp/test_plasma-ikgi25pf/plasma.sock, retrying 37 more times\r\nConnection to IPC socket failed for pathname /tmp/test_plasma-ikgi25pf/plasma.sock, retrying 36 more times\r\nConnection to IPC socket failed for pathname /tmp/test_plasma-ikgi25pf/plasma.sock, retrying 35 more times\r\nConnection to IPC socket failed for pathname /tmp/test_plasma-ikgi25pf/plasma.sock, retrying 34 more times\r\nConnection to IPC socket failed for pathname /tmp/test_plasma-ikgi25pf/plasma.sock, retrying 33 more times\r\nConnection to IPC socket failed for pathname /tmp/test_plasma-ikgi25pf/plasma.sock, retrying 32 more times\r\nConnection to IPC socket failed for pathname /tmp/test_plasma-ikgi25pf/plasma.sock, retrying 31 more times\r\nConnection to IPC socket failed for pathname /tmp/test_plasma-ikgi25pf/plasma.sock, retrying 30 more times\r\nConnection to IPC socket failed for pathname /tmp/test_plasma-ikgi25pf/plasma.sock, retrying 29 more times\r\nConnection to IPC socket failed for pathname /tmp/test_plasma-ikgi25pf/plasma.sock, retrying 28 more times\r\nConnection to IPC socket failed for pathname /tmp/test_plasma-ikgi25pf/plasma.sock, retrying 27 more times\r\nConnection to IPC socket failed for pathname /tmp/test_plasma-ikgi25pf/plasma.sock, retrying 26 more times\r\nConnection to IPC socket failed for pathname /tmp/test_plasma-ikgi25pf/plasma.sock, retrying 25 more times\r\nConnection to IPC socket failed for pathname /tmp/test_plasma-ikgi25pf/plasma.sock, retrying 24 more times\r\nConnection to IPC socket failed for pathname /tmp/test_plasma-ikgi25pf/plasma.sock, retrying 23 more times\r\nConnection to IPC socket failed for pathname /tmp/test_plasma-ikgi25pf/plasma.sock, retrying 22 more times\r\nConnection to IPC socket failed for pathname /tmp/test_plasma-ikgi25pf/plasma.sock, retrying 21 more times\r\nConnection to IPC socket failed for pathname /tmp/test_plasma-ikgi25pf/plasma.sock, retrying 20 more times\r\nConnection to IPC socket failed for pathname /tmp/test_plasma-ikgi25pf/plasma.sock, retrying 19 more times\r\nConnection to IPC socket failed for pathname /tmp/test_plasma-ikgi25pf/plasma.sock, retrying 18 more times\r\nConnection to IPC socket failed for pathname /tmp/test_plasma-ikgi25pf/plasma.sock, retrying 17 more times\r\nConnection to IPC socket failed for pathname /tmp/test_plasma-ikgi25pf/plasma.sock, retrying 16 more times\r\nConnection to IPC socket failed for pathname /tmp/test_plasma-ikgi25pf/plasma.sock, retrying 15 more times\r\nConnection to IPC socket failed for pathname /tmp/test_plasma-ikgi25pf/plasma.sock, retrying 14 more times\r\nConnection to IPC socket failed for pathname /tmp/test_plasma-ikgi25pf/plasma.sock, retrying 13 more times\r\nConnection to IPC socket failed for pathname /tmp/test_plasma-ikgi25pf/plasma.sock, retrying 12 more times\r\nConnection to IPC socket failed for pathname /tmp/test_plasma-ikgi25pf/plasma.sock, retrying 11 more times\r\nConnection to IPC socket failed for pathname /tmp/test_plasma-ikgi25pf/plasma.sock, retrying 10 more times\r\nConnection to IPC socket failed for pathname /tmp/test_plasma-ikgi25pf/plasma.sock, retrying 9 more times\r\nConnection to IPC socket failed for pathname /tmp/test_plasma-ikgi25pf/plasma.sock, retrying 8 more times\r\nConnection to IPC socket failed for pathname /tmp/test_plasma-ikgi25pf/plasma.sock, retrying 7 more times\r\nConnection to IPC socket failed for pathname /tmp/test_plasma-ikgi25pf/plasma.sock, retrying 6 more times\r\nConnection to IPC socket failed for pathname /tmp/test_plasma-ikgi25pf/plasma.sock, retrying 5 more times\r\nConnection to IPC socket failed for pathname /tmp/test_plasma-ikgi25pf/plasma.sock, retrying 4 more times\r\nConnection to IPC socket failed for pathname /tmp/test_plasma-ikgi25pf/plasma.sock, retrying 3 more times\r\nConnection to IPC socket failed for pathname /tmp/test_plasma-ikgi25pf/plasma.sock, retrying 2 more times\r\nConnection to IPC socket failed for pathname /tmp/test_plasma-ikgi25pf/plasma.sock, retrying 1 more times\r\n================================================================== 1 error in 5.15 seconds ===================================================================\r\n```\r\n",
        "created_at": "2018-08-20T17:03:55.000Z",
        "updated_at": "2018-08-21T21:05:03.000Z",
        "labels": [
            "Migrated from Jira",
            "Component: C++ - Plasma",
            "Component: Python",
            "Type: bug"
        ],
        "closed": true,
        "closed_at": "2018-08-21T21:04:53.000Z"
    },
    "comments": [
        {
            "created_at": "2018-08-20T17:28:30.121Z",
            "body": "***Note**: [Comment](https://issues.apache.org/jira/browse/ARROW-3095?focusedCommentId=16586270) by Antoine Pitrou (apitrou):*\nI'm afraid this is a real WTF here. When the Arrow C++ install is run, the installed `plasma_store` is a normal executable that seems to work correctly:\r\n```Java\n\r\n$ /home/antoine/arrow/python/pyarrow/plasma_store -s /tmp/plasma.sock -m 10000\r\nAllowing the Plasma store to use up to 1e-05GB of memory.\r\nStarting object store with directory /dev/shm and huge page support disabled\r\n```\r\n\r\nWhen the pyarrow install is run (via setup.py), the installed `plasma_store` is some Python script that stupidly executes itself in a loop (see `_plasma_store_entry_point`).\r\n\r\n`[~pcmoritz]` why does this even exist?"
        },
        {
            "created_at": "2018-08-20T17:58:15.554Z",
            "body": "***Note**: [Comment](https://issues.apache.org/jira/browse/ARROW-3095?focusedCommentId=16586317) by Wes McKinney (wesm):*\nSee https://github.com/apache/arrow/pull/975"
        },
        {
            "created_at": "2018-08-20T18:05:42.463Z",
            "body": "***Note**: [Comment](https://issues.apache.org/jira/browse/ARROW-3095?focusedCommentId=16586324) by Antoine Pitrou (apitrou):*\nThat must be it. Unfortunately:\r\n```Java\n\r\n$ cat pyarrow/plasma_store \r\n#!/home/antoine/miniconda3/envs/pyarrow/bin/python\r\n# EASY-INSTALL-ENTRY-SCRIPT: 'pyarrow','console_scripts','plasma_store'\r\n__requires__ = 'pyarrow'\r\nimport re\r\nimport sys\r\nfrom pkg_resources import load_entry_point\r\n\r\nif __name__ == '__main__':\r\n    sys.argv[0] = re.sub(r'(-script\\.pyw?|\\.exe)?$', '', sys.argv[0])\r\n    sys.exit(\r\n        load_entry_point('pyarrow', 'console_scripts', 'plasma_store')()\r\n    )\r\n```\r\n\r\nSo the entry point is executing itself endlessly..."
        },
        {
            "created_at": "2018-08-20T18:07:01.120Z",
            "body": "***Note**: [Comment](https://issues.apache.org/jira/browse/ARROW-3095?focusedCommentId=16586328) by Antoine Pitrou (apitrou):*\nNote I'm using `python setup.py develop` with setuptools 40.0."
        },
        {
            "created_at": "2018-08-20T18:32:39.092Z",
            "body": "***Note**: [Comment](https://issues.apache.org/jira/browse/ARROW-3095?focusedCommentId=16586354) by Antoine Pitrou (apitrou):*\nSo basically the current scheme \"works\" if you build the C++ side once, and then build the Python side once. But if you build the Python side twice, then all your `plasma_store` instances are the Python script wrappers, which end up executing themselves endlessly."
        },
        {
            "created_at": "2018-08-20T18:43:03.181Z",
            "body": "***Note**: [Comment](https://issues.apache.org/jira/browse/ARROW-3095?focusedCommentId=16586366) by Antoine Pitrou (apitrou):*\nA clean way out of this would be to generate an executable `plasma_store_real` that would get symlinked to `plasma_store` by the C++ install, and exec'ed by the Python entry point when using the Python install.\r\n\r\nUnfortunately CMake is too limited (!) to let you rename or symlink targets:\r\nhttps://cmake.org/pipermail/cmake/2011-May/044613.html"
        },
        {
            "created_at": "2018-08-20T18:50:21.259Z",
            "body": "***Note**: [Comment](https://issues.apache.org/jira/browse/ARROW-3095?focusedCommentId=16586373) by Antoine Pitrou (apitrou):*\nAnother option is to consider that people who want to use `plasma_store` have to install the C++ libraries. People can still use the Plasma _client_ from Python without installing `plasma_store`..."
        },
        {
            "created_at": "2018-08-20T18:51:19.205Z",
            "body": "***Note**: [Comment](https://issues.apache.org/jira/browse/ARROW-3095?focusedCommentId=16586374) by Antoine Pitrou (apitrou):*\nOr you bite the bullet and call the Python entry point `py_plasma_store` (or anything else than `plasma_store`, really)."
        },
        {
            "created_at": "2018-08-20T19:07:33.362Z",
            "body": "***Note**: [Comment](https://issues.apache.org/jira/browse/ARROW-3095?focusedCommentId=16586380) by Wes McKinney (wesm):*\nSo we can resolve this by naming the entry point something other than the name of the executable itself? That seems reasonable. `[~pcmoritz]`?"
        },
        {
            "created_at": "2018-08-20T19:18:24.034Z",
            "body": "***Note**: [Comment](https://issues.apache.org/jira/browse/ARROW-3095?focusedCommentId=16586387) by Philipp Moritz (pcmoritz):*\nOk yeah, my plan is to rename the C++ executable to plasma_store_server and leave the entry point at plasma_store!"
        },
        {
            "created_at": "2018-08-21T21:04:53.509Z",
            "body": "***Note**: [Comment](https://issues.apache.org/jira/browse/ARROW-3095?focusedCommentId=16588007) by Wes McKinney (wesm):*\nIssue resolved by pull request 2452\n<https://github.com/apache/arrow/pull/2452>"
        }
    ]
}