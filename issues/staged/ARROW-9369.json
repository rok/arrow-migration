{
    "issue": {
        "title": "[Python] Support conversion from python sequence to dictionary type",
        "body": "***Note**: This issue was originally created as [ARROW-9369](https://issues.apache.org/jira/browse/ARROW-9369). Please see the [migration documentation](https://gist.github.com/toddfarmer/12aa88361532d21902818a6044fda4c3) for further details.*\n\n### Original Issue Description:\nConverting from a python sequence with specified target type isn't implemented yet for dictionary type:\r\n\r\n```Java\n\r\nIn [1]: pa.array(['a', 'b', 'a'], pa.dictionary(pa.int32(), pa.string()))                                                                                                                                          \r\n---------------------------------------------------------------------------\r\nArrowNotImplementedError                  Traceback (most recent call last)\r\n<ipython-input-1-bda8628a4917> in <module>\r\n----> 1 pa.array(['a', 'b', 'a'], pa.dictionary(pa.int32(), pa.string()))\r\n\r\n~/scipy/repos/arrow/python/pyarrow/array.pxi in pyarrow.lib.array()\r\n\r\n~/scipy/repos/arrow/python/pyarrow/array.pxi in pyarrow.lib._sequence_to_array()\r\n\r\n~/scipy/repos/arrow/python/pyarrow/error.pxi in pyarrow.lib.check_status()\r\n\r\nArrowNotImplementedError: Sequence converter for type dictionary<values=string, indices=int32, ordered=0> not implemented\r\n```\r\n\r\n\r\n\r\n-----\r\n_Original report_\r\n\r\nHello, I am trying to do the following (please correct me if I am doing some non-sense):\r\n```python\n\r\nimport pandas as pd\r\nimport pyarrow as pa\r\nimport pyarrow.parquet as pq\r\n\r\nfields = [pa.field(\"object\", pa.dictionary(pa.int64(), pa.string()))]\r\ndata = {\"object\": { \r\n                               \"a\": \"a\",\r\n                               \"b\": \"b\",\r\n                               \"c\": \"c\", \r\n                               \"s\": \"d\" }}\r\ndf = pd.DataFrame(data)\r\ntable = pa.Table.from_pandas(df, pa.schema(fields))\r\npq.write_table(table, \"test.parquet\") \r\n```\r\nand I am getting:\r\n```\n\r\nTraceback (most recent call last):\r\n  File \"pa_test.py\", line 17, in <module>\r\n    table = pa.Table.from_pandas(df, pa.schema(fields))\r\n  File \"pyarrow/table.pxi\", line 1451, in pyarrow.lib.Table.from_pandas\r\n  File \"/home/tremes/GITHUB/data-pipeline/venv/lib64/python3.7/site-packages/pyarrow/pandas_compat.py\", line 575, in dataframe_to_arrays\r\n    for c, f in zip(columns_to_convert, convert_fields)]\r\n  File \"/home/tremes/GITHUB/data-pipeline/venv/lib64/python3.7/site-packages/pyarrow/pandas_compat.py\", line 575, in <listcomp>\r\n    for c, f in zip(columns_to_convert, convert_fields)]\r\n  File \"/home/tremes/GITHUB/data-pipeline/venv/lib64/python3.7/site-packages/pyarrow/pandas_compat.py\", line 566, in convert_column\r\n    raise e\r\n  File \"/home/tremes/GITHUB/data-pipeline/venv/lib64/python3.7/site-packages/pyarrow/pandas_compat.py\", line 560, in convert_column\r\n    result = pa.array(col, type=type_, from_pandas=True, safe=safe)\r\n  File \"pyarrow/array.pxi\", line 265, in pyarrow.lib.array\r\n  File \"pyarrow/array.pxi\", line 80, in pyarrow.lib._ndarray_to_array\r\n  File \"pyarrow/error.pxi\", line 106, in pyarrow.lib.check_status\r\npyarrow.lib.ArrowNotImplementedError: ('Sequence converter for type dictionary<values=string, indices=int64, ordered=0> not implemented', 'Conversion failed for column object with type object')\r\n```\r\nWorkaround is to use `df.to_parquet(\"test.parquet\")`",
        "created_at": "2020-07-08T08:40:46.000Z",
        "updated_at": "2022-09-08T06:47:23.000Z",
        "labels": [
            "Migrated from Jira",
            "Component: Python",
            "Type: bug"
        ],
        "closed": true,
        "closed_at": "2022-09-08T06:47:23.000Z"
    },
    "comments": [
        {
            "created_at": "2020-07-08T10:01:50.268Z",
            "body": "***Note**: [Comment](https://issues.apache.org/jira/browse/ARROW-9369?focusedCommentId=17153459) by Joris Van den Bossche (jorisvandenbossche):*\nThe dictionary type maps to pandas' categorical type, so you can first convert the dataframe column to a categorical, and then this works:\r\n\r\n```Java\n\r\nIn [17]: df[\"object\"] = df[\"object\"].astype(\"category\")                                                                                                                                                            \r\n\r\nIn [19]: table = pa.Table.from_pandas(df, pa.schema(fields))                                                                                                                                                       \r\n\r\nIn [20]: table                                                                                                                                                                                                     \r\nOut[20]: \r\npyarrow.Table\r\nobject: dictionary<values=string, indices=int64, ordered=0>\r\n```\r\n\r\nIn principle, the converter for the dictionary type could be expanded to take a non-categorical type, but that is right now not yet implemented.\r\n\r\n"
        },
        {
            "created_at": "2020-07-09T06:44:29.895Z",
            "body": "***Note**: [Comment](https://issues.apache.org/jira/browse/ARROW-9369?focusedCommentId=17154232) by Joris Van den Bossche (jorisvandenbossche):*\nI renamed the issue to reflect the possible enhancement to add a converter from a general python sequence to a dictionary type."
        },
        {
            "created_at": "2021-02-28T10:08:19.707Z",
            "body": "***Note**: [Comment](https://issues.apache.org/jira/browse/ARROW-9369?focusedCommentId=17292362) by ARF (ARF1):*\nI think this issue has been fixed and can be closed:\r\n\r\n```python\n\r\npa.array(['a', 'b', 'a'], pa.dictionary(pa.int32(), pa.string()))\r\n```\r\n\r\nOutput:\r\n```none\n\r\n<pyarrow.lib.DictionaryArray object at 0x00000172FAABEBA0>\r\n\r\n-- dictionary:\r\n  [\r\n    \"a\",\r\n    \"b\"\r\n  ]\r\n-- indices:\r\n  [\r\n    0,\r\n    1,\r\n    0\r\n  ]\r\n```"
        },
        {
            "created_at": "2022-09-08T06:46:14.714Z",
            "body": "***Note**: [Comment](https://issues.apache.org/jira/browse/ARROW-9369?focusedCommentId=17601674) by Joris Van den Bossche (jorisvandenbossche):*\nYes, think this was fixed by ARROW-9992"
        }
    ]
}