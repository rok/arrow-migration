{
    "issue": {
        "title": "[C++] Segmentation fault on arrow-compute-hash-join-node-test on macos nightlies",
        "body": "***Note**: This issue was originally created as [ARROW-17292](https://issues.apache.org/jira/browse/ARROW-17292). Please see the [migration documentation](https://gist.github.com/toddfarmer/12aa88361532d21902818a6044fda4c3) for further details.*\n\n### Original Issue Description:\nSome of our nightly builds are failing due to a segmentation fault on hash-join tests:\r\n```java\n\r\n\u00a033/90 Test #35: arrow-compute-hash-join-node-test .........***Failed \u00a0 \u00a01.21 sec\r\nRunning arrow-compute-hash-join-node-test, redirecting output into /var/folders/24/8k48jl6d249_n_qfxwsl6xvm0000gn/T/arrow-HEAD.XXXXX.W72iCJcj/cpp-build/build/test-logs/arrow-compute-hash-join-node-test.txt (attempt 1/1)\r\n/Users/runner/work/crossbow/crossbow/arrow/cpp/build-support/run-test.sh: line 88: 78018 Segmentation fault: 11 \u00a0$TEST_EXECUTABLE \"$@\" > $LOGFILE.raw 2>&1\r\nRunning main() from /var/folders/24/8k48jl6d249_n_qfxwsl6xvm0000gn/T/arrow-HEAD.XXXXX.W72iCJcj/cpp-build/googletest_ep-prefix/src/googletest_ep/googletest/src/gtest_main.cc\r\n[==========] Running 29 tests from 4 test suites.\r\n[----------] Global test environment set-up.\r\n[----------] 10 tests from HashJoin\r\n[ RUN \u00a0 \u00a0 \u00a0] HashJoin.Suffix\r\n[ \u00a0 \u00a0 \u00a0 OK ] HashJoin.Suffix (4 ms)\r\n[ RUN \u00a0 \u00a0 \u00a0] HashJoin.Random\r\n/private/var/folders/24/8k48jl6d249_n_qfxwsl6xvm0000gn/T/arrow-HEAD.XXXXX.W72iCJcj/cpp-build/src/arrow/compute/exec \n```\r\nThe failures can be seen. It seems to be only related to macos from the failed jobs:\r\n[verify-rc-source-cpp-macos-conda-amd64](https://github.com/ursacomputing/crossbow/runs/7631965199?check_suite_focus=true)\r\n[verify-rc-source-integration-macos-conda-amd64](https://github.com/ursacomputing/crossbow/runs/7631969879?check_suite_focus=true)\r\n[verify-rc-source-python-macos-amd64](https://github.com/ursacomputing/crossbow/runs/7631926429?check_suite_focus=true)",
        "created_at": "2022-08-03T10:14:01.000Z",
        "updated_at": "2022-11-17T05:10:03.000Z",
        "labels": [
            "Migrated from Jira",
            "Component: C++",
            "Type: bug"
        ],
        "closed": false
    },
    "comments": [
        {
            "created_at": "2022-08-22T09:59:12.000Z",
            "body": "***Note**: [Comment](https://issues.apache.org/jira/browse/ARROW-17292?focusedCommentId=17582856) by Ra\u00fal Cumplido (raulcd):*\nThis seems to continue happening on some nightly failures, example: 21st August on [verify-rc-source-python-macos-amd64:](https://github.com/ursacomputing/crossbow/runs/7939002867?check_suite_focus=true)\r\n```java\n\r\n36/90 Test #35: arrow-compute-hash-join-node-test .........***Failed \u00a0 \u00a03.62 sec\r\nRunning arrow-compute-hash-join-node-test, redirecting output into /var/folders/24/8k48jl6d249_n_qfxwsl6xvm0000gn/T/arrow-HEAD.XXXXX.6JD4aZtZ/cpp-build/build/test-logs/arrow-compute-hash-join-node-test.txt (attempt 1/1)\r\n/Users/runner/work/crossbow/crossbow/arrow/cpp/build-support/run-test.sh: line 88: 88684 Segmentation fault: 11 \u00a0$TEST_EXECUTABLE \"$@\" > $LOGFILE.raw 2>&1\r\nRunning main() from /var/folders/24/8k48jl6d249_n_qfxwsl6xvm0000gn/T/arrow-HEAD.XXXXX.6JD4aZtZ/cpp-build/googletest_ep-prefix/src/googletest_ep/googletest/src/gtest_main.cc\r\n[==========] Running 29 tests from 4 test suites.\r\n[----------] Global test environment set-up.\r\n[----------] 10 tests from HashJoin\r\n[ RUN \u00a0 \u00a0 \u00a0] HashJoin.Suffix\r\n[ \u00a0 \u00a0 \u00a0 OK ] HashJoin.Suffix (5 ms)\r\n[ RUN \u00a0 \u00a0 \u00a0] HashJoin.Random\r\n/private/var/folders/24/8k48jl6d249_n_qfxwsl6xvm0000gn/T/arrow-HEAD.XXXXX.6JD4aZtZ/cpp-build/src/arrow/compute/exec \n```"
        },
        {
            "created_at": "2022-10-12T09:15:42.016Z",
            "body": "***Note**: [Comment](https://issues.apache.org/jira/browse/ARROW-17292?focusedCommentId=17616294) by Vibhatha Lakmal Abeykoon (vibhatha):*\nWhile running more tests (using crossbows), I got this CI failure.\u00a0\r\n```\n\r\n33/89 Test #31: arrow-compute-aggregate-test ..............   Passed    1.44 sec\r\n6991      Start 36: arrow-compute-asof-join-node-test\r\n699234/89 Test #36: arrow-compute-asof-join-node-test .........***Failed    0.37 sec\r\n6993Running arrow-compute-asof-join-node-test, redirecting output into /var/folders/24/8k48jl6d249_n_qfxwsl6xvm0000gn/T/arrow-HEAD.XXXXX.VG4icjS7/cpp-build/build/test-logs/arrow-compute-asof-join-node-test.txt (attempt 1/1)\r\n6994/Users/runner/work/crossbow/crossbow/arrow/cpp/build-support/run-test.sh: line 88: 95323 Segmentation fault: 11  $TEST_EXECUTABLE \"$@\" > $LOGFILE.raw 2>&1\r\n6995Running main() from /var/folders/24/8k48jl6d249_n_qfxwsl6xvm0000gn/T/arrow-HEAD.XXXXX.VG4icjS7/cpp-build/googletest_ep-prefix/src/googletest_ep/googletest/src/gtest_main.cc\r\n6996[==========] Running 80 tests from 2 test suites.\r\n6997[----------] Global test environment set-up.\r\n6998[----------] 14 tests from AsofJoinTest\r\n6999[ RUN      ] AsofJoinTest.TestUnsupportedOntype\r\n7000[       OK ] AsofJoinTest.TestUnsupportedOntype (4 ms)\r\n7001[ RUN      ] AsofJoinTest.TestUnsupportedBytype\r\n7002[       OK ] AsofJoinTest.TestUnsupportedBytype (0 ms)\r\n7003[ RUN      ] AsofJoinTest.TestUnsupportedDatatype\r\n7004[       OK ] AsofJoinTest.TestUnsupportedDatatype (0 ms)\r\n7005[ RUN      ] AsofJoinTest.TestMissingKeys\r\n7006[       OK ] AsofJoinTest.TestMissingKeys (0 ms)\r\n7007[ RUN      ] AsofJoinTest.TestUnsupportedTolerance\r\n7008[       OK ] AsofJoinTest.TestUnsupportedTolerance (0 ms)\r\n7009[ RUN      ] AsofJoinTest.TestMissingOnKey\r\n7010[       OK ] AsofJoinTest.TestMissingOnKey (0 ms)\r\n7011[ RUN      ] AsofJoinTest.TestMissingByKey\r\n7012[       OK ] AsofJoinTest.TestMissingByKey (0 ms)\r\n7013[ RUN      ] AsofJoinTest.TestNestedOnKey\r\n7014[       OK ] AsofJoinTest.TestNestedOnKey (0 ms)\r\n7015[ RUN      ] AsofJoinTest.TestNestedByKey\r\n7016[       OK ] AsofJoinTest.TestNestedByKey (0 ms)\r\n7017[ RUN      ] AsofJoinTest.TestAmbiguousOnKey\r\n7018[       OK ] AsofJoinTest.TestAmbiguousOnKey (0 ms)\r\n7019[ RUN      ] AsofJoinTest.TestAmbiguousByKey\r\n7020[       OK ] AsofJoinTest.TestAmbiguousByKey (0 ms)\r\n7021[ RUN      ] AsofJoinTest.TestLeftUnorderedOnKey\r\n7022/Users/runner/work/crossbow/crossbow/arrow/cpp/src/arrow/compute/exec/exec_plan.cc:58: Plan was destroyed before finishing\r\n7023[       OK ] AsofJoinTest.TestLeftUnorderedOnKey (1 ms)\r\n7024[ RUN      ] AsofJoinTest.TestRightUnorderedOnKey\r\n7025/private/var/folders/24/8k48jl6d249_n_qfxwsl6xvm0000gn/T/arrow-HEAD.XXXXX.VG4icjS7/cpp-build/src/arrow/compute/exec\r\n7026\r\n7027      Start 37: arrow-compute-tpch-node-test\r\n702835/89 Test #34: arrow-compute-plan-test ...................   Passed    2.71 sec\r\n7029      Start 38: arrow-compute-union-node-test\n```\r\nIt looks very much the same. But only reproduced this once (for 37 CI runs)"
        },
        {
            "created_at": "2022-10-12T22:42:17.686Z",
            "body": "***Note**: [Comment](https://issues.apache.org/jira/browse/ARROW-17292?focusedCommentId=17616715) by Weston Pace (westonpace):*\nThe asof join test failure is very useful.  I dug into it further and unearthed ARROW-18018.  It's possible that ARROW-18018 is the cause for the hash join test failure as well.  By introducing delays and stress I was able to trigger the hash join test to segfault as a result of ARROW-18018.  However, without being able to reproduce it and get a stack trace, it is pretty much impossible to tell for sure.  As a result, I have left ARROW-18018 as a separate JIRA.\r\n\r\nOnce it merges in, we should see if this failure continues to occur.\r\n\r\nEither way, we have likely instances of this failure going back as far as I can go.  E.g. we started tracking nightly failures in Zulip in May and I still see this test failure sporadically though I cannot confirm the cause because Github no longer has the logs.  My suspicion is that, whatever this bug is, we have probably already released several releases with it, and it should not be a blocker for 10.0.0."
        },
        {
            "created_at": "2022-10-13T15:07:12.699Z",
            "body": "***Note**: [Comment](https://issues.apache.org/jira/browse/ARROW-17292?focusedCommentId=17617120) by Alessandro Molina (amol-):*\nI'm lowering this from Blocker to Critical has it has already been present in past releases. But we should keep it under high attention, the nightlies should prevent us from forgetting it's a problem we need to fix by the way."
        }
    ]
}