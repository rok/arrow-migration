{
    "issue": {
        "title": "Segfault when importing TensorFlow after Pyarrow",
        "body": "***Note**: This issue was originally created as [ARROW-2657](https://issues.apache.org/jira/browse/ARROW-2657). Please see the [migration documentation](https://gist.github.com/toddfarmer/12aa88361532d21902818a6044fda4c3) for further details.*\n\n### Original Issue Description:\nThe following will segfault when pyarrow wheels are built using the instructions in <https://github.com/apache/arrow/tree/master/python/manylinux1#build-instructions>.\r\n```java\n\r\nimport pyarrow\r\nimport tensorflow\r\n```\r\nSearching over commits, this was introduced in https://github.com/apache/arrow/commit/2093f6ec5c628ef983194a3fb3d0a621dd58c600.\r\n\r\nRunning in gdb shows\r\n```java\n\r\n$ gdb python\r\nGNU gdb (Ubuntu 7.11.1-0ubuntu1~16.5) 7.11.1\r\nCopyright (C) 2016 Free Software Foundation, Inc.\r\nLicense GPLv3+: GNU GPL version 3 or later <http://gnu.org/licenses/gpl.html>\r\nThis is free software: you are free to change and redistribute it.\r\nThere is NO WARRANTY, to the extent permitted by law. Type \"show copying\"\r\nand \"show warranty\" for details.\r\nThis GDB was configured as \"x86_64-linux-gnu\".\r\nType \"show configuration\" for configuration details.\r\nFor bug reporting instructions, please see:\r\n<http://www.gnu.org/software/gdb/bugs/>.\r\nFind the GDB manual and other documentation resources online at:\r\n<http://www.gnu.org/software/gdb/documentation/>.\r\nFor help, type \"help\".\r\nType \"apropos word\" to search for commands related to \"word\"...\r\nReading symbols from python...done.\r\n(gdb) run\r\nStarting program: /home/ubuntu/anaconda3/bin/python \r\n[Thread debugging using libthread_db enabled]\r\nUsing host libthread_db library \"/lib/x86_64-linux-gnu/libthread_db.so.1\".\r\nPython 3.6.5 |Anaconda, Inc.| (default, Apr 29 2018, 16:14:56) \r\n[GCC 7.2.0] on linux\r\nType \"help\", \"copyright\", \"credits\" or \"license\" for more information.\r\n>>> import pyarrow\r\n>>> import tensorflow\r\n\r\nProgram received signal SIGSEGV, Segmentation fault.\r\n0x0000000000000000 in ?? ()\r\n(gdb) bt\r\n#0 0x0000000000000000 in ?? ()\r\n#1 0x00007ffff7bc8a99 in __pthread_once_slow (\r\n once_control=0x7fffd95561c8 <tensorflow::port::(anonymous namespace)::cpuid_once_flag>, init_routine=0x7ffff17e6fe1 <std::__once_proxy()>)\r\n at pthread_once.c:116\r\n#2 0x00007fffd8df6faa in void std::call_once<void (&)()>(std::once_flag&, void (&)()) ()\r\n from /home/ubuntu/anaconda3/lib/python3.6/site-packages/tensorflow/python/../libtensorflow_framework.so\r\n#3 0x00007fffd8df6fde in tensorflow::port::TestCPUFeature(tensorflow::port::CPUFeature) ()\r\n from /home/ubuntu/anaconda3/lib/python3.6/site-packages/tensorflow/python/../libtensorflow_framework.so\r\n#4 0x00007fffd8df6f11 in tensorflow::port::(anonymous namespace)::CheckFeatureOrDie(tensorflow::port::CPUFeature, std::string const&) ()\r\n from /home/ubuntu/anaconda3/lib/python3.6/site-packages/tensorflow/python/../libtensorflow_framework.so\r\n#5 0x00007fffd8c38394 in _GLOBAL__sub_I_cpu_feature_guard.cc ()\r\n from /home/ubuntu/anaconda3/lib/python3.6/site-packages/tensorflow/python/../libtensorflow_framework.so\r\n---Type <return> to continue, or q <return> to quit---\r\n#6 0x00007ffff7de76ba in call_init (l=<optimized out>, argc=argc@entry=1, \r\n argv=argv@entry=0x7fffffffe598, env=env@entry=0x555555c628f0)\r\n at dl-init.c:72\r\n#7 0x00007ffff7de77cb in call_init (env=0x555555c628f0, argv=0x7fffffffe598, \r\n argc=1, l=<optimized out>) at dl-init.c:30\r\n#8 _dl_init (main_map=main_map@entry=0x5555565d9640, argc=1, \r\n argv=0x7fffffffe598, env=0x555555c628f0) at dl-init.c:120\r\n#9 0x00007ffff7dec8e2 in dl_open_worker (a=a@entry=0x7fffffff8810)\r\n at dl-open.c:575\r\n#10 0x00007ffff7de7564 in _dl_catch_error (\r\n objname=objname@entry=0x7fffffff8800, \r\n errstring=errstring@entry=0x7fffffff8808, \r\n mallocedp=mallocedp@entry=0x7fffffff87ff, \r\n operate=operate@entry=0x7ffff7dec4d0 <dl_open_worker>, \r\n args=args@entry=0x7fffffff8810) at dl-error.c:187\r\n#11 0x00007ffff7debda9 in _dl_open (\r\n file=0x7fffde1edc00 \"/home/ubuntu/anaconda3/lib/python3.6/site-packages/tensorflow/python/_pywrap_tensorflow_internal.so\", mode=-2147483646, \r\n caller_dlopen=0x555555742bfa <_PyImport_FindSharedFuncptr+138>, nsid=-2, \r\n argc=<optimized out>, argv=<optimized out>, env=0x555555c628f0)\r\n---Type <return> to continue, or q <return> to quit---\r\n at dl-open.c:660\r\n#12 0x00007ffff75ecf09 in dlopen_doit (a=a@entry=0x7fffffff8a40) at dlopen.c:66\r\n#13 0x00007ffff7de7564 in _dl_catch_error (objname=0x555555b35d00, \r\n errstring=0x555555b35d08, mallocedp=0x555555b35cf8, \r\n operate=0x7ffff75eceb0 <dlopen_doit>, args=0x7fffffff8a40)\r\n at dl-error.c:187\r\n#14 0x00007ffff75ed571 in _dlerror_run (\r\n operate=operate@entry=0x7ffff75eceb0 <dlopen_doit>, \r\n args=args@entry=0x7fffffff8a40) at dlerror.c:163\r\n#15 0x00007ffff75ecfa1 in __dlopen (file=<optimized out>, mode=<optimized out>)\r\n at dlopen.c:87\r\n#16 0x0000555555742bfa in _PyImport_FindSharedFuncptr ()\r\n#17 0x00005555557698a0 in _PyImport_LoadDynamicModuleWithSpec ()\r\n#18 0x0000555555769ae5 in _imp_create_dynamic ()\r\n#19 0x0000555555665a61 in PyCFunction_Call ()\r\n#20 0x0000555555719fdb in _PyEval_EvalFrameDefault ()\r\n#21 0x00005555556eba94 in _PyEval_EvalCodeWithName ()\r\n#22 0x00005555556ec941 in fast_function ()\r\n#23 0x00005555556f2755 in call_function ()\r\n#24 0x0000555555714cba in _PyEval_EvalFrameDefault ()\r\n---Type <return> to continue, or q <return> to quit---\r\n#25 0x00005555556ec70b in fast_function ()\r\n#26 0x00005555556f2755 in call_function ()\r\n#27 0x0000555555714cba in _PyEval_EvalFrameDefault ()\r\n#28 0x00005555556ec70b in fast_function ()\r\n#29 0x00005555556f2755 in call_function ()\r\n#30 0x0000555555714cba in _PyEval_EvalFrameDefault ()\r\n#31 0x00005555556ec70b in fast_function ()\r\n#32 0x00005555556f2755 in call_function ()\r\n#33 0x0000555555714cba in _PyEval_EvalFrameDefault ()\r\n#34 0x00005555556ec70b in fast_function ()\r\n#35 0x00005555556f2755 in call_function ()\r\n#36 0x0000555555714cba in _PyEval_EvalFrameDefault ()\r\n#37 0x00005555556eba94 in _PyEval_EvalCodeWithName ()\r\n#38 0x00005555556ec941 in fast_function ()\r\n#39 0x00005555556f2755 in call_function ()\r\n#40 0x0000555555714cba in _PyEval_EvalFrameDefault ()\r\n#41 0x00005555556ec70b in fast_function ()\r\n#42 0x00005555556f2755 in call_function ()\r\n#43 0x0000555555714cba in _PyEval_EvalFrameDefault ()\r\n#44 0x00005555556ec70b in fast_function ()\r\n---Type <return> to continue, or q <return> to quit---\r\n#45 0x00005555556f2755 in call_function ()\r\n#46 0x0000555555714cba in _PyEval_EvalFrameDefault ()\r\n#47 0x00005555556ed459 in PyEval_EvalCodeEx ()\r\n#48 0x00005555556ee1ec in PyEval_EvalCode ()\r\n#49 0x00005555557125bd in builtin_exec ()\r\n#50 0x0000555555665a61 in PyCFunction_Call ()\r\n#51 0x0000555555719fdb in _PyEval_EvalFrameDefault ()\r\n#52 0x00005555556eba94 in _PyEval_EvalCodeWithName ()\r\n#53 0x00005555556ec941 in fast_function ()\r\n#54 0x00005555556f2755 in call_function ()\r\n#55 0x0000555555714cba in _PyEval_EvalFrameDefault ()\r\n#56 0x00005555556ec70b in fast_function ()\r\n#57 0x00005555556f2755 in call_function ()\r\n#58 0x0000555555714cba in _PyEval_EvalFrameDefault ()\r\n#59 0x00005555556ec70b in fast_function ()\r\n#60 0x00005555556f2755 in call_function ()\r\n#61 0x0000555555714cba in _PyEval_EvalFrameDefault ()\r\n#62 0x00005555556ec70b in fast_function ()\r\n#63 0x00005555556f2755 in call_function ()\r\n#64 0x0000555555714cba in _PyEval_EvalFrameDefault ()\r\n---Type <return> to continue, or q <return> to quit---\r\n#65 0x00005555556ecd7b in _PyFunction_FastCallDict ()\r\n#66 0x0000555555662f5f in _PyObject_FastCallDict ()\r\n#67 0x00005555556a7670 in _PyObject_CallMethodIdObjArgs ()\r\n#68 0x0000555555659a70 in PyImport_ImportModuleLevelObject ()\r\n#69 0x0000555555717033 in _PyEval_EvalFrameDefault ()\r\n#70 0x00005555556ed459 in PyEval_EvalCodeEx ()\r\n#71 0x00005555556ee1ec in PyEval_EvalCode ()\r\n#72 0x00005555557125bd in builtin_exec ()\r\n#73 0x0000555555665a61 in PyCFunction_Call ()\r\n#74 0x0000555555719fdb in _PyEval_EvalFrameDefault ()\r\n#75 0x00005555556eba94 in _PyEval_EvalCodeWithName ()\r\n#76 0x00005555556ec941 in fast_function ()\r\n#77 0x00005555556f2755 in call_function ()\r\n#78 0x0000555555714cba in _PyEval_EvalFrameDefault ()\r\n#79 0x00005555556ec70b in fast_function ()\r\n#80 0x00005555556f2755 in call_function ()\r\n#81 0x0000555555714cba in _PyEval_EvalFrameDefault ()\r\n#82 0x00005555556ec70b in fast_function ()\r\n#83 0x00005555556f2755 in call_function ()\r\n#84 0x0000555555714cba in _PyEval_EvalFrameDefault ()\r\n---Type <return> to continue, or q <return> to quit---\r\n#85 0x00005555556ec70b in fast_function ()\r\n#86 0x00005555556f2755 in call_function ()\r\n#87 0x0000555555714cba in _PyEval_EvalFrameDefault ()\r\n#88 0x00005555556ecd7b in _PyFunction_FastCallDict ()\r\n#89 0x0000555555662f5f in _PyObject_FastCallDict ()\r\n#90 0x00005555556a7670 in _PyObject_CallMethodIdObjArgs ()\r\n#91 0x0000555555659a70 in PyImport_ImportModuleLevelObject ()\r\n#92 0x00005555556fd1da in builtin___import__ ()\r\n#93 0x00005555556659f6 in PyCFunction_Call ()\r\n#94 0x0000555555719fdb in _PyEval_EvalFrameDefault ()\r\n#95 0x00005555556eba94 in _PyEval_EvalCodeWithName ()\r\n#96 0x00005555556ec941 in fast_function ()\r\n#97 0x00005555556f2755 in call_function ()\r\n#98 0x0000555555714cba in _PyEval_EvalFrameDefault ()\r\n#99 0x00005555556ebf21 in _PyEval_EvalCodeWithName ()\r\n#100 0x00005555556ece1b in _PyFunction_FastCallDict ()\r\n#101 0x0000555555662f5f in _PyObject_FastCallDict ()\r\n#102 0x00005555556a7670 in _PyObject_CallMethodIdObjArgs ()\r\n#103 0x0000555555659933 in PyImport_ImportModuleLevelObject ()\r\n#104 0x0000555555717033 in _PyEval_EvalFrameDefault ()\r\n---Type <return> to continue, or q <return> to quit---\r\n#105 0x00005555556ed459 in PyEval_EvalCodeEx ()\r\n#106 0x00005555556ee1ec in PyEval_EvalCode ()\r\n#107 0x00005555557125bd in builtin_exec ()\r\n#108 0x0000555555665a61 in PyCFunction_Call ()\r\n#109 0x0000555555719fdb in _PyEval_EvalFrameDefault ()\r\n#110 0x00005555556eba94 in _PyEval_EvalCodeWithName ()\r\n#111 0x00005555556ec941 in fast_function ()\r\n#112 0x00005555556f2755 in call_function ()\r\n#113 0x0000555555714cba in _PyEval_EvalFrameDefault ()\r\n#114 0x00005555556ec70b in fast_function ()\r\n#115 0x00005555556f2755 in call_function ()\r\n#116 0x0000555555714cba in _PyEval_EvalFrameDefault ()\r\n#117 0x00005555556ec70b in fast_function ()\r\n#118 0x00005555556f2755 in call_function ()\r\n#119 0x0000555555714cba in _PyEval_EvalFrameDefault ()\r\n#120 0x00005555556ec70b in fast_function ()\r\n#121 0x00005555556f2755 in call_function ()\r\n#122 0x0000555555714cba in _PyEval_EvalFrameDefault ()\r\n#123 0x00005555556ecd7b in _PyFunction_FastCallDict ()\r\n#124 0x0000555555662f5f in _PyObject_FastCallDict ()\r\n---Type <return> to continue, or q <return> to quit---\r\n#125 0x00005555556a7670 in _PyObject_CallMethodIdObjArgs ()\r\n#126 0x0000555555659a70 in PyImport_ImportModuleLevelObject ()\r\n#127 0x0000555555717033 in _PyEval_EvalFrameDefault ()\r\n#128 0x00005555556ed459 in PyEval_EvalCodeEx ()\r\n#129 0x00005555556ee1ec in PyEval_EvalCode ()\r\n#130 0x00005555557125bd in builtin_exec ()\r\n#131 0x0000555555665a61 in PyCFunction_Call ()\r\n#132 0x0000555555719fdb in _PyEval_EvalFrameDefault ()\r\n#133 0x00005555556eba94 in _PyEval_EvalCodeWithName ()\r\n#134 0x00005555556ec941 in fast_function ()\r\n#135 0x00005555556f2755 in call_function ()\r\n#136 0x0000555555714cba in _PyEval_EvalFrameDefault ()\r\n#137 0x00005555556ec70b in fast_function ()\r\n#138 0x00005555556f2755 in call_function ()\r\n#139 0x0000555555714cba in _PyEval_EvalFrameDefault ()\r\n#140 0x00005555556ec70b in fast_function ()\r\n#141 0x00005555556f2755 in call_function ()\r\n#142 0x0000555555714cba in _PyEval_EvalFrameDefault ()\r\n#143 0x00005555556ec70b in fast_function ()\r\n#144 0x00005555556f2755 in call_function ()\r\n---Type <return> to continue, or q <return> to quit---\r\n#145 0x0000555555714cba in _PyEval_EvalFrameDefault ()\r\n#146 0x00005555556ecd7b in _PyFunction_FastCallDict ()\r\n#147 0x0000555555662f5f in _PyObject_FastCallDict ()\r\n#148 0x00005555556a7670 in _PyObject_CallMethodIdObjArgs ()\r\n#149 0x0000555555659a70 in PyImport_ImportModuleLevelObject ()\r\n#150 0x0000555555717033 in _PyEval_EvalFrameDefault ()\r\n#151 0x00005555556ed459 in PyEval_EvalCodeEx ()\r\n#152 0x00005555556ee1ec in PyEval_EvalCode ()\r\n#153 0x00005555557689a4 in run_mod ()\r\n#154 0x000055555562f60c in PyRun_InteractiveOneObjectEx ()\r\n#155 0x000055555562f7c2 in PyRun_InteractiveLoopFlags ()\r\n#156 0x000055555562f862 in PyRun_AnyFileExFlags.cold.2773 ()\r\n#157 0x0000555555631a57 in Py_Main.cold.2798 ()\r\n#158 0x00005555556344be in main ()\r\n(gdb) \r\n```",
        "created_at": "2018-05-31T22:49:51.000Z",
        "updated_at": "2018-07-27T15:45:42.000Z",
        "labels": [
            "Migrated from Jira",
            "Component: C++",
            "Component: Python",
            "Type: bug"
        ],
        "closed": true,
        "closed_at": "2018-07-04T20:08:55.000Z"
    },
    "comments": [
        {
            "created_at": "2018-05-31T22:53:51.585Z",
            "body": "***Note**: [Comment](https://issues.apache.org/jira/browse/ARROW-2657?focusedCommentId=16497286) by Robert Nishihara (robertnishihara):*\nNote that the issue does not appear when building arrow from source. It occurs when building a pyarrow wheel and then installing the wheel."
        },
        {
            "created_at": "2018-07-04T20:08:55.496Z",
            "body": "***Note**: [Comment](https://issues.apache.org/jira/browse/ARROW-2657?focusedCommentId=16533033) by Philipp Moritz (pcmoritz):*\nIssue resolved by pull request 2210\n<https://github.com/apache/arrow/pull/2210>"
        }
    ]
}