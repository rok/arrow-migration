{
    "issue": {
        "title": "[Java][OSX] Flight tests are failing: address already in use",
        "body": "***Note**: This issue was originally created as [ARROW-5836](https://issues.apache.org/jira/browse/ARROW-5836). Please see the [migration documentation](https://gist.github.com/toddfarmer/12aa88361532d21902818a6044fda4c3) for further details.*\n\n### Original Issue Description:\n```Java\n\r\nJul 03, 2019 3:09:45 PM io.grpc.netty.NettyServerHandler onStreamError\r\nWARNING: Stream Error\r\nio.netty.handler.codec.http2.Http2Exception$StreamException: Received DATA frame for an unknown stream 3\r\n        at io.netty.handler.codec.http2.Http2Exception.streamError(Http2Exception.java:129)\r\n        at io.netty.handler.codec.http2.DefaultHttp2ConnectionDecoder$FrameReadListener.shouldIgnoreHeadersOrDataFrame(DefaultHttp2ConnectionDecoder.java:531)\r\n        at io.netty.handler.codec.http2.DefaultHttp2ConnectionDecoder$FrameReadListener.onDataRead(DefaultHttp2ConnectionDecoder.java:183)\r\n        at io.netty.handler.codec.http2.Http2InboundFrameLogger$1.onDataRead(Http2InboundFrameLogger.java:48)\r\n        at io.netty.handler.codec.http2.DefaultHttp2FrameReader.readDataFrame(DefaultHttp2FrameReader.java:421)\r\n        at io.netty.handler.codec.http2.DefaultHttp2FrameReader.processPayloadState(DefaultHttp2FrameReader.java:251)\r\n        at io.netty.handler.codec.http2.DefaultHttp2FrameReader.readFrame(DefaultHttp2FrameReader.java:160)\r\n        at io.netty.handler.codec.http2.Http2InboundFrameLogger.readFrame(Http2InboundFrameLogger.java:41)\r\n        at io.netty.handler.codec.http2.DefaultHttp2ConnectionDecoder.decodeFrame(DefaultHttp2ConnectionDecoder.java:118)\r\n        at io.netty.handler.codec.http2.Http2ConnectionHandler$FrameDecoder.decode(Http2ConnectionHandler.java:390)\r\n        at io.netty.handler.codec.http2.Http2ConnectionHandler.decode(Http2ConnectionHandler.java:450)\r\n        at io.netty.handler.codec.ByteToMessageDecoder.decodeRemovalReentryProtection(ByteToMessageDecoder.java:489)\r\n        at io.netty.handler.codec.ByteToMessageDecoder.callDecode(ByteToMessageDecoder.java:428)\r\n        at io.netty.handler.codec.ByteToMessageDecoder.channelRead(ByteToMessageDecoder.java:265)\r\n        at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:362)\r\n        at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:348)\r\n        at io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:340)\r\n        at io.netty.channel.DefaultChannelPipeline$HeadContext.channelRead(DefaultChannelPipeline.java:1434)\r\n        at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:362)\r\n        at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:348)\r\n        at io.netty.channel.DefaultChannelPipeline.fireChannelRead(DefaultChannelPipeline.java:965)\r\n        at io.netty.channel.nio.AbstractNioByteChannel$NioByteUnsafe.read(AbstractNioByteChannel.java:163)\r\n        at io.netty.channel.nio.NioEventLoop.processSelectedKey(NioEventLoop.java:646)\r\n        at io.netty.channel.nio.NioEventLoop.processSelectedKeysOptimized(NioEventLoop.java:581)\r\n        at io.netty.channel.nio.NioEventLoop.processSelectedKeys(NioEventLoop.java:498)\r\n        at io.netty.channel.nio.NioEventLoop.run(NioEventLoop.java:460)\r\n        at io.netty.util.concurrent.SingleThreadEventExecutor$5.run(SingleThreadEventExecutor.java:884)\r\n        at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)\r\n        at java.lang.Thread.run(Thread.java:748)\r\n\r\nJul 03, 2019 3:09:46 PM io.grpc.netty.NettyServerHandler onStreamError\r\nWARNING: Stream Error\r\nio.netty.handler.codec.http2.Http2Exception$StreamException: Received DATA frame for an unknown stream 3\r\n        at io.netty.handler.codec.http2.Http2Exception.streamError(Http2Exception.java:129)\r\n        at io.netty.handler.codec.http2.DefaultHttp2ConnectionDecoder$FrameReadListener.shouldIgnoreHeadersOrDataFrame(DefaultHttp2ConnectionDecoder.java:531)\r\n        at io.netty.handler.codec.http2.DefaultHttp2ConnectionDecoder$FrameReadListener.onDataRead(DefaultHttp2ConnectionDecoder.java:183)\r\n        at io.netty.handler.codec.http2.Http2InboundFrameLogger$1.onDataRead(Http2InboundFrameLogger.java:48)\r\n        at io.netty.handler.codec.http2.DefaultHttp2FrameReader.readDataFrame(DefaultHttp2FrameReader.java:421)\r\n        at io.netty.handler.codec.http2.DefaultHttp2FrameReader.processPayloadState(DefaultHttp2FrameReader.java:251)\r\n        at io.netty.handler.codec.http2.DefaultHttp2FrameReader.readFrame(DefaultHttp2FrameReader.java:160)\r\n        at io.netty.handler.codec.http2.Http2InboundFrameLogger.readFrame(Http2InboundFrameLogger.java:41)\r\n        at io.netty.handler.codec.http2.DefaultHttp2ConnectionDecoder.decodeFrame(DefaultHttp2ConnectionDecoder.java:118)\r\n        at io.netty.handler.codec.http2.Http2ConnectionHandler$FrameDecoder.decode(Http2ConnectionHandler.java:390)\r\n        at io.netty.handler.codec.http2.Http2ConnectionHandler.decode(Http2ConnectionHandler.java:450)\r\n        at io.netty.handler.codec.ByteToMessageDecoder.decodeRemovalReentryProtection(ByteToMessageDecoder.java:489)\r\n        at io.netty.handler.codec.ByteToMessageDecoder.callDecode(ByteToMessageDecoder.java:428)\r\n        at io.netty.handler.codec.ByteToMessageDecoder.channelRead(ByteToMessageDecoder.java:265)\r\n        at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:362)\r\n        at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:348)\r\n        at io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:340)\r\n        at io.netty.channel.DefaultChannelPipeline$HeadContext.channelRead(DefaultChannelPipeline.java:1434)\r\n        at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:362)\r\n        at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:348)\r\n        at io.netty.channel.DefaultChannelPipeline.fireChannelRead(DefaultChannelPipeline.java:965)\r\n        at io.netty.channel.nio.AbstractNioByteChannel$NioByteUnsafe.read(AbstractNioByteChannel.java:163)\r\n        at io.netty.channel.nio.NioEventLoop.processSelectedKey(NioEventLoop.java:646)\r\n        at io.netty.channel.nio.NioEventLoop.processSelectedKeysOptimized(NioEventLoop.java:581)\r\n        at io.netty.channel.nio.NioEventLoop.processSelectedKeys(NioEventLoop.java:498)\r\n        at io.netty.channel.nio.NioEventLoop.run(NioEventLoop.java:460)\r\n        at io.netty.util.concurrent.SingleThreadEventExecutor$5.run(SingleThreadEventExecutor.java:884)\r\n        at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)\r\n        at java.lang.Thread.run(Thread.java:748)\r\n\r\n[INFO] Tests run: 4, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.324 s - in org.apache.arrow.flight.auth.TestAuth\r\n[INFO] Running org.apache.arrow.flight.TestFlightClient\r\n[INFO] Tests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.022 s - in org.apache.arrow.flight.TestFlightClient\r\n[INFO] Running org.apache.arrow.flight.example.TestExampleServer\r\n[WARNING] Tests run: 1, Failures: 0, Errors: 0, Skipped: 1, Time elapsed: 0.001 s - in org.apache.arrow.flight.example.TestExampleServer\r\n[INFO] Running org.apache.arrow.flight.TestServerOptions\r\n[ERROR] Tests run: 1, Failures: 0, Errors: 1, Skipped: 0, Time elapsed: 0.044 s <<< FAILURE! - in org.apache.arrow.flight.TestServerOptions\r\n[ERROR] domainSocket(org.apache.arrow.flight.TestServerOptions)  Time elapsed: 0.044 s  <<< ERROR!\r\njava.io.IOException: Failed to bind\r\n        at org.apache.arrow.flight.TestServerOptions.domainSocket(TestServerOptions.java:46)\r\nCaused by: io.netty.channel.unix.Errors$NativeIoException: bind(..) failed: Address already in use\r\n```",
        "created_at": "2019-07-03T13:11:31.000Z",
        "updated_at": "2019-08-01T22:35:32.000Z",
        "labels": [
            "Migrated from Jira",
            "Component: FlightRPC",
            "Component: Java",
            "Type: bug"
        ],
        "closed": true,
        "closed_at": "2019-07-04T07:52:48.000Z"
    },
    "comments": [
        {
            "created_at": "2019-07-03T13:34:39.213Z",
            "body": "***Note**: [Comment](https://issues.apache.org/jira/browse/ARROW-5836?focusedCommentId=16877842) by Antoine Pitrou (apitrou):*\n`[~lidavidm]`"
        },
        {
            "created_at": "2019-07-03T14:14:47.336Z",
            "body": "***Note**: [Comment](https://issues.apache.org/jira/browse/ARROW-5836?focusedCommentId=16877875) by David Li (lidavidm):*\nThis is because the path for the domain socket is too long on OSX, which happens because the release verification script generates a custom TMPDIR. For instance, this is the path that it tries to use for me, and if I try to listen on a domain socket with netcat, I get the following:\r\n\r\n`$ nc -l -U\u00a0 /private/var/folders/tm/b4drxjmn7j79gtp0ppbw5qlh0000gn/T/arrow-0.14.0.XXXXX.qLFPG9EZ/apache-arrow-0.14.0/java/flight/target/flight-unit-test-8900940943285883708.sock`\r\n`nc: File name too long`\r\n\r\nNot sure what the best way to fix this is - perhaps hardcode /tmp inside the test? I quickly scanned the grpc and grpc-java repositories, but they don't seem to test domain sockets (beyond maybe parsing the address)."
        },
        {
            "created_at": "2019-07-03T14:17:16.036Z",
            "body": "***Note**: [Comment](https://issues.apache.org/jira/browse/ARROW-5836?focusedCommentId=16877877) by David Li (lidavidm):*\nAh wait, I did find their test case - they hardcode /tmp: <https://github.com/grpc/grpc/blob/df998f70239ec80af7d9af7133f9c0757e952f39/test/core/end2end/fixtures/h2_local_uds.cc#L29-L38>\r\n\r\ngrpc-java doesn't seem to test this."
        },
        {
            "created_at": "2019-07-04T07:52:48.812Z",
            "body": "***Note**: [Comment](https://issues.apache.org/jira/browse/ARROW-5836?focusedCommentId=16878411) by Krisztian Szucs (kszucs):*\nIssue resolved by pull request 4793\n<https://github.com/apache/arrow/pull/4793>"
        }
    ]
}