{
    "issue": {
        "title": "[R] Unable to install from CRAN",
        "body": "***Note**: This issue was originally created as [ARROW-13929](https://issues.apache.org/jira/browse/ARROW-13929). Please see the [migration documentation](https://gist.github.com/toddfarmer/12aa88361532d21902818a6044fda4c3) for further details.*\n\n### Original Issue Description:\nHi!\r\n\r\n\u00a0\r\n\r\nTha laptop finally threw smoke and I'm from another unit with fresh R (4.1.1) and Ubuntu (20.04)\r\n\r\nI see this when trying to install arrow\r\n\r\n\u00a0\r\n```java\n\r\npacha@pacha-laptop:~$ export NOT_CRAN=true\r\npacha@pacha-laptop:~$ R\r\nR version 4.1.1 (2021-08-10) -- \"Kick Things\"\r\nCopyright (C) 2021 The R Foundation for Statistical Computing\r\nPlatform: x86_64-pc-linux-gnu (64-bit)\r\nR es un software libre y viene sin GARANTIA ALGUNA.\r\nUsted puede redistribuirlo bajo ciertas circunstancias.\r\nEscriba 'license()' o 'licence()' para detalles de distribucion.\r\nR es un proyecto colaborativo con muchos contribuyentes.\r\nEscriba 'contributors()' para obtener m\u00e1s informaci\u00f3n y\r\n'citation()' para saber c\u00f3mo citar R o paquetes de R en publicaciones.\r\nEscriba 'demo()' para demostraciones, 'help()' para el sistema on-line de ayuda,\r\no 'help.start()' para abrir el sistema de ayuda HTML con su navegador.\r\nEscriba 'q()' para salir de R.\r\n> install.packages(\"arrow\")\r\nInstalling package into \u2018/home/pacha/R/x86_64-pc-linux-gnu-library/4.1\u2019\r\n(as \u2018lib\u2019 is unspecified)\r\nprobando la URL 'https://cloud.r-project.org/src/contrib/arrow_5.0.0.2.tar.gz'\r\nContent type 'application/x-gzip' length 483642 bytes (472 KB)\r\n==================================================\r\ndownloaded 472 KB\r\n* installing *source* package \u2018arrow\u2019 ...\r\n** package \u2018arrow\u2019 successfully unpacked and MD5 sums checked\r\n** using staged installation\r\n*** Using ARROW_HOME as the source of libarrow\r\nPKG_CFLAGS=-I/home/pacha/.arrow/include -DARROW_R_WITH_ARROW -DARROW_R_WITH_PARQUET -DARROW_R_WITH_DATASET -DARROW_R_WITH_S3\r\nPKG_LIBS=-L/home/pacha/.arrow/lib -larrow_dataset -lparquet -larrow \r\n** libs\r\ng++ -std=gnu++11 -I\"/usr/share/R/include\" -DNDEBUG -I/home/pacha/.arrow/include -DARROW_R_WITH_ARROW -DARROW_R_WITH_PARQUET -DARROW_R_WITH_DATASET -DARROW_R_WITH_S3 -I../inst/include/ -fpic -g -O2 -fdebug-prefix-map=/build/r-base-QwogzP/r-base-4.1.1=. -fstack-protector-strong -Wformat -Werror=format-security -Wdate-time -D_FORTIFY_SOURCE=2 -g -c RTasks.cpp -o RTasks.o\r\ng++ -std=gnu++11 -I\"/usr/share/R/include\" -DNDEBUG -I/home/pacha/.arrow/include -DARROW_R_WITH_ARROW -DARROW_R_WITH_PARQUET -DARROW_R_WITH_DATASET -DARROW_R_WITH_S3 -I../inst/include/ -fpic -g -O2 -fdebug-prefix-map=/build/r-base-QwogzP/r-base-4.1.1=. -fstack-protector-strong -Wformat -Werror=format-security -Wdate-time -D_FORTIFY_SOURCE=2 -g -c altrep.cpp -o altrep.o\r\nIn file included from altrep.cpp:18:\r\n./arrow_types.h:196:27: error: \u2018WriteOptions\u2019 is not a member of \u2018arrow::csv\u2019; did you mean \u2018ParseOptions\u2019?\r\n 196 | R6_CLASS_NAME(arrow::csv::WriteOptions, \"CsvWriteOptions\");\r\n | ^~~~~~~~~~~~\r\n./arrow_types.h:188:24: note: in definition of macro \u2018R6_CLASS_NAME\u2019\r\n 188 | struct r6_class_name<CLASS> { \\\r\n | ^~~~~\r\n./arrow_types.h:196:27: error: \u2018WriteOptions\u2019 is not a member of \u2018arrow::csv\u2019; did you mean \u2018ParseOptions\u2019?\r\n 196 | R6_CLASS_NAME(arrow::csv::WriteOptions, \"CsvWriteOptions\");\r\n | ^~~~~~~~~~~~\r\n./arrow_types.h:188:24: note: in definition of macro \u2018R6_CLASS_NAME\u2019\r\n 188 | struct r6_class_name<CLASS> { \\\r\n | ^~~~~\r\n./arrow_types.h:188:29: error: template argument 1 is invalid\r\n 188 | struct r6_class_name<CLASS> { \\\r\n | ^\r\n./arrow_types.h:196:1: note: in expansion of macro \u2018R6_CLASS_NAME\u2019\r\n 196 | R6_CLASS_NAME(arrow::csv::WriteOptions, \"CsvWriteOptions\");\r\n | ^~~~~~~~~~~~~\r\nmake: *** [/usr/lib/R/etc/Makeconf:177: altrep.o] Error 1\r\nERROR: compilation failed for package \u2018arrow\u2019\r\n* removing \u2018/home/pacha/R/x86_64-pc-linux-gnu-library/4.1/arrow\u2019\r\nThe downloaded source packages are in\r\n \u2018/tmp/RtmpIEaRxv/downloaded_packages\u2019\r\nWarning message:\r\nIn install.packages(\"arrow\") :\r\n installation of package \u2018arrow\u2019 had non-zero exit status\r\n```\r\n\u00a0",
        "created_at": "2021-09-07T18:45:36.000Z",
        "updated_at": "2021-09-07T22:51:40.000Z",
        "labels": [
            "Migrated from Jira",
            "Component: R",
            "Type: enhancement"
        ],
        "closed": true,
        "closed_at": "2021-09-07T22:51:40.000Z"
    },
    "comments": [
        {
            "created_at": "2021-09-07T21:51:01.368Z",
            "body": "***Note**: [Comment](https://issues.apache.org/jira/browse/ARROW-13929?focusedCommentId=17411554) by Nicola Crane (thisisnic):*\nSorry to hear you're still having laptop issues, hopefully this one will serve you better!\r\n\r\nI'm wondering; it says it's using `ARROW_HOME` as the source for `libarrow`.\u00a0 Do you already have Arrow installed, or have restored a Ubuntu desktop image that has an Arrow installation on it?\r\n\r\nI'm asking because those error messages look similar to ones I've run into before when my C++ Arrow and R Arrow versions have been out of sync with each other."
        },
        {
            "created_at": "2021-09-07T22:02:37.148Z",
            "body": "***Note**: [Comment](https://issues.apache.org/jira/browse/ARROW-13929?focusedCommentId=17411560) by Mauricio 'Pach\u00e1' Vargas Sep\u00falveda (pachamaltese):*\nthx! just fresh Ubuntu (downloaded ISO)\r\n\r\nthis is why I reported this particular error"
        },
        {
            "created_at": "2021-09-07T22:14:10.543Z",
            "body": "***Note**: [Comment](https://issues.apache.org/jira/browse/ARROW-13929?focusedCommentId=17411564) by Mauricio 'Pach\u00e1' Vargas Sep\u00falveda (pachamaltese):*\nIDK what happens, but if I follow the part that says 'If you already have `arrow` installed and want to upgrade...' at <https://arrow.apache.org/docs/r/articles/install.html>\r\n\r\nit works"
        },
        {
            "created_at": "2021-09-07T22:49:41.793Z",
            "body": "***Note**: [Comment](https://issues.apache.org/jira/browse/ARROW-13929?focusedCommentId=17411575) by Nicola Crane (thisisnic):*\nI've tried replicating this on a Docker container with the same Ubuntu and R version as you, but an initial call to `install.packages(\"arrow\")` downloaded a binary rather than installing from source.\u00a0 I've given it a go via setting `LIBARROW_BINARY` to FALSE, but again it's retrieved the source rather than using `ARROW_HOME`,  and installed everything successfully.\r\n\r\nCould something else have set up the `ARROW_HOME` env var, or restored e.g. a copy of `~./profile` or another config file, which sets that variable?\r\n\r\nIt's looking in `/home/pacha/.arrow/include` because of this line of R code which looks for the `ARROW_HOME` var and uses it if it's present: <https://github.com/apache/arrow/blob/85d8175ea24b4dd99f108a673e9b63996d4f88cc/r/configure#L72-L75>.\r\n\r\nEither way, I guess it's working now, so I shall close the ticket :)"
        }
    ]
}