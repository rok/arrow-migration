{
    "issue": {
        "title": "[R] dplyr::summarize fails with division when divisor is a variable",
        "body": "***Note**: This issue was originally created as [ARROW-17361](https://issues.apache.org/jira/browse/ARROW-17361). Please see the [migration documentation](https://gist.github.com/toddfarmer/12aa88361532d21902818a6044fda4c3) for further details.*\n\n### Original Issue Description:\nHello,\r\n\r\nI found this odd behaviour when trying to compute an aggregate with dplyr::summarize: When I want to use a pre-defined variable to do a divison while aggregating, the execution fails with 'unsupported expression'. When I the value of the variable as is in the aggregation, it works.\r\n\r\n\u00a0\r\n\r\nSee below:\r\n\r\n\u00a0\r\n```java\n\r\nlibrary(dplyr)\r\nlibrary(arrow)\r\n\r\nsmall_dataset <- tibble::tibble(\r\n## x = rep(c(\"a\", \"b\"), each = 5),\r\n\u00a0 y = rep(1:5, 2)\r\n)\r\n\r\n## convert \"small_dataset\" into a ...dataset\r\ntmpdir <- tempfile()\r\ndir.create(tmpdir)\r\nwrite_dataset(small_dataset, tmpdir)\r\n\r\n## works\r\nopen_dataset(tmpdir) %>%\r\n\u00a0 summarize(value = sum(y) / 10) %>%\r\n\u00a0 collect()\r\n\r\n## fails\r\nscale_factor <- 10\r\nopen_dataset(tmpdir) %>%\r\n\u00a0 summarize(value = sum(y) / scale_factor) %>%\r\n\u00a0 collect()\r\n#> Fehler: Error in summarize_eval(names(exprs)[i],\r\n#> exprs[[i]], ctx, length(.data$group_by_vars) > :\r\n# \u00a0 Expression sum(y)/scale_factor is not an aggregate\r\n# \u00a0 expression or is not supported in Arrow\r\n# Call collect() first to pull data into R.\r\n \u00a0 \n```\r\nI was not sure how to name this issue/bug (if it is one), so if there is a clearer, more descriptive title you're welcome to adjust.\r\n\r\n\u00a0\r\n\r\nThanks for your work!\r\n\r\n\u00a0\r\n\r\nOliver\r\n\r\n\u00a0\r\n```java\n\r\n> arrow_info()\r\nArrow package version: 8.0.0\r\n\r\nCapabilities:\r\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0\r\ndataset \u00a0 \u00a0TRUE\r\nsubstrait FALSE\r\nparquet \u00a0 \u00a0TRUE\r\njson \u00a0 \u00a0 \u00a0 TRUE\r\ns3 \u00a0 \u00a0 \u00a0 \u00a0 TRUE\r\nutf8proc \u00a0 TRUE\r\nre2 \u00a0 \u00a0 \u00a0 \u00a0TRUE\r\nsnappy \u00a0 \u00a0 TRUE\r\ngzip \u00a0 \u00a0 \u00a0 TRUE\r\nbrotli \u00a0 \u00a0 TRUE\r\nzstd \u00a0 \u00a0 \u00a0 TRUE\r\nlz4 \u00a0 \u00a0 \u00a0 \u00a0TRUE\r\nlz4_frame \u00a0TRUE\r\nlzo \u00a0 \u00a0 \u00a0 FALSE\r\nbz2 \u00a0 \u00a0 \u00a0 \u00a0TRUE\r\njemalloc \u00a0 TRUE\r\nmimalloc \u00a0 TRUE\r\n\r\nMemory:\r\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0\u00a0\r\nAllocator jemalloc\r\nCurrent \u00a0 64 bytes\r\nMax \u00a0 \u00a0 \u00a0 41.25 Kb\r\n\r\nRuntime:\r\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0\u00a0\r\nSIMD Level \u00a0 \u00a0 \u00a0 \u00a0 \u00a0avx2\r\nDetected SIMD Level avx2\r\n\r\nBuild:\r\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0\r\nC++ Library Version \u00a0 8.0.0\r\nC++ Compiler \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0GNU\r\nC++ Compiler Version 12.1.0 \n```",
        "created_at": "2022-08-09T20:36:47.000Z",
        "updated_at": "2022-11-13T17:51:40.000Z",
        "labels": [
            "Migrated from Jira",
            "Component: R",
            "Type: bug"
        ],
        "closed": false
    },
    "comments": [
        {
            "created_at": "2022-08-15T14:34:16.552Z",
            "body": "***Note**: [Comment](https://issues.apache.org/jira/browse/ARROW-17361?focusedCommentId=17579737) by Drago\u0219 Moldovan-Gr\u00fcnfeld (dragosmg):*\nThanks for reporting this. I can confirm it is an unintended consequence of how we do the evaluation inside `summarise`. We should definitely get this to work. In the meantime, I can recommend a work-around using `rlang`'s injection operator (`!!`):\r\n```r\n\r\nopen_dataset(tmpdir) %>%\r\n  summarize(value = sum(y) / !!scale_factor) %>%\r\n  collect()\r\n#> # A tibble: 1 \u00d7 1\r\n#>   value\r\n#>   <dbl>\r\n#> 1     3\r\n```  "
        },
        {
            "created_at": "2022-11-13T17:51:40.133Z",
            "body": "***Note**: [Comment](https://issues.apache.org/jira/browse/ARROW-17361?focusedCommentId=17633378) by Apache Arrow JIRA Bot (arrowjira):*\nThis issue was last updated over 90 days ago, which may be an indication it is no longer being actively worked. To better reflect the current state, the issue is being unassigned per [project policy](https://arrow.apache.org/docs/dev/developers/bug_reports.html#issue-assignment). Please feel free to re-take assignment of the issue if it is being actively worked, or if you plan to start that work soon."
        }
    ]
}