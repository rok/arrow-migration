{
    "issue": {
        "title": "[C#] Intermittent Archery Failures",
        "body": "***Note**: This issue was originally created as [ARROW-16978](https://issues.apache.org/jira/browse/ARROW-16978). Please see the [migration documentation](https://gist.github.com/toddfarmer/12aa88361532d21902818a6044fda4c3) for further details.*\n\n### Original Issue Description:\nWe are seeing intermittent archery failures in arrow-rs - [here](https://github.com/apache/arrow-rs/runs/6987393626?check_suite_focus=true)\r\n```java\n\r\nFAILED TEST: datetime C# producing,  C# consuming\r\n1 failures\r\n  File \"/arrow/dev/archery/archery/integration/runner.py\", line 246, in _run_ipc_test_case\r\n    run_binaries(producer, consumer, test_case)\r\n  File \"/arrow/dev/archery/archery/integration/runner.py\", line 100, in run_gold\r\n    return self._run_gold(gold_dir, consumer, test_case)\r\n  File \"/arrow/dev/archery/archery/integration/runner.py\", line 322, in _run_gold\r\n    consumer.stream_to_file(consumer_stream_path, consumer_file_path)\r\n  File \"/arrow/dev/archery/archery/integration/tester_csharp.py\", line 63, in stream_to_file\r\n    self.run_shell_command(cmd)\r\n  File \"/arrow/dev/archery/archery/integration/tester.py\", line 49, in run_shell_command\r\n    subprocess.check_call(cmd, shell=True)\r\n  File \"/opt/conda/envs/arrow/lib/python3.10/subprocess.py\", line 369, in check_call\r\n    raise CalledProcessError(retcode, cmd)\r\nsubprocess.CalledProcessError: Command '/arrow/csharp/artifacts/Apache.Arrow.IntegrationTest/Debug/net6.0/Apache.Arrow.IntegrationTest --mode stream-to-file -a /tmp/tmpnhaxwkhj/d72f0c1c_0.14.1_datetime.gold.consumer_stream_as_file < /arrow/testing/data/arrow-ipc-stream/integration/0.14.1/generated_datetime.stream' returned non-zero exit status 1. \n```\r\nIt is possible that this is something to do with how we are running the archery tests, but I am at a loss as to how to debug this issue and would appreciate some input.\r\n\r\nI think it started around when [this](https://github.com/apache/arrow/pull/13279) was merged\r\n\r\n\u00a0",
        "created_at": "2022-07-05T15:09:36.000Z",
        "updated_at": "2022-07-12T03:04:40.000Z",
        "labels": [
            "Migrated from Jira",
            "Component: Archery",
            "Component: C#",
            "Type: bug"
        ],
        "closed": true,
        "closed_at": "2022-07-12T03:04:40.000Z"
    },
    "comments": [
        {
            "created_at": "2022-07-05T15:32:27.536Z",
            "body": "***Note**: [Comment](https://issues.apache.org/jira/browse/ARROW-16978?focusedCommentId=17562722) by Eric Erhardt (eerhardt):*\nCan you provide steps on how to reproduce this locally?\r\n\r\n\u00a0\r\n\r\nAre there test cases being run in arrow-rs that aren't run in the apache/arrow repo? Are the date and times used in this test random/based on the current date/time?\u00a0\r\n\r\n\u00a0\r\n\r\nIn the log, I'm seeing this exception:\r\n\r\n\u00a0\r\n```java\n\r\nUnhandled exception: System.ArgumentOutOfRangeException: Specified argument was out of the range of valid values.\r\n9512   at FlatBuffers.ByteBuffer.GetUshort(Int32 offset) in /arrow/csharp/src/Apache.Arrow/Flatbuf/FlatBuffers/ByteBuffer.cs:line 656\r\n9513   at FlatBuffers.ByteBuffer.GetShort(Int32 offset) in /arrow/csharp/src/Apache.Arrow/Flatbuf/FlatBuffers/ByteBuffer.cs:line 649\r\n9514   at FlatBuffers.Table.__offset(Int32 vtableOffset) in /arrow/csharp/src/Apache.Arrow/Flatbuf/FlatBuffers/Table.cs:line 37\r\n9515   at Apache.Arrow.Flatbuf.Message.get_HeaderType() in /arrow/csharp/src/Apache.Arrow/Flatbuf/Message.cs:line 21\r\n9516   at Apache.Arrow.Ipc.ArrowReaderImplementation.CreateArrowObjectFromMessage(Message message, ByteBuffer bodyByteBuffer, IMemoryOwner`1 memoryOwner) in /arrow/csharp/src/Apache.Arrow/Ipc/ArrowReaderImplementation.cs:line 108\r\n9517   at Apache.Arrow.Ipc.ArrowStreamReaderImplementation.<>c__DisplayClass8_0.<<ReadRecordBatchAsync>b__0>d.MoveNext() in /arrow/csharp/src/Apache.Arrow/Ipc/ArrowStreamReaderImplementation.cs:line 90\r\n9518--- End of stack trace from previous location ---\r\n9519   at Apache.Arrow.Ipc.ArrowStreamReaderImplementation.ReadRecordBatchAsync(CancellationToken cancellationToken) in /arrow/csharp/src/Apache.Arrow/Ipc/ArrowStreamReaderImplementation.cs:line 73\r\n9520   at Apache.Arrow.Ipc.ArrowStreamReaderImplementation.ReadNextRecordBatchAsync(CancellationToken cancellationToken) in /arrow/csharp/src/Apache.Arrow/Ipc/ArrowStreamReaderImplementation.cs:line 48\r\n9521   at Apache.Arrow.IntegrationTest.IntegrationCommand.StreamToFile() in /arrow/csharp/test/Apache.Arrow.IntegrationTest/IntegrationCommand.cs:line 575\r\n9522   at Apache.Arrow.IntegrationTest.IntegrationCommand.Execute() in /arrow/csharp/test/Apache.Arrow.IntegrationTest/IntegrationCommand.cs:line 58\r\n9523   at Apache.Arrow.IntegrationTest.Program.<>c.<<Main>b__0_0>d.MoveNext() in /arrow/csharp/test/Apache.Arrow.IntegrationTest/Program.cs:line 49\r\n9524--- End of stack trace from previous location ---\r\n9525   at System.CommandLine.Invocation.CommandHandler.GetExitCodeAsync(Object value, InvocationContext context)\r\n9526   at System.CommandLine.Invocation.ModelBindingCommandHandler.InvokeAsync(InvocationContext context)\r\n9527   at System.CommandLine.Invocation.InvocationPipeline.<>c__DisplayClass4_0.<<BuildInvocationChain>b__0>d.MoveNext()\r\n9528--- End of stack trace from previous location ---\r\n9529   at System.CommandLine.Builder.CommandLineBuilderExtensions.<>c__DisplayClass23_0.<<UseParseErrorReporting>b__0>d.MoveNext()\r\n9530--- End of stack trace from previous location ---\r\n9531   at System.CommandLine.Builder.CommandLineBuilderExtensions.<>c__DisplayClass16_0.<<UseHelp>b__0>d.MoveNext()\r\n9532--- End of stack trace from previous location ---\r\n9533   at System.CommandLine.Builder.CommandLineBuilderExtensions.<>c__DisplayClass27_0.<<UseVersionOption>b__1>d.MoveNext()\r\n9534--- End of stack trace from previous location ---\r\n9535   at System.CommandLine.Builder.CommandLineBuilderExtensions.<>c__DisplayClass25_0.<<UseTypoCorrections>b__0>d.MoveNext()\r\n9536--- End of stack trace from previous location ---\r\n9537   at System.CommandLine.Builder.CommandLineBuilderExtensions.<>c.<<UseSuggestDirective>b__24_0>d.MoveNext()\r\n9538--- End of stack trace from previous location ---\r\n9539   at System.CommandLine.Builder.CommandLineBuilderExtensions.<>c__DisplayClass22_0.<<UseParseDirective>b__0>d.MoveNext()\r\n9540--- End of stack trace from previous location ---\r\n9541   at System.CommandLine.Builder.CommandLineBuilderExtensions.<>c__DisplayClass11_0.<<UseDebugDirective>b__0>d.MoveNext()\r\n9542--- End of stack trace from previous location ---\r\n9543   at System.CommandLine.Builder.CommandLineBuilderExtensions.<>c.<<RegisterWithDotnetSuggest>b__10_0>d.MoveNext()\r\n9544--- End of stack trace from previous location ---\r\n9545   at System.CommandLine.Builder.CommandLineBuilderExtensions.<>c__DisplayClass14_0.<<UseExceptionHandler>b__0>d.MoveNext() \n```\r\n\u00a0\r\n\r\n\u00a0"
        },
        {
            "created_at": "2022-07-05T15:53:25.014Z",
            "body": "***Note**: [Comment](https://issues.apache.org/jira/browse/ARROW-16978?focusedCommentId=17562728) by Raphael Taylor-Davies (tustvold):*\nFrom the root of an arrow checkout run\r\n\r\n```\r\n\r\ngit clone <https://github.com/apache/arrow-rs.git> rust\r\n\r\narchery docker run -e ARCHERY_INTEGRATION_WITH_RUST=1 conda-integration\r\n\r\n```\r\n\r\nThe failure concerns C# producing and C# consuming, so I'm not sure how important the rust-specific part actually is as the failing test appears to only be using C#"
        },
        {
            "created_at": "2022-07-05T16:08:02.926Z",
            "body": "***Note**: [Comment](https://issues.apache.org/jira/browse/ARROW-16978?focusedCommentId=17562737) by Jorge Leit\u00e3o (jorgecarleitao):*\nI observe the same in arrow2 and this is independent of rust. I agree with Raphael that C# is not always rountripping datatimes correctly in integration tests."
        },
        {
            "created_at": "2022-07-12T03:04:40.563Z",
            "body": "***Note**: [Comment](https://issues.apache.org/jira/browse/ARROW-16978?focusedCommentId=17565237) by Eric Erhardt (eerhardt):*\nIssue resolved by pull request 13573\n<https://github.com/apache/arrow/pull/13573>"
        }
    ]
}