{
    "issue": {
        "title": "[C++][FlightRPC] Failed to detect gRPC version",
        "body": "***Note**: This issue was originally created as [ARROW-12013](https://issues.apache.org/jira/browse/ARROW-12013). Please see the [migration documentation](https://gist.github.com/toddfarmer/12aa88361532d21902818a6044fda4c3) for further details.*\n\n### Original Issue Description:\nI don't have gRPC dev packages on my host. Depends on Arrow to download and build a fresh one.\r\nWhen building Flight, I find gRPC version cannot be detected and TLS is always disabled.\r\nError logs in comments.",
        "created_at": "2021-03-18T10:11:15.000Z",
        "updated_at": "2021-03-22T21:38:45.000Z",
        "labels": [
            "Migrated from Jira",
            "Component: FlightRPC",
            "Type: bug"
        ],
        "closed": true,
        "closed_at": "2021-03-22T21:38:45.000Z"
    },
    "comments": [
        {
            "created_at": "2021-03-18T10:14:26.616Z",
            "body": "***Note**: [Comment](https://issues.apache.org/jira/browse/ARROW-12013?focusedCommentId=17304017) by yibocai#1 (yibocai#1):*\n**Steps to reproduce:**\r\n\r\nSTEP#1:\r\n```bash\n\r\n$ cmake -GNinja -DCMAKE_BUILD_TYPE=Release -DARROW_FLIGHT=ON -DARROW_WITH_ZLIB=ON ..\r\n\r\nIt will download and build gRPC-1.35.\r\n```\r\n\r\nSTEP#2:\r\n```bash\n\r\nRun above command again. It should try to compile grpc version probing files and report gRPC >= 1.34.\r\nBut the building steps failed, no appropriate gPRC verison is found.\r\n\r\n-- Checking support for TlsCredentialsOptions (gRPC >= 1.34)...\r\n-- TlsCredentialsOptions (for gRPC 1.34) not found in grpc::experimental.\r\nDEBUGBuild output:\r\nDEBUGChange Dir: /home/cyb/arrow/cpp/release/src/arrow/flight/try_compile/CMakeFiles/CMakeTmp\r\n\r\nRun Build Command:\"/usr/bin/ninja\" \"cmTC_3eab4\"\r\n[1/2] Building CXX object CMakeFiles/cmTC_3eab4.dir/check_tls_opts_134.cc.o\r\n[2/2] Linking CXX executable cmTC_3eab4\r\nFAILED: cmTC_3eab4\r\n: && /usr/bin/clang++-9  -Qunused-arguments -fcolor-diagnostics -O3 -DNDEBUG  -Wall -Wno-unknown-warning-option -Wno-pass-failed -msse4.2   CMakeFiles/cmTC_3eab4.dir/check_tls_opts_134.cc.o  -o cmTC_3eab4  /home/cyb/arrow/cpp/release/grpc_ep-install/lib/libgrpc.a /home/cyb/arrow/cpp/release/grpc_ep-install/lib/libgrpc++.a /home/cyb/arrow/cpp/release/grpc_ep-install/lib/libgrpc.a /home/cyb/arrow/cpp/release/grpc_ep-install/lib/libgpr.a /home/cyb/arrow/cpp/release/grpc_ep-install/lib/libupb.a /home/cyb/arrow/cpp/release/grpc_ep-install/lib/libaddress_sorting.a /home/cyb/arrow/cpp/release/absl_ep-install/lib/libabsl_bad_optional_access.a /home/cyb/arrow/cpp/release/absl_ep-install/lib/libabsl_base.a /home/cyb/arrow/cpp/release/absl_ep-install/lib/libabsl_cord.a /home/cyb/arrow/cpp/release/absl_ep-install/lib/libabsl_graphcycles_internal.a /home/cyb/arrow/cpp/release/absl_ep-install/lib/libabsl_int128.a /home/cyb/arrow/cpp/release/absl_ep-install/lib/libabsl_malloc_internal.a /home/cyb/arrow/cpp/release/absl_ep-install/lib/libabsl_raw_logging_internal.a /home/cyb/arrow/cpp/release/absl_ep-install/lib/libabsl_spinlock_wait.a /home/cyb/arrow/cpp/release/absl_ep-install/lib/libabsl_stacktrace.a /home/cyb/arrow/cpp/release/absl_ep-install/lib/libabsl_status.a /home/cyb/arrow/cpp/release/absl_ep-install/lib/libabsl_statusor.a /home/cyb/arrow/cpp/release/absl_ep-install/lib/libabsl_str_format_internal.a /home/cyb/arrow/cpp/release/absl_ep-install/lib/libabsl_strings.a /home/cyb/arrow/cpp/release/absl_ep-install/lib/libabsl_strings_internal.a /home/cyb/arrow/cpp/release/absl_ep-install/lib/libabsl_symbolize.a /home/cyb/arrow/cpp/release/absl_ep-install/lib/libabsl_debugging_internal.a /home/cyb/arrow/cpp/release/absl_ep-install/lib/libabsl_demangle_internal.a /home/cyb/arrow/cpp/release/absl_ep-install/lib/libabsl_synchronization.a /home/cyb/arrow/cpp/release/absl_ep-install/lib/libabsl_throw_delegate.a /home/cyb/arrow/cpp/release/absl_ep-install/lib/libabsl_time.a /home/cyb/arrow/cpp/release/absl_ep-install/lib/libabsl_time_zone.a && :\r\n/home/cyb/arrow/cpp/release/grpc_ep-install/lib/libgpr.a(thd_posix.cc.o): In function `grpc_core::Thread::Thread(char const*, void (*)(void*), void*, bool*, grpc_core::Thread::Options const&)':\r\nthd_posix.cc:(.text+0x13c): undefined reference to `pthread_attr_setstacksize'\r\nthd_posix.cc:(.text+0x162): undefined reference to `pthread_create'\r\n/home/cyb/arrow/cpp/release/grpc_ep-install/lib/libgpr.a(thd_posix.cc.o): In function `grpc_core::(anonymous namespace)::ThreadInternalsPosix::Join()':\r\nthd_posix.cc:(.text+0x3a7): undefined reference to `pthread_join'\r\n/home/cyb/arrow/cpp/release/grpc_ep-install/lib/libgpr.a(thd_posix.cc.o): In function `grpc_core::(anonymous namespace)::ThreadInternalsPosix::ThreadInternalsPosix(char const*, void (*)(void*), void*, bool*, grpc_core::Thread::Options const&)::{lambda(void*)#1}::__invoke(void*)':\r\nthd_posix.cc:(.text+0x40a): undefined reference to `pthread_setname_np'\r\n/home/cyb/arrow/cpp/release/absl_ep-install/lib/libabsl_str_format_internal.a(arg.cc.o): In function `absl::lts_2020_09_23::str_format_internal::FormatConvertImpl(absl::lts_2020_09_23::int128, absl::lts_2020_09_23::str_format_internal::FormatConversionSpecImpl, absl::lts_2020_09_23::str_format_internal::FormatSinkImpl*)':\r\narg.cc:(.text+0x153e): undefined reference to `absl::lts_2020_09_23::operator%(absl::lts_2020_09_23::uint128, absl::lts_2020_09_23::uint128)'\r\narg.cc:(.text+0x155e): undefined reference to `absl::lts_2020_09_23::operator/(absl::lts_2020_09_23::uint128, absl::lts_2020_09_23::uint128)'\r\narg.cc:(.text+0x166e): undefined reference to `absl::lts_2020_09_23::operator%(absl::lts_2020_09_23::uint128, absl::lts_2020_09_23::uint128)'\r\narg.cc:(.text+0x168e): undefined reference to `absl::lts_2020_09_23::operator/(absl::lts_2020_09_23::uint128, absl::lts_2020_09_23::uint128)'\r\n/home/cyb/arrow/cpp/release/absl_ep-install/lib/libabsl_str_format_internal.a(arg.cc.o): In function `absl::lts_2020_09_23::str_format_internal::FormatConvertImpl(absl::lts_2020_09_23::uint128, absl::lts_2020_09_23::str_format_internal::FormatConversionSpecImpl, absl::lts_2020_09_23::str_format_internal::FormatSinkImpl*)':\r\narg.cc:(.text+0x17be): undefined reference to `absl::lts_2020_09_23::operator%(absl::lts_2020_09_23::uint128, absl::lts_2020_09_23::uint128)'\r\n......\r\ntons of similar errors\r\n```"
        },
        {
            "created_at": "2021-03-18T10:15:17.676Z",
            "body": "***Note**: [Comment](https://issues.apache.org/jira/browse/ARROW-12013?focusedCommentId=17304018) by yibocai#1 (yibocai#1):*\nAdd necessary libraries to CMake fixes the issue.\r\n\r\n```bash\n\r\n-- Checking support for TlsCredentialsOptions (gRPC >= 1.34)...\r\n-- Found approximate gRPC version: 1.34 (ARROW_FLIGHT_REQUIRE_TLSCREDENTIALSOPTIONS=)\r\n```"
        },
        {
            "created_at": "2021-03-22T21:38:45.098Z",
            "body": "***Note**: [Comment](https://issues.apache.org/jira/browse/ARROW-12013?focusedCommentId=17306597) by Kouhei Sutou (kou):*\nIssue resolved by pull request 9746\n<https://github.com/apache/arrow/pull/9746>"
        }
    ]
}