{
    "issue": {
        "title": "[C++][Parquet] FileMetaData returned by ParquetFileWriter::metadata() has wrong size",
        "body": "***Note**: This issue was originally created as [ARROW-14521](https://issues.apache.org/jira/browse/ARROW-14521). Please see the [migration documentation](https://gist.github.com/toddfarmer/12aa88361532d21902818a6044fda4c3) for further details.*\n\n### Original Issue Description:\nGit hash of Arrow version tested:\r\ne8270d705da325158291f412235c9c155adceb39\r\n\r\nSteps to reproduce:\r\nBuild Arrow and Parquet statically, and install to a prefix directory, `~/arrow/cpp/release/prefix`:\r\n```java\n\r\ncd\r\ngit clone https://github.com/apache/arrow.git\r\ncd arrow/cpp/\r\nmkdir release\r\ncd release\r\ncmake -DARROW_PARQUET=ON -DARROW_BUILD_SHARED=OFF -DARROW_BUILD_STATIC=ON -DCMAKE_CXX_STANDARD=17 ..\r\nmake\r\nmkdir prefix\r\nmake DESTDIR=prefix install\r\n```\r\nBuild the following main file:\r\n```java\n\r\n#include <arrow/api.h>\r\n#include <arrow/io/api.h>\r\n#include <parquet/exception.h>\r\n#include <parquet/file_reader.h>\r\n#include <parquet/file_writer.h>\r\n#include <parquet/metadata.h>\r\n#include <iostream>\r\n#include <memory>\r\n#include <string>\r\n#include <utility>int main(int, char**) {\r\n  std::shared_ptr<arrow::io::FileOutputStream> output;  std::string tempfile_path{\"/tmp/arrowfooterbug.parquet\"};  PARQUET_ASSIGN_OR_THROW(output, arrow::io::FileOutputStream::Open(tempfile_path));  parquet::schema::NodeVector fields;\r\n      fields.push_back(\r\n          parquet::schema::PrimitiveNode::Make(\"Test\",\r\n                                               parquet::Repetition::REQUIRED,\r\n                                               parquet::Type::INT64,\r\n                                               parquet::ConvertedType::UINT_64));\r\n  static std::shared_ptr<parquet::schema::GroupNode> schema{\r\n    std::static_pointer_cast<parquet::schema::GroupNode>(\r\n        parquet::schema::GroupNode::Make(\"schema\", parquet::Repetition::REQUIRED,\r\n                                         fields))};\r\n  std::shared_ptr<parquet::WriterProperties> properties{\r\n    parquet::WriterProperties::Builder{}.build()};\r\n  std::shared_ptr<parquet::ArrowWriterProperties> arrow_properties{\r\n    parquet::ArrowWriterProperties::Builder{}.build()};  std::unique_ptr<::parquet::ParquetFileWriter> writer{\r\n    ::parquet::ParquetFileWriter::Open(output, schema, properties)};  writer->Close();\r\n  std::size_t writer_size{writer->metadata()->size()};\r\n  std::size_t reader_size{\r\n    parquet::ParquetFileReader::OpenFile(tempfile_path, false)->metadata()->size()};\r\n  std::cout << writer_size << ' ' << reader_size << '\\n';\r\n}\r\n```\r\nUsing the following CMakeLists.txt:\r\n```java\n\r\nproject(\"arrowfooterbug\")set(ARROW_HOME \"/home/enolan/arrow/cpp/release/prefix/usr/local\")\r\nfind_package(Arrow CONFIG PATHS \"/home/enolan/arrow/cpp/release/prefix/usr/local/lib/cmake/arrow\" NO_DEFAULT_PATH REQUIRED)\r\nfind_package(Parquet CONFIG PATHS \"/home/enolan/arrow/cpp/release/prefix/usr/local/lib/cmake/arrow\" NO_DEFAULT_PATH REQUIRED)set(CMAKE_CXX_FLAGS \"-std=c++17\")add_executable(main main.cpp)target_link_libraries(main parquet_static arrow_static)\r\n```\r\nExpected behavior:\r\n `writer_size` matches `reader_size` (output is `89 89`)\r\n\r\nActual behavior:\r\n`writer_size` is always zero (output is `0 89`)\r\n\r\nNote that the interface of `ParquetFileWriter::metadata()` is specified as:\r\n```java\n\r\n/// Returns the file metadata, only available after calling Close().\r\nconst std::shared_ptr<FileMetaData> metadata() const;\r\n```\r\nAnd `FileMetaData::size()` is specified as:\r\n```java\n\r\n/// \\brief Size of the original thrift encoded metadata footer.\r\nuint32_t size() const;\r\n```\r\nSo you would expect to be able to recover the size of the footer from the metadata after invoking `Close()`.",
        "created_at": "2021-10-29T18:48:08.000Z",
        "updated_at": "2021-10-29T18:48:08.000Z",
        "labels": [
            "Migrated from Jira",
            "Component: C++",
            "Component: Parquet",
            "Type: bug"
        ],
        "closed": false
    },
    "comments": []
}