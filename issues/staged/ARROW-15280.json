{
    "issue": {
        "title": "[R] Expose FileSystemFactoryOptions",
        "body": "***Note**: This issue was originally created as [ARROW-15280](https://issues.apache.org/jira/browse/ARROW-15280). Please see the [migration documentation](https://gist.github.com/toddfarmer/12aa88361532d21902818a6044fda4c3) for further details.*\n\n### Original Issue Description:\nARROW-4406 notes that:\r\n\r\n>Currently reading parquet files generated by Hadoop (EMR) from S3 fails with \"ValueError: >Found files in an intermediate directory\" because of the _$folder$ empty files.\r\n\r\nThis was fixed in the pyarrow but R still has this issue.\r\n\r\nThe R side does not seem to have something similar to:\r\n\r\n`\u00a0 def _should_silently_exclude(self, file_name):`\r\n`\u00a0 \u00a0 return (file_name.endswith('.crc') or # Checksums`\r\n`\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 file_name.endswith('_$folder$') or # HDFS directories in S3`\r\n`\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 file_name.startswith('.') or # Hidden files starting with .`\r\n`\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 file_name.startswith('_') or # Hidden files starting with _`\r\n`\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 file_name in EXCLUDED_PARQUET_PATHS)`\r\n\r\n",
        "created_at": "2022-01-07T10:59:31.000Z",
        "updated_at": "2022-07-02T14:04:22.000Z",
        "labels": [
            "Migrated from Jira",
            "Component: R",
            "Type: enhancement"
        ],
        "closed": true,
        "closed_at": "2022-05-19T14:52:29.000Z"
    },
    "comments": [
        {
            "created_at": "2022-01-31T14:59:48.949Z",
            "body": "***Note**: [Comment](https://issues.apache.org/jira/browse/ARROW-15280?focusedCommentId=17484729) by Dewey Dunnington (paleolimbot):*\nThank you for reporting this!\r\n\r\nWhere this lives in Python: https://github.com/apache/arrow/blob/ad073b7c0fec80ce88aaf1e7d6a78104711952f2/python/pyarrow/parquet.py#L1181-L1186\r\n\r\nWe don' have something similar to this approach in R, but it looks like these are exposed in the C++ API as well:\r\n\r\nhttps://github.com/apache/arrow/blob/f8661e032902a963b0a6a46077d72e804d22560d/cpp/src/arrow/dataset/discovery.h#L146-L195\r\n\r\n...which we could wire up to R here:\r\n\r\nhttps://github.com/apache/arrow/blob/03219e21b42f17294fba3b3d2b22a9117fe0f080/r/src/dataset.cpp#L171-L172\r\n\r\nand here:\r\n\r\nhttps://github.com/apache/arrow/blob/03219e21b42f17294fba3b3d2b22a9117fe0f080/r/R/dataset.R#L181"
        },
        {
            "created_at": "2022-05-14T17:32:06.140Z",
            "body": "***Note**: [Comment](https://issues.apache.org/jira/browse/ARROW-15280?focusedCommentId=17537068) by Neal Richardson (npr):*\nA couple of observations as I start to look into this:\r\n\r\n \\* The code in pyarrow where this is mentioned looks to be in the legacy ParquetDataset code path, which predates the Dataset API we use in R. I believe this is being deprecated (right `[~jorisvandenbossche]`?). So it's not a drop-in fix for R.\r\n \\* There is a TODO to expose the FileSystemFactoryOptions in R, which we should do here. That struct has a `selector_ignore_prefixes` option, but since this _$folder$ is a suffix, it won't help. In fact, there are some misleading C++ tests (such as <https://github.com/apache/arrow/blob/2e8b8365d602d8cb14a37ea4f349824549e28e8f/cpp/src/arrow/dataset/discovery_test.cc#L225-L239>) that include the _$folder$ string but not as a suffix like this. Perhaps we should add an ignore_suffixes option, or some other interface for filtering like this (cc `[~bkietz]`)\r\n \\* However, FileSystemFactoryOptions also has an `exclude_invalid_files` option, default false, and if true should successfully exclude _$folder$ files because they are empty. So exposing FileSystemFactoryOptions in R will allow you to flip this and that should do the trick."
        },
        {
            "created_at": "2022-05-17T10:16:27.988Z",
            "body": "***Note**: [Comment](https://issues.apache.org/jira/browse/ARROW-15280?focusedCommentId=17538090) by Joris Van den Bossche (jorisvandenbossche):*\n> The code in pyarrow where this is mentioned looks to be in the legacy ParquetDataset code path, which predates the Dataset API we use in R. I believe this is being deprecated (right Joris Van den Bossche?). So it's not a drop-in fix for R.\r\n\r\nYes, that's correct (so this is actually also an issue for python)\r\n\r\n> Perhaps we should add an ignore_suffixes option, or some other interface for filtering like this (cc Ben Kietzman)\r\n\r\nI was thinking exactly the same. Based on the python snippet from the legacy code, it is clear that it's ignoring some files both based on prefixes and suffixes. \r\n\r\nIt might be possible to have some more advanced / smarter (callback based?) filename filter option, but I suppose that a simpler prefix+suffix ignore options will cover almost all use cases?"
        },
        {
            "created_at": "2022-05-19T14:52:29.075Z",
            "body": "***Note**: [Comment](https://issues.apache.org/jira/browse/ARROW-15280?focusedCommentId=17539598) by Neal Richardson (npr):*\nIssue resolved by pull request 13171\n<https://github.com/apache/arrow/pull/13171>"
        }
    ]
}