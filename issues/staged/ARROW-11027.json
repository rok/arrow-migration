{
    "issue": {
        "title": "[Rust] [Parquet] Intermittent test failure thread 'encodings::encoding::tests::test_bool' panicked at 'Invalid byte when reading bool'",
        "body": "***Note**: This issue was originally created as [ARROW-11027](https://issues.apache.org/jira/browse/ARROW-11027). Please see the [migration documentation](https://gist.github.com/toddfarmer/12aa88361532d21902818a6044fda4c3) for further details.*\n\n### Original Issue Description:\nThe following parquet tests intermittently fail\r\n\r\n```Java\n\r\ntest encodings::encoding::tests::test_bool ... FAILED\r\n\r\nthread 'encodings::encoding::tests::test_bool' panicked at 'Invalid byte when reading bool', parquet/src/util/bit_util.rs:73:18\r\n```\r\n\r\nARROW-10943 tracks  an intermittent error in the parquet tests. We think we fixed one error but there is still something wrong. \r\n\r\nI can reproduce this locally  at ca685a0c08bb41f43a80e5605e4cc8f9efb77cca by running the following shell script:\r\n\r\n```Java\n\r\n#!/bin/bash\r\n# run a command in a loop\r\n\r\ncd /Users/alamb/Software/arrow2/rust\r\nexport PARQUET_TEST_DATA=`pwd`/../cpp/submodules/parquet-testing/data\r\nexport ARROW_TEST_DATA=`pwd`/../testing/data\r\nexport RUST_BACKTRACE=1\r\n\r\ni=0\r\nwhile true; do\r\n    echo \"iteration $i\"\r\n    cargo test -p parquet  -- test_bool\r\n    i=$((i+1))\r\ndone\r\n```\r\n\r\n\r\nHere is an example of the full stack trace / errors:\r\n\r\n```Java\n\r\ntest encodings::encoding::tests::test_bool ... FAILED\r\n\r\nfailures:\r\n\r\n---- encodings::encoding::tests::test_bool stdout ----\r\nthread 'encodings::encoding::tests::test_bool' panicked at 'Invalid byte when reading bool', parquet/src/util/bit_util.rs:73:18\r\nstack backtrace:\r\n   0: std::panicking::begin_panic\r\n             at /Users/alamb/.rustup/toolchains/stable-x86_64-apple-darwin/lib/rustlib/src/rust/library/std/src/panicking.rs:505\r\n   1: <bool as parquet::util::bit_util::FromBytes>::from_ne_bytes\r\n             at ./src/util/bit_util.rs:73\r\n   2: parquet::util::bit_util::from_ne_slice\r\n             at ./src/util/bit_util.rs:32\r\n   3: parquet::encodings::rle::RleDecoder::get_batch\r\n             at ./src/encodings/rle.rs:402\r\n   4: <parquet::encodings::decoding::RleValueDecoder<T> as parquet::encodings::decoding::Decoder<T>>::get\r\n             at ./src/encodings/decoding.rs:322\r\n   5: parquet::encodings::encoding::tests::put_and_get\r\n             at ./src/encodings/encoding.rs:1271\r\n   6: <T as parquet::encodings::encoding::tests::EncodingTester<T>>::test_internal\r\n             at ./src/encodings/encoding.rs:1214\r\n   7: parquet::encodings::encoding::tests::EncodingTester::test\r\n             at ./src/encodings/encoding.rs:1159\r\n   8: parquet::encodings::encoding::tests::test_bool\r\n             at ./src/encodings/encoding.rs:969\r\n   9: parquet::encodings::encoding::tests::test_bool::{{closure}}\r\n             at ./src/encodings/encoding.rs:966\r\n  10: core::ops::function::FnOnce::call_once\r\n             at /Users/alamb/.rustup/toolchains/stable-x86_64-apple-darwin/lib/rustlib/src/rust/library/core/src/ops/function.rs:227\r\n  11: core::ops::function::FnOnce::call_once\r\n             at /rustc/7eac88abb2e57e752f3302f02be5f3ce3d7adfb4/library/core/src/ops/function.rs:227\r\nnote: Some details are omitted, run with `RUST_BACKTRACE=full` for a verbose backtrace.\r\n\r\n```\r\n",
        "created_at": "2020-12-24T13:14:28.000Z",
        "updated_at": "2021-04-26T12:43:36.000Z",
        "labels": [
            "Migrated from Jira",
            "Component: Rust",
            "Type: bug"
        ],
        "closed": true,
        "closed_at": "2021-04-26T12:43:35.000Z"
    },
    "comments": [
        {
            "created_at": "2020-12-24T13:24:32.210Z",
            "body": "***Note**: [Comment](https://issues.apache.org/jira/browse/ARROW-11027?focusedCommentId=17254541) by Andrew Lamb (alamb):*\nFYI [~gbowyer@fastmail.co.uk]\r\n\r\nWhen  tried running with some of the code from https://github.com/apache/arrow/pull/8948 (a previous attempt to figure out what is going on here) the problem still happens on my machine: \r\n\r\n```Java\n\r\n(arrow_dev) alamb@MacBook-Pro:~/Software/arrow/rust$ git cherry-pick 16051b53cd3a1eebdba7a50356ee49585b69e152\r\n\r\n(arrow_dev) alamb@MacBook-Pro:~/Software/arrow/rust$ bash ~/Documents/loop.sh 2>& 1 | tee /tmp/loop.log | grep panic\r\nthread 'encodings::encoding::tests::test_bool' panicked at 'Invalid byte when reading bool', parquet/src/util/bit_util.rs:73:18\r\n   0: std::panicking::begin_panic\r\n             at /Users/alamb/.rustup/toolchains/stable-x86_64-apple-darwin/lib/rustlib/src/rust/library/std/src/panicking.rs:505\r\n```\r\n\r\nWhen I picked the second commit from that PR the problem still happens\r\n\r\n```Java\n\r\n(arrow_dev) alamb@MacBook-Pro:~/Software/arrow/rust$ git cherry-pick 04f680e121eed9fe524f60b91faa5e7b64fa9921\r\n\r\n(arrow_dev) alamb@MacBook-Pro:~/Software/arrow/rust$ git cherry-pick 04f680e121eed9fe524f60b91faa5e7b64fa9921\r\n[master 870ff05f9] [Rust][Hack] Replace murmur2-64a with wyhash\r\n Author: Greg Bowyer <gbowyer@fastmail.co.uk>\r\n Date: Wed Dec 16 17:13:24 2020 -0800\r\n 2 files changed, 3 insertions(+), 2 deletions(-)\r\n(arrow_dev) alamb@MacBook-Pro:~/Software/arrow/rust$ bash ~/Documents/loop.sh 2>& 1 | tee /tmp/loop.log | grep panic\r\nthread 'encodings::encoding::tests::test_bool' panicked at 'assertion failed: `(left == right)`\r\n             at /rustc/7eac88abb2e57e752f3302f02be5f3ce3d7adfb4/library/std/src/panicking.rs:483\r\n   1: std::panicking::begin_panic_fmt\r\n             at /rustc/7eac88abb2e57e752f3302f02be5f3ce3d7adfb4/library/std/src/panicking.rs:437\r\nthread 'encodings::encoding::tests::test_bool' panicked at 'assertion failed: `(left == right)`\r\n             at /rustc/7eac88abb2e57e752f3302f02be5f3ce3d7adfb4/library/std/src/panicking.rs:483\r\n   1: std::panicking::begin_panic_fmt\r\n             at /rustc/7eac88abb2e57e752f3302f02be5f3ce3d7adfb4/library/std/src/panicking.rs:437\r\n^C\r\n```"
        },
        {
            "created_at": "2021-04-26T12:43:34.549Z",
            "body": "***Note**: [Comment](https://issues.apache.org/jira/browse/ARROW-11027?focusedCommentId=17332188) by Andrew Lamb (alamb):*\nMigrated to github: https://github.com/apache/arrow-rs/issues/159"
        }
    ]
}