{
    "issue": {
        "title": "[C++][Dataset] Reading dataset with filtering on timestamp partition field crashes",
        "body": "***Note**: This issue was originally created as [ARROW-11379](https://issues.apache.org/jira/browse/ARROW-11379). Please see the [migration documentation](https://gist.github.com/toddfarmer/12aa88361532d21902818a6044fda4c3) for further details.*\n\n### Original Issue Description:\n```Java\n\r\nIn [1]: df = pd.DataFrame({\"dates\": list(pd.date_range(\"2012-01-01\", periods=2, freq=\"D\")) * 5, \"col\": range(10)})\r\n\r\nIn [2]: df.to_parquet(\"test_partition_timestamps\", partition_cols=[\"dates\"])\r\n\r\nIn [3]: !ls test_partition_timestamps/\r\n'dates=2012-01-01 00:00:00'  'dates=2012-01-02 00:00:00'\r\n\r\nIn [4]: import pyarrow.dataset as ds\r\n\r\nIn [6]: part = ds.partitioning(pa.schema([(\"dates\", pa.timestamp(\"s\"))]), flavor=\"hive\")\r\n\r\nIn [7]: dataset = ds.dataset(\"test_partition_timestamps/\", format=\"parquet\", partitioning=part)\r\n```\r\n\r\nReading the dataset is fine and fives the correct types:\r\n\r\n```Java\n\r\nIn [10]: dataset.to_table()\r\nOut[10]: \r\npyarrow.Table\r\ncol: int64\r\ndates: timestamp[s]\r\n```\r\n\r\nbut filtering on the timestamp column segfaults:\r\n\r\n```Java\n\r\nIn [11]: dataset.to_table(filter=ds.field(\"dates\") > pd.Timestamp(\"2012-01-01\"))\r\n../src/arrow/compute/kernels/scalar_cast_temporal.cc:129:  Check failed: (batch[0].kind()) == (Datum::ARRAY) \r\n/home/joris/miniconda3/envs/arrow-dev/lib/libarrow.so.300(+0xc2224a)[0x7f68d2ccf24a]\r\n/home/joris/miniconda3/envs/arrow-dev/lib/libarrow.so.300(+0xc221c8)[0x7f68d2ccf1c8]\r\n/home/joris/miniconda3/envs/arrow-dev/lib/libarrow.so.300(+0xc221ea)[0x7f68d2ccf1ea]\r\n/home/joris/miniconda3/envs/arrow-dev/lib/libarrow.so.300(_ZN5arrow4util8ArrowLogD1Ev+0x47)[0x7f68d2ccf549]\r\n/home/joris/miniconda3/envs/arrow-dev/lib/libarrow.so.300(+0xf0252a)[0x7f68d2faf52a]\r\n/home/joris/miniconda3/envs/arrow-dev/lib/libarrow.so.300(_ZNSt17_Function_handlerIFvPN5arrow7compute13KernelContextERKNS1_9ExecBatchEPNS0_5DatumEEPS9_E9_M_invokeERKSt9_Any_dataOS3_S6_OS8_+0x69)[0x7f68d2e8ab86]\r\n/home/joris/miniconda3/envs/arrow-dev/lib/libarrow.so.300(_ZNKSt8functionIFvPN5arrow7compute13KernelContextERKNS1_9ExecBatchEPNS0_5DatumEEEclES3_S6_S8_+0x7a)[0x7f68d2deec04]\r\n/home/joris/miniconda3/envs/arrow-dev/lib/libarrow.so.300(+0xd3d6f9)[0x7f68d2dea6f9]\r\n/home/joris/miniconda3/envs/arrow-dev/lib/libarrow.so.300(+0xd3cd5b)[0x7f68d2de9d5b]\r\n/home/joris/miniconda3/envs/arrow-dev/lib/libarrow.so.300(_ZNK5arrow7compute8Function7ExecuteERKSt6vectorINS_5DatumESaIS3_EEPKNS0_15FunctionOptionsEPNS0_11ExecContextE+0x8c7)[0x7f68d2df9963]\r\n/home/joris/miniconda3/envs/arrow-dev/lib/libarrow.so.300(+0xd2eed2)[0x7f68d2ddbed2]\r\n/home/joris/miniconda3/envs/arrow-dev/lib/libarrow.so.300(_ZNK5arrow7compute12MetaFunction7ExecuteERKSt6vectorINS_5DatumESaIS3_EEPKNS0_15FunctionOptionsEPNS0_11ExecContextE+0x15d)[0x7f68d2dfac8f]\r\n/home/joris/miniconda3/envs/arrow-dev/lib/libarrow.so.300(_ZN5arrow7compute12CallFunctionERKNSt7__cxx1112basic_stringIcSt11char_traitsIcESaIcEEERKSt6vectorINS_5DatumESaISA_EEPKNS0_15FunctionOptionsEPNS0_11ExecContextE+0x26c)[0x7f68d2dedc6f]\r\n/home/joris/miniconda3/envs/arrow-dev/lib/libarrow.so.300(_ZN5arrow7compute12CallFunctionERKNSt7__cxx1112basic_stringIcSt11char_traitsIcESaIcEEERKSt6vectorINS_5DatumESaISA_EEPKNS0_15FunctionOptionsEPNS0_11ExecContextE+0x93)[0x7f68d2deda96]\r\n/home/joris/miniconda3/envs/arrow-dev/lib/libarrow.so.300(_ZN5arrow7compute4CastERKNS_5DatumERKNS0_11CastOptionsEPNS0_11ExecContextE+0xf7)[0x7f68d2ddd493]\r\n/home/joris/miniconda3/envs/arrow-dev/lib/libarrow.so.300(_ZN5arrow7compute4CastERKNS_5DatumESt10shared_ptrINS_8DataTypeEERKNS0_11CastOptionsEPNS0_11ExecContextE+0x77)[0x7f68d2ddd6e2]\r\n/home/joris/miniconda3/envs/arrow-dev/lib/libarrow_dataset.so.300(+0x1c5c21)[0x7f68b30cfc21]\r\n/home/joris/miniconda3/envs/arrow-dev/lib/libarrow_dataset.so.300(+0x1c6789)[0x7f68b30d0789]\r\n/home/joris/miniconda3/envs/arrow-dev/lib/libarrow_dataset.so.300(+0x1c5097)[0x7f68b30cf097]\r\n/home/joris/miniconda3/envs/arrow-dev/lib/libarrow_dataset.so.300(_ZNK5arrow7dataset10Expression4BindENS_10ValueDescrEPNS_7compute11ExecContextE+0x732)[0x7f68b30d22e8]\r\n...\r\n```\r\n\r\n",
        "created_at": "2021-01-25T16:20:28.000Z",
        "updated_at": "2021-03-10T16:40:02.000Z",
        "labels": [
            "Migrated from Jira",
            "Component: C++",
            "Type: bug"
        ],
        "closed": true,
        "closed_at": "2021-02-16T15:00:08.000Z"
    },
    "comments": [
        {
            "created_at": "2021-01-25T16:25:24.634Z",
            "body": "***Note**: [Comment](https://issues.apache.org/jira/browse/ARROW-11379?focusedCommentId=17271422) by Joris Van den Bossche (jorisvandenbossche):*\nOK, so filtering with a string actually works:\r\n\r\n```Java\n\r\nIn [5]: dataset.to_table(filter=ds.field(\"dates\") > \"2012-01-01\")\r\nOut[5]: \r\npyarrow.Table\r\ncol: int64\r\ndates: timestamp[s]\r\n```\r\n\r\nSo it is the creation of the expression that goes wrong:\r\n\r\n```Java\n\r\nIn [9]: ds.field(\"dates\") > pd.Timestamp(\"2012-01-01\")\r\nOut[9]: <pyarrow.dataset.Expression (dates > 1325376000000000)>\r\n```\r\n\r\nThis shows an int and not a timestamp (although actually filtering with an int doesn't reproduce the segfault but this give an exception about not being able to cast an int to a timestamp).\r\n\r\nThe same segfault happens for filtering with `datetime.datetime` object.\r\n"
        },
        {
            "created_at": "2021-02-04T10:00:14.126Z",
            "body": "***Note**: [Comment](https://issues.apache.org/jira/browse/ARROW-11379?focusedCommentId=17278733) by Joris Van den Bossche (jorisvandenbossche):*\nThis appears to actually be a regression, so tagging for a potential 3.0.1"
        },
        {
            "created_at": "2021-02-16T15:00:09.035Z",
            "body": "***Note**: [Comment](https://issues.apache.org/jira/browse/ARROW-11379?focusedCommentId=17285260) by Ben Kietzman (bkietz):*\nIssue resolved by pull request 9466\n<https://github.com/apache/arrow/pull/9466>"
        }
    ]
}