{
    "issue": {
        "title": "[C++] ASAN/UBSAN build fails linking with conda-forge clang",
        "body": "***Note**: This issue was originally created as [ARROW-16519](https://issues.apache.org/jira/browse/ARROW-16519). Please see the [migration documentation](https://gist.github.com/toddfarmer/12aa88361532d21902818a6044fda4c3) for further details.*\n\n### Original Issue Description:\nUsing the latest conda-forge compilers I get the following errors when ASAN and UBSAN are enabled:\r\n```Java\n\r\n[554/634] Linking CXX executable debug/arrow-stream-to-file\r\nFAILED: debug/arrow-stream-to-file \r\n: && /home/antoine/miniconda3/envs/pyarrow/bin/clang++ -fvisibility-inlines-hidden -std=c++17 -fmessage-length=0 -march=nocona -mtune=haswell -ftree-vectorize -fPIC -fstack-protector-strong -fno-plt -O2 -ffunction-sections -pipe -isystem /home/antoine/miniconda3/envs/pyarrow/include -Qunused-arguments -fcolor-diagnostics -ggdb -O0  -Wall -Wextra -Wdocumentation -Wshorten-64-to-32 -Wno-missing-braces -Wno-unused-parameter -Wno-constant-logical-operand -Werror -Wno-unknown-warning-option -Wno-pass-failed -msse4.2  -fsanitize=address -DADDRESS_SANITIZER -fsanitize=undefined -fno-sanitize=alignment,vptr,function,float-divide-by-zero -fno-sanitize-recover=all -fsanitize-blacklist=/home/antoine/arrow/dev/cpp/build-support/sanitizer-disallowed-entries.txt -g -Wl,-O2 -Wl,--sort-common -Wl,--as-needed -Wl,-z,relro -Wl,-z,now -Wl,--disable-new-dtags -Wl,--gc-sections -Wl,--allow-shlib-undefined -Wl,-rpath,/home/antoine/miniconda3/envs/pyarrow/lib -Wl,-rpath-link,/home/antoine/miniconda3/envs/pyarrow/lib -L/home/antoine/miniconda3/envs/pyarrow/lib src/arrow/ipc/CMakeFiles/arrow-stream-to-file.dir/stream_to_file.cc.o -o debug/arrow-stream-to-file  -Wl,-rpath,/home/antoine/arrow/dev/cpp/build-test/debug  debug/libarrow.so.900.0.0  /home/antoine/miniconda3/envs/pyarrow/lib/libbrotlienc.so  /home/antoine/miniconda3/envs/pyarrow/lib/libbrotlidec.so  /home/antoine/miniconda3/envs/pyarrow/lib/libbrotlicommon.so  /home/antoine/miniconda3/envs/pyarrow/lib/liborc.so  /home/antoine/miniconda3/envs/pyarrow/lib/libprotobuf.so  /home/antoine/miniconda3/envs/pyarrow/lib/libgoogle_cloud_cpp_storage.so.1.40.1  /home/antoine/miniconda3/envs/pyarrow/lib/libabsl_str_format_internal.so.2111.0.0  /home/antoine/miniconda3/envs/pyarrow/lib/libgoogle_cloud_cpp_rest_internal.so.1.40.1  /home/antoine/miniconda3/envs/pyarrow/lib/libssl.so  /home/antoine/miniconda3/envs/pyarrow/lib/libgoogle_cloud_cpp_common.so.1.40.1  /home/antoine/miniconda3/envs/pyarrow/lib/libcrypto.so  /home/antoine/miniconda3/envs/pyarrow/lib/libabsl_time.so.2111.0.0  /home/antoine/miniconda3/envs/pyarrow/lib/libabsl_strings.so.2111.0.0  /home/antoine/miniconda3/envs/pyarrow/lib/libabsl_strings_internal.so.2111.0.0  /home/antoine/miniconda3/envs/pyarrow/lib/libabsl_int128.so.2111.0.0  /home/antoine/miniconda3/envs/pyarrow/lib/libabsl_civil_time.so.2111.0.0  /home/antoine/miniconda3/envs/pyarrow/lib/libabsl_time_zone.so.2111.0.0  /home/antoine/miniconda3/envs/pyarrow/lib/libabsl_bad_variant_access.so.2111.0.0  /home/antoine/miniconda3/envs/pyarrow/lib/libabsl_base.so.2111.0.0  /home/antoine/miniconda3/envs/pyarrow/lib/libabsl_spinlock_wait.so.2111.0.0  /home/antoine/miniconda3/envs/pyarrow/lib/libabsl_bad_optional_access.so.2111.0.0  /home/antoine/miniconda3/envs/pyarrow/lib/libabsl_throw_delegate.so.2111.0.0  /home/antoine/miniconda3/envs/pyarrow/lib/libabsl_raw_logging_internal.so.2111.0.0  /home/antoine/miniconda3/envs/pyarrow/lib/libabsl_log_severity.so.2111.0.0  /home/antoine/miniconda3/envs/pyarrow/lib/libcrc32c.so.1.1.0  /home/antoine/miniconda3/envs/pyarrow/lib/libcurl.so  /home/antoine/miniconda3/envs/pyarrow/lib/libz.so  /home/antoine/miniconda3/envs/pyarrow/lib/libaws-cpp-sdk-config.so  /home/antoine/miniconda3/envs/pyarrow/lib/libaws-cpp-sdk-transfer.so  /home/antoine/miniconda3/envs/pyarrow/lib/libaws-cpp-sdk-identity-management.so  /home/antoine/miniconda3/envs/pyarrow/lib/libaws-cpp-sdk-cognito-identity.so  /home/antoine/miniconda3/envs/pyarrow/lib/libaws-cpp-sdk-sts.so  /home/antoine/miniconda3/envs/pyarrow/lib/libaws-cpp-sdk-s3.so  /home/antoine/miniconda3/envs/pyarrow/lib/libaws-cpp-sdk-core.so  /home/antoine/miniconda3/envs/pyarrow/lib/libaws-crt-cpp.so  /home/antoine/miniconda3/envs/pyarrow/lib/libaws-c-mqtt.so.1.0.0  /home/antoine/miniconda3/envs/pyarrow/lib/libaws-c-event-stream.so.1.0.0  /home/antoine/miniconda3/envs/pyarrow/lib/libaws-c-s3.so.1.0.0  /home/antoine/miniconda3/envs/pyarrow/lib/libaws-c-auth.so.1.0.0  /home/antoine/miniconda3/envs/pyarrow/lib/libaws-c-http.so.1.0.0  /home/antoine/miniconda3/envs/pyarrow/lib/libaws-c-io.so.1.0.0  /home/antoine/miniconda3/envs/pyarrow/lib/libs2n.so  /home/antoine/miniconda3/envs/pyarrow/lib/libaws-c-compression.so.1.0.0  /home/antoine/miniconda3/envs/pyarrow/lib/libaws-c-cal.so.1.0.0  /home/antoine/miniconda3/envs/pyarrow/lib/libcrypto.so  /home/antoine/miniconda3/envs/pyarrow/lib/libaws-c-sdkutils.so.1.0.0  /home/antoine/miniconda3/envs/pyarrow/lib/libaws-checksums.so.1.0.0  /home/antoine/miniconda3/envs/pyarrow/lib/libaws-c-common.so.1.0.0  -lm  /home/antoine/miniconda3/envs/pyarrow/lib/libutf8proc.so  /home/antoine/miniconda3/envs/pyarrow/lib/libre2.so.9.0.0  -ldl  jemalloc_ep-prefix/src/jemalloc_ep/dist//lib/libjemalloc_pic.a  mimalloc_ep/src/mimalloc_ep/lib/mimalloc-1.7/libmimalloc-debug.a  -pthread  -lrt && :\r\n/home/antoine/miniconda3/envs/pyarrow/bin/ld: cannot find /home/antoine/miniconda3/envs/pyarrow/lib/clang/13.0.1/lib/linux/libclang_rt.asan-x86_64.a: No such file or directory\r\n/home/antoine/miniconda3/envs/pyarrow/bin/ld: cannot find /home/antoine/miniconda3/envs/pyarrow/lib/clang/13.0.1/lib/linux/libclang_rt.asan_cxx-x86_64.a: No such file or directory\r\nclang-13: error: linker command failed with exit code 1 (use -v to see invocation)\r\n```\r\n",
        "created_at": "2022-05-10T14:52:17.000Z",
        "updated_at": "2022-05-16T07:52:46.000Z",
        "labels": [
            "Migrated from Jira",
            "Component: C++",
            "Type: bug"
        ],
        "closed": true,
        "closed_at": "2022-05-16T07:52:46.000Z"
    },
    "comments": [
        {
            "created_at": "2022-05-10T14:52:52.628Z",
            "body": "***Note**: [Comment](https://issues.apache.org/jira/browse/ARROW-16519?focusedCommentId=17534376) by Antoine Pitrou (apitrou):*\ncc `[~uwe]`\r\n\r\n"
        },
        {
            "created_at": "2022-05-10T15:02:16.119Z",
            "body": "***Note**: [Comment](https://issues.apache.org/jira/browse/ARROW-16519?focusedCommentId=17534384) by Marius van Niekerk (mariusvniekerk):*\nThis looks like it is calling clang instead of gcc"
        },
        {
            "created_at": "2022-05-10T15:06:01.669Z",
            "body": "***Note**: [Comment](https://issues.apache.org/jira/browse/ARROW-16519?focusedCommentId=17534392) by Antoine Pitrou (apitrou):*\nYes, this is calling the conda-forge `clang\\+\\+`. I'll give it a shot with `g\\+\\+` instead."
        },
        {
            "created_at": "2022-05-10T15:13:50.474Z",
            "body": "***Note**: [Comment](https://issues.apache.org/jira/browse/ARROW-16519?focusedCommentId=17534399) by Antoine Pitrou (apitrou):*\nI can confirm that the conda-forge `g++` works for this."
        },
        {
            "created_at": "2022-05-14T19:25:15.452Z",
            "body": "***Note**: [Comment](https://issues.apache.org/jira/browse/ARROW-16519?focusedCommentId=17537102) by Wes McKinney (wesm):*\nOn gitter I was told to install https://anaconda.org/conda-forge/compiler-rt"
        },
        {
            "created_at": "2022-05-16T07:52:31.512Z",
            "body": "***Note**: [Comment](https://issues.apache.org/jira/browse/ARROW-16519?focusedCommentId=17537388) by Antoine Pitrou (apitrou):*\nI can confirme that installing `compiler-rt` fixes the issue. It's also not something we can really improve on the Arrow side, so will close."
        }
    ]
}