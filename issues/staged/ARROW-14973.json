{
    "issue": {
        "title": "[python][CI] How to build wheels depending on PyArrow that are compatible with multiple PyArrow versions",
        "body": "***Note**: This issue was originally created as [ARROW-14973](https://issues.apache.org/jira/browse/ARROW-14973). Please see the [migration documentation](https://gist.github.com/toddfarmer/12aa88361532d21902818a6044fda4c3) for further details.*\n\n### Original Issue Description:\nCurrently, for MongoDB's package [PyMongoArrow, ](https://github.com/mongodb-labs/mongo-arrow/tree/main/bindings/python)we build our wheels following the instructions [here](https://arrow.apache.org/docs/python/extending.html). (here is the [script](https://github.com/mongodb-labs/mongo-arrow/blob/main/bindings/python/release.sh) we use) However, once these wheels are built they are no longer compatible with versions of PyArrow other than the one that it was built with. Before we added Python 3.10 support we built all of our wheels with PyArrow 3.0. Those same wheels now break with the following message after upgrading PyArrow to 6.0:\r\n```java\n\r\n\u279c \u00a0~ pip install --upgrade pyarrow\r\nDefaulting to user installation because normal site-packages is not writeable\r\nRequirement already satisfied: pyarrow in ./Library/Python/3.8/lib/python/site-packages (3.0.0)\r\nCollecting pyarrow\r\n\u00a0 Downloading pyarrow-6.0.1-cp38-cp38-macosx_10_13_x86_64.whl (19.1 MB)\r\n\u00a0 \u00a0 \u00a0|\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588| 19.1 MB 5.1 MB/s\r\nRequirement already satisfied: numpy>=1.16.6 in ./Library/Python/3.8/lib/python/site-packages (from pyarrow) (1.21.4)\r\nInstalling collected packages: pyarrow\r\n\u00a0 Attempting uninstall: pyarrow\r\n\u00a0 \u00a0 Found existing installation: pyarrow 3.0.0\r\n\u00a0 \u00a0 Uninstalling pyarrow-3.0.0:\r\n\u00a0 \u00a0 \u00a0 Successfully uninstalled pyarrow-3.0.0\r\nERROR: pip's dependency resolver does not currently take into account all the packages that are installed. This behaviour is the source of the following dependency conflicts.\r\npymongoarrow 0.1.1 requires pyarrow<3.1,>=3, but you have pyarrow 6.0.1 which is incompatible.\r\nSuccessfully installed pyarrow-6.0.1\r\n\u279c \u00a0~ cd Work/mongo-arrow/bindings/python/test\r\n\u279c \u00a0test git:(PYTHON-3008) \u2717 python3 -m unittest discover EEEEEEEEEE ====================================================================== ERROR: test_arrow (unittest.loader._FailedTest) ---------------------------------------------------------------------- ImportError: Failed to import test module: test_arrow Traceback (most recent call last): \u00a0 File \"/Library/Developer/CommandLineTools/Library/Frameworks/Python3.framework/Versions/3.8/lib/python3.8/unittest/loader.py\", line 436, in _find_test_path \u00a0 \u00a0 module = self._get_module_from_name(name) \u00a0 File \"/Library/Developer/CommandLineTools/Library/Frameworks/Python3.framework/Versions/3.8/lib/python3.8/unittest/loader.py\", line 377, in _get_module_from_name \u00a0 \u00a0 __import__(name) \u00a0 File \"/Users/julius/Work/mongo-arrow/bindings/python/test/test_arrow.py\", line 20, in <module> \u00a0 \u00a0 from pymongoarrow.api import aggregate_arrow_all, find_arrow_all, Schema \u00a0 File \"/Users/julius/Library/Python/3.8/lib/python/site-packages/pymongoarrow/__init__.py\", line 18, in <module> \u00a0 \u00a0 from pymongoarrow.lib import libbson_version ImportError: dlopen(/Users/julius/Library/Python/3.8/lib/python/site-packages/pymongoarrow/lib.cpython-38-darwin.so, 2): Library not loaded: @rpath/libarrow.300.dylib \u00a0 Referenced from: /Users/julius/Library/Python/3.8/lib/python/site-packages/pymongoarrow/lib.cpython-38-darwin.so \u00a0 Reason: image not found\r\n```\r\nThe same error occurs when using our newer wheels built with PyArrow 6.0 when you downgrade to PyArrow 3.0:\r\n```java\n\r\n\u279c \u00a0python git:(main) \u2717 pip install pyarrow==3.0\r\nDefaulting to user installation because normal site-packages is not writeable\r\nCollecting pyarrow==3.0\r\n\u00a0 Using cached pyarrow-3.0.0-cp38-cp38-macosx_10_13_x86_64.whl (14.1 MB)\r\nRequirement already satisfied: numpy>=1.16.6 in /Users/julius/Library/Python/3.8/lib/python/site-packages (from pyarrow==3.0) (1.21.4)\r\nInstalling collected packages: pyarrow\r\n\u00a0 Attempting uninstall: pyarrow\r\n\u00a0 \u00a0 Found existing installation: pyarrow 6.0.1\r\n\u00a0 \u00a0 Uninstalling pyarrow-6.0.1:\r\n\u00a0 \u00a0 \u00a0 Successfully uninstalled pyarrow-6.0.1\r\nERROR: pip's dependency resolver does not currently take into account all the packages that are installed. This behaviour is the source of the following dependency conflicts.\r\npymongoarrow 0.2.0.dev0 requires pyarrow<6.1,>=6, but you have pyarrow 3.0.0 which is incompatible.\r\nSuccessfully installed pyarrow-3.0.0\r\n\u279c \u00a0python git:(main) \u2717 cd tests\r\ncd: no such file or directory: tests\r\n\u279c \u00a0python git:(main) \u2717 cd test\r\n\u279c \u00a0test git:(main) \u2717 python3 -m unittest discover\r\nEEEEEEEEEE\r\n======================================================================\r\nERROR: test_arrow (unittest.loader._FailedTest)\r\n----------------------------------------------------------------------\r\nImportError: Failed to import test module: test_arrow\r\nTraceback (most recent call last):\r\n\u00a0 File \"/Library/Developer/CommandLineTools/Library/Frameworks/Python3.framework/Versions/3.8/lib/python3.8/unittest/loader.py\", line 436, in _find_test_path\r\n\u00a0 \u00a0 module = self._get_module_from_name(name)\r\n\u00a0 File \"/Library/Developer/CommandLineTools/Library/Frameworks/Python3.framework/Versions/3.8/lib/python3.8/unittest/loader.py\", line 377, in _get_module_from_name\r\n\u00a0 \u00a0 __import__(name)\r\n\u00a0 File \"/Users/julius/Work/mongo-arrow/bindings/python/test/test_arrow.py\", line 20, in <module>\r\n\u00a0 \u00a0 from pymongoarrow.api import aggregate_arrow_all, find_arrow_all, Schema\r\n\u00a0 File \"/Users/julius/Library/Python/3.8/lib/python/site-packages/pymongoarrow/__init__.py\", line 18, in <module>\r\n\u00a0 \u00a0 from pymongoarrow.lib import libbson_version\r\nImportError: dlopen(/Users/julius/Library/Python/3.8/lib/python/site-packages/pymongoarrow/lib.cpython-38-darwin.so, 2): Library not loaded: @rpath/libarrow.600.dylib\r\n\u00a0 Referenced from: /Users/julius/Library/Python/3.8/lib/python/site-packages/pymongoarrow/lib.cpython-38-darwin.so\r\n\u00a0 Reason: image not found\r\n \n```\r\nIs there a way to build wheels that support multiple PyArrow versions?\r\n\r\n\u00a0\r\n\r\n\u00a0",
        "created_at": "2021-12-02T23:57:57.000Z",
        "updated_at": "2021-12-03T01:23:19.000Z",
        "labels": [
            "Migrated from Jira",
            "Component: Continuous Integration",
            "Component: Python",
            "Type: enhancement"
        ],
        "closed": false
    },
    "comments": []
}