{
    "issue": {
        "title": "[R] Pre-render vignettes",
        "body": "***Note**: This issue was originally created as [ARROW-17655](https://issues.apache.org/jira/browse/ARROW-17655). Please see the [migration documentation](https://gist.github.com/toddfarmer/12aa88361532d21902818a6044fda4c3) for further details.*\n\n### Original Issue Description:\nWorking on ARROW-17448 made me think about how one can pre-render vignettes to a) test that the code in them works but b) does not impose the burden of rendering them on CRAN which is not possible. \r\n\r\nThe basic idea would be to convert the existing rmd vignettes into files that knitr::knit can work with and then output pre-rendered rmds that can be shipped directly to CRAN. Here is a reprex that illustrates this approach:\r\n\r\nMake a .Rmd.raw file:\r\n\r\n\u00a0\r\n```java\n\r\ntdir <- tempdir()\r\n## write a vignette but write it as *.Rmd.raw\r\nwriteLines(\r\n\u00a0 \u00a0 r\"(---\r\ntitle: \"a great vignette\"\r\noutput: rmarkdown::html_vignette\r\nvignette: >\r\n\u00a0 %\\VignetteIndexEntry{a great vignette}\r\n\u00a0 %\\VignetteEngine{knitr::rmarkdown}\r\n\u00a0 %\\VignetteEncoding{UTF-8}\r\n---\r\n```{r options, include=FALSE}\r\nknitr::opts_chunk$set(echo = TRUE,\u00a0\r\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 warning = FALSE,\u00a0\r\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 message = FALSE,\u00a0\r\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 fig.path = \"vignette-fig-\")\r\n```\r\n## Some text and code\r\nhere is `quakes`\r\n```{r}\r\nhead(quakes)\r\n```\r\nand here is a plot of quakes:\r\n```{r, echo = FALSE}\r\nplot(quakes)\r\n```)\", \u00a0\r\n\u00a0 \u00a0 con = file.path(tdir, \"great-vignette.Rmd.raw\")\r\n)\r\n```\r\nThen render it and output an .Rmd:\r\n\r\n\r\n\r\n\u00a0\r\n```java\n\r\n## find the vignette\r\nraw_vignette <- file.path(list.files(path = tdir, pattern = \"*\\\\.Rmd\\\\.raw\", full.names = TRUE))\r\nrendered_vignette <- tools::file_path_sans_ext(raw_vignette)\r\n## knit the file and outputs an Rmd ready for CRAN that has all the results\r\nknitr::knit(raw_vignette, rendered_vignette, quiet = TRUE)\r\n```\r\n\r\nwhich results in a pre-rendered Rmd:\r\n```java\n\r\ncat(readLines(rendered_vignette), sep = \"\\n\")\r\n\r\n---\r\ntitle: \"a great vignette\"\r\noutput: rmarkdown::html_vignette\r\nvignette: >\r\n\u00a0 %\\VignetteIndexEntry{a great vignette}\r\n\u00a0 %\\VignetteEngine{knitr::rmarkdown}\r\n\u00a0 %\\VignetteEncoding{UTF-8}\r\n---\r\n\r\n## Some text and code\r\nhere is `quakes`\r\n```r\r\nhead(quakes)\r\n```\r\n```\r\n## \u00a0 \u00a0 \u00a0lat \u00a0 long depth mag stations\r\n## 1 -20.42 181.62 \u00a0 562 4.8 \u00a0 \u00a0 \u00a0 41\r\n## 2 -20.62 181.03 \u00a0 650 4.2 \u00a0 \u00a0 \u00a0 15\r\n## 3 -26.00 184.10 \u00a0 \u00a042 5.4 \u00a0 \u00a0 \u00a0 43\r\n## 4 -17.97 181.66 \u00a0 626 4.1 \u00a0 \u00a0 \u00a0 19\r\n## 5 -20.42 181.96 \u00a0 649 4.0 \u00a0 \u00a0 \u00a0 11\r\n## 6 -19.68 184.31 \u00a0 195 4.0 \u00a0 \u00a0 \u00a0 12\r\n```\r\nand here is a plot of quakes:\r\n![plot of chunk unnamed-chunk-2](vignette-fig-unnamed-chunk-2-1.png)\r\n```\r\nNo worries if we don't want to take this approach. It would require running the vignettes on someone's machine prior to a CRAN submission. That could go in the Makefile: https://github.com/apache/arrow/blob/master/r/Makefile\r\n\r\n\u00a0\r\n\r\n\u00a0\r\n\r\n\u00a0",
        "created_at": "2022-09-08T21:39:08.000Z",
        "updated_at": "2022-09-08T21:39:19.000Z",
        "labels": [
            "Migrated from Jira",
            "Component: R",
            "Type: enhancement"
        ],
        "closed": false
    },
    "comments": []
}