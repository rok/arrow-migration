{
    "issue": {
        "title": "[Python] Pyarrow.Parquet.read_table Silently Crashes Python",
        "body": "***Note**: This issue was originally created as [ARROW-9229](https://issues.apache.org/jira/browse/ARROW-9229). Please see the [migration documentation](https://gist.github.com/toddfarmer/12aa88361532d21902818a6044fda4c3) for further details.*\n\n### Original Issue Description:\nA simple use of reading a Parquet file using PyArrow crashes Python silently with no explanation. Sudden and strange. I've narrowed it down to reproduce it as follows:\r\n```bash\n\r\nconda create -n pa36 python=3.6 pyarrow=0.17 -c conda-forge -y\r\n```\r\n\r\nThen, in python:\r\n```python\n\r\nimport pyarrow.parquet\r\ntbl = pyarrow.parquet.read_table(\"some_file.snappy.parquet\")\r\n```\r\nResult - It crashes. Maybe because of the Snappy encoding? FWIW, the files were generated by Spark on Azure Databricks, not pandas.\r\n\u00a0\r\n\r\nHere's the conda environment:\r\n```bash\n\r\n(base) > conda env export\n```\r\n```yaml\n\r\n name: pa36\r\n channels: \r\n - conda-forge\r\n - defaults\r\n dependencies: \r\n - abseil-cpp=20200225.2=h33f27b4_0\r\n - arrow-cpp=0.17.1=py36h1234567_8_cpu\r\n - aws-sdk-cpp=1.7.164=vc14h867dc94_1\r\n - boost-cpp=1.72.0=h2ba7cf6_1\r\n - brotli=1.0.7=h33f27b4_1002\r\n - bzip2=1.0.8=hfa6e2cd_2\r\n - c-ares=1.15.0=h2fa13f4_1001\r\n - ca-certificates=2020.6.20=hecda079_0\r\n - certifi=2020.6.20=py36h9f0ad1d_0\r\n - curl=7.71.0=h4b64cdc_0\r\n - gflags=2.2.2=he025d50_1002\r\n - glog=0.4.0=h0174b99_3\r\n - grpc-cpp=1.30.0=hfae5148_0\r\n - intel-openmp=2020.0=166\r\n - krb5=1.17.1=hc04afaa_1\r\n - libblas=3.8.0=15_mkl\r\n - libcblas=3.8.0=15_mkl\r\n - libcurl=7.71.0=h4b64cdc_0\r\n - liblapack=3.8.0=15_mkl\r\n - libprotobuf=3.12.3=h7bd577a_0\r\n - libssh2=1.9.0=h3235a2c_2\r\n - lz4-c=1.9.2=h62dcd97_1\r\n - mkl=2020.0=166\r\n - numpy=1.18.5=py36h4d86e3b_0\r\n - openssl=1.1.1g=he774522_0\r\n - pandas=1.0.5=py36hcc50265_0\r\n - parquet-cpp=1.5.1=2\r\n - pip=20.1.1=py_1\r\n - pyarrow=0.17.1=py36h1234567_8_cpu\r\n - python=3.6.10=he025d50_1009_cpython\r\n - python-dateutil=2.8.1=py_0\r\n - python_abi=3.6=1_cp36m\r\n - pytz=2020.1=pyh9f0ad1d_0\r\n - re2=2020.06.01=h33f27b4_0\r\n - setuptools=47.3.1=py36h9f0ad1d_0\r\n - six=1.15.0=pyh9f0ad1d_0\r\n - snappy=1.1.8=ha925a31_2\r\n - thrift-cpp=0.13.0=h1907cbf_2\r\n - tk=8.6.10=hfa6e2cd_0\r\n - vc=14.1=h869be7e_1\r\n - vs2015_runtime=14.16.27012=h30e32a0_2\r\n - wheel=0.34.2=py_1\r\n - wincertstore=0.2=py36_1003\r\n - xz=5.2.5=h2fa13f4_0\r\n - zlib=1.2.11=h2fa13f4_1006\r\n - zstd=1.4.4=h9f78265_3\r\n```",
        "created_at": "2020-06-25T16:37:08.000Z",
        "updated_at": "2020-06-29T15:12:08.000Z",
        "labels": [
            "Migrated from Jira",
            "Component: Python",
            "Type: bug"
        ],
        "closed": true,
        "closed_at": "2020-06-29T14:46:13.000Z"
    },
    "comments": [
        {
            "created_at": "2020-06-25T17:57:56.713Z",
            "body": "***Note**: [Comment](https://issues.apache.org/jira/browse/ARROW-9229?focusedCommentId=17145702) by Uwe Korn (uwe):*\nThis is probably a duplicate of https://issues.apache.org/jira/browse/ARROW-7939"
        },
        {
            "created_at": "2020-06-25T18:04:15.082Z",
            "body": "***Note**: [Comment](https://issues.apache.org/jira/browse/ARROW-9229?focusedCommentId=17145705) by Josh Dimarsky (ydimarsky@gmail.com):*\nThanks, you are correct, my bad."
        },
        {
            "created_at": "2020-06-25T22:10:51.511Z",
            "body": "***Note**: [Comment](https://issues.apache.org/jira/browse/ARROW-9229?focusedCommentId=17145890) by Wes McKinney (wesm):*\nAny information you can provide about the hardware (e.g. CPU make and model number) where it's crashing would be helpful"
        },
        {
            "created_at": "2020-06-26T00:12:15.189Z",
            "body": "***Note**: [Comment](https://issues.apache.org/jira/browse/ARROW-9229?focusedCommentId=17145945) by Josh Dimarsky (ydimarsky@gmail.com):*\nWeird... I can't reproduce it on my laptop at home, and I even setup a GitHub repo just to try reproducing it in GitHub Actions, but it seems to work fine there too. However, at my computer at work it was crashing - I'll update this issue tomorrow with its specs.\r\n\r\nLink to GH Action:\u00a0<https://github.com/yehoshuadimarsky/pyarrow-bug/runs/809395674?check_suite_focus=true#step:5:1>\r\n\r\nLaptop CPU config (by running same [script](https://github.com/yehoshuadimarsky/pyarrow-bug/blob/master/output_config.py) from GH repo):\r\n```java\n\r\n(base) PS C:\\Users\\JoshDimarsky\\Documents\\GitHub\\pyarrow-bug> python .\\output_config.py\r\nThe hardware config is:\r\n{'compiler': 'MSC v.1915 64 bit (AMD64)',\r\n 'machine': 'AMD64',\r\n 'processor': 'Intel64 Family 6 Model 142 Stepping 10, GenuineIntel',\r\n 'release': '10',\r\n 'system': 'Windows',\r\n 'version': '10.0.18362'}\n```\r\n\u00a0"
        },
        {
            "created_at": "2020-06-26T14:11:16.489Z",
            "body": "***Note**: [Comment](https://issues.apache.org/jira/browse/ARROW-9229?focusedCommentId=17146324) by Wes McKinney (wesm):*\nYour laptop (iX-7XXX) supports AVX2 so it should be fine. "
        },
        {
            "created_at": "2020-06-26T14:15:34.586Z",
            "body": "***Note**: [Comment](https://issues.apache.org/jira/browse/ARROW-9229?focusedCommentId=17146340) by Josh Dimarsky (ydimarsky@gmail.com):*\nJust tried it on my work PC, and it crashed - here are the CPU specs:\r\n```bash\n\r\n(pa38) PS C:\\Users\\JoshDimarsky.AzureAD\\Documents\\GitHub\\pyarrow-bug> python .\\output_config.py\r\nThe hardware config is:\r\n{'compiler': 'MSC v.1916 64 bit (AMD64)',\r\n 'machine': 'AMD64',\r\n 'processor': 'Intel64 Family 6 Model 45 Stepping 7, GenuineIntel',\r\n 'release': '10',\r\n 'system': 'Windows',\r\n 'version': '10.0.18362'}\n```"
        },
        {
            "created_at": "2020-06-26T14:16:32.668Z",
            "body": "***Note**: [Comment](https://issues.apache.org/jira/browse/ARROW-9229?focusedCommentId=17146342) by Josh Dimarsky (ydimarsky@gmail.com):*\nConfirmed it still crashes when using a\u00a0Intel64 Family 6 Model 45 Stepping 7 GenuineIntel ~3601 Mhz CPU"
        },
        {
            "created_at": "2020-06-26T14:17:23.081Z",
            "body": "***Note**: [Comment](https://issues.apache.org/jira/browse/ARROW-9229?focusedCommentId=17146344) by Josh Dimarsky (ydimarsky@gmail.com):*\nScreenshot of my CPU from Windows settings if that helps:\r\n\r\n![image-2020-06-26-10-17-04-121.png](https://issues.apache.org/jira/secure/attachment/13006525/image-2020-06-26-10-17-04-121.png)"
        },
        {
            "created_at": "2020-06-26T14:34:47.015Z",
            "body": "***Note**: [Comment](https://issues.apache.org/jira/browse/ARROW-9229?focusedCommentId=17146358) by Wes McKinney (wesm):*\nYeah that processor doesn't support AVX2 / BMI2 instructions. \r\n\r\nThis will be fixed by https://github.com/conda-forge/snappy-feedstock/pull/26 when it's merged, so once you update Snappy (after the package is updated) the problem should go away"
        },
        {
            "created_at": "2020-06-26T14:43:54.771Z",
            "body": "***Note**: [Comment](https://issues.apache.org/jira/browse/ARROW-9229?focusedCommentId=17146371) by Josh Dimarsky (ydimarsky@gmail.com):*\nThanks!"
        },
        {
            "created_at": "2020-06-29T14:46:13.098Z",
            "body": "***Note**: [Comment](https://issues.apache.org/jira/browse/ARROW-9229?focusedCommentId=17147845) by Josh Dimarsky (ydimarsky@gmail.com):*\nIssue was related to BMI instructions issue with Snappy on 1.1.8 and only on Windows, was resolved in conda-forge build #3, see linked issue."
        },
        {
            "created_at": "2020-06-29T15:12:08.791Z",
            "body": "***Note**: [Comment](https://issues.apache.org/jira/browse/ARROW-9229?focusedCommentId=17147868) by Wes McKinney (wesm):*\nThank you for confirming"
        }
    ]
}