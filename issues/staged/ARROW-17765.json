{
    "issue": {
        "title": "Archery docker: multiplatform support on arm64",
        "body": "***Note**: This issue was originally created as [ARROW-17765](https://issues.apache.org/jira/browse/ARROW-17765). Please see the [migration documentation](https://gist.github.com/toddfarmer/12aa88361532d21902818a6044fda4c3) for further details.*\n\n### Original Issue Description:\nIt seems right now is not possible to build/run arrow docker containers with arch=arm64 (the default platform is amd64)\r\n\r\nI tried first with this command:\r\n\r\n\u00a0\r\n```java\n\r\nARCH=arm64 archery docker run conda-cpp-valgrind\n```\r\n\u00a0\r\n\r\nand got this error:\r\n\r\n\u00a0\r\n```java\n\r\n[+] Running 0/1\r\n\u00a0\u283f conda Error \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a01.8s\r\nPulling conda: Error response from daemon: manifest for apache/arrow-dev:arm64-conda not found: manifest unknown: manifest unknown\r\n[+] Running 0/1\r\n\u00a0\u283f conda-cpp Error \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a01.7s\r\nPulling conda-cpp: Error response from daemon: manifest for apache/arrow-dev:arm64-conda-cpp not found: manifest unknown: manifest unknown\r\n[+] Building 1.1s (3/3) FINISHED\r\n\u00a0=> [internal] load build definition from conda.dockerfile \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a00.0s\r\n\u00a0=> => transferring dockerfile: 38B \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 0.0s\r\n\u00a0=> [internal] load .dockerignore \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 0.0s\r\n\u00a0=> => transferring context: 35B \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a00.0s\r\n\u00a0=> ERROR [internal] load metadata for docker.io/arm64/ubuntu:18.04 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 1.0s\r\n------\r\n\u00a0> [internal] load metadata for docker.io/arm64/ubuntu:18.04:\r\n------\r\nfailed to solve: rpc error: code = Unknown desc = failed to solve with frontend dockerfile.v0: failed to create LLB definition: pull access denied, repository does not exist or may require authorization: server message: insufficient_scope: authorization failed\r\nError: `docker-compose --file /arrow/docker-compose.yml build --build-arg BUILDKIT_INLINE_CACHE=1 conda` exited with a non-zero exit code 17, see the process log above.\r\nThe docker-compose command was invoked with the following parameters:\r\nDefaults defined in .env:\r\n\u00a0 ALMALINUX: 8\r\n\u00a0 ALPINE_LINUX: 3.16\r\n\u00a0 ARCH: amd64\r\n\u00a0 ARCH_ALIAS: x86_64\r\n\u00a0 ARCH_SHORT: amd64\r\n\u00a0 ARROW_R_DEV: TRUE\r\n\u00a0 BUILDKIT_INLINE_CACHE: 1\r\n\u00a0 CLANG_TOOLS: 12\r\n\u00a0 COMPOSE_DOCKER_CLI_BUILD: 1\r\n\u00a0 CONAN: gcc10\r\n\u00a0 CUDA: 11.0.3\r\n\u00a0 DASK: latest\r\n\u00a0 DEBIAN: 11\r\n\u00a0 DEVTOOLSET_VERSION: -1\r\n\u00a0 DOCKER_BUILDKIT: 1\r\n\u00a0 DOCKER_VOLUME_PREFIX:\r\n\u00a0 DOTNET: 6.0\r\n\u00a0 FEDORA: 35\r\n\u00a0 GCC_VERSION:\r\n\u00a0 GO: 1.17\r\n\u00a0 HDFS: 3.2.1\r\n\u00a0 JDK: 8\r\n\u00a0 KARTOTHEK: latest\r\n\u00a0 LLVM: 13\r\n\u00a0 MAVEN: 3.5.4\r\n\u00a0 NODE: 16\r\n\u00a0 NUMBA: latest\r\n\u00a0 NUMPY: latest\r\n\u00a0 PANDAS: latest\r\n\u00a0 PYTHON: 3.8\r\n\u00a0 PYTHON_WHEEL_WINDOWS_IMAGE_REVISION: 2022-06-12\r\n\u00a0 R: 4.2\r\n\u00a0 REPO: apache/arrow-dev\r\n\u00a0 R_CUSTOM_CCACHE: false\r\n\u00a0 R_IMAGE: ubuntu-gcc-release\r\n\u00a0 R_ORG: rhub\r\n\u00a0 R_PRUNE_DEPS: FALSE\r\n\u00a0 R_TAG: latest\r\n\u00a0 SPARK: master\r\n\u00a0 STATICCHECK: v0.2.2\r\n\u00a0 TURBODBC: latest\r\n\u00a0 TZ: UTC\r\n\u00a0 UBUNTU: 20.04\r\n\u00a0 ULIMIT_CORE: -1\r\n\u00a0 VCPKG: 38bb87c\r\nArchery was called with:\r\n\u00a0 export ARCH=arm64\r\n```\r\n\u00a0\r\n\r\nThen, I tried to use the docker buildx plugin with this command:\r\n\r\n\u00a0\r\n```java\n\r\nARCH=arm64 archery docker run --using-docker-buildx conda-cpp-valgrind\n```\r\n\u00a0\r\n\r\nand got this error:\r\n\r\n\u00a0\r\n```java\n\r\nError response from daemon: manifest for apache/arrow-dev:arm64-conda not found: manifest unknown: manifest unknown\r\ndocker pull apache/arrow-dev:arm64-conda exited with non-zero exit code 1\r\nError response from daemon: manifest for apache/arrow-dev:arm64-conda-cpp not found: manifest unknown: manifest unknown\r\ndocker pull apache/arrow-dev:arm64-conda-cpp exited with non-zero exit code 1\r\n[+] Building 0.0s (0/0)\r\nERROR: cache export feature is currently not supported for docker driver. Please switch to a different driver (eg. \"docker buildx create --use\")\r\nError: docker buildx build --build-arg BUILDKIT_INLINE_CACHE=1 --build-arg arch=arm64 --cache-from type=registry,ref=apache/arrow-dev:arm64-conda-cache --cache-to type=registry,ref=apache/arrow-dev:arm64-conda-cache,mode=max --output type=docker -f /arrow/ci/docker/conda.dockerfile -t apache/arrow-dev:arm64-conda /arrow exited with non-zero exit code 1\n```\r\nMy system env is:\r\n\r\n\u00a0\r\n```java\n\r\nuname -a\r\nDarwin MacBook-Pro.local 21.6.0 Darwin Kernel Version 21.6.0: Mon Aug 22 20:19:52 PDT 2022; root:xnu-8020.140.49~2/RELEASE_ARM64_T6000 arm64\r\n\u00a0\r\ndocker --version\r\nDocker version 20.10.17, build 100c701\r\n\r\ndocker compose version\r\nDocker Compose version v2.10.2\r\n```\r\n\u00a0\r\n\r\n\u00a0",
        "created_at": "2022-09-18T05:33:36.000Z",
        "updated_at": "2022-09-19T17:39:03.000Z",
        "labels": [
            "Migrated from Jira",
            "Component: Archery",
            "Type: bug"
        ],
        "closed": false
    },
    "comments": [
        {
            "created_at": "2022-09-18T21:00:52.979Z",
            "body": "***Note**: [Comment](https://issues.apache.org/jira/browse/ARROW-17765?focusedCommentId=17606351) by Kouhei Sutou (kou):*\nCould you try `ARCH=arm64v8` instead?"
        },
        {
            "created_at": "2022-09-19T17:39:03.059Z",
            "body": "***Note**: [Comment](https://issues.apache.org/jira/browse/ARROW-17765?focusedCommentId=17606690) by Percy Camilo Trive\u00f1o Aucahuasi (aucahuasi):*\nThanks for the advice, unfortunately it seems didn't work.\r\nI ran:\r\n```java\n\r\nARCH=arm64v8 archery docker run conda-cpp-valgrind bash\n```\r\nwith this error: [without-buildx.txt.log.sh](without-buildx.txt.log.sh).\r\nAnd also, I ran using the buildx plugin with no cache\r\n```java\n\r\nARCH=arm64v8 archery docker run --using-docker-buildx --no-cache conda-cpp-valgrind bash\n```\r\nand got this error: [with-buildx.txt.log.sh](with-buildx.txt.log.sh)"
        }
    ]
}