{
    "issue": {
        "title": "pyarrow.parquet.read_table fs (filesystem) argument does not work with fsspec.implementations.arrow.ArrowFSWrapper objects",
        "body": "***Note**: This issue was originally created as [ARROW-17898](https://issues.apache.org/jira/browse/ARROW-17898). Please see the [migration documentation](https://gist.github.com/toddfarmer/12aa88361532d21902818a6044fda4c3) for further details.*\n\n### Original Issue Description:\nMy version of PyArrow=8.0.0. When I attempt to use a PyArrow LocalFileSystem object wrapped with ArrowFSWrapper it results in the following error:\r\n\r\n```python\n\r\nimport pyarrow as pa\r\nimport pyarrow.parquet as pq\r\nfrom fsspec.implementations.arrow import ArrowFSWrapper\r\n\r\nlfs = pa.fs.LocalFileSystem()\r\nfs = ArrowFSWrapper(lfs)\r\npat = pq.read_table(\"some/file/location.parquet\", filesystem=fs)\r\n```\r\n\r\n```Java\n\r\n{{OSError Traceback (most recent call last) Cell In [12], line 1 ----> 1 pat = pq.read_table(  *2* \"some/file/location.parquet\",  *3* filesystem=fs) File /usr/local/lib/python3.8/dist-packages/pyarrow/parquet/__init__.py:2737, in read_table(source, columns, use_threads, metadata, schema, use_pandas_metadata, memory_map, read_dictionary, filesystem, filters, buffer_size, partitioning, use_legacy_dataset, ignore_prefixes, pre_buffer, coerce_int96_timestamp_unit, decryption_properties)  *2730* raise ValueError(  *2731* \"The 'metadata' keyword is no longer supported with the new \"  *2732* \"datasets-based implementation. Specify \"  *2733* \"'use_legacy_dataset=True' to temporarily recover the old \"  *2734* \"behaviour.\"  *2735* )  *2736* try: -> 2737 dataset = _ParquetDatasetV2(  *2738* source,  *2739* schema=schema,  *2740* filesystem=filesystem,  *2741* partitioning=partitioning,  *2742* memory_map=memory_map,  *2743* read_dictionary=read_dictionary,  *2744* buffer_size=buffer_size,  *2745* filters=filters,  *2746* ignore_prefixes=ignore_prefixes,}}\r\n...\r\nFile /usr/local/lib/python3.8/dist-packages/pyarrow/io.pxi:193, in pyarrow.lib.NativeFile.get_random_access_file() File /usr/local/lib/python3.8/dist-packages/pyarrow/io.pxi:222, in pyarrow.lib.NativeFile._assert_seekable() OSError: only valid on seekable files\r\n```\r\n\r\nIf I instead use just the LocalFileSystem object without the ArrowFSWrapper, it works as expected.\r\n\r\n \r\n",
        "created_at": "2022-09-29T21:56:57.000Z",
        "updated_at": "2022-10-03T16:22:11.000Z",
        "labels": [
            "Migrated from Jira",
            "Component: Parquet",
            "Component: Python",
            "Type: bug"
        ],
        "closed": false
    },
    "comments": [
        {
            "created_at": "2022-10-03T10:51:09.100Z",
            "body": "***Note**: [Comment](https://issues.apache.org/jira/browse/ARROW-17898?focusedCommentId=17612246) by Alenka Frim (alenka):*\nI haven't used `ArrowFSWrapper` or `fsspec` before but looking at the docs this should work:\r\n```python\n\r\nimport pyarrow as pa\r\nimport pyarrow.parquet as pq\r\n\r\nfrom pyarrow import fs\r\nlocal = fs.LocalFileSystem()\r\nfrom fsspec.implementations.arrow import ArrowFSWrapper\r\nlocal_fsspec = ArrowFSWrapper(local)\r\n\r\ntable = pa.table({'year': [2020, 2022, 2021, 2022, 2019, 2021],\r\n                  'n_legs': [2, 2, 4, 4, 5, 100]})\r\npq.write_table(table, 'example.parquet', filesystem=local_fsspec)\r\n\r\npq.read_table(\"example.parquet\", filesystem=local_fsspec)\r\n```\r\nand it is also erroring for me (pyarrow 8.0.0 and 9.0.0)\r\n```java\n\r\nTraceback (most recent call last):\r\n  File \"<stdin>\", line 1, in <module>\r\n  File \"/Users/alenkafrim/repos/pyarrow-triaging-9/lib/python3.9/site-packages/pyarrow/parquet/__init__.py\", line 2780, in read_table\r\n    dataset = _ParquetDatasetV2(\r\n  File \"/Users/alenkafrim/repos/pyarrow-triaging-9/lib/python3.9/site-packages/pyarrow/parquet/__init__.py\", line 2368, in __init__\r\n    [fragment], schema=schema or fragment.physical_schema,\r\n  File \"pyarrow/_dataset.pyx\", line 898, in pyarrow._dataset.Fragment.physical_schema.__get__\r\n  File \"pyarrow/error.pxi\", line 144, in pyarrow.lib.pyarrow_internal_check_status\r\n  File \"pyarrow/io.pxi\", line 265, in pyarrow.lib.NativeFile.tell\r\n  File \"pyarrow/io.pxi\", line 197, in pyarrow.lib.NativeFile.get_random_access_file\r\n  File \"pyarrow/io.pxi\", line 226, in pyarrow.lib.NativeFile._assert_seekable\r\nOSError: only valid on seekable files\r\n```"
        }
    ]
}