{
    "issue": {
        "title": "[C++] orc_ep build fails on 64-bit Raspbian",
        "body": "***Note**: This issue was originally created as [ARROW-7968](https://issues.apache.org/jira/browse/ARROW-7968). Please see the [migration documentation](https://gist.github.com/toddfarmer/12aa88361532d21902818a6044fda4c3) for further details.*\n\n### Original Issue Description:\nHello,\r\n\r\nI am building PyArrow on Rasberry Pi 4 running 64bit Raspbian.\r\n\r\nA am following this guide to build from sources - <https://gist.github.com/heavyinfo/04e1326bb9bed9cecb19c2d603c8d521.>\r\n\r\nI am using the 16.0 version of arrow.\r\nAlso, as I do not have Cuda, I removed the Cuda instructions.\r\n\r\nDuring the\u00a0\r\n```java\n\r\nmake -j4\n```\r\nI get error:\r\n\r\n\u00a0\r\n```java\n\r\n[ 16%] Creating directories for 'orc_ep'\r\nScanning dependencies of target grpc_ep\r\n[ 16%] Creating directories for 'grpc_ep'\r\n[ 16%] Performing download step (download, verify and extract) for 'orc_ep'\r\n[ 16%] Performing download step (download, verify and extract) for 'grpc_ep'\r\n-- orc_ep download command succeeded. See also /home/pi/Repositories/arrow-build/build_16/arrow-apache-arrow-0.16.0/cpp/release/orc_ep-prefix/src/orc_ep-stamp/orc_ep-download-*.log\r\n[ 16%] No patch step for 'orc_ep'\r\n[ 16%] No update step for 'orc_ep'\r\n[ 17%] Performing configure step for 'orc_ep'\r\n-- grpc_ep download command succeeded. See also /home/pi/Repositories/arrow-build/build_16/arrow-apache-arrow-0.16.0/cpp/release/grpc_ep-prefix/src/grpc_ep-stamp/grpc_ep-download-*.log\r\n[ 17%] No patch step for 'grpc_ep'\r\n[ 17%] No update step for 'grpc_ep'\r\n[ 17%] Performing configure step for 'grpc_ep'\r\n-- grpc_ep configure command succeeded. See also /home/pi/Repositories/arrow-build/build_16/arrow-apache-arrow-0.16.0/cpp/release/grpc_ep-prefix/src/grpc_ep-stamp/grpc_ep-configure-*.log\r\n[ 18%] Performing build step for 'grpc_ep'\r\n-- orc_ep configure command succeeded. See also /home/pi/Repositories/arrow-build/build_16/arrow-apache-arrow-0.16.0/cpp/release/orc_ep-prefix/src/orc_ep-stamp/orc_ep-configure-*.log\r\n[ 18%] Performing build step for 'orc_ep'\r\nCMake Error at /home/pi/Repositories/arrow-build/build_16/arrow-apache-arrow-0.16.0/cpp/release/orc_ep-prefix/src/orc_ep-stamp/orc_ep-build-RELEASE.cmake:16 (message):\r\n Command failed: 2\r\n'make'\r\nSee also\r\n/home/pi/Repositories/arrow-build/build_16/arrow-apache-arrow-0.16.0/cpp/release/orc_ep-prefix/src/orc_ep-stamp/orc_ep-build-*.log\r\n\r\nmake[2]: *** [CMakeFiles/orc_ep.dir/build.make:112: orc_ep-prefix/src/orc_ep-stamp/orc_ep-build] Error 1\r\nmake[1]: *** [CMakeFiles/Makefile2:211: CMakeFiles/orc_ep.dir/all] Error 2\r\nmake[1]: *** Waiting for unfinished jobs....\r\nCMake Error at /home/pi/Repositories/arrow-build/build_16/arrow-apache-arrow-0.16.0/cpp/release/grpc_ep-prefix/src/grpc_ep-stamp/grpc_ep-build-RELEASE.cmake:16 (message):\r\n Command failed: 2\r\n'make'\r\nSee also\r\n/home/pi/Repositories/arrow-build/build_16/arrow-apache-arrow-0.16.0/cpp/release/grpc_ep-prefix/src/grpc_ep-stamp/grpc_ep-build-*.log\r\n\r\nmake[2]: *** [CMakeFiles/grpc_ep.dir/build.make:112: grpc_ep-prefix/src/grpc_ep-stamp/grpc_ep-build] Error 1\r\nmake[1]: *** [CMakeFiles/Makefile2:248: CMakeFiles/grpc_ep.dir/all] Error 2\r\nmake: *** [Makefile:141: all] Error 2\r\n```\r\n\u00a0\r\n\r\nWhen I inspect the logs\r\n```java\n\r\ncat /home/pi/Repositories/arrow-build/build_16/arrow-apache-arrow-0.16.0/cpp/release/orc_ep-prefix/src/orc_ep-stamp/orc_ep-build-*.log\n```\r\nI see:\r\n```java\n\r\n /home/pi/Repositories/arrow-build/build_16/arrow-apache-arrow-0.16.0/cpp/release/orc_ep-prefix/src/orc_ep/c++/src/io/OutputStream.cc: In member function 'virtual uint64_t orc::BufferedOutputStream::flush()':\r\n /home/pi/Repositories/arrow-build/build_16/arrow-apache-arrow-0.16.0/cpp/release/orc_ep-prefix/src/orc_ep/c++/src/io/OutputStream.cc:95:61: error: conversion from 'uint64_t' {aka 'long long unsigned int'} to 'size_t' {aka 'unsigned int'} may change value [-Werror=conversion]\r\n outputStream->write(dataBuffer->data(), dataBuffer->size());\r\n ~~~~~~~~~~~~~~~^\r\n cc1plus: all warnings being treated as errors\r\n make[5]: *** [c++/src/CMakeFiles/orc.dir/build.make:83: c++/src/CMakeFiles/orc.dir/io/OutputStream.cc.o] Error 1\r\n make[5]: *** Waiting for unfinished jobs....\r\n make[4]: *** [CMakeFiles/Makefile2:205: c++/src/CMakeFiles/orc.dir/all] Error 2\r\n make[3]: *** [Makefile:163: all] Error 2\r\n Scanning dependencies of target lz4_ep\r\n [ 2%] Creating directories for 'lz4_ep'\r\n [ 4%] Performing download step (download, verify and extract) for 'lz4_ep'\r\n - lz4_ep download command succeeded. See also /home/pi/Repositories/arrow-build/build_16/arrow-apache-arrow-0.16.0/cpp/release/orc_ep-prefix/src/orc_ep-build/lz4_ep-prefix/src/lz4_ep-stamp/lz4_ep-download-*.log\r\n [ 6%] No patch step for 'lz4_ep'\r\n [ 9%] No update step for 'lz4_ep'\r\n [ 11%] Performing configure step for 'lz4_ep'\r\n Scanning dependencies of target zlib_ep\r\n [ 13%] Creating directories for 'zlib_ep'\r\n [ 16%] Performing download step (download, verify and extract) for 'zlib_ep'\r\n - zlib_ep download command succeeded. See also /home/pi/Repositories/arrow-build/build_16/arrow-apache-arrow-0.16.0/cpp/release/orc_ep-prefix/src/orc_ep-build/zlib_ep-prefix/src/zlib_ep-stamp/zlib_ep-download-*.log\r\n [ 18%] No patch step for 'zlib_ep'\r\n [ 20%] No update step for 'zlib_ep'\r\n [ 23%] Performing configure step for 'zlib_ep'\r\n - lz4_ep configure command succeeded. See also /home/pi/Repositories/arrow-build/build_16/arrow-apache-arrow-0.16.0/cpp/release/orc_ep-prefix/src/orc_ep-build/lz4_ep-prefix/src/lz4_ep-stamp/lz4_ep-configure-*.log\r\n [ 25%] Performing build step for 'lz4_ep'\r\n - zlib_ep configure command succeeded. See also /home/pi/Repositories/arrow-build/build_16/arrow-apache-arrow-0.16.0/cpp/release/orc_ep-prefix/src/orc_ep-build/zlib_ep-prefix/src/zlib_ep-stamp/zlib_ep-configure-*.log\r\n [ 27%] Performing build step for 'zlib_ep'\r\n - lz4_ep build command succeeded. See also /home/pi/Repositories/arrow-build/build_16/arrow-apache-arrow-0.16.0/cpp/release/orc_ep-prefix/src/orc_ep-build/lz4_ep-prefix/src/lz4_ep-stamp/lz4_ep-build-*.log\r\n [ 30%] Performing install step for 'lz4_ep'\r\n - lz4_ep install command succeeded. See also /home/pi/Repositories/arrow-build/build_16/arrow-apache-arrow-0.16.0/cpp/release/orc_ep-prefix/src/orc_ep-build/lz4_ep-prefix/src/lz4_ep-stamp/lz4_ep-install-*.log\r\n [ 32%] Completed 'lz4_ep'\r\n [ 32%] Built target lz4_ep\r\n - zlib_ep build command succeeded. See also /home/pi/Repositories/arrow-build/build_16/arrow-apache-arrow-0.16.0/cpp/release/orc_ep-prefix/src/orc_ep-build/zlib_ep-prefix/src/zlib_ep-stamp/zlib_ep-build-*.log\r\n [ 34%] Performing install step for 'zlib_ep'\r\n - zlib_ep install command succeeded. See also /home/pi/Repositories/arrow-build/build_16/arrow-apache-arrow-0.16.0/cpp/release/orc_ep-prefix/src/orc_ep-build/zlib_ep-prefix/src/zlib_ep-stamp/zlib_ep-install-*.log\r\n [ 37%] Completed 'zlib_ep'\r\n [ 37%] Built target zlib_ep\r\n [ 39%] Generating orc_proto.pb.h, orc_proto.pb.cc\r\n Scanning dependencies of target orc\r\n [ 41%] Building CXX object c++/src/CMakeFiles/orc.dir/io/InputStream.cc.o\r\n [ 44%] Building CXX object c++/src/CMakeFiles/orc.dir/io/OutputStream.cc.o\r\n [ 46%] Building CXX object c++/src/CMakeFiles/orc.dir/wrap/orc-proto-wrapper.cc.o\n```\r\nCould you please advise?\r\n\r\nThanks,\r\n Jakub",
        "created_at": "2020-02-29T10:45:29.000Z",
        "updated_at": "2020-04-14T15:39:19.000Z",
        "labels": [
            "Migrated from Jira",
            "Component: C++",
            "Component: Python",
            "Type: bug"
        ],
        "closed": true,
        "closed_at": "2020-04-14T15:39:19.000Z"
    },
    "comments": [
        {
            "created_at": "2020-02-29T20:25:02.944Z",
            "body": "***Note**: [Comment](https://issues.apache.org/jira/browse/ARROW-7968?focusedCommentId=17048390) by Wes McKinney (wesm):*\nI suggest disabling ARROW_ORC (and not building ORC for Python either) for the time being. I think there are some other issues relating to this ORC platform compatibility issue"
        },
        {
            "created_at": "2020-03-08T17:22:08.874Z",
            "body": "***Note**: [Comment](https://issues.apache.org/jira/browse/ARROW-7968?focusedCommentId=17054476) by Jakub Smid (jaksmid):*\nThanks,\u00a0 `[~wesm]` \u00a0for the suggestion. It partially helped.\u00a0\r\nNow I am getting an error further in the process. Is there any other flag I can try turning off? Or is the safest mode turn off everything?\r\n\r\n\r\n\r\n\u00a0\r\n```java\n\r\n[ 22%] No update step for 'grpc_ep'\r\n[ 22%] No patch step for 'grpc_ep'\r\n[ 22%] Performing configure step for 'grpc_ep'\r\n-- grpc_ep configure command succeeded. See also /home/pi/Repositories/arrow-build/build_16/arrow-apache-arrow-0.16.0/cpp/release/grpc_ep-prefix/src/grpc_ep-stamp/grpc_ep-configure-*.log\r\n[ 22%] Performing build step for 'grpc_ep'\r\nCMake Error at /home/pi/Repositories/arrow-build/build_16/arrow-apache-arrow-0.16.0/cpp/release/grpc_ep-prefix/src/grpc_ep-stamp/grpc_ep-build-RELEASE.cmake:16 (message):\r\n Command failed: 2\r\n'make'\r\nSee also\r\n/home/pi/Repositories/arrow-build/build_16/arrow-apache-arrow-0.16.0/cpp/release/grpc_ep-prefix/src/grpc_ep-stamp/grpc_ep-build-*.log\r\n\r\nmake[2]: *** [CMakeFiles/grpc_ep.dir/build.make:112: grpc_ep-prefix/src/grpc_ep-stamp/grpc_ep-build] Error 1\r\nmake[1]: *** [CMakeFiles/Makefile2:208: CMakeFiles/grpc_ep.dir/all] Error 2\r\nmake: *** [Makefile:141: all] Error 2\r\n```\r\nDetailed log from the suggested file:\u00a0\r\n```java\n\r\ncat /home/pi/Repositories/arrow-build/build_16/arrow-apache-arrow-0.16.0/cpp/release/grpc_ep-prefix/src/grpc_ep-stamp/grpc_ep-build-*.log\n```\r\n```java\n\r\n/usr/bin/ld: /home/pi/Repositories/arrow-build/build_16/arrow-apache-arrow-0.16.0/cpp/release/protobuf_ep-install/lib/libprotobuf.a(arena.o): in function `google::protobuf::internal::ArenaImpl::Init()': arena.cc:(.text+0x4ac): undefined reference to `__atomic_fetch_add_8' collect2: error: ld returned 1 exit status make[5]: *** [CMakeFiles/grpc_ruby_plugin.dir/build.make:89: grpc_ruby_plugin] Error 1 make[4]: *** [CMakeFiles/Makefile2:73: CMakeFiles/grpc_ruby_plugin.dir/all] Error 2 make[4]: *** Waiting for unfinished jobs.... /usr/bin/ld: /home/pi/Repositories/arrow-build/build_16/arrow-apache-arrow-0.16.0/cpp/release/protobuf_ep-install/lib/libprotobuf.a(arena.o): in function `google::protobuf::internal::ArenaImpl::Init()': arena.cc:(.text+0x4ac): undefined reference to `__atomic_fetch_add_8' collect2: error: ld returned 1 exit status make[5]: *** [CMakeFiles/grpc_python_plugin.dir/build.make:89: grpc_python_plugin] Error 1 make[4]: *** [CMakeFiles/Makefile2:110: CMakeFiles/grpc_python_plugin.dir/all] Error 2 /usr/bin/ld: /home/pi/Repositories/arrow-build/build_16/arrow-apache-arrow-0.16.0/cpp/release/protobuf_ep-install/lib/libprotobuf.a(arena.o): in function `google::protobuf::internal::ArenaImpl::Init()': arena.cc:(.text+0x4ac): undefined reference to `__atomic_fetch_add_8' collect2: error: ld returned 1 exit status make[5]: *** [CMakeFiles/grpc_node_plugin.dir/build.make:89: grpc_node_plugin] Error 1 make[4]: *** [CMakeFiles/Makefile2:184: CMakeFiles/grpc_node_plugin.dir/all] Error 2 /usr/bin/ld: /home/pi/Repositories/arrow-build/build_16/arrow-apache-arrow-0.16.0/cpp/release/protobuf_ep-install/lib/libprotobuf.a(arena.o): in function `google::protobuf::internal::ArenaImpl::Init()': arena.cc:(.text+0x4ac): undefined reference to `__atomic_fetch_add_8' collect2: error: ld returned 1 exit status make[5]: *** [CMakeFiles/grpc_objective_c_plugin.dir/build.make:89: grpc_objective_c_plugin] Error 1 make[4]: *** [CMakeFiles/Makefile2:147: CMakeFiles/grpc_objective_c_plugin.dir/all] Error 2 make[3]: *** [Makefile:130: all] Error 2 Scanning dependencies of target gen_legal_metadata_characters Scanning dependencies of target address_sorting [ 0%] Building CXX object CMakeFiles/gen_legal_metadata_characters.dir/tools/codegen/core/gen_legal_metadata_characters.cc.o [ 0%] Building C object CMakeFiles/address_sorting.dir/third_party/address_sorting/address_sorting.c.o Scanning dependencies of target gpr Scanning dependencies of target grpc_plugin_support [ 1%] Building CXX object CMakeFiles/gpr.dir/src/core/lib/gpr/alloc.cc.o [ 1%] Building CXX object CMakeFiles/grpc_plugin_support.dir/src/compiler/cpp_generator.cc.o [ 1%] Building CXX object CMakeFiles/gpr.dir/src/core/lib/gpr/atm.cc.o [ 1%] Linking CXX executable gen_legal_metadata_characters [ 1%] Building C object CMakeFiles/address_sorting.dir/third_party/address_sorting/address_sorting_posix.c.o [ 1%] Building CXX object CMakeFiles/gpr.dir/src/core/lib/gpr/cpu_iphone.cc.o [ 1%] Built target gen_legal_metadata_characters [ 1%] Building C object CMakeFiles/address_sorting.dir/third_party/address_sorting/address_sorting_windows.c.o Scanning dependencies of target gen_percent_encoding_tables [ 1%] Building CXX object CMakeFiles/gen_percent_encoding_tables.dir/tools/codegen/core/gen_percent_encoding_tables.cc.o [ 1%] Building CXX object CMakeFiles/gpr.dir/src/core/lib/gpr/cpu_linux.cc.o [ 1%] Linking C static library libaddress_sorting.a [ 1%] Linking CXX executable gen_percent_encoding_tables [ 1%] Building CXX object CMakeFiles/gpr.dir/src/core/lib/gpr/cpu_posix.cc.o [ 1%] Built target address_sorting [ 2%] Building CXX object CMakeFiles/grpc_plugin_support.dir/src/compiler/csharp_generator.cc.o [ 2%] Building CXX object CMakeFiles/gpr.dir/src/core/lib/gpr/cpu_windows.cc.o [ 2%] Built target gen_percent_encoding_tables [ 2%] Building CXX object CMakeFiles/grpc_plugin_support.dir/src/compiler/node_generator.cc.o [ 2%] Building CXX object CMakeFiles/gpr.dir/src/core/lib/gpr/env_linux.cc.o [ 2%] Building CXX object CMakeFiles/gpr.dir/src/core/lib/gpr/env_posix.cc.o [ 2%] Building CXX object CMakeFiles/gpr.dir/src/core/lib/gpr/env_windows.cc.o [ 2%] Building CXX object CMakeFiles/gpr.dir/src/core/lib/gpr/log.cc.o [ 2%] Building CXX object CMakeFiles/gpr.dir/src/core/lib/gpr/log_android.cc.o [ 2%] Building CXX object CMakeFiles/gpr.dir/src/core/lib/gpr/log_linux.cc.o [ 3%] Building CXX object CMakeFiles/gpr.dir/src/core/lib/gpr/log_posix.cc.o [ 3%] Building CXX object CMakeFiles/gpr.dir/src/core/lib/gpr/log_windows.cc.o [ 3%] Building CXX object CMakeFiles/gpr.dir/src/core/lib/gpr/murmur_hash.cc.o [ 3%] Building CXX object CMakeFiles/gpr.dir/src/core/lib/gpr/string.cc.o [ 3%] Building CXX object CMakeFiles/gpr.dir/src/core/lib/gpr/string_posix.cc.o [ 3%] Building CXX object CMakeFiles/gpr.dir/src/core/lib/gpr/string_util_windows.cc.o [ 3%] Building CXX object CMakeFiles/gpr.dir/src/core/lib/gpr/string_windows.cc.o [ 3%] Building CXX object CMakeFiles/gpr.dir/src/core/lib/gpr/sync.cc.o [ 3%] Building CXX object CMakeFiles/gpr.dir/src/core/lib/gpr/sync_posix.cc.o [ 3%] Building CXX object CMakeFiles/gpr.dir/src/core/lib/gpr/sync_windows.cc.o [ 3%] Building CXX object CMakeFiles/gpr.dir/src/core/lib/gpr/time.cc.o [ 3%] Building CXX object CMakeFiles/grpc_plugin_support.dir/src/compiler/objective_c_generator.cc.o [ 3%] Building CXX object CMakeFiles/gpr.dir/src/core/lib/gpr/time_posix.cc.o [ 4%] Building CXX object CMakeFiles/gpr.dir/src/core/lib/gpr/time_precise.cc.o [ 4%] Building CXX object CMakeFiles/gpr.dir/src/core/lib/gpr/time_windows.cc.o [ 4%] Building CXX object CMakeFiles/gpr.dir/src/core/lib/gpr/tls_pthread.cc.o [ 4%] Building CXX object CMakeFiles/gpr.dir/src/core/lib/gpr/tmpfile_msys.cc.o [ 4%] Building CXX object CMakeFiles/grpc_plugin_support.dir/src/compiler/python_generator.cc.o [ 4%] Building CXX object CMakeFiles/grpc_plugin_support.dir/src/compiler/php_generator.cc.o [ 4%] Building CXX object CMakeFiles/gpr.dir/src/core/lib/gpr/tmpfile_posix.cc.o [ 4%] Building CXX object CMakeFiles/grpc_plugin_support.dir/src/compiler/ruby_generator.cc.o [ 4%] Building CXX object CMakeFiles/gpr.dir/src/core/lib/gpr/tmpfile_windows.cc.o [ 4%] Building CXX object CMakeFiles/gpr.dir/src/core/lib/gpr/wrap_memcpy.cc.o [ 4%] Building CXX object CMakeFiles/gpr.dir/src/core/lib/gprpp/fork.cc.o [ 4%] Building CXX object CMakeFiles/gpr.dir/src/core/lib/gprpp/global_config_env.cc.o [ 4%] Building CXX object CMakeFiles/gpr.dir/src/core/lib/gprpp/arena.cc.o [ 4%] Linking CXX static library libgrpc_plugin_support.a [ 4%] Building CXX object CMakeFiles/gpr.dir/src/core/lib/gprpp/host_port.cc.o [ 4%] Building CXX object CMakeFiles/gpr.dir/src/core/lib/gprpp/mpscq.cc.o [ 5%] Building CXX object CMakeFiles/gpr.dir/src/core/lib/gprpp/thd_posix.cc.o [ 5%] Built target grpc_plugin_support [ 5%] Building CXX object CMakeFiles/gpr.dir/src/core/lib/gprpp/thd_windows.cc.o [ 5%] Building CXX object CMakeFiles/gpr.dir/src/core/lib/profiling/basic_timers.cc.o Scanning dependencies of target grpc_ruby_plugin [ 6%] Building CXX object CMakeFiles/grpc_ruby_plugin.dir/src/compiler/ruby_plugin.cc.o Scanning dependencies of target grpc_python_plugin [ 6%] Building CXX object CMakeFiles/grpc_python_plugin.dir/src/compiler/python_plugin.cc.o Scanning dependencies of target grpc_objective_c_plugin [ 6%] Building CXX object CMakeFiles/grpc_objective_c_plugin.dir/src/compiler/objective_c_plugin.cc.o [ 6%] Building CXX object CMakeFiles/gpr.dir/src/core/lib/profiling/stap_timers.cc.o [ 6%] Linking CXX static library libgpr.a [ 6%] Built target gpr Scanning dependencies of target grpc_node_plugin [ 6%] Building CXX object CMakeFiles/grpc_node_plugin.dir/src/compiler/node_plugin.cc.o [ 6%] Linking CXX executable grpc_ruby_plugin [ 6%] Linking CXX executable grpc_python_plugin [ 6%] Linking CXX executable grpc_node_plugin [ 6%] Linking CXX executable grpc_objective_c_plugin\r\n```\r\n\u00a0"
        },
        {
            "created_at": "2020-03-09T16:55:25.645Z",
            "body": "***Note**: [Comment](https://issues.apache.org/jira/browse/ARROW-7968?focusedCommentId=17055207) by Wes McKinney (wesm):*\nTry disabling ARROW_FLIGHT next"
        },
        {
            "created_at": "2020-04-14T15:39:19.646Z",
            "body": "***Note**: [Comment](https://issues.apache.org/jira/browse/ARROW-7968?focusedCommentId=17083354) by Wes McKinney (wesm):*\nThis is resolved in master. I'm able to build and use pyarrow on armv8 (rpi4, rockpro64) now"
        }
    ]
}