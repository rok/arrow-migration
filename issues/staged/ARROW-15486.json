{
    "issue": {
        "title": "[Release][Java] Verify staged maven artifacts",
        "body": "***Note**: This issue was originally created as [ARROW-15486](https://issues.apache.org/jira/browse/ARROW-15486). Please see the [migration documentation](https://gist.github.com/toddfarmer/12aa88361532d21902818a6044fda4c3) for further details.*\n\n### Original Issue Description:\nWe have two tests right now:\r\n1. Execute `mvn test` from the source tarball's java directory testing the source https://github.com/apache/arrow/blob/master/dev/release/verify-release-candidate.sh#L278\r\n2. Verify the checksums and signatures of the uploaded maven artifacts https://github.com/apache/arrow/blob/master/dev/release/verify-release-candidate.sh#L766\r\n\r\nBut we don't actually **test** the packages. We should add that to the verification scripts, since 7.0 is going to be the first release shipping the jars with bundled JNI libraries.\r\n\r\ncc `[~kou]` `[~anthonylouis]`",
        "created_at": "2022-01-27T16:07:01.000Z",
        "updated_at": "2022-04-08T12:27:58.000Z",
        "labels": [
            "Migrated from Jira",
            "Component: Java",
            "Type: enhancement"
        ],
        "closed": false
    },
    "comments": [
        {
            "created_at": "2022-01-28T01:58:29.956Z",
            "body": "***Note**: [Comment](https://issues.apache.org/jira/browse/ARROW-15486?focusedCommentId=17483516) by Kouhei Sutou (kou):*\nI think that we should do this too.\r\nWe already published `*-tests.jar` such as https://repository.apache.org/content/repositories/staging/org/apache/arrow/arrow-dataset/7.0.0/arrow-dataset-7.0.0-tests.jar but I don't know how to run them..."
        },
        {
            "created_at": "2022-01-28T15:12:52.381Z",
            "body": "***Note**: [Comment](https://issues.apache.org/jira/browse/ARROW-15486?focusedCommentId=17483814) by David Dali Susanibar Arce (dsusanibara):*\nHi Team,\u00a0\r\n\r\nI check <https://repository.apache.org/content/repositories/staging/org/apache/arrow/> for .jar arrow library and any of these appear on that site\r\n\r\nWhen we are planning to test the packages in theory there are tested by maven modules dependency between theirs. Only top layer module are not testing, for these layer will be needed to create a `demo` project that only download jar dependencies.\r\n\r\nFor this purpose to I could test the java jar packages could you help me with information needed for maven settings.xml to I could execute:\r\n\r\n\u00a0\r\n```java\n\r\nmvn -Parrowrc clean install \n```\r\n\u00a0\r\n\r\nsettings.xml\r\n\r\n\u00a0\r\n```java\n\r\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n<settings xsi:schemaLocation=\"http://maven.apache.org/SETTINGS/1.1.0 http://maven.apache.org/xsd/settings-1.1.0.xsd\" xmlns=\"http://maven.apache.org/SETTINGS/1.1.0\"\r\n\u00a0 \u00a0 xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\">\r\n\u00a0 <servers>\r\n\u00a0 \u00a0 <server>\r\n\u00a0 \u00a0 \u00a0 <username>xxx</username>\r\n\u00a0 \u00a0 \u00a0 <password>yyy</password>\r\n\u00a0 \u00a0 \u00a0 <id>snapshots</id>\r\n\u00a0 \u00a0 </server>\r\n\u00a0 </servers>\r\n\u00a0 <profiles>\r\n\u00a0 \u00a0 <profile>\r\n\u00a0 \u00a0 \u00a0 <repositories>\r\n\u00a0 \u00a0 \u00a0 \u00a0 <repository>\r\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <snapshots />\r\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <id>snapshots</id>\r\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <name>libs-snapshot</name>\r\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <url>uuu</url>\r\n\u00a0 \u00a0 \u00a0 \u00a0 </repository>\r\n\u00a0 \u00a0 \u00a0 </repositories>\r\n\u00a0 \u00a0 \u00a0 <pluginRepositories>\r\n\u00a0 \u00a0 \u00a0 \u00a0 <pluginRepository>\r\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <snapshots />\r\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <id>snapshots</id>\r\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <name>plugins-release</name>\r\n\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 <url>uuu</url>\r\n\u00a0 \u00a0 \u00a0 \u00a0 </pluginRepository>\r\n\u00a0 \u00a0 \u00a0 </pluginRepositories>\r\n\u00a0 \u00a0 \u00a0 <id>arrowrc</id>\r\n\u00a0 \u00a0 </profile>\r\n\u00a0 </profiles>\r\n\u00a0 <activeProfiles>\r\n\u00a0 \u00a0 <activeProfile>arrowrc</activeProfile>\r\n\u00a0 </activeProfiles>\r\n</settings> \n```\r\n\u00a0\r\n\r\nAccording to these PR <https://github.com/apache/arrow/pull/11617/files> .jar will be uploaded to: [8]: https://apache.jfrog.io/artifactory/arrow/java-rc/#\\{@release_version}-rc0\r\n\r\n\u00a0\r\n\r\n`[~kou]` \u00a0\r\n\r\n\u00a0\r\n\r\n\u00a0"
        },
        {
            "created_at": "2022-01-28T21:50:23.655Z",
            "body": "***Note**: [Comment](https://issues.apache.org/jira/browse/ARROW-15486?focusedCommentId=17483987) by Kouhei Sutou (kou):*\nWe stopped uploading `.jar` s to Artifactory because we use https://repository.apache.org/ 's staging feature.\r\nI hope that https://repository.apache.org/content/repositories/staging/org/apache/arrow/ is used for verification but I don't know how to specify the URL... I'm not familiar with Java...\r\n\r\n`[~csun]` Do you know how to specify the URL? https://github.com/apache/arrow/pull/11669#issuecomment-965887786 ?"
        },
        {
            "created_at": "2022-01-29T01:31:27.008Z",
            "body": "***Note**: [Comment](https://issues.apache.org/jira/browse/ARROW-15486?focusedCommentId=17484036) by Chao Sun (csun):*\n`[~kou]` after you the RC on nexus is closed, the artifacts will be available in the staging repository, and users can update their Maven pom.xml using the following settings:\r\n\r\n```Java\n\r\n    <repository>\r\n       <id>staged</id>\r\n       <name>staged-releases</name>\r\n       <url>https://repository.apache.org/content/repositories/staging/</url>\r\n       <releases>\r\n         <enabled>true</enabled>\r\n       </releases>\r\n       <snapshots>\r\n         <enabled>true</enabled>\r\n       </snapshots>\r\n     </repository>\r\n```\r\n(and of course, they need to update the Arrow version to the one specified in the RC).\r\n\r\n"
        },
        {
            "created_at": "2022-01-29T02:12:50.945Z",
            "body": "***Note**: [Comment](https://issues.apache.org/jira/browse/ARROW-15486?focusedCommentId=17484044) by Kouhei Sutou (kou):*\nThanks!\r\n\r\n`[~dsusanibara]` Could you try this?"
        },
        {
            "created_at": "2022-02-11T00:33:42.788Z",
            "body": "***Note**: [Comment](https://issues.apache.org/jira/browse/ARROW-15486?focusedCommentId=17490586) by David Dali Susanibar Arce (dsusanibara):*\nTesting jni dataset library: Downloading from snapshots: <https://repository.apache.org/content/repositories/staging/org/apache/arrow/arrow-memory/7.0.0/org/apache/arrow/arrow-dataset/7.0.0/arrow-dataset-7.0.0.jar>\r\n\r\n\u00a0\r\n\r\nMacOS Big Sur - 11.5.2 - JDK 8: OK\r\n\r\notool -L libarrow_dataset_jni.dylib\r\nlibarrow_dataset_jni.dylib:\r\n\u00a0 \u00a0 @rpath/libarrow_dataset_jni.700.dylib (compatibility version 700.0.0, current version 700.0.0)\r\n\u00a0 \u00a0 /usr/lib/libz.1.dylib (compatibility version 1.0.0, current version 1.2.11)\r\n\u00a0 \u00a0 /usr/lib/libc++.1.dylib (compatibility version 1.0.0, current version 1200.3.0)\r\n\u00a0 \u00a0 /usr/lib/libSystem.B.dylib (compatibility version 1.0.0, current version 1311.0.0)\r\n\r\n\u00a0\r\n\r\nUbuntu 20.04.3 LTS - JDK 11: OK\r\n\r\nEvidence: https://github.com/apache/arrow-cookbook/runs/5149652103?check_suite_focus=true\r\n\r\nldd libarrow_dataset_jni.so\r\n\u00a0 \u00a0 \u00a0 \u00a0 linux-vdso.so.1 (0x00007fff259ac000)\r\n\u00a0 \u00a0 \u00a0 \u00a0 libdl.so.2 => /lib/x86_64-linux-gnu/libdl.so.2 (0x00007f3968d13000)\r\n\u00a0 \u00a0 \u00a0 \u00a0 librt.so.1 => /lib/x86_64-linux-gnu/librt.so.1 (0x00007f3968d08000)\r\n\u00a0 \u00a0 \u00a0 \u00a0 libstdc+.so.6 => /lib/x86_64-linux-gnu/libstdc+.so.6 (0x00007f3968b26000)\r\n\u00a0 \u00a0 \u00a0 \u00a0 libm.so.6 => /lib/x86_64-linux-gnu/libm.so.6 (0x00007f39689d7000)\r\n\u00a0 \u00a0 \u00a0 \u00a0 libgcc_s.so.1 => /lib/x86_64-linux-gnu/libgcc_s.so.1 (0x00007f39689bc000)\r\n\u00a0 \u00a0 \u00a0 \u00a0 libpthread.so.0 => /lib/x86_64-linux-gnu/libpthread.so.0 (0x00007f3968997000)\r\n\u00a0 \u00a0 \u00a0 \u00a0 libc.so.6 => /lib/x86_64-linux-gnu/libc.so.6 (0x00007f39687a5000)\r\n\u00a0 \u00a0 \u00a0 \u00a0 /lib64/ld-linux-x86-64.so.2 (0x00007f396ac7a000)\r\n\r\nTesting Code:\r\n\r\n\u00a0\r\n```java\n\r\n.. testcode::\r\n\r\n    import org.apache.arrow.dataset.file.FileFormat;\r\n    import org.apache.arrow.dataset.file.FileSystemDatasetFactory;\r\n    import org.apache.arrow.dataset.jni.NativeMemoryPool;\r\n    import org.apache.arrow.dataset.source.DatasetFactory;\r\n    import org.apache.arrow.memory.RootAllocator;\r\n    import org.apache.arrow.vector.types.pojo.Schema;\r\n    import org.apache.arrow.util.AutoCloseables;\r\n\r\n    String uri = \"file:\" + System.getProperty(\"user.dir\") + \"/thirdpartydeps/parquetfiles/data1.parquet\";\r\n    RootAllocator rootAllocator = new RootAllocator(Long.MAX_VALUE);\r\n    DatasetFactory datasetFactory = new FileSystemDatasetFactory(rootAllocator, NativeMemoryPool.getDefault(), FileFormat.PARQUET, uri);\r\n    Schema schema = datasetFactory.inspect();\r\n    AutoCloseables.close(datasetFactory);\r\n\r\n    System.out.println(schema);\r\n\r\n.. testoutput::\r\n\r\n    Schema<id: Int(32, true), name: Utf8>(metadata: {parquet.avro.schema={\"type\":\"record\",\"name\":\"User\",\"namespace\":\"org.apache.arrow.dataset\",\"fields\":[{\"name\":\"id\",\"type\":[\"int\",\"null\"]},{\"name\":\"name\",\"type\":[\"string\",\"null\"]}]}, writer.model.name=avro}) \n```\r\n\u00a0\r\n\r\n\u00a0\r\n\r\n<font color=\"#FF0000\">Pending</font>: Testing JNI C Data Interface (I need to learn more about that library to test that)\r\n\r\n\u00a0\r\n\r\nQuestion: Is there some reason to not be able to download arrow flight for staging https://repository.apache.org/content/repositories/staging/org/apache/arrow/arrow-flight/\u00a0?\u00a0"
        },
        {
            "created_at": "2022-02-11T21:18:49.255Z",
            "body": "***Note**: [Comment](https://issues.apache.org/jira/browse/ARROW-15486?focusedCommentId=17491154) by Kouhei Sutou (kou):*\nWe have https://repository.apache.org/content/repositories/staging/org/apache/arrow/flight-core/ and https://repository.apache.org/content/repositories/staging/org/apache/arrow/flight-grpc/ instead."
        },
        {
            "created_at": "2022-02-17T20:00:45.096Z",
            "body": "***Note**: [Comment](https://issues.apache.org/jira/browse/ARROW-15486?focusedCommentId=17494198) by David Dali Susanibar Arce (dsusanibara):*\nHi `[~kou]` \u00a0\r\n\r\nRelated to java arrow flight I see that arrow-flight parent is not correctly updating the \\*.pom to the maven repository that since 7.0.0 this is needed as a parent pom for flight module\r\n\r\nWe are not seeing arrow-flight-7.0.0.pom at:\r\n \\* <https://repo.maven.apache.org/maven2/org/apache/arrow/arrow-flight/>\r\n \\* <https://repository.apache.org/content/repositories/staging/org/apache/arrow/arrow-flight/>\r\n\r\nArrow flight modules were configured at the same that arrow memory is using parent \\*.pom but for some reason it is not uploading arrow-flight-7.0.0.pom and seeing error like:\r\n\r\n[ERROR] Failed to execute goal on project demo: Could not resolve dependencies for project org.example:demo:jar:1.0-SNAPSHOT: Failed to collect dependencies at org.apache.arrow:flight-core:jar:7.0.0:\r\n\r\n\u00a0\r\n\r\n////\r\n\r\n\u00a0\r\n\r\nArrow 6.0.0 - arrow flight core (not needed of arrow-flight pom)\r\n\r\n\u00a0\r\n```java\n\r\n<parent>\r\n  <groupId>org.apache.arrow</groupId>\r\n  <artifactId>arrow-java-root</artifactId>\r\n  <version>6.0.0</version>\r\n  <relativePath>../../pom.xml</relativePath>\r\n</parent>\r\n\r\n<artifactId>flight-core</artifactId>\r\n<name>Arrow Flight Core</name>\r\n<description>(Experimental)An RPC mechanism for transferring ValueVectors.</description>\r\n<packaging>jar</packaging> \n```\r\n\u00a0\r\n\r\n\u00a0\r\n\r\nArrow 7.0.0 - Arrow flight introduce dependencies of parent arrow-flight:\r\n\r\nArrow 7.0.0 - Flight Core\r\n\r\n\u00a0\r\n```java\n\r\n<parent>\r\n  <artifactId>arrow-flight</artifactId>\r\n  <groupId>org.apache.arrow</groupId>\r\n  <version>7.0.0</version>\r\n  <relativePath>../pom.xml</relativePath>\r\n</parent>\r\n\r\n<artifactId>flight-core</artifactId>\r\n<name>Arrow Flight Core</name>\r\n<description>(Experimental)An RPC mechanism for transferring ValueVectors.</description>\r\n<packaging>jar</packaging> \n```\r\nArrow 7.0.0 - Flight Parent\r\n\r\n\u00a0\r\n```java\n\r\n<parent>\r\n    <artifactId>arrow-java-root</artifactId>\r\n    <groupId>org.apache.arrow</groupId>\r\n    <version>7.0.0</version>\r\n</parent>\r\n<modelVersion>4.0.0</modelVersion>\r\n\r\n<name>Arrow Flight</name>\r\n<artifactId>arrow-flight</artifactId>\r\n<packaging>pom</packaging> \n```\r\n\u00a0\r\n\r\nCC: `[~kszucs]` \u00a0\r\n\r\n\u00a0"
        },
        {
            "created_at": "2022-02-18T12:10:06.257Z",
            "body": "***Note**: [Comment](https://issues.apache.org/jira/browse/ARROW-15486?focusedCommentId=17494572) by David Dali Susanibar Arce (dsusanibara):*\nHi `[~kou]` ,\r\n\r\nI am seeing on github workflow logs por Nightly and Release and it show us clear that arrow-flight-7.0.0.pom is generated on the server an loaded to the github resources server\r\n\r\n\u00a0\r\n```java\n\r\n2022-01-29T05:35:32.0491480Z [INFO] Installing /Users/runner/work/crossbow/crossbow/arrow/java/flight/pom.xml to /Users/runner/.m2/repository/org/apache/arrow/arrow-flight/7.0.0/arrow-flight-7.0.0.pom\r\n2022-01-26T08:25:33.0926250Z [INFO] Installing /Users/runner/work/crossbow/crossbow/arrow/java/flight/pom.xml to /Users/runner/.m2/repository/org/apache/arrow/arrow-flight/7.0.0.dev585/arrow-flight-7.0.0.dev585.pom\r\n2022-01-29T05:56:57.0811310Z INFO:crossbow:Uploading asset `arrow-flight-7.0.0.pom` with mimetype application/zip and size 2518...\r\n2022-01-26T08:36:08.2444750Z INFO:crossbow:Uploading asset `arrow-flight-7.0.0.dev585.pom` with mimetype application/zip and size 2525...\r\n```\r\n\u00a0\r\n \\* Nightly: <https://github.com/ursacomputing/crossbow/commit/8f6d3dee167d3ddf4026d5630818c2ec3ccad06c/checks/4948395483/logs>\r\n \\* Release: <https://github.com/ursacomputing/crossbow/commit/f5ccc3cd3f0655f46dc7c6f3cddc9f0b430149ca/checks/4988335536/logs>\r\n\r\n\u00a0\r\n\r\nDo you know what of all the checks was configured for validating upload to maven repository using <https://github.com/apache/arrow/blob/master/dev/release/06-java-upload.sh>?\r\n\r\n<https://github.com/apache/arrow/tree/release-7.0.0-rc10>\r\n\r\n![image-2022-02-18-07-07-45-928.png](https://issues.apache.org/jira/secure/attachment/13040235/image-2022-02-18-07-07-45-928.png)\r\n\r\n\u00a0\r\n\r\nThank you in advance\r\n\r\n\u00a0"
        },
        {
            "created_at": "2022-02-18T21:44:03.432Z",
            "body": "***Note**: [Comment](https://issues.apache.org/jira/browse/ARROW-15486?focusedCommentId=17494823) by Kouhei Sutou (kou):*\nThere are no validations for now.\r\nSo we need to implement a verification mechanism by this issue.\r\n\r\nSee also: https://lists.apache.org/thread/fbrgvf30os5h4ox7fk4txrlgdp1g5g4g\r\n\r\n`[~bryanc]` is also taking a look at this."
        }
    ]
}