{
    "issue": {
        "title": "Python: FindPythonLibsNew does not work in a virtualenv",
        "body": "***Note**: This issue was originally created as [ARROW-65](https://issues.apache.org/jira/browse/ARROW-65). Please see the [migration documentation](https://gist.github.com/toddfarmer/12aa88361532d21902818a6044fda4c3) for further details.*\n\n### Original Issue Description:\nIt fails on latest Gentoo System with Python 3.4 as the main python, see the attached log.\n\nIn constrast, CMake 3.5's own FindPythonLibs works. Is there any reason for shipping a custom FindPythonLibs with PyArrow? Should we possibly make it depended on the calling CMake version?\n\nLog:\n```\n-- The C compiler identification is GNU 5.3.0\n-- The CXX compiler identification is GNU 5.3.0\n-- Check for working C compiler: /usr/bin/cc\n-- Check for working C compiler: /usr/bin/cc -- works\n-- Detecting C compiler ABI info\n-- Detecting C compiler ABI info - done\n-- Detecting C compile features\n-- Detecting C compile features - done\n-- Check for working CXX compiler: /usr/bin/c++\n-- Check for working CXX compiler: /usr/bin/c++ -- works\n-- Detecting CXX compiler ABI info\n-- Detecting CXX compiler ABI info - done\n-- Detecting CXX compile features\n-- Detecting CXX compile features - done\nConfigured for DEBUG build (set with cmake -DCMAKE_BUILD_TYPE={release,debug,...})\nINFO Using built-in specs.\nCOLLECT_GCC=/usr/x86_64-pc-linux-gnu/gcc-bin/5.3.0/c++\nCOLLECT_LTO_WRAPPER=/usr/libexec/gcc/x86_64-pc-linux-gnu/5.3.0/lto-wrapper\nTarget: x86_64-pc-linux-gnu\nConfigured with: /var/tmp/notmpfs/portage/sys-devel/gcc-5.3.0/work/gcc-5.3.0/configure --host=x86_64-pc-linux-gnu --build=x86_64-pc-linux-gnu --prefix=/usr --bindir=/usr/x86_64-pc-linux-gnu/gcc-bin/5.3.0 --includedir=/usr/lib/gcc/x86_64-pc-linux-gnu/5.3.0/include --datadir=/usr/share/gcc-data/x86_64-pc-linux-gnu/5.3.0 --mandir=/usr/share/gcc-data/x86_64-pc-linux-gnu/5.3.0/man --infodir=/usr/share/gcc-data/x86_64-pc-linux-gnu/5.3.0/info --with-gxx-include-dir=/usr/lib/gcc/x86_64-pc-linux-gnu/5.3.0/include/g++-v5 --with-python-dir=/share/gcc-data/x86_64-pc-linux-gnu/5.3.0/python --enable-languages=c,c++,java,go,fortran --enable-obsolete --enable-secureplt --disable-werror --with-system-zlib --enable-nls --without-included-gettext --enable-checking=release --with-bugurl=https://bugs.gentoo.org/ --with-pkgversion='Gentoo 5.3.0 p1.0, pie-0.6.5' --enable-libstdcxx-time --enable-shared --enable-threads=posix --enable-__cxa_atexit --enable-clocale=gnu --enable-multilib --with-multilib-list=m32,m64 --disable-altivec --disable-fixed-point --enable-targets=all --enable-libgomp --disable-libmudflap --disable-libssp --disable-libcilkrts --enable-lto --without-isl --enable-libsanitizer\nThread model: posix\ngcc version 5.3.0 (Gentoo 5.3.0 p1.0, pie-0.6.5) \n\nSelected compiler gcc 5.3.0\nUsing dynamic linking for DEBUG builds\ncollect2 version 5.3.0\n/usr/lib/gcc/x86_64-pc-linux-gnu/5.3.0/../../../../x86_64-pc-linux-gnu/bin/ld -plugin /usr/libexec/gcc/x86_64-pc-linux-gnu/5.3.0/liblto_plugin.so -plugin-opt=/usr/libexec/gcc/x86_64-pc-linux-gnu/5.3.0/lto-wrapper -plugin-opt=-fresolution=/tmp/ccMLevrM.res -plugin-opt=-pass-through=-lgcc_s -plugin-opt=-pass-through=-lgcc -plugin-opt=-pass-through=-lc -plugin-opt=-pass-through=-lgcc_s -plugin-opt=-pass-through=-lgcc --eh-frame-hdr -m elf_x86_64 -dynamic-linker /lib64/ld-linux-x86-64.so.2 /usr/lib/gcc/x86_64-pc-linux-gnu/5.3.0/../../../../lib64/crt1.o /usr/lib/gcc/x86_64-pc-linux-gnu/5.3.0/../../../../lib64/crti.o /usr/lib/gcc/x86_64-pc-linux-gnu/5.3.0/crtbegin.o -L/usr/lib/gcc/x86_64-pc-linux-gnu/5.3.0 -L/usr/lib/gcc/x86_64-pc-linux-gnu/5.3.0/../../../../lib64 -L/lib/../lib64 -L/usr/lib/../lib64 -L/usr/lib/gcc/x86_64-pc-linux-gnu/5.3.0/../../../../x86_64-pc-linux-gnu/lib -L/usr/lib/gcc/x86_64-pc-linux-gnu/5.3.0/../../.. --version -lstdc++ -lm -lgcc_s -lgcc -lc -lgcc_s -lgcc /usr/lib/gcc/x86_64-pc-linux-gnu/5.3.0/crtend.o /usr/lib/gcc/x86_64-pc-linux-gnu/5.3.0/../../../../lib64/crtn.o\nUsing ld linker\n-- Found PythonInterp: /home/xhochy/.virtualenvs/arrow/bin/python (found version \"3.4.3\") \n-- Searching for Python libs in /home/xhochy/.virtualenvs/arrow/lib64;/home/xhochy/.virtualenvs/arrow/lib;/usr/lib64/python3.4/config-3.4m\n-- Found Python lib PYTHON_LIBRARY-NOTFOUND\n-- Found PythonLibs: PYTHON_LIBRARY-NOTFOUND\n-- Found Cython: /home/xhochy/.virtualenvs/arrow/bin/cython  \n-- Searching for Python libs in /home/xhochy/.virtualenvs/arrow/lib64;/home/xhochy/.virtualenvs/arrow/lib;/usr/lib64/python3.4/config-3.4m\n-- Found Python lib PYTHON_LIBRARY-NOTFOUND\n-- Found the Arrow library: /home/xhochy/Development/dist/lib/libarrow.so\nAdded shared library dependency arrow: /home/xhochy/Development/dist/lib/libarrow.so\nCMake Error: The following variables are used in this project, but they are set to NOTFOUND.\nPlease set them or make sure they are set and tested correctly in the CMake files:\nPYTHON_LIBRARY (ADVANCED)\n    linked by target \"schema\" in directory /home/xhochy/Development/arrow/python\n    linked by target \"schema\" in directory /home/xhochy/Development/arrow/python\n    linked by target \"scalar\" in directory /home/xhochy/Development/arrow/python\n    linked by target \"scalar\" in directory /home/xhochy/Development/arrow/python\n    linked by target \"error\" in directory /home/xhochy/Development/arrow/python\n    linked by target \"error\" in directory /home/xhochy/Development/arrow/python\n    linked by target \"array\" in directory /home/xhochy/Development/arrow/python\n    linked by target \"array\" in directory /home/xhochy/Development/arrow/python\n    linked by target \"config\" in directory /home/xhochy/Development/arrow/python\n    linked by target \"config\" in directory /home/xhochy/Development/arrow/python\n\n-- Configuring incomplete, errors occurred!\nSee also \"/home/xhochy/Development/arrow/python/build/CMakeFiles/CMakeOutput.log\".\n```",
        "created_at": "2016-03-14T20:42:38.000Z",
        "updated_at": "2016-10-04T23:01:43.000Z",
        "labels": [
            "Migrated from Jira",
            "Component: Python",
            "Type: bug"
        ],
        "closed": true,
        "closed_at": "2016-03-27T19:31:11.000Z"
    },
    "comments": [
        {
            "created_at": "2016-03-14T21:44:39.321Z",
            "body": "***Note**: [Comment](https://issues.apache.org/jira/browse/ARROW-65?focusedCommentId=15194205) by Wes McKinney (wesm):*\n`[~xhochy]` I'm more than happy to reduce the amount of 3rd-party code we are shipping. I migrated the script you see over from the dynd project here https://github.com/libdynd/dynd-python/commits/master/cmake/FindPythonLibsNew.cmake. For example, there may be issues on OS X due to:\n\n```Java\n    IF(APPLE)\n# On OS X, linking against the Python libraries causes\n# segfaults, so do this dynamic lookup instead.\n      SET_TARGET_PROPERTIES(${_NAME} PROPERTIES LINK_FLAGS\n                          \"-undefined dynamic_lookup\")\n    ELSE()\n      TARGET_LINK_LIBRARIES(${_NAME} ${PYTHON_LIBRARIES})\n    ENDIF()\n```\n\nsince FindPythonLibs.cmake differs a lot between cmake versions, we may end up having to ship it anyway. It would be great if we can try to use the cmake version, though. If that doesn't work, or some manual patches are necessary, then we should fix the one in the Arrow repo ourselves for your environment. "
        },
        {
            "created_at": "2016-03-15T14:14:28.215Z",
            "body": "***Note**: [Comment](https://issues.apache.org/jira/browse/ARROW-65?focusedCommentId=15195349) by Uwe Korn (uwe):*\nProbably best is to sync both files as good as possible. On Linux, I would prefer to use the one the distribution provides as it may have been customised to the distro's custom Python packaging. \n\nIndependent of that, I will have a look in getting the changes between CMake and Arrow merged, so that it builds for me with the one Arrow ships."
        },
        {
            "created_at": "2016-03-27T12:05:24.108Z",
            "body": "***Note**: [Comment](https://issues.apache.org/jira/browse/ARROW-65?focusedCommentId=15213437) by Uwe Korn (uwe):*\nPR: https://github.com/apache/arrow/pull/43"
        },
        {
            "created_at": "2016-03-27T19:31:11.948Z",
            "body": "***Note**: [Comment](https://issues.apache.org/jira/browse/ARROW-65?focusedCommentId=15213599) by Wes McKinney (wesm):*\nIssue resolved by pull request 43\n<https://github.com/apache/arrow/pull/43>"
        }
    ]
}