{
    "issue": {
        "title": "[C++] Parquet tests and executables are linked statically",
        "body": "***Note**: This issue was originally created as [ARROW-6309](https://issues.apache.org/jira/browse/ARROW-6309). Please see the [migration documentation](https://gist.github.com/toddfarmer/12aa88361532d21902818a6044fda4c3) for further details.*\n\n### Original Issue Description:\nFor some reason, on Linux Parquet tests are now statically linked with `libparquet` and `libarrow` by default, even though other tests (Arrow, Plasma...) are dynamically-linked.\r\n\r\nFor example:\r\n```Java\n\r\n$ ldd build-test/debug/parquet-schema-test \r\n\tlinux-vdso.so.1 (0x00007ffd376ad000)\r\n\tlibgtest_main.so => /home/antoine/miniconda3/envs/pyarrow/lib/libgtest_main.so (0x00007f3affeaf000)\r\n\tlibgtest.so => /home/antoine/miniconda3/envs/pyarrow/lib/libgtest.so (0x00007f3affde5000)\r\n\tlibbz2.so.1.0 => /home/antoine/miniconda3/envs/pyarrow/lib/libbz2.so.1.0 (0x00007f3affdd1000)\r\n\tliblz4.so.1 => /home/antoine/miniconda3/envs/pyarrow/lib/liblz4.so.1 (0x00007f3aff58d000)\r\n\tlibsnappy.so.1 => /home/antoine/miniconda3/envs/pyarrow/lib/libsnappy.so.1 (0x00007f3aff384000)\r\n\tlibz.so.1 => /home/antoine/miniconda3/envs/pyarrow/lib/libz.so.1 (0x00007f3affdb1000)\r\n\tlibzstd.so.1.3.7 => /home/antoine/miniconda3/envs/pyarrow/lib/libzstd.so.1.3.7 (0x00007f3affd0a000)\r\n\tlibboost_filesystem.so.1.67.0 => /home/antoine/miniconda3/envs/pyarrow/lib/libboost_filesystem.so.1.67.0 (0x00007f3aff168000)\r\n\tlibstdc++.so.6 => /home/antoine/miniconda3/envs/pyarrow/lib/libstdc++.so.6 (0x00007f3afeff4000)\r\n\tlibm.so.6 => /lib/x86_64-linux-gnu/libm.so.6 (0x00007f3afec56000)\r\n\tlibgcc_s.so.1 => /home/antoine/miniconda3/envs/pyarrow/lib/libgcc_s.so.1 (0x00007f3affcbb000)\r\n\tlibc.so.6 => /lib/x86_64-linux-gnu/libc.so.6 (0x00007f3afe865000)\r\n\tlibpthread.so.0 => /lib/x86_64-linux-gnu/libpthread.so.0 (0x00007f3afe646000)\r\n\tlibboost_system.so.1.67.0 => /home/antoine/miniconda3/envs/pyarrow/lib/./libboost_system.so.1.67.0 (0x00007f3afe441000)\r\n\tlibrt.so.1 => /lib/x86_64-linux-gnu/librt.so.1 (0x00007f3afe239000)\r\n\t/lib64/ld-linux-x86-64.so.2 (0x00007f3affc8f000)\r\n```\r\n\r\nContrast with e.g.:\r\n```Java\n\r\n$ ldd build-test/debug/arrow-uri-test \r\n\tlinux-vdso.so.1 (0x00007ffe07fb6000)\r\n\tlibarrow.so.15 => /home/antoine/arrow/dev/cpp/build-test/debug/libarrow.so.15 (0x00007f774f340000)\r\n\tlibboost_system.so.1.67.0 => /home/antoine/miniconda3/envs/pyarrow/lib/libboost_system.so.1.67.0 (0x00007f774f13b000)\r\n\tlibgtest_main.so => /home/antoine/miniconda3/envs/pyarrow/lib/libgtest_main.so (0x00007f7751723000)\r\n\tlibgtest.so => /home/antoine/miniconda3/envs/pyarrow/lib/libgtest.so (0x00007f7751659000)\r\n\tlibstdc++.so.6 => /home/antoine/miniconda3/envs/pyarrow/lib/libstdc++.so.6 (0x00007f774efc7000)\r\n\tlibgcc_s.so.1 => /home/antoine/miniconda3/envs/pyarrow/lib/libgcc_s.so.1 (0x00007f7751645000)\r\n\tlibc.so.6 => /lib/x86_64-linux-gnu/libc.so.6 (0x00007f774ebd6000)\r\n\tlibaws-cpp-sdk-s3.so => /home/antoine/miniconda3/envs/pyarrow/lib/libaws-cpp-sdk-s3.so (0x00007f774e990000)\r\n\tlibaws-cpp-sdk-core.so => /home/antoine/miniconda3/envs/pyarrow/lib/libaws-cpp-sdk-core.so (0x00007f774e893000)\r\n\tlibdl.so.2 => /lib/x86_64-linux-gnu/libdl.so.2 (0x00007f774e68f000)\r\n\tliburiparser.so.1 => /home/antoine/miniconda3/envs/pyarrow/lib/liburiparser.so.1 (0x00007f77515f2000)\r\n\tlibbz2.so.1.0 => /home/antoine/miniconda3/envs/pyarrow/lib/libbz2.so.1.0 (0x00007f77515de000)\r\n\tliblz4.so.1 => /home/antoine/miniconda3/envs/pyarrow/lib/liblz4.so.1 (0x00007f774e46b000)\r\n\tlibsnappy.so.1 => /home/antoine/miniconda3/envs/pyarrow/lib/libsnappy.so.1 (0x00007f774e262000)\r\n\tlibz.so.1 => /home/antoine/miniconda3/envs/pyarrow/lib/libz.so.1 (0x00007f77515bc000)\r\n\tlibzstd.so.1.3.7 => /home/antoine/miniconda3/envs/pyarrow/lib/libzstd.so.1.3.7 (0x00007f774e1bd000)\r\n\tlibboost_filesystem.so.1.67.0 => /home/antoine/miniconda3/envs/pyarrow/lib/libboost_filesystem.so.1.67.0 (0x00007f774dfa1000)\r\n\tlibpthread.so.0 => /lib/x86_64-linux-gnu/libpthread.so.0 (0x00007f774dd82000)\r\n\tlibm.so.6 => /lib/x86_64-linux-gnu/libm.so.6 (0x00007f774d9e4000)\r\n\t/lib64/ld-linux-x86-64.so.2 (0x00007f7751503000)\r\n\tlibrt.so.1 => /lib/x86_64-linux-gnu/librt.so.1 (0x00007f774d7dc000)\r\n\tlibcurl.so.4 => /home/antoine/miniconda3/envs/pyarrow/lib/./libcurl.so.4 (0x00007f7751534000)\r\n\tlibcrypto.so.1.1 => /home/antoine/miniconda3/envs/pyarrow/lib/./libcrypto.so.1.1 (0x00007f774d512000)\r\n\tlibaws-c-event-stream.so.0unstable => /home/antoine/miniconda3/envs/pyarrow/lib/./libaws-c-event-stream.so.0unstable (0x00007f775152b000)\r\n\tlibaws-c-common.so.0unstable => /home/antoine/miniconda3/envs/pyarrow/lib/./libaws-c-common.so.0unstable (0x00007f774d4ef000)\r\n\tlibssh2.so.1 => /home/antoine/miniconda3/envs/pyarrow/lib/././libssh2.so.1 (0x00007f774d4bd000)\r\n\tlibssl.so.1.1 => /home/antoine/miniconda3/envs/pyarrow/lib/././libssl.so.1.1 (0x00007f774d42d000)\r\n\tlibgssapi_krb5.so.2 => /home/antoine/miniconda3/envs/pyarrow/lib/././libgssapi_krb5.so.2 (0x00007f774d3de000)\r\n\tlibkrb5.so.3 => /home/antoine/miniconda3/envs/pyarrow/lib/././libkrb5.so.3 (0x00007f774d302000)\r\n\tlibk5crypto.so.3 => /home/antoine/miniconda3/envs/pyarrow/lib/././libk5crypto.so.3 (0x00007f774d2e1000)\r\n\tlibcom_err.so.3 => /home/antoine/miniconda3/envs/pyarrow/lib/././libcom_err.so.3 (0x00007f774d2db000)\r\n\tlibaws-checksums.so => /home/antoine/miniconda3/envs/pyarrow/lib/././libaws-checksums.so (0x00007f774d2cd000)\r\n\tlibkrb5support.so.0 => /home/antoine/miniconda3/envs/pyarrow/lib/./././libkrb5support.so.0 (0x00007f774d2be000)\r\n\tlibresolv.so.2 => /lib/x86_64-linux-gnu/libresolv.so.2 (0x00007f774d0a3000)\r\n```\r\n\r\nStatic linking makes building slower and the test executables larger.",
        "created_at": "2019-08-21T13:59:12.000Z",
        "updated_at": "2019-08-22T09:17:58.000Z",
        "labels": [
            "Migrated from Jira",
            "Component: C++",
            "Type: bug"
        ],
        "closed": true,
        "closed_at": "2019-08-22T08:46:27.000Z"
    },
    "comments": [
        {
            "created_at": "2019-08-21T14:08:57.600Z",
            "body": "***Note**: [Comment](https://issues.apache.org/jira/browse/ARROW-6309?focusedCommentId=16912309) by Antoine Pitrou (apitrou):*\nSame problem with Parquet utilities, e.g.:\r\n```Java\n\r\n$ ldd build-test/debug/parquet-dump-schema \r\n\tlinux-vdso.so.1 (0x00007fff97beb000)\r\n\tlibbz2.so.1.0 => /home/antoine/miniconda3/envs/pyarrow/lib/libbz2.so.1.0 (0x00007ff046339000)\r\n\tliblz4.so.1 => /home/antoine/miniconda3/envs/pyarrow/lib/liblz4.so.1 (0x00007ff044eec000)\r\n\tlibsnappy.so.1 => /home/antoine/miniconda3/envs/pyarrow/lib/libsnappy.so.1 (0x00007ff044ce3000)\r\n\tlibz.so.1 => /home/antoine/miniconda3/envs/pyarrow/lib/libz.so.1 (0x00007ff046319000)\r\n\tlibzstd.so.1.3.7 => /home/antoine/miniconda3/envs/pyarrow/lib/libzstd.so.1.3.7 (0x00007ff046274000)\r\n\tlibboost_filesystem.so.1.67.0 => /home/antoine/miniconda3/envs/pyarrow/lib/libboost_filesystem.so.1.67.0 (0x00007ff044ac7000)\r\n\tlibboost_system.so.1.67.0 => /home/antoine/miniconda3/envs/pyarrow/lib/libboost_system.so.1.67.0 (0x00007ff0448c2000)\r\n\tlibthrift.so.0.11.0 => /home/antoine/miniconda3/envs/pyarrow/lib/libthrift.so.0.11.0 (0x00007ff0461be000)\r\n\tlibstdc++.so.6 => /home/antoine/miniconda3/envs/pyarrow/lib/libstdc++.so.6 (0x00007ff04474e000)\r\n\tlibm.so.6 => /lib/x86_64-linux-gnu/libm.so.6 (0x00007ff0443b0000)\r\n\tlibgcc_s.so.1 => /home/antoine/miniconda3/envs/pyarrow/lib/libgcc_s.so.1 (0x00007ff04616f000)\r\n\tlibpthread.so.0 => /lib/x86_64-linux-gnu/libpthread.so.0 (0x00007ff044191000)\r\n\tlibc.so.6 => /lib/x86_64-linux-gnu/libc.so.6 (0x00007ff043da0000)\r\n\t/lib64/ld-linux-x86-64.so.2 (0x00007ff046128000)\r\n\tlibrt.so.1 => /lib/x86_64-linux-gnu/librt.so.1 (0x00007ff043b98000)\r\n\tlibssl.so.1.1 => /home/antoine/miniconda3/envs/pyarrow/lib/./libssl.so.1.1 (0x00007ff043b08000)\r\n\tlibcrypto.so.1.1 => /home/antoine/miniconda3/envs/pyarrow/lib/./libcrypto.so.1.1 (0x00007ff04383e000)\r\n\tlibdl.so.2 => /lib/x86_64-linux-gnu/libdl.so.2 (0x00007ff04363a000)\r\n```"
        },
        {
            "created_at": "2019-08-21T14:27:41.222Z",
            "body": "***Note**: [Comment](https://issues.apache.org/jira/browse/ARROW-6309?focusedCommentId=16912329) by Wes McKinney (wesm):*\nWell https://github.com/apache/arrow/blob/master/cpp/src/parquet/CMakeLists.txt#L327. Remember that there are Thrift symbol issues\r\n\r\nI think that the utilities have been statically linked also for a long time. "
        },
        {
            "created_at": "2019-08-21T14:28:45.650Z",
            "body": "***Note**: [Comment](https://issues.apache.org/jira/browse/ARROW-6309?focusedCommentId=16912332) by Wes McKinney (wesm):*\nI think if we isolate the Thrift symbols into a `libparquet_thrift.a` static library then we can fix this. Do you want to try? I can, too"
        },
        {
            "created_at": "2019-08-21T14:30:37.356Z",
            "body": "***Note**: [Comment](https://issues.apache.org/jira/browse/ARROW-6309?focusedCommentId=16912334) by Antoine Pitrou (apitrou):*\nThis used to be only on Windows. Now it seems it's on Linux too."
        },
        {
            "created_at": "2019-08-21T14:31:00.931Z",
            "body": "***Note**: [Comment](https://issues.apache.org/jira/browse/ARROW-6309?focusedCommentId=16912336) by Antoine Pitrou (apitrou):*\nIt also means that someone cannot disable production of static libraries on Linux...\r\n\r\n`[~kou]`"
        },
        {
            "created_at": "2019-08-21T14:43:09.533Z",
            "body": "***Note**: [Comment](https://issues.apache.org/jira/browse/ARROW-6309?focusedCommentId=16912353) by Wes McKinney (wesm):*\nYes, this is definitely a regression, we should fix"
        },
        {
            "created_at": "2019-08-21T22:06:36.333Z",
            "body": "***Note**: [Comment](https://issues.apache.org/jira/browse/ARROW-6309?focusedCommentId=16912724) by Kouhei Sutou (kou):*\nWe need to use static linking only on Windows, right?\r\nI've created a pull request for the change: https://github.com/apache/arrow/pull/5158"
        },
        {
            "created_at": "2019-08-22T08:46:27.112Z",
            "body": "***Note**: [Comment](https://issues.apache.org/jira/browse/ARROW-6309?focusedCommentId=16913144) by Antoine Pitrou (apitrou):*\nIssue resolved by pull request 5158\n<https://github.com/apache/arrow/pull/5158>"
        }
    ]
}