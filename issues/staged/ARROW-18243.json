{
    "issue": {
        "title": "[R] Sanitizer nightly failure pointing to mixup between TimestampType and DurationType",
        "body": "***Note**: This issue was originally created as [ARROW-18243](https://issues.apache.org/jira/browse/ARROW-18243). Please see the [migration documentation](https://gist.github.com/toddfarmer/12aa88361532d21902818a6044fda4c3) for further details.*\n\n### Original Issue Description:\nFrom the test-ubuntu-18.04-r-sanitizer nightly failure:\r\n\r\nhttps://dev.azure.com/ursacomputing/crossbow/_build/results?buildId=38932&view=logs&j=0da5d1d9-276d-5173-c4c4-9d4d4ed14fdb&t=d9b15392-e4ce-5e4c-0c8c-b69645229181&l=10690\r\n\r\n(Output of the error:)\r\n\r\n```\n\r\n2022-11-03T05:18:46.2812479Z Start test: timestamp round/floor/ceil works for week units (non-standard week_start)\r\n2022-11-03T05:18:46.2813291Z array_to_vector.cpp:877:13: runtime error: downcast of address 0x608000567830 which does not point to an object of type 'TimestampType'\r\n2022-11-03T05:18:46.2814019Z 0x608000567830: note: object is of type 'arrow::DurationType'\r\n2022-11-03T05:18:46.2814485Z  02 00 00 00  60 57 55 0e 41 7f 00 00  c0 da 3b 00 30 60 00 00  00 00 00 00 00 00 00 00  30 78 56 00\r\n2022-11-03T05:18:46.2814873Z               ^~~~~~~~~~~~~~~~~~~~~~~\r\n2022-11-03T05:18:46.2815339Z               vptr for 'arrow::DurationType'\r\n2022-11-03T05:18:46.2816306Z     #0 0x7f40fce08769 in arrow::r::Converter_Time<long, arrow::TimestampType>::TimeUnit_multiplier(std::shared_ptr<arrow::Array> const&) const (/usr/local/RDsan/lib/R/site-library/arrow/libs/arrow.so+0x1d46a769)\r\n2022-11-03T05:18:46.2817843Z     #1 0x7f40fcdee301 in arrow::r::Converter_Time<long, arrow::TimestampType>::Ingest_some_nulls(SEXPREC*, std::shared_ptr<arrow::Array> const&, long, long, unsigned long) const (/usr/local/RDsan/lib/R/site-library/arrow/libs/arrow.so+0x1d450301)\r\n2022-11-03T05:18:46.2819238Z     #2 0x7f40fcd41f20 in arrow::r::Converter::ScheduleConvertTasks(arrow::r::RTasks&, std::shared_ptr<arrow::r::Converter>)::{lambda()#1}::operator()() const /tmp/RtmpAivWT4/R.INSTALL165111fb12d5/arrow/src/array_to_vector.cpp:88\r\n2022-11-03T05:18:46.2820996Z     #3 0x7f40fcde8223 in arrow::internal::FnOnce<arrow::Status ()>::FnImpl<arrow::r::Converter::ScheduleConvertTasks(arrow::r::RTasks&, std::shared_ptr<arrow::r::Converter>)::{lambda()#1}>::invoke() (/usr/local/RDsan/lib/R/site-library/arrow/libs/arrow.so+0x1d44a223)\r\n2022-11-03T05:18:46.2822336Z     #4 0x7f4102999ebb in arrow::internal::FnOnce<arrow::Status ()>::operator()() && /arrow/cpp/src/arrow/util/functional.h:140\r\n2022-11-03T05:18:46.2823083Z     #5 0x7f4102999ebb in operator() /arrow/cpp/src/arrow/util/task_group.cc:113\r\n2022-11-03T05:18:46.2823546Z     #6 0x7f4102999ebb in invoke /arrow/cpp/src/arrow/util/functional.h:152\r\n2022-11-03T05:18:46.2824071Z     #7 0x7f41029e1084 in arrow::internal::FnOnce<void ()>::operator()() && /arrow/cpp/src/arrow/util/functional.h:140\r\n2022-11-03T05:18:46.2824793Z     #8 0x7f41029e1084 in WorkerLoop /arrow/cpp/src/arrow/util/thread_pool.cc:243\r\n2022-11-03T05:18:46.2825437Z     #9 0x7f41029e1084 in operator() /arrow/cpp/src/arrow/util/thread_pool.cc:414\r\n2022-11-03T05:18:46.2826065Z     #10 0x7f41029e1084 in __invoke_impl<void, arrow::internal::ThreadPool::LaunchWorkersUnlocked(int)::<lambda()> > /usr/include/c++/10/bits/invoke.h:60\r\n2022-11-03T05:18:46.2827016Z     #11 0x7f41029e1084 in __invoke<arrow::internal::ThreadPool::LaunchWorkersUnlocked(int)::<lambda()> > /usr/include/c++/10/bits/invoke.h:95\r\n2022-11-03T05:18:46.2827623Z     #12 0x7f41029e1084 in _M_invoke<0> /usr/include/c++/10/thread:264\r\n2022-11-03T05:18:46.2828039Z     #13 0x7f41029e1084 in operator() /usr/include/c++/10/thread:271\r\n2022-11-03T05:18:46.2828622Z     #14 0x7f41029e1084 in _M_run /usr/include/c++/10/thread:215\r\n2022-11-03T05:18:46.2829426Z     #15 0x7f4136e502b2  (/usr/lib/x86_64-linux-gnu/libstdc++.so.6+0xdc2b2)\r\n2022-11-03T05:18:46.2830356Z     #16 0x7f41377acb42 in start_thread nptl/pthread_create.c:442\r\n2022-11-03T05:18:46.2831959Z     #17 0x7f413783dbb3 in __clone (/usr/lib/x86_64-linux-gnu/libc.so.6+0x125bb3)\r\n2022-11-03T05:18:46.2832205Z \r\n2022-11-03T05:18:46.2833205Z array_to_vector.cpp:877:63: runtime error: member call on address 0x608000127bb0 which does not point to an object of type 'TimestampType'\r\n2022-11-03T05:18:46.2834542Z 0x608000127bb0: note: object is of type 'arrow::DurationType'\r\n2022-11-03T05:18:46.2835169Z  02 00 00 00  60 57 55 0e 41 7f 00 00  e0 de 3b 00 30 60 00 00  00 00 00 00 00 00 00 00  b0 7b 12 00\r\n2022-11-03T05:18:46.2835942Z               ^~~~~~~~~~~~~~~~~~~~~~~\r\n2022-11-03T05:18:46.2836696Z               vptr for 'arrow::DurationType'\r\n2022-11-03T05:18:46.2838086Z     #0 0x7f40fce0884c in arrow::r::Converter_Time<long, arrow::TimestampType>::TimeUnit_multiplier(std::shared_ptr<arrow::Array> const&) const (/usr/local/RDsan/lib/R/site-library/arrow/libs/arrow.so+0x1d46a84c)\r\n2022-11-03T05:18:46.2839650Z     #1 0x7f40fcdee301 in arrow::r::Converter_Time<long, arrow::TimestampType>::Ingest_some_nulls(SEXPREC*, std::shared_ptr<arrow::Array> const&, long, long, unsigned long) const (/usr/local/RDsan/lib/R/site-library/arrow/libs/arrow.so+0x1d450301)\r\n2022-11-03T05:18:46.2840745Z     #2 0x7f40fcd41f20 in arrow::r::Converter::ScheduleConvertTasks(arrow::r::RTasks&, std::shared_ptr<arrow::r::Converter>)::{lambda()#1}::operator()() const /tmp/RtmpAivWT4/R.INSTALL165111fb12d5/arrow/src/array_to_vector.cpp:88\r\n2022-11-03T05:18:46.2842185Z     #3 0x7f40fcde8223 in arrow::internal::FnOnce<arrow::Status ()>::FnImpl<arrow::r::Converter::ScheduleConvertTasks(arrow::r::RTasks&, std::shared_ptr<arrow::r::Converter>)::{lambda()#1}>::invoke() (/usr/local/RDsan/lib/R/site-library/arrow/libs/arrow.so+0x1d44a223)\r\n2022-11-03T05:18:46.2843361Z     #4 0x7f4102999ebb in arrow::internal::FnOnce<arrow::Status ()>::operator()() && /arrow/cpp/src/arrow/util/functional.h:140\r\n2022-11-03T05:18:46.2843925Z     #5 0x7f4102999ebb in operator() /arrow/cpp/src/arrow/util/task_group.cc:113\r\n2022-11-03T05:18:46.2844374Z     #6 0x7f4102999ebb in invoke /arrow/cpp/src/arrow/util/functional.h:152\r\n2022-11-03T05:18:46.2845044Z     #7 0x7f41029e1084 in arrow::internal::FnOnce<void ()>::operator()() && /arrow/cpp/src/arrow/util/functional.h:140\r\n2022-11-03T05:18:46.2845566Z     #8 0x7f41029e1084 in WorkerLoop /arrow/cpp/src/arrow/util/thread_pool.cc:243\r\n2022-11-03T05:18:46.2846011Z     #9 0x7f41029e1084 in operator() /arrow/cpp/src/arrow/util/thread_pool.cc:414\r\n2022-11-03T05:18:46.2847000Z     #10 0x7f41029e1084 in __invoke_impl<void, arrow::internal::ThreadPool::LaunchWorkersUnlocked(int)::<lambda()> > /usr/include/c++/10/bits/invoke.h:60\r\n2022-11-03T05:18:46.2847759Z     #11 0x7f41029e1084 in __invoke<arrow::internal::ThreadPool::LaunchWorkersUnlocked(int)::<lambda()> > /usr/include/c++/10/bits/invoke.h:95\r\n2022-11-03T05:18:46.2848541Z     #12 0x7f41029e1084 in _M_invoke<0> /usr/include/c++/10/thread:264\r\n2022-11-03T05:18:46.2849977Z     #13 0x7f41029e1084 in operator() /usr/include/c++/10/thread:271\r\n2022-11-03T05:18:46.2850524Z     #14 0x7f41029e1084 in _M_run /usr/include/c++/10/thread:215\r\n2022-11-03T05:18:46.2851414Z     #15 0x7f4136e502b2  (/usr/lib/x86_64-linux-gnu/libstdc++.so.6+0xdc2b2)\r\n2022-11-03T05:18:46.2851989Z     #16 0x7f41377acb42 in start_thread nptl/pthread_create.c:442\r\n2022-11-03T05:18:46.2853276Z     #17 0x7f413783dbb3 in __clone (/usr/lib/x86_64-linux-gnu/libc.so.6+0x125bb3)\r\n2022-11-03T05:18:46.2853498Z \r\n2022-11-03T05:18:46.2854540Z /tmp/RtmpAivWT4/R.INSTALL165111fb12d5/arrow/libarrow/arrow-10.0.0.9000/include/arrow/type.h:1380:40: runtime error: member access within address 0x608000567830 which does not point to an object of type 'TimestampType'\r\n2022-11-03T05:18:46.2855390Z 0x608000567830: note: object is of type 'arrow::DurationType'\r\n2022-11-03T05:18:46.2855850Z  02 00 00 00  60 57 55 0e 41 7f 00 00  c0 da 3b 00 30 60 00 00  00 00 00 00 00 00 00 00  30 78 56 00\r\n2022-11-03T05:18:46.2857165Z               ^~~~~~~~~~~~~~~~~~~~~~~\r\n2022-11-03T05:18:46.2857943Z               vptr for 'arrow::DurationType'\r\n2022-11-03T05:18:46.2858805Z     #0 0x7f40fcd3fa5f in arrow::TimestampType::unit() const /tmp/RtmpAivWT4/R.INSTALL165111fb12d5/arrow/libarrow/arrow-10.0.0.9000/include/arrow/type.h:1380\r\n2022-11-03T05:18:46.2860244Z     #1 0x7f40fce08854 in arrow::r::Converter_Time<long, arrow::TimestampType>::TimeUnit_multiplier(std::shared_ptr<arrow::Array> const&) const (/usr/local/RDsan/lib/R/site-library/arrow/libs/arrow.so+0x1d46a854)\r\n2022-11-03T05:18:46.2862369Z     #2 0x7f40fcdee301 in arrow::r::Converter_Time<long, arrow::TimestampType>::Ingest_some_nulls(SEXPREC*, std::shared_ptr<arrow::Array> const&, long, long, unsigned long) const (/usr/local/RDsan/lib/R/site-library/arrow/libs/arrow.so+0x1d450301)\r\n2022-11-03T05:18:46.2863658Z     #3 0x7f40fcd41f20 in arrow::r::Converter::ScheduleConvertTasks(arrow::r::RTasks&, std::shared_ptr<arrow::r::Converter>)::{lambda()#1}::operator()() const /tmp/RtmpAivWT4/R.INSTALL165111fb12d5/arrow/src/array_to_vector.cpp:88\r\n2022-11-03T05:18:46.2865496Z     #4 0x7f40fcde8223 in arrow::internal::FnOnce<arrow::Status ()>::FnImpl<arrow::r::Converter::ScheduleConvertTasks(arrow::r::RTasks&, std::shared_ptr<arrow::r::Converter>)::{lambda()#1}>::invoke() (/usr/local/RDsan/lib/R/site-library/arrow/libs/arrow.so+0x1d44a223)\r\n2022-11-03T05:18:46.2866438Z     #5 0x7f4102999ebb in arrow::internal::FnOnce<arrow::Status ()>::operator()() && /arrow/cpp/src/arrow/util/functional.h:140\r\n2022-11-03T05:18:46.2866995Z     #6 0x7f4102999ebb in operator() /arrow/cpp/src/arrow/util/task_group.cc:113\r\n2022-11-03T05:18:46.2867603Z     #7 0x7f4102999ebb in invoke /arrow/cpp/src/arrow/util/functional.h:152\r\n2022-11-03T05:18:46.2868129Z     #8 0x7f41029e1084 in arrow::internal::FnOnce<void ()>::operator()() && /arrow/cpp/src/arrow/util/functional.h:140\r\n2022-11-03T05:18:46.2868647Z     #9 0x7f41029e1084 in WorkerLoop /arrow/cpp/src/arrow/util/thread_pool.cc:243\r\n2022-11-03T05:18:46.2869301Z     #10 0x7f41029e1084 in operator() /arrow/cpp/src/arrow/util/thread_pool.cc:414\r\n2022-11-03T05:18:46.2869934Z     #11 0x7f41029e1084 in __invoke_impl<void, arrow::internal::ThreadPool::LaunchWorkersUnlocked(int)::<lambda()> > /usr/include/c++/10/bits/invoke.h:60\r\n2022-11-03T05:18:46.2870696Z     #12 0x7f41029e1084 in __invoke<arrow::internal::ThreadPool::LaunchWorkersUnlocked(int)::<lambda()> > /usr/include/c++/10/bits/invoke.h:95\r\n2022-11-03T05:18:46.2871611Z     #13 0x7f41029e1084 in _M_invoke<0> /usr/include/c++/10/thread:264\r\n2022-11-03T05:18:46.2872194Z     #14 0x7f41029e1084 in operator() /usr/include/c++/10/thread:271\r\n2022-11-03T05:18:46.2872766Z     #15 0x7f41029e1084 in _M_run /usr/include/c++/10/thread:215\r\n2022-11-03T05:18:46.2873413Z     #16 0x7f4136e502b2  (/usr/lib/x86_64-linux-gnu/libstdc++.so.6+0xdc2b2)\r\n2022-11-03T05:18:46.2873871Z     #17 0x7f41377acb42 in start_thread nptl/pthread_create.c:442\r\n2022-11-03T05:18:46.2874652Z     #18 0x7f413783dbb3 in __clone (/usr/lib/x86_64-linux-gnu/libc.so.6+0x125bb3)\r\n2022-11-03T05:18:46.2874870Z \r\n```\r\n",
        "created_at": "2022-11-03T18:12:40.000Z",
        "updated_at": "2022-11-16T13:52:03.000Z",
        "labels": [
            "Migrated from Jira",
            "Component: R",
            "Type: enhancement"
        ],
        "closed": false
    },
    "comments": [
        {
            "created_at": "2022-11-15T15:07:52.286Z",
            "body": "***Note**: [Comment](https://issues.apache.org/jira/browse/ARROW-18243?focusedCommentId=17634398) by Dewey Dunnington (paleolimbot):*\nMinimal reprex to fire the incorrect unit (I'm using a print method after checking `std::dynamic_pointer_cast()` instead of the sanitizer which seems to work for this):\r\n\r\n```R\n\r\nlibrary(arrow, warn.conflicts = FALSE)\r\n#> Some features are not enabled in this build of Arrow. Run `arrow_info()` for more information.\r\nlibrary(dplyr, warn.conflicts = FALSE)\r\n\r\nplan <- record_batch(x = Sys.time()) |> \r\n  mutate(y = round_date(x, \"week\", week_start = 2)) \r\n\r\nplan\r\n#> RecordBatch (query)\r\n#> x: timestamp[us, tz=UTC]\r\n#> y: timestamp[us, tz=UTC] (add_checked(round_temporal(subtract_checked(x, 86400), {multiple=1, unit=WEEK, week_starts_monday=true, ceil_is_strictly_greater=true, calendar_based_origin=true}), 86400))\r\n#> \r\n#> See $.data for the source Arrow object\r\n\r\nplan |> collect()\r\n#> # A tibble: 1 \u00d7 2\r\n#>   x                   y                  \r\n#>   <dttm>              <dttm>             \r\n#> 1 2022-11-15 15:07:01 2022-11-15 00:00:00\r\n```\r\n"
        },
        {
            "created_at": "2022-11-16T13:52:03.952Z",
            "body": "***Note**: [Comment](https://issues.apache.org/jira/browse/ARROW-18243?focusedCommentId=17634850) by Dewey Dunnington (paleolimbot):*\nThis will be fixed by ARROW-18334."
        }
    ]
}